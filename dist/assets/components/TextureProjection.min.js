/* X_ITE v10.2.0 */
const __X_ITE_X3D__=window[Symbol.for("X_ITE.X3D-10.2.0")];(()=>{"use strict";var t={n:e=>{var i=e&&e.__esModule?()=>e.default:()=>e;return t.d(i,{a:i}),i},d:(e,i)=>{for(var r in i)t.o(i,r)&&!t.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:i[r]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e)};const e=__X_ITE_X3D__.Components;var i=t.n(e);const r=__X_ITE_X3D__.Fields;var n=t.n(r);const a=__X_ITE_X3D__.X3DFieldDefinition;var o=t.n(a);const s=__X_ITE_X3D__.FieldDefinitionArray;var u=t.n(s);const h=__X_ITE_X3D__.X3DLightNode;var l=t.n(h);const c=__X_ITE_X3D__.X3DConstants;var _=t.n(c);const x=__X_ITE_X3D__.X3DCast;var p=t.n(x);const m=__X_ITE_X3D__.Vector3;var w=t.n(m);const g=__X_ITE_X3D__.Rotation4;var d=t.n(g);const f=__X_ITE_X3D__.Matrix4;var T=t.n(f);const O=__X_ITE_X3D__.Namespace;var F=t.n(O);function M(t){l().call(this,t),this.addType(_().X3DTextureProjectorNode),this._location.setUnit("length"),this._farDistance.setUnit("length"),this._location.setUnit("length")}Object.assign(Object.setPrototypeOf(M.prototype,l().prototype),{initialize(){l().prototype.initialize.call(this),this._nearDistance.addInterest("set_nearDistance__",this),this._farDistance.addInterest("set_farDistance__",this),this._texture.addInterest("set_texture__",this),this.set_nearDistance__(),this.set_farDistance__(),this.set_texture__()},getLightKey:()=>3,getGlobal(){return this._global.getValue()},getLocation(){return this._location.getValue()},getDirection(){return this._direction.getValue()},getNearDistance(){return this.nearDistance},getNearParameter(){return this.nearParameter},getFarDistance(){return this.farDistance},getFarParameter(){return this.farParameter},getTexture(){return this.textureNode},getBiasMatrix:(()=>{const t=new(T())(.5,0,0,0,0,.5,0,0,0,0,.5,0,.5,.5,.5,1);return function(){return t}})(),straightenHorizon(t){return t.straighten(this._upVector.getValue())},set_nearDistance__(){const t=this._nearDistance.getValue();this.nearDistance=t<0?.125:t,this.nearParameter=t<0?0:-1},set_farDistance__(){const t=this._farDistance.getValue();this.farDistance=t<0?1e5:t,this.farParameter=t<0?1:2},set_texture__(){this.textureNode?.removeInterest("set_aspectRatio__",this),this.textureNode=p()(_().X3DTexture2DNode,this._texture),this.textureNode?.addInterest("set_aspectRatio__",this),this.setEnabled(!!this.textureNode),this.set_aspectRatio__(),this.set_on__()},set_aspectRatio__(){this.textureNode?this._aspectRatio=this.textureNode.getWidth()/this.textureNode.getHeight():this._aspectRatio=1}}),Object.defineProperties(M,{typeName:{value:"X3DTextureProjectorNode",enumerable:!0},componentInfo:{value:Object.freeze({name:"TextureProjection",level:4}),enumerable:!0}});const b=M,D=F().add("X3DTextureProjectorNode",b),S=__X_ITE_X3D__.Camera;var j=t.n(S);const P=__X_ITE_X3D__.MatrixStack;var y=t.n(P);const X=__X_ITE_X3D__.ObjectCache;var v=t.n(X);const V=v()(I);function I(){this.projectionMatrix=new(T()),this.modelViewMatrix=new(y())(T()),this.modelMatrix=new(T()),this.invTextureSpaceMatrix=new(T()),this.invTextureSpaceProjectionMatrix=new(T()),this.location=new(w()),this.locationArray=new Float32Array(3),this.direction=new(w()),this.rotation=new(d()),this.matrix=new(T()),this.matrixArray=new Float32Array(16),this.textureMatrix=new(T())}function N(t){D.call(this,t),this.addType(_().TextureProjector),this._fieldOfView.setUnit("angle")}Object.assign(I.prototype,{set(t,e,i){this.browser=t.getBrowser(),this.lightNode=t,this.global=t.getGlobal(),this.modelViewMatrix.pushMatrix(i),this.textureMatrix.set(...t.getTexture().getMatrix())},renderShadowMap(t){},setGlobalVariables(t){const e=this.lightNode,i=t.getCameraSpaceMatrix().get(),r=this.modelMatrix.assign(this.modelViewMatrix.get()).multRight(i),n=this.invTextureSpaceMatrix.assign(this.global?r:T().Identity);this.rotation.setFromToVec(w().zAxis,this.direction.assign(e.getDirection()).negate()),e.straightenHorizon(this.rotation),n.translate(e.getLocation()),n.rotate(this.rotation),n.inverse();const a=e.getTexture().getWidth(),o=e.getTexture().getHeight(),s=e.getNearDistance(),u=e.getFarDistance(),h=e.getFieldOfView();j().perspective(h,s,u,a,o,this.projectionMatrix),this.global||n.multLeft(r.inverse()),this.invTextureSpaceProjectionMatrix.assign(n).multRight(this.projectionMatrix).multRight(e.getBiasMatrix()),this.matrix.assign(i).multRight(this.invTextureSpaceProjectionMatrix).multRight(this.textureMatrix),this.matrixArray.set(this.matrix),this.modelViewMatrix.get().multVecMatrix(this.location.assign(e._location.getValue())),this.locationArray.set(this.location)},setShaderUniforms(t,e,i){const r=e.numTextureProjectors++,n=this.lightNode,a=n.getTexture(),o=this.global?this.textureUnit=this.textureUnit??this.browser.popTexture2DUnit():this.browser.getTexture2DUnit();if(t.activeTexture(t.TEXTURE0+o),t.bindTexture(t.TEXTURE_2D,a.getTexture()),t.uniform1i(e.x3d_TextureProjectorTexture[r],o),e.hasTextureProjector(r,this))return;const s=n.getNearParameter(),u=n.getFarParameter();t.uniform3f(e.x3d_TextureProjectorColor[r],...n.getColor()),t.uniform1f(e.x3d_TextureProjectorIntensity[r],n.getIntensity()),t.uniform3fv(e.x3d_TextureProjectorLocation[r],this.locationArray),t.uniform3f(e.x3d_TextureProjectorParams[r],s,u,a.isLinear()),t.uniformMatrix4fv(e.x3d_TextureProjectorMatrix[r],!1,this.matrixArray)},dispose(){this.browser.pushTexture2DUnit(this.textureUnit),this.modelViewMatrix.clear(),this.textureUnit=void 0,V.push(this)}}),Object.assign(Object.setPrototypeOf(N.prototype,D.prototype),{initialize(){D.prototype.initialize.call(this)},getFieldOfView(){const t=this._fieldOfView.getValue();return t>0&&t<Math.PI?t:Math.PI/4},getLights:()=>V}),Object.defineProperties(N,{typeName:{value:"TextureProjector",enumerable:!0},componentInfo:{value:Object.freeze({name:"TextureProjection",level:2}),enumerable:!0},containerField:{value:"children",enumerable:!0},specificationRange:{value:Object.freeze({from:"4.0",to:"Infinity"}),enumerable:!0},fieldDefinitions:{value:new(u())([new(o())(_().inputOutput,"metadata",new(n().SFNode)),new(o())(_().inputOutput,"description",new(n().SFString)),new(o())(_().inputOutput,"global",new(n().SFBool)(!0)),new(o())(_().inputOutput,"on",new(n().SFBool)(!0)),new(o())(_().inputOutput,"color",new(n().SFColor)(1,1,1)),new(o())(_().inputOutput,"intensity",new(n().SFFloat)(1)),new(o())(_().inputOutput,"ambientIntensity",new(n().SFFloat)),new(o())(_().inputOutput,"location",new(n().SFVec3f)),new(o())(_().inputOutput,"direction",new(n().SFVec3f)(0,0,1)),new(o())(_().inputOutput,"upVector",new(n().SFVec3f)(0,0,1)),new(o())(_().inputOutput,"fieldOfView",new(n().SFFloat)(.785398)),new(o())(_().inputOutput,"nearDistance",new(n().SFFloat)(-1)),new(o())(_().inputOutput,"farDistance",new(n().SFFloat)(-1)),new(o())(_().outputOnly,"aspectRatio",new(n().SFFloat)),new(o())(_().inputOutput,"texture",new(n().SFNode)),new(o())(_().inputOutput,"shadows",new(n().SFBool)),new(o())(_().inputOutput,"shadowColor",new(n().SFColor)),new(o())(_().inputOutput,"shadowIntensity",new(n().SFFloat)(1)),new(o())(_().inputOutput,"shadowBias",new(n().SFFloat)(.005)),new(o())(_().initializeOnly,"shadowMapSize",new(n().SFInt32)(1024))]),enumerable:!0}});const z=N,E=F().add("TextureProjector",z),R=v()(U);function U(){this.projectionMatrix=new(T()),this.modelViewMatrix=new(y())(T()),this.modelMatrix=new(T()),this.invTextureSpaceMatrix=new(T()),this.location=new(w()),this.locationArray=new Float32Array(3),this.invTextureSpaceProjectionMatrix=new(T()),this.direction=new(w()),this.rotation=new(d()),this.matrix=new(T()),this.matrixArray=new Float32Array(16),this.textureMatrix=new(T())}function A(t){D.call(this,t),this.addType(_().TextureProjectorParallel),this._fieldOfView.setUnit("length")}Object.assign(U.prototype,{set(t,e,i){this.browser=t.getBrowser(),this.lightNode=t,this.global=t.getGlobal(),this.modelViewMatrix.pushMatrix(i),this.textureMatrix.set(...t.getTexture().getMatrix())},renderShadowMap(t){},setGlobalVariables(t){const e=this.lightNode,i=t.getCameraSpaceMatrix().get(),r=this.modelMatrix.assign(this.modelViewMatrix.get()).multRight(i),n=this.invTextureSpaceMatrix.assign(this.global?r:T().Identity);this.rotation.setFromToVec(w().zAxis,this.direction.assign(e.getDirection()).negate()),e.straightenHorizon(this.rotation),n.translate(e.getLocation()),n.rotate(this.rotation),n.inverse();const a=e.getTexture().getWidth()/e.getTexture().getHeight(),o=e.getMinimumX(),s=e.getMaximumX(),u=e.getMinimumY(),h=e.getMaximumY(),l=e.getSizeX(),c=e.getSizeY(),_=e.getNearDistance(),x=e.getFarDistance();if(a>l/c){const t=(o+s)/2,e=c*a/2;j().ortho(t-e,t+e,u,h,_,x,this.projectionMatrix)}else{const t=(u+h)/2,e=l/a/2;j().ortho(o,s,t-e,t+e,_,x,this.projectionMatrix)}this.global||n.multLeft(r.inverse()),this.invTextureSpaceProjectionMatrix.assign(n).multRight(this.projectionMatrix).multRight(e.getBiasMatrix()),this.matrix.assign(i).multRight(this.invTextureSpaceProjectionMatrix).multRight(this.textureMatrix),this.matrixArray.set(this.matrix),this.modelViewMatrix.get().multVecMatrix(this.location.assign(e._location.getValue())),this.locationArray.set(this.location)},setShaderUniforms(t,e,i){const r=e.numTextureProjectors++,n=this.lightNode,a=n.getTexture(),o=this.global?this.textureUnit=this.textureUnit??this.browser.popTexture2DUnit():this.browser.getTexture2DUnit();if(t.activeTexture(t.TEXTURE0+o),t.bindTexture(t.TEXTURE_2D,a.getTexture()),t.uniform1i(e.x3d_TextureProjectorTexture[r],o),e.hasTextureProjector(r,this))return;const s=n.getNearParameter(),u=n.getFarParameter();t.uniform3f(e.x3d_TextureProjectorColor[r],...n.getColor()),t.uniform1f(e.x3d_TextureProjectorIntensity[r],n.getIntensity()),t.uniform3fv(e.x3d_TextureProjectorLocation[r],this.locationArray),t.uniform3f(e.x3d_TextureProjectorParams[r],s,u,a.isLinear()),t.uniformMatrix4fv(e.x3d_TextureProjectorMatrix[r],!1,this.matrixArray)},dispose(){this.browser.pushTexture2DUnit(this.textureUnit),this.modelViewMatrix.clear(),this.textureUnit=void 0,R.push(this)}}),Object.assign(Object.setPrototypeOf(A.prototype,D.prototype),{initialize(){D.prototype.initialize.call(this),this._fieldOfView.addInterest("set_fieldOfView___",this),this.set_fieldOfView___()},set_fieldOfView___(){const t=this._fieldOfView.length;this.minimumX=t>0?this._fieldOfView[0]:-1,this.minimumY=t>1?this._fieldOfView[1]:-1,this.maximumX=t>2?this._fieldOfView[2]:1,this.maximumY=t>3?this._fieldOfView[3]:1,this.sizeX=this.maximumX-this.minimumX,this.sizeY=this.maximumY-this.minimumY},getMinimumX(){return this.minimumX},getMinimumY(){return this.minimumY},getMaximumX(){return this.maximumX},getMaximumY(){return this.maximumY},getSizeX(){return this.sizeX},getSizeY(){return this.sizeY},getLights:()=>R}),Object.defineProperties(A,{typeName:{value:"TextureProjectorParallel",enumerable:!0},componentInfo:{value:Object.freeze({name:"TextureProjection",level:2}),enumerable:!0},containerField:{value:"children",enumerable:!0},specificationRange:{value:Object.freeze({from:"4.0",to:"Infinity"}),enumerable:!0},fieldDefinitions:{value:new(u())([new(o())(_().inputOutput,"metadata",new(n().SFNode)),new(o())(_().inputOutput,"description",new(n().SFString)),new(o())(_().inputOutput,"global",new(n().SFBool)(!0)),new(o())(_().inputOutput,"on",new(n().SFBool)(!0)),new(o())(_().inputOutput,"color",new(n().SFColor)(1,1,1)),new(o())(_().inputOutput,"intensity",new(n().SFFloat)(1)),new(o())(_().inputOutput,"ambientIntensity",new(n().SFFloat)),new(o())(_().inputOutput,"location",new(n().SFVec3f)),new(o())(_().inputOutput,"direction",new(n().SFVec3f)(0,0,1)),new(o())(_().inputOutput,"upVector",new(n().SFVec3f)(0,0,1)),new(o())(_().inputOutput,"fieldOfView",new(n().MFFloat)(-1,-1,1,1)),new(o())(_().inputOutput,"nearDistance",new(n().SFFloat)(-1)),new(o())(_().inputOutput,"farDistance",new(n().SFFloat)(-1)),new(o())(_().outputOnly,"aspectRatio",new(n().SFFloat)),new(o())(_().inputOutput,"texture",new(n().SFNode)),new(o())(_().inputOutput,"shadows",new(n().SFBool)),new(o())(_().inputOutput,"shadowColor",new(n().SFColor)),new(o())(_().inputOutput,"shadowIntensity",new(n().SFFloat)(1)),new(o())(_().inputOutput,"shadowBias",new(n().SFFloat)(.005)),new(o())(_().initializeOnly,"shadowMapSize",new(n().SFInt32)(1024))]),enumerable:!0}});const C=A,Y=F().add("TextureProjectorParallel",C);i().add({name:"TextureProjection",concreteNodes:[E,Y],abstractNodes:[D]});F().add("TextureProjection",undefined)})();