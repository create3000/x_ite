/* X_ITE v12.2.4 */
const t=window[Symbol.for("X_ITE.X3D-12.2.4")];(()=>{var e={n:t=>{var i=t&&t.__esModule?()=>t.default:()=>t;return e.d(i,{a:i}),i},d:(t,i)=>{for(var r in i)e.o(i,r)&&!e.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:i[r]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e)};const i=t.Components;var r=e.n(i);const n=t.Fields;var a=e.n(n);const o=t.X3DFieldDefinition;var s=e.n(o);const u=t.FieldDefinitionArray;var h=e.n(u);const l=t.X3DNode;var c=e.n(l);const p=t.X3DLightNode;var g=e.n(p);const x=t.X3DConstants;var w=e.n(x);const m=t.X3DCast;var d=e.n(m);const f=t.Matrix4;var _=e.n(f);const O=t.Namespace;var S=e.n(O);function F(t){g().call(this,t),this.addType(w().X3DTextureProjectorNode),this._location.setUnit("length"),this._nearDistance.setUnit("length"),this._farDistance.setUnit("length"),this._location.setUnit("length")}Object.assign(Object.setPrototypeOf(F.prototype,g().prototype),{initialize(){g().prototype.initialize.call(this),this._nearDistance.addInterest("set_nearDistance__",this),this._farDistance.addInterest("set_farDistance__",this),this._texture.addInterest("set_texture__",this),this.set_nearDistance__(),this.set_farDistance__(),this.set_texture__()},getLightKey(){return this.lightKey},getGlobal(){return this._global.getValue()},getLocation(){return this._location.getValue()},getDirection(){return this._direction.getValue()},getNearDistance(){return this.nearDistance},getNearParameter(){return this.nearParameter},getFarDistance(){return this.farDistance},getFarParameter(){return this.farParameter},getTexture(){return this.textureNode},getBiasMatrix:(()=>{const t=new(_())(.5,0,0,0,0,.5,0,0,0,0,.5,0,.5,.5,.5,1);return function(){return t}})(),straightenHorizon(t){return t.straighten(this._upVector.getValue())},set_nearDistance__(){const t=this._nearDistance.getValue();this.nearDistance=t<0?.125:t,this.nearParameter=t<0?0:-1},set_farDistance__(){const t=this._farDistance.getValue();this.farDistance=t<0?1e5:t,this.farParameter=t<0?1:2},set_texture__(){this.textureNode?.removeInterest("set_textureNode__",this),this.textureNode=d()(w().X3DTexture2DNode,this._texture),this.textureNode?.addInterest("set_textureNode__",this),this.setEnabled(!!this.textureNode),this.set_textureNode__(),this.set_on__()},set_textureNode__(){this.lightKey=`[3.${this.textureNode?.isLinear()?1:0}]`,this.textureNode?this._aspectRatio=this.textureNode.getWidth()/this.textureNode.getHeight():this._aspectRatio=1}}),Object.defineProperties(F,c().getStaticProperties("X3DTextureProjectorNode","TextureProjection",4));const T=F,M=S().add("X3DTextureProjectorNode",T),y=t.Camera;var V=e.n(y);const b=t.Vector3;var P=e.n(b);const D=t.Rotation4;var j=e.n(D);const v=t.MatrixStack;var N=e.n(v);const X=t.ObjectCache;var I=e.n(X);const A=I()(z);function z(){this.projectionMatrix=new(_()),this.modelViewMatrix=new(N())(_()),this.modelMatrix=new(_()),this.invTextureSpaceMatrix=new(_()),this.invTextureSpaceProjectionMatrix=new(_()),this.location=new(P()),this.locationArray=new Float32Array(3),this.direction=new(P()),this.rotation=new(j()),this.matrix=new(_()),this.matrixArray=new Float32Array(16),this.textureMatrix=new(_())}function R(t){M.call(this,t),this.addType(w().TextureProjector),this._fieldOfView.setUnit("angle")}Object.assign(z.prototype,{set(t,e,i){this.browser=t.getBrowser(),this.lightNode=t,this.global=t.getGlobal(),this.modelViewMatrix.push(i),this.textureMatrix.assign(t.getTexture().getMatrix())},renderShadowMap(t){const e=this.lightNode,i=t.getCameraSpaceMatrixArray(),r=this.modelMatrix.assign(this.modelViewMatrix.get()).multRight(i),n=this.invTextureSpaceMatrix.assign(this.global?r:_().IDENTITY);this.rotation.setFromToVec(P().Z_AXIS,this.direction.assign(e.getDirection()).negate()),e.straightenHorizon(this.rotation),n.translate(e.getLocation()),n.rotate(this.rotation),n.inverse();const a=e.getTexture().getWidth(),o=e.getTexture().getHeight(),s=e.getNearDistance(),u=e.getFarDistance(),h=e.getFieldOfView();V().perspective(h,s,u,a,o,this.projectionMatrix),this.global||n.multLeft(r.inverse()),this.invTextureSpaceProjectionMatrix.assign(n).multRight(this.projectionMatrix).multRight(e.getBiasMatrix()).multRight(this.textureMatrix),this.modelViewMatrix.get().multVecMatrix(this.location.assign(e._location.getValue())),this.locationArray.set(this.location)},setGlobalVariables(t){this.matrix.assign(t.getView()?.inverse??_().IDENTITY).multRight(t.getCameraSpaceMatrixArray()).multRight(this.invTextureSpaceProjectionMatrix),this.matrixArray.set(this.matrix)},setShaderUniforms(t,e,i){const r=e.numTextureProjectors++,n=e.x3d_TextureProjector[r];if(!n)return;const a=this.lightNode,o=a.getTexture(),s=this.global?this.textureUnit??=this.browser.popGlobalTextureUnit():this.browser.popTextureUnit();if(t.activeTexture(t.TEXTURE0+s),t.bindTexture(t.TEXTURE_2D,o.getTexture()),t.uniform1i(n.texture,s),e.hasTextureProjector(r,this))return;const u=a.getNearParameter(),h=a.getFarParameter();t.uniform3f(n.color,...a.getColor()),t.uniform1f(n.intensity,a.getIntensity()),t.uniform3fv(n.location,this.locationArray),t.uniform2f(n.params,u,h),t.uniformMatrix4fv(n.matrix,!1,this.matrixArray)},dispose(){this.global&&(this.textureUnit=void 0),this.modelViewMatrix.clear(),A.push(this)}}),Object.assign(Object.setPrototypeOf(R.prototype,M.prototype),{initialize(){M.prototype.initialize.call(this)},getFieldOfView(){const t=this._fieldOfView.getValue();return t>0&&t<Math.PI?t:Math.PI/4},getLights:()=>A}),Object.defineProperties(R,{...c().getStaticProperties("TextureProjector","TextureProjection",2,"children","4.0"),fieldDefinitions:{value:new(h())([new(s())(w().inputOutput,"metadata",new(a().SFNode)),new(s())(w().inputOutput,"description",new(a().SFString)),new(s())(w().inputOutput,"global",new(a().SFBool)(!0)),new(s())(w().inputOutput,"on",new(a().SFBool)(!0)),new(s())(w().inputOutput,"color",new(a().SFColor)(1,1,1)),new(s())(w().inputOutput,"intensity",new(a().SFFloat)(1)),new(s())(w().inputOutput,"ambientIntensity",new(a().SFFloat)),new(s())(w().inputOutput,"location",new(a().SFVec3f)),new(s())(w().inputOutput,"direction",new(a().SFVec3f)(0,0,1)),new(s())(w().inputOutput,"upVector",new(a().SFVec3f)(0,0,1)),new(s())(w().inputOutput,"fieldOfView",new(a().SFFloat)(.785398)),new(s())(w().inputOutput,"nearDistance",new(a().SFFloat)(-1)),new(s())(w().inputOutput,"farDistance",new(a().SFFloat)(-1)),new(s())(w().outputOnly,"aspectRatio",new(a().SFFloat)),new(s())(w().inputOutput,"texture",new(a().SFNode)),new(s())(w().inputOutput,"shadows",new(a().SFBool)),new(s())(w().inputOutput,"shadowColor",new(a().SFColor)),new(s())(w().inputOutput,"shadowIntensity",new(a().SFFloat)(1)),new(s())(w().inputOutput,"shadowBias",new(a().SFFloat)(.005)),new(s())(w().initializeOnly,"shadowMapSize",new(a().SFInt32)(1024))]),enumerable:!0}});const U=R,C=S().add("TextureProjector",U),Y=I()(E);function E(){this.projectionMatrix=new(_()),this.modelViewMatrix=new(N())(_()),this.modelMatrix=new(_()),this.invTextureSpaceMatrix=new(_()),this.location=new(P()),this.locationArray=new Float32Array(3),this.invTextureSpaceProjectionMatrix=new(_()),this.direction=new(P()),this.rotation=new(j()),this.matrix=new(_()),this.matrixArray=new Float32Array(16),this.textureMatrix=new(_())}function B(t){M.call(this,t),this.addType(w().TextureProjectorParallel),this._fieldOfView.setUnit("length")}Object.assign(E.prototype,{set(t,e,i){this.browser=t.getBrowser(),this.lightNode=t,this.global=t.getGlobal(),this.modelViewMatrix.push(i),this.textureMatrix.assign(t.getTexture().getMatrix())},renderShadowMap(t){const e=this.lightNode,i=t.getCameraSpaceMatrixArray(),r=this.modelMatrix.assign(this.modelViewMatrix.get()).multRight(i),n=this.invTextureSpaceMatrix.assign(this.global?r:_().IDENTITY);this.rotation.setFromToVec(P().Z_AXIS,this.direction.assign(e.getDirection()).negate()),e.straightenHorizon(this.rotation),n.translate(e.getLocation()),n.rotate(this.rotation),n.inverse();const a=e.getTexture().getWidth()/e.getTexture().getHeight(),o=e.getMinimumX(),s=e.getMaximumX(),u=e.getMinimumY(),h=e.getMaximumY(),l=e.getSizeX(),c=e.getSizeY(),p=e.getNearDistance(),g=e.getFarDistance();if(a>l/c){const t=(o+s)/2,e=c*a/2;V().ortho(t-e,t+e,u,h,p,g,this.projectionMatrix)}else{const t=(u+h)/2,e=l/a/2;V().ortho(o,s,t-e,t+e,p,g,this.projectionMatrix)}this.global||n.multLeft(r.inverse()),this.invTextureSpaceProjectionMatrix.assign(n).multRight(this.projectionMatrix).multRight(e.getBiasMatrix()).multRight(this.textureMatrix),this.modelViewMatrix.get().multVecMatrix(this.location.assign(e._location.getValue())),this.locationArray.set(this.location)},setGlobalVariables(t){this.matrix.assign(t.getView()?.inverse??_().IDENTITY).multRight(t.getCameraSpaceMatrixArray()).multRight(this.invTextureSpaceProjectionMatrix),this.matrixArray.set(this.matrix)},setShaderUniforms(t,e,i){const r=e.numTextureProjectors++,n=e.x3d_TextureProjector[r];if(!n)return;const a=this.lightNode,o=a.getTexture(),s=this.global?this.textureUnit??=this.browser.popGlobalTextureUnit():this.browser.popTextureUnit();if(t.activeTexture(t.TEXTURE0+s),t.bindTexture(t.TEXTURE_2D,o.getTexture()),t.uniform1i(n.texture,s),e.hasTextureProjector(r,this))return;const u=a.getNearParameter(),h=a.getFarParameter();t.uniform3f(n.color,...a.getColor()),t.uniform1f(n.intensity,a.getIntensity()),t.uniform3fv(n.location,this.locationArray),t.uniform2f(n.params,u,h),t.uniformMatrix4fv(n.matrix,!1,this.matrixArray)},dispose(){this.global&&(this.textureUnit=void 0),this.modelViewMatrix.clear(),Y.push(this)}}),Object.assign(Object.setPrototypeOf(B.prototype,M.prototype),{initialize(){M.prototype.initialize.call(this),this._fieldOfView.addInterest("set_fieldOfView___",this),this.set_fieldOfView___()},set_fieldOfView___(){this.minimumX=this._fieldOfView[0],this.minimumY=this._fieldOfView[1],this.maximumX=this._fieldOfView[2],this.maximumY=this._fieldOfView[3],this.sizeX=this.maximumX-this.minimumX,this.sizeY=this.maximumY-this.minimumY},getMinimumX(){return this.minimumX},getMinimumY(){return this.minimumY},getMaximumX(){return this.maximumX},getMaximumY(){return this.maximumY},getSizeX(){return this.sizeX},getSizeY(){return this.sizeY},getLights:()=>Y}),Object.defineProperties(B,{...c().getStaticProperties("TextureProjectorParallel","TextureProjection",2,"children","4.0"),fieldDefinitions:{value:new(h())([new(s())(w().inputOutput,"metadata",new(a().SFNode)),new(s())(w().inputOutput,"description",new(a().SFString)),new(s())(w().inputOutput,"global",new(a().SFBool)(!0)),new(s())(w().inputOutput,"on",new(a().SFBool)(!0)),new(s())(w().inputOutput,"color",new(a().SFColor)(1,1,1)),new(s())(w().inputOutput,"intensity",new(a().SFFloat)(1)),new(s())(w().inputOutput,"ambientIntensity",new(a().SFFloat)),new(s())(w().inputOutput,"location",new(a().SFVec3f)),new(s())(w().inputOutput,"direction",new(a().SFVec3f)(0,0,1)),new(s())(w().inputOutput,"upVector",new(a().SFVec3f)(0,0,1)),new(s())(w().inputOutput,"fieldOfView",new(a().SFVec4f)(-1,-1,1,1)),new(s())(w().inputOutput,"nearDistance",new(a().SFFloat)(-1)),new(s())(w().inputOutput,"farDistance",new(a().SFFloat)(-1)),new(s())(w().outputOnly,"aspectRatio",new(a().SFFloat)),new(s())(w().inputOutput,"texture",new(a().SFNode)),new(s())(w().inputOutput,"shadows",new(a().SFBool)),new(s())(w().inputOutput,"shadowColor",new(a().SFColor)),new(s())(w().inputOutput,"shadowIntensity",new(a().SFFloat)(1)),new(s())(w().inputOutput,"shadowBias",new(a().SFFloat)(.005)),new(s())(w().initializeOnly,"shadowMapSize",new(a().SFInt32)(1024))]),enumerable:!0}});const L=B,G=S().add("TextureProjectorParallel",L);r().add({name:"TextureProjection",concreteNodes:[C,G],abstractNodes:[M]});S().add("TextureProjectionComponent",undefined)})();