/* X_ITE v10.1.0 */(()=>{"use strict";var e={823:e=>{e.exports=window[Symbol.for("X_ITE.X3D-10.1.0")].require("lib/jquery")}},t={};function r(i){var a=t[i];if(void 0!==a)return a.exports;var n=t[i]={exports:{}};return e[i](n,n.exports,r),n.exports}r.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return r.d(t,{a:t}),t},r.d=(e,t)=>{for(var i in t)r.o(t,i)&&!r.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);const i=window[Symbol.for("X_ITE.X3D-10.1.0")].require("x_ite/Components");var a=r.n(i);const n=window[Symbol.for("X_ITE.X3D-10.1.0")].require("x_ite/Namespace");var s=r.n(n);const o="\nprecision highp float;precision highp int;precision highp sampler2D;const float M_PI=3.1415926535897932384626433832795;varying vec2 texCoord;uniform sampler2D x3d_PanoramaTexture;uniform int x3d_CurrentFace;vec3 uvToXYZ(const in int face,const in vec2 uv){vec3 xyz;if(face==0)xyz=vec3(1.0,uv.y,uv.x);else if(face==1)xyz=vec3(-1.0,uv.y,-uv.x);else if(face==2)xyz=vec3(uv.x,uv.y,-1.0);else if(face==3)xyz=vec3(-uv.x,uv.y,1.0);else if(face==4)xyz=vec3(uv.y,-1.0,uv.x);else xyz=vec3(-uv.y,1.0,uv.x);return xyz;}vec2 dirToUV(const in vec3 dir){return vec2(0.5+0.5*atan(dir.z,dir.x)/M_PI,1.0-acos(dir.y)/M_PI);}vec3 panoramaToCubeMap(const in int face,const in vec2 texCoord){vec3 scan=uvToXYZ(face,texCoord);vec3 direction=normalize(scan);vec2 src=dirToUV(direction);return texture2D(x3d_PanoramaTexture,src).rgb;}void main(){gl_FragColor=vec4(panoramaToCubeMap(x3d_CurrentFace,texCoord),1.0);}";s().add("Panorama1.fs","x_ite/Browser/CubeMapTexturing/Panorama1.fs",o);const u=o,d="#version 300 es\nprecision highp float;precision highp int;precision highp sampler2D;const float M_PI=3.1415926535897932384626433832795;in vec2 texCoord;out vec4 x3d_FragColor;uniform sampler2D x3d_PanoramaTexture;uniform int x3d_CurrentFace;vec3 uvToXYZ(const in int face,const in vec2 uv){switch(face){case 0:return vec3(1.0,uv.y,uv.x);case 1:return vec3(-1.0,uv.y,-uv.x);case 2:return vec3(uv.x,uv.y,-1.0);case 3:return vec3(-uv.x,uv.y,1.0);case 4:return vec3(uv.y,-1.0,uv.x);default:return vec3(-uv.y,1.0,uv.x);}}vec2 dirToUV(const in vec3 dir){return vec2(0.5+0.5*atan(dir.z,dir.x)/M_PI,1.0-acos(dir.y)/M_PI);}vec3 panoramaToCubeMap(const in int face,const in vec2 texCoord){vec3 scan=uvToXYZ(face,texCoord);vec3 direction=normalize(scan);vec2 src=dirToUV(direction);return texture(x3d_PanoramaTexture,src).rgb;}void main(){x3d_FragColor=vec4(panoramaToCubeMap(x3d_CurrentFace,texCoord),1.0);}";s().add("Panorama2.fs","x_ite/Browser/CubeMapTexturing/Panorama2.fs",d);const h=d,T=Symbol();function c(){}Object.assign(c.prototype,{getPanoramaShader(){return this[T]?this[T]:this[T]=this.createShader("Panorama","FullScreen","data:x-shader/x-fragment,"+["",u,h][this.getContext().getVersion()],[],["x3d_PanoramaTexture","x3d_CurrentFace"])}});const p=c;s().add("X3DCubeMapTexturingContext","x_ite/Browser/CubeMapTexturing/X3DCubeMapTexturingContext",p);const x=p,l=window[Symbol.for("X_ITE.X3D-10.1.0")].require("x_ite/Fields");var g=r.n(l);const _=window[Symbol.for("X_ITE.X3D-10.1.0")].require("x_ite/Base/X3DFieldDefinition");var m=r.n(_);const f=window[Symbol.for("X_ITE.X3D-10.1.0")].require("x_ite/Base/FieldDefinitionArray");var E=r.n(f);const b=window[Symbol.for("X_ITE.X3D-10.1.0")].require("x_ite/Components/Texturing/X3DSingleTextureNode");var w=r.n(b);const v=window[Symbol.for("X_ITE.X3D-10.1.0")].require("x_ite/Base/X3DConstants");var y=r.n(v);function M(e){w().call(this,e),this.addType(y().X3DEnvironmentTextureNode);const t=this.getBrowser().getContext();this.target=t.TEXTURE_CUBE_MAP,this.targets=[t.TEXTURE_CUBE_MAP_POSITIVE_Z,t.TEXTURE_CUBE_MAP_NEGATIVE_Z,t.TEXTURE_CUBE_MAP_NEGATIVE_X,t.TEXTURE_CUBE_MAP_POSITIVE_X,t.TEXTURE_CUBE_MAP_POSITIVE_Y,t.TEXTURE_CUBE_MAP_NEGATIVE_Y],this.size=1}Object.assign(Object.setPrototypeOf(M.prototype,w().prototype),{getTarget(){return this.target},getTextureType:()=>4,getTargets(){return this.targets},getSize(){return this.size},setSize(e){this.size=e},clearTexture:(()=>{const e=new Uint8Array([255,255,255,255]);return function(){const t=this.getBrowser().getContext();t.bindTexture(this.getTarget(),this.getTexture());for(const r of this.getTargets())t.texImage2D(r,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,e);this.setSize(1),this.setTransparent(!1),this.updateTextureParameters()}})(),updateTextureParameters(){w().prototype.updateTextureParameters.call(this,this.target,this._textureProperties.getValue(),this.texturePropertiesNode,this.size,this.size,!1,!1,!1)},setShaderUniforms(e,t,r,i=t.x3d_Texture[0]){const a=this.getBrowser().getTextureCubeUnit();e.activeTexture(e.TEXTURE0+a),e.bindTexture(e.TEXTURE_CUBE_MAP,this.getTexture()),e.uniform1i(i.textureCube,a)}}),Object.defineProperties(M,{typeName:{value:"X3DEnvironmentTextureNode",enumerable:!0},componentInfo:{value:Object.freeze({name:"CubeMapTexturing",level:1}),enumerable:!0}});const C=M;s().add("X3DEnvironmentTextureNode","x_ite/Components/CubeMapTexturing/X3DEnvironmentTextureNode",C);const R=C,S=window[Symbol.for("X_ITE.X3D-10.1.0")].require("x_ite/Base/X3DCast");var I=r.n(S);const X=window[Symbol.for("X_ITE.X3D-10.1.0")].require("standard/Utility/BitSet");var D=r.n(X);function U(e){R.call(this,e),this.addType(y().ComposedCubeMapTexture),this.addChildObjects(y().inputOutput,"update",new(g().SFTime)),e.getSpecificationVersion()<=3.3&&(this.addAlias("front",this._frontTexture),this.addAlias("back",this._backTexture),this.addAlias("left",this._leftTexture),this.addAlias("right",this._rightTexture),this.addAlias("top",this._topTexture),this.addAlias("bottom",this._bottomTexture)),this.textureNodes=[null,null,null,null,null,null],this.textureBits=new(D())}Object.assign(Object.setPrototypeOf(U.prototype,R.prototype),{initialize(){R.prototype.initialize.call(this);const e=this.getBrowser().getContext();this.frameBuffer=e.createFramebuffer(),this.clearTexture(),this._frontTexture.addInterest("set_texture__",this,0),this._backTexture.addInterest("set_texture__",this,1),this._leftTexture.addInterest("set_texture__",this,2),this._rightTexture.addInterest("set_texture__",this,3),this._topTexture.addInterest("set_texture__",this,5),this._bottomTexture.addInterest("set_texture__",this,4),this._update.addInterest("update",this),this.set_texture__(0,this._frontTexture),this.set_texture__(1,this._backTexture),this.set_texture__(2,this._leftTexture),this.set_texture__(3,this._rightTexture),this.set_texture__(4,this._topTexture),this.set_texture__(5,this._bottomTexture)},set_texture__(e,t){let r=this.textureNodes[e];r?.removeInterest(`set_loadState${e}__`,this),r=this.textureNodes[e]=I()(y().X3DTexture2DNode,t),r?.addInterest(`set_loadState${e}__`,this,e,r),this.set_loadState__(e,r)},set_loadState__(e,t){this.setTextureBit(e,t?.checkLoadState()),this._update.addEvent()},setTextureBit(e,t){this.textureBits.set(e,t===y().COMPLETE_STATE)},isComplete(){if(63!=+this.textureBits)return!1;const e=this.textureNodes,t=e[0].getWidth();for(const r of e){if(r.getWidth()!==t)return!1;if(r.getHeight()!==t)return!1}return!0},update(){if(this.isComplete()){const e=this.getBrowser().getContext(),t=this.textureNodes,r=t[0].getWidth();if(r!==this.getSize()){const t=new Uint8Array(r*r*4);e.bindTexture(this.getTarget(),this.getTexture());for(let i=0;i<6;++i)e.texImage2D(this.getTargets()[i],0,e.RGBA,r,r,0,e.RGBA,e.UNSIGNED_BYTE,t);this.setSize(r),this.updateTextureParameters()}e.bindFramebuffer(e.FRAMEBUFFER,this.frameBuffer);for(let i=0;i<6;++i){const a=t[i];if(e.bindTexture(e.TEXTURE_2D,a.getTexture()),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,a.getTexture(),0),e.bindTexture(this.getTarget(),this.getTexture()),1===a.getTextureType())e.copyTexSubImage2D(this.getTargets()[i],0,0,0,0,0,r,r);else for(let t=0;t<r;++t)e.copyTexSubImage2D(this.getTargets()[i],0,0,r-t-1,0,t,r,1)}this.setTransparent(t.some((e=>e.isTransparent()))),this.setLinear(t.some((e=>e.isLinear()))),this.setMipMaps(t.every((e=>e.canMipMaps()))),this.updateTextureParameters()}else this.clearTexture()}}),Object.defineProperties(U,{typeName:{value:"ComposedCubeMapTexture",enumerable:!0},componentInfo:{value:Object.freeze({name:"CubeMapTexturing",level:1}),enumerable:!0},containerField:{value:"texture",enumerable:!0},specificationRange:{value:Object.freeze({from:"3.1",to:"Infinity"}),enumerable:!0},fieldDefinitions:{value:new(E())([new(m())(y().inputOutput,"metadata",new(g().SFNode)),new(m())(y().inputOutput,"description",new(g().SFString)),new(m())(y().inputOutput,"frontTexture",new(g().SFNode)),new(m())(y().inputOutput,"backTexture",new(g().SFNode)),new(m())(y().inputOutput,"leftTexture",new(g().SFNode)),new(m())(y().inputOutput,"rightTexture",new(g().SFNode)),new(m())(y().inputOutput,"topTexture",new(g().SFNode)),new(m())(y().inputOutput,"bottomTexture",new(g().SFNode)),new(m())(y().initializeOnly,"textureProperties",new(g().SFNode))]),enumerable:!0}});for(let e=0;e<6;++e)U.prototype[`set_loadState${e}__`]=function(e,t){this.set_loadState__(e,t)};const O=U;s().add("ComposedCubeMapTexture","x_ite/Components/CubeMapTexturing/ComposedCubeMapTexture",O);const A=O,P=window[Symbol.for("X_ITE.X3D-10.1.0")].require("x_ite/Base/X3DBaseNode");var B=r.n(P);const N=window[Symbol.for("X_ITE.X3D-10.1.0")].require("x_ite/Rendering/X3DRenderObject");var F=r.n(N);const z=window[Symbol.for("X_ITE.X3D-10.1.0")].require("x_ite/Rendering/TraverseType");var L=r.n(z);function V(e,t,r){B().call(this,e),F().call(this,e),this.node=r,this.renderObject=t}Object.assign(Object.setPrototypeOf(V.prototype,B().prototype),F().prototype,{initialize(){B().prototype.initialize.call(this),F().prototype.initialize.call(this)},isIndependent:()=>!1,getNode(){return this.node},getLayer(){return this.renderObject.getLayer()},getBackground(){return this.renderObject.getBackground()},getFog(){return this.renderObject.getFog()},getNavigationInfo(){return this.renderObject.getNavigationInfo()},getViewpoint(){return this.renderObject.getViewpoint()},getViewpointStack(){return this.renderObject.getViewpointStack()},getLightContainer(){return this.renderObject.getLights()[this.lightIndex++]},render(e,t,r){switch(e){case L().COLLISION:case L().SHADOW:F().prototype.render.call(this,e,t,r);break;case L().DISPLAY:this.lightIndex=0,F().prototype.render.call(this,e,t,r);for(const e of this.renderObject.getLights())e.modelViewMatrix.pop()}}});for(const e of Object.keys(V.prototype))Object.defineProperty(V.prototype,e,{enumerable:!1});const j=V;s().add("DependentRenderer","x_ite/Rendering/DependentRenderer",j);const G=j,q=window[Symbol.for("X_ITE.X3D-10.1.0")].require("x_ite/Rendering/TextureBuffer");var k=r.n(q);const Y=window[Symbol.for("X_ITE.X3D-10.1.0")].require("standard/Math/Geometry/Camera");var W=r.n(Y);const H=window[Symbol.for("X_ITE.X3D-10.1.0")].require("standard/Math/Geometry/ViewVolume");var $=r.n(H);const Z=window[Symbol.for("X_ITE.X3D-10.1.0")].require("standard/Math/Numbers/Rotation4");var K=r.n(Z);const J=window[Symbol.for("X_ITE.X3D-10.1.0")].require("standard/Math/Numbers/Vector3");var Q=r.n(J);const ee=window[Symbol.for("X_ITE.X3D-10.1.0")].require("standard/Math/Numbers/Vector4");var te=r.n(ee);const re=window[Symbol.for("X_ITE.X3D-10.1.0")].require("standard/Math/Numbers/Matrix4");var ie=r.n(re);const ae=window[Symbol.for("X_ITE.X3D-10.1.0")].require("standard/Math/Algorithm");var ne=r.n(ae);function se(e){R.call(this,e),this.addType(y().GeneratedCubeMapTexture),this.dependentRenderers=new WeakMap,this.projectionMatrix=new(ie()),this.modelMatrix=new(ie()),this.viewVolume=new($())}Object.assign(Object.setPrototypeOf(se.prototype,R.prototype),{initialize(){R.prototype.initialize.call(this),this._size.addInterest("set_size__",this),this.set_size__()},set_size__(){const e=this.getBrowser().getContext(),t=e.getVersion()>=2?this._size.getValue():ne().nextPowerOfTwo(this._size.getValue());if(t>0){const r=new Uint8Array(t*t*4);e.bindTexture(this.getTarget(),this.getTexture());for(const i of this.getTargets())e.texImage2D(i,0,e.RGBA,t,t,0,e.RGBA,e.UNSIGNED_BYTE,r);this.updateTextureParameters(),this.viewport=new(te())(0,0,t,t),this.frameBuffer=new(k())(this.getBrowser(),t,t),this.setSize(t)}else this.frameBuffer=null,this.setSize(0)},traverse(e,t){"NONE"!==this._update.getValue()&&t.isIndependent()&&this.frameBuffer&&(t.getGeneratedCubeMapTextures().push(this),this.modelMatrix.assign(t.getModelViewMatrix().get()).multRight(t.getCameraSpaceMatrix().get()))},renderTexture:(()=>{const e=[new(K())(Q().zAxis,new(Q())(0,0,-1)),new(K())(Q().zAxis,new(Q())(0,0,1)),new(K())(Q().zAxis,new(Q())(1,0,0)),new(K())(Q().zAxis,new(Q())(-1,0,0)),new(K())(Q().zAxis,new(Q())(0,-1,0)),new(K())(Q().zAxis,new(Q())(0,1,0))],t=[new(Q())(-1,-1,1),new(Q())(-1,-1,1),new(Q())(-1,-1,1),new(Q())(-1,-1,1),new(Q())(1,1,1),new(Q())(1,1,1)],r=new(ie());return function(i){if(!this.dependentRenderers.has(i)){const e=new G(this.getExecutionContext(),i,this);e.setup(),this.dependentRenderers.set(i,e)}const a=this.dependentRenderers.get(i),n=this.getBrowser(),s=i.getLayer(),o=n.getContext(),u=a.getBackground(),d=a.getNavigationInfo(),h=a.getViewpoint(),T=n.getHeadlight(),c=d._headlight.getValue(),p=d.getNearValue(),x=d.getFarValue(h),l=W().perspective(ne().radians(90),p,x,1,1,this.projectionMatrix),g=this.frameBuffer.getWidth(),_=this.frameBuffer.getHeight();this.setTransparent(u.isTransparent()),this.frameBuffer.bind(),a.getViewVolumes().push(this.viewVolume.set(l,this.viewport,this.viewport)),a.getProjectionMatrix().pushMatrix(l),o.bindTexture(this.getTarget(),this.getTexture());for(let i=0;i<6;++i)o.clear(o.COLOR_BUFFER_BIT),a.getCameraSpaceMatrix().pushMatrix(this.modelMatrix),a.getCameraSpaceMatrix().rotate(e[i]),a.getCameraSpaceMatrix().scale(t[i]),a.getViewMatrix().pushMatrix(r.assign(a.getCameraSpaceMatrix().get()).inverse()),a.getModelViewMatrix().pushMatrix(r),c&&(T.modelViewMatrix.pushMatrix(r),T.modelViewMatrix.multLeft(h.getCameraSpaceMatrix())),s.traverse(L().DISPLAY,a),c&&T.modelViewMatrix.pop(),a.getModelViewMatrix().pop(),a.getCameraSpaceMatrix().pop(),a.getViewMatrix().pop(),o.bindTexture(this.getTarget(),this.getTexture()),o.copyTexSubImage2D(this.getTargets()[i],0,0,0,0,0,g,_);this.updateTextureParameters(),a.getProjectionMatrix().pop(),a.getViewVolumes().pop(),"NEXT_FRAME_ONLY"===this._update.getValue()&&(this._update="NONE")}})(),setShaderUniforms:(()=>{const e=new Float32Array(16);return function(t,r,i,a){R.prototype.setShaderUniforms.call(this,t,r,i,a),i.getNode()===this&&t.uniformMatrix4fv(r.x3d_ModelViewMatrix,!1,e)}})()}),Object.defineProperties(se,{typeName:{value:"GeneratedCubeMapTexture",enumerable:!0},componentInfo:{value:Object.freeze({name:"CubeMapTexturing",level:3}),enumerable:!0},containerField:{value:"texture",enumerable:!0},specificationRange:{value:Object.freeze({from:"3.0",to:"Infinity"}),enumerable:!0},fieldDefinitions:{value:new(E())([new(m())(y().inputOutput,"metadata",new(g().SFNode)),new(m())(y().inputOutput,"description",new(g().SFString)),new(m())(y().inputOutput,"update",new(g().SFString)("NONE")),new(m())(y().initializeOnly,"size",new(g().SFInt32)(128)),new(m())(y().initializeOnly,"textureProperties",new(g().SFNode))]),enumerable:!0}});const oe=se;s().add("GeneratedCubeMapTexture","x_ite/Components/CubeMapTexturing/GeneratedCubeMapTexture",oe);const ue=oe,de=window[Symbol.for("X_ITE.X3D-10.1.0")].require("x_ite/Components/Networking/X3DUrlObject");var he=r.n(de);const Te=window[Symbol.for("X_ITE.X3D-10.1.0")].require("standard/Math/Numbers/Vector2");var ce=r.n(Te);const pe=window[Symbol.for("X_ITE.X3D-10.1.0")].require("x_ite/DEVELOPMENT");var xe=r.n(pe),le=r(823);const ge=new Uint8Array([255,255,255,255]);function _e(e){R.call(this,e),he().call(this,e),this.addType(y().ImageCubeMapTexture),this.image=le("<img></img>"),this.urlStack=new(g().MFString)}Object.assign(Object.setPrototypeOf(_e.prototype,R.prototype),he().prototype,{initialize(){R.prototype.initialize.call(this),he().prototype.initialize.call(this);const e=this.getBrowser().getContext();e.bindTexture(this.getTarget(),this.getTexture());for(let t=0;t<6;++t)e.texImage2D(this.getTargets()[t],0,e.RGBA,1,1,0,e.RGBA,e.UNSIGNED_BYTE,ge);this.image.on("load",this.setImage.bind(this)),this.image.on("abort error",this.setError.bind(this)),this.image.prop("crossOrigin","Anonymous"),this.requestImmediateLoad().catch(Function.prototype)},unloadData(){this.clearTexture()},loadData(){this.urlStack.setValue(this._url),this.loadNext()},loadNext(){if(0===this.urlStack.length)return this.clearTexture(),void this.setLoadState(y().FAILED_STATE);this.URL=new URL(this.urlStack.shift(),this.getExecutionContext().getBaseURL()),this.URL.pathname.match(/\.ktx2?(?:\.gz)?$/)||this.URL.href.match(/^data:image\/ktx2[;,]/)?(this.setLinear(!0),this.setMipMaps(!1),this.getBrowser().getKTXDecoder().then((e=>e.loadKTXFromURL(this.URL,this.getCache()))).then((e=>this.setKTXTexture(e))).catch((e=>this.setError({type:e.message})))):(this.setLinear(!1),this.setMipMaps(!0),"data:"!==this.URL.protocol&&(this.getCache()||this.URL.searchParams.set("_",Date.now())),this.image.attr("src",this.URL.href))},setError(e){"data:"!==this.URL.protocol&&console.warn(`Error loading image '${decodeURI(this.URL.href)}'`,e.type),this.loadNext()},setKTXTexture(e){if(e.target!==this.getTarget())return this.setError({type:"Invalid KTX texture target, must be 'TEXTURE_CUBE_MAP'."});xe()&&"data:"!==this.URL.protocol&&console.info(`Done loading image cube map texture '${decodeURI(this.URL.href)}'.`);try{this.setTexture(e),this.setTransparent(!1),this.setSize(e.baseWidth),this.updateTextureParameters(),this.setLoadState(y().COMPLETE_STATE)}catch(e){this.setError({type:e.message})}},setImage(){xe()&&"data:"!==this.URL.protocol&&console.info(`Done loading image cube map texture '${decodeURI(this.URL.href)}'.`);try{const e=this.getBrowser().getContext(),t=e.createTexture();e.bindTexture(e.TEXTURE_2D,t),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,this.image[0]),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),this.imageToCubeMap(t,this.image.prop("width"),this.image.prop("height"),!1),this.setLoadState(y().COMPLETE_STATE)}catch(e){this.setError({type:e.message})}},imageToCubeMap(e,t,r){const i=t/r;Math.abs(i-4/3)<.01&&this.skyBoxToCubeMap(e,t,r),Math.abs(i-2)<.01&&this.panoramaToCubeMap(e,t,r),this.updateTextureParameters()},skyBoxToCubeMap:function(){const e=[new(ce())(1,1),new(ce())(3,1),new(ce())(0,1),new(ce())(2,1),new(ce())(1,0),new(ce())(1,2)];return function(t,r,i){const a=this.getBrowser().getContext(),n=a.createFramebuffer(),s=Math.floor(r/4),o=Math.floor(i/3),u=new Uint8Array(s*o*4);a.bindTexture(this.getTarget(),this.getTexture());for(let e=0;e<6;++e)a.texImage2D(this.getTargets()[e],0,a.RGBA,s,o,0,a.RGBA,a.UNSIGNED_BYTE,null);a.bindFramebuffer(a.FRAMEBUFFER,n),a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,t,0);let d=!1;a.bindTexture(this.getTarget(),this.getTexture());for(let t=0;t<6;++t)a.copyTexSubImage2D(this.getTargets()[t],0,0,0,e[t].x*s,e[t].y*o,s,o),d||(a.readPixels(e[t].x*s,e[t].y*o,s,o,a.RGBA,a.UNSIGNED_BYTE,u),d=this.isImageTransparent(u));a.deleteFramebuffer(n),a.deleteTexture(t),this.setTransparent(d),this.setSize(s)}}(),panoramaToCubeMap(e,t,r){const i=this.getBrowser(),a=i.getContext(),n=i.getPanoramaShader(),s=a.createFramebuffer(),o=i.getTextureCubeUnit(),u=Math.floor(r/2),d=new Uint8Array(u*u*4);a.bindTexture(a.TEXTURE_2D,e),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,a.MIRRORED_REPEAT),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,a.MIRRORED_REPEAT),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.LINEAR),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.LINEAR),a.bindTexture(this.getTarget(),this.getTexture());for(let e=0;e<6;++e)a.texImage2D(this.getTargets()[e],0,a.RGBA,u,u,0,a.RGBA,a.UNSIGNED_BYTE,null);a.useProgram(n.getProgram()),a.activeTexture(a.TEXTURE0+o),a.bindTexture(a.TEXTURE_2D,e),a.uniform1i(n.x3d_PanoramaTexture,o),a.bindFramebuffer(a.FRAMEBUFFER,s),a.viewport(0,0,u,u),a.scissor(0,0,u,u),a.disable(a.DEPTH_TEST),a.enable(a.CULL_FACE),a.frontFace(a.CCW),a.clearColor(0,0,0,0),a.bindVertexArray(i.getFullscreenVertexArrayObject());let h=!1;for(let e=0;e<6;++e)a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,this.getTargets()[e],this.getTexture(),0),a.clear(a.COLOR_BUFFER_BIT),a.uniform1i(n.x3d_CurrentFace,e),a.drawArrays(a.TRIANGLES,0,6),h||(a.readPixels(0,0,u,u,a.RGBA,a.UNSIGNED_BYTE,d),h=this.isImageTransparent(d));a.enable(a.DEPTH_TEST),a.deleteFramebuffer(s),a.deleteTexture(e),i.resetTextureUnits(),this.setTransparent(h),this.setSize(u)},dispose(){he().prototype.dispose.call(this),R.prototype.dispose.call(this)}}),Object.defineProperties(_e,{typeName:{value:"ImageCubeMapTexture",enumerable:!0},componentInfo:{value:Object.freeze({name:"CubeMapTexturing",level:2}),enumerable:!0},containerField:{value:"texture",enumerable:!0},specificationRange:{value:Object.freeze({from:"3.0",to:"Infinity"}),enumerable:!0},fieldDefinitions:{value:new(E())([new(m())(y().inputOutput,"metadata",new(g().SFNode)),new(m())(y().inputOutput,"description",new(g().SFString)),new(m())(y().inputOutput,"load",new(g().SFBool)(!0)),new(m())(y().inputOutput,"url",new(g().MFString)),new(m())(y().inputOutput,"autoRefresh",new(g().SFTime)),new(m())(y().inputOutput,"autoRefreshTimeLimit",new(g().SFTime)(3600)),new(m())(y().initializeOnly,"textureProperties",new(g().SFNode))]),enumerable:!0}});const me=_e;s().add("ImageCubeMapTexture","x_ite/Components/CubeMapTexturing/ImageCubeMapTexture",me);const fe=me;a().add({name:"CubeMapTexturing",concreteNodes:[A,ue,fe],abstractNodes:[R],browserContext:x});const Ee=void 0;s().add("CubeMapTexturing","assets/components/CubeMapTexturing",Ee)})();