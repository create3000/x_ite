/* X_ITE v10.2.0 */
const __X_ITE_X3D__=window[Symbol.for("X_ITE.X3D-10.2.0")];(()=>{"use strict";var e={588:e=>{e.exports=__X_ITE_X3D__.require("lib/jquery")}},t={};function r(n){var i=t[n];if(void 0!==i)return i.exports;var o=t[n]={exports:{}};return e[n](o,o.exports,r),o.exports}r.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return r.d(t,{a:t}),t},r.d=(e,t)=>{for(var n in t)r.o(t,n)&&!r.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);const n=__X_ITE_X3D__.require("x_ite/Components");var i=r.n(n);const o=__X_ITE_X3D__.require("x_ite/Base/X3DBaseNode");var a=r.n(o);const s=__X_ITE_X3D__.require("x_ite/Base/X3DFieldDefinition");var _=r.n(s);const l=__X_ITE_X3D__.require("x_ite/Base/FieldDefinitionArray");var c=r.n(l);const u=__X_ITE_X3D__.require("x_ite/Base/X3DField");var d=r.n(u);const p=__X_ITE_X3D__.require("x_ite/Base/X3DArrayField");var v=r.n(p);const f=__X_ITE_X3D__.require("x_ite/Fields");var F=r.n(f);const X=__X_ITE_X3D__.require("x_ite/Browser/X3DBrowser");var h=r.n(X);const D=__X_ITE_X3D__.require("x_ite/Configuration/ComponentInfo");var x=r.n(D);const g=__X_ITE_X3D__.require("x_ite/Configuration/ComponentInfoArray");var y=r.n(g);const S=__X_ITE_X3D__.require("x_ite/Configuration/ProfileInfo");var E=r.n(S);const I=__X_ITE_X3D__.require("x_ite/Configuration/ProfileInfoArray");var m=r.n(I);const T=__X_ITE_X3D__.require("x_ite/Configuration/ConcreteNodesArray");var M=r.n(T);const w=__X_ITE_X3D__.require("x_ite/Configuration/AbstractNodesArray");var b=r.n(w);const N=__X_ITE_X3D__.require("x_ite/Configuration/UnitInfo");var O=r.n(N);const A=__X_ITE_X3D__.require("x_ite/Configuration/UnitInfoArray");var C=r.n(A);const q=__X_ITE_X3D__.require("x_ite/Execution/NamedNodesArray");var P=r.n(q);const V=__X_ITE_X3D__.require("x_ite/Execution/ImportedNodesArray");var B=r.n(V);const j=__X_ITE_X3D__.require("x_ite/Execution/X3DImportedNode");var R=r.n(j);const U=__X_ITE_X3D__.require("x_ite/Execution/ExportedNodesArray");var z=r.n(U);const L=__X_ITE_X3D__.require("x_ite/Execution/X3DExportedNode");var $=r.n(L);const G=__X_ITE_X3D__.require("x_ite/Execution/X3DExecutionContext");var k=r.n(G);const W=__X_ITE_X3D__.require("x_ite/Execution/X3DScene");var H=r.n(W);const J=__X_ITE_X3D__.require("x_ite/Prototype/ExternProtoDeclarationArray");var K=r.n(J);const Q=__X_ITE_X3D__.require("x_ite/Prototype/ProtoDeclarationArray");var Y=r.n(Q);const Z=__X_ITE_X3D__.require("x_ite/Prototype/X3DExternProtoDeclaration");var ee=r.n(Z);const te=__X_ITE_X3D__.require("x_ite/Prototype/X3DProtoDeclaration");var re=r.n(te);const ne=__X_ITE_X3D__.require("x_ite/Prototype/X3DProtoDeclarationNode");var ie=r.n(ne);const oe=__X_ITE_X3D__.require("x_ite/Routing/RouteArray");var ae=r.n(oe);const se=__X_ITE_X3D__.require("x_ite/Routing/X3DRoute");var _e=r.n(se);const le=__X_ITE_X3D__.require("x_ite/Namespace");var ce=r.n(le);const ue=function(e,t,r){return new Function("with (arguments [0])\n   {\n      return eval ((() =>\n      {\n         const sourceText = arguments [1];\n\n         delete arguments [0];\n         delete arguments [1];\n\n         arguments .length = 0;\n\n         return sourceText;\n      })\n      ());\n   }").call(e,t,r)};ce().add("evaluate","x_ite/Browser/Scripting/evaluate",ue);const de=ue,pe=__X_ITE_X3D__.require("x_ite/Components/Core/X3DChildNode");var ve=r.n(pe);const fe=__X_ITE_X3D__.require("x_ite/Components/Networking/X3DUrlObject");var Fe=r.n(fe);const Xe=__X_ITE_X3D__.require("x_ite/Base/X3DConstants");var he=r.n(Xe);function De(e){ve().call(this,e),Fe().call(this,e),this.addType(he().X3DScriptNode)}Object.assign(Object.setPrototypeOf(De.prototype,ve().prototype),Fe().prototype,{initialize(){ve().prototype.initialize.call(this),Fe().prototype.initialize.call(this)},dispose(){Fe().prototype.dispose.call(this),ve().prototype.dispose.call(this)}}),Object.defineProperties(De,{typeName:{value:"X3DScriptNode",enumerable:!0},componentInfo:{value:Object.freeze({name:"Scripting",level:1}),enumerable:!0}});const xe=De;ce().add("X3DScriptNode","x_ite/Components/Scripting/X3DScriptNode",xe);const ge=xe,ye=__X_ITE_X3D__.require("x_ite/InputOutput/FileLoader");var Se=r.n(ye);const Ee=__X_ITE_X3D__.require("x_ite/Fields/SFNodeCache");var Ie=r.n(Ee),me=r(588);function Te(e){ge.call(this,e),this.addType(he().Script)}Object.assign(Object.setPrototypeOf(Te.prototype,ge.prototype),{initialize(){ge.prototype.initialize.call(this),this.requestImmediateLoad().catch(Function.prototype)},getExtendedEventHandling:()=>!1,canUserDefinedFields:()=>!0,addUserDefinedField(e,t,r){ge.prototype.addUserDefinedField.call(this,e,t,r),this.isInitialized()&&(this.setLoadState(he().NOT_STARTED_STATE),this.requestImmediateLoad().catch(Function.prototype))},removeUserDefinedField(e){this.getUserDefinedFields().get(e)?.removeInterest("set_field__",this),ge.prototype.removeUserDefinedField.call(this,e),this.isInitialized()&&(this.setLoadState(he().NOT_STARTED_STATE),this.requestImmediateLoad().catch(Function.prototype))},getSourceText(){return this._url},unloadData(){const e=this.context?.get("shutdown");"function"==typeof e&&this.call__(e,"shutdown"),me(window).off(`.Script${this.getId()}`),this.getBrowser().prepareEvents().removeInterest("call__",this),this.removeInterest("call__",this);for(const e of this.getUserDefinedFields())e.removeInterest("set_field__",this)},async loadData(){await this.unloadData(),new(Se())(this).loadDocument(this._url,(e=>{null===e?this.setLoadState(he().FAILED_STATE):(this.initialize__(me.decodeText(e)),this.setLoadState(he().COMPLETE_STATE))}))},createGlobalObject(){const e=()=>this,t={get(t,r){switch(r){case"getScriptNode":return e;case"currentScene":return e().getExecutionContext();default:return t[r]}}},r=new Proxy(this.getBrowser(),t);function n(e){const t=r.createVrmlFromString(e);if(t.length&&t[0])return t[0];throw new Error("SFNode.new: invalid argument.")}n.prototype=F().SFNode.prototype;const i={NULL:{value:null},FALSE:{value:!1},TRUE:{value:!0},print:{value:r.println.bind(r)},trace:{value:r.println.bind(r)},Browser:{value:r},X3DConstants:{value:he()},X3DBrowser:{value:h()},X3DExecutionContext:{value:k()},X3DScene:{value:H()},ComponentInfo:{value:x()},ComponentInfoArray:{value:y()},ProfileInfo:{value:E()},ProfileInfoArray:{value:m()},ConcreteNodesArray:{value:M()},AbstractNodesArray:{value:b()},UnitInfo:{value:O()},UnitInfoArray:{value:C()},NamedNodesArray:{value:P()},ImportedNodesArray:{value:B()},X3DImportedNode:{value:R()},ExportedNodesArray:{value:z()},X3DExportedNode:{value:$()},ExternProtoDeclarationArray:{value:K()},ProtoDeclarationArray:{value:Y()},X3DExternProtoDeclaration:{value:ee()},X3DProtoDeclaration:{value:re()},X3DProtoDeclarationNode:{value:ie()},RouteArray:{value:ae()},X3DRoute:{value:_e()},X3DBaseNode:{value:a()},X3DFieldDefinition:{value:_()},FieldDefinitionArray:{value:c()},X3DField:{value:d()},X3DArrayField:{value:v()},SFColor:{value:F().SFColor},SFColorRGBA:{value:F().SFColorRGBA},SFImage:{value:F().SFImage},SFMatrix3d:{value:F().SFMatrix3d},SFMatrix3f:{value:F().SFMatrix3f},SFMatrix4d:{value:F().SFMatrix4d},SFMatrix4f:{value:F().SFMatrix4f},SFNode:{value:n},SFRotation:{value:F().SFRotation},SFString:{value:F().SFString},SFVec2d:{value:F().SFVec2d},SFVec2f:{value:F().SFVec2f},SFVec3d:{value:F().SFVec3d},SFVec3f:{value:F().SFVec3f},SFVec4d:{value:F().SFVec4d},SFVec4f:{value:F().SFVec4f},VrmlMatrix:{value:F().VrmlMatrix},MFBool:{value:F().MFBool},MFColor:{value:F().MFColor},MFColorRGBA:{value:F().MFColorRGBA},MFDouble:{value:F().MFDouble},MFFloat:{value:F().MFFloat},MFImage:{value:F().MFImage},MFInt32:{value:F().MFInt32},MFMatrix3d:{value:F().MFMatrix3d},MFMatrix3f:{value:F().MFMatrix3f},MFMatrix4d:{value:F().MFMatrix4d},MFMatrix4f:{value:F().MFMatrix4f},MFNode:{value:F().MFNode},MFRotation:{value:F().MFRotation},MFString:{value:F().MFString},MFTime:{value:F().MFTime},MFVec2d:{value:F().MFVec2d},MFVec2f:{value:F().MFVec2f},MFVec3d:{value:F().MFVec3d},MFVec3f:{value:F().MFVec3f},MFVec4d:{value:F().MFVec4d},MFVec4f:{value:F().MFVec4f}};for(const e of this.getUserDefinedFields()){if(e.getAccessType()===he().inputOnly)continue;const t=[e.getName()];e.getAccessType()===he().inputOutput&&t.push(e.getName()+"_changed");for(const r of t)r in i||(i[r]={get:e.valueOf.bind(e),set:e.setValue.bind(e)})}return Object.create(Object.prototype,i)},createContext(e){const t=["initialize","prepareEvents","eventsProcessed","shutdown"];for(const e of this.getUserDefinedFields())switch(e.getAccessType()){case he().inputOnly:t.push(e.getName());break;case he().inputOutput:t.push("set_"+e.getName())}e+=";\n["+t.map((e=>`typeof ${e} !== "undefined" ? ${e} : undefined`)).join(",")+"];";const r=this.evaluate(e),n=new Map;for(let e=0;e<t.length;++e)n.set(t[e],r[e]);return n},evaluate(e){return this.globalObject||(this.globalObject=this.createGlobalObject()),de(Ie().get(this),this.globalObject,e)},async initialize__(e){const t=this.getBrowser();this.globalObject=this.createGlobalObject(),this.context=this.createContext(e);const r=this.context.get("shutdown");"function"==typeof r&&me(window).on(`unload.Script${this.getId()}`,(()=>this.call__(r,"shutdown")));const n=this.context.get("prepareEvents");"function"==typeof n&&t.prepareEvents().addInterest("call__",this,n,"prepareEvents");const i=this.context.get("eventsProcessed");"function"==typeof i&&this.addInterest("call__",this,i,"eventsProcessed");for(const e of this.getUserDefinedFields())switch(e.getAccessType()){case he().inputOnly:{const t=this.context.get(e.getName());"function"==typeof t&&e.addInterest("set_field__",this,t,[]);break}case he().inputOutput:{const t=this.context.get("set_"+e.getName());"function"==typeof t&&e.addInterest("set_field__",this,t,[]);break}}const o=this.context.get("initialize");"function"==typeof o&&await this.call__(o,"initialize")},async call__(e,t){try{await e.call(Ie().get(this),this.getBrowser().getCurrentTime())}catch(e){this.setError(`in function '${t}'`,e)}},async set_field__(e,t,r){const n=t.pop()??r.create();try{n.assign(r),await e.call(Ie().get(this),n.valueOf(),this.getBrowser().getCurrentTime())}catch(e){this.setError(`in function '${r.getName()}'`,e)}finally{t.push(n)}},setError(e,t){const r=this.getExecutionContext().getWorldURL().startsWith("data:")?"data:":this.getExecutionContext().getWorldURL();console.error(`JavaScript Error in Script '${this.getName()}', ${e}\nworld url is '${r}':`),console.error(t)},dispose(){this.unloadData(),ge.prototype.dispose.call(this)}}),Object.defineProperties(Te,{typeName:{value:"Script",enumerable:!0},componentInfo:{value:Object.freeze({name:"Scripting",level:1}),enumerable:!0},containerField:{value:"children",enumerable:!0},specificationRange:{value:Object.freeze({from:"2.0",to:"Infinity"}),enumerable:!0},fieldDefinitions:{value:new(c())([new(_())(he().inputOutput,"metadata",new(F().SFNode)),new(_())(he().inputOutput,"description",new(F().SFString)),new(_())(he().inputOutput,"load",new(F().SFBool)(!0)),new(_())(he().inputOutput,"url",new(F().MFString)),new(_())(he().inputOutput,"autoRefresh",new(F().SFTime)),new(_())(he().inputOutput,"autoRefreshTimeLimit",new(F().SFTime)(3600)),new(_())(he().initializeOnly,"directOutput",new(F().SFBool)),new(_())(he().initializeOnly,"mustEvaluate",new(F().SFBool))]),enumerable:!0}});const Me=Te;ce().add("Script","x_ite/Components/Scripting/Script",Me);const we=Me;i().add({name:"Scripting",concreteNodes:[we],abstractNodes:[ge]});const be=void 0;ce().add("Scripting","assets/components/Scripting",be)})();