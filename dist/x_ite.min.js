/* X_ITE v8.4.4a */!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.X3D=e():t.X3D=e()}(self,(()=>(()=>{var t={126:function(t,e,n){"use strict";var i,o,r=n(603);"undefined"!=typeof window&&window,void 0===(o="function"==typeof(i=function(){if("undefined"==typeof window)return null;var t="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")(),e=t.requestAnimationFrame||t.mozRequestAnimationFrame||t.webkitRequestAnimationFrame||function(e){return t.setTimeout(e,20)},n=t.cancelAnimationFrame||t.mozCancelAnimationFrame||t.webkitCancelAnimationFrame||function(e){t.clearTimeout(e)};function i(t,e){var n=Object.prototype.toString.call(t),i="[object Array]"===n||"[object NodeList]"===n||"[object HTMLCollection]"===n||"[object Object]"===n||void 0!==r&&t instanceof r||"undefined"!=typeof Elements&&t instanceof Elements,o=0,s=t.length;if(i)for(;o<s;o++)e(t[o]);else e(t)}function o(t){if(!t.getBoundingClientRect)return{width:t.offsetWidth,height:t.offsetHeight};var e=t.getBoundingClientRect();return{width:Math.round(e.width),height:Math.round(e.height)}}function s(t,e){Object.keys(e).forEach((function(n){t.style[n]=e[n]}))}var a=function(t,r){var u=0;function c(){var t,e,n=[];this.add=function(t){n.push(t)},this.call=function(i){for(t=0,e=n.length;t<e;t++)n[t].call(this,i)},this.remove=function(i){var o=[];for(t=0,e=n.length;t<e;t++)n[t]!==i&&o.push(n[t]);n=o},this.length=function(){return n.length}}function l(t,n){if(t)if(t.resizedAttached)t.resizedAttached.add(n);else{t.resizedAttached=new c,t.resizedAttached.add(n),t.resizeSensor=document.createElement("div"),t.resizeSensor.dir="ltr",t.resizeSensor.className="resize-sensor";var i={pointerEvents:"none",position:"absolute",left:"0px",top:"0px",right:"0px",bottom:"0px",overflow:"hidden",zIndex:"-1",visibility:"hidden",maxWidth:"100%"},r={position:"absolute",left:"0px",top:"0px",transition:"0s"};s(t.resizeSensor,i);var a=document.createElement("div");a.className="resize-sensor-expand",s(a,i);var l=document.createElement("div");s(l,r),a.appendChild(l);var h=document.createElement("div");h.className="resize-sensor-shrink",s(h,i);var d=document.createElement("div");s(d,r),s(d,{width:"200%",height:"200%"}),h.appendChild(d),t.resizeSensor.appendChild(a),t.resizeSensor.appendChild(h),t.appendChild(t.resizeSensor);var p=window.getComputedStyle(t),f=p?p.getPropertyValue("position"):null;"absolute"!==f&&"relative"!==f&&"fixed"!==f&&"sticky"!==f&&(t.style.position="relative");var g=!1,m=0,_=o(t),x=0,y=0,w=!0;u=0;var S=function(){var e=t.offsetWidth,n=t.offsetHeight;l.style.width=e+10+"px",l.style.height=n+10+"px",a.scrollLeft=e+10,a.scrollTop=n+10,h.scrollLeft=e+10,h.scrollTop=n+10},T=function(){if(w){if(0===t.offsetWidth&&0===t.offsetHeight)return void(u||(u=e((function(){u=0,T()}))));w=!1}S()};t.resizeSensor.resetSensor=T;var b=function(){m=0,g&&(x=_.width,y=_.height,t.resizedAttached&&t.resizedAttached.call(_))},v=function(){_=o(t),(g=_.width!==x||_.height!==y)&&!m&&(m=e(b)),T()},C=function(t,e,n){t.attachEvent?t.attachEvent("on"+e,n):t.addEventListener(e,n)};C(a,"scroll",v),C(h,"scroll",v),u=e((function(){u=0,T()}))}}i(t,(function(t){l(t,r)})),this.detach=function(e){u||(n(u),u=0),a.detach(t,e)},this.reset=function(){t.resizeSensor.resetSensor()}};if(a.reset=function(t){i(t,(function(t){t.resizeSensor.resetSensor()}))},a.detach=function(t,e){i(t,(function(t){t&&(t.resizedAttached&&"function"==typeof e&&(t.resizedAttached.remove(e),t.resizedAttached.length())||t.resizeSensor&&(t.contains(t.resizeSensor)&&t.removeChild(t.resizeSensor),delete t.resizeSensor,delete t.resizedAttached))}))},"undefined"!=typeof MutationObserver){var u=new MutationObserver((function(t){for(var e in t)if(t.hasOwnProperty(e))for(var n=t[e].addedNodes,i=0;i<n.length;i++)n[i].resizeSensor&&a.reset(n[i])}));document.addEventListener("DOMContentLoaded",(function(t){u.observe(document.body,{childList:!0,subtree:!0})}))}return a})?i.call(e,n,e,t):i)||(t.exports=o)},151:(t,e,n)=>{!function(t){function e(t){var e,i,o;return this.length?((e=this[0]).ownerDocument?o=e.ownerDocument:e=(o=e).documentElement,null==t?o.exitFullscreen||o.webkitExitFullscreen||o.webkitCancelFullScreen||o.msExitFullscreen||o.mozCancelFullScreen?(t=n(o))&&(o.fullscreenElement||o.webkitFullscreenElement||o.webkitCurrentFullScreenElement||o.msFullscreenElement||o.mozFullScreenElement)||t:null:t?((i=e.requestFullscreen||e.webkitRequestFullscreen||e.webkitRequestFullScreen||e.msRequestFullscreen||e.mozRequestFullScreen)&&i.call(e),this):((i=o.exitFullscreen||o.webkitExitFullscreen||o.webkitCancelFullScreen||o.msExitFullscreen||o.mozCancelFullScreen)&&n(o)&&i.call(o),this)):this}function n(t){return!!(t.fullscreenElement||t.msFullscreenElement||t.webkitIsFullScreen||t.mozFullScreen)}function i(e){t(document).trigger(new t.Event("fullscreenchange"))}function o(e){t(document).trigger(new t.Event("fullscreenerror"))}t.fn.fullScreen=e,t.fn.toggleFullScreen=function(){return e.call(this,!e.call(this))},function(){var e,n,r;(e=document).webkitCancelFullScreen?(n="webkitfullscreenchange",r="webkitfullscreenerror"):e.msExitFullscreen?(n="MSFullscreenChange",r="MSFullscreenError"):e.mozCancelFullScreen?(n="mozfullscreenchange",r="mozfullscreenerror"):(n="fullscreenchange",r="fullscreenerror"),t(document).bind(n,i),t(document).bind(r,o)}()}(n(603))},50:(t,e,n)=>{var i,o,r;o=[n(603)],void 0===(r="function"==typeof(i=function(t){var e,n,i=["wheel","mousewheel","DOMMouseScroll","MozMousePixelScroll"],o="onwheel"in document||document.documentMode>=9?["wheel"]:["mousewheel","DomMouseScroll","MozMousePixelScroll"],r=Array.prototype.slice;if(t.event.fixHooks)for(var s=i.length;s;)t.event.fixHooks[i[--s]]=t.event.mouseHooks;var a=t.event.special.mousewheel={version:"3.1.12",setup:function(){if(this.addEventListener)for(var e=o.length;e;)this.addEventListener(o[--e],u,!1);else this.onmousewheel=u;t.data(this,"mousewheel-line-height",a.getLineHeight(this)),t.data(this,"mousewheel-page-height",a.getPageHeight(this))},teardown:function(){if(this.removeEventListener)for(var e=o.length;e;)this.removeEventListener(o[--e],u,!1);else this.onmousewheel=null;t.removeData(this,"mousewheel-line-height"),t.removeData(this,"mousewheel-page-height")},getLineHeight:function(e){var n=t(e),i=n["offsetParent"in t.fn?"offsetParent":"parent"]();return i.length||(i=t("body")),parseInt(i.css("fontSize"),10)||parseInt(n.css("fontSize"),10)||16},getPageHeight:function(e){return t(e).height()},settings:{adjustOldDeltas:!0,normalizeOffset:!0}};function u(i){var o=i||window.event,s=r.call(arguments,1),u=0,h=0,d=0,p=0,f=0,g=0;if((i=t.event.fix(o)).type="mousewheel","detail"in o&&(d=-1*o.detail),"wheelDelta"in o&&(d=o.wheelDelta),"wheelDeltaY"in o&&(d=o.wheelDeltaY),"wheelDeltaX"in o&&(h=-1*o.wheelDeltaX),"axis"in o&&o.axis===o.HORIZONTAL_AXIS&&(h=-1*d,d=0),u=0===d?h:d,"deltaY"in o&&(u=d=-1*o.deltaY),"deltaX"in o&&(h=o.deltaX,0===d&&(u=-1*h)),0!==d||0!==h){if(1===o.deltaMode){var m=t.data(this,"mousewheel-line-height");u*=m,d*=m,h*=m}else if(2===o.deltaMode){var _=t.data(this,"mousewheel-page-height");u*=_,d*=_,h*=_}if(p=Math.max(Math.abs(d),Math.abs(h)),(!n||p<n)&&(n=p,l(o,p)&&(n/=40)),l(o,p)&&(u/=40,h/=40,d/=40),u=Math[u>=1?"floor":"ceil"](u/n),h=Math[h>=1?"floor":"ceil"](h/n),d=Math[d>=1?"floor":"ceil"](d/n),a.settings.normalizeOffset&&this.getBoundingClientRect){var x=this.getBoundingClientRect();f=i.clientX-x.left,g=i.clientY-x.top}return i.deltaX=h,i.deltaY=d,i.deltaFactor=n,i.offsetX=f,i.offsetY=g,i.deltaMode=0,s.unshift(i,u,h,d),e&&clearTimeout(e),e=setTimeout(c,200),(t.event.dispatch||t.event.handle).apply(this,s)}}function c(){n=null}function l(t,e){return a.settings.adjustOldDeltas&&"mousewheel"===t.type&&e%120==0}t.fn.extend({mousewheel:function(t){return t?this.bind("mousewheel",t):this.trigger("mousewheel")},unmousewheel:function(t){return this.unbind("mousewheel",t)}})})?i.apply(e,o):i)||(t.exports=r)},603:function(t,e){var n;!function(e,n){"use strict";"object"==typeof t.exports?t.exports=e.document?n(e,!0):function(t){if(!t.document)throw new Error("jQuery requires a window with a document");return n(t)}:n(e)}("undefined"!=typeof window?window:this,(function(i,o){"use strict";var r=[],s=Object.getPrototypeOf,a=r.slice,u=r.flat?function(t){return r.flat.call(t)}:function(t){return r.concat.apply([],t)},c=r.push,l=r.indexOf,h={},d=h.toString,p=h.hasOwnProperty,f=p.toString,g=f.call(Object),m={},_=function(t){return"function"==typeof t&&"number"!=typeof t.nodeType&&"function"!=typeof t.item},x=function(t){return null!=t&&t===t.window},y=i.document,w={type:!0,src:!0,nonce:!0,noModule:!0};function S(t,e,n){var i,o,r=(n=n||y).createElement("script");if(r.text=t,e)for(i in w)(o=e[i]||e.getAttribute&&e.getAttribute(i))&&r.setAttribute(i,o);n.head.appendChild(r).parentNode.removeChild(r)}function T(t){return null==t?t+"":"object"==typeof t||"function"==typeof t?h[d.call(t)]||"object":typeof t}var b="3.6.3",v=function(t,e){return new v.fn.init(t,e)};function C(t){var e=!!t&&"length"in t&&t.length,n=T(t);return!_(t)&&!x(t)&&("array"===n||0===e||"number"==typeof e&&e>0&&e-1 in t)}v.fn=v.prototype={jquery:b,constructor:v,length:0,toArray:function(){return a.call(this)},get:function(t){return null==t?a.call(this):t<0?this[t+this.length]:this[t]},pushStack:function(t){var e=v.merge(this.constructor(),t);return e.prevObject=this,e},each:function(t){return v.each(this,t)},map:function(t){return this.pushStack(v.map(this,(function(e,n){return t.call(e,n,e)})))},slice:function(){return this.pushStack(a.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},even:function(){return this.pushStack(v.grep(this,(function(t,e){return(e+1)%2})))},odd:function(){return this.pushStack(v.grep(this,(function(t,e){return e%2})))},eq:function(t){var e=this.length,n=+t+(t<0?e:0);return this.pushStack(n>=0&&n<e?[this[n]]:[])},end:function(){return this.prevObject||this.constructor()},push:c,sort:r.sort,splice:r.splice},v.extend=v.fn.extend=function(){var t,e,n,i,o,r,s=arguments[0]||{},a=1,u=arguments.length,c=!1;for("boolean"==typeof s&&(c=s,s=arguments[a]||{},a++),"object"==typeof s||_(s)||(s={}),a===u&&(s=this,a--);a<u;a++)if(null!=(t=arguments[a]))for(e in t)i=t[e],"__proto__"!==e&&s!==i&&(c&&i&&(v.isPlainObject(i)||(o=Array.isArray(i)))?(n=s[e],r=o&&!Array.isArray(n)?[]:o||v.isPlainObject(n)?n:{},o=!1,s[e]=v.extend(c,r,i)):void 0!==i&&(s[e]=i));return s},v.extend({expando:"jQuery"+(b+Math.random()).replace(/\D/g,""),isReady:!0,error:function(t){throw new Error(t)},noop:function(){},isPlainObject:function(t){var e,n;return!(!t||"[object Object]"!==d.call(t))&&(!(e=s(t))||"function"==typeof(n=p.call(e,"constructor")&&e.constructor)&&f.call(n)===g)},isEmptyObject:function(t){var e;for(e in t)return!1;return!0},globalEval:function(t,e,n){S(t,{nonce:e&&e.nonce},n)},each:function(t,e){var n,i=0;if(C(t))for(n=t.length;i<n&&!1!==e.call(t[i],i,t[i]);i++);else for(i in t)if(!1===e.call(t[i],i,t[i]))break;return t},makeArray:function(t,e){var n=e||[];return null!=t&&(C(Object(t))?v.merge(n,"string"==typeof t?[t]:t):c.call(n,t)),n},inArray:function(t,e,n){return null==e?-1:l.call(e,t,n)},merge:function(t,e){for(var n=+e.length,i=0,o=t.length;i<n;i++)t[o++]=e[i];return t.length=o,t},grep:function(t,e,n){for(var i=[],o=0,r=t.length,s=!n;o<r;o++)!e(t[o],o)!==s&&i.push(t[o]);return i},map:function(t,e,n){var i,o,r=0,s=[];if(C(t))for(i=t.length;r<i;r++)null!=(o=e(t[r],r,n))&&s.push(o);else for(r in t)null!=(o=e(t[r],r,n))&&s.push(o);return u(s)},guid:1,support:m}),"function"==typeof Symbol&&(v.fn[Symbol.iterator]=r[Symbol.iterator]),v.each("Boolean Number String Function Array Date RegExp Object Error Symbol".split(" "),(function(t,e){h["[object "+e+"]"]=e.toLowerCase()}));var E=function(t){var e,n,i,o,r,s,a,u,c,l,h,d,p,f,g,m,_,x,y,w="sizzle"+1*new Date,S=t.document,T=0,b=0,v=ut(),C=ut(),E=ut(),O=ut(),N=function(t,e){return t===e&&(h=!0),0},F={}.hasOwnProperty,I=[],M=I.pop,D=I.push,V=I.push,R=I.slice,P=function(t,e){for(var n=0,i=t.length;n<i;n++)if(t[n]===e)return n;return-1},A="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",L="[\\x20\\t\\r\\n\\f]",B="(?:\\\\[\\da-fA-F]{1,6}"+L+"?|\\\\[^\\r\\n\\f]|[\\w-]|[^\0-\\x7f])+",X="\\["+L+"*("+B+")(?:"+L+"*([*^$|!~]?=)"+L+"*(?:'((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\"|("+B+"))|)"+L+"*\\]",U=":("+B+")(?:\\((('((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\")|((?:\\\\.|[^\\\\()[\\]]|"+X+")*)|.*)\\)|)",k=new RegExp(L+"+","g"),z=new RegExp("^"+L+"+|((?:^|[^\\\\])(?:\\\\.)*)"+L+"+$","g"),j=new RegExp("^"+L+"*,"+L+"*"),G=new RegExp("^"+L+"*([>+~]|"+L+")"+L+"*"),H=new RegExp(L+"|>"),q=new RegExp(U),Y=new RegExp("^"+B+"$"),W={ID:new RegExp("^#("+B+")"),CLASS:new RegExp("^\\.("+B+")"),TAG:new RegExp("^("+B+"|[*])"),ATTR:new RegExp("^"+X),PSEUDO:new RegExp("^"+U),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+L+"*(even|odd|(([+-]|)(\\d*)n|)"+L+"*(?:([+-]|)"+L+"*(\\d+)|))"+L+"*\\)|)","i"),bool:new RegExp("^(?:"+A+")$","i"),needsContext:new RegExp("^"+L+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+L+"*((?:-\\d)?\\d*)"+L+"*\\)|)(?=[^-]|$)","i")},K=/HTML$/i,J=/^(?:input|select|textarea|button)$/i,Z=/^h\d$/i,Q=/^[^{]+\{\s*\[native \w/,$=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,tt=/[+~]/,et=new RegExp("\\\\[\\da-fA-F]{1,6}"+L+"?|\\\\([^\\r\\n\\f])","g"),nt=function(t,e){var n="0x"+t.slice(1)-65536;return e||(n<0?String.fromCharCode(n+65536):String.fromCharCode(n>>10|55296,1023&n|56320))},it=/([\0-\x1f\x7f]|^-?\d)|^-$|[^\0-\x1f\x7f-\uFFFF\w-]/g,ot=function(t,e){return e?"\0"===t?"ï¿½":t.slice(0,-1)+"\\"+t.charCodeAt(t.length-1).toString(16)+" ":"\\"+t},rt=function(){d()},st=wt((function(t){return!0===t.disabled&&"fieldset"===t.nodeName.toLowerCase()}),{dir:"parentNode",next:"legend"});try{V.apply(I=R.call(S.childNodes),S.childNodes),I[S.childNodes.length].nodeType}catch(t){V={apply:I.length?function(t,e){D.apply(t,R.call(e))}:function(t,e){for(var n=t.length,i=0;t[n++]=e[i++];);t.length=n-1}}}function at(t,e,i,o){var r,a,c,l,h,f,_,x=e&&e.ownerDocument,S=e?e.nodeType:9;if(i=i||[],"string"!=typeof t||!t||1!==S&&9!==S&&11!==S)return i;if(!o&&(d(e),e=e||p,g)){if(11!==S&&(h=$.exec(t)))if(r=h[1]){if(9===S){if(!(c=e.getElementById(r)))return i;if(c.id===r)return i.push(c),i}else if(x&&(c=x.getElementById(r))&&y(e,c)&&c.id===r)return i.push(c),i}else{if(h[2])return V.apply(i,e.getElementsByTagName(t)),i;if((r=h[3])&&n.getElementsByClassName&&e.getElementsByClassName)return V.apply(i,e.getElementsByClassName(r)),i}if(n.qsa&&!O[t+" "]&&(!m||!m.test(t))&&(1!==S||"object"!==e.nodeName.toLowerCase())){if(_=t,x=e,1===S&&(H.test(t)||G.test(t))){for((x=tt.test(t)&&_t(e.parentNode)||e)===e&&n.scope||((l=e.getAttribute("id"))?l=l.replace(it,ot):e.setAttribute("id",l=w)),a=(f=s(t)).length;a--;)f[a]=(l?"#"+l:":scope")+" "+yt(f[a]);_=f.join(",")}try{if(n.cssSupportsSelector&&!CSS.supports("selector(:is("+_+"))"))throw new Error;return V.apply(i,x.querySelectorAll(_)),i}catch(e){O(t,!0)}finally{l===w&&e.removeAttribute("id")}}}return u(t.replace(z,"$1"),e,i,o)}function ut(){var t=[];return function e(n,o){return t.push(n+" ")>i.cacheLength&&delete e[t.shift()],e[n+" "]=o}}function ct(t){return t[w]=!0,t}function lt(t){var e=p.createElement("fieldset");try{return!!t(e)}catch(t){return!1}finally{e.parentNode&&e.parentNode.removeChild(e),e=null}}function ht(t,e){for(var n=t.split("|"),o=n.length;o--;)i.attrHandle[n[o]]=e}function dt(t,e){var n=e&&t,i=n&&1===t.nodeType&&1===e.nodeType&&t.sourceIndex-e.sourceIndex;if(i)return i;if(n)for(;n=n.nextSibling;)if(n===e)return-1;return t?1:-1}function pt(t){return function(e){return"input"===e.nodeName.toLowerCase()&&e.type===t}}function ft(t){return function(e){var n=e.nodeName.toLowerCase();return("input"===n||"button"===n)&&e.type===t}}function gt(t){return function(e){return"form"in e?e.parentNode&&!1===e.disabled?"label"in e?"label"in e.parentNode?e.parentNode.disabled===t:e.disabled===t:e.isDisabled===t||e.isDisabled!==!t&&st(e)===t:e.disabled===t:"label"in e&&e.disabled===t}}function mt(t){return ct((function(e){return e=+e,ct((function(n,i){for(var o,r=t([],n.length,e),s=r.length;s--;)n[o=r[s]]&&(n[o]=!(i[o]=n[o]))}))}))}function _t(t){return t&&void 0!==t.getElementsByTagName&&t}for(e in n=at.support={},r=at.isXML=function(t){var e=t&&t.namespaceURI,n=t&&(t.ownerDocument||t).documentElement;return!K.test(e||n&&n.nodeName||"HTML")},d=at.setDocument=function(t){var e,o,s=t?t.ownerDocument||t:S;return s!=p&&9===s.nodeType&&s.documentElement?(f=(p=s).documentElement,g=!r(p),S!=p&&(o=p.defaultView)&&o.top!==o&&(o.addEventListener?o.addEventListener("unload",rt,!1):o.attachEvent&&o.attachEvent("onunload",rt)),n.scope=lt((function(t){return f.appendChild(t).appendChild(p.createElement("div")),void 0!==t.querySelectorAll&&!t.querySelectorAll(":scope fieldset div").length})),n.cssSupportsSelector=lt((function(){return CSS.supports("selector(*)")&&p.querySelectorAll(":is(:jqfake)")&&!CSS.supports("selector(:is(*,:jqfake))")})),n.attributes=lt((function(t){return t.className="i",!t.getAttribute("className")})),n.getElementsByTagName=lt((function(t){return t.appendChild(p.createComment("")),!t.getElementsByTagName("*").length})),n.getElementsByClassName=Q.test(p.getElementsByClassName),n.getById=lt((function(t){return f.appendChild(t).id=w,!p.getElementsByName||!p.getElementsByName(w).length})),n.getById?(i.filter.ID=function(t){var e=t.replace(et,nt);return function(t){return t.getAttribute("id")===e}},i.find.ID=function(t,e){if(void 0!==e.getElementById&&g){var n=e.getElementById(t);return n?[n]:[]}}):(i.filter.ID=function(t){var e=t.replace(et,nt);return function(t){var n=void 0!==t.getAttributeNode&&t.getAttributeNode("id");return n&&n.value===e}},i.find.ID=function(t,e){if(void 0!==e.getElementById&&g){var n,i,o,r=e.getElementById(t);if(r){if((n=r.getAttributeNode("id"))&&n.value===t)return[r];for(o=e.getElementsByName(t),i=0;r=o[i++];)if((n=r.getAttributeNode("id"))&&n.value===t)return[r]}return[]}}),i.find.TAG=n.getElementsByTagName?function(t,e){return void 0!==e.getElementsByTagName?e.getElementsByTagName(t):n.qsa?e.querySelectorAll(t):void 0}:function(t,e){var n,i=[],o=0,r=e.getElementsByTagName(t);if("*"===t){for(;n=r[o++];)1===n.nodeType&&i.push(n);return i}return r},i.find.CLASS=n.getElementsByClassName&&function(t,e){if(void 0!==e.getElementsByClassName&&g)return e.getElementsByClassName(t)},_=[],m=[],(n.qsa=Q.test(p.querySelectorAll))&&(lt((function(t){var e;f.appendChild(t).innerHTML="<a id='"+w+"'></a><select id='"+w+"-\r\\' msallowcapture=''><option selected=''></option></select>",t.querySelectorAll("[msallowcapture^='']").length&&m.push("[*^$]="+L+"*(?:''|\"\")"),t.querySelectorAll("[selected]").length||m.push("\\["+L+"*(?:value|"+A+")"),t.querySelectorAll("[id~="+w+"-]").length||m.push("~="),(e=p.createElement("input")).setAttribute("name",""),t.appendChild(e),t.querySelectorAll("[name='']").length||m.push("\\["+L+"*name"+L+"*="+L+"*(?:''|\"\")"),t.querySelectorAll(":checked").length||m.push(":checked"),t.querySelectorAll("a#"+w+"+*").length||m.push(".#.+[+~]"),t.querySelectorAll("\\\f"),m.push("[\\r\\n\\f]")})),lt((function(t){t.innerHTML="<a href='' disabled='disabled'></a><select disabled='disabled'><option/></select>";var e=p.createElement("input");e.setAttribute("type","hidden"),t.appendChild(e).setAttribute("name","D"),t.querySelectorAll("[name=d]").length&&m.push("name"+L+"*[*^$|!~]?="),2!==t.querySelectorAll(":enabled").length&&m.push(":enabled",":disabled"),f.appendChild(t).disabled=!0,2!==t.querySelectorAll(":disabled").length&&m.push(":enabled",":disabled"),t.querySelectorAll("*,:x"),m.push(",.*:")}))),(n.matchesSelector=Q.test(x=f.matches||f.webkitMatchesSelector||f.mozMatchesSelector||f.oMatchesSelector||f.msMatchesSelector))&&lt((function(t){n.disconnectedMatch=x.call(t,"*"),x.call(t,"[s!='']:x"),_.push("!=",U)})),n.cssSupportsSelector||m.push(":has"),m=m.length&&new RegExp(m.join("|")),_=_.length&&new RegExp(_.join("|")),e=Q.test(f.compareDocumentPosition),y=e||Q.test(f.contains)?function(t,e){var n=9===t.nodeType&&t.documentElement||t,i=e&&e.parentNode;return t===i||!(!i||1!==i.nodeType||!(n.contains?n.contains(i):t.compareDocumentPosition&&16&t.compareDocumentPosition(i)))}:function(t,e){if(e)for(;e=e.parentNode;)if(e===t)return!0;return!1},N=e?function(t,e){if(t===e)return h=!0,0;var i=!t.compareDocumentPosition-!e.compareDocumentPosition;return i||(1&(i=(t.ownerDocument||t)==(e.ownerDocument||e)?t.compareDocumentPosition(e):1)||!n.sortDetached&&e.compareDocumentPosition(t)===i?t==p||t.ownerDocument==S&&y(S,t)?-1:e==p||e.ownerDocument==S&&y(S,e)?1:l?P(l,t)-P(l,e):0:4&i?-1:1)}:function(t,e){if(t===e)return h=!0,0;var n,i=0,o=t.parentNode,r=e.parentNode,s=[t],a=[e];if(!o||!r)return t==p?-1:e==p?1:o?-1:r?1:l?P(l,t)-P(l,e):0;if(o===r)return dt(t,e);for(n=t;n=n.parentNode;)s.unshift(n);for(n=e;n=n.parentNode;)a.unshift(n);for(;s[i]===a[i];)i++;return i?dt(s[i],a[i]):s[i]==S?-1:a[i]==S?1:0},p):p},at.matches=function(t,e){return at(t,null,null,e)},at.matchesSelector=function(t,e){if(d(t),n.matchesSelector&&g&&!O[e+" "]&&(!_||!_.test(e))&&(!m||!m.test(e)))try{var i=x.call(t,e);if(i||n.disconnectedMatch||t.document&&11!==t.document.nodeType)return i}catch(t){O(e,!0)}return at(e,p,null,[t]).length>0},at.contains=function(t,e){return(t.ownerDocument||t)!=p&&d(t),y(t,e)},at.attr=function(t,e){(t.ownerDocument||t)!=p&&d(t);var o=i.attrHandle[e.toLowerCase()],r=o&&F.call(i.attrHandle,e.toLowerCase())?o(t,e,!g):void 0;return void 0!==r?r:n.attributes||!g?t.getAttribute(e):(r=t.getAttributeNode(e))&&r.specified?r.value:null},at.escape=function(t){return(t+"").replace(it,ot)},at.error=function(t){throw new Error("Syntax error, unrecognized expression: "+t)},at.uniqueSort=function(t){var e,i=[],o=0,r=0;if(h=!n.detectDuplicates,l=!n.sortStable&&t.slice(0),t.sort(N),h){for(;e=t[r++];)e===t[r]&&(o=i.push(r));for(;o--;)t.splice(i[o],1)}return l=null,t},o=at.getText=function(t){var e,n="",i=0,r=t.nodeType;if(r){if(1===r||9===r||11===r){if("string"==typeof t.textContent)return t.textContent;for(t=t.firstChild;t;t=t.nextSibling)n+=o(t)}else if(3===r||4===r)return t.nodeValue}else for(;e=t[i++];)n+=o(e);return n},i=at.selectors={cacheLength:50,createPseudo:ct,match:W,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(t){return t[1]=t[1].replace(et,nt),t[3]=(t[3]||t[4]||t[5]||"").replace(et,nt),"~="===t[2]&&(t[3]=" "+t[3]+" "),t.slice(0,4)},CHILD:function(t){return t[1]=t[1].toLowerCase(),"nth"===t[1].slice(0,3)?(t[3]||at.error(t[0]),t[4]=+(t[4]?t[5]+(t[6]||1):2*("even"===t[3]||"odd"===t[3])),t[5]=+(t[7]+t[8]||"odd"===t[3])):t[3]&&at.error(t[0]),t},PSEUDO:function(t){var e,n=!t[6]&&t[2];return W.CHILD.test(t[0])?null:(t[3]?t[2]=t[4]||t[5]||"":n&&q.test(n)&&(e=s(n,!0))&&(e=n.indexOf(")",n.length-e)-n.length)&&(t[0]=t[0].slice(0,e),t[2]=n.slice(0,e)),t.slice(0,3))}},filter:{TAG:function(t){var e=t.replace(et,nt).toLowerCase();return"*"===t?function(){return!0}:function(t){return t.nodeName&&t.nodeName.toLowerCase()===e}},CLASS:function(t){var e=v[t+" "];return e||(e=new RegExp("(^|"+L+")"+t+"("+L+"|$)"))&&v(t,(function(t){return e.test("string"==typeof t.className&&t.className||void 0!==t.getAttribute&&t.getAttribute("class")||"")}))},ATTR:function(t,e,n){return function(i){var o=at.attr(i,t);return null==o?"!="===e:!e||(o+="","="===e?o===n:"!="===e?o!==n:"^="===e?n&&0===o.indexOf(n):"*="===e?n&&o.indexOf(n)>-1:"$="===e?n&&o.slice(-n.length)===n:"~="===e?(" "+o.replace(k," ")+" ").indexOf(n)>-1:"|="===e&&(o===n||o.slice(0,n.length+1)===n+"-"))}},CHILD:function(t,e,n,i,o){var r="nth"!==t.slice(0,3),s="last"!==t.slice(-4),a="of-type"===e;return 1===i&&0===o?function(t){return!!t.parentNode}:function(e,n,u){var c,l,h,d,p,f,g=r!==s?"nextSibling":"previousSibling",m=e.parentNode,_=a&&e.nodeName.toLowerCase(),x=!u&&!a,y=!1;if(m){if(r){for(;g;){for(d=e;d=d[g];)if(a?d.nodeName.toLowerCase()===_:1===d.nodeType)return!1;f=g="only"===t&&!f&&"nextSibling"}return!0}if(f=[s?m.firstChild:m.lastChild],s&&x){for(y=(p=(c=(l=(h=(d=m)[w]||(d[w]={}))[d.uniqueID]||(h[d.uniqueID]={}))[t]||[])[0]===T&&c[1])&&c[2],d=p&&m.childNodes[p];d=++p&&d&&d[g]||(y=p=0)||f.pop();)if(1===d.nodeType&&++y&&d===e){l[t]=[T,p,y];break}}else if(x&&(y=p=(c=(l=(h=(d=e)[w]||(d[w]={}))[d.uniqueID]||(h[d.uniqueID]={}))[t]||[])[0]===T&&c[1]),!1===y)for(;(d=++p&&d&&d[g]||(y=p=0)||f.pop())&&((a?d.nodeName.toLowerCase()!==_:1!==d.nodeType)||!++y||(x&&((l=(h=d[w]||(d[w]={}))[d.uniqueID]||(h[d.uniqueID]={}))[t]=[T,y]),d!==e)););return(y-=o)===i||y%i==0&&y/i>=0}}},PSEUDO:function(t,e){var n,o=i.pseudos[t]||i.setFilters[t.toLowerCase()]||at.error("unsupported pseudo: "+t);return o[w]?o(e):o.length>1?(n=[t,t,"",e],i.setFilters.hasOwnProperty(t.toLowerCase())?ct((function(t,n){for(var i,r=o(t,e),s=r.length;s--;)t[i=P(t,r[s])]=!(n[i]=r[s])})):function(t){return o(t,0,n)}):o}},pseudos:{not:ct((function(t){var e=[],n=[],i=a(t.replace(z,"$1"));return i[w]?ct((function(t,e,n,o){for(var r,s=i(t,null,o,[]),a=t.length;a--;)(r=s[a])&&(t[a]=!(e[a]=r))})):function(t,o,r){return e[0]=t,i(e,null,r,n),e[0]=null,!n.pop()}})),has:ct((function(t){return function(e){return at(t,e).length>0}})),contains:ct((function(t){return t=t.replace(et,nt),function(e){return(e.textContent||o(e)).indexOf(t)>-1}})),lang:ct((function(t){return Y.test(t||"")||at.error("unsupported lang: "+t),t=t.replace(et,nt).toLowerCase(),function(e){var n;do{if(n=g?e.lang:e.getAttribute("xml:lang")||e.getAttribute("lang"))return(n=n.toLowerCase())===t||0===n.indexOf(t+"-")}while((e=e.parentNode)&&1===e.nodeType);return!1}})),target:function(e){var n=t.location&&t.location.hash;return n&&n.slice(1)===e.id},root:function(t){return t===f},focus:function(t){return t===p.activeElement&&(!p.hasFocus||p.hasFocus())&&!!(t.type||t.href||~t.tabIndex)},enabled:gt(!1),disabled:gt(!0),checked:function(t){var e=t.nodeName.toLowerCase();return"input"===e&&!!t.checked||"option"===e&&!!t.selected},selected:function(t){return t.parentNode&&t.parentNode.selectedIndex,!0===t.selected},empty:function(t){for(t=t.firstChild;t;t=t.nextSibling)if(t.nodeType<6)return!1;return!0},parent:function(t){return!i.pseudos.empty(t)},header:function(t){return Z.test(t.nodeName)},input:function(t){return J.test(t.nodeName)},button:function(t){var e=t.nodeName.toLowerCase();return"input"===e&&"button"===t.type||"button"===e},text:function(t){var e;return"input"===t.nodeName.toLowerCase()&&"text"===t.type&&(null==(e=t.getAttribute("type"))||"text"===e.toLowerCase())},first:mt((function(){return[0]})),last:mt((function(t,e){return[e-1]})),eq:mt((function(t,e,n){return[n<0?n+e:n]})),even:mt((function(t,e){for(var n=0;n<e;n+=2)t.push(n);return t})),odd:mt((function(t,e){for(var n=1;n<e;n+=2)t.push(n);return t})),lt:mt((function(t,e,n){for(var i=n<0?n+e:n>e?e:n;--i>=0;)t.push(i);return t})),gt:mt((function(t,e,n){for(var i=n<0?n+e:n;++i<e;)t.push(i);return t}))}},i.pseudos.nth=i.pseudos.eq,{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})i.pseudos[e]=pt(e);for(e in{submit:!0,reset:!0})i.pseudos[e]=ft(e);function xt(){}function yt(t){for(var e=0,n=t.length,i="";e<n;e++)i+=t[e].value;return i}function wt(t,e,n){var i=e.dir,o=e.next,r=o||i,s=n&&"parentNode"===r,a=b++;return e.first?function(e,n,o){for(;e=e[i];)if(1===e.nodeType||s)return t(e,n,o);return!1}:function(e,n,u){var c,l,h,d=[T,a];if(u){for(;e=e[i];)if((1===e.nodeType||s)&&t(e,n,u))return!0}else for(;e=e[i];)if(1===e.nodeType||s)if(l=(h=e[w]||(e[w]={}))[e.uniqueID]||(h[e.uniqueID]={}),o&&o===e.nodeName.toLowerCase())e=e[i]||e;else{if((c=l[r])&&c[0]===T&&c[1]===a)return d[2]=c[2];if(l[r]=d,d[2]=t(e,n,u))return!0}return!1}}function St(t){return t.length>1?function(e,n,i){for(var o=t.length;o--;)if(!t[o](e,n,i))return!1;return!0}:t[0]}function Tt(t,e,n,i,o){for(var r,s=[],a=0,u=t.length,c=null!=e;a<u;a++)(r=t[a])&&(n&&!n(r,i,o)||(s.push(r),c&&e.push(a)));return s}function bt(t,e,n,i,o,r){return i&&!i[w]&&(i=bt(i)),o&&!o[w]&&(o=bt(o,r)),ct((function(r,s,a,u){var c,l,h,d=[],p=[],f=s.length,g=r||function(t,e,n){for(var i=0,o=e.length;i<o;i++)at(t,e[i],n);return n}(e||"*",a.nodeType?[a]:a,[]),m=!t||!r&&e?g:Tt(g,d,t,a,u),_=n?o||(r?t:f||i)?[]:s:m;if(n&&n(m,_,a,u),i)for(c=Tt(_,p),i(c,[],a,u),l=c.length;l--;)(h=c[l])&&(_[p[l]]=!(m[p[l]]=h));if(r){if(o||t){if(o){for(c=[],l=_.length;l--;)(h=_[l])&&c.push(m[l]=h);o(null,_=[],c,u)}for(l=_.length;l--;)(h=_[l])&&(c=o?P(r,h):d[l])>-1&&(r[c]=!(s[c]=h))}}else _=Tt(_===s?_.splice(f,_.length):_),o?o(null,s,_,u):V.apply(s,_)}))}function vt(t){for(var e,n,o,r=t.length,s=i.relative[t[0].type],a=s||i.relative[" "],u=s?1:0,l=wt((function(t){return t===e}),a,!0),h=wt((function(t){return P(e,t)>-1}),a,!0),d=[function(t,n,i){var o=!s&&(i||n!==c)||((e=n).nodeType?l(t,n,i):h(t,n,i));return e=null,o}];u<r;u++)if(n=i.relative[t[u].type])d=[wt(St(d),n)];else{if((n=i.filter[t[u].type].apply(null,t[u].matches))[w]){for(o=++u;o<r&&!i.relative[t[o].type];o++);return bt(u>1&&St(d),u>1&&yt(t.slice(0,u-1).concat({value:" "===t[u-2].type?"*":""})).replace(z,"$1"),n,u<o&&vt(t.slice(u,o)),o<r&&vt(t=t.slice(o)),o<r&&yt(t))}d.push(n)}return St(d)}return xt.prototype=i.filters=i.pseudos,i.setFilters=new xt,s=at.tokenize=function(t,e){var n,o,r,s,a,u,c,l=C[t+" "];if(l)return e?0:l.slice(0);for(a=t,u=[],c=i.preFilter;a;){for(s in n&&!(o=j.exec(a))||(o&&(a=a.slice(o[0].length)||a),u.push(r=[])),n=!1,(o=G.exec(a))&&(n=o.shift(),r.push({value:n,type:o[0].replace(z," ")}),a=a.slice(n.length)),i.filter)!(o=W[s].exec(a))||c[s]&&!(o=c[s](o))||(n=o.shift(),r.push({value:n,type:s,matches:o}),a=a.slice(n.length));if(!n)break}return e?a.length:a?at.error(t):C(t,u).slice(0)},a=at.compile=function(t,e){var n,o=[],r=[],a=E[t+" "];if(!a){for(e||(e=s(t)),n=e.length;n--;)(a=vt(e[n]))[w]?o.push(a):r.push(a);a=E(t,function(t,e){var n=e.length>0,o=t.length>0,r=function(r,s,a,u,l){var h,f,m,_=0,x="0",y=r&&[],w=[],S=c,b=r||o&&i.find.TAG("*",l),v=T+=null==S?1:Math.random()||.1,C=b.length;for(l&&(c=s==p||s||l);x!==C&&null!=(h=b[x]);x++){if(o&&h){for(f=0,s||h.ownerDocument==p||(d(h),a=!g);m=t[f++];)if(m(h,s||p,a)){u.push(h);break}l&&(T=v)}n&&((h=!m&&h)&&_--,r&&y.push(h))}if(_+=x,n&&x!==_){for(f=0;m=e[f++];)m(y,w,s,a);if(r){if(_>0)for(;x--;)y[x]||w[x]||(w[x]=M.call(u));w=Tt(w)}V.apply(u,w),l&&!r&&w.length>0&&_+e.length>1&&at.uniqueSort(u)}return l&&(T=v,c=S),y};return n?ct(r):r}(r,o)),a.selector=t}return a},u=at.select=function(t,e,n,o){var r,u,c,l,h,d="function"==typeof t&&t,p=!o&&s(t=d.selector||t);if(n=n||[],1===p.length){if((u=p[0]=p[0].slice(0)).length>2&&"ID"===(c=u[0]).type&&9===e.nodeType&&g&&i.relative[u[1].type]){if(!(e=(i.find.ID(c.matches[0].replace(et,nt),e)||[])[0]))return n;d&&(e=e.parentNode),t=t.slice(u.shift().value.length)}for(r=W.needsContext.test(t)?0:u.length;r--&&(c=u[r],!i.relative[l=c.type]);)if((h=i.find[l])&&(o=h(c.matches[0].replace(et,nt),tt.test(u[0].type)&&_t(e.parentNode)||e))){if(u.splice(r,1),!(t=o.length&&yt(u)))return V.apply(n,o),n;break}}return(d||a(t,p))(o,e,!g,n,!e||tt.test(t)&&_t(e.parentNode)||e),n},n.sortStable=w.split("").sort(N).join("")===w,n.detectDuplicates=!!h,d(),n.sortDetached=lt((function(t){return 1&t.compareDocumentPosition(p.createElement("fieldset"))})),lt((function(t){return t.innerHTML="<a href='#'></a>","#"===t.firstChild.getAttribute("href")}))||ht("type|href|height|width",(function(t,e,n){if(!n)return t.getAttribute(e,"type"===e.toLowerCase()?1:2)})),n.attributes&&lt((function(t){return t.innerHTML="<input/>",t.firstChild.setAttribute("value",""),""===t.firstChild.getAttribute("value")}))||ht("value",(function(t,e,n){if(!n&&"input"===t.nodeName.toLowerCase())return t.defaultValue})),lt((function(t){return null==t.getAttribute("disabled")}))||ht(A,(function(t,e,n){var i;if(!n)return!0===t[e]?e.toLowerCase():(i=t.getAttributeNode(e))&&i.specified?i.value:null})),at}(i);v.find=E,v.expr=E.selectors,v.expr[":"]=v.expr.pseudos,v.uniqueSort=v.unique=E.uniqueSort,v.text=E.getText,v.isXMLDoc=E.isXML,v.contains=E.contains,v.escapeSelector=E.escape;var O=function(t,e,n){for(var i=[],o=void 0!==n;(t=t[e])&&9!==t.nodeType;)if(1===t.nodeType){if(o&&v(t).is(n))break;i.push(t)}return i},N=function(t,e){for(var n=[];t;t=t.nextSibling)1===t.nodeType&&t!==e&&n.push(t);return n},F=v.expr.match.needsContext;function I(t,e){return t.nodeName&&t.nodeName.toLowerCase()===e.toLowerCase()}var M=/^<([a-z][^\/\0>:\x20\t\r\n\f]*)[\x20\t\r\n\f]*\/?>(?:<\/\1>|)$/i;function D(t,e,n){return _(e)?v.grep(t,(function(t,i){return!!e.call(t,i,t)!==n})):e.nodeType?v.grep(t,(function(t){return t===e!==n})):"string"!=typeof e?v.grep(t,(function(t){return l.call(e,t)>-1!==n})):v.filter(e,t,n)}v.filter=function(t,e,n){var i=e[0];return n&&(t=":not("+t+")"),1===e.length&&1===i.nodeType?v.find.matchesSelector(i,t)?[i]:[]:v.find.matches(t,v.grep(e,(function(t){return 1===t.nodeType})))},v.fn.extend({find:function(t){var e,n,i=this.length,o=this;if("string"!=typeof t)return this.pushStack(v(t).filter((function(){for(e=0;e<i;e++)if(v.contains(o[e],this))return!0})));for(n=this.pushStack([]),e=0;e<i;e++)v.find(t,o[e],n);return i>1?v.uniqueSort(n):n},filter:function(t){return this.pushStack(D(this,t||[],!1))},not:function(t){return this.pushStack(D(this,t||[],!0))},is:function(t){return!!D(this,"string"==typeof t&&F.test(t)?v(t):t||[],!1).length}});var V,R=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]+))$/;(v.fn.init=function(t,e,n){var i,o;if(!t)return this;if(n=n||V,"string"==typeof t){if(!(i="<"===t[0]&&">"===t[t.length-1]&&t.length>=3?[null,t,null]:R.exec(t))||!i[1]&&e)return!e||e.jquery?(e||n).find(t):this.constructor(e).find(t);if(i[1]){if(e=e instanceof v?e[0]:e,v.merge(this,v.parseHTML(i[1],e&&e.nodeType?e.ownerDocument||e:y,!0)),M.test(i[1])&&v.isPlainObject(e))for(i in e)_(this[i])?this[i](e[i]):this.attr(i,e[i]);return this}return(o=y.getElementById(i[2]))&&(this[0]=o,this.length=1),this}return t.nodeType?(this[0]=t,this.length=1,this):_(t)?void 0!==n.ready?n.ready(t):t(v):v.makeArray(t,this)}).prototype=v.fn,V=v(y);var P=/^(?:parents|prev(?:Until|All))/,A={children:!0,contents:!0,next:!0,prev:!0};function L(t,e){for(;(t=t[e])&&1!==t.nodeType;);return t}v.fn.extend({has:function(t){var e=v(t,this),n=e.length;return this.filter((function(){for(var t=0;t<n;t++)if(v.contains(this,e[t]))return!0}))},closest:function(t,e){var n,i=0,o=this.length,r=[],s="string"!=typeof t&&v(t);if(!F.test(t))for(;i<o;i++)for(n=this[i];n&&n!==e;n=n.parentNode)if(n.nodeType<11&&(s?s.index(n)>-1:1===n.nodeType&&v.find.matchesSelector(n,t))){r.push(n);break}return this.pushStack(r.length>1?v.uniqueSort(r):r)},index:function(t){return t?"string"==typeof t?l.call(v(t),this[0]):l.call(this,t.jquery?t[0]:t):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(t,e){return this.pushStack(v.uniqueSort(v.merge(this.get(),v(t,e))))},addBack:function(t){return this.add(null==t?this.prevObject:this.prevObject.filter(t))}}),v.each({parent:function(t){var e=t.parentNode;return e&&11!==e.nodeType?e:null},parents:function(t){return O(t,"parentNode")},parentsUntil:function(t,e,n){return O(t,"parentNode",n)},next:function(t){return L(t,"nextSibling")},prev:function(t){return L(t,"previousSibling")},nextAll:function(t){return O(t,"nextSibling")},prevAll:function(t){return O(t,"previousSibling")},nextUntil:function(t,e,n){return O(t,"nextSibling",n)},prevUntil:function(t,e,n){return O(t,"previousSibling",n)},siblings:function(t){return N((t.parentNode||{}).firstChild,t)},children:function(t){return N(t.firstChild)},contents:function(t){return null!=t.contentDocument&&s(t.contentDocument)?t.contentDocument:(I(t,"template")&&(t=t.content||t),v.merge([],t.childNodes))}},(function(t,e){v.fn[t]=function(n,i){var o=v.map(this,e,n);return"Until"!==t.slice(-5)&&(i=n),i&&"string"==typeof i&&(o=v.filter(i,o)),this.length>1&&(A[t]||v.uniqueSort(o),P.test(t)&&o.reverse()),this.pushStack(o)}}));var B=/[^\x20\t\r\n\f]+/g;function X(t){return t}function U(t){throw t}function k(t,e,n,i){var o;try{t&&_(o=t.promise)?o.call(t).done(e).fail(n):t&&_(o=t.then)?o.call(t,e,n):e.apply(void 0,[t].slice(i))}catch(t){n.apply(void 0,[t])}}v.Callbacks=function(t){t="string"==typeof t?function(t){var e={};return v.each(t.match(B)||[],(function(t,n){e[n]=!0})),e}(t):v.extend({},t);var e,n,i,o,r=[],s=[],a=-1,u=function(){for(o=o||t.once,i=e=!0;s.length;a=-1)for(n=s.shift();++a<r.length;)!1===r[a].apply(n[0],n[1])&&t.stopOnFalse&&(a=r.length,n=!1);t.memory||(n=!1),e=!1,o&&(r=n?[]:"")},c={add:function(){return r&&(n&&!e&&(a=r.length-1,s.push(n)),function e(n){v.each(n,(function(n,i){_(i)?t.unique&&c.has(i)||r.push(i):i&&i.length&&"string"!==T(i)&&e(i)}))}(arguments),n&&!e&&u()),this},remove:function(){return v.each(arguments,(function(t,e){for(var n;(n=v.inArray(e,r,n))>-1;)r.splice(n,1),n<=a&&a--})),this},has:function(t){return t?v.inArray(t,r)>-1:r.length>0},empty:function(){return r&&(r=[]),this},disable:function(){return o=s=[],r=n="",this},disabled:function(){return!r},lock:function(){return o=s=[],n||e||(r=n=""),this},locked:function(){return!!o},fireWith:function(t,n){return o||(n=[t,(n=n||[]).slice?n.slice():n],s.push(n),e||u()),this},fire:function(){return c.fireWith(this,arguments),this},fired:function(){return!!i}};return c},v.extend({Deferred:function(t){var e=[["notify","progress",v.Callbacks("memory"),v.Callbacks("memory"),2],["resolve","done",v.Callbacks("once memory"),v.Callbacks("once memory"),0,"resolved"],["reject","fail",v.Callbacks("once memory"),v.Callbacks("once memory"),1,"rejected"]],n="pending",o={state:function(){return n},always:function(){return r.done(arguments).fail(arguments),this},catch:function(t){return o.then(null,t)},pipe:function(){var t=arguments;return v.Deferred((function(n){v.each(e,(function(e,i){var o=_(t[i[4]])&&t[i[4]];r[i[1]]((function(){var t=o&&o.apply(this,arguments);t&&_(t.promise)?t.promise().progress(n.notify).done(n.resolve).fail(n.reject):n[i[0]+"With"](this,o?[t]:arguments)}))})),t=null})).promise()},then:function(t,n,o){var r=0;function s(t,e,n,o){return function(){var a=this,u=arguments,c=function(){var i,c;if(!(t<r)){if((i=n.apply(a,u))===e.promise())throw new TypeError("Thenable self-resolution");c=i&&("object"==typeof i||"function"==typeof i)&&i.then,_(c)?o?c.call(i,s(r,e,X,o),s(r,e,U,o)):(r++,c.call(i,s(r,e,X,o),s(r,e,U,o),s(r,e,X,e.notifyWith))):(n!==X&&(a=void 0,u=[i]),(o||e.resolveWith)(a,u))}},l=o?c:function(){try{c()}catch(i){v.Deferred.exceptionHook&&v.Deferred.exceptionHook(i,l.stackTrace),t+1>=r&&(n!==U&&(a=void 0,u=[i]),e.rejectWith(a,u))}};t?l():(v.Deferred.getStackHook&&(l.stackTrace=v.Deferred.getStackHook()),i.setTimeout(l))}}return v.Deferred((function(i){e[0][3].add(s(0,i,_(o)?o:X,i.notifyWith)),e[1][3].add(s(0,i,_(t)?t:X)),e[2][3].add(s(0,i,_(n)?n:U))})).promise()},promise:function(t){return null!=t?v.extend(t,o):o}},r={};return v.each(e,(function(t,i){var s=i[2],a=i[5];o[i[1]]=s.add,a&&s.add((function(){n=a}),e[3-t][2].disable,e[3-t][3].disable,e[0][2].lock,e[0][3].lock),s.add(i[3].fire),r[i[0]]=function(){return r[i[0]+"With"](this===r?void 0:this,arguments),this},r[i[0]+"With"]=s.fireWith})),o.promise(r),t&&t.call(r,r),r},when:function(t){var e=arguments.length,n=e,i=Array(n),o=a.call(arguments),r=v.Deferred(),s=function(t){return function(n){i[t]=this,o[t]=arguments.length>1?a.call(arguments):n,--e||r.resolveWith(i,o)}};if(e<=1&&(k(t,r.done(s(n)).resolve,r.reject,!e),"pending"===r.state()||_(o[n]&&o[n].then)))return r.then();for(;n--;)k(o[n],s(n),r.reject);return r.promise()}});var z=/^(Eval|Internal|Range|Reference|Syntax|Type|URI)Error$/;v.Deferred.exceptionHook=function(t,e){i.console&&i.console.warn&&t&&z.test(t.name)&&i.console.warn("jQuery.Deferred exception: "+t.message,t.stack,e)},v.readyException=function(t){i.setTimeout((function(){throw t}))};var j=v.Deferred();function G(){y.removeEventListener("DOMContentLoaded",G),i.removeEventListener("load",G),v.ready()}v.fn.ready=function(t){return j.then(t).catch((function(t){v.readyException(t)})),this},v.extend({isReady:!1,readyWait:1,ready:function(t){(!0===t?--v.readyWait:v.isReady)||(v.isReady=!0,!0!==t&&--v.readyWait>0||j.resolveWith(y,[v]))}}),v.ready.then=j.then,"complete"===y.readyState||"loading"!==y.readyState&&!y.documentElement.doScroll?i.setTimeout(v.ready):(y.addEventListener("DOMContentLoaded",G),i.addEventListener("load",G));var H=function(t,e,n,i,o,r,s){var a=0,u=t.length,c=null==n;if("object"===T(n))for(a in o=!0,n)H(t,e,a,n[a],!0,r,s);else if(void 0!==i&&(o=!0,_(i)||(s=!0),c&&(s?(e.call(t,i),e=null):(c=e,e=function(t,e,n){return c.call(v(t),n)})),e))for(;a<u;a++)e(t[a],n,s?i:i.call(t[a],a,e(t[a],n)));return o?t:c?e.call(t):u?e(t[0],n):r},q=/^-ms-/,Y=/-([a-z])/g;function W(t,e){return e.toUpperCase()}function K(t){return t.replace(q,"ms-").replace(Y,W)}var J=function(t){return 1===t.nodeType||9===t.nodeType||!+t.nodeType};function Z(){this.expando=v.expando+Z.uid++}Z.uid=1,Z.prototype={cache:function(t){var e=t[this.expando];return e||(e={},J(t)&&(t.nodeType?t[this.expando]=e:Object.defineProperty(t,this.expando,{value:e,configurable:!0}))),e},set:function(t,e,n){var i,o=this.cache(t);if("string"==typeof e)o[K(e)]=n;else for(i in e)o[K(i)]=e[i];return o},get:function(t,e){return void 0===e?this.cache(t):t[this.expando]&&t[this.expando][K(e)]},access:function(t,e,n){return void 0===e||e&&"string"==typeof e&&void 0===n?this.get(t,e):(this.set(t,e,n),void 0!==n?n:e)},remove:function(t,e){var n,i=t[this.expando];if(void 0!==i){if(void 0!==e){n=(e=Array.isArray(e)?e.map(K):(e=K(e))in i?[e]:e.match(B)||[]).length;for(;n--;)delete i[e[n]]}(void 0===e||v.isEmptyObject(i))&&(t.nodeType?t[this.expando]=void 0:delete t[this.expando])}},hasData:function(t){var e=t[this.expando];return void 0!==e&&!v.isEmptyObject(e)}};var Q=new Z,$=new Z,tt=/^(?:\{[\w\W]*\}|\[[\w\W]*\])$/,et=/[A-Z]/g;function nt(t,e,n){var i;if(void 0===n&&1===t.nodeType)if(i="data-"+e.replace(et,"-$&").toLowerCase(),"string"==typeof(n=t.getAttribute(i))){try{n=function(t){return"true"===t||"false"!==t&&("null"===t?null:t===+t+""?+t:tt.test(t)?JSON.parse(t):t)}(n)}catch(t){}$.set(t,e,n)}else n=void 0;return n}v.extend({hasData:function(t){return $.hasData(t)||Q.hasData(t)},data:function(t,e,n){return $.access(t,e,n)},removeData:function(t,e){$.remove(t,e)},_data:function(t,e,n){return Q.access(t,e,n)},_removeData:function(t,e){Q.remove(t,e)}}),v.fn.extend({data:function(t,e){var n,i,o,r=this[0],s=r&&r.attributes;if(void 0===t){if(this.length&&(o=$.get(r),1===r.nodeType&&!Q.get(r,"hasDataAttrs"))){for(n=s.length;n--;)s[n]&&0===(i=s[n].name).indexOf("data-")&&(i=K(i.slice(5)),nt(r,i,o[i]));Q.set(r,"hasDataAttrs",!0)}return o}return"object"==typeof t?this.each((function(){$.set(this,t)})):H(this,(function(e){var n;if(r&&void 0===e)return void 0!==(n=$.get(r,t))||void 0!==(n=nt(r,t))?n:void 0;this.each((function(){$.set(this,t,e)}))}),null,e,arguments.length>1,null,!0)},removeData:function(t){return this.each((function(){$.remove(this,t)}))}}),v.extend({queue:function(t,e,n){var i;if(t)return e=(e||"fx")+"queue",i=Q.get(t,e),n&&(!i||Array.isArray(n)?i=Q.access(t,e,v.makeArray(n)):i.push(n)),i||[]},dequeue:function(t,e){e=e||"fx";var n=v.queue(t,e),i=n.length,o=n.shift(),r=v._queueHooks(t,e);"inprogress"===o&&(o=n.shift(),i--),o&&("fx"===e&&n.unshift("inprogress"),delete r.stop,o.call(t,(function(){v.dequeue(t,e)}),r)),!i&&r&&r.empty.fire()},_queueHooks:function(t,e){var n=e+"queueHooks";return Q.get(t,n)||Q.access(t,n,{empty:v.Callbacks("once memory").add((function(){Q.remove(t,[e+"queue",n])}))})}}),v.fn.extend({queue:function(t,e){var n=2;return"string"!=typeof t&&(e=t,t="fx",n--),arguments.length<n?v.queue(this[0],t):void 0===e?this:this.each((function(){var n=v.queue(this,t,e);v._queueHooks(this,t),"fx"===t&&"inprogress"!==n[0]&&v.dequeue(this,t)}))},dequeue:function(t){return this.each((function(){v.dequeue(this,t)}))},clearQueue:function(t){return this.queue(t||"fx",[])},promise:function(t,e){var n,i=1,o=v.Deferred(),r=this,s=this.length,a=function(){--i||o.resolveWith(r,[r])};for("string"!=typeof t&&(e=t,t=void 0),t=t||"fx";s--;)(n=Q.get(r[s],t+"queueHooks"))&&n.empty&&(i++,n.empty.add(a));return a(),o.promise(e)}});var it=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,ot=new RegExp("^(?:([+-])=|)("+it+")([a-z%]*)$","i"),rt=["Top","Right","Bottom","Left"],st=y.documentElement,at=function(t){return v.contains(t.ownerDocument,t)},ut={composed:!0};st.getRootNode&&(at=function(t){return v.contains(t.ownerDocument,t)||t.getRootNode(ut)===t.ownerDocument});var ct=function(t,e){return"none"===(t=e||t).style.display||""===t.style.display&&at(t)&&"none"===v.css(t,"display")};function lt(t,e,n,i){var o,r,s=20,a=i?function(){return i.cur()}:function(){return v.css(t,e,"")},u=a(),c=n&&n[3]||(v.cssNumber[e]?"":"px"),l=t.nodeType&&(v.cssNumber[e]||"px"!==c&&+u)&&ot.exec(v.css(t,e));if(l&&l[3]!==c){for(u/=2,c=c||l[3],l=+u||1;s--;)v.style(t,e,l+c),(1-r)*(1-(r=a()/u||.5))<=0&&(s=0),l/=r;l*=2,v.style(t,e,l+c),n=n||[]}return n&&(l=+l||+u||0,o=n[1]?l+(n[1]+1)*n[2]:+n[2],i&&(i.unit=c,i.start=l,i.end=o)),o}var ht={};function dt(t){var e,n=t.ownerDocument,i=t.nodeName,o=ht[i];return o||(e=n.body.appendChild(n.createElement(i)),o=v.css(e,"display"),e.parentNode.removeChild(e),"none"===o&&(o="block"),ht[i]=o,o)}function pt(t,e){for(var n,i,o=[],r=0,s=t.length;r<s;r++)(i=t[r]).style&&(n=i.style.display,e?("none"===n&&(o[r]=Q.get(i,"display")||null,o[r]||(i.style.display="")),""===i.style.display&&ct(i)&&(o[r]=dt(i))):"none"!==n&&(o[r]="none",Q.set(i,"display",n)));for(r=0;r<s;r++)null!=o[r]&&(t[r].style.display=o[r]);return t}v.fn.extend({show:function(){return pt(this,!0)},hide:function(){return pt(this)},toggle:function(t){return"boolean"==typeof t?t?this.show():this.hide():this.each((function(){ct(this)?v(this).show():v(this).hide()}))}});var ft,gt,mt=/^(?:checkbox|radio)$/i,_t=/<([a-z][^\/\0>\x20\t\r\n\f]*)/i,xt=/^$|^module$|\/(?:java|ecma)script/i;ft=y.createDocumentFragment().appendChild(y.createElement("div")),(gt=y.createElement("input")).setAttribute("type","radio"),gt.setAttribute("checked","checked"),gt.setAttribute("name","t"),ft.appendChild(gt),m.checkClone=ft.cloneNode(!0).cloneNode(!0).lastChild.checked,ft.innerHTML="<textarea>x</textarea>",m.noCloneChecked=!!ft.cloneNode(!0).lastChild.defaultValue,ft.innerHTML="<option></option>",m.option=!!ft.lastChild;var yt={thead:[1,"<table>","</table>"],col:[2,"<table><colgroup>","</colgroup></table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:[0,"",""]};function wt(t,e){var n;return n=void 0!==t.getElementsByTagName?t.getElementsByTagName(e||"*"):void 0!==t.querySelectorAll?t.querySelectorAll(e||"*"):[],void 0===e||e&&I(t,e)?v.merge([t],n):n}function St(t,e){for(var n=0,i=t.length;n<i;n++)Q.set(t[n],"globalEval",!e||Q.get(e[n],"globalEval"))}yt.tbody=yt.tfoot=yt.colgroup=yt.caption=yt.thead,yt.th=yt.td,m.option||(yt.optgroup=yt.option=[1,"<select multiple='multiple'>","</select>"]);var Tt=/<|&#?\w+;/;function bt(t,e,n,i,o){for(var r,s,a,u,c,l,h=e.createDocumentFragment(),d=[],p=0,f=t.length;p<f;p++)if((r=t[p])||0===r)if("object"===T(r))v.merge(d,r.nodeType?[r]:r);else if(Tt.test(r)){for(s=s||h.appendChild(e.createElement("div")),a=(_t.exec(r)||["",""])[1].toLowerCase(),u=yt[a]||yt._default,s.innerHTML=u[1]+v.htmlPrefilter(r)+u[2],l=u[0];l--;)s=s.lastChild;v.merge(d,s.childNodes),(s=h.firstChild).textContent=""}else d.push(e.createTextNode(r));for(h.textContent="",p=0;r=d[p++];)if(i&&v.inArray(r,i)>-1)o&&o.push(r);else if(c=at(r),s=wt(h.appendChild(r),"script"),c&&St(s),n)for(l=0;r=s[l++];)xt.test(r.type||"")&&n.push(r);return h}var vt=/^([^.]*)(?:\.(.+)|)/;function Ct(){return!0}function Et(){return!1}function Ot(t,e){return t===function(){try{return y.activeElement}catch(t){}}()==("focus"===e)}function Nt(t,e,n,i,o,r){var s,a;if("object"==typeof e){for(a in"string"!=typeof n&&(i=i||n,n=void 0),e)Nt(t,a,n,i,e[a],r);return t}if(null==i&&null==o?(o=n,i=n=void 0):null==o&&("string"==typeof n?(o=i,i=void 0):(o=i,i=n,n=void 0)),!1===o)o=Et;else if(!o)return t;return 1===r&&(s=o,o=function(t){return v().off(t),s.apply(this,arguments)},o.guid=s.guid||(s.guid=v.guid++)),t.each((function(){v.event.add(this,e,o,i,n)}))}function Ft(t,e,n){n?(Q.set(t,e,!1),v.event.add(t,e,{namespace:!1,handler:function(t){var i,o,r=Q.get(this,e);if(1&t.isTrigger&&this[e]){if(r.length)(v.event.special[e]||{}).delegateType&&t.stopPropagation();else if(r=a.call(arguments),Q.set(this,e,r),i=n(this,e),this[e](),r!==(o=Q.get(this,e))||i?Q.set(this,e,!1):o={},r!==o)return t.stopImmediatePropagation(),t.preventDefault(),o&&o.value}else r.length&&(Q.set(this,e,{value:v.event.trigger(v.extend(r[0],v.Event.prototype),r.slice(1),this)}),t.stopImmediatePropagation())}})):void 0===Q.get(t,e)&&v.event.add(t,e,Ct)}v.event={global:{},add:function(t,e,n,i,o){var r,s,a,u,c,l,h,d,p,f,g,m=Q.get(t);if(J(t))for(n.handler&&(n=(r=n).handler,o=r.selector),o&&v.find.matchesSelector(st,o),n.guid||(n.guid=v.guid++),(u=m.events)||(u=m.events=Object.create(null)),(s=m.handle)||(s=m.handle=function(e){return void 0!==v&&v.event.triggered!==e.type?v.event.dispatch.apply(t,arguments):void 0}),c=(e=(e||"").match(B)||[""]).length;c--;)p=g=(a=vt.exec(e[c])||[])[1],f=(a[2]||"").split(".").sort(),p&&(h=v.event.special[p]||{},p=(o?h.delegateType:h.bindType)||p,h=v.event.special[p]||{},l=v.extend({type:p,origType:g,data:i,handler:n,guid:n.guid,selector:o,needsContext:o&&v.expr.match.needsContext.test(o),namespace:f.join(".")},r),(d=u[p])||((d=u[p]=[]).delegateCount=0,h.setup&&!1!==h.setup.call(t,i,f,s)||t.addEventListener&&t.addEventListener(p,s)),h.add&&(h.add.call(t,l),l.handler.guid||(l.handler.guid=n.guid)),o?d.splice(d.delegateCount++,0,l):d.push(l),v.event.global[p]=!0)},remove:function(t,e,n,i,o){var r,s,a,u,c,l,h,d,p,f,g,m=Q.hasData(t)&&Q.get(t);if(m&&(u=m.events)){for(c=(e=(e||"").match(B)||[""]).length;c--;)if(p=g=(a=vt.exec(e[c])||[])[1],f=(a[2]||"").split(".").sort(),p){for(h=v.event.special[p]||{},d=u[p=(i?h.delegateType:h.bindType)||p]||[],a=a[2]&&new RegExp("(^|\\.)"+f.join("\\.(?:.*\\.|)")+"(\\.|$)"),s=r=d.length;r--;)l=d[r],!o&&g!==l.origType||n&&n.guid!==l.guid||a&&!a.test(l.namespace)||i&&i!==l.selector&&("**"!==i||!l.selector)||(d.splice(r,1),l.selector&&d.delegateCount--,h.remove&&h.remove.call(t,l));s&&!d.length&&(h.teardown&&!1!==h.teardown.call(t,f,m.handle)||v.removeEvent(t,p,m.handle),delete u[p])}else for(p in u)v.event.remove(t,p+e[c],n,i,!0);v.isEmptyObject(u)&&Q.remove(t,"handle events")}},dispatch:function(t){var e,n,i,o,r,s,a=new Array(arguments.length),u=v.event.fix(t),c=(Q.get(this,"events")||Object.create(null))[u.type]||[],l=v.event.special[u.type]||{};for(a[0]=u,e=1;e<arguments.length;e++)a[e]=arguments[e];if(u.delegateTarget=this,!l.preDispatch||!1!==l.preDispatch.call(this,u)){for(s=v.event.handlers.call(this,u,c),e=0;(o=s[e++])&&!u.isPropagationStopped();)for(u.currentTarget=o.elem,n=0;(r=o.handlers[n++])&&!u.isImmediatePropagationStopped();)u.rnamespace&&!1!==r.namespace&&!u.rnamespace.test(r.namespace)||(u.handleObj=r,u.data=r.data,void 0!==(i=((v.event.special[r.origType]||{}).handle||r.handler).apply(o.elem,a))&&!1===(u.result=i)&&(u.preventDefault(),u.stopPropagation()));return l.postDispatch&&l.postDispatch.call(this,u),u.result}},handlers:function(t,e){var n,i,o,r,s,a=[],u=e.delegateCount,c=t.target;if(u&&c.nodeType&&!("click"===t.type&&t.button>=1))for(;c!==this;c=c.parentNode||this)if(1===c.nodeType&&("click"!==t.type||!0!==c.disabled)){for(r=[],s={},n=0;n<u;n++)void 0===s[o=(i=e[n]).selector+" "]&&(s[o]=i.needsContext?v(o,this).index(c)>-1:v.find(o,this,null,[c]).length),s[o]&&r.push(i);r.length&&a.push({elem:c,handlers:r})}return c=this,u<e.length&&a.push({elem:c,handlers:e.slice(u)}),a},addProp:function(t,e){Object.defineProperty(v.Event.prototype,t,{enumerable:!0,configurable:!0,get:_(e)?function(){if(this.originalEvent)return e(this.originalEvent)}:function(){if(this.originalEvent)return this.originalEvent[t]},set:function(e){Object.defineProperty(this,t,{enumerable:!0,configurable:!0,writable:!0,value:e})}})},fix:function(t){return t[v.expando]?t:new v.Event(t)},special:{load:{noBubble:!0},click:{setup:function(t){var e=this||t;return mt.test(e.type)&&e.click&&I(e,"input")&&Ft(e,"click",Ct),!1},trigger:function(t){var e=this||t;return mt.test(e.type)&&e.click&&I(e,"input")&&Ft(e,"click"),!0},_default:function(t){var e=t.target;return mt.test(e.type)&&e.click&&I(e,"input")&&Q.get(e,"click")||I(e,"a")}},beforeunload:{postDispatch:function(t){void 0!==t.result&&t.originalEvent&&(t.originalEvent.returnValue=t.result)}}}},v.removeEvent=function(t,e,n){t.removeEventListener&&t.removeEventListener(e,n)},v.Event=function(t,e){if(!(this instanceof v.Event))return new v.Event(t,e);t&&t.type?(this.originalEvent=t,this.type=t.type,this.isDefaultPrevented=t.defaultPrevented||void 0===t.defaultPrevented&&!1===t.returnValue?Ct:Et,this.target=t.target&&3===t.target.nodeType?t.target.parentNode:t.target,this.currentTarget=t.currentTarget,this.relatedTarget=t.relatedTarget):this.type=t,e&&v.extend(this,e),this.timeStamp=t&&t.timeStamp||Date.now(),this[v.expando]=!0},v.Event.prototype={constructor:v.Event,isDefaultPrevented:Et,isPropagationStopped:Et,isImmediatePropagationStopped:Et,isSimulated:!1,preventDefault:function(){var t=this.originalEvent;this.isDefaultPrevented=Ct,t&&!this.isSimulated&&t.preventDefault()},stopPropagation:function(){var t=this.originalEvent;this.isPropagationStopped=Ct,t&&!this.isSimulated&&t.stopPropagation()},stopImmediatePropagation:function(){var t=this.originalEvent;this.isImmediatePropagationStopped=Ct,t&&!this.isSimulated&&t.stopImmediatePropagation(),this.stopPropagation()}},v.each({altKey:!0,bubbles:!0,cancelable:!0,changedTouches:!0,ctrlKey:!0,detail:!0,eventPhase:!0,metaKey:!0,pageX:!0,pageY:!0,shiftKey:!0,view:!0,char:!0,code:!0,charCode:!0,key:!0,keyCode:!0,button:!0,buttons:!0,clientX:!0,clientY:!0,offsetX:!0,offsetY:!0,pointerId:!0,pointerType:!0,screenX:!0,screenY:!0,targetTouches:!0,toElement:!0,touches:!0,which:!0},v.event.addProp),v.each({focus:"focusin",blur:"focusout"},(function(t,e){v.event.special[t]={setup:function(){return Ft(this,t,Ot),!1},trigger:function(){return Ft(this,t),!0},_default:function(e){return Q.get(e.target,t)},delegateType:e}})),v.each({mouseenter:"mouseover",mouseleave:"mouseout",pointerenter:"pointerover",pointerleave:"pointerout"},(function(t,e){v.event.special[t]={delegateType:e,bindType:e,handle:function(t){var n,i=this,o=t.relatedTarget,r=t.handleObj;return o&&(o===i||v.contains(i,o))||(t.type=r.origType,n=r.handler.apply(this,arguments),t.type=e),n}}})),v.fn.extend({on:function(t,e,n,i){return Nt(this,t,e,n,i)},one:function(t,e,n,i){return Nt(this,t,e,n,i,1)},off:function(t,e,n){var i,o;if(t&&t.preventDefault&&t.handleObj)return i=t.handleObj,v(t.delegateTarget).off(i.namespace?i.origType+"."+i.namespace:i.origType,i.selector,i.handler),this;if("object"==typeof t){for(o in t)this.off(o,e,t[o]);return this}return!1!==e&&"function"!=typeof e||(n=e,e=void 0),!1===n&&(n=Et),this.each((function(){v.event.remove(this,t,n,e)}))}});var It=/<script|<style|<link/i,Mt=/checked\s*(?:[^=]|=\s*.checked.)/i,Dt=/^\s*<!\[CDATA\[|\]\]>\s*$/g;function Vt(t,e){return I(t,"table")&&I(11!==e.nodeType?e:e.firstChild,"tr")&&v(t).children("tbody")[0]||t}function Rt(t){return t.type=(null!==t.getAttribute("type"))+"/"+t.type,t}function Pt(t){return"true/"===(t.type||"").slice(0,5)?t.type=t.type.slice(5):t.removeAttribute("type"),t}function At(t,e){var n,i,o,r,s,a;if(1===e.nodeType){if(Q.hasData(t)&&(a=Q.get(t).events))for(o in Q.remove(e,"handle events"),a)for(n=0,i=a[o].length;n<i;n++)v.event.add(e,o,a[o][n]);$.hasData(t)&&(r=$.access(t),s=v.extend({},r),$.set(e,s))}}function Lt(t,e){var n=e.nodeName.toLowerCase();"input"===n&&mt.test(t.type)?e.checked=t.checked:"input"!==n&&"textarea"!==n||(e.defaultValue=t.defaultValue)}function Bt(t,e,n,i){e=u(e);var o,r,s,a,c,l,h=0,d=t.length,p=d-1,f=e[0],g=_(f);if(g||d>1&&"string"==typeof f&&!m.checkClone&&Mt.test(f))return t.each((function(o){var r=t.eq(o);g&&(e[0]=f.call(this,o,r.html())),Bt(r,e,n,i)}));if(d&&(r=(o=bt(e,t[0].ownerDocument,!1,t,i)).firstChild,1===o.childNodes.length&&(o=r),r||i)){for(a=(s=v.map(wt(o,"script"),Rt)).length;h<d;h++)c=o,h!==p&&(c=v.clone(c,!0,!0),a&&v.merge(s,wt(c,"script"))),n.call(t[h],c,h);if(a)for(l=s[s.length-1].ownerDocument,v.map(s,Pt),h=0;h<a;h++)c=s[h],xt.test(c.type||"")&&!Q.access(c,"globalEval")&&v.contains(l,c)&&(c.src&&"module"!==(c.type||"").toLowerCase()?v._evalUrl&&!c.noModule&&v._evalUrl(c.src,{nonce:c.nonce||c.getAttribute("nonce")},l):S(c.textContent.replace(Dt,""),c,l))}return t}function Xt(t,e,n){for(var i,o=e?v.filter(e,t):t,r=0;null!=(i=o[r]);r++)n||1!==i.nodeType||v.cleanData(wt(i)),i.parentNode&&(n&&at(i)&&St(wt(i,"script")),i.parentNode.removeChild(i));return t}v.extend({htmlPrefilter:function(t){return t},clone:function(t,e,n){var i,o,r,s,a=t.cloneNode(!0),u=at(t);if(!(m.noCloneChecked||1!==t.nodeType&&11!==t.nodeType||v.isXMLDoc(t)))for(s=wt(a),i=0,o=(r=wt(t)).length;i<o;i++)Lt(r[i],s[i]);if(e)if(n)for(r=r||wt(t),s=s||wt(a),i=0,o=r.length;i<o;i++)At(r[i],s[i]);else At(t,a);return(s=wt(a,"script")).length>0&&St(s,!u&&wt(t,"script")),a},cleanData:function(t){for(var e,n,i,o=v.event.special,r=0;void 0!==(n=t[r]);r++)if(J(n)){if(e=n[Q.expando]){if(e.events)for(i in e.events)o[i]?v.event.remove(n,i):v.removeEvent(n,i,e.handle);n[Q.expando]=void 0}n[$.expando]&&(n[$.expando]=void 0)}}}),v.fn.extend({detach:function(t){return Xt(this,t,!0)},remove:function(t){return Xt(this,t)},text:function(t){return H(this,(function(t){return void 0===t?v.text(this):this.empty().each((function(){1!==this.nodeType&&11!==this.nodeType&&9!==this.nodeType||(this.textContent=t)}))}),null,t,arguments.length)},append:function(){return Bt(this,arguments,(function(t){1!==this.nodeType&&11!==this.nodeType&&9!==this.nodeType||Vt(this,t).appendChild(t)}))},prepend:function(){return Bt(this,arguments,(function(t){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var e=Vt(this,t);e.insertBefore(t,e.firstChild)}}))},before:function(){return Bt(this,arguments,(function(t){this.parentNode&&this.parentNode.insertBefore(t,this)}))},after:function(){return Bt(this,arguments,(function(t){this.parentNode&&this.parentNode.insertBefore(t,this.nextSibling)}))},empty:function(){for(var t,e=0;null!=(t=this[e]);e++)1===t.nodeType&&(v.cleanData(wt(t,!1)),t.textContent="");return this},clone:function(t,e){return t=null!=t&&t,e=null==e?t:e,this.map((function(){return v.clone(this,t,e)}))},html:function(t){return H(this,(function(t){var e=this[0]||{},n=0,i=this.length;if(void 0===t&&1===e.nodeType)return e.innerHTML;if("string"==typeof t&&!It.test(t)&&!yt[(_t.exec(t)||["",""])[1].toLowerCase()]){t=v.htmlPrefilter(t);try{for(;n<i;n++)1===(e=this[n]||{}).nodeType&&(v.cleanData(wt(e,!1)),e.innerHTML=t);e=0}catch(t){}}e&&this.empty().append(t)}),null,t,arguments.length)},replaceWith:function(){var t=[];return Bt(this,arguments,(function(e){var n=this.parentNode;v.inArray(this,t)<0&&(v.cleanData(wt(this)),n&&n.replaceChild(e,this))}),t)}}),v.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},(function(t,e){v.fn[t]=function(t){for(var n,i=[],o=v(t),r=o.length-1,s=0;s<=r;s++)n=s===r?this:this.clone(!0),v(o[s])[e](n),c.apply(i,n.get());return this.pushStack(i)}}));var Ut=new RegExp("^("+it+")(?!px)[a-z%]+$","i"),kt=/^--/,zt=function(t){var e=t.ownerDocument.defaultView;return e&&e.opener||(e=i),e.getComputedStyle(t)},jt=function(t,e,n){var i,o,r={};for(o in e)r[o]=t.style[o],t.style[o]=e[o];for(o in i=n.call(t),e)t.style[o]=r[o];return i},Gt=new RegExp(rt.join("|"),"i"),Ht="[\\x20\\t\\r\\n\\f]",qt=new RegExp("^"+Ht+"+|((?:^|[^\\\\])(?:\\\\.)*)"+Ht+"+$","g");function Yt(t,e,n){var i,o,r,s,a=kt.test(e),u=t.style;return(n=n||zt(t))&&(s=n.getPropertyValue(e)||n[e],a&&s&&(s=s.replace(qt,"$1")||void 0),""!==s||at(t)||(s=v.style(t,e)),!m.pixelBoxStyles()&&Ut.test(s)&&Gt.test(e)&&(i=u.width,o=u.minWidth,r=u.maxWidth,u.minWidth=u.maxWidth=u.width=s,s=n.width,u.width=i,u.minWidth=o,u.maxWidth=r)),void 0!==s?s+"":s}function Wt(t,e){return{get:function(){if(!t())return(this.get=e).apply(this,arguments);delete this.get}}}!function(){function t(){if(l){c.style.cssText="position:absolute;left:-11111px;width:60px;margin-top:1px;padding:0;border:0",l.style.cssText="position:relative;display:block;box-sizing:border-box;overflow:scroll;margin:auto;border:1px;padding:1px;width:60%;top:1%",st.appendChild(c).appendChild(l);var t=i.getComputedStyle(l);n="1%"!==t.top,u=12===e(t.marginLeft),l.style.right="60%",s=36===e(t.right),o=36===e(t.width),l.style.position="absolute",r=12===e(l.offsetWidth/3),st.removeChild(c),l=null}}function e(t){return Math.round(parseFloat(t))}var n,o,r,s,a,u,c=y.createElement("div"),l=y.createElement("div");l.style&&(l.style.backgroundClip="content-box",l.cloneNode(!0).style.backgroundClip="",m.clearCloneStyle="content-box"===l.style.backgroundClip,v.extend(m,{boxSizingReliable:function(){return t(),o},pixelBoxStyles:function(){return t(),s},pixelPosition:function(){return t(),n},reliableMarginLeft:function(){return t(),u},scrollboxSize:function(){return t(),r},reliableTrDimensions:function(){var t,e,n,o;return null==a&&(t=y.createElement("table"),e=y.createElement("tr"),n=y.createElement("div"),t.style.cssText="position:absolute;left:-11111px;border-collapse:separate",e.style.cssText="border:1px solid",e.style.height="1px",n.style.height="9px",n.style.display="block",st.appendChild(t).appendChild(e).appendChild(n),o=i.getComputedStyle(e),a=parseInt(o.height,10)+parseInt(o.borderTopWidth,10)+parseInt(o.borderBottomWidth,10)===e.offsetHeight,st.removeChild(t)),a}}))}();var Kt=["Webkit","Moz","ms"],Jt=y.createElement("div").style,Zt={};function Qt(t){var e=v.cssProps[t]||Zt[t];return e||(t in Jt?t:Zt[t]=function(t){for(var e=t[0].toUpperCase()+t.slice(1),n=Kt.length;n--;)if((t=Kt[n]+e)in Jt)return t}(t)||t)}var $t=/^(none|table(?!-c[ea]).+)/,te={position:"absolute",visibility:"hidden",display:"block"},ee={letterSpacing:"0",fontWeight:"400"};function ne(t,e,n){var i=ot.exec(e);return i?Math.max(0,i[2]-(n||0))+(i[3]||"px"):e}function ie(t,e,n,i,o,r){var s="width"===e?1:0,a=0,u=0;if(n===(i?"border":"content"))return 0;for(;s<4;s+=2)"margin"===n&&(u+=v.css(t,n+rt[s],!0,o)),i?("content"===n&&(u-=v.css(t,"padding"+rt[s],!0,o)),"margin"!==n&&(u-=v.css(t,"border"+rt[s]+"Width",!0,o))):(u+=v.css(t,"padding"+rt[s],!0,o),"padding"!==n?u+=v.css(t,"border"+rt[s]+"Width",!0,o):a+=v.css(t,"border"+rt[s]+"Width",!0,o));return!i&&r>=0&&(u+=Math.max(0,Math.ceil(t["offset"+e[0].toUpperCase()+e.slice(1)]-r-u-a-.5))||0),u}function oe(t,e,n){var i=zt(t),o=(!m.boxSizingReliable()||n)&&"border-box"===v.css(t,"boxSizing",!1,i),r=o,s=Yt(t,e,i),a="offset"+e[0].toUpperCase()+e.slice(1);if(Ut.test(s)){if(!n)return s;s="auto"}return(!m.boxSizingReliable()&&o||!m.reliableTrDimensions()&&I(t,"tr")||"auto"===s||!parseFloat(s)&&"inline"===v.css(t,"display",!1,i))&&t.getClientRects().length&&(o="border-box"===v.css(t,"boxSizing",!1,i),(r=a in t)&&(s=t[a])),(s=parseFloat(s)||0)+ie(t,e,n||(o?"border":"content"),r,i,s)+"px"}function re(t,e,n,i,o){return new re.prototype.init(t,e,n,i,o)}v.extend({cssHooks:{opacity:{get:function(t,e){if(e){var n=Yt(t,"opacity");return""===n?"1":n}}}},cssNumber:{animationIterationCount:!0,columnCount:!0,fillOpacity:!0,flexGrow:!0,flexShrink:!0,fontWeight:!0,gridArea:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnStart:!0,gridRow:!0,gridRowEnd:!0,gridRowStart:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{},style:function(t,e,n,i){if(t&&3!==t.nodeType&&8!==t.nodeType&&t.style){var o,r,s,a=K(e),u=kt.test(e),c=t.style;if(u||(e=Qt(a)),s=v.cssHooks[e]||v.cssHooks[a],void 0===n)return s&&"get"in s&&void 0!==(o=s.get(t,!1,i))?o:c[e];"string"===(r=typeof n)&&(o=ot.exec(n))&&o[1]&&(n=lt(t,e,o),r="number"),null!=n&&n==n&&("number"!==r||u||(n+=o&&o[3]||(v.cssNumber[a]?"":"px")),m.clearCloneStyle||""!==n||0!==e.indexOf("background")||(c[e]="inherit"),s&&"set"in s&&void 0===(n=s.set(t,n,i))||(u?c.setProperty(e,n):c[e]=n))}},css:function(t,e,n,i){var o,r,s,a=K(e);return kt.test(e)||(e=Qt(a)),(s=v.cssHooks[e]||v.cssHooks[a])&&"get"in s&&(o=s.get(t,!0,n)),void 0===o&&(o=Yt(t,e,i)),"normal"===o&&e in ee&&(o=ee[e]),""===n||n?(r=parseFloat(o),!0===n||isFinite(r)?r||0:o):o}}),v.each(["height","width"],(function(t,e){v.cssHooks[e]={get:function(t,n,i){if(n)return!$t.test(v.css(t,"display"))||t.getClientRects().length&&t.getBoundingClientRect().width?oe(t,e,i):jt(t,te,(function(){return oe(t,e,i)}))},set:function(t,n,i){var o,r=zt(t),s=!m.scrollboxSize()&&"absolute"===r.position,a=(s||i)&&"border-box"===v.css(t,"boxSizing",!1,r),u=i?ie(t,e,i,a,r):0;return a&&s&&(u-=Math.ceil(t["offset"+e[0].toUpperCase()+e.slice(1)]-parseFloat(r[e])-ie(t,e,"border",!1,r)-.5)),u&&(o=ot.exec(n))&&"px"!==(o[3]||"px")&&(t.style[e]=n,n=v.css(t,e)),ne(0,n,u)}}})),v.cssHooks.marginLeft=Wt(m.reliableMarginLeft,(function(t,e){if(e)return(parseFloat(Yt(t,"marginLeft"))||t.getBoundingClientRect().left-jt(t,{marginLeft:0},(function(){return t.getBoundingClientRect().left})))+"px"})),v.each({margin:"",padding:"",border:"Width"},(function(t,e){v.cssHooks[t+e]={expand:function(n){for(var i=0,o={},r="string"==typeof n?n.split(" "):[n];i<4;i++)o[t+rt[i]+e]=r[i]||r[i-2]||r[0];return o}},"margin"!==t&&(v.cssHooks[t+e].set=ne)})),v.fn.extend({css:function(t,e){return H(this,(function(t,e,n){var i,o,r={},s=0;if(Array.isArray(e)){for(i=zt(t),o=e.length;s<o;s++)r[e[s]]=v.css(t,e[s],!1,i);return r}return void 0!==n?v.style(t,e,n):v.css(t,e)}),t,e,arguments.length>1)}}),v.Tween=re,re.prototype={constructor:re,init:function(t,e,n,i,o,r){this.elem=t,this.prop=n,this.easing=o||v.easing._default,this.options=e,this.start=this.now=this.cur(),this.end=i,this.unit=r||(v.cssNumber[n]?"":"px")},cur:function(){var t=re.propHooks[this.prop];return t&&t.get?t.get(this):re.propHooks._default.get(this)},run:function(t){var e,n=re.propHooks[this.prop];return this.options.duration?this.pos=e=v.easing[this.easing](t,this.options.duration*t,0,1,this.options.duration):this.pos=e=t,this.now=(this.end-this.start)*e+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),n&&n.set?n.set(this):re.propHooks._default.set(this),this}},re.prototype.init.prototype=re.prototype,re.propHooks={_default:{get:function(t){var e;return 1!==t.elem.nodeType||null!=t.elem[t.prop]&&null==t.elem.style[t.prop]?t.elem[t.prop]:(e=v.css(t.elem,t.prop,""))&&"auto"!==e?e:0},set:function(t){v.fx.step[t.prop]?v.fx.step[t.prop](t):1!==t.elem.nodeType||!v.cssHooks[t.prop]&&null==t.elem.style[Qt(t.prop)]?t.elem[t.prop]=t.now:v.style(t.elem,t.prop,t.now+t.unit)}}},re.propHooks.scrollTop=re.propHooks.scrollLeft={set:function(t){t.elem.nodeType&&t.elem.parentNode&&(t.elem[t.prop]=t.now)}},v.easing={linear:function(t){return t},swing:function(t){return.5-Math.cos(t*Math.PI)/2},_default:"swing"},v.fx=re.prototype.init,v.fx.step={};var se,ae,ue=/^(?:toggle|show|hide)$/,ce=/queueHooks$/;function le(){ae&&(!1===y.hidden&&i.requestAnimationFrame?i.requestAnimationFrame(le):i.setTimeout(le,v.fx.interval),v.fx.tick())}function he(){return i.setTimeout((function(){se=void 0})),se=Date.now()}function de(t,e){var n,i=0,o={height:t};for(e=e?1:0;i<4;i+=2-e)o["margin"+(n=rt[i])]=o["padding"+n]=t;return e&&(o.opacity=o.width=t),o}function pe(t,e,n){for(var i,o=(fe.tweeners[e]||[]).concat(fe.tweeners["*"]),r=0,s=o.length;r<s;r++)if(i=o[r].call(n,e,t))return i}function fe(t,e,n){var i,o,r=0,s=fe.prefilters.length,a=v.Deferred().always((function(){delete u.elem})),u=function(){if(o)return!1;for(var e=se||he(),n=Math.max(0,c.startTime+c.duration-e),i=1-(n/c.duration||0),r=0,s=c.tweens.length;r<s;r++)c.tweens[r].run(i);return a.notifyWith(t,[c,i,n]),i<1&&s?n:(s||a.notifyWith(t,[c,1,0]),a.resolveWith(t,[c]),!1)},c=a.promise({elem:t,props:v.extend({},e),opts:v.extend(!0,{specialEasing:{},easing:v.easing._default},n),originalProperties:e,originalOptions:n,startTime:se||he(),duration:n.duration,tweens:[],createTween:function(e,n){var i=v.Tween(t,c.opts,e,n,c.opts.specialEasing[e]||c.opts.easing);return c.tweens.push(i),i},stop:function(e){var n=0,i=e?c.tweens.length:0;if(o)return this;for(o=!0;n<i;n++)c.tweens[n].run(1);return e?(a.notifyWith(t,[c,1,0]),a.resolveWith(t,[c,e])):a.rejectWith(t,[c,e]),this}}),l=c.props;for(!function(t,e){var n,i,o,r,s;for(n in t)if(o=e[i=K(n)],r=t[n],Array.isArray(r)&&(o=r[1],r=t[n]=r[0]),n!==i&&(t[i]=r,delete t[n]),(s=v.cssHooks[i])&&"expand"in s)for(n in r=s.expand(r),delete t[i],r)n in t||(t[n]=r[n],e[n]=o);else e[i]=o}(l,c.opts.specialEasing);r<s;r++)if(i=fe.prefilters[r].call(c,t,l,c.opts))return _(i.stop)&&(v._queueHooks(c.elem,c.opts.queue).stop=i.stop.bind(i)),i;return v.map(l,pe,c),_(c.opts.start)&&c.opts.start.call(t,c),c.progress(c.opts.progress).done(c.opts.done,c.opts.complete).fail(c.opts.fail).always(c.opts.always),v.fx.timer(v.extend(u,{elem:t,anim:c,queue:c.opts.queue})),c}v.Animation=v.extend(fe,{tweeners:{"*":[function(t,e){var n=this.createTween(t,e);return lt(n.elem,t,ot.exec(e),n),n}]},tweener:function(t,e){_(t)?(e=t,t=["*"]):t=t.match(B);for(var n,i=0,o=t.length;i<o;i++)n=t[i],fe.tweeners[n]=fe.tweeners[n]||[],fe.tweeners[n].unshift(e)},prefilters:[function(t,e,n){var i,o,r,s,a,u,c,l,h="width"in e||"height"in e,d=this,p={},f=t.style,g=t.nodeType&&ct(t),m=Q.get(t,"fxshow");for(i in n.queue||(null==(s=v._queueHooks(t,"fx")).unqueued&&(s.unqueued=0,a=s.empty.fire,s.empty.fire=function(){s.unqueued||a()}),s.unqueued++,d.always((function(){d.always((function(){s.unqueued--,v.queue(t,"fx").length||s.empty.fire()}))}))),e)if(o=e[i],ue.test(o)){if(delete e[i],r=r||"toggle"===o,o===(g?"hide":"show")){if("show"!==o||!m||void 0===m[i])continue;g=!0}p[i]=m&&m[i]||v.style(t,i)}if((u=!v.isEmptyObject(e))||!v.isEmptyObject(p))for(i in h&&1===t.nodeType&&(n.overflow=[f.overflow,f.overflowX,f.overflowY],null==(c=m&&m.display)&&(c=Q.get(t,"display")),"none"===(l=v.css(t,"display"))&&(c?l=c:(pt([t],!0),c=t.style.display||c,l=v.css(t,"display"),pt([t]))),("inline"===l||"inline-block"===l&&null!=c)&&"none"===v.css(t,"float")&&(u||(d.done((function(){f.display=c})),null==c&&(l=f.display,c="none"===l?"":l)),f.display="inline-block")),n.overflow&&(f.overflow="hidden",d.always((function(){f.overflow=n.overflow[0],f.overflowX=n.overflow[1],f.overflowY=n.overflow[2]}))),u=!1,p)u||(m?"hidden"in m&&(g=m.hidden):m=Q.access(t,"fxshow",{display:c}),r&&(m.hidden=!g),g&&pt([t],!0),d.done((function(){for(i in g||pt([t]),Q.remove(t,"fxshow"),p)v.style(t,i,p[i])}))),u=pe(g?m[i]:0,i,d),i in m||(m[i]=u.start,g&&(u.end=u.start,u.start=0))}],prefilter:function(t,e){e?fe.prefilters.unshift(t):fe.prefilters.push(t)}}),v.speed=function(t,e,n){var i=t&&"object"==typeof t?v.extend({},t):{complete:n||!n&&e||_(t)&&t,duration:t,easing:n&&e||e&&!_(e)&&e};return v.fx.off?i.duration=0:"number"!=typeof i.duration&&(i.duration in v.fx.speeds?i.duration=v.fx.speeds[i.duration]:i.duration=v.fx.speeds._default),null!=i.queue&&!0!==i.queue||(i.queue="fx"),i.old=i.complete,i.complete=function(){_(i.old)&&i.old.call(this),i.queue&&v.dequeue(this,i.queue)},i},v.fn.extend({fadeTo:function(t,e,n,i){return this.filter(ct).css("opacity",0).show().end().animate({opacity:e},t,n,i)},animate:function(t,e,n,i){var o=v.isEmptyObject(t),r=v.speed(e,n,i),s=function(){var e=fe(this,v.extend({},t),r);(o||Q.get(this,"finish"))&&e.stop(!0)};return s.finish=s,o||!1===r.queue?this.each(s):this.queue(r.queue,s)},stop:function(t,e,n){var i=function(t){var e=t.stop;delete t.stop,e(n)};return"string"!=typeof t&&(n=e,e=t,t=void 0),e&&this.queue(t||"fx",[]),this.each((function(){var e=!0,o=null!=t&&t+"queueHooks",r=v.timers,s=Q.get(this);if(o)s[o]&&s[o].stop&&i(s[o]);else for(o in s)s[o]&&s[o].stop&&ce.test(o)&&i(s[o]);for(o=r.length;o--;)r[o].elem!==this||null!=t&&r[o].queue!==t||(r[o].anim.stop(n),e=!1,r.splice(o,1));!e&&n||v.dequeue(this,t)}))},finish:function(t){return!1!==t&&(t=t||"fx"),this.each((function(){var e,n=Q.get(this),i=n[t+"queue"],o=n[t+"queueHooks"],r=v.timers,s=i?i.length:0;for(n.finish=!0,v.queue(this,t,[]),o&&o.stop&&o.stop.call(this,!0),e=r.length;e--;)r[e].elem===this&&r[e].queue===t&&(r[e].anim.stop(!0),r.splice(e,1));for(e=0;e<s;e++)i[e]&&i[e].finish&&i[e].finish.call(this);delete n.finish}))}}),v.each(["toggle","show","hide"],(function(t,e){var n=v.fn[e];v.fn[e]=function(t,i,o){return null==t||"boolean"==typeof t?n.apply(this,arguments):this.animate(de(e,!0),t,i,o)}})),v.each({slideDown:de("show"),slideUp:de("hide"),slideToggle:de("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},(function(t,e){v.fn[t]=function(t,n,i){return this.animate(e,t,n,i)}})),v.timers=[],v.fx.tick=function(){var t,e=0,n=v.timers;for(se=Date.now();e<n.length;e++)(t=n[e])()||n[e]!==t||n.splice(e--,1);n.length||v.fx.stop(),se=void 0},v.fx.timer=function(t){v.timers.push(t),v.fx.start()},v.fx.interval=13,v.fx.start=function(){ae||(ae=!0,le())},v.fx.stop=function(){ae=null},v.fx.speeds={slow:600,fast:200,_default:400},v.fn.delay=function(t,e){return t=v.fx&&v.fx.speeds[t]||t,e=e||"fx",this.queue(e,(function(e,n){var o=i.setTimeout(e,t);n.stop=function(){i.clearTimeout(o)}}))},function(){var t=y.createElement("input"),e=y.createElement("select").appendChild(y.createElement("option"));t.type="checkbox",m.checkOn=""!==t.value,m.optSelected=e.selected,(t=y.createElement("input")).value="t",t.type="radio",m.radioValue="t"===t.value}();var ge,me=v.expr.attrHandle;v.fn.extend({attr:function(t,e){return H(this,v.attr,t,e,arguments.length>1)},removeAttr:function(t){return this.each((function(){v.removeAttr(this,t)}))}}),v.extend({attr:function(t,e,n){var i,o,r=t.nodeType;if(3!==r&&8!==r&&2!==r)return void 0===t.getAttribute?v.prop(t,e,n):(1===r&&v.isXMLDoc(t)||(o=v.attrHooks[e.toLowerCase()]||(v.expr.match.bool.test(e)?ge:void 0)),void 0!==n?null===n?void v.removeAttr(t,e):o&&"set"in o&&void 0!==(i=o.set(t,n,e))?i:(t.setAttribute(e,n+""),n):o&&"get"in o&&null!==(i=o.get(t,e))?i:null==(i=v.find.attr(t,e))?void 0:i)},attrHooks:{type:{set:function(t,e){if(!m.radioValue&&"radio"===e&&I(t,"input")){var n=t.value;return t.setAttribute("type",e),n&&(t.value=n),e}}}},removeAttr:function(t,e){var n,i=0,o=e&&e.match(B);if(o&&1===t.nodeType)for(;n=o[i++];)t.removeAttribute(n)}}),ge={set:function(t,e,n){return!1===e?v.removeAttr(t,n):t.setAttribute(n,n),n}},v.each(v.expr.match.bool.source.match(/\w+/g),(function(t,e){var n=me[e]||v.find.attr;me[e]=function(t,e,i){var o,r,s=e.toLowerCase();return i||(r=me[s],me[s]=o,o=null!=n(t,e,i)?s:null,me[s]=r),o}}));var _e=/^(?:input|select|textarea|button)$/i,xe=/^(?:a|area)$/i;function ye(t){return(t.match(B)||[]).join(" ")}function we(t){return t.getAttribute&&t.getAttribute("class")||""}function Se(t){return Array.isArray(t)?t:"string"==typeof t&&t.match(B)||[]}v.fn.extend({prop:function(t,e){return H(this,v.prop,t,e,arguments.length>1)},removeProp:function(t){return this.each((function(){delete this[v.propFix[t]||t]}))}}),v.extend({prop:function(t,e,n){var i,o,r=t.nodeType;if(3!==r&&8!==r&&2!==r)return 1===r&&v.isXMLDoc(t)||(e=v.propFix[e]||e,o=v.propHooks[e]),void 0!==n?o&&"set"in o&&void 0!==(i=o.set(t,n,e))?i:t[e]=n:o&&"get"in o&&null!==(i=o.get(t,e))?i:t[e]},propHooks:{tabIndex:{get:function(t){var e=v.find.attr(t,"tabindex");return e?parseInt(e,10):_e.test(t.nodeName)||xe.test(t.nodeName)&&t.href?0:-1}}},propFix:{for:"htmlFor",class:"className"}}),m.optSelected||(v.propHooks.selected={get:function(t){var e=t.parentNode;return e&&e.parentNode&&e.parentNode.selectedIndex,null},set:function(t){var e=t.parentNode;e&&(e.selectedIndex,e.parentNode&&e.parentNode.selectedIndex)}}),v.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],(function(){v.propFix[this.toLowerCase()]=this})),v.fn.extend({addClass:function(t){var e,n,i,o,r,s;return _(t)?this.each((function(e){v(this).addClass(t.call(this,e,we(this)))})):(e=Se(t)).length?this.each((function(){if(i=we(this),n=1===this.nodeType&&" "+ye(i)+" "){for(r=0;r<e.length;r++)o=e[r],n.indexOf(" "+o+" ")<0&&(n+=o+" ");s=ye(n),i!==s&&this.setAttribute("class",s)}})):this},removeClass:function(t){var e,n,i,o,r,s;return _(t)?this.each((function(e){v(this).removeClass(t.call(this,e,we(this)))})):arguments.length?(e=Se(t)).length?this.each((function(){if(i=we(this),n=1===this.nodeType&&" "+ye(i)+" "){for(r=0;r<e.length;r++)for(o=e[r];n.indexOf(" "+o+" ")>-1;)n=n.replace(" "+o+" "," ");s=ye(n),i!==s&&this.setAttribute("class",s)}})):this:this.attr("class","")},toggleClass:function(t,e){var n,i,o,r,s=typeof t,a="string"===s||Array.isArray(t);return _(t)?this.each((function(n){v(this).toggleClass(t.call(this,n,we(this),e),e)})):"boolean"==typeof e&&a?e?this.addClass(t):this.removeClass(t):(n=Se(t),this.each((function(){if(a)for(r=v(this),o=0;o<n.length;o++)i=n[o],r.hasClass(i)?r.removeClass(i):r.addClass(i);else void 0!==t&&"boolean"!==s||((i=we(this))&&Q.set(this,"__className__",i),this.setAttribute&&this.setAttribute("class",i||!1===t?"":Q.get(this,"__className__")||""))})))},hasClass:function(t){var e,n,i=0;for(e=" "+t+" ";n=this[i++];)if(1===n.nodeType&&(" "+ye(we(n))+" ").indexOf(e)>-1)return!0;return!1}});var Te=/\r/g;v.fn.extend({val:function(t){var e,n,i,o=this[0];return arguments.length?(i=_(t),this.each((function(n){var o;1===this.nodeType&&(null==(o=i?t.call(this,n,v(this).val()):t)?o="":"number"==typeof o?o+="":Array.isArray(o)&&(o=v.map(o,(function(t){return null==t?"":t+""}))),(e=v.valHooks[this.type]||v.valHooks[this.nodeName.toLowerCase()])&&"set"in e&&void 0!==e.set(this,o,"value")||(this.value=o))}))):o?(e=v.valHooks[o.type]||v.valHooks[o.nodeName.toLowerCase()])&&"get"in e&&void 0!==(n=e.get(o,"value"))?n:"string"==typeof(n=o.value)?n.replace(Te,""):null==n?"":n:void 0}}),v.extend({valHooks:{option:{get:function(t){var e=v.find.attr(t,"value");return null!=e?e:ye(v.text(t))}},select:{get:function(t){var e,n,i,o=t.options,r=t.selectedIndex,s="select-one"===t.type,a=s?null:[],u=s?r+1:o.length;for(i=r<0?u:s?r:0;i<u;i++)if(((n=o[i]).selected||i===r)&&!n.disabled&&(!n.parentNode.disabled||!I(n.parentNode,"optgroup"))){if(e=v(n).val(),s)return e;a.push(e)}return a},set:function(t,e){for(var n,i,o=t.options,r=v.makeArray(e),s=o.length;s--;)((i=o[s]).selected=v.inArray(v.valHooks.option.get(i),r)>-1)&&(n=!0);return n||(t.selectedIndex=-1),r}}}}),v.each(["radio","checkbox"],(function(){v.valHooks[this]={set:function(t,e){if(Array.isArray(e))return t.checked=v.inArray(v(t).val(),e)>-1}},m.checkOn||(v.valHooks[this].get=function(t){return null===t.getAttribute("value")?"on":t.value})})),m.focusin="onfocusin"in i;var be=/^(?:focusinfocus|focusoutblur)$/,ve=function(t){t.stopPropagation()};v.extend(v.event,{trigger:function(t,e,n,o){var r,s,a,u,c,l,h,d,f=[n||y],g=p.call(t,"type")?t.type:t,m=p.call(t,"namespace")?t.namespace.split("."):[];if(s=d=a=n=n||y,3!==n.nodeType&&8!==n.nodeType&&!be.test(g+v.event.triggered)&&(g.indexOf(".")>-1&&(m=g.split("."),g=m.shift(),m.sort()),c=g.indexOf(":")<0&&"on"+g,(t=t[v.expando]?t:new v.Event(g,"object"==typeof t&&t)).isTrigger=o?2:3,t.namespace=m.join("."),t.rnamespace=t.namespace?new RegExp("(^|\\.)"+m.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,t.result=void 0,t.target||(t.target=n),e=null==e?[t]:v.makeArray(e,[t]),h=v.event.special[g]||{},o||!h.trigger||!1!==h.trigger.apply(n,e))){if(!o&&!h.noBubble&&!x(n)){for(u=h.delegateType||g,be.test(u+g)||(s=s.parentNode);s;s=s.parentNode)f.push(s),a=s;a===(n.ownerDocument||y)&&f.push(a.defaultView||a.parentWindow||i)}for(r=0;(s=f[r++])&&!t.isPropagationStopped();)d=s,t.type=r>1?u:h.bindType||g,(l=(Q.get(s,"events")||Object.create(null))[t.type]&&Q.get(s,"handle"))&&l.apply(s,e),(l=c&&s[c])&&l.apply&&J(s)&&(t.result=l.apply(s,e),!1===t.result&&t.preventDefault());return t.type=g,o||t.isDefaultPrevented()||h._default&&!1!==h._default.apply(f.pop(),e)||!J(n)||c&&_(n[g])&&!x(n)&&((a=n[c])&&(n[c]=null),v.event.triggered=g,t.isPropagationStopped()&&d.addEventListener(g,ve),n[g](),t.isPropagationStopped()&&d.removeEventListener(g,ve),v.event.triggered=void 0,a&&(n[c]=a)),t.result}},simulate:function(t,e,n){var i=v.extend(new v.Event,n,{type:t,isSimulated:!0});v.event.trigger(i,null,e)}}),v.fn.extend({trigger:function(t,e){return this.each((function(){v.event.trigger(t,e,this)}))},triggerHandler:function(t,e){var n=this[0];if(n)return v.event.trigger(t,e,n,!0)}}),m.focusin||v.each({focus:"focusin",blur:"focusout"},(function(t,e){var n=function(t){v.event.simulate(e,t.target,v.event.fix(t))};v.event.special[e]={setup:function(){var i=this.ownerDocument||this.document||this,o=Q.access(i,e);o||i.addEventListener(t,n,!0),Q.access(i,e,(o||0)+1)},teardown:function(){var i=this.ownerDocument||this.document||this,o=Q.access(i,e)-1;o?Q.access(i,e,o):(i.removeEventListener(t,n,!0),Q.remove(i,e))}}}));var Ce=i.location,Ee={guid:Date.now()},Oe=/\?/;v.parseXML=function(t){var e,n;if(!t||"string"!=typeof t)return null;try{e=(new i.DOMParser).parseFromString(t,"text/xml")}catch(t){}return n=e&&e.getElementsByTagName("parsererror")[0],e&&!n||v.error("Invalid XML: "+(n?v.map(n.childNodes,(function(t){return t.textContent})).join("\n"):t)),e};var Ne=/\[\]$/,Fe=/\r?\n/g,Ie=/^(?:submit|button|image|reset|file)$/i,Me=/^(?:input|select|textarea|keygen)/i;function De(t,e,n,i){var o;if(Array.isArray(e))v.each(e,(function(e,o){n||Ne.test(t)?i(t,o):De(t+"["+("object"==typeof o&&null!=o?e:"")+"]",o,n,i)}));else if(n||"object"!==T(e))i(t,e);else for(o in e)De(t+"["+o+"]",e[o],n,i)}v.param=function(t,e){var n,i=[],o=function(t,e){var n=_(e)?e():e;i[i.length]=encodeURIComponent(t)+"="+encodeURIComponent(null==n?"":n)};if(null==t)return"";if(Array.isArray(t)||t.jquery&&!v.isPlainObject(t))v.each(t,(function(){o(this.name,this.value)}));else for(n in t)De(n,t[n],e,o);return i.join("&")},v.fn.extend({serialize:function(){return v.param(this.serializeArray())},serializeArray:function(){return this.map((function(){var t=v.prop(this,"elements");return t?v.makeArray(t):this})).filter((function(){var t=this.type;return this.name&&!v(this).is(":disabled")&&Me.test(this.nodeName)&&!Ie.test(t)&&(this.checked||!mt.test(t))})).map((function(t,e){var n=v(this).val();return null==n?null:Array.isArray(n)?v.map(n,(function(t){return{name:e.name,value:t.replace(Fe,"\r\n")}})):{name:e.name,value:n.replace(Fe,"\r\n")}})).get()}});var Ve=/%20/g,Re=/#.*$/,Pe=/([?&])_=[^&]*/,Ae=/^(.*?):[ \t]*([^\r\n]*)$/gm,Le=/^(?:GET|HEAD)$/,Be=/^\/\//,Xe={},Ue={},ke="*/".concat("*"),ze=y.createElement("a");function je(t){return function(e,n){"string"!=typeof e&&(n=e,e="*");var i,o=0,r=e.toLowerCase().match(B)||[];if(_(n))for(;i=r[o++];)"+"===i[0]?(i=i.slice(1)||"*",(t[i]=t[i]||[]).unshift(n)):(t[i]=t[i]||[]).push(n)}}function Ge(t,e,n,i){var o={},r=t===Ue;function s(a){var u;return o[a]=!0,v.each(t[a]||[],(function(t,a){var c=a(e,n,i);return"string"!=typeof c||r||o[c]?r?!(u=c):void 0:(e.dataTypes.unshift(c),s(c),!1)})),u}return s(e.dataTypes[0])||!o["*"]&&s("*")}function He(t,e){var n,i,o=v.ajaxSettings.flatOptions||{};for(n in e)void 0!==e[n]&&((o[n]?t:i||(i={}))[n]=e[n]);return i&&v.extend(!0,t,i),t}ze.href=Ce.href,v.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:Ce.href,type:"GET",isLocal:/^(?:about|app|app-storage|.+-extension|file|res|widget):$/.test(Ce.protocol),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":ke,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/\bxml\b/,html:/\bhtml/,json:/\bjson\b/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":!0,"text json":JSON.parse,"text xml":v.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(t,e){return e?He(He(t,v.ajaxSettings),e):He(v.ajaxSettings,t)},ajaxPrefilter:je(Xe),ajaxTransport:je(Ue),ajax:function(t,e){"object"==typeof t&&(e=t,t=void 0),e=e||{};var n,o,r,s,a,u,c,l,h,d,p=v.ajaxSetup({},e),f=p.context||p,g=p.context&&(f.nodeType||f.jquery)?v(f):v.event,m=v.Deferred(),_=v.Callbacks("once memory"),x=p.statusCode||{},w={},S={},T="canceled",b={readyState:0,getResponseHeader:function(t){var e;if(c){if(!s)for(s={};e=Ae.exec(r);)s[e[1].toLowerCase()+" "]=(s[e[1].toLowerCase()+" "]||[]).concat(e[2]);e=s[t.toLowerCase()+" "]}return null==e?null:e.join(", ")},getAllResponseHeaders:function(){return c?r:null},setRequestHeader:function(t,e){return null==c&&(t=S[t.toLowerCase()]=S[t.toLowerCase()]||t,w[t]=e),this},overrideMimeType:function(t){return null==c&&(p.mimeType=t),this},statusCode:function(t){var e;if(t)if(c)b.always(t[b.status]);else for(e in t)x[e]=[x[e],t[e]];return this},abort:function(t){var e=t||T;return n&&n.abort(e),C(0,e),this}};if(m.promise(b),p.url=((t||p.url||Ce.href)+"").replace(Be,Ce.protocol+"//"),p.type=e.method||e.type||p.method||p.type,p.dataTypes=(p.dataType||"*").toLowerCase().match(B)||[""],null==p.crossDomain){u=y.createElement("a");try{u.href=p.url,u.href=u.href,p.crossDomain=ze.protocol+"//"+ze.host!=u.protocol+"//"+u.host}catch(t){p.crossDomain=!0}}if(p.data&&p.processData&&"string"!=typeof p.data&&(p.data=v.param(p.data,p.traditional)),Ge(Xe,p,e,b),c)return b;for(h in(l=v.event&&p.global)&&0==v.active++&&v.event.trigger("ajaxStart"),p.type=p.type.toUpperCase(),p.hasContent=!Le.test(p.type),o=p.url.replace(Re,""),p.hasContent?p.data&&p.processData&&0===(p.contentType||"").indexOf("application/x-www-form-urlencoded")&&(p.data=p.data.replace(Ve,"+")):(d=p.url.slice(o.length),p.data&&(p.processData||"string"==typeof p.data)&&(o+=(Oe.test(o)?"&":"?")+p.data,delete p.data),!1===p.cache&&(o=o.replace(Pe,"$1"),d=(Oe.test(o)?"&":"?")+"_="+Ee.guid+++d),p.url=o+d),p.ifModified&&(v.lastModified[o]&&b.setRequestHeader("If-Modified-Since",v.lastModified[o]),v.etag[o]&&b.setRequestHeader("If-None-Match",v.etag[o])),(p.data&&p.hasContent&&!1!==p.contentType||e.contentType)&&b.setRequestHeader("Content-Type",p.contentType),b.setRequestHeader("Accept",p.dataTypes[0]&&p.accepts[p.dataTypes[0]]?p.accepts[p.dataTypes[0]]+("*"!==p.dataTypes[0]?", "+ke+"; q=0.01":""):p.accepts["*"]),p.headers)b.setRequestHeader(h,p.headers[h]);if(p.beforeSend&&(!1===p.beforeSend.call(f,b,p)||c))return b.abort();if(T="abort",_.add(p.complete),b.done(p.success),b.fail(p.error),n=Ge(Ue,p,e,b)){if(b.readyState=1,l&&g.trigger("ajaxSend",[b,p]),c)return b;p.async&&p.timeout>0&&(a=i.setTimeout((function(){b.abort("timeout")}),p.timeout));try{c=!1,n.send(w,C)}catch(t){if(c)throw t;C(-1,t)}}else C(-1,"No Transport");function C(t,e,s,u){var h,d,y,w,S,T=e;c||(c=!0,a&&i.clearTimeout(a),n=void 0,r=u||"",b.readyState=t>0?4:0,h=t>=200&&t<300||304===t,s&&(w=function(t,e,n){for(var i,o,r,s,a=t.contents,u=t.dataTypes;"*"===u[0];)u.shift(),void 0===i&&(i=t.mimeType||e.getResponseHeader("Content-Type"));if(i)for(o in a)if(a[o]&&a[o].test(i)){u.unshift(o);break}if(u[0]in n)r=u[0];else{for(o in n){if(!u[0]||t.converters[o+" "+u[0]]){r=o;break}s||(s=o)}r=r||s}if(r)return r!==u[0]&&u.unshift(r),n[r]}(p,b,s)),!h&&v.inArray("script",p.dataTypes)>-1&&v.inArray("json",p.dataTypes)<0&&(p.converters["text script"]=function(){}),w=function(t,e,n,i){var o,r,s,a,u,c={},l=t.dataTypes.slice();if(l[1])for(s in t.converters)c[s.toLowerCase()]=t.converters[s];for(r=l.shift();r;)if(t.responseFields[r]&&(n[t.responseFields[r]]=e),!u&&i&&t.dataFilter&&(e=t.dataFilter(e,t.dataType)),u=r,r=l.shift())if("*"===r)r=u;else if("*"!==u&&u!==r){if(!(s=c[u+" "+r]||c["* "+r]))for(o in c)if((a=o.split(" "))[1]===r&&(s=c[u+" "+a[0]]||c["* "+a[0]])){!0===s?s=c[o]:!0!==c[o]&&(r=a[0],l.unshift(a[1]));break}if(!0!==s)if(s&&t.throws)e=s(e);else try{e=s(e)}catch(t){return{state:"parsererror",error:s?t:"No conversion from "+u+" to "+r}}}return{state:"success",data:e}}(p,w,b,h),h?(p.ifModified&&((S=b.getResponseHeader("Last-Modified"))&&(v.lastModified[o]=S),(S=b.getResponseHeader("etag"))&&(v.etag[o]=S)),204===t||"HEAD"===p.type?T="nocontent":304===t?T="notmodified":(T=w.state,d=w.data,h=!(y=w.error))):(y=T,!t&&T||(T="error",t<0&&(t=0))),b.status=t,b.statusText=(e||T)+"",h?m.resolveWith(f,[d,T,b]):m.rejectWith(f,[b,T,y]),b.statusCode(x),x=void 0,l&&g.trigger(h?"ajaxSuccess":"ajaxError",[b,p,h?d:y]),_.fireWith(f,[b,T]),l&&(g.trigger("ajaxComplete",[b,p]),--v.active||v.event.trigger("ajaxStop")))}return b},getJSON:function(t,e,n){return v.get(t,e,n,"json")},getScript:function(t,e){return v.get(t,void 0,e,"script")}}),v.each(["get","post"],(function(t,e){v[e]=function(t,n,i,o){return _(n)&&(o=o||i,i=n,n=void 0),v.ajax(v.extend({url:t,type:e,dataType:o,data:n,success:i},v.isPlainObject(t)&&t))}})),v.ajaxPrefilter((function(t){var e;for(e in t.headers)"content-type"===e.toLowerCase()&&(t.contentType=t.headers[e]||"")})),v._evalUrl=function(t,e,n){return v.ajax({url:t,type:"GET",dataType:"script",cache:!0,async:!1,global:!1,converters:{"text script":function(){}},dataFilter:function(t){v.globalEval(t,e,n)}})},v.fn.extend({wrapAll:function(t){var e;return this[0]&&(_(t)&&(t=t.call(this[0])),e=v(t,this[0].ownerDocument).eq(0).clone(!0),this[0].parentNode&&e.insertBefore(this[0]),e.map((function(){for(var t=this;t.firstElementChild;)t=t.firstElementChild;return t})).append(this)),this},wrapInner:function(t){return _(t)?this.each((function(e){v(this).wrapInner(t.call(this,e))})):this.each((function(){var e=v(this),n=e.contents();n.length?n.wrapAll(t):e.append(t)}))},wrap:function(t){var e=_(t);return this.each((function(n){v(this).wrapAll(e?t.call(this,n):t)}))},unwrap:function(t){return this.parent(t).not("body").each((function(){v(this).replaceWith(this.childNodes)})),this}}),v.expr.pseudos.hidden=function(t){return!v.expr.pseudos.visible(t)},v.expr.pseudos.visible=function(t){return!!(t.offsetWidth||t.offsetHeight||t.getClientRects().length)},v.ajaxSettings.xhr=function(){try{return new i.XMLHttpRequest}catch(t){}};var qe={0:200,1223:204},Ye=v.ajaxSettings.xhr();m.cors=!!Ye&&"withCredentials"in Ye,m.ajax=Ye=!!Ye,v.ajaxTransport((function(t){var e,n;if(m.cors||Ye&&!t.crossDomain)return{send:function(o,r){var s,a=t.xhr();if(a.open(t.type,t.url,t.async,t.username,t.password),t.xhrFields)for(s in t.xhrFields)a[s]=t.xhrFields[s];for(s in t.mimeType&&a.overrideMimeType&&a.overrideMimeType(t.mimeType),t.crossDomain||o["X-Requested-With"]||(o["X-Requested-With"]="XMLHttpRequest"),o)a.setRequestHeader(s,o[s]);e=function(t){return function(){e&&(e=n=a.onload=a.onerror=a.onabort=a.ontimeout=a.onreadystatechange=null,"abort"===t?a.abort():"error"===t?"number"!=typeof a.status?r(0,"error"):r(a.status,a.statusText):r(qe[a.status]||a.status,a.statusText,"text"!==(a.responseType||"text")||"string"!=typeof a.responseText?{binary:a.response}:{text:a.responseText},a.getAllResponseHeaders()))}},a.onload=e(),n=a.onerror=a.ontimeout=e("error"),void 0!==a.onabort?a.onabort=n:a.onreadystatechange=function(){4===a.readyState&&i.setTimeout((function(){e&&n()}))},e=e("abort");try{a.send(t.hasContent&&t.data||null)}catch(t){if(e)throw t}},abort:function(){e&&e()}}})),v.ajaxPrefilter((function(t){t.crossDomain&&(t.contents.script=!1)})),v.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/\b(?:java|ecma)script\b/},converters:{"text script":function(t){return v.globalEval(t),t}}}),v.ajaxPrefilter("script",(function(t){void 0===t.cache&&(t.cache=!1),t.crossDomain&&(t.type="GET")})),v.ajaxTransport("script",(function(t){var e,n;if(t.crossDomain||t.scriptAttrs)return{send:function(i,o){e=v("<script>").attr(t.scriptAttrs||{}).prop({charset:t.scriptCharset,src:t.url}).on("load error",n=function(t){e.remove(),n=null,t&&o("error"===t.type?404:200,t.type)}),y.head.appendChild(e[0])},abort:function(){n&&n()}}}));var We,Ke=[],Je=/(=)\?(?=&|$)|\?\?/;v.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var t=Ke.pop()||v.expando+"_"+Ee.guid++;return this[t]=!0,t}}),v.ajaxPrefilter("json jsonp",(function(t,e,n){var o,r,s,a=!1!==t.jsonp&&(Je.test(t.url)?"url":"string"==typeof t.data&&0===(t.contentType||"").indexOf("application/x-www-form-urlencoded")&&Je.test(t.data)&&"data");if(a||"jsonp"===t.dataTypes[0])return o=t.jsonpCallback=_(t.jsonpCallback)?t.jsonpCallback():t.jsonpCallback,a?t[a]=t[a].replace(Je,"$1"+o):!1!==t.jsonp&&(t.url+=(Oe.test(t.url)?"&":"?")+t.jsonp+"="+o),t.converters["script json"]=function(){return s||v.error(o+" was not called"),s[0]},t.dataTypes[0]="json",r=i[o],i[o]=function(){s=arguments},n.always((function(){void 0===r?v(i).removeProp(o):i[o]=r,t[o]&&(t.jsonpCallback=e.jsonpCallback,Ke.push(o)),s&&_(r)&&r(s[0]),s=r=void 0})),"script"})),m.createHTMLDocument=((We=y.implementation.createHTMLDocument("").body).innerHTML="<form></form><form></form>",2===We.childNodes.length),v.parseHTML=function(t,e,n){return"string"!=typeof t?[]:("boolean"==typeof e&&(n=e,e=!1),e||(m.createHTMLDocument?((i=(e=y.implementation.createHTMLDocument("")).createElement("base")).href=y.location.href,e.head.appendChild(i)):e=y),r=!n&&[],(o=M.exec(t))?[e.createElement(o[1])]:(o=bt([t],e,r),r&&r.length&&v(r).remove(),v.merge([],o.childNodes)));var i,o,r},v.fn.load=function(t,e,n){var i,o,r,s=this,a=t.indexOf(" ");return a>-1&&(i=ye(t.slice(a)),t=t.slice(0,a)),_(e)?(n=e,e=void 0):e&&"object"==typeof e&&(o="POST"),s.length>0&&v.ajax({url:t,type:o||"GET",dataType:"html",data:e}).done((function(t){r=arguments,s.html(i?v("<div>").append(v.parseHTML(t)).find(i):t)})).always(n&&function(t,e){s.each((function(){n.apply(this,r||[t.responseText,e,t])}))}),this},v.expr.pseudos.animated=function(t){return v.grep(v.timers,(function(e){return t===e.elem})).length},v.offset={setOffset:function(t,e,n){var i,o,r,s,a,u,c=v.css(t,"position"),l=v(t),h={};"static"===c&&(t.style.position="relative"),a=l.offset(),r=v.css(t,"top"),u=v.css(t,"left"),("absolute"===c||"fixed"===c)&&(r+u).indexOf("auto")>-1?(s=(i=l.position()).top,o=i.left):(s=parseFloat(r)||0,o=parseFloat(u)||0),_(e)&&(e=e.call(t,n,v.extend({},a))),null!=e.top&&(h.top=e.top-a.top+s),null!=e.left&&(h.left=e.left-a.left+o),"using"in e?e.using.call(t,h):l.css(h)}},v.fn.extend({offset:function(t){if(arguments.length)return void 0===t?this:this.each((function(e){v.offset.setOffset(this,t,e)}));var e,n,i=this[0];return i?i.getClientRects().length?(e=i.getBoundingClientRect(),n=i.ownerDocument.defaultView,{top:e.top+n.pageYOffset,left:e.left+n.pageXOffset}):{top:0,left:0}:void 0},position:function(){if(this[0]){var t,e,n,i=this[0],o={top:0,left:0};if("fixed"===v.css(i,"position"))e=i.getBoundingClientRect();else{for(e=this.offset(),n=i.ownerDocument,t=i.offsetParent||n.documentElement;t&&(t===n.body||t===n.documentElement)&&"static"===v.css(t,"position");)t=t.parentNode;t&&t!==i&&1===t.nodeType&&((o=v(t).offset()).top+=v.css(t,"borderTopWidth",!0),o.left+=v.css(t,"borderLeftWidth",!0))}return{top:e.top-o.top-v.css(i,"marginTop",!0),left:e.left-o.left-v.css(i,"marginLeft",!0)}}},offsetParent:function(){return this.map((function(){for(var t=this.offsetParent;t&&"static"===v.css(t,"position");)t=t.offsetParent;return t||st}))}}),v.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},(function(t,e){var n="pageYOffset"===e;v.fn[t]=function(i){return H(this,(function(t,i,o){var r;if(x(t)?r=t:9===t.nodeType&&(r=t.defaultView),void 0===o)return r?r[e]:t[i];r?r.scrollTo(n?r.pageXOffset:o,n?o:r.pageYOffset):t[i]=o}),t,i,arguments.length)}})),v.each(["top","left"],(function(t,e){v.cssHooks[e]=Wt(m.pixelPosition,(function(t,n){if(n)return n=Yt(t,e),Ut.test(n)?v(t).position()[e]+"px":n}))})),v.each({Height:"height",Width:"width"},(function(t,e){v.each({padding:"inner"+t,content:e,"":"outer"+t},(function(n,i){v.fn[i]=function(o,r){var s=arguments.length&&(n||"boolean"!=typeof o),a=n||(!0===o||!0===r?"margin":"border");return H(this,(function(e,n,o){var r;return x(e)?0===i.indexOf("outer")?e["inner"+t]:e.document.documentElement["client"+t]:9===e.nodeType?(r=e.documentElement,Math.max(e.body["scroll"+t],r["scroll"+t],e.body["offset"+t],r["offset"+t],r["client"+t])):void 0===o?v.css(e,n,a):v.style(e,n,o,a)}),e,s?o:void 0,s)}}))})),v.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],(function(t,e){v.fn[e]=function(t){return this.on(e,t)}})),v.fn.extend({bind:function(t,e,n){return this.on(t,null,e,n)},unbind:function(t,e){return this.off(t,null,e)},delegate:function(t,e,n,i){return this.on(e,t,n,i)},undelegate:function(t,e,n){return 1===arguments.length?this.off(t,"**"):this.off(e,t||"**",n)},hover:function(t,e){return this.mouseenter(t).mouseleave(e||t)}}),v.each("blur focus focusin focusout resize scroll click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup contextmenu".split(" "),(function(t,e){v.fn[e]=function(t,n){return arguments.length>0?this.on(e,null,t,n):this.trigger(e)}}));var Ze=/^[\s\uFEFF\xA0]+|([^\s\uFEFF\xA0])[\s\uFEFF\xA0]+$/g;v.proxy=function(t,e){var n,i,o;if("string"==typeof e&&(n=t[e],e=t,t=n),_(t))return i=a.call(arguments,2),o=function(){return t.apply(e||this,i.concat(a.call(arguments)))},o.guid=t.guid=t.guid||v.guid++,o},v.holdReady=function(t){t?v.readyWait++:v.ready(!0)},v.isArray=Array.isArray,v.parseJSON=JSON.parse,v.nodeName=I,v.isFunction=_,v.isWindow=x,v.camelCase=K,v.type=T,v.now=Date.now,v.isNumeric=function(t){var e=v.type(t);return("number"===e||"string"===e)&&!isNaN(t-parseFloat(t))},v.trim=function(t){return null==t?"":(t+"").replace(Ze,"$1")},void 0===(n=function(){return v}.apply(e,[]))||(t.exports=n);var Qe=i.jQuery,$e=i.$;return v.noConflict=function(t){return i.$===v&&(i.$=$e),t&&i.jQuery===v&&(i.jQuery=Qe),v},void 0===o&&(i.jQuery=i.$=v),v}))},86:function(t,e){var n,i,o;i=[],void 0===(o="function"==typeof(n=function(){var t=function(t){return t.reduce((function(t,e){return 2*t+e}),0)},e=function(t){for(var e=[],n=7;n>=0;n--)e.push(!!(t&1<<n));return e},n=function(t){this.data=t,this.len=this.data.length,this.pos=0,this.readByte=function(){if(this.pos>=this.data.length)throw new Error("Attempted to read past end of stream.");return t instanceof Uint8Array?t[this.pos++]:255&t.charCodeAt(this.pos++)},this.readBytes=function(t){for(var e=[],n=0;n<t;n++)e.push(this.readByte());return e},this.read=function(t){for(var e="",n=0;n<t;n++)e+=String.fromCharCode(this.readByte());return e},this.readUnsigned=function(){var t=this.readBytes(2);return(t[1]<<8)+t[0]}},i=function(t,e){for(var n,i,o=0,r=function(t){for(var n=0,i=0;i<t;i++)e.charCodeAt(o>>3)&1<<(7&o)&&(n|=1<<i),o++;return n},s=[],a=1<<t,u=a+1,c=t+1,l=[],h=function(){l=[],c=t+1;for(var e=0;e<a;e++)l[e]=[e];l[a]=[],l[u]=null};;)if(i=n,(n=r(c))!==a){if(n===u)break;if(n<l.length)i!==a&&l.push(l[i].concat(l[n][0]));else{if(n!==l.length)throw new Error("Invalid LZW code.");l.push(l[i].concat(l[i][0]))}s.push.apply(s,l[n]),l.length===1<<c&&c<12&&c++}else h();return s},o=function(n,o){o||(o={});var r=function(t){for(var e=[],i=0;i<t;i++)e.push(n.readBytes(3));return e},s=function(){var t,e;e="";do{t=n.readByte(),e+=n.read(t)}while(0!==t);return e},a=function(){var i={};if(i.sig=n.read(3),i.ver=n.read(3),"GIF"!==i.sig)throw new Error("Not a GIF file.");i.width=n.readUnsigned(),i.height=n.readUnsigned();var s=e(n.readByte());i.gctFlag=s.shift(),i.colorRes=t(s.splice(0,3)),i.sorted=s.shift(),i.gctSize=t(s.splice(0,3)),i.bgColor=n.readByte(),i.pixelAspectRatio=n.readByte(),i.gctFlag&&(i.gct=r(1<<i.gctSize+1)),o.hdr&&o.hdr(i)},u=function(i){var r=function(i){n.readByte();var r=e(n.readByte());i.reserved=r.splice(0,3),i.disposalMethod=t(r.splice(0,3)),i.userInput=r.shift(),i.transparencyGiven=r.shift(),i.delayTime=n.readUnsigned(),i.transparencyIndex=n.readByte(),i.terminator=n.readByte(),o.gce&&o.gce(i)},a=function(t){t.comment=s(),o.com&&o.com(t)},u=function(t){n.readByte(),t.ptHeader=n.readBytes(12),t.ptData=s(),o.pte&&o.pte(t)},c=function(t){var e=function(t){n.readByte(),t.unknown=n.readByte(),t.iterations=n.readUnsigned(),t.terminator=n.readByte(),o.app&&o.app.NETSCAPE&&o.app.NETSCAPE(t)},i=function(t){t.appData=s(),o.app&&o.app[t.identifier]&&o.app[t.identifier](t)};n.readByte(),t.identifier=n.read(8),t.authCode=n.read(3),"NETSCAPE"===t.identifier?e(t):i(t)},l=function(t){t.data=s(),o.unknown&&o.unknown(t)};switch(i.label=n.readByte(),i.label){case 249:i.extType="gce",r(i);break;case 254:i.extType="com",a(i);break;case 1:i.extType="pte",u(i);break;case 255:i.extType="app",c(i);break;default:i.extType="unknown",l(i)}},c=function(a){var u=function(t,e){for(var n=new Array(t.length),i=t.length/e,o=function(i,o){var r=t.slice(o*e,(o+1)*e);n.splice.apply(n,[i*e,e].concat(r))},r=[0,4,2,1],s=[8,8,4,2],a=0,u=0;u<4;u++)for(var c=r[u];c<i;c+=s[u])o(c,a),a++;return n};a.leftPos=n.readUnsigned(),a.topPos=n.readUnsigned(),a.width=n.readUnsigned(),a.height=n.readUnsigned();var c=e(n.readByte());a.lctFlag=c.shift(),a.interlaced=c.shift(),a.sorted=c.shift(),a.reserved=c.splice(0,2),a.lctSize=t(c.splice(0,3)),a.lctFlag&&(a.lct=r(1<<a.lctSize+1)),a.lzwMinCodeSize=n.readByte();var l=s();a.pixels=i(a.lzwMinCodeSize,l),a.interlaced&&(a.pixels=u(a.pixels,a.width)),o.img&&o.img(a)},l=function(){var t={};switch(t.sentinel=n.readByte(),String.fromCharCode(t.sentinel)){case"!":t.type="ext",u(t);break;case",":t.type="img",c(t);break;case";":t.type="eof",o.eof&&o.eof(t);break;default:throw new Error("Unknown block: 0x"+t.sentinel.toString(16))}"eof"!==t.type&&setTimeout(l,0)};a(),setTimeout(l,0)};return function(t){var e,i,r={vp_l:0,vp_t:0,vp_w:null,vp_h:null,c_w:null,c_h:null};for(var s in t)r[s]=t[s];r.vp_w&&r.vp_h&&(r.is_vp=!0);var a=null,u=!1,c=null,l=null,h=null,d=null,p=null,f=null,g=null,m=!0,_=!0,x=!1,y=[],w=[],S=r.gif;void 0===r.auto_play&&(r.auto_play=!S.getAttribute("rel:auto_play")||"1"==S.getAttribute("rel:auto_play"));var T,b,v,C,E=r.hasOwnProperty("on_end")?r.on_end:null,O=r.hasOwnProperty("loop_delay")?r.loop_delay:0,N=r.hasOwnProperty("loop_mode")?r.loop_mode:"auto",F=!r.hasOwnProperty("draw_while_loading")||r.draw_while_loading,I=!!F&&(!r.hasOwnProperty("show_progress_bar")||r.show_progress_bar),M=r.hasOwnProperty("progressbar_height")?r.progressbar_height:25,D=r.hasOwnProperty("progressbar_background_color")?r.progressbar_background_color:"rgba(255,255,255,0.4)",V=r.hasOwnProperty("progressbar_foreground_color")?r.progressbar_foreground_color:"rgba(255,0,22,.8)",R=function(){c=null,l=null,p=h,h=null,f=null},P=function(){try{o(e,W)}catch(t){X("parse")}},A=function(t,e){T.width=t*J(),T.height=e*J(),v.style.minWidth=t*J()+"px",C.width=t,C.height=e,C.style.width=t+"px",C.style.height=e+"px",C.getContext("2d").setTransform(1,0,0,1,0,0)},L=function(t,e){w[t]?(void 0!==e.x&&(w[t].x=e.x),void 0!==e.y&&(w[t].y=e.y)):w[t]=e},B=function(t,e,n){if(n&&I){var i,o,s,a=M;r.is_vp?x?(o=(r.vp_t+r.vp_h-a)/J(),a/=J(),i=r.vp_l/J()+t/e*(r.vp_w/J()),s=T.width/J()):(o=r.vp_t+r.vp_h-a,i=r.vp_l+t/e*r.vp_w,s=T.width):(o=(T.height-a)/(x?J():1),i=t/e*T.width/(x?J():1),s=T.width/(x?J():1),a/=x?J():1),b.fillStyle=D,b.fillRect(i,o,s-i,a),b.fillStyle=V,b.fillRect(0,o,i,a)}},X=function(t){var e=function(){b.fillStyle="black",b.fillRect(0,0,r.c_w?r.c_w:i.width,r.c_h?r.c_h:i.height),b.strokeStyle="red",b.lineWidth=3,b.moveTo(0,0),b.lineTo(r.c_w?r.c_w:i.width,r.c_h?r.c_h:i.height),b.moveTo(0,r.c_h?r.c_h:i.height),b.lineTo(r.c_w?r.c_w:i.width,0),b.stroke()};a=t,i={width:S.width,height:S.height},y=[],e()},U=function(t){A((i=t).width,i.height)},k=function(t){z(),R(),c=t.transparencyGiven?t.transparencyIndex:null,l=t.delayTime,h=t.disposalMethod},z=function(){f&&(y.push({data:f.getImageData(0,0,i.width,i.height),delay:l}),w.push({x:0,y:0}))},j=function(t){f||(f=C.getContext("2d"));var e=y.length,n=t.lctFlag?t.lct:i.gct;e>0&&(3===p?null!==d?f.putImageData(y[d].data,0,0):f.clearRect(g.leftPos,g.topPos,g.width,g.height):d=e-1,2===p&&f.clearRect(g.leftPos,g.topPos,g.width,g.height));var o=f.getImageData(t.leftPos,t.topPos,t.width,t.height);t.pixels.forEach((function(t,e){t!==c&&(o.data[4*e+0]=n[t][0],o.data[4*e+1]=n[t][1],o.data[4*e+2]=n[t][2],o.data[4*e+3]=255)})),f.putImageData(o,t.leftPos,t.topPos),x||(b.scale(J(),J()),x=!0),F&&(b.drawImage(C,0,0),F=r.auto_play),g=t},G=function(){var t,e,n,i=-1,o=0,s=function(){return(i+(_?1:-1)+y.length)%y.length},u=function(t){i+=t,l()},c=(t=!1,e=function(){null!==E&&E(S),o++,!1!==N||o<0?n():(t=!1,m=!1)},n=function(){if(t=m){u(1);var o=10*y[i].delay;o||(o=100),0===s()?(o+=O,setTimeout(e,o)):setTimeout(n,o)}},function(){t||setTimeout(n,0)}),l=function(){var t;(i=parseInt(i,10))>y.length-1&&(i=0),i<0&&(i=0),t=w[i],C.getContext("2d").putImageData(y[i].data,t.x,t.y),b.globalCompositeOperation="copy",b.drawImage(C,0,0)},h=function(){m=!0,c()};return{init:function(){a||(r.c_w&&r.c_h||b.scale(J(),J()),r.auto_play?c():(i=0,l()))},step:c,play:h,pause:function(){m=!1},playing:m,move_relative:u,current_frame:function(){return i},length:function(){return y.length},move_to:function(t){i=t,l()}}}(),H=function(t){B(e.pos,e.data.length,t)},q=function(){},Y=function(t,e){return function(n){t(n),H(e)}},W={hdr:Y(U),gce:Y(k),com:Y(q),app:{NETSCAPE:Y(q)},img:Y(j,!0),eof:function(t){z(),H(!1),r.c_w&&r.c_h||(T.width=i.width*J(),T.height=i.height*J()),G.init(),u=!1,Q&&Q(S)}},K=function(){var t=S.parentNode,e=document.createElement("div");T=document.createElement("canvas"),b=T.getContext("2d"),v=document.createElement("div"),C=document.createElement("canvas"),e.width=T.width=S.width,e.height=T.height=S.height,v.style.minWidth=S.width+"px",e.className="jsgif",v.className="jsgif_toolbar",e.appendChild(T),e.appendChild(v),t.insertBefore(e,S),t.removeChild(S),r.c_w&&r.c_h&&A(r.c_w,r.c_h),Z=!0},J=function(){return r.max_width&&i&&i.width>r.max_width?r.max_width/i.width:1},Z=!1,Q=!1,$=function(t){return!u&&(Q=t||!1,u=!0,y=[],R(),d=null,p=null,f=null,g=null,!0)},tt=function(){return y.reduce((function(t,e){return t+e.delay}),0)};return{play:G.play,pause:G.pause,move_relative:G.move_relative,move_to:G.move_to,get_playing:function(){return m},get_canvas:function(){return T},get_canvas_scale:function(){return J()},get_loading:function(){return u},get_auto_play:function(){return r.auto_play},get_length:function(){return G.length()},get_frames:function(){return y},get_duration:function(){return tt()},get_duration_ms:function(){return 10*tt()},get_current_frame:function(){return G.current_frame()},load_url:function(t,i){if($(i)){var o=new XMLHttpRequest;o.open("GET",t,!0),"overrideMimeType"in o?o.overrideMimeType("text/plain; charset=x-user-defined"):"responseType"in o?o.responseType="arraybuffer":o.setRequestHeader("Accept-Charset","x-user-defined"),o.onloadstart=function(){Z||K()},o.onload=function(t){200!=this.status&&X("xhr - response"),"response"in this||(this.response=new VBArray(this.responseText).toArray().map(String.fromCharCode).join(""));var i=this.response;i.toString().indexOf("ArrayBuffer")>0&&(i=new Uint8Array(i)),e=new n(i),setTimeout(P,0)},o.onprogress=function(t){t.lengthComputable&&B(t.loaded,t.total,!0)},o.onerror=function(){X("xhr")},o.send()}},load:function(t){this.load_url(S.getAttribute("rel:animated_src")||S.src,t)},load_raw:function(t,i){$(i)&&(Z||K(),e=new n(t),setTimeout(P,0))},set_frame_offset:L}}})?n.apply(e,i):n)||(t.exports=o)},487:t=>{var e={DEBUG:!1,assert:function(t,n){if(e.DEBUG&&!t)throw new Error("Assertion failed"+(n?": "+n:""))},GLU_TESS_MAX_COORD:1e150,TRUE_PROJECT:!1,GLU_TESS_DEFAULT_TOLERANCE:0,windingRule:{GLU_TESS_WINDING_ODD:100130,GLU_TESS_WINDING_NONZERO:100131,GLU_TESS_WINDING_POSITIVE:100132,GLU_TESS_WINDING_NEGATIVE:100133,GLU_TESS_WINDING_ABS_GEQ_TWO:100134},primitiveType:{GL_LINE_LOOP:2,GL_TRIANGLES:4,GL_TRIANGLE_STRIP:5,GL_TRIANGLE_FAN:6},errorType:{GLU_TESS_MISSING_BEGIN_POLYGON:100151,GLU_TESS_MISSING_END_POLYGON:100153,GLU_TESS_MISSING_BEGIN_CONTOUR:100152,GLU_TESS_MISSING_END_CONTOUR:100154,GLU_TESS_COORD_TOO_LARGE:100155,GLU_TESS_NEED_COMBINE_CALLBACK:100156},gluEnum:{GLU_TESS_BEGIN:100100,GLU_TESS_VERTEX:100101,GLU_TESS_END:100102,GLU_TESS_ERROR:100103,GLU_TESS_EDGE_FLAG:100104,GLU_TESS_COMBINE:100105,GLU_TESS_BEGIN_DATA:100106,GLU_TESS_VERTEX_DATA:100107,GLU_TESS_END_DATA:100108,GLU_TESS_ERROR_DATA:100109,GLU_TESS_EDGE_FLAG_DATA:100110,GLU_TESS_COMBINE_DATA:100111,GLU_TESS_MESH:100112,GLU_TESS_TOLERANCE:100142,GLU_TESS_WINDING_RULE:100140,GLU_TESS_BOUNDARY_ONLY:100141,GLU_INVALID_ENUM:100900,GLU_INVALID_VALUE:100901}};e.PQHandle,e.geom={},e.geom.vertEq=function(t,e){return t.s===e.s&&t.t===e.t},e.geom.vertLeq=function(t,e){return t.s<e.s||t.s===e.s&&t.t<=e.t},e.geom.edgeEval=function(t,e,n){var i=e.s-t.s,o=n.s-e.s;return i+o>0?i<o?e.t-t.t+(t.t-n.t)*(i/(i+o)):e.t-n.t+(n.t-t.t)*(o/(i+o)):0},e.geom.edgeSign=function(t,e,n){var i=e.s-t.s,o=n.s-e.s;return i+o>0?(e.t-n.t)*i+(e.t-t.t)*o:0},e.geom.transLeq=function(t,e){return t.t<e.t||t.t===e.t&&t.s<=e.s},e.geom.transEval=function(t,e,n){var i=e.t-t.t,o=n.t-e.t;return i+o>0?i<o?e.s-t.s+(t.s-n.s)*(i/(i+o)):e.s-n.s+(n.s-t.s)*(o/(i+o)):0},e.geom.transSign=function(t,e,n){var i=e.t-t.t,o=n.t-e.t;return i+o>0?(e.s-n.s)*i+(e.s-t.s)*o:0},e.geom.edgeGoesLeft=function(t){return e.geom.vertLeq(t.dst(),t.org)},e.geom.edgeGoesRight=function(t){return e.geom.vertLeq(t.org,t.dst())},e.geom.vertL1dist=function(t,e){return Math.abs(t.s-e.s)+Math.abs(t.t-e.t)},e.geom.vertCCW=function(t,e,n){return t.s*(e.t-n.t)+e.s*(n.t-t.t)+n.s*(t.t-e.t)>=0},e.geom.interpolate_=function(t,e,n,i){return(t=t<0?0:t)<=(n=n<0?0:n)?0===n?(e+i)/2:e+t/(t+n)*(i-e):i+n/(t+n)*(e-i)},e.geom.edgeIntersect=function(t,n,i,o,r){var s,a,u;e.geom.vertLeq(t,n)||(u=t,t=n,n=u),e.geom.vertLeq(i,o)||(u=i,i=o,o=u),e.geom.vertLeq(t,i)||(u=t,t=i,i=u,u=n,n=o,o=u),e.geom.vertLeq(i,n)?e.geom.vertLeq(n,o)?((s=e.geom.edgeEval(t,i,n))+(a=e.geom.edgeEval(i,n,o))<0&&(s=-s,a=-a),r.s=e.geom.interpolate_(s,i.s,a,n.s)):((s=e.geom.edgeSign(t,i,n))+(a=-e.geom.edgeSign(t,o,n))<0&&(s=-s,a=-a),r.s=e.geom.interpolate_(s,i.s,a,o.s)):r.s=(i.s+n.s)/2,e.geom.transLeq(t,n)||(u=t,t=n,n=u),e.geom.transLeq(i,o)||(u=i,i=o,o=u),e.geom.transLeq(t,i)||(u=t,t=i,i=u,u=n,n=o,o=u),e.geom.transLeq(i,n)?e.geom.transLeq(n,o)?((s=e.geom.transEval(t,i,n))+(a=e.geom.transEval(i,n,o))<0&&(s=-s,a=-a),r.t=e.geom.interpolate_(s,i.t,a,n.t)):((s=e.geom.transSign(t,i,n))+(a=-e.geom.transSign(t,o,n))<0&&(s=-s,a=-a),r.t=e.geom.interpolate_(s,i.t,a,o.t)):r.t=(i.t+n.t)/2},e.mesh={},e.mesh.makeEdge=function(t){var n=e.mesh.makeEdgePair_(t.eHead);return e.mesh.makeVertex_(n,t.vHead),e.mesh.makeVertex_(n.sym,t.vHead),e.mesh.makeFace_(n,t.fHead),n},e.mesh.meshSplice=function(t,n){var i=!1,o=!1;t!==n&&(n.org!==t.org&&(o=!0,e.mesh.killVertex_(n.org,t.org)),n.lFace!==t.lFace&&(i=!0,e.mesh.killFace_(n.lFace,t.lFace)),e.mesh.splice_(n,t),o||(e.mesh.makeVertex_(n,t.org),t.org.anEdge=t),i||(e.mesh.makeFace_(n,t.lFace),t.lFace.anEdge=t))},e.mesh.deleteEdge=function(t){var n=t.sym,i=!1;t.lFace!==t.rFace()&&(i=!0,e.mesh.killFace_(t.lFace,t.rFace())),t.oNext===t?e.mesh.killVertex_(t.org,null):(t.rFace().anEdge=t.oPrev(),t.org.anEdge=t.oNext,e.mesh.splice_(t,t.oPrev()),i||e.mesh.makeFace_(t,t.lFace)),n.oNext===n?(e.mesh.killVertex_(n.org,null),e.mesh.killFace_(n.lFace,null)):(t.lFace.anEdge=n.oPrev(),n.org.anEdge=n.oNext,e.mesh.splice_(n,n.oPrev())),e.mesh.killEdge_(t)},e.mesh.addEdgeVertex=function(t){var n=e.mesh.makeEdgePair_(t),i=n.sym;return e.mesh.splice_(n,t.lNext),n.org=t.dst(),e.mesh.makeVertex_(i,n.org),n.lFace=i.lFace=t.lFace,n},e.mesh.splitEdge=function(t){var n=e.mesh.addEdgeVertex(t).sym;return e.mesh.splice_(t.sym,t.sym.oPrev()),e.mesh.splice_(t.sym,n),t.sym.org=n.org,n.dst().anEdge=n.sym,n.sym.lFace=t.rFace(),n.winding=t.winding,n.sym.winding=t.sym.winding,n},e.mesh.connect=function(t,n){var i=!1,o=e.mesh.makeEdgePair_(t),r=o.sym;return n.lFace!==t.lFace&&(i=!0,e.mesh.killFace_(n.lFace,t.lFace)),e.mesh.splice_(o,t.lNext),e.mesh.splice_(r,n),o.org=t.dst(),r.org=n.org,o.lFace=r.lFace=t.lFace,t.lFace.anEdge=r,i||e.mesh.makeFace_(o,t.lFace),o},e.mesh.zapFace=function(t){var n,i=t.anEdge,o=i.lNext;do{if(o=(n=o).lNext,n.lFace=null,null===n.rFace()){n.oNext===n?e.mesh.killVertex_(n.org,null):(n.org.anEdge=n.oNext,e.mesh.splice_(n,n.oPrev()));var r=n.sym;r.oNext===r?e.mesh.killVertex_(r.org,null):(r.org.anEdge=r.oNext,e.mesh.splice_(r,r.oPrev())),e.mesh.killEdge_(n)}}while(n!==i);var s=t.prev,a=t.next;a.prev=s,s.next=a},e.mesh.meshUnion=function(t,e){var n=t.fHead,i=t.vHead,o=t.eHead,r=e.fHead,s=e.vHead,a=e.eHead;return r.next!==r&&(n.prev.next=r.next,r.next.prev=n.prev,r.prev.next=n,n.prev=r.prev),s.next!==s&&(i.prev.next=s.next,s.next.prev=i.prev,s.prev.next=i,i.prev=s.prev),a.next!==a&&(o.sym.next.sym.next=a.next,a.next.sym.next=o.sym.next,a.sym.next.sym.next=o,o.sym.next=a.sym.next),t},e.mesh.deleteMesh=function(t){},e.mesh.makeEdgePair_=function(t){var n=new e.GluHalfEdge,i=new e.GluHalfEdge,o=t.sym.next;return i.next=o,o.sym.next=n,n.next=t,t.sym.next=i,n.sym=i,n.oNext=n,n.lNext=i,i.sym=n,i.oNext=i,i.lNext=n,n},e.mesh.splice_=function(t,e){var n=t.oNext,i=e.oNext;n.sym.lNext=e,i.sym.lNext=t,t.oNext=i,e.oNext=n},e.mesh.makeVertex_=function(t,n){var i=n.prev,o=new e.GluVertex(n,i);i.next=o,n.prev=o,o.anEdge=t;var r=t;do{r.org=o,r=r.oNext}while(r!==t)},e.mesh.makeFace_=function(t,n){var i=n.prev,o=new e.GluFace(n,i);i.next=o,n.prev=o,o.anEdge=t,o.inside=n.inside;var r=t;do{r.lFace=o,r=r.lNext}while(r!==t)},e.mesh.killEdge_=function(t){var e=t.next,n=t.sym.next;e.sym.next=n,n.sym.next=e},e.mesh.killVertex_=function(t,e){var n=t.anEdge,i=n;do{i.org=e,i=i.oNext}while(i!==n);var o=t.prev,r=t.next;r.prev=o,o.next=r},e.mesh.killFace_=function(t,e){var n=t.anEdge,i=n;do{i.lFace=e,i=i.lNext}while(i!==n);var o=t.prev,r=t.next;r.prev=o,o.next=r},e.normal={},e.normal.S_UNIT_X_=1,e.normal.S_UNIT_Y_=0,e.normal.projectPolygon=function(t,n,i,o){var r=!1,s=[n,i,o];0===n&&0===i&&0===o&&(e.normal.computeNormal_(t,s),r=!0);var a,u=e.normal.longAxis_(s),c=t.mesh.vHead;if(e.TRUE_PROJECT){e.normal.normalize_(s);var l=[0,0,0],h=[0,0,0];l[u]=0,l[(u+1)%3]=e.normal.S_UNIT_X_,l[(u+2)%3]=e.normal.S_UNIT_Y_;var d=e.normal.dot_(l,s);for(l[0]-=d*s[0],l[1]-=d*s[1],l[2]-=d*s[2],e.normal.normalize_(l),h[0]=s[1]*l[2]-s[2]*l[1],h[1]=s[2]*l[0]-s[0]*l[2],h[2]=s[0]*l[1]-s[1]*l[0],e.normal.normalize_(h),a=c.next;a!==c;a=a.next)a.s=e.normal.dot_(a.coords,l),a.t=e.normal.dot_(a.coords,h)}else{var p=(u+1)%3,f=(u+2)%3,g=s[u]>0?1:-1;for(a=c.next;a!==c;a=a.next)a.s=a.coords[p],a.t=g*a.coords[f]}r&&e.normal.checkOrientation_(t)},e.normal.dot_=function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]},e.normal.normalize_=function(t){var e=t[0]*t[0]+t[1]*t[1]+t[2]*t[2];e=Math.sqrt(e),t[0]/=e,t[1]/=e,t[2]/=e},e.normal.longAxis_=function(t){var e=0;return Math.abs(t[1])>Math.abs(t[0])&&(e=1),Math.abs(t[2])>Math.abs(t[e])&&(e=2),e},e.normal.computeNormal_=function(t,n){var i,o=[-2*e.GLU_TESS_MAX_COORD,-2*e.GLU_TESS_MAX_COORD,-2*e.GLU_TESS_MAX_COORD],r=[2*e.GLU_TESS_MAX_COORD,2*e.GLU_TESS_MAX_COORD,2*e.GLU_TESS_MAX_COORD],s=[],a=[],u=t.mesh.vHead;for(i=u.next;i!==u;i=i.next)for(var c=0;c<3;++c){var l=i.coords[c];l<r[c]&&(r[c]=l,a[c]=i),l>o[c]&&(o[c]=l,s[c]=i)}var h=0;if(o[1]-r[1]>o[0]-r[0]&&(h=1),o[2]-r[2]>o[h]-r[h]&&(h=2),r[h]>=o[h])return n[0]=0,n[1]=0,void(n[2]=1);var d=0,p=a[h],f=s[h],g=[0,0,0],m=[p.coords[0]-f.coords[0],p.coords[1]-f.coords[1],p.coords[2]-f.coords[2]],_=[0,0,0];for(i=u.next;i!==u;i=i.next){_[0]=i.coords[0]-f.coords[0],_[1]=i.coords[1]-f.coords[1],_[2]=i.coords[2]-f.coords[2],g[0]=m[1]*_[2]-m[2]*_[1],g[1]=m[2]*_[0]-m[0]*_[2],g[2]=m[0]*_[1]-m[1]*_[0];var x=g[0]*g[0]+g[1]*g[1]+g[2]*g[2];x>d&&(d=x,n[0]=g[0],n[1]=g[1],n[2]=g[2])}d<=0&&(n[0]=n[1]=n[2]=0,n[e.normal.longAxis_(m)]=1)},e.normal.checkOrientation_=function(t){for(var e=0,n=t.mesh.fHead,i=n.next;i!==n;i=i.next){var o=i.anEdge;if(!(o.winding<=0))do{e+=(o.org.s-o.dst().s)*(o.org.t+o.dst().t),o=o.lNext}while(o!==i.anEdge)}if(e<0)for(var r=t.mesh.vHead,s=r.next;s!==r;s=s.next)s.t=-s.t},e.render={},e.render.renderMesh=function(t,n,i){for(var o=!1,r=-1,s=n.fHead.prev;s!==n.fHead;s=s.prev)if(s.inside){o||(t.callBeginCallback(e.primitiveType.GL_TRIANGLES),o=!0);var a=s.anEdge;do{if(i){var u=a.rFace().inside?0:1;r!==u&&(r=u,t.callEdgeFlagCallback(!!r))}t.callVertexCallback(a.org.data),a=a.lNext}while(a!==s.anEdge)}o&&t.callEndCallback()},e.render.renderBoundary=function(t,n){for(var i=n.fHead.next;i!==n.fHead;i=i.next)if(i.inside){t.callBeginCallback(e.primitiveType.GL_LINE_LOOP);var o=i.anEdge;do{t.callVertexCallback(o.org.data),o=o.lNext}while(o!==i.anEdge);t.callEndCallback()}},e.sweep={},e.sweep.SENTINEL_COORD_=4*e.GLU_TESS_MAX_COORD,e.sweep.TOLERANCE_NONZERO_=!1,e.sweep.computeInterior=function(t){var n;for(t.fatalError=!1,e.sweep.removeDegenerateEdges_(t),e.sweep.initPriorityQ_(t),e.sweep.initEdgeDict_(t);null!==(n=t.pq.extractMin());){for(;;){var i=t.pq.minimum();if(null===i||!e.geom.vertEq(i,n))break;i=t.pq.extractMin(),e.sweep.spliceMergeVertices_(t,n.anEdge,i.anEdge)}e.sweep.sweepEvent_(t,n)}var o=t.dict.getMin().getKey();t.event=o.eUp.org,e.sweep.doneEdgeDict_(t),e.sweep.donePriorityQ_(t),e.sweep.removeDegenerateFaces_(t.mesh),t.mesh.checkMesh()},e.sweep.addWinding_=function(t,e){t.winding+=e.winding,t.sym.winding+=e.sym.winding},e.sweep.edgeLeq_=function(t,n,i){var o=t.event,r=n.eUp,s=i.eUp;return r.dst()===o?s.dst()===o?e.geom.vertLeq(r.org,s.org)?e.geom.edgeSign(s.dst(),r.org,s.org)<=0:e.geom.edgeSign(r.dst(),s.org,r.org)>=0:e.geom.edgeSign(s.dst(),o,s.org)<=0:s.dst()===o?e.geom.edgeSign(r.dst(),o,r.org)>=0:e.geom.edgeEval(r.dst(),o,r.org)>=e.geom.edgeEval(s.dst(),o,s.org)},e.sweep.deleteRegion_=function(t,e){e.fixUpperEdge,e.eUp.activeRegion=null,t.dict.deleteNode(e.nodeUp),e.nodeUp=null},e.sweep.fixUpperEdge_=function(t,n){e.mesh.deleteEdge(t.eUp),t.fixUpperEdge=!1,t.eUp=n,n.activeRegion=t},e.sweep.topLeftRegion_=function(t){var n=t.eUp.org;do{t=t.regionAbove()}while(t.eUp.org===n);if(t.fixUpperEdge){var i=e.mesh.connect(t.regionBelow().eUp.sym,t.eUp.lNext);e.sweep.fixUpperEdge_(t,i),t=t.regionAbove()}return t},e.sweep.topRightRegion_=function(t){var e=t.eUp.dst();do{t=t.regionAbove()}while(t.eUp.dst()===e);return t},e.sweep.addRegionBelow_=function(t,n,i){var o=new e.ActiveRegion;return o.eUp=i,o.nodeUp=t.dict.insertBefore(n.nodeUp,o),i.activeRegion=o,o},e.sweep.isWindingInside_=function(t,n){switch(t.windingRule){case e.windingRule.GLU_TESS_WINDING_ODD:return 0!=(1&n);case e.windingRule.GLU_TESS_WINDING_NONZERO:return 0!==n;case e.windingRule.GLU_TESS_WINDING_POSITIVE:return n>0;case e.windingRule.GLU_TESS_WINDING_NEGATIVE:return n<0;case e.windingRule.GLU_TESS_WINDING_ABS_GEQ_TWO:return n>=2||n<=-2}return!1},e.sweep.computeWinding_=function(t,n){n.windingNumber=n.regionAbove().windingNumber+n.eUp.winding,n.inside=e.sweep.isWindingInside_(t,n.windingNumber)},e.sweep.finishRegion_=function(t,n){var i=n.eUp,o=i.lFace;o.inside=n.inside,o.anEdge=i,e.sweep.deleteRegion_(t,n)},e.sweep.finishLeftRegions_=function(t,n,i){for(var o=n,r=n.eUp;o!==i;){o.fixUpperEdge=!1;var s=o.regionBelow(),a=s.eUp;if(a.org!==r.org){if(!s.fixUpperEdge){e.sweep.finishRegion_(t,o);break}a=e.mesh.connect(r.lPrev(),a.sym),e.sweep.fixUpperEdge_(s,a)}r.oNext!==a&&(e.mesh.meshSplice(a.oPrev(),a),e.mesh.meshSplice(r,a)),e.sweep.finishRegion_(t,o),r=s.eUp,o=s}return r},e.sweep.addRightEdges_=function(t,n,i,o,r,s){var a=!0,u=i;do{e.sweep.addRegionBelow_(t,n,u.sym),u=u.oNext}while(u!==o);null===r&&(r=n.regionBelow().eUp.rPrev());for(var c,l=n,h=r;(u=(c=l.regionBelow()).eUp.sym).org===h.org;)u.oNext!==h&&(e.mesh.meshSplice(u.oPrev(),u),e.mesh.meshSplice(h.oPrev(),u)),c.windingNumber=l.windingNumber-u.winding,c.inside=e.sweep.isWindingInside_(t,c.windingNumber),l.dirty=!0,!a&&e.sweep.checkForRightSplice_(t,l)&&(e.sweep.addWinding_(u,h),e.sweep.deleteRegion_(t,l),e.mesh.deleteEdge(h)),a=!1,l=c,h=u;l.dirty=!0,s&&e.sweep.walkDirtyRegions_(t,l)},e.sweep.callCombine_=function(t,n,i,o,r){var s=[n.coords[0],n.coords[1],n.coords[2]];n.data=null,n.data=t.callCombineCallback(s,i,o),null===n.data&&(r?t.fatalError||(t.callErrorCallback(e.errorType.GLU_TESS_NEED_COMBINE_CALLBACK),t.fatalError=!0):n.data=i[0])},e.sweep.spliceMergeVertices_=function(t,n,i){var o=[null,null,null,null];o[0]=n.org.data,o[1]=i.org.data,e.sweep.callCombine_(t,n.org,o,[.5,.5,0,0],!1),e.mesh.meshSplice(n,i)},e.sweep.vertexWeights_=function(t,n,i,o,r){var s=e.geom.vertL1dist(n,t),a=e.geom.vertL1dist(i,t),u=r,c=r+1;o[u]=.5*a/(s+a),o[c]=.5*s/(s+a),t.coords[0]+=o[u]*n.coords[0]+o[c]*i.coords[0],t.coords[1]+=o[u]*n.coords[1]+o[c]*i.coords[1],t.coords[2]+=o[u]*n.coords[2]+o[c]*i.coords[2]},e.sweep.getIntersectData_=function(t,n,i,o,r,s){var a=[0,0,0,0],u=[i.data,o.data,r.data,s.data];n.coords[0]=n.coords[1]=n.coords[2]=0,e.sweep.vertexWeights_(n,i,o,a,0),e.sweep.vertexWeights_(n,r,s,a,2),e.sweep.callCombine_(t,n,u,a,!0)},e.sweep.checkForRightSplice_=function(t,n){var i=n.regionBelow(),o=n.eUp,r=i.eUp;if(e.geom.vertLeq(o.org,r.org)){if(e.geom.edgeSign(r.dst(),o.org,r.org)>0)return!1;e.geom.vertEq(o.org,r.org)?o.org!==r.org&&(t.pq.remove(o.org.pqHandle),e.sweep.spliceMergeVertices_(t,r.oPrev(),o)):(e.mesh.splitEdge(r.sym),e.mesh.meshSplice(o,r.oPrev()),n.dirty=i.dirty=!0)}else{if(e.geom.edgeSign(o.dst(),r.org,o.org)<0)return!1;n.regionAbove().dirty=n.dirty=!0,e.mesh.splitEdge(o.sym),e.mesh.meshSplice(r.oPrev(),o)}return!0},e.sweep.checkForLeftSplice_=function(t,n){var i,o=n.regionBelow(),r=n.eUp,s=o.eUp;if(e.geom.vertLeq(r.dst(),s.dst())){if(e.geom.edgeSign(r.dst(),s.dst(),r.org)<0)return!1;n.regionAbove().dirty=n.dirty=!0,i=e.mesh.splitEdge(r),e.mesh.meshSplice(s.sym,i),i.lFace.inside=n.inside}else{if(e.geom.edgeSign(s.dst(),r.dst(),s.org)>0)return!1;n.dirty=o.dirty=!0,i=e.mesh.splitEdge(s),e.mesh.meshSplice(r.lNext,s.sym),i.rFace().inside=n.inside}return!0},e.sweep.checkForIntersect_=function(t,n){var i=n.regionBelow(),o=n.eUp,r=i.eUp,s=o.org,a=r.org,u=o.dst(),c=r.dst(),l=new e.GluVertex;if(s===a)return!1;if(Math.min(s.t,u.t)>Math.max(a.t,c.t))return!1;if(e.geom.vertLeq(s,a)){if(e.geom.edgeSign(c,s,a)>0)return!1}else if(e.geom.edgeSign(u,a,s)<0)return!1;e.geom.edgeIntersect(u,s,c,a,l),e.geom.vertLeq(l,t.event)&&(l.s=t.event.s,l.t=t.event.t);var h=e.geom.vertLeq(s,a)?s:a;if(e.geom.vertLeq(h,l)&&(l.s=h.s,l.t=h.t),e.geom.vertEq(l,s)||e.geom.vertEq(l,a))return e.sweep.checkForRightSplice_(t,n),!1;if(!e.geom.vertEq(u,t.event)&&e.geom.edgeSign(u,t.event,l)>=0||!e.geom.vertEq(c,t.event)&&e.geom.edgeSign(c,t.event,l)<=0){if(c===t.event)return e.mesh.splitEdge(o.sym),e.mesh.meshSplice(r.sym,o),o=(n=e.sweep.topLeftRegion_(n)).regionBelow().eUp,e.sweep.finishLeftRegions_(t,n.regionBelow(),i),e.sweep.addRightEdges_(t,n,o.oPrev(),o,o,!0),!0;if(u===t.event){e.mesh.splitEdge(r.sym),e.mesh.meshSplice(o.lNext,r.oPrev()),i=n;var d=(n=e.sweep.topRightRegion_(n)).regionBelow().eUp.rPrev();return i.eUp=r.oPrev(),r=e.sweep.finishLeftRegions_(t,i,null),e.sweep.addRightEdges_(t,n,r.oNext,o.rPrev(),d,!0),!0}return e.geom.edgeSign(u,t.event,l)>=0&&(n.regionAbove().dirty=n.dirty=!0,e.mesh.splitEdge(o.sym),o.org.s=t.event.s,o.org.t=t.event.t),e.geom.edgeSign(c,t.event,l)<=0&&(n.dirty=i.dirty=!0,e.mesh.splitEdge(r.sym),r.org.s=t.event.s,r.org.t=t.event.t),!1}return e.mesh.splitEdge(o.sym),e.mesh.splitEdge(r.sym),e.mesh.meshSplice(r.oPrev(),o),o.org.s=l.s,o.org.t=l.t,o.org.pqHandle=t.pq.insert(o.org),e.sweep.getIntersectData_(t,o.org,s,u,a,c),n.regionAbove().dirty=n.dirty=i.dirty=!0,!1},e.sweep.walkDirtyRegions_=function(t,n){for(var i=n.regionBelow();;){for(;i.dirty;)n=i,i=i.regionBelow();if(!n.dirty&&(i=n,null===(n=n.regionAbove())||!n.dirty))return;n.dirty=!1;var o=n.eUp,r=i.eUp;if(o.dst()!==r.dst()&&e.sweep.checkForLeftSplice_(t,n)&&(i.fixUpperEdge?(e.sweep.deleteRegion_(t,i),e.mesh.deleteEdge(r),r=(i=n.regionBelow()).eUp):n.fixUpperEdge&&(e.sweep.deleteRegion_(t,n),e.mesh.deleteEdge(o),o=(n=i.regionAbove()).eUp)),o.org!==r.org)if(o.dst()===r.dst()||n.fixUpperEdge||i.fixUpperEdge||o.dst()!==t.event&&r.dst()!==t.event)e.sweep.checkForRightSplice_(t,n);else if(e.sweep.checkForIntersect_(t,n))return;o.org===r.org&&o.dst()===r.dst()&&(e.sweep.addWinding_(r,o),e.sweep.deleteRegion_(t,n),e.mesh.deleteEdge(o),n=i.regionAbove())}},e.sweep.connectRightVertex_=function(t,n,i){var o,r=i.oNext,s=n.regionBelow(),a=n.eUp,u=s.eUp,c=!1;(a.dst()!==u.dst()&&e.sweep.checkForIntersect_(t,n),e.geom.vertEq(a.org,t.event)&&(e.mesh.meshSplice(r.oPrev(),a),r=(n=e.sweep.topLeftRegion_(n)).regionBelow().eUp,e.sweep.finishLeftRegions_(t,n.regionBelow(),s),c=!0),e.geom.vertEq(u.org,t.event)&&(e.mesh.meshSplice(i,u.oPrev()),i=e.sweep.finishLeftRegions_(t,s,null),c=!0),c)?e.sweep.addRightEdges_(t,n,i.oNext,r,r,!0):(o=e.geom.vertLeq(u.org,a.org)?u.oPrev():a,o=e.mesh.connect(i.lPrev(),o),e.sweep.addRightEdges_(t,n,o,o.oNext,o.oNext,!1),o.sym.activeRegion.fixUpperEdge=!0,e.sweep.walkDirtyRegions_(t,n))},e.sweep.connectLeftDegenerate_=function(t,n,i){var o=n.eUp;if(e.geom.vertEq(o.org,i))e.sweep.TOLERANCE_NONZERO_&&e.sweep.spliceMergeVertices_(t,o,i.anEdge);else{if(!e.geom.vertEq(o.dst(),i))return e.mesh.splitEdge(o.sym),n.fixUpperEdge&&(e.mesh.deleteEdge(o.oNext),n.fixUpperEdge=!1),e.mesh.meshSplice(i.anEdge,o),void e.sweep.sweepEvent_(t,i);if(e.sweep.TOLERANCE_NONZERO_){var r=(n=e.sweep.topRightRegion_(n)).regionBelow(),s=r.eUp.sym,a=s.oNext,u=a;r.fixUpperEdge&&(e.sweep.deleteRegion_(t,r),e.mesh.deleteEdge(s),s=a.oPrev()),e.mesh.meshSplice(i.anEdge,s),e.geom.edgeGoesLeft(a)||(a=null),e.sweep.addRightEdges_(t,n,s.oNext,u,a,!0)}}},e.sweep.connectLeftVertex_=function(t,n){var i=new e.ActiveRegion;i.eUp=n.anEdge.sym;var o=t.dict.search(i).getKey(),r=o.regionBelow(),s=o.eUp,a=r.eUp;if(0!==e.geom.edgeSign(s.dst(),n,s.org)){var u,c=e.geom.vertLeq(a.dst(),s.dst())?o:r;if(o.inside||c.fixUpperEdge){if(c===o)u=e.mesh.connect(n.anEdge.sym,s.lNext);else u=e.mesh.connect(a.dNext(),n.anEdge).sym;c.fixUpperEdge?e.sweep.fixUpperEdge_(c,u):e.sweep.computeWinding_(t,e.sweep.addRegionBelow_(t,o,u)),e.sweep.sweepEvent_(t,n)}else e.sweep.addRightEdges_(t,o,n.anEdge,n.anEdge,null,!0)}else e.sweep.connectLeftDegenerate_(t,o,n)},e.sweep.sweepEvent_=function(t,n){t.event=n;for(var i=n.anEdge;null===i.activeRegion;)if((i=i.oNext)===n.anEdge)return void e.sweep.connectLeftVertex_(t,n);var o=e.sweep.topLeftRegion_(i.activeRegion),r=o.regionBelow(),s=r.eUp,a=e.sweep.finishLeftRegions_(t,r,null);a.oNext===s?e.sweep.connectRightVertex_(t,o,a):e.sweep.addRightEdges_(t,o,a.oNext,s,s,!0)},e.sweep.addSentinel_=function(t,n){var i=new e.ActiveRegion,o=e.mesh.makeEdge(t.mesh);o.org.s=e.sweep.SENTINEL_COORD_,o.org.t=n,o.dst().s=-e.sweep.SENTINEL_COORD_,o.dst().t=n,t.event=o.dst(),i.eUp=o,i.windingNumber=0,i.inside=!1,i.fixUpperEdge=!1,i.sentinel=!0,i.dirty=!1,i.nodeUp=t.dict.insert(i)},e.sweep.initEdgeDict_=function(t){t.dict=new e.Dict(t,e.sweep.edgeLeq_),e.sweep.addSentinel_(t,-e.sweep.SENTINEL_COORD_),e.sweep.addSentinel_(t,e.sweep.SENTINEL_COORD_)},e.sweep.doneEdgeDict_=function(t){for(var n;null!==(n=t.dict.getMin().getKey());)n.sentinel,e.sweep.deleteRegion_(t,n);t.dict=null},e.sweep.removeDegenerateEdges_=function(t){for(var n,i=t.mesh.eHead,o=i.next;o!==i;o=n){n=o.next;var r=o.lNext;e.geom.vertEq(o.org,o.dst())&&o.lNext.lNext!==o&&(e.sweep.spliceMergeVertices_(t,r,o),e.mesh.deleteEdge(o),r=(o=r).lNext),r.lNext===o&&(r!==o&&(r!==n&&r!==n.sym||(n=n.next),e.mesh.deleteEdge(r)),o!==n&&o!==n.sym||(n=n.next),e.mesh.deleteEdge(o))}},e.sweep.initPriorityQ_=function(t){var n=new e.PriorityQ;t.pq=n;var i,o=t.mesh.vHead;for(i=o.next;i!==o;i=i.next)i.pqHandle=n.insert(i);n.init()},e.sweep.donePriorityQ_=function(t){t.pq.deleteQ(),t.pq=null},e.sweep.removeDegenerateFaces_=function(t){for(var n,i=t.fHead.next;i!==t.fHead;i=n){n=i.next;var o=i.anEdge;o.lNext.lNext===o&&(e.sweep.addWinding_(o.oNext,o),e.mesh.deleteEdge(o))}},e.tessmono={},e.tessmono.tessellateMonoRegion_=function(t){for(var n=t.anEdge;e.geom.vertLeq(n.dst(),n.org);n=n.lPrev());for(;e.geom.vertLeq(n.org,n.dst());n=n.lNext);for(var i,o=n.lPrev();n.lNext!==o;)if(e.geom.vertLeq(n.dst(),o.org)){for(;o.lNext!==n&&(e.geom.edgeGoesLeft(o.lNext)||e.geom.edgeSign(o.org,o.dst(),o.lNext.dst())<=0);)o=(i=e.mesh.connect(o.lNext,o)).sym;o=o.lPrev()}else{for(;o.lNext!==n&&(e.geom.edgeGoesRight(n.lPrev())||e.geom.edgeSign(n.dst(),n.org,n.lPrev().org)>=0);)i=e.mesh.connect(n,n.lPrev()),n=i.sym;n=n.lNext}for(;o.lNext.lNext!==n;)o=(i=e.mesh.connect(o.lNext,o)).sym},e.tessmono.tessellateInterior=function(t){for(var n,i=t.fHead.next;i!==t.fHead;i=n)n=i.next,i.inside&&e.tessmono.tessellateMonoRegion_(i)},e.tessmono.discardExterior=function(t){for(var n,i=t.fHead.next;i!==t.fHead;i=n)n=i.next,i.inside||e.mesh.zapFace(i)},e.tessmono.setWindingNumber=function(t,n,i){for(var o,r=t.eHead.next;r!==t.eHead;r=o)o=r.next,r.rFace().inside!==r.lFace.inside?r.winding=r.lFace.inside?n:-n:i?e.mesh.deleteEdge(r):r.winding=0},e.Dict=function(t,n){this.head_=new e.DictNode,this.frame_=t,this.leq_=n},e.Dict.prototype.deleteDict_=function(){},e.Dict.prototype.insertBefore=function(t,n){do{t=t.prev}while(null!==t.key&&!this.leq_(this.frame_,t.key,n));var i=new e.DictNode(n,t.next,t);return t.next.prev=i,t.next=i,i},e.Dict.prototype.insert=function(t){return this.insertBefore(this.head_,t)},e.Dict.prototype.deleteNode=function(t){t.next.prev=t.prev,t.prev.next=t.next},e.Dict.prototype.search=function(t){var e=this.head_;do{e=e.next}while(null!==e.key&&!this.leq_(this.frame_,t,e.key));return e},e.Dict.prototype.getMin=function(){return this.head_.next},e.Dict.prototype.getMax=function(){return this.head_.prev},e.DictNode=function(t,e,n){this.key=t||null,this.next=e||this,this.prev=n||this},e.DictNode.prototype.getKey=function(){return this.key},e.DictNode.prototype.getSuccessor=function(){return this.next},e.DictNode.prototype.getPredecessor=function(){return this.prev},e.GluTesselator=function(){this.state_=e.GluTesselator.tessState_.T_DORMANT,this.lastEdge_=null,this.mesh=null,this.errorCallback_=null,this.normal_=[0,0,0],this.windingRule=e.windingRule.GLU_TESS_WINDING_ODD,this.fatalError=!1,this.dict=null,this.pq=null,this.event=null,this.combineCallback_=null,this.boundaryOnly_=!1,this.beginCallback_=null,this.edgeFlagCallback_=null,this.vertexCallback_=null,this.endCallback_=null,this.meshCallback_=null,this.polygonData_=null},e.GluTesselator.tessState_={T_DORMANT:0,T_IN_POLYGON:1,T_IN_CONTOUR:2},e.GluTesselator.prototype.gluDeleteTess=function(){this.requireState_(e.GluTesselator.tessState_.T_DORMANT)},e.GluTesselator.prototype.gluTessProperty=function(t,n){switch(t){case e.gluEnum.GLU_TESS_TOLERANCE:return;case e.gluEnum.GLU_TESS_WINDING_RULE:var i=n;switch(i){case e.windingRule.GLU_TESS_WINDING_ODD:case e.windingRule.GLU_TESS_WINDING_NONZERO:case e.windingRule.GLU_TESS_WINDING_POSITIVE:case e.windingRule.GLU_TESS_WINDING_NEGATIVE:case e.windingRule.GLU_TESS_WINDING_ABS_GEQ_TWO:return void(this.windingRule=i)}break;case e.gluEnum.GLU_TESS_BOUNDARY_ONLY:return void(this.boundaryOnly_=!!n);default:return void this.callErrorCallback(e.gluEnum.GLU_INVALID_ENUM)}this.callErrorCallback(e.gluEnum.GLU_INVALID_VALUE)},e.GluTesselator.prototype.gluGetTessProperty=function(t){switch(t){case e.gluEnum.GLU_TESS_TOLERANCE:return 0;case e.gluEnum.GLU_TESS_WINDING_RULE:return this.windingRule;case e.gluEnum.GLU_TESS_BOUNDARY_ONLY:return this.boundaryOnly_;default:this.callErrorCallback(e.gluEnum.GLU_INVALID_ENUM)}return!1},e.GluTesselator.prototype.gluTessNormal=function(t,e,n){this.normal_[0]=t,this.normal_[1]=e,this.normal_[2]=n},e.GluTesselator.prototype.gluTessCallback=function(t,n){var i=n||null;switch(t){case e.gluEnum.GLU_TESS_BEGIN:case e.gluEnum.GLU_TESS_BEGIN_DATA:return void(this.beginCallback_=i);case e.gluEnum.GLU_TESS_EDGE_FLAG:case e.gluEnum.GLU_TESS_EDGE_FLAG_DATA:return void(this.edgeFlagCallback_=i);case e.gluEnum.GLU_TESS_VERTEX:case e.gluEnum.GLU_TESS_VERTEX_DATA:return void(this.vertexCallback_=i);case e.gluEnum.GLU_TESS_END:case e.gluEnum.GLU_TESS_END_DATA:return void(this.endCallback_=i);case e.gluEnum.GLU_TESS_ERROR:case e.gluEnum.GLU_TESS_ERROR_DATA:return void(this.errorCallback_=i);case e.gluEnum.GLU_TESS_COMBINE:case e.gluEnum.GLU_TESS_COMBINE_DATA:return void(this.combineCallback_=i);case e.gluEnum.GLU_TESS_MESH:return void(this.meshCallback_=i);default:return void this.callErrorCallback(e.gluEnum.GLU_INVALID_ENUM)}},e.GluTesselator.prototype.gluTessVertex=function(t,n){var i=!1,o=[0,0,0];this.requireState_(e.GluTesselator.tessState_.T_IN_CONTOUR);for(var r=0;r<3;++r){var s=t[r];s<-e.GLU_TESS_MAX_COORD&&(s=-e.GLU_TESS_MAX_COORD,i=!0),s>e.GLU_TESS_MAX_COORD&&(s=e.GLU_TESS_MAX_COORD,i=!0),o[r]=s}i&&this.callErrorCallback(e.errorType.GLU_TESS_COORD_TOO_LARGE),this.addVertex_(o,n)},e.GluTesselator.prototype.gluTessBeginPolygon=function(t){this.requireState_(e.GluTesselator.tessState_.T_DORMANT),this.state_=e.GluTesselator.tessState_.T_IN_POLYGON,this.mesh=new e.GluMesh,this.polygonData_=t},e.GluTesselator.prototype.gluTessBeginContour=function(){this.requireState_(e.GluTesselator.tessState_.T_IN_POLYGON),this.state_=e.GluTesselator.tessState_.T_IN_CONTOUR,this.lastEdge_=null},e.GluTesselator.prototype.gluTessEndContour=function(){this.requireState_(e.GluTesselator.tessState_.T_IN_CONTOUR),this.state_=e.GluTesselator.tessState_.T_IN_POLYGON},e.GluTesselator.prototype.gluTessEndPolygon=function(){if(this.requireState_(e.GluTesselator.tessState_.T_IN_POLYGON),this.state_=e.GluTesselator.tessState_.T_DORMANT,e.normal.projectPolygon(this,this.normal_[0],this.normal_[1],this.normal_[2]),e.sweep.computeInterior(this),!this.fatalError){var t=this.mesh;if(this.boundaryOnly_?e.tessmono.setWindingNumber(t,1,!0):e.tessmono.tessellateInterior(t),this.mesh.checkMesh(),this.beginCallback_||this.endCallback_||this.vertexCallback_||this.edgeFlagCallback_)if(this.boundaryOnly_)e.render.renderBoundary(this,this.mesh);else{var n=!!this.edgeFlagCallback_;e.render.renderMesh(this,this.mesh,n)}if(this.meshCallback_)return e.tessmono.discardExterior(this.mesh),this.meshCallback_(this.mesh),this.mesh=null,void(this.polygonData_=null)}e.mesh.deleteMesh(this.mesh),this.polygonData_=null,this.mesh=null},e.GluTesselator.prototype.requireState_=function(t){this.state_!==t&&this.gotoState_(t)},e.GluTesselator.prototype.gotoState_=function(t){for(;this.state_!==t;)if(this.state_<t)switch(this.state_){case e.GluTesselator.tessState_.T_DORMANT:this.callErrorCallback(e.errorType.GLU_TESS_MISSING_BEGIN_POLYGON),this.gluTessBeginPolygon(null);break;case e.GluTesselator.tessState_.T_IN_POLYGON:this.callErrorCallback(e.errorType.GLU_TESS_MISSING_BEGIN_CONTOUR),this.gluTessBeginContour()}else switch(this.state_){case e.GluTesselator.tessState_.T_IN_CONTOUR:this.callErrorCallback(e.errorType.GLU_TESS_MISSING_END_CONTOUR),this.gluTessEndContour();break;case e.GluTesselator.tessState_.T_IN_POLYGON:this.callErrorCallback(e.errorType.GLU_TESS_MISSING_END_POLYGON),this.gluTessEndPolygon()}},e.GluTesselator.prototype.addVertex_=function(t,n){var i=this.lastEdge_;null===i?(i=e.mesh.makeEdge(this.mesh),e.mesh.meshSplice(i,i.sym)):(e.mesh.splitEdge(i),i=i.lNext),i.org.data=n,i.org.coords[0]=t[0],i.org.coords[1]=t[1],i.org.coords[2]=t[2],i.winding=1,i.sym.winding=-1,this.lastEdge_=i},e.GluTesselator.prototype.callBeginCallback=function(t){this.beginCallback_&&this.beginCallback_(t,this.polygonData_)},e.GluTesselator.prototype.callVertexCallback=function(t){this.vertexCallback_&&this.vertexCallback_(t,this.polygonData_)},e.GluTesselator.prototype.callEdgeFlagCallback=function(t){this.edgeFlagCallback_&&this.edgeFlagCallback_(t,this.polygonData_)},e.GluTesselator.prototype.callEndCallback=function(){this.endCallback_&&this.endCallback_(this.polygonData_)},e.GluTesselator.prototype.callCombineCallback=function(t,e,n){return this.combineCallback_&&this.combineCallback_(t,e,n,this.polygonData_)||null},e.GluTesselator.prototype.callErrorCallback=function(t){this.errorCallback_&&this.errorCallback_(t,this.polygonData_)},e.GluFace=function(t,e){this.next=t||this,this.prev=e||this,this.anEdge=null,this.data=null,this.inside=!1},e.GluHalfEdge=function(t){this.next=t||this,this.sym=null,this.oNext=null,this.lNext=null,this.org=null,this.lFace=null,this.activeRegion=null,this.winding=0},e.GluHalfEdge.prototype.rFace=function(){return this.sym.lFace},e.GluHalfEdge.prototype.dst=function(){return this.sym.org},e.GluHalfEdge.prototype.oPrev=function(){return this.sym.lNext},e.GluHalfEdge.prototype.lPrev=function(){return this.oNext.sym},e.GluHalfEdge.prototype.dPrev=function(){return this.lNext.sym},e.GluHalfEdge.prototype.rPrev=function(){return this.sym.oNext},e.GluHalfEdge.prototype.dNext=function(){return this.rPrev().sym},e.GluHalfEdge.prototype.rNext=function(){return this.oPrev().sym},e.GluMesh=function(){this.vHead=new e.GluVertex,this.fHead=new e.GluFace,this.eHead=new e.GluHalfEdge,this.eHeadSym=new e.GluHalfEdge,this.eHead.sym=this.eHeadSym,this.eHeadSym.sym=this.eHead},e.GluMesh.prototype.checkMesh=function(){if(e.DEBUG){var t,n,i,o=this.fHead,r=this.vHead,s=this.eHead,a=o;for(a=o;(n=a.next)!==o;a=n){t=n.anEdge;do{t=t.lNext}while(t!==n.anEdge)}var u=r;for(u=r;(i=u.next)!==r;u=i){t=i.anEdge;do{t=t.oNext}while(t!==i.anEdge)}var c=s;for(c=s;(t=c.next)!==s;c=t);}},e.GluVertex=function(t,e){this.next=t||this,this.prev=e||this,this.anEdge=null,this.data=null,this.coords=[0,0,0],this.s=0,this.t=0,this.pqHandle=0},e.PriorityQ=function(){this.verts_=[],this.order_=null,this.size_=0,this.initialized_=!1,this.heap_=new e.PriorityQHeap},e.PriorityQ.prototype.deleteQ=function(){this.heap_=null,this.order_=null,this.verts_=null},e.PriorityQ.prototype.init=function(){this.order_=[];for(var t=0;t<this.size_;t++)this.order_[t]=t;var n,i=(n=this.verts_,function(t,i){return e.geom.vertLeq(n[t],n[i])?1:-1});if(this.order_.sort(i),this.initialized_=!0,this.heap_.init(),e.DEBUG){var o=0+this.size_-1;for(t=0;t<o;++t);}},e.PriorityQ.prototype.insert=function(t){if(this.initialized_)return this.heap_.insert(t);var e=this.size_++;return this.verts_[e]=t,-(e+1)},e.PriorityQ.prototype.extractMin=function(){if(0===this.size_)return this.heap_.extractMin();var t=this.verts_[this.order_[this.size_-1]];if(!this.heap_.isEmpty()){var n=this.heap_.minimum();if(e.geom.vertLeq(n,t))return this.heap_.extractMin()}do{--this.size_}while(this.size_>0&&null===this.verts_[this.order_[this.size_-1]]);return t},e.PriorityQ.prototype.minimum=function(){if(0===this.size_)return this.heap_.minimum();var t=this.verts_[this.order_[this.size_-1]];if(!this.heap_.isEmpty()){var n=this.heap_.minimum();if(e.geom.vertLeq(n,t))return n}return t},e.PriorityQ.prototype.remove=function(t){if(t>=0)this.heap_.remove(t);else for(t=-(t+1),this.verts_[t]=null;this.size_>0&&null===this.verts_[this.order_[this.size_-1]];)--this.size_},e.PriorityQHeap=function(){this.heap_=e.PriorityQHeap.reallocNumeric_([0],e.PriorityQHeap.INIT_SIZE_+1),this.verts_=[null,null],this.handles_=[0,0],this.size_=0,this.max_=e.PriorityQHeap.INIT_SIZE_,this.freeList_=0,this.initialized_=!1,this.heap_[1]=1},e.PriorityQHeap.INIT_SIZE_=32,e.PriorityQHeap.reallocNumeric_=function(t,e){for(var n=new Array(e),i=0;i<t.length;i++)n[i]=t[i];for(;i<e;i++)n[i]=0;return n},e.PriorityQHeap.prototype.init=function(){for(var t=this.size_;t>=1;--t)this.floatDown_(t);this.initialized_=!0},e.PriorityQHeap.prototype.insert=function(t){var n,i=++this.size_;return 2*i>this.max_&&(this.max_*=2,this.handles_=e.PriorityQHeap.reallocNumeric_(this.handles_,this.max_+1)),0===this.freeList_?n=i:(n=this.freeList_,this.freeList_=this.handles_[this.freeList_]),this.verts_[n]=t,this.handles_[n]=i,this.heap_[i]=n,this.initialized_&&this.floatUp_(i),n},e.PriorityQHeap.prototype.isEmpty=function(){return 0===this.size_},e.PriorityQHeap.prototype.minimum=function(){return this.verts_[this.heap_[1]]},e.PriorityQHeap.prototype.extractMin=function(){var t=this.heap_,e=this.verts_,n=this.handles_,i=t[1],o=e[i];return this.size_>0&&(t[1]=t[this.size_],n[t[1]]=1,e[i]=null,n[i]=this.freeList_,this.freeList_=i,--this.size_>0&&this.floatDown_(1)),o},e.PriorityQHeap.prototype.remove=function(t){var n=this.heap_,i=this.verts_,o=this.handles_,r=o[t];if(n[r]=n[this.size_],o[n[r]]=r,r<=--this.size_)if(r<=1)this.floatDown_(r);else{var s=i[n[r]],a=i[n[r>>1]];e.geom.vertLeq(a,s)?this.floatDown_(r):this.floatUp_(r)}i[t]=null,o[t]=this.freeList_,this.freeList_=t},e.PriorityQHeap.prototype.floatDown_=function(t){for(var n=this.heap_,i=this.verts_,o=this.handles_,r=t,s=n[r];;){var a=r<<1;a<this.size_&&e.geom.vertLeq(i[n[a+1]],i[n[a]])&&(a+=1);var u=n[a];if(a>this.size_||e.geom.vertLeq(i[s],i[u]))return n[r]=s,void(o[s]=r);n[r]=u,o[u]=r,r=a}},e.PriorityQHeap.prototype.floatUp_=function(t){for(var n=this.heap_,i=this.verts_,o=this.handles_,r=t,s=n[r];;){var a=r>>1,u=n[a];if(0===a||e.geom.vertLeq(i[u],i[s]))return n[r]=s,void(o[s]=r);n[r]=u,o[u]=r,r=a}},e.ActiveRegion=function(){this.eUp=null,this.nodeUp=null,this.windingNumber=0,this.inside=!1,this.sentinel=!1,this.dirty=!1,this.fixUpperEdge=!1},e.ActiveRegion.prototype.regionBelow=function(){return this.nodeUp.getPredecessor().getKey()},e.ActiveRegion.prototype.regionAbove=function(){return this.nodeUp.getSuccessor().getKey()},t.exports=e},235:function(t,e){!function(t){"use strict";var e=(t,e,n,i)=>{let o=65535&t|0,r=t>>>16&65535|0,s=0;for(;0!==n;){s=n>2e3?2e3:n,n-=s;do{o=o+e[i++]|0,r=r+o|0}while(--s);o%=65521,r%=65521}return o|r<<16|0};const n=new Uint32Array((()=>{let t,e=[];for(var n=0;n<256;n++){t=n;for(var i=0;i<8;i++)t=1&t?3988292384^t>>>1:t>>>1;e[n]=t}return e})());var i=(t,e,i,o)=>{const r=n,s=o+i;t^=-1;for(let n=o;n<s;n++)t=t>>>8^r[255&(t^e[n])];return-1^t};const o=16209,r=16191;var s=function(t,e){let n,i,s,a,u,c,l,h,d,p,f,g,m,_,x,y,w,S,T,b,v,C,E,O;const N=t.state;n=t.next_in,E=t.input,i=n+(t.avail_in-5),s=t.next_out,O=t.output,a=s-(e-t.avail_out),u=s+(t.avail_out-257),c=N.dmax,l=N.wsize,h=N.whave,d=N.wnext,p=N.window,f=N.hold,g=N.bits,m=N.lencode,_=N.distcode,x=(1<<N.lenbits)-1,y=(1<<N.distbits)-1;t:do{g<15&&(f+=E[n++]<<g,g+=8,f+=E[n++]<<g,g+=8),w=m[f&x];e:for(;;){if(S=w>>>24,f>>>=S,g-=S,S=w>>>16&255,0===S)O[s++]=65535&w;else{if(!(16&S)){if(0==(64&S)){w=m[(65535&w)+(f&(1<<S)-1)];continue e}if(32&S){N.mode=r;break t}t.msg="invalid literal/length code",N.mode=o;break t}T=65535&w,S&=15,S&&(g<S&&(f+=E[n++]<<g,g+=8),T+=f&(1<<S)-1,f>>>=S,g-=S),g<15&&(f+=E[n++]<<g,g+=8,f+=E[n++]<<g,g+=8),w=_[f&y];n:for(;;){if(S=w>>>24,f>>>=S,g-=S,S=w>>>16&255,!(16&S)){if(0==(64&S)){w=_[(65535&w)+(f&(1<<S)-1)];continue n}t.msg="invalid distance code",N.mode=o;break t}if(b=65535&w,S&=15,g<S&&(f+=E[n++]<<g,g+=8,g<S&&(f+=E[n++]<<g,g+=8)),b+=f&(1<<S)-1,b>c){t.msg="invalid distance too far back",N.mode=o;break t}if(f>>>=S,g-=S,S=s-a,b>S){if(S=b-S,S>h&&N.sane){t.msg="invalid distance too far back",N.mode=o;break t}if(v=0,C=p,0===d){if(v+=l-S,S<T){T-=S;do{O[s++]=p[v++]}while(--S);v=s-b,C=O}}else if(d<S){if(v+=l+d-S,S-=d,S<T){T-=S;do{O[s++]=p[v++]}while(--S);if(v=0,d<T){S=d,T-=S;do{O[s++]=p[v++]}while(--S);v=s-b,C=O}}}else if(v+=d-S,S<T){T-=S;do{O[s++]=p[v++]}while(--S);v=s-b,C=O}for(;T>2;)O[s++]=C[v++],O[s++]=C[v++],O[s++]=C[v++],T-=3;T&&(O[s++]=C[v++],T>1&&(O[s++]=C[v++]))}else{v=s-b;do{O[s++]=O[v++],O[s++]=O[v++],O[s++]=O[v++],T-=3}while(T>2);T&&(O[s++]=O[v++],T>1&&(O[s++]=O[v++]))}break}}break}}while(n<i&&s<u);T=g>>3,n-=T,g-=T<<3,f&=(1<<g)-1,t.next_in=n,t.next_out=s,t.avail_in=n<i?i-n+5:5-(n-i),t.avail_out=s<u?u-s+257:257-(s-u),N.hold=f,N.bits=g};const a=15,u=852,c=592,l=0,h=1,d=2,p=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),f=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),g=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),m=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);var _=(t,e,n,i,o,r,s,_)=>{const x=_.bits;let y,w,S,T,b,v,C=0,E=0,O=0,N=0,F=0,I=0,M=0,D=0,V=0,R=0,P=null;const A=new Uint16Array(a+1),L=new Uint16Array(a+1);let B,X,U,k=null;for(C=0;C<=a;C++)A[C]=0;for(E=0;E<i;E++)A[e[n+E]]++;for(F=x,N=a;N>=1&&0===A[N];N--);if(F>N&&(F=N),0===N)return o[r++]=20971520,o[r++]=20971520,_.bits=1,0;for(O=1;O<N&&0===A[O];O++);for(F<O&&(F=O),D=1,C=1;C<=a;C++)if(D<<=1,D-=A[C],D<0)return-1;if(D>0&&(t===l||1!==N))return-1;for(L[1]=0,C=1;C<a;C++)L[C+1]=L[C]+A[C];for(E=0;E<i;E++)0!==e[n+E]&&(s[L[e[n+E]]++]=E);if(t===l?(P=k=s,v=20):t===h?(P=p,k=f,v=257):(P=g,k=m,v=0),R=0,E=0,C=O,b=r,I=F,M=0,S=-1,V=1<<F,T=V-1,t===h&&V>u||t===d&&V>c)return 1;for(;;){B=C-M,s[E]+1<v?(X=0,U=s[E]):s[E]>=v?(X=k[s[E]-v],U=P[s[E]-v]):(X=96,U=0),y=1<<C-M,w=1<<I,O=w;do{w-=y,o[b+(R>>M)+w]=B<<24|X<<16|U|0}while(0!==w);for(y=1<<C-1;R&y;)y>>=1;if(0!==y?(R&=y-1,R+=y):R=0,E++,0==--A[C]){if(C===N)break;C=e[n+s[E]]}if(C>F&&(R&T)!==S){for(0===M&&(M=F),b+=O,I=C-M,D=1<<I;I+M<N&&(D-=A[I+M],!(D<=0));)I++,D<<=1;if(V+=1<<I,t===h&&V>u||t===d&&V>c)return 1;S=R&T,o[S]=F<<24|I<<16|b-r|0}}return 0!==R&&(o[b+R]=C-M<<24|64<<16|0),_.bits=F,0},x={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8};const y=0,w=1,S=2,{Z_FINISH:T,Z_BLOCK:b,Z_TREES:v,Z_OK:C,Z_STREAM_END:E,Z_NEED_DICT:O,Z_STREAM_ERROR:N,Z_DATA_ERROR:F,Z_MEM_ERROR:I,Z_BUF_ERROR:M,Z_DEFLATED:D}=x,V=16180,R=16181,P=16182,A=16183,L=16184,B=16185,X=16186,U=16187,k=16188,z=16189,j=16190,G=16191,H=16192,q=16193,Y=16194,W=16195,K=16196,J=16197,Z=16198,Q=16199,$=16200,tt=16201,et=16202,nt=16203,it=16204,ot=16205,rt=16206,st=16207,at=16208,ut=16209,ct=16210,lt=16211,ht=852,dt=592,pt=15,ft=t=>(t>>>24&255)+(t>>>8&65280)+((65280&t)<<8)+((255&t)<<24);function gt(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const mt=t=>{if(!t)return 1;const e=t.state;return!e||e.strm!==t||e.mode<V||e.mode>lt?1:0},_t=t=>{if(mt(t))return N;const e=t.state;return t.total_in=t.total_out=e.total=0,t.msg="",e.wrap&&(t.adler=1&e.wrap),e.mode=V,e.last=0,e.havedict=0,e.flags=-1,e.dmax=32768,e.head=null,e.hold=0,e.bits=0,e.lencode=e.lendyn=new Int32Array(ht),e.distcode=e.distdyn=new Int32Array(dt),e.sane=1,e.back=-1,C},xt=t=>{if(mt(t))return N;const e=t.state;return e.wsize=0,e.whave=0,e.wnext=0,_t(t)},yt=(t,e)=>{let n;if(mt(t))return N;const i=t.state;return e<0?(n=0,e=-e):(n=5+(e>>4),e<48&&(e&=15)),e&&(e<8||e>15)?N:(null!==i.window&&i.wbits!==e&&(i.window=null),i.wrap=n,i.wbits=e,xt(t))},wt=(t,e)=>{if(!t)return N;const n=new gt;t.state=n,n.strm=t,n.window=null,n.mode=V;const i=yt(t,e);return i!==C&&(t.state=null),i};let St,Tt,bt=!0;const vt=t=>{if(bt){St=new Int32Array(512),Tt=new Int32Array(32);let e=0;for(;e<144;)t.lens[e++]=8;for(;e<256;)t.lens[e++]=9;for(;e<280;)t.lens[e++]=7;for(;e<288;)t.lens[e++]=8;for(_(w,t.lens,0,288,St,0,t.work,{bits:9}),e=0;e<32;)t.lens[e++]=5;_(S,t.lens,0,32,Tt,0,t.work,{bits:5}),bt=!1}t.lencode=St,t.lenbits=9,t.distcode=Tt,t.distbits=5},Ct=(t,e,n,i)=>{let o;const r=t.state;return null===r.window&&(r.wsize=1<<r.wbits,r.wnext=0,r.whave=0,r.window=new Uint8Array(r.wsize)),i>=r.wsize?(r.window.set(e.subarray(n-r.wsize,n),0),r.wnext=0,r.whave=r.wsize):(o=r.wsize-r.wnext,o>i&&(o=i),r.window.set(e.subarray(n-i,n-i+o),r.wnext),(i-=o)?(r.window.set(e.subarray(n-i,n),0),r.wnext=i,r.whave=r.wsize):(r.wnext+=o,r.wnext===r.wsize&&(r.wnext=0),r.whave<r.wsize&&(r.whave+=o))),0};var Et={inflateReset:xt,inflateReset2:yt,inflateResetKeep:_t,inflateInit:t=>wt(t,pt),inflateInit2:wt,inflate:(t,n)=>{let o,r,a,u,c,l,h,d,p,f,g,m,x,lt,ht,dt,pt,gt,_t,xt,yt,wt,St=0;const Tt=new Uint8Array(4);let bt,Et;const Ot=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(mt(t)||!t.output||!t.input&&0!==t.avail_in)return N;o=t.state,o.mode===G&&(o.mode=H),c=t.next_out,a=t.output,h=t.avail_out,u=t.next_in,r=t.input,l=t.avail_in,d=o.hold,p=o.bits,f=l,g=h,wt=C;t:for(;;)switch(o.mode){case V:if(0===o.wrap){o.mode=H;break}for(;p<16;){if(0===l)break t;l--,d+=r[u++]<<p,p+=8}if(2&o.wrap&&35615===d){0===o.wbits&&(o.wbits=15),o.check=0,Tt[0]=255&d,Tt[1]=d>>>8&255,o.check=i(o.check,Tt,2,0),d=0,p=0,o.mode=R;break}if(o.head&&(o.head.done=!1),!(1&o.wrap)||(((255&d)<<8)+(d>>8))%31){t.msg="incorrect header check",o.mode=ut;break}if((15&d)!==D){t.msg="unknown compression method",o.mode=ut;break}if(d>>>=4,p-=4,yt=8+(15&d),0===o.wbits&&(o.wbits=yt),yt>15||yt>o.wbits){t.msg="invalid window size",o.mode=ut;break}o.dmax=1<<o.wbits,o.flags=0,t.adler=o.check=1,o.mode=512&d?z:G,d=0,p=0;break;case R:for(;p<16;){if(0===l)break t;l--,d+=r[u++]<<p,p+=8}if(o.flags=d,(255&o.flags)!==D){t.msg="unknown compression method",o.mode=ut;break}if(57344&o.flags){t.msg="unknown header flags set",o.mode=ut;break}o.head&&(o.head.text=d>>8&1),512&o.flags&&4&o.wrap&&(Tt[0]=255&d,Tt[1]=d>>>8&255,o.check=i(o.check,Tt,2,0)),d=0,p=0,o.mode=P;case P:for(;p<32;){if(0===l)break t;l--,d+=r[u++]<<p,p+=8}o.head&&(o.head.time=d),512&o.flags&&4&o.wrap&&(Tt[0]=255&d,Tt[1]=d>>>8&255,Tt[2]=d>>>16&255,Tt[3]=d>>>24&255,o.check=i(o.check,Tt,4,0)),d=0,p=0,o.mode=A;case A:for(;p<16;){if(0===l)break t;l--,d+=r[u++]<<p,p+=8}o.head&&(o.head.xflags=255&d,o.head.os=d>>8),512&o.flags&&4&o.wrap&&(Tt[0]=255&d,Tt[1]=d>>>8&255,o.check=i(o.check,Tt,2,0)),d=0,p=0,o.mode=L;case L:if(1024&o.flags){for(;p<16;){if(0===l)break t;l--,d+=r[u++]<<p,p+=8}o.length=d,o.head&&(o.head.extra_len=d),512&o.flags&&4&o.wrap&&(Tt[0]=255&d,Tt[1]=d>>>8&255,o.check=i(o.check,Tt,2,0)),d=0,p=0}else o.head&&(o.head.extra=null);o.mode=B;case B:if(1024&o.flags&&(m=o.length,m>l&&(m=l),m&&(o.head&&(yt=o.head.extra_len-o.length,o.head.extra||(o.head.extra=new Uint8Array(o.head.extra_len)),o.head.extra.set(r.subarray(u,u+m),yt)),512&o.flags&&4&o.wrap&&(o.check=i(o.check,r,m,u)),l-=m,u+=m,o.length-=m),o.length))break t;o.length=0,o.mode=X;case X:if(2048&o.flags){if(0===l)break t;m=0;do{yt=r[u+m++],o.head&&yt&&o.length<65536&&(o.head.name+=String.fromCharCode(yt))}while(yt&&m<l);if(512&o.flags&&4&o.wrap&&(o.check=i(o.check,r,m,u)),l-=m,u+=m,yt)break t}else o.head&&(o.head.name=null);o.length=0,o.mode=U;case U:if(4096&o.flags){if(0===l)break t;m=0;do{yt=r[u+m++],o.head&&yt&&o.length<65536&&(o.head.comment+=String.fromCharCode(yt))}while(yt&&m<l);if(512&o.flags&&4&o.wrap&&(o.check=i(o.check,r,m,u)),l-=m,u+=m,yt)break t}else o.head&&(o.head.comment=null);o.mode=k;case k:if(512&o.flags){for(;p<16;){if(0===l)break t;l--,d+=r[u++]<<p,p+=8}if(4&o.wrap&&d!==(65535&o.check)){t.msg="header crc mismatch",o.mode=ut;break}d=0,p=0}o.head&&(o.head.hcrc=o.flags>>9&1,o.head.done=!0),t.adler=o.check=0,o.mode=G;break;case z:for(;p<32;){if(0===l)break t;l--,d+=r[u++]<<p,p+=8}t.adler=o.check=ft(d),d=0,p=0,o.mode=j;case j:if(0===o.havedict)return t.next_out=c,t.avail_out=h,t.next_in=u,t.avail_in=l,o.hold=d,o.bits=p,O;t.adler=o.check=1,o.mode=G;case G:if(n===b||n===v)break t;case H:if(o.last){d>>>=7&p,p-=7&p,o.mode=rt;break}for(;p<3;){if(0===l)break t;l--,d+=r[u++]<<p,p+=8}switch(o.last=1&d,d>>>=1,p-=1,3&d){case 0:o.mode=q;break;case 1:if(vt(o),o.mode=Q,n===v){d>>>=2,p-=2;break t}break;case 2:o.mode=K;break;case 3:t.msg="invalid block type",o.mode=ut}d>>>=2,p-=2;break;case q:for(d>>>=7&p,p-=7&p;p<32;){if(0===l)break t;l--,d+=r[u++]<<p,p+=8}if((65535&d)!=(d>>>16^65535)){t.msg="invalid stored block lengths",o.mode=ut;break}if(o.length=65535&d,d=0,p=0,o.mode=Y,n===v)break t;case Y:o.mode=W;case W:if(m=o.length,m){if(m>l&&(m=l),m>h&&(m=h),0===m)break t;a.set(r.subarray(u,u+m),c),l-=m,u+=m,h-=m,c+=m,o.length-=m;break}o.mode=G;break;case K:for(;p<14;){if(0===l)break t;l--,d+=r[u++]<<p,p+=8}if(o.nlen=257+(31&d),d>>>=5,p-=5,o.ndist=1+(31&d),d>>>=5,p-=5,o.ncode=4+(15&d),d>>>=4,p-=4,o.nlen>286||o.ndist>30){t.msg="too many length or distance symbols",o.mode=ut;break}o.have=0,o.mode=J;case J:for(;o.have<o.ncode;){for(;p<3;){if(0===l)break t;l--,d+=r[u++]<<p,p+=8}o.lens[Ot[o.have++]]=7&d,d>>>=3,p-=3}for(;o.have<19;)o.lens[Ot[o.have++]]=0;if(o.lencode=o.lendyn,o.lenbits=7,bt={bits:o.lenbits},wt=_(y,o.lens,0,19,o.lencode,0,o.work,bt),o.lenbits=bt.bits,wt){t.msg="invalid code lengths set",o.mode=ut;break}o.have=0,o.mode=Z;case Z:for(;o.have<o.nlen+o.ndist;){for(;St=o.lencode[d&(1<<o.lenbits)-1],ht=St>>>24,dt=St>>>16&255,pt=65535&St,!(ht<=p);){if(0===l)break t;l--,d+=r[u++]<<p,p+=8}if(pt<16)d>>>=ht,p-=ht,o.lens[o.have++]=pt;else{if(16===pt){for(Et=ht+2;p<Et;){if(0===l)break t;l--,d+=r[u++]<<p,p+=8}if(d>>>=ht,p-=ht,0===o.have){t.msg="invalid bit length repeat",o.mode=ut;break}yt=o.lens[o.have-1],m=3+(3&d),d>>>=2,p-=2}else if(17===pt){for(Et=ht+3;p<Et;){if(0===l)break t;l--,d+=r[u++]<<p,p+=8}d>>>=ht,p-=ht,yt=0,m=3+(7&d),d>>>=3,p-=3}else{for(Et=ht+7;p<Et;){if(0===l)break t;l--,d+=r[u++]<<p,p+=8}d>>>=ht,p-=ht,yt=0,m=11+(127&d),d>>>=7,p-=7}if(o.have+m>o.nlen+o.ndist){t.msg="invalid bit length repeat",o.mode=ut;break}for(;m--;)o.lens[o.have++]=yt}}if(o.mode===ut)break;if(0===o.lens[256]){t.msg="invalid code -- missing end-of-block",o.mode=ut;break}if(o.lenbits=9,bt={bits:o.lenbits},wt=_(w,o.lens,0,o.nlen,o.lencode,0,o.work,bt),o.lenbits=bt.bits,wt){t.msg="invalid literal/lengths set",o.mode=ut;break}if(o.distbits=6,o.distcode=o.distdyn,bt={bits:o.distbits},wt=_(S,o.lens,o.nlen,o.ndist,o.distcode,0,o.work,bt),o.distbits=bt.bits,wt){t.msg="invalid distances set",o.mode=ut;break}if(o.mode=Q,n===v)break t;case Q:o.mode=$;case $:if(l>=6&&h>=258){t.next_out=c,t.avail_out=h,t.next_in=u,t.avail_in=l,o.hold=d,o.bits=p,s(t,g),c=t.next_out,a=t.output,h=t.avail_out,u=t.next_in,r=t.input,l=t.avail_in,d=o.hold,p=o.bits,o.mode===G&&(o.back=-1);break}for(o.back=0;St=o.lencode[d&(1<<o.lenbits)-1],ht=St>>>24,dt=St>>>16&255,pt=65535&St,!(ht<=p);){if(0===l)break t;l--,d+=r[u++]<<p,p+=8}if(dt&&0==(240&dt)){for(gt=ht,_t=dt,xt=pt;St=o.lencode[xt+((d&(1<<gt+_t)-1)>>gt)],ht=St>>>24,dt=St>>>16&255,pt=65535&St,!(gt+ht<=p);){if(0===l)break t;l--,d+=r[u++]<<p,p+=8}d>>>=gt,p-=gt,o.back+=gt}if(d>>>=ht,p-=ht,o.back+=ht,o.length=pt,0===dt){o.mode=ot;break}if(32&dt){o.back=-1,o.mode=G;break}if(64&dt){t.msg="invalid literal/length code",o.mode=ut;break}o.extra=15&dt,o.mode=tt;case tt:if(o.extra){for(Et=o.extra;p<Et;){if(0===l)break t;l--,d+=r[u++]<<p,p+=8}o.length+=d&(1<<o.extra)-1,d>>>=o.extra,p-=o.extra,o.back+=o.extra}o.was=o.length,o.mode=et;case et:for(;St=o.distcode[d&(1<<o.distbits)-1],ht=St>>>24,dt=St>>>16&255,pt=65535&St,!(ht<=p);){if(0===l)break t;l--,d+=r[u++]<<p,p+=8}if(0==(240&dt)){for(gt=ht,_t=dt,xt=pt;St=o.distcode[xt+((d&(1<<gt+_t)-1)>>gt)],ht=St>>>24,dt=St>>>16&255,pt=65535&St,!(gt+ht<=p);){if(0===l)break t;l--,d+=r[u++]<<p,p+=8}d>>>=gt,p-=gt,o.back+=gt}if(d>>>=ht,p-=ht,o.back+=ht,64&dt){t.msg="invalid distance code",o.mode=ut;break}o.offset=pt,o.extra=15&dt,o.mode=nt;case nt:if(o.extra){for(Et=o.extra;p<Et;){if(0===l)break t;l--,d+=r[u++]<<p,p+=8}o.offset+=d&(1<<o.extra)-1,d>>>=o.extra,p-=o.extra,o.back+=o.extra}if(o.offset>o.dmax){t.msg="invalid distance too far back",o.mode=ut;break}o.mode=it;case it:if(0===h)break t;if(m=g-h,o.offset>m){if(m=o.offset-m,m>o.whave&&o.sane){t.msg="invalid distance too far back",o.mode=ut;break}m>o.wnext?(m-=o.wnext,x=o.wsize-m):x=o.wnext-m,m>o.length&&(m=o.length),lt=o.window}else lt=a,x=c-o.offset,m=o.length;m>h&&(m=h),h-=m,o.length-=m;do{a[c++]=lt[x++]}while(--m);0===o.length&&(o.mode=$);break;case ot:if(0===h)break t;a[c++]=o.length,h--,o.mode=$;break;case rt:if(o.wrap){for(;p<32;){if(0===l)break t;l--,d|=r[u++]<<p,p+=8}if(g-=h,t.total_out+=g,o.total+=g,4&o.wrap&&g&&(t.adler=o.check=o.flags?i(o.check,a,g,c-g):e(o.check,a,g,c-g)),g=h,4&o.wrap&&(o.flags?d:ft(d))!==o.check){t.msg="incorrect data check",o.mode=ut;break}d=0,p=0}o.mode=st;case st:if(o.wrap&&o.flags){for(;p<32;){if(0===l)break t;l--,d+=r[u++]<<p,p+=8}if(4&o.wrap&&d!==(4294967295&o.total)){t.msg="incorrect length check",o.mode=ut;break}d=0,p=0}o.mode=at;case at:wt=E;break t;case ut:wt=F;break t;case ct:return I;default:return N}return t.next_out=c,t.avail_out=h,t.next_in=u,t.avail_in=l,o.hold=d,o.bits=p,(o.wsize||g!==t.avail_out&&o.mode<ut&&(o.mode<rt||n!==T))&&Ct(t,t.output,t.next_out,g-t.avail_out),f-=t.avail_in,g-=t.avail_out,t.total_in+=f,t.total_out+=g,o.total+=g,4&o.wrap&&g&&(t.adler=o.check=o.flags?i(o.check,a,g,t.next_out-g):e(o.check,a,g,t.next_out-g)),t.data_type=o.bits+(o.last?64:0)+(o.mode===G?128:0)+(o.mode===Q||o.mode===Y?256:0),(0===f&&0===g||n===T)&&wt===C&&(wt=M),wt},inflateEnd:t=>{if(mt(t))return N;let e=t.state;return e.window&&(e.window=null),t.state=null,C},inflateGetHeader:(t,e)=>{if(mt(t))return N;const n=t.state;return 0==(2&n.wrap)?N:(n.head=e,e.done=!1,C)},inflateSetDictionary:(t,n)=>{const i=n.length;let o,r,s;return mt(t)?N:(o=t.state,0!==o.wrap&&o.mode!==j?N:o.mode===j&&(r=1,r=e(r,n,i,0),r!==o.check)?F:(s=Ct(t,n,i,i),s?(o.mode=ct,I):(o.havedict=1,C)))},inflateInfo:"pako inflate (from Nodeca project)"};const Ot=(t,e)=>Object.prototype.hasOwnProperty.call(t,e);var Nt=function(t){const e=Array.prototype.slice.call(arguments,1);for(;e.length;){const n=e.shift();if(n){if("object"!=typeof n)throw new TypeError(n+"must be non-object");for(const e in n)Ot(n,e)&&(t[e]=n[e])}}return t},Ft={assign:Nt,flattenChunks:t=>{let e=0;for(let n=0,i=t.length;n<i;n++)e+=t[n].length;const n=new Uint8Array(e);for(let e=0,i=0,o=t.length;e<o;e++){let o=t[e];n.set(o,i),i+=o.length}return n}};let It=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(t){It=!1}const Mt=new Uint8Array(256);for(let t=0;t<256;t++)Mt[t]=t>=252?6:t>=248?5:t>=240?4:t>=224?3:t>=192?2:1;Mt[254]=Mt[254]=1;const Dt=(t,e)=>{if(e<65534&&t.subarray&&It)return String.fromCharCode.apply(null,t.length===e?t:t.subarray(0,e));let n="";for(let i=0;i<e;i++)n+=String.fromCharCode(t[i]);return n};var Vt={string2buf:t=>{if("function"==typeof TextEncoder&&TextEncoder.prototype.encode)return(new TextEncoder).encode(t);let e,n,i,o,r,s=t.length,a=0;for(o=0;o<s;o++)n=t.charCodeAt(o),55296==(64512&n)&&o+1<s&&(i=t.charCodeAt(o+1),56320==(64512&i)&&(n=65536+(n-55296<<10)+(i-56320),o++)),a+=n<128?1:n<2048?2:n<65536?3:4;for(e=new Uint8Array(a),r=0,o=0;r<a;o++)n=t.charCodeAt(o),55296==(64512&n)&&o+1<s&&(i=t.charCodeAt(o+1),56320==(64512&i)&&(n=65536+(n-55296<<10)+(i-56320),o++)),n<128?e[r++]=n:n<2048?(e[r++]=192|n>>>6,e[r++]=128|63&n):n<65536?(e[r++]=224|n>>>12,e[r++]=128|n>>>6&63,e[r++]=128|63&n):(e[r++]=240|n>>>18,e[r++]=128|n>>>12&63,e[r++]=128|n>>>6&63,e[r++]=128|63&n);return e},buf2string:(t,e)=>{const n=e||t.length;if("function"==typeof TextDecoder&&TextDecoder.prototype.decode)return(new TextDecoder).decode(t.subarray(0,e));let i,o;const r=new Array(2*n);for(o=0,i=0;i<n;){let e=t[i++];if(e<128){r[o++]=e;continue}let s=Mt[e];if(s>4)r[o++]=65533,i+=s-1;else{for(e&=2===s?31:3===s?15:7;s>1&&i<n;)e=e<<6|63&t[i++],s--;s>1?r[o++]=65533:e<65536?r[o++]=e:(e-=65536,r[o++]=55296|e>>10&1023,r[o++]=56320|1023&e)}}return Dt(r,o)},utf8border:(t,e)=>{(e=e||t.length)>t.length&&(e=t.length);let n=e-1;for(;n>=0&&128==(192&t[n]);)n--;return n<0||0===n?e:n+Mt[t[n]]>e?n:e}},Rt={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"};function Pt(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}var At=Pt;function Lt(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}var Bt=Lt;const Xt=Object.prototype.toString,{Z_NO_FLUSH:Ut,Z_FINISH:kt,Z_OK:zt,Z_STREAM_END:jt,Z_NEED_DICT:Gt,Z_STREAM_ERROR:Ht,Z_DATA_ERROR:qt,Z_MEM_ERROR:Yt}=x;function Wt(t){this.options=Ft.assign({chunkSize:65536,windowBits:15,to:""},t||{});const e=this.options;e.raw&&e.windowBits>=0&&e.windowBits<16&&(e.windowBits=-e.windowBits,0===e.windowBits&&(e.windowBits=-15)),!(e.windowBits>=0&&e.windowBits<16)||t&&t.windowBits||(e.windowBits+=32),e.windowBits>15&&e.windowBits<48&&0==(15&e.windowBits)&&(e.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new At,this.strm.avail_out=0;let n=Et.inflateInit2(this.strm,e.windowBits);if(n!==zt)throw new Error(Rt[n]);if(this.header=new Bt,Et.inflateGetHeader(this.strm,this.header),e.dictionary&&("string"==typeof e.dictionary?e.dictionary=Vt.string2buf(e.dictionary):"[object ArrayBuffer]"===Xt.call(e.dictionary)&&(e.dictionary=new Uint8Array(e.dictionary)),e.raw&&(n=Et.inflateSetDictionary(this.strm,e.dictionary),n!==zt)))throw new Error(Rt[n])}function Kt(t,e){const n=new Wt(e);if(n.push(t),n.err)throw n.msg||Rt[n.err];return n.result}function Jt(t,e){return(e=e||{}).raw=!0,Kt(t,e)}Wt.prototype.push=function(t,e){const n=this.strm,i=this.options.chunkSize,o=this.options.dictionary;let r,s,a;if(this.ended)return!1;for(s=e===~~e?e:!0===e?kt:Ut,"[object ArrayBuffer]"===Xt.call(t)?n.input=new Uint8Array(t):n.input=t,n.next_in=0,n.avail_in=n.input.length;;){for(0===n.avail_out&&(n.output=new Uint8Array(i),n.next_out=0,n.avail_out=i),r=Et.inflate(n,s),r===Gt&&o&&(r=Et.inflateSetDictionary(n,o),r===zt?r=Et.inflate(n,s):r===qt&&(r=Gt));n.avail_in>0&&r===jt&&n.state.wrap>0&&0!==t[n.next_in];)Et.inflateReset(n),r=Et.inflate(n,s);switch(r){case Ht:case qt:case Gt:case Yt:return this.onEnd(r),this.ended=!0,!1}if(a=n.avail_out,n.next_out&&(0===n.avail_out||r===jt))if("string"===this.options.to){let t=Vt.utf8border(n.output,n.next_out),e=n.next_out-t,o=Vt.buf2string(n.output,t);n.next_out=e,n.avail_out=i-e,e&&n.output.set(n.output.subarray(t,t+e),0),this.onData(o)}else this.onData(n.output.length===n.next_out?n.output:n.output.subarray(0,n.next_out));if(r!==zt||0!==a){if(r===jt)return r=Et.inflateEnd(this.strm),this.onEnd(r),this.ended=!0,!0;if(0===n.avail_in)break}}return!0},Wt.prototype.onData=function(t){this.chunks.push(t)},Wt.prototype.onEnd=function(t){t===zt&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=Ft.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg};var Zt=Wt,Qt=Kt,$t=Jt,te=Kt,ee=x,ne={Inflate:Zt,inflate:Qt,inflateRaw:$t,ungzip:te,constants:ee};t.Inflate=Zt,t.constants=ee,t.default=ne,t.inflate=Qt,t.inflateRaw=$t,t.ungzip=te,Object.defineProperty(t,"__esModule",{value:!0})}(e)}},n={};function i(e){var o=n[e];if(void 0!==o)return o.exports;var r=n[e]={exports:{}};return t[e].call(r.exports,r,r.exports,i),r.exports}i.d=(t,e)=>{for(var n in e)i.o(e,n)&&!i.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})},i.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),i.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e);var o={};return(()=>{"use strict";i.d(o,{default:()=>VF});const t=new Map;t.set("x_ite/Namespace",t);const n=t;let r=0,s=0,a=0;const u={CONNECTION_ERROR:r++,BROWSER_EVENT:r++,INITIALIZED_EVENT:r++,SHUTDOWN_EVENT:r++,INITIALIZED_ERROR:r++,NOT_STARTED_STATE:s++,IN_PROGRESS_STATE:s++,COMPLETE_STATE:s++,FAILED_STATE:s++,initializeOnly:1,inputOnly:2,outputOnly:4,inputOutput:7,SFBool:a++,SFColor:a++,SFColorRGBA:a++,SFDouble:a++,SFFloat:a++,SFImage:a++,SFInt32:a++,SFMatrix3d:a++,SFMatrix3f:a++,SFMatrix4d:a++,SFMatrix4f:a++,SFNode:a++,SFRotation:a++,SFString:a++,SFTime:a++,SFVec2d:a++,SFVec2f:a++,SFVec3d:a++,SFVec3f:a++,SFVec4d:a++,SFVec4f:a++,VrmlMatrix:a++,MFBool:a++,MFColor:a++,MFColorRGBA:a++,MFDouble:a++,MFFloat:a++,MFImage:a++,MFInt32:a++,MFMatrix3d:a++,MFMatrix3f:a++,MFMatrix4d:a++,MFMatrix4f:a++,MFNode:a++,MFRotation:a++,MFString:a++,MFTime:a++,MFVec2d:a++,MFVec2f:a++,MFVec3d:a++,MFVec3f:a++,MFVec4d:a++,MFVec4f:a++,X3DBaseNode:0};n.set("x_ite/Base/X3DConstants",u);const c=u;function l({style:t="TIDY",precision:e=7,doublePrecision:n=15}){this.Style(t),this.string="",this.indent="",this.listIndent="",this.precision=e,this.doublePrecision=n,this.removeTrailingZeros=/(?:\.|(\.[0-9]*?))0*(?=[eE]|$)/,this.executionContextStack=[null],this.importedNodesIndex=new Map,this.exportedNodesIndex=new Map,this.nodes=new Set,this.names=new Map,this.namesByNode=new Map,this.importedNames=new Map,this.routeNodes=new Set,this.level=0,this.newName=0,this.containerFields=[],this.units=!0,this.unitCategories=[],this.names.set(null,new Map)}l.prototype={constructor:l,Style:function(t){switch(t){case"CLEAN":this.comma=" ",this.break=" ",this.tidyBreak="",this.tidySpace="",this.indentChar="",this.listEnclosure="",this.listBreak="",this.listIndentChar="",this.attribBreak=" ";break;case"SMALL":this.comma=",",this.break="\n",this.tidyBreak="\n",this.tidySpace="",this.indentChar="",this.listEnclosure="",this.listBreak="",this.listIndentChar="",this.attribBreak=" ";break;case"COMPACT":this.comma=",",this.break="\n",this.tidyBreak="\n",this.tidySpace=" ",this.indentChar="  ",this.listEnclosure=" ",this.listBreak=" ",this.listIndentChar="",this.attribBreak=" ";break;default:this.comma=",",this.break="\n",this.tidyBreak="\n",this.tidySpace=" ",this.indentChar="  ",this.listEnclosure="\n",this.listBreak="\n",this.listIndentChar="  ",this.attribBreak="\n"}},Comma:function(){return this.comma},Break:function(){return this.break},TidyBreak:function(){return this.tidyBreak},ForceBreak:function(){return"\n"},Space:function(){return" "},TidySpace:function(){return this.tidySpace},ListStart:function(){return this.listEnclosure},ListEnd:function(){return this.listEnclosure},ListBreak:function(){return this.listBreak},AttribBreak:function(){return this.attribBreak},Indent:function(){return this.indent},ListIndent:function(){return this.listIndent},IncIndent:function(){return this.indent+=this.indentChar,this.listIndent+=this.listIndentChar,""},DecIndent:function(){return this.indent=this.indent.slice(0,this.indent.length-this.indentChar.length),this.listIndent=this.listIndent.slice(0,this.listIndent.length-this.listIndentChar.length),""},PadRight:function(t,e){for(let n=0,i=e-t.length;n<i;++n)t+=" ";return t},Precision:function(t){return Math.fround(t).toPrecision(this.precision).replace(this.removeTrailingZeros,"$1")},DoublePrecision:function(t){return t.toPrecision(this.doublePrecision).replace(this.removeTrailingZeros,"$1")},PushExecutionContext:function(t){this.executionContextStack.push(t),this.names.has(t)||this.names.set(t,new Map),this.importedNodesIndex.has(t)||this.importedNodesIndex.set(t,new Set),this.exportedNodesIndex.has(t)||this.exportedNodesIndex.set(t,new Set)},PopExecutionContext:function(){this.executionContextStack.pop(),this.ExecutionContext()||(this.importedNodesIndex.clear(),this.exportedNodesIndex.clear())},ExecutionContext:function(){return this.executionContextStack.at(-1)},EnterScope:function(){0===this.level&&(this.newName=0),++this.level},LeaveScope:function(){--this.level,0===this.level&&(this.nodes.clear(),this.namesByNode.clear(),this.importedNames.clear())},ExportedNodes:function(t){const e=this.exportedNodesIndex.get(this.ExecutionContext());t.forEach((function(t){try{e.add(t.getLocalNode())}catch(t){}}))},ImportedNodes:function(t){const e=this.importedNodesIndex.get(this.ExecutionContext());t.forEach((function(t){try{e.add(t.getInlineNode())}catch(t){}}))},AddImportedNode:function(t,e){this.importedNames.set(t,e)},AddRouteNode:function(t){this.routeNodes.add(t)},ExistsRouteNode:function(t){return this.routeNodes.has(t)},IsSharedNode:function(t){return this.ExecutionContext()!==t.getExecutionContext()},AddNode:function(t){this.nodes.add(t),this.AddRouteNode(t)},ExistsNode:function(t){return this.nodes.has(t)},Name:function(){const t=/_\d+$/;return function(e){const n=this.namesByNode.get(e);if(void 0!==n)return n;{const n=this.names.get(this.ExecutionContext());if(0===e.getName().length){if(this.NeedsName(e)){const t=this.UniqueName();return n.set(t,e),this.namesByNode.set(e,t),t}return e.getName()}let i=e.getName();const o=null!==i.match(t);if(i=i.replace(t,""),0===i.length){if(!this.NeedsName(e))return"";i=this.UniqueName()}else{let t=0,e=o?i+"_"+ ++t:i;for(;n.has(e);)e=i+"_"+ ++t;i=e}return n.set(i,e),this.namesByNode.set(e,i),i}}}(),NeedsName:function(t){if(t.getCloneCount()>1)return!0;if(t.hasRoutes())return!0;const e=t.getExecutionContext(),n=this.importedNodesIndex.get(e);if(!n){const n=this.exportedNodesIndex.get(e);return!(!n||!n.has(t))}return!!n.has(t)||void 0},UniqueName:function(){const t=this.names.get(this.ExecutionContext());for(;;){const e="_"+ ++this.newName;if(!t.has(e))return e}},LocalName:function(t){const e=this.importedNames.get(t);if(void 0!==e)return e;if(this.ExistsNode(t))return this.Name(t);throw new Error("Couldn't get local name for node '"+t.getTypeName()+"'.")},PushContainerField:function(t){this.containerFields.push(t)},PopContainerField:function(){this.containerFields.pop()},ContainerField:function(){return this.containerFields.length?this.containerFields[this.containerFields.length-1]:null},AccessType:function(t){switch(t){case c.initializeOnly:return"initializeOnly";case c.inputOnly:return"inputOnly";case c.outputOnly:return"outputOnly";case c.inputOutput:return"inputOutput"}},SetUnits:function(t){this.units=t},GetUnits:function(){return this.units},PushUnitCategory:function(t){this.unitCategories.push(t)},PopUnitCategory:function(){this.unitCategories.pop()},Unit:function(t){return 0==this.unitCategories.length?t:this.unitCategories.at(-1)},ToUnit:function(t,e){if(this.units){const n=this.ExecutionContext();if(n)return n.toUnit(t,e)}return e},XMLEncode:function(t){return t.replace(/&/g,"&amp;").replace(/\\/g,"&#92;").replace(/\t/g,"&#x9;").replace(/\n/g,"&#xA;").replace(/\r/g,"&#xD;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/'/g,"&apos;").replace(/"/g,'\\"')},escapeCDATA:function(t){return t.replace(/\]\]\>/g,"\\]\\]\\>")},JSONEncode:function(t){let e='"';for(const n of t)switch(n){case"\r":e+="\\r";break;case"\n":e+="\\n";break;case"\t":e+="\\t";break;case'"':e+='\\"';break;case"\\":e+="\\\\";break;default:e+=n}return e+='"',e},JSONNumber:function(t){switch(t){case"NaN":case"Infinity":case"-Infinity":return'"'+t+'"';default:return t}}};for(const t of Reflect.ownKeys(l.prototype))Object.defineProperty(l.prototype,t,{enumerable:!1});const h=l;n.set("x_ite/InputOutput/Generator",h);const d=h,p={assign:function(){function t(t,e){this.set(e,t)}return function(e,n){return e.clear(),n.forEach(t,e),e}}(),values:function(){function t(t){this.push(t)}return function(e,n){return e.length=0,n.forEach(t,e),e}}()},f=p;n.set("standard/Utility/MapUtilities",f);const g=f,m=Symbol(),_=Symbol(),x=Symbol();function y(){}y.prototype={constructor:y,[m]:"",[_]:new Map,[x]:[],getId:function(){return y.getId(this)},getTypeName:function(){return"X3DObject"},setName:function(t){this[m]=t},getName:function(){return this[m]},getDisplayName:function(){return this[m]},getInterestId:function(t,e){return y.getId(e)+"."+String(t)},hasInterest:function(t,e){return this[_].has(this.getInterestId(t,e))},addInterest:function(t,e){this[_]===y.prototype[_]&&(this[_]=new Map,this[x]=[]);const n=this.getInterestId(t,e),i=e[t];if(arguments.length>2){const t=Array.prototype.slice.call(arguments,2);t.unshift(e),t.push(this),this[_].set(n,Function.prototype.bind.apply(i,t))}else this[_].set(n,i.bind(e,this))},removeInterest:function(t,e){this[_].delete(this.getInterestId(t,e))},getInterests:function(){return this[_]},processInterests:function(){if(this[_].size)for(const t of g.values(this[x],this[_]))t()},toString:function(t=Object.prototype){const e=new d(t);return t.scene&&e.PushExecutionContext(t.scene),this.toStream(e),e.string},toVRMLString:function(t=Object.prototype){const e=new d(t);return t.scene&&e.PushExecutionContext(t.scene),this.toVRMLStream(e),e.string},toXMLString:function(t=Object.prototype){const e=new d(t);return t.scene&&e.PushExecutionContext(t.scene),this.toXMLStream(e),e.string},toJSONString:function(t=Object.prototype){const e=new d(t);return t.scene&&e.PushExecutionContext(t.scene),this.toJSONStream(e),e.string},toStream:function(t){t.string="[object "+this.getTypeName()+"]"},dispose:function(){}};for(const t of Reflect.ownKeys(y.prototype))Object.defineProperty(y.prototype,t,{enumerable:!1});y.getId=function(){const t=new WeakMap;let e=0;return function(n){const i=t.get(n);return void 0!==i?i:(t.set(n,++e),e)}}();const w=y;n.set("x_ite/Base/X3DObject",w);const S=w,T=Symbol(),b=Symbol(),v=Symbol();function C(){S.call(this)}C.prototype=Object.assign(Object.create(S.prototype),{constructor:C,[T]:0,[b]:!1,[v]:new Set,setModificationTime:function(t){this[T]=t},getModificationTime:function(){return this[T]},setTainted:function(t){this[b]=t},isTainted:function(){return this[b]},addEvent:function(){this.setModificationTime(Date.now());for(const t of this[v])t.addEvent(this)},addEventObject:function(t,e){this.setModificationTime(Date.now());for(const t of this[v])t.addEventObject(this,e)},addParent:function(t){this[v]===C.prototype[v]&&(this[v]=new Set),this[v].add(t)},removeParent:function(t){this[v].delete(t)},getParents:function(){return this[v]},dispose:function(){this[v].clear(),S.prototype.dispose.call(this)}});for(const t of Reflect.ownKeys(C.prototype))Object.defineProperty(C.prototype,t,{enumerable:!1});const E=C;n.set("x_ite/Base/X3DChildObject",E);const O=E,N=Symbol();function F(){this[N]=[]}F.prototype={create:function(t){if(this[N].length){const e=this[N].pop();return e.field=t,e.clear(),e}const e=new Set;return e.field=t,e},copy:function(t){if(this[N].length){const e=this[N].pop();e.field=t.field,e.clear();for(const n of t)e.add(n);return e}const e=new Set(t);return e.field=t.field,e},push:function(t){this[N].push(t)},clear:function(){this[N].length=0}};for(const t of Reflect.ownKeys(F.prototype))Object.defineProperty(F.prototype,t,{enumerable:!1});const I=new F;n.set("x_ite/Base/Events",I);const M=I,D=Symbol.for("X3DEventObject.browser");function V(t){O.call(this),this[D]=t}V.prototype=Object.assign(Object.create(O.prototype),{constructor:V,getBrowser:function(){return this[D]},getExtendedEventHandling:function(){return!0},addEvent:function(t){t.isTainted()||(t.setTainted(!0),this.addEventObject(t,M.create(t)))},addEventObject:function(t,e){const n=this.getBrowser();n.addBrowserEvent(),n.addTaintedField(t,e),this.isTainted()||(t.isInput()||this.getExtendedEventHandling()&&!t.isOutput())&&this.addNodeEvent()},addNodeEvent:function(){if(this.isTainted())return;const t=this.getBrowser();this.setTainted(!0),t.addTaintedNode(this),t.addBrowserEvent()},processEvents:function(){this.setTainted(!1),this.processInterests()}});for(const t of Reflect.ownKeys(V.prototype))Object.defineProperty(V.prototype,t,{enumerable:!1});const R=V;n.set("x_ite/Base/X3DEventObject",R);const P=R;function A(t,e,n){this.accessType=t,this.dataType=n.getType(),this.name=e,this.value=n}A.prototype=Object.assign(Object.create(S.prototype),{constructor:A,getTypeName:function(){return"X3DFieldDefinition"}});for(const t of Reflect.ownKeys(A.prototype))Object.defineProperty(A.prototype,t,{enumerable:!1});const L=A;n.set("x_ite/Base/X3DFieldDefinition",L);const B=L,X=Symbol(),U=Symbol(),k={get:function(t,e){const n=t[e];if(void 0!==n)return n;if("string"==typeof e){const n=+e;return Number.isInteger(n)?t[X][n]:void 0}},set:function(t,e,n){return void 0!==t[e]&&(t[e]=n,!0)},has:function(t,e){return Number.isInteger(+e)?e<t[X].length:e in t},ownKeys:function(t){return Object.keys(t[X])},getOwnPropertyDescriptor:function(t,e){if("string"!=typeof e)return;const n=+e;if(Number.isInteger(n)&&n<t[X].length){const n=Object.getOwnPropertyDescriptor(t[X],e);return n&&(n.writable=!1),n}}};function z(t){if(this[X]=[],this[U]=new Map,this[Symbol.iterator]=this[X][Symbol.iterator],t)for(const e of t)this.add(e.name,e);return new Proxy(this,k)}z.prototype={constructor:z,equals:function(t){const e=this[X],n=t[X]||t,i=e.length;if(e===n)return!0;if(i!==n.length)return!1;for(let t=0;t<i;++t)if(e[t]!==n[t])return!1;return!0},has:function(t){return this[U].has(t)},get:function(t){return this[U].get(t)},add:function(t,e){this[X].push(e),this[U].set(t,e)},addAlias:function(t,e){this[U].set(t,this[U].get(e))},update:function(t,e,n){const i=this[U].get(t);if(t!==e&&this.remove(e),this[U].delete(t),this[U].set(e,n),void 0!==i){const t=this[X].indexOf(i);t>-1&&(this[X][t]=n)}else this[X].push(n)},remove:function(t){const e=this[U].get(t);if(void 0===e)return;const n=this[X].indexOf(e);this[U].delete(t),n>-1&&this[X].splice(n,1)},at:Array.prototype.at,concat:Array.prototype.concat,entries:Array.prototype.entries,every:Array.prototype.every,fill:Array.prototype.fill,filter:Array.prototype.filter,find:Array.prototype.find,findIndex:Array.prototype.findIndex,findLast:Array.prototype.findLast,findLastIndex:Array.prototype.findLastIndex,flat:Array.prototype.flat,flatMap:Array.prototype.flatMap,forEach:Array.prototype.forEach,includes:Array.prototype.includes,indexOf:Array.prototype.indexOf,join:Array.prototype.join,keys:Array.prototype.keys,lastIndexOf:Array.prototype.lastIndexOf,map:Array.prototype.map,reduce:Array.prototype.reduce,reduceRight:Array.prototype.reduceRight,slice:Array.prototype.slice,some:Array.prototype.some,values:Array.prototype.values,toString:function(t=Object.prototype){const e=new d(t);return t.scene&&e.PushExecutionContext(t.scene),this.toStream(e),e.string},toStream:function(t){t.string="[object "+this.getTypeName()+"]"},toVRMLStream:function(t){for(const e of this[X])try{e.toVRMLStream(t),t.string+=t.Break(),this.getTypeName().match(/Proto/)&&(t.string+=t.TidyBreak())}catch(t){}},toXMLStream:function(t){for(const e of this[X])try{e.toXMLStream(t),t.string+=t.TidyBreak()}catch(t){}},toJSONStream:function(t,e){let n=!1;for(const e of this[X])try{e.toJSONStream(t,!0),t.string+=",",t.string+=t.TidyBreak(),n=!0}catch(t){}return n&&!e&&(t.string=t.string.replace(/,(\s*)$/s,"$1")),n}};for(const t of Reflect.ownKeys(z.prototype))Object.defineProperty(z.prototype,t,{enumerable:!1});Object.defineProperty(z.prototype,"length",{get:function(){return this[X].length},enumerable:!1,configurable:!1});const j=z;n.set("x_ite/Base/X3DInfoArray",j);const G=j;function H(t){return G.call(this,t)}H.prototype=Object.assign(Object.create(G.prototype),{constructor:H,getTypeName:function(){return"FieldDefinitionArray"}});for(const t of Reflect.ownKeys(H.prototype))Object.defineProperty(H.prototype,t,{enumerable:!1});const q=H;n.set("x_ite/Base/FieldDefinitionArray",q);const Y=q;function W(){return G.call(this)}W.prototype=Object.assign(Object.create(G.prototype),{constructor:W,getTypeName:function(){return"FieldArray"}});for(const t of Reflect.ownKeys(W.prototype))Object.defineProperty(W.prototype,t,{enumerable:!1});const K=W;n.set("x_ite/Base/FieldArray",K);const J=K,Z=Symbol(),Q=Symbol(),$=Symbol(),tt=Symbol(),et=Symbol(),nt=Symbol(),it=Symbol(),ot=Symbol(),rt=Symbol(),st=Symbol(),at=Symbol.for("X3DField.uniformLocation");function ut(t){return O.call(this),this[Z]=t,this}ut.prototype=Object.assign(Object.create(O.prototype),{constructor:ut,[Z]:null,[Q]:c.initializeOnly,[$]:null,[at]:null,[tt]:new Set,[et]:new Map,[nt]:new Set,[it]:new Map,[ot]:new Set,[rt]:new Set,[st]:new Map,create:function(){return new this.constructor},equals:function(t){return this[Z]===t.valueOf()},assign:function(t){this.set(t.getValue()),this.addEvent()},set:function(t){this[Z]=t},setValue:function(t){this.set(t instanceof this.constructor?t.getValue():t),this.addEvent()},getValue:function(){return this[Z]},setAccessType:function(t){this[Q]=t},getAccessType:function(){return this[Q]},isInitializable:function(){return this[Q]&c.initializeOnly},isInput:function(){return this[Q]&c.inputOnly},isOutput:function(){return this[Q]&c.outputOnly},isReadable:function(){return this[Q]!==c.inputOnly},isWritable:function(){return this[Q]!==c.initializeOnly},setUnit:function(t){this[$]=t},getUnit:function(){return this[$]},hasReferences:function(){return 0!==this[tt].size},isReference:function(t){return t===this[Q]||t===c.inputOutput},addReference:function(t){const e=this.getReferences();if(!e.has(t)){switch(e.add(t),this.getAccessType()&t.getAccessType()){case c.initializeOnly:t.addFieldInterest(this),this.assign(t);break;case c.inputOnly:t.addFieldInterest(this);break;case c.outputOnly:this.addFieldInterest(t);break;case c.inputOutput:t.addFieldInterest(this),this.addFieldInterest(t),this.assign(t)}this.processReferencesCallbacks()}},removeReference:function(t){switch(this.getReferences().delete(t),this.getAccessType()&t.getAccessType()){case c.initializeOnly:case c.inputOnly:t.removeFieldInterest(this);break;case c.outputOnly:this.removeFieldInterest(t);break;case c.inputOutput:t.removeFieldInterest(this),this.removeFieldInterest(t)}this.processReferencesCallbacks()},getReferences:function(){return this[tt]===ut.prototype[tt]&&(this[tt]=new Set),this[tt]},addReferencesCallback:function(t,e){this[et]===ut.prototype[et]&&(this[et]=new Map),this[et].set(t,e)},removeReferencesCallback:function(t){this[et].delete(t)},getReferencesCallbacks:function(){return this[et]},processReferencesCallbacks:function(){const t=[];return function(){if(this[et].size)for(const e of g.values(t,this[et]))e()}}(),addFieldInterest:function(t){this[nt]===ut.prototype[nt]&&(this[nt]=new Set),this[nt].add(t)},removeFieldInterest:function(t){this[nt].delete(t)},getFieldInterests:function(){return this[nt]},addFieldCallback:function(t,e){this[it]===ut.prototype[it]&&(this[it]=new Map),this[it].set(t,e)},removeFieldCallback:function(t){this[it].delete(t)},getFieldCallbacks:function(){return this[it]},addInputRoute:function(t){this[ot]===ut.prototype[ot]&&(this[ot]=new Set),this[ot].add(t),this.processRouteCallbacks()},removeInputRoute:function(t){this[ot].delete(t),this.processRouteCallbacks()},getInputRoutes:function(){return this[ot]},addOutputRoute:function(t){this[rt]===ut.prototype[rt]&&(this[rt]=new Set),this[rt].add(t),this.processRouteCallbacks()},removeOutputRoute:function(t){this[rt].delete(t),this.processRouteCallbacks()},getOutputRoutes:function(){return this[rt]},addRouteCallback:function(t,e){this[st]===ut.prototype[st]&&(this[st]=new Map),this[st].set(t,e)},removeRouteCallback:function(t){this[st].delete(t)},getRouteCallbacks:function(){return this[st]},processRouteCallbacks:function(){const t=[];return function(){if(this[st].size)for(const e of g.values(t,this[st]))e()}}(),processEvent:function(){const t=[];return function(e=M.create(this)){if(e.has(this))return;e.add(this),this.setTainted(!1);const n=e.field;n!==this&&this.set(n.getValue(),n.length),this.processInterests();let i=!0;if(this[nt].size)for(const t of this[nt].values())i?(i=!1,t.addEventObject(this,e)):t.addEventObject(this,M.copy(e));if(i&&M.push(e),this[it].size)for(const e of g.values(t,this[it]))e(this.valueOf())}}(),addCloneCount:Function.prototype,removeCloneCount:Function.prototype,valueOf:function(){return this},fromString:function(t,e){},dispose:function(){for(const t of new Set(this[ot]))t.dispose();for(const t of new Set(this[rt]))t.dispose();O.prototype.dispose.call(this)}});for(const t of Reflect.ownKeys(ut.prototype))Object.defineProperty(ut.prototype,t,{enumerable:!1});const ct=ut;n.set("x_ite/Base/X3DField",ct);const lt=ct;function ht(t){return lt.call(this,!!t)}ht.prototype=Object.assign(Object.create(lt.prototype),{constructor:ht,copy:function(){return new ht(this.getValue())},isDefaultValue:function(){return!1===this.getValue()},set:function(t){lt.prototype.set.call(this,!!t)},getTypeName:function(){return"SFBool"},getType:function(){return c.SFBool},valueOf:function(){return this.getValue()},toStream:function(t){t.string+=this.getValue()?"TRUE":"FALSE"},toVRMLStream:function(t){this.toStream(t)},toXMLStream:function(t){t.string+=this.getValue()?"true":"false"},toJSONStream:function(t){this.toJSONStreamValue(t)},toJSONStreamValue:function(t){t.string+=this.getValue()?"true":"false"}});for(const t of Reflect.ownKeys(ht.prototype))Object.defineProperty(ht.prototype,t,{enumerable:!1});const dt=ht;n.set("x_ite/Fields/SFBool",dt);const pt=dt,ft=class{static radians(t){return t*(Math.PI/180)}static degrees(t){return t*(180/Math.PI)}static random(t,e){return t+Math.random()*(e-t)}static fract(t){return t%1}static clamp(t,e,n){return Math.min(Math.max(t,e),n)}static interval(t,e,n){return t>=n?(t-e)%(n-e)+e:t<e?(t-n)%(n-e)+n:t}static lerp(t,e,n){return t+n*(e-t)}static slerp(t,e,n){let i=t.dot(e);if(i>=1)return t;i<0&&(i=-i,e.negate());const o=Math.acos(i),r=Math.sin(o),s=Math.sin((1-n)*o)/r,a=Math.sin(n*o)/r;return t.x=t.x*s+e.x*a,t.y=t.y*s+e.y*a,t.z=t.z*s+e.z*a,t.w=t.w*s+e.w*a,t}static simpleSlerp(t,e,n){const i=t.dot(e);if(i>=1)return t;const o=Math.acos(i),r=Math.sin(o),s=Math.sin((1-n)*o)/r,a=Math.sin(n*o)/r;return t.x=t.x*s+e.x*a,t.y=t.y*s+e.y*a,t.z=t.z*s+e.z*a,t.w=t.w*s+e.w*a,t}static isPowerOfTwo(t){return 0==(t-1&t)}static nextPowerOfTwo(t){return this.isPowerOfTwo(t)?t:1<<32-Math.clz32(t)}static cmp(t,e){return t>e?1:t<e?-1:0}static less(t,e){return t<e}static greater(t,e){return t>e}static lowerBound(t,e,n,i,o=this.less){let r=0,s=0,a=n-e;for(;a>0;)s=a>>>1,r=e+s,o(t[r],i)?(e=++r,a-=s+1):a=s;return e}static upperBound(t,e,n,i,o=this.less){let r=0,s=0,a=n-e;for(;a>0;)s=a>>>1,r=e+s,o(i,t[r])?a=s:(e=++r,a-=s+1);return e}static set_difference(t,e,n){for(const i of t)e.has(i)||n.add(i);return n}};n.set("standard/Math/Algorithm",ft);const gt=ft,mt=gt.clamp,_t=Symbol.for("X_ITE.Color3.r"),xt=Symbol.for("X_ITE.Color3.g"),yt=Symbol.for("X_ITE.Color3.b");function wt(t,e,n){arguments.length?(this[_t]=mt(t,0,1),this[xt]=mt(e,0,1),this[yt]=mt(n,0,1)):(this[_t]=0,this[xt]=0,this[yt]=0)}wt.prototype={constructor:wt,length:3,[Symbol.iterator]:function*(){yield this[_t],yield this[xt],yield this[yt]},copy:function(){const t=Object.create(wt.prototype);return t[_t]=this[_t],t[xt]=this[xt],t[yt]=this[yt],t},assign:function(t){this[_t]=t[_t],this[xt]=t[xt],this[yt]=t[yt]},set:function(t,e,n){this[_t]=mt(t,0,1),this[xt]=mt(e,0,1),this[yt]=mt(n,0,1)},equals:function(t){return this[_t]===t[_t]&&this[xt]===t[xt]&&this[yt]===t[yt]},getHSV:function(t){let e,n,i;const o=Math.min(this[_t],this[xt],this[yt]),r=Math.max(this[_t],this[xt],this[yt]);i=r;const s=r-o;return 0!==r&&0!==s?(n=s/r,e=this[_t]===r?(this[xt]-this[yt])/s:this[xt]===r?2+(this[yt]-this[_t])/s:4+(this[_t]-this[xt])/s,e*=Math.PI/3,e<0&&(e+=2*Math.PI)):n=e=0,t[0]=e,t[1]=n,t[2]=i,t},setHSV:function(t,e,n){if(e=mt(e,0,1),n=mt(n,0,1),0===e)this[_t]=this[xt]=this[yt]=n;else{const i=gt.degrees(gt.interval(t,0,2*Math.PI))/60,o=Math.floor(i),r=i-o,s=n*(1-e),a=n*(1-e*r),u=n*(1-e*(1-r));switch(o%6){case 0:this[_t]=n,this[xt]=u,this[yt]=s;break;case 1:this[_t]=a,this[xt]=n,this[yt]=s;break;case 2:this[_t]=s,this[xt]=n,this[yt]=u;break;case 3:this[_t]=s,this[xt]=a,this[yt]=n;break;case 4:this[_t]=u,this[xt]=s,this[yt]=n;break;default:this[_t]=n,this[xt]=s,this[yt]=a}}},toString:function(){return this[_t]+" "+this[xt]+" "+this[yt]}};const St={get:function(){return this[_t]},set:function(t){this[_t]=mt(t,0,1)},enumerable:!0,configurable:!1},Tt={get:function(){return this[xt]},set:function(t){this[xt]=mt(t,0,1)},enumerable:!0,configurable:!1},bt={get:function(){return this[yt]},set:function(t){this[yt]=mt(t,0,1)},enumerable:!0,configurable:!1};Object.defineProperty(wt.prototype,"r",St),Object.defineProperty(wt.prototype,"g",Tt),Object.defineProperty(wt.prototype,"b",bt),St.enumerable=!1,Tt.enumerable=!1,bt.enumerable=!1,Object.defineProperty(wt.prototype,"0",St),Object.defineProperty(wt.prototype,"1",Tt),Object.defineProperty(wt.prototype,"2",bt),Object.assign(wt,{Black:new wt(0,0,0),White:new wt(1,1,1),HSV:function(t,e,n){const i=Object.create(this.prototype);return i.setHSV(t,e,n),i},lerp:function(t,e,n,i){let o=t[0],r=e[0];const s=t[1],a=e[1],u=t[2],c=e[2];0===s&&(o=r),0===a&&(r=o);const l=Math.abs(r-o);if(l<=Math.PI)return i[0]=o+n*(r-o),i[1]=s+n*(a-s),i[2]=u+n*(c-u),i;const h=2*Math.PI,d=(h-l)*n;let p=o<r?o-d:o+d;return p<0?p+=h:p>h&&(p-=h),i[0]=p,i[1]=s+n*(a-s),i[2]=u+n*(c-u),i}});const vt=wt;n.set("standard/Math/Numbers/Color3",vt);const Ct=vt;function Et(t,e,n){switch(arguments.length){case 0:return lt.call(this,new Ct);case 1:return lt.call(this,arguments[0]);case 3:return lt.call(this,new Ct(+t,+e,+n))}throw new Error("Invalid arguments.")}Et.prototype=Object.assign(Object.create(lt.prototype),{constructor:Et,[Symbol.iterator]:function*(){yield*this.getValue()},copy:function(){return new Et(this.getValue().copy())},getTypeName:function(){return"SFColor"},getType:function(){return c.SFColor},equals:function(t){return this.getValue().equals(t.getValue())},isDefaultValue:function(){return this.getValue().equals(Ct.Black)},set:function(t){this.getValue().assign(t)},getHSV:function(){return this.getValue().getHSV([])},setHSV:function(t,e,n){this.getValue().setHSV(t,e,n),this.addEvent()},lerp:function(){const t=[],e=[],n=[];return function(i,o){const r=new Et;return this.getValue().getHSV(t),i.getValue().getHSV(e),Ct.lerp(t,e,o,n),r.setHSV(n[0],n[1],n[2],n[3]),r}}(),toStream:function(t){const e=this.getValue(),n=e.length-1;for(let i=0;i<n;++i)t.string+=t.Precision(e[i]),t.string+=t.TidySpace();t.string+=t.Precision(e[n])},toVRMLStream:function(t){this.toStream(t)},toXMLStream:function(t){this.toStream(t)},toJSONStream:function(t){t.string+="[",t.string+=t.TidySpace(),this.toJSONStreamValue(t),t.string+=t.TidySpace(),t.string+="]"},toJSONStreamValue:function(t){const e=this.getValue(),n=e.length-1;for(let i=0;i<n;++i)t.string+=t.JSONNumber(t.Precision(e[i])),t.string+=",",t.string+=t.TidySpace();t.string+=t.JSONNumber(t.Precision(e[n]))}});for(const t of Reflect.ownKeys(Et.prototype))Object.defineProperty(Et.prototype,t,{enumerable:!1});const Ot={get:function(){return this.getValue().r},set:function(t){this.getValue().r=+t,this.addEvent()},enumerable:!0,configurable:!1},Nt={get:function(){return this.getValue().g},set:function(t){this.getValue().g=+t,this.addEvent()},enumerable:!0,configurable:!1},Ft={get:function(){return this.getValue().b},set:function(t){this.getValue().b=+t,this.addEvent()},enumerable:!0,configurable:!1};Object.defineProperty(Et.prototype,"r",Ot),Object.defineProperty(Et.prototype,"g",Nt),Object.defineProperty(Et.prototype,"b",Ft),Ot.enumerable=!1,Nt.enumerable=!1,Ft.enumerable=!1,Object.defineProperty(Et.prototype,"0",Ot),Object.defineProperty(Et.prototype,"1",Nt),Object.defineProperty(Et.prototype,"2",Ft);const It=Et;n.set("x_ite/Fields/SFColor",It);const Mt=It,Dt=gt.clamp,Vt=Symbol.for("X_ITE.Color3.r"),Rt=Symbol.for("X_ITE.Color3.g"),Pt=Symbol.for("X_ITE.Color3.b"),At=Symbol();function Lt(t,e,n,i){arguments.length?(this[Vt]=Dt(t,0,1),this[Rt]=Dt(e,0,1),this[Pt]=Dt(n,0,1),this[At]=Dt(i,0,1)):(this[Vt]=0,this[Rt]=0,this[Pt]=0,this[At]=0)}Lt.prototype={constructor:Lt,length:4,[Symbol.iterator]:function*(){yield this[Vt],yield this[Rt],yield this[Pt],yield this[At]},copy:function(){const t=Object.create(Lt.prototype);return t[Vt]=this[Vt],t[Rt]=this[Rt],t[Pt]=this[Pt],t[At]=this[At],t},assign:function(t){this[Vt]=t[Vt],this[Rt]=t[Rt],this[Pt]=t[Pt],this[At]=t[At]},set:function(t,e,n,i){this[Vt]=Dt(t,0,1),this[Rt]=Dt(e,0,1),this[Pt]=Dt(n,0,1),this[At]=Dt(i,0,1)},equals:function(t){return this[Vt]===t[Vt]&&this[Rt]===t[Rt]&&this[Pt]===t[Pt]&&this[At]===t[At]},getHSVA:function(t){return Ct.prototype.getHSV.call(this,t),t[3]=this[At],t},setHSVA:function(t,e,n,i){Ct.prototype.setHSV.call(this,t,e,n),this[At]=Dt(i,0,1)},toString:function(){return this[Vt]+" "+this[Rt]+" "+this[Pt]+" "+this[At]}};const Bt={get:function(){return this[Vt]},set:function(t){this[Vt]=Dt(t,0,1)},enumerable:!0,configurable:!1},Xt={get:function(){return this[Rt]},set:function(t){this[Rt]=Dt(t,0,1)},enumerable:!0,configurable:!1},Ut={get:function(){return this[Pt]},set:function(t){this[Pt]=Dt(t,0,1)},enumerable:!0,configurable:!1},kt={get:function(){return this[At]},set:function(t){this[At]=Dt(t,0,1)},enumerable:!0,configurable:!1};Object.defineProperty(Lt.prototype,"r",Bt),Object.defineProperty(Lt.prototype,"g",Xt),Object.defineProperty(Lt.prototype,"b",Ut),Object.defineProperty(Lt.prototype,"a",kt),Bt.enumerable=!1,Xt.enumerable=!1,Ut.enumerable=!1,kt.enumerable=!1,Object.defineProperty(Lt.prototype,"0",Bt),Object.defineProperty(Lt.prototype,"1",Xt),Object.defineProperty(Lt.prototype,"2",Ut),Object.defineProperty(Lt.prototype,"3",kt),Object.assign(Lt,{Transparent:new Lt(0,0,0,0),Black:new Lt(0,0,0,1),White:new Lt(1,1,1,1),HSVA:function(t,e,n,i){const o=Object.create(this.prototype);return o.setHSVA(t,e,n,i),o},lerp:function(t,e,n,i){const o=t[3];return Ct.lerp(t,e,n,i),i[3]=o+n*(e[3]-o),i}});const zt=Lt;n.set("standard/Math/Numbers/Color4",zt);const jt=zt;function Gt(t,e,n,i){switch(arguments.length){case 0:return lt.call(this,new jt);case 1:return lt.call(this,arguments[0]);case 4:return lt.call(this,new jt(+t,+e,+n,+i))}throw new Error("Invalid arguments.")}Gt.prototype=Object.assign(Object.create(lt.prototype),{constructor:Gt,[Symbol.iterator]:function*(){yield*this.getValue()},copy:function(){return new Gt(this.getValue().copy())},getTypeName:function(){return"SFColorRGBA"},getType:function(){return c.SFColorRGBA},equals:Mt.prototype.equals,isDefaultValue:function(){return this.getValue().equals(jt.Transparent)},set:Mt.prototype.set,getHSVA:function(){return this.getValue().getHSVA([])},setHSVA:function(t,e,n,i){this.getValue().setHSVA(t,e,n,i),this.addEvent()},lerp:function(){const t=[],e=[],n=[];return function(i,o){const r=new Gt;return this.getValue().getHSVA(t),i.getValue().getHSVA(e),jt.lerp(t,e,o,n),r.setHSVA(n[0],n[1],n[2],n[3]),r}}(),toStream:Mt.prototype.toStream,toVRMLStream:Mt.prototype.toVRMLStream,toXMLStream:Mt.prototype.toXMLStream,toJSONStream:Mt.prototype.toJSONStream,toJSONStreamValue:Mt.prototype.toJSONStreamValue});for(const t of Reflect.ownKeys(Gt.prototype))Object.defineProperty(Gt.prototype,t,{enumerable:!1});const Ht={get:function(){return this.getValue().r},set:function(t){this.getValue().r=+t,this.addEvent()},enumerable:!0,configurable:!1},qt={get:function(){return this.getValue().g},set:function(t){this.getValue().g=+t,this.addEvent()},enumerable:!0,configurable:!1},Yt={get:function(){return this.getValue().b},set:function(t){this.getValue().b=+t,this.addEvent()},enumerable:!0,configurable:!1},Wt={get:function(){return this.getValue().a},set:function(t){this.getValue().a=+t,this.addEvent()},enumerable:!0,configurable:!1};Object.defineProperty(Gt.prototype,"r",Ht),Object.defineProperty(Gt.prototype,"g",qt),Object.defineProperty(Gt.prototype,"b",Yt),Object.defineProperty(Gt.prototype,"a",Wt),Ht.enumerable=!1,qt.enumerable=!1,Yt.enumerable=!1,Wt.enumerable=!1,Object.defineProperty(Gt.prototype,"0",Ht),Object.defineProperty(Gt.prototype,"1",qt),Object.defineProperty(Gt.prototype,"2",Yt),Object.defineProperty(Gt.prototype,"3",Wt);const Kt=Gt;n.set("x_ite/Fields/SFColorRGBA",Kt);const Jt=Kt;function Zt(t){return lt.call(this,arguments.length?+t:0)}Zt.prototype=Object.assign(Object.create(lt.prototype),{constructor:Zt,copy:function(){return new Zt(this.getValue())},getTypeName:function(){return"SFDouble"},getType:function(){return c.SFDouble},isDefaultValue:function(){return 0===this.getValue()},set:function(t){lt.prototype.set.call(this,+t)},valueOf:lt.prototype.getValue,toStream:function(t){const e=t.Unit(this.getUnit());t.string+=t.DoublePrecision(t.ToUnit(e,this.getValue()))},toVRMLStream:function(t){this.toStream(t)},toXMLStream:function(t){this.toStream(t)},toJSONStream:function(t){this.toJSONStreamValue(t)},toJSONStreamValue:function(t){const e=t.Unit(this.getUnit());t.string+=t.JSONNumber(t.DoublePrecision(t.ToUnit(e,this.getValue())))}});for(const t of Reflect.ownKeys(Zt.prototype))Object.defineProperty(Zt.prototype,t,{enumerable:!1});const Qt=Zt;n.set("x_ite/Fields/SFDouble",Qt);const $t=Qt;function te(t){return lt.call(this,arguments.length?+t:0)}te.prototype=Object.assign(Object.create(lt.prototype),{constructor:te,copy:function(){return new te(this.getValue())},getTypeName:function(){return"SFFloat"},getType:function(){return c.SFFloat},isDefaultValue:function(){return 0===this.getValue()},set:function(t){lt.prototype.set.call(this,+t)},valueOf:lt.prototype.getValue,toStream:function(t){const e=t.Unit(this.getUnit());t.string+=t.Precision(t.ToUnit(e,this.getValue()))},toVRMLStream:function(t){this.toStream(t)},toXMLStream:function(t){this.toStream(t)},toJSONStream:function(t){this.toJSONStreamValue(t)},toJSONStreamValue:function(t){const e=t.Unit(this.getUnit());t.string+=t.JSONNumber(t.Precision(t.ToUnit(e,this.getValue())))}});for(const t of Reflect.ownKeys(te.prototype))Object.defineProperty(te.prototype,t,{enumerable:!1});const ee=te;n.set("x_ite/Fields/SFFloat",ee);const ne=ee;function ie(t){return lt.call(this,~~t)}ie.prototype=Object.assign(Object.create(lt.prototype),{constructor:ie,copy:function(){return new ie(this.getValue())},getTypeName:function(){return"SFInt32"},getType:function(){return c.SFInt32},isDefaultValue:function(){return 0===this.getValue()},set:function(t){lt.prototype.set.call(this,~~t)},valueOf:lt.prototype.getValue,toStream:function(t){t.string+=this.getValue().toString()},toVRMLStream:function(t){this.toStream(t)},toXMLStream:function(t){this.toStream(t)},toJSONStream:function(t){this.toStream(t)},toJSONStreamValue:function(t){this.toStream(t)}});for(const t of Reflect.ownKeys(ie.prototype))Object.defineProperty(ie.prototype,t,{enumerable:!1});const oe=ie;n.set("x_ite/Fields/SFInt32",oe);const re=oe;const se=function(t,e,n,i,o){const r=o?"DoublePrecision":"Precision";return Object.assign(Object.create(lt.prototype),{[Symbol.iterator]:function*(){yield*this.getValue()},getTypeName:function(){return t},getType:function(){return e},copy:function(){return new this.constructor(this.getValue().copy())},equals:function(t){return this.getValue().equals(t.getValue())},isDefaultValue:function(){return this.getValue().equals(n.Identity)},set:function(t){this.getValue().assign(t)},setTransform:function(t,e,n,i,o){t=t?t.getValue():null,e=e?e.getValue():null,n=n?n.getValue():null,i=i?i.getValue():null,o=o?o.getValue():null,this.getValue().set(t,e,n,i,o)},getTransform:function(t,e,n,i,o){t=t?t.getValue():null,e=e?e.getValue():null,n=n?n.getValue():null,i=i?i.getValue():null,o=o?o.getValue():null,this.getValue().get(t,e,n,i,o)},determinant:function(){return this.getValue().determinant()},transpose:function(){return new this.constructor(n.transpose(this.getValue()))},inverse:function(){return new this.constructor(n.inverse(this.getValue()))},multLeft:function(t){return new this.constructor(n.multLeft(this.getValue(),t.getValue()))},multRight:function(t){return new this.constructor(n.multRight(this.getValue(),t.getValue()))},multVecMatrix:function(t){return new i(this.getValue().multVecMatrix(t.getValue().copy()))},multMatrixVec:function(t){return new i(this.getValue().multMatrixVec(t.getValue().copy()))},multDirMatrix:function(t){return new i(this.getValue().multDirMatrix(t.getValue().copy()))},multMatrixDir:function(t){return new i(this.getValue().multMatrixDir(t.getValue().copy()))},toStream:function(t){const e=this.getValue(),n=e.length-1;for(let i=0;i<n;++i)t.string+=t[r](e[i]),t.string+=t.TidySpace();t.string+=t[r](e[n])},toVRMLStream:function(t){this.toStream(t)},toXMLStream:function(t){this.toStream(t)},toJSONStream:function(t){t.string+="[",t.string+=t.TidySpace(),this.toJSONStreamValue(t),t.string+=t.TidySpace(),t.string+="]"},toJSONStreamValue:function(t){const e=this.getValue(),n=e.length-1;for(let i=0;i<n;++i)t.string+=t.JSONNumber(t[r](e[i])),t.string+=",",t.string+=t.TidySpace();t.string+=t.JSONNumber(t[r](e[n]))}})};n.set("x_ite/Fields/SFMatrixPrototypeTemplate",se);const ae=se;const ue=function(t,e,n,i){const o=i?"DoublePrecision":"Precision";return Object.assign(Object.create(lt.prototype),{[Symbol.iterator]:function*(){yield*this.getValue()},getTypeName:function(){return t},getType:function(){return e},copy:function(){return new this.constructor(this.getValue().copy())},equals:function(t){return this.getValue().equals(t.getValue())},isDefaultValue:function(){return this.getValue().equals(n.Zero)},set:function(t){this.getValue().assign(t)},abs:function(){return new this.constructor(n.abs(this.getValue()))},add:function(t){return new this.constructor(n.add(this.getValue(),t.getValue()))},distance:function(t){return this.getValue().distance(t.getValue())},divide:function(t){return new this.constructor(n.divide(this.getValue(),t))},divVec:function(t){return new this.constructor(n.divVec(this.getValue(),t.getValue()))},dot:function(t){return this.getValue().dot(t.getValue())},inverse:function(){return new this.constructor(n.inverse(this.getValue()))},length:function(){return this.getValue().magnitude()},lerp:function(t,e){return new this.constructor(n.lerp(this.getValue(),t,e))},max:function(t){return new this.constructor(n.max(this.getValue(),t.getValue()))},min:function(t){return new this.constructor(n.min(this.getValue(),t.getValue()))},multiply:function(t){return new this.constructor(n.multiply(this.getValue(),t))},multVec:function(t){return new this.constructor(n.multVec(this.getValue(),t.getValue()))},negate:function(){return new this.constructor(n.negate(this.getValue()))},normalize:function(t){return new this.constructor(n.normalize(this.getValue()))},subtract:function(t){return new this.constructor(n.subtract(this.getValue(),t.getValue()))},toStream:function(t){const e=this.getValue(),n=e.length-1,i=t.Unit(this.getUnit());for(let r=0;r<n;++r)t.string+=t[o](t.ToUnit(i,e[r])),t.string+=t.TidySpace();t.string+=t[o](t.ToUnit(i,e[n]))},toVRMLStream:function(t){this.toStream(t)},toXMLStream:function(t){this.toStream(t)},toJSONStream:function(t){t.string+="[",t.string+=t.TidySpace(),this.toJSONStreamValue(t),t.string+=t.TidySpace(),t.string+="]"},toJSONStreamValue:function(t){const e=this.getValue(),n=e.length-1,i=t.Unit(this.getUnit());for(let r=0;r<n;++r)t.string+=t.JSONNumber(t[o](t.ToUnit(i,e[r]))),t.string+=",",t.string+=t.TidySpace();t.string+=t.JSONNumber(t[o](t.ToUnit(i,e[n])))}})};n.set("x_ite/Fields/SFVecPrototypeTemplate",ue);const ce=ue;function le(t,e){this.x=t,this.y=e}le.prototype={constructor:le,length:2,[Symbol.iterator]:function*(){yield this.x,yield this.y},copy:function(){const t=Object.create(le.prototype);return t.x=this.x,t.y=this.y,t},assign:function(t){return this.x=t.x,this.y=t.y,this},set:function(t,e){return this.x=t,this.y=e,this},equals:function(t){return this.x===t.x&&this.y===t.y},negate:function(){return this.x=-this.x,this.y=-this.y,this},inverse:function(){return this.x=1/this.x,this.y=1/this.y,this},add:function(t){return this.x+=t.x,this.y+=t.y,this},subtract:function(t){return this.x-=t.x,this.y-=t.y,this},multiply:function(t){return this.x*=t,this.y*=t,this},multVec:function(t){return this.x*=t.x,this.y*=t.y,this},divide:function(t){return this.x/=t,this.y/=t,this},divVec:function(t){return this.x/=t.x,this.y/=t.y,this},normalize:function(){const t=Math.hypot(this.x,this.y);return t&&(this.x/=t,this.y/=t),this},dot:function(t){return this.x*t.x+this.y*t.y},norm:function(){const t=this.x,e=this.y;return t*t+e*e},magnitude:function(){return Math.hypot(this.x,this.y)},distance:function(t){return Math.hypot(this.x-t.x,this.y-t.y)},lerp:function(t,e){const n=this.x,i=this.y;return this.x=n+e*(t.x-n),this.y=i+e*(t.y-i),this},abs:function(){return this.x=Math.abs(this.x),this.y=Math.abs(this.y),this},min:function(t){let e=this.x,n=this.y;for(const t of arguments)e=Math.min(e,t.x),n=Math.min(n,t.y);return this.x=e,this.y=n,this},max:function(t){let e=this.x,n=this.y;for(const t of arguments)e=Math.max(e,t.x),n=Math.max(n,t.y);return this.x=e,this.y=n,this},toString:function(){return this.x+" "+this.y}},Object.defineProperty(le.prototype,"0",{get:function(){return this.x},set:function(t){this.x=t},enumerable:!1,configurable:!1}),Object.defineProperty(le.prototype,"1",{get:function(){return this.y},set:function(t){this.y=t},enumerable:!1,configurable:!1}),Object.assign(le,{Zero:new le(0,0),One:new le(1,1),xAxis:new le(1,0),yAxis:new le(0,1),negate:function(t){return t.copy().negate()},inverse:function(t){return t.copy().inverse()},add:function(t,e){return t.copy().add(e)},subtract:function(t,e){return t.copy().subtract(e)},multiply:function(t,e){return t.copy().multiply(e)},multVec:function(t,e){return t.copy().multVec(e)},divide:function(t,e){return t.copy().divide(e)},divVec:function(t,e){return t.copy().divVec(e)},normalize:function(t){return t.copy().normalize()},dot:function(t,e){return t.dot(e)},magnitude:function(t){return t.magnitude()},distance:function(t,e){return t.distance(e)},lerp:function(t,e,n){return t.copy().lerp(e,n)},abs:function(t){return t.copy().abs()},min:function(t,e){return this.prototype.min.apply(t.copy(),arguments)},max:function(t,e){return this.prototype.max.apply(t.copy(),arguments)}});const he=le;n.set("standard/Math/Numbers/Vector2",he);const de=he;function pe(t,e,n){function i(t,e){switch(arguments.length){case 0:return lt.call(this,new de(0,0));case 1:return lt.call(this,arguments[0]);case 2:return lt.call(this,new de(+t,+e))}throw new Error("Invalid arguments.")}i.prototype=Object.assign(Object.create(lt.prototype),ce(t,e,de,n),{constructor:i});for(const t of Reflect.ownKeys(i.prototype))Object.defineProperty(i.prototype,t,{enumerable:!1});const o={get:function(){return this.getValue().x},set:function(t){this.getValue().x=+t,this.addEvent()},enumerable:!0,configurable:!1},r={get:function(){return this.getValue().y},set:function(t){this.getValue().y=+t,this.addEvent()},enumerable:!0,configurable:!1};return Object.defineProperty(i.prototype,"x",o),Object.defineProperty(i.prototype,"y",r),o.enumerable=!1,r.enumerable=!1,Object.defineProperty(i.prototype,"0",o),Object.defineProperty(i.prototype,"1",r),i}const fe={SFVec2d:pe("SFVec2d",c.SFVec2d,!0),SFVec2f:pe("SFVec2f",c.SFVec2f,!1)};n.set("x_ite/Fields/SFVec2",fe);const ge=fe;function me(t,e,n){this.x=t,this.y=e,this.z=n}me.prototype={constructor:me,length:3,[Symbol.iterator]:function*(){yield this.x,yield this.y,yield this.z},copy:function(){const t=Object.create(me.prototype);return t.x=this.x,t.y=this.y,t.z=this.z,t},assign:function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this},set:function(t,e,n){return this.x=t,this.y=e,this.z=n,this},equals:function(t){return this.x===t.x&&this.y===t.y&&this.z===t.z},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},inverse:function(){return this.x=1/this.x,this.y=1/this.y,this.z=1/this.z,this},add:function(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this},subtract:function(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this},multiply:function(t){return this.x*=t,this.y*=t,this.z*=t,this},multVec:function(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this},divide:function(t){return this.x/=t,this.y/=t,this.z/=t,this},divVec:function(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this},cross:function(t){const e=this.x,n=this.y,i=this.z,o=t.x,r=t.y,s=t.z;return this.x=n*s-i*r,this.y=i*o-e*s,this.z=e*r-n*o,this},normalize:function(){const t=Math.hypot(this.x,this.y,this.z);return t&&(this.x/=t,this.y/=t,this.z/=t),this},dot:function(t){return this.x*t.x+this.y*t.y+this.z*t.z},norm:function(){let t=this.x,e=this.y,n=this.z;return t*t+e*e+n*n},magnitude:function(){return Math.hypot(this.x,this.y,this.z)},distance:function(t){return Math.hypot(this.x-t.x,this.y-t.y,this.z-t.z)},lerp:function(t,e){const n=this.x,i=this.y,o=this.z;return this.x=n+e*(t.x-n),this.y=i+e*(t.y-i),this.z=o+e*(t.z-o),this},slerp:function(){const t=new me(0,0,0);return function(e,n){return gt.simpleSlerp(this,t.assign(e),n)}}(),abs:function(){return this.x=Math.abs(this.x),this.y=Math.abs(this.y),this.z=Math.abs(this.z),this},min:function(t){let e=this.x,n=this.y,i=this.z;for(const t of arguments)e=Math.min(e,t.x),n=Math.min(n,t.y),i=Math.min(i,t.z);return this.x=e,this.y=n,this.z=i,this},max:function(t){let e=this.x,n=this.y,i=this.z;for(const t of arguments)e=Math.max(e,t.x),n=Math.max(n,t.y),i=Math.max(i,t.z);return this.x=e,this.y=n,this.z=i,this},toString:function(){return this.x+" "+this.y+" "+this.z}},Object.defineProperty(me.prototype,"0",{get:function(){return this.x},set:function(t){this.x=t},enumerable:!1,configurable:!1}),Object.defineProperty(me.prototype,"1",{get:function(){return this.y},set:function(t){this.y=t},enumerable:!1,configurable:!1}),Object.defineProperty(me.prototype,"2",{get:function(){return this.z},set:function(t){this.z=t},enumerable:!1,configurable:!1}),Object.assign(me,{Zero:new me(0,0,0),One:new me(1,1,1),xAxis:new me(1,0,0),yAxis:new me(0,1,0),zAxis:new me(0,0,1),negate:function(t){return t.copy().negate()},inverse:function(t){return t.copy().inverse()},add:function(t,e){return t.copy().add(e)},subtract:function(t,e){return t.copy().subtract(e)},multiply:function(t,e){return t.copy().multiply(e)},multVec:function(t,e){return t.copy().multVec(e)},divide:function(t,e){return t.copy().divide(e)},divVec:function(t,e){return t.copy().divVec(e)},cross:function(t,e){return t.copy().cross(e)},normalize:function(t){return t.copy().normalize()},dot:function(t,e){return t.dot(e)},magnitude:function(t){return t.magnitude()},distance:function(t,e){return t.distance(e)},lerp:function(t,e,n){return t.copy().lerp(e,n)},slerp:function(t,e,n){return t.copy().slerp(e,n)},abs:function(t){return t.copy().abs()},min:function(t,e){return this.prototype.min.apply(t.copy(),arguments)},max:function(t,e){return this.prototype.max.apply(t.copy(),arguments)}});const _e=me;n.set("standard/Math/Numbers/Vector3",_e);const xe=_e;function ye(){arguments.length?(this[0]=arguments[0],this[1]=arguments[1],this[2]=arguments[2],this[3]=arguments[3]):this.identity()}ye.prototype={constructor:ye,order:2,length:4,[Symbol.iterator]:function*(){const t=this.length;for(let e=0;e<t;++e)yield this[e]},copy:function(){const t=Object.create(ye.prototype);return t[0]=this[0],t[1]=this[1],t[2]=this[2],t[3]=this[3],t},assign:function(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this[3]=t[3],this},equals:function(t){return this[0]===t[0]&&this[1]===t[1]&&this[2]===t[2]&&this[3]===t[3]},set1:function(t,e,n){this[t*this.order+e]=n},get1:function(t,e){return this[t*this.order+e]},set:function(){switch(arguments.length){case 0:this.identity();break;case 4:this[0]=arguments[0],this[1]=arguments[1],this[2]=arguments[2],this[3]=arguments[3]}return this},determinant1:function(){return this[0]},determinant:function(){return this[0]*this[3]-this[1]*this[2]},transpose:function(){const t=this[1];return this[1]=this[2],this[2]=t,this},inverse:function(){const t=this[0],e=this[1],n=this[2],i=this[3],o=t*i-e*n;return this[0]=i/o,this[1]=-e/o,this[2]=-n/o,this[3]=t/o,this},multLeft:function(t){const e=this[0],n=this[1],i=this[2],o=this[3],r=t[0],s=t[1],a=t[2],u=t[3];return this[0]=e*r+i*s,this[1]=n*r+o*s,this[2]=e*a+i*u,this[3]=n*a+o*u,this},multRight:function(t){const e=this[0],n=this[1],i=this[2],o=this[3],r=t[0],s=t[1],a=t[2],u=t[3];return this[0]=r*e+a*n,this[1]=s*e+u*n,this[2]=r*i+a*o,this[3]=s*i+u*o,this},multVecMatrix:function(t){if("number"==typeof t){const e=t,n=e*this[2]+this[3];return(e*this[0]+this[1])/n}const e=t.x,n=t.y;return t.x=e*this[0]+n*this[2],t.y=e*this[1]+n*this[3],t},multMatrixVec:function(t){if("number"==typeof t){const e=t,n=e*this[2]+this[3];return(e*this[0]+this[1])/n}const e=t.x,n=t.y;return t.x=e*this[0]+n*this[1],t.y=e*this[2]+n*this[3],t},identity:function(){this[0]=1,this[1]=0,this[2]=0,this[3]=1},toString:function(){return this[0]+" "+this[1]+" "+this[2]+" "+this[3]}},Object.defineProperty(ye.prototype,"x",{get:function(){const t=new de(0,0);return function(){return t.set(this[0],this[1])}}(),enumerable:!1,configurable:!1}),Object.defineProperty(ye.prototype,"y",{get:function(){const t=new de(0,0);return function(){return t.set(this[2],this[3])}}(),enumerable:!1,configurable:!1}),Object.defineProperty(ye.prototype,"xAxis",{get:function(){return this[0]},enumerable:!1,configurable:!1}),Object.defineProperty(ye.prototype,"origin",{get:function(){return this[2]},enumerable:!1,configurable:!1}),Object.defineProperty(ye.prototype,"submatrix",{get:function(){return this[0]},enumerable:!1,configurable:!1}),Object.assign(ye,{Identity:new ye});const we=ye;n.set("standard/Math/Numbers/Matrix2",we);const Se=we,Te=[],be=[],ve=[];const Ce=function(t,e){const n=t.order,i=e.values,o=e.vectors;let r,s,a,u,c,l,h,d,p,f,g,m,_,x=t.length;for(m=0;m<n;++m)for(Te[m]=Te[m]||new Array(n),be[m]=i[m]=t.get1(m,m),ve[m]=0,_=0;_<n;++_)o[m][_]=m===_?1:0,Te[m][_]=t.get1(_,m);for(m=0;m<50;++m){for(r=0,f=0;f<n-1;++f)for(g=f+1;g<n;++g)r+=Math.abs(Te[f][g]);if(0===r)break;for(p=m<3?.2*r/x:0,f=0;f<n-1;++f)for(g=f+1;g<n;++g)if(d=100*Math.abs(Te[f][g]),m>3&&Math.abs(i[f])+d===Math.abs(i[f])&&Math.abs(i[g])+d===Math.abs(i[g]))Te[f][g]=0;else if(Math.abs(Te[f][g])>p){for(h=i[g]-i[f],Math.abs(h)+d===Math.abs(h)?c=Te[f][g]/h:(s=.5*h/Te[f][g],c=1/(Math.abs(s)+Math.sqrt(1+s*s)),s<0&&(c=-c)),a=1/Math.sqrt(1+c*c),u=c*a,l=u/(1+a),h=c*Te[f][g],ve[f]-=h,ve[g]+=h,i[f]-=h,i[g]+=h,Te[f][g]=0,_=0;_<f;++_)d=Te[_][f],h=Te[_][g],Te[_][f]=d-u*(h+d*l),Te[_][g]=h+u*(d-h*l);for(_=f+1;_<g;++_)d=Te[f][_],h=Te[_][g],Te[f][_]=d-u*(h+d*l),Te[_][g]=h+u*(d-h*l);for(_=g+1;_<n;++_)d=Te[f][_],h=Te[g][_],Te[f][_]=d-u*(h+d*l),Te[g][_]=h+u*(d-h*l);for(_=0;_<n;++_)d=o[_][f],h=o[_][g],o[_][f]=d-u*(h+d*l),o[_][g]=h+u*(d-h*l)}for(f=0;f<n;++f)i[f]=be[f]+=ve[f],ve[f]=0}return e};n.set("standard/Math/Algorithms/eigen_decomposition",Ce);const Ee=Ce;function Oe(){arguments.length?(this[0]=arguments[0],this[1]=arguments[1],this[2]=arguments[2],this[3]=arguments[3],this[4]=arguments[4],this[5]=arguments[5],this[6]=arguments[6],this[7]=arguments[7],this[8]=arguments[8]):this.identity()}Oe.prototype={constructor:Oe,order:3,length:9,[Symbol.iterator]:function*(){const t=this.length;for(let e=0;e<t;++e)yield this[e]},copy:function(){const t=Object.create(Oe.prototype);return t[0]=this[0],t[1]=this[1],t[2]=this[2],t[3]=this[3],t[4]=this[4],t[5]=this[5],t[6]=this[6],t[7]=this[7],t[8]=this[8],t},assign:function(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this[3]=t[3],this[4]=t[4],this[5]=t[5],this[6]=t[6],this[7]=t[7],this[8]=t[8],this},equals:function(t){return this[0]===t[0]&&this[1]===t[1]&&this[2]===t[2]&&this[3]===t[3]&&this[4]===t[4]&&this[5]===t[5]&&this[6]===t[6]&&this[7]===t[7]&&this[8]===t[8]},rotation:function(){return math.atan2(this[1],this[0])},set1:function(t,e,n){return this[t*this.order+e]=n,this},get1:function(t,e){return this[t*this.order+e]},set:function(){const t=new de(0,0);return function(e,n,i,o,r){switch(arguments.length){case 0:this.identity();break;case 1:null===e&&(e=de.Zero),this.identity(),this.translate(e);break;case 2:null===e&&(e=de.Zero),null===n&&(n=0),this.identity(),this.translate(e),0!==n&&this.rotate(n);break;case 3:null===e&&(e=de.Zero),null===n&&(n=0),null===i&&(i=de.One),this.identity(),this.translate(e),0!==n&&this.rotate(n),i.equals(de.One)||this.scale(i);break;case 4:if(null===e&&(e=de.Zero),null===n&&(n=0),null===i&&(i=de.One),null===o&&(o=0),this.identity(),this.translate(e),0!==n&&this.rotate(n),!i.equals(de.One)){0!==o?(this.rotate(o),this.scale(i),this.rotate(-o)):this.scale(i)}break;case 5:{null===e&&(e=de.Zero),null===n&&(n=0),null===i&&(i=de.One),null===o&&(o=0),null===r&&(r=de.Zero),this.identity(),this.translate(e);const s=!r.equals(de.Zero);s&&this.translate(r),0!==n&&this.rotate(n),i.equals(de.One)||(0!==o?(this.rotate(o),this.scale(i),this.rotate(-o)):this.scale(i)),s&&this.translate(t.assign(r).negate());break}case 9:this[0]=arguments[0],this[1]=arguments[1],this[2]=arguments[2],this[3]=arguments[3],this[4]=arguments[4],this[5]=arguments[5],this[6]=arguments[6],this[7]=arguments[7],this[8]=arguments[8]}return this}}(),get:function(){const t=new de(0,0),e=new xe(0,0,0),n=new de(0,0),i=new xe(0,0,0),o=new de(0,0),r=new Se,s=new Se,a=new de(0,0);return function(u,c,l,h,d){switch(null===u&&(u=t),null===c&&(c=e),null===l&&(l=n),null===h&&(h=i),null===d&&(d=o),arguments.length){case 1:u.set(this[6],this[7]);break;case 2:this.factor(u,r,n,s),c[0]=r[0],c[1]=r[1],c[2]=Math.atan2(r[1],r[0]);break;case 3:this.factor(u,r,l,s),c[0]=r[0],c[1]=r[1],c[2]=Math.atan2(r[1],r[0]);break;case 4:this.factor(u,r,l,s),c[0]=r[0],c[1]=r[1],c[2]=Math.atan2(r[1],r[0]),h[0]=s[0],h[1]=s[1],h[2]=Math.atan2(s[1],s[0]);break;case 5:Ne.set(a.assign(d).negate()),Ne.multLeft(this),Ne.translate(d),Ne.get(u,c,l,h)}}}(),factor:function(){const t=new Se,e=new Se,n=new Se,i={values:[],vectors:[[],[]]};return function(o,r,s,a){o.set(this[6],this[7]);const u=this.submatrix,c=u.determinant()<0?-1:1;n.assign(u).transpose().multLeft(u);const l=Ee(n,i);a.set(l.vectors[0][0],l.vectors[1][0],l.vectors[0][1],l.vectors[1][1]),s.x=c*Math.sqrt(l.values[0]),s.y=c*Math.sqrt(l.values[1]),t[0]=1/s.x,t[3]=1/s.y,r.assign(e.assign(a).transpose().multRight(t).multRight(a).multRight(u))}}(),determinant2:function(){return this[0]*this[4]-this[1]*this[3]},determinant:function(){const t=this[0],e=this[1],n=this[2],i=this[3],o=this[4],r=this[5],s=this[6],a=this[7],u=this[8];return t*(o*u-r*a)-e*(i*u-r*s)+n*(i*a-o*s)},transpose:function(){let t;return t=this[1],this[1]=this[3],this[3]=t,t=this[2],this[2]=this[6],this[6]=t,t=this[5],this[5]=this[7],this[7]=t,this},inverse:function(){const t=this[0],e=this[1],n=this[2],i=this[3],o=this[4],r=this[5],s=this[6],a=this[7],u=this[8],c=t*o,l=t*a,h=i*e,d=i*a,p=s*e,f=s*o;let g=c*u-l*r-h*u+d*n+p*r-f*n;g=1/g;const m=(o*u-a*r)*g,_=-(e*u-a*n)*g,x=(e*r-o*n)*g,y=-(i*u-s*r)*g,w=(t*u-s*n)*g,S=-(t*r-i*n)*g;return this[0]=m,this[1]=_,this[2]=x,this[3]=y,this[4]=w,this[5]=S,this[6]=(d-f)*g,this[7]=-(l-p)*g,this[8]=(c-h)*g,this},multLeft:function(t){const e=this[0],n=this[1],i=this[2],o=this[3],r=this[4],s=this[5],a=this[6],u=this[7],c=this[8],l=t[0],h=t[1],d=t[2],p=t[3],f=t[4],g=t[5],m=t[6],_=t[7],x=t[8];return this[0]=e*l+o*h+a*d,this[1]=n*l+r*h+u*d,this[2]=i*l+s*h+c*d,this[3]=e*p+o*f+a*g,this[4]=n*p+r*f+u*g,this[5]=i*p+s*f+c*g,this[6]=e*m+o*_+a*x,this[7]=n*m+r*_+u*x,this[8]=i*m+s*_+c*x,this},multRight:function(t){const e=this[0],n=this[1],i=this[2],o=this[3],r=this[4],s=this[5],a=this[6],u=this[7],c=this[8],l=t[0],h=t[1],d=t[2],p=t[3],f=t[4],g=t[5],m=t[6],_=t[7],x=t[8];return this[0]=e*l+n*p+i*m,this[1]=e*h+n*f+i*_,this[2]=e*d+n*g+i*x,this[3]=o*l+r*p+s*m,this[4]=o*h+r*f+s*_,this[5]=o*d+r*g+s*x,this[6]=a*l+u*p+c*m,this[7]=a*h+u*f+c*_,this[8]=a*d+u*g+c*x,this},multVecMatrix:function(t){if(2===t.length){const e=t.x,n=t.y,i=e*this[2]+n*this[5]+this[8];return t.x=(e*this[0]+n*this[3]+this[6])/i,t.y=(e*this[1]+n*this[4]+this[7])/i,t}const e=t.x,n=t.y,i=t.z;return t.x=e*this[0]+n*this[3]+i*this[6],t.y=e*this[1]+n*this[4]+i*this[7],t.z=e*this[2]+n*this[5]+i*this[8],t},multMatrixVec:function(t){if(2===t.length){const e=t.x,n=t.y,i=e*this[6]+n*this[7]+this[8];return t.x=(e*this[0]+n*this[1]+this[2])/i,t.y=(e*this[3]+n*this[4]+this[5])/i,t}const e=t.x,n=t.y,i=t.z;return t.x=e*this[0]+n*this[1]+i*this[2],t.y=e*this[3]+n*this[4]+i*this[5],t.z=e*this[6]+n*this[7]+i*this[8],t},multDirMatrix:function(t){const e=t.x,n=t.y;return t.x=e*this[0]+n*this[3],t.y=e*this[1]+n*this[4],t},multMatrixDir:function(t){const e=t.x,n=t.y;return t.x=e*this[0]+n*this[1],t.y=e*this[3]+n*this[4],t},identity:function(){this[0]=1,this[1]=0,this[2]=0,this[3]=0,this[4]=1,this[5]=0,this[6]=0,this[7]=0,this[8]=1},translate:function(t){const e=t.x,n=t.y;return this[6]+=this[0]*e+this[3]*n,this[7]+=this[1]*e+this[4]*n,this},rotate:function(t){return this.multLeft(Oe.Rotation(t)),this},scale:function(t){const e=t.x,n=t.y;return this[0]*=e,this[3]*=n,this[1]*=e,this[4]*=n,this},toString:function(){return this[0]+" "+this[1]+" "+this[2]+" "+this[3]+" "+this[4]+" "+this[5]+" "+this[6]+" "+this[7]+" "+this[8]}},Object.defineProperty(Oe.prototype,"x",{get:function(){const t=new xe(0,0,0);return function(){return t.set(this[0],this[1],this[2])}}(),enumerable:!1,configurable:!1}),Object.defineProperty(Oe.prototype,"y",{get:function(){const t=new xe(0,0,0);return function(){return t.set(this[3],this[4],this[5])}}(),enumerable:!1,configurable:!1}),Object.defineProperty(Oe.prototype,"z",{get:function(){const t=new xe(0,0,0);return function(){return t.set(this[6],this[7],this[8])}}(),enumerable:!1,configurable:!1}),Object.defineProperty(Oe.prototype,"xAxis",{get:function(){const t=new de(0,0);return function(){return t.set(this[0],this[1])}}(),enumerable:!1,configurable:!1}),Object.defineProperty(Oe.prototype,"yAxis",{get:function(){const t=new de(0,0);return function(){return t.set(this[3],this[4])}}(),enumerable:!1,configurable:!1}),Object.defineProperty(Oe.prototype,"origin",{get:function(){const t=new de(0,0);return function(){return t.set(this[6],this[7])}}(),enumerable:!1,configurable:!1}),Object.defineProperty(Oe.prototype,"submatrix",{get:function(){const t=new Se;return function(){return t[0]=this[0],t[1]=this[1],t[2]=this[3],t[3]=this[4],t}}(),enumerable:!1,configurable:!1}),Object.assign(Oe,{Identity:new Oe,Rotation:function(t){const e=Math.sin(t),n=Math.cos(t);return new Oe(n,e,0,-e,n,0,0,0,1)},Matrix2:function(t){return new Oe(t[0],t[1],0,t[2],t[3],0,0,0,1)},transpose:function(t){return t.copy().transpose()},inverse:function(t){return t.copy().inverse()},multLeft:function(t,e){return t.copy().multLeft(e)},multRight:function(t,e){return t.copy().multRight(e)}});const Ne=new Oe,Fe=Oe;n.set("standard/Math/Numbers/Matrix3",Fe);const Ie=Fe;function Me(t,e,n,i){function o(t,e,n,i,o,r,s,a,u){switch(arguments.length){case 0:return lt.call(this,new Ie);case 1:return lt.call(this,arguments[0]);case 3:{const t=arguments[0],e=arguments[1],n=arguments[2];return lt.call(this,new Ie(t.x,t.y,t.z,e.x,e.y,e.z,n.x,n.y,n.z))}case 9:return lt.call(this,new Ie(+t,+e,+n,+i,+o,+r,+s,+a,+u))}throw new Error("Invalid arguments.")}o.prototype=Object.assign(Object.create(lt.prototype),ae(t,e,Ie,n,i),{constructor:o,setTransform:function(t,e,n,i,o){t=t?t.getValue():null,e=e||0,n=n?n.getValue():null,i=i||0,o=o?o.getValue():null,this.getValue().set(t,e,n,i,o)}});for(const t of Reflect.ownKeys(o.prototype))Object.defineProperty(o.prototype,t,{enumerable:!1});function r(t){Object.defineProperty(o.prototype,t,{get:function(){return this.getValue()[t]},set:function(e){this.getValue()[t]=+e,this.addEvent()},enumerable:!0,configurable:!1})}for(let t=0,e=Ie.prototype.length;t<e;++t)r(t);return o}const De={SFMatrix3d:Me("SFMatrix3d",c.SFMatrix3d,ge.SFVec2d,!0),SFMatrix3f:Me("SFMatrix3f",c.SFMatrix3f,ge.SFVec2f,!1)};n.set("x_ite/Fields/SFMatrix3",De);const Ve=De;function Re(t,e,n){function i(t,e,n){switch(arguments.length){case 0:return lt.call(this,new xe(0,0,0));case 1:return lt.call(this,arguments[0]);case 3:return lt.call(this,new xe(+t,+e,+n))}throw new Error("Invalid arguments.")}i.prototype=Object.assign(Object.create(lt.prototype),ce(t,e,xe,n),{constructor:i,cross:function(t){return new this.constructor(xe.cross(this.getValue(),t.getValue()))}});for(const t of Reflect.ownKeys(i.prototype))Object.defineProperty(i.prototype,t,{enumerable:!1});const o={get:function(){return this.getValue().x},set:function(t){this.getValue().x=+t,this.addEvent()},enumerable:!0,configurable:!1},r={get:function(){return this.getValue().y},set:function(t){this.getValue().y=+t,this.addEvent()},enumerable:!0,configurable:!1},s={get:function(){return this.getValue().z},set:function(t){this.getValue().z=+t,this.addEvent()},enumerable:!0,configurable:!1};return Object.defineProperty(i.prototype,"x",o),Object.defineProperty(i.prototype,"y",r),Object.defineProperty(i.prototype,"z",s),o.enumerable=!1,r.enumerable=!1,s.enumerable=!1,Object.defineProperty(i.prototype,"0",o),Object.defineProperty(i.prototype,"1",r),Object.defineProperty(i.prototype,"2",s),i}const Pe={SFVec3d:Re("SFVec3d",c.SFVec3d,!0),SFVec3f:Re("SFVec3f",c.SFVec3f,!1)};n.set("x_ite/Fields/SFVec3",Pe);const Ae=Pe;function Le(t,e,n,i){this.x=t,this.y=e,this.z=n,this.w=i}Le.prototype={constructor:Le,length:4,[Symbol.iterator]:function*(){yield this.x,yield this.y,yield this.z,yield this.w},copy:function(){const t=Object.create(Le.prototype);return t.x=this.x,t.y=this.y,t.z=this.z,t.w=this.w,t},assign:function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w,this},set:function(t,e,n,i){return this.x=t,this.y=e,this.z=n,this.w=i,this},equals:function(t){return this.x===t.x&&this.y===t.y&&this.z===t.z&&this.w===t.w},getReal:function(t){t.x=this.x/this.w,t.y=this.y/this.w,t.z=this.z/this.w},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this},inverse:function(){return this.x=1/this.x,this.y=1/this.y,this.z=1/this.z,this.w=1/this.w,this},add:function(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this},subtract:function(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this.w-=t.w,this},multiply:function(t){return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this},multVec:function(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this.w*=t.w,this},divide:function(t){return this.x/=t,this.y/=t,this.z/=t,this.w/=t,this},divVec:function(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this.w/=t.w,this},normalize:function(){const t=Math.hypot(this.x,this.y,this.z,this.w);return t&&(this.x/=t,this.y/=t,this.z/=t,this.w/=t),this},dot:function(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w},norm:function(){const t=this.x,e=this.y,n=this.z,i=this.w;return t*t+e*e+n*n+i*i},magnitude:function(){return Math.hypot(this.x,this.y,this.z,this.w)},distance:function(t){return Math.hypot(this.x-t.x,this.y-t.y,this.z-t.z,this.w-t.w)},lerp:function(t,e){const n=this.x,i=this.y,o=this.z,r=this.w;return this.x=n+e*(t.x-n),this.y=i+e*(t.y-i),this.z=o+e*(t.z-o),this.w=r+e*(t.w-r),this},abs:function(){return this.x=Math.abs(this.x),this.y=Math.abs(this.y),this.z=Math.abs(this.z),this.w=Math.abs(this.w),this},min:function(t){let e=this.x,n=this.y,i=this.z,o=this.w;for(const t of arguments)e=Math.min(e,t.x),n=Math.min(n,t.y),i=Math.min(i,t.z),o=Math.min(o,t.w);return this.x=e,this.y=n,this.z=i,this.w=o,this},max:function(t){let e=this.x,n=this.y,i=this.z,o=this.w;for(const t of arguments)e=Math.max(e,t.x),n=Math.max(n,t.y),i=Math.max(i,t.z),o=Math.max(o,t.w);return this.x=e,this.y=n,this.z=i,this.w=o,this},toString:function(){return this.x+" "+this.y+" "+this.z+" "+this.w}},Object.defineProperty(Le.prototype,"0",{get:function(){return this.x},set:function(t){this.x=t},enumerable:!1,configurable:!1}),Object.defineProperty(Le.prototype,"1",{get:function(){return this.y},set:function(t){this.y=t},enumerable:!1,configurable:!1}),Object.defineProperty(Le.prototype,"2",{get:function(){return this.z},set:function(t){this.z=t},enumerable:!1,configurable:!1}),Object.defineProperty(Le.prototype,"3",{get:function(){return this.w},set:function(t){this.w=t},enumerable:!1,configurable:!1}),Object.assign(Le,{Zero:new Le(0,0,0,0),One:new Le(1,1,1,1),xAxis:new Le(1,0,0,0),yAxis:new Le(0,1,0,0),zAxis:new Le(0,0,1,0),wAxis:new Le(0,0,0,1),negate:function(t){return t.copy().negate()},inverse:function(t){return t.copy().inverse()},add:function(t,e){return t.copy().add(e)},subtract:function(t,e){return t.copy().subtract(e)},multiply:function(t,e){return t.copy().multiply(e)},multVec:function(t,e){return t.copy().multVec(e)},divide:function(t,e){return t.copy().divide(e)},divVec:function(t,e){return t.copy().divVec(e)},normalize:function(t){return t.copy().normalize()},dot:function(t,e){return t.dot(e)},magnitude:function(t){return t.magnitude()},distance:function(t,e){return t.distance(e)},lerp:function(t,e,n){return t.copy().lerp(e,n)},abs:function(t){return t.copy().abs()},min:function(t,e){return this.prototype.min.apply(t.copy(),arguments)},max:function(t,e){return this.prototype.max.apply(t.copy(),arguments)}});const Be=Le;n.set("standard/Math/Numbers/Vector4",Be);const Xe=Be;function Ue(t,e,n,i){this.x=t,this.y=e,this.z=n,this.w=i}Ue.prototype={constructor:Ue,length:4,[Symbol.iterator]:function*(){yield this.x,yield this.y,yield this.z,yield this.w},copy:function(){const t=Object.create(Ue.prototype);return t.x=this.x,t.y=this.y,t.z=this.z,t.w=this.w,t},assign:function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w,this},set:function(t,e,n,i){return this.x=t,this.y=e,this.z=n,this.w=i,this},setMatrix:function(t){let e;e=t[0]>t[4]?t[0]>t[8]?0:2:t[4]>t[8]?1:2;const n=t[0]+t[4]+t[8];if(n>t[3*e+e]){this[3]=Math.sqrt(n+1)/2;const e=4*this[3];this[0]=(t[5]-t[7])/e,this[1]=(t[6]-t[2])/e,this[2]=(t[1]-t[3])/e}else{const n=(e+1)%3,i=(e+2)%3;this[e]=Math.sqrt(t[3*e+e]-t[3*n+n]-t[3*i+i]+1)/2;const o=4*this[e];this[n]=(t[3*e+n]+t[3*n+e])/o,this[i]=(t[3*e+i]+t[3*i+e])/o,this[3]=(t[3*n+i]-t[3*i+n])/o}return this},getMatrix:function(t){const e=this.x,n=this.y,i=this.z,o=this.w,r=e*e,s=e*n,a=n*n,u=n*i,c=i*e,l=i*i,h=o*e,d=o*n,p=o*i;return t[0]=1-2*(a+l),t[1]=2*(s+p),t[2]=2*(c-d),t[3]=2*(s-p),t[4]=1-2*(l+r),t[5]=2*(u+h),t[6]=2*(c+d),t[7]=2*(u-h),t[8]=1-2*(a+r),t},isReal:function(){return!(this.x||this.y||this.z)},isImag:function(){return!this.w},equals:function(t){return this.x===t.x&&this.y===t.y&&this.z===t.z&&this.w===t.w},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this},inverse:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},add:function(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this},subtract:function(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this.w-=t.w,this},multiply:function(t){return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this},multLeft:function(t){const e=this.x,n=this.y,i=this.z,o=this.w,r=t.x,s=t.y,a=t.z,u=t.w;return this.x=o*r+e*u+n*a-i*s,this.y=o*s+n*u+i*r-e*a,this.z=o*a+i*u+e*s-n*r,this.w=o*u-e*r-n*s-i*a,this},multRight:function(t){const e=this.x,n=this.y,i=this.z,o=this.w,r=t.x,s=t.y,a=t.z,u=t.w;return this.x=u*e+r*o+s*i-a*n,this.y=u*n+s*o+a*e-r*i,this.z=u*i+a*o+r*n-s*e,this.w=u*o-r*e-s*n-a*i,this},divide:function(t){return this.x/=t,this.y/=t,this.z/=t,this.w/=t,this},multVecQuat:function(t){const e=this.x,n=this.y,i=this.z,o=this.w,r=t.x,s=t.y,a=t.z,u=o*o-e*e-n*n-i*i,c=2*(r*e+s*n+a*i),l=2*o;return t.x=u*r+c*e+l*(n*a-i*s),t.y=u*s+c*n+l*(i*r-e*a),t.z=u*a+c*i+l*(e*s-n*r),t},multQuatVec:function(t){const e=this.x,n=this.y,i=this.z,o=this.w,r=t.x,s=t.y,a=t.z,u=o*o-e*e-n*n-i*i,c=2*(r*e+s*n+a*i),l=2*o;return t.x=u*r+c*e-l*(n*a-i*s),t.y=u*s+c*n-l*(i*r-e*a),t.z=u*a+c*i-l*(e*s-n*r),t},normalize:function(){let t=Math.hypot(this.x,this.y,this.z,this.w);return t&&(t=1/t,this.x*=t,this.y*=t,this.z*=t,this.w*=t),this},dot:function(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w},norm:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},magnitude:function(){return Math.hypot(this.x,this.y,this.z,this.w)},pow:function(t){if(t instanceof Ue)return this.assign(e.assign(t).multRight(this.log()).exp());if(this.isReal())return this.set(0,0,0,Math.pow(this.w,t));const n=this.magnitude(),i=Math.acos(this.w/n),o=this.imag.magnitude(),r=Math.pow(n,t),s=t*i,a=r/o*Math.sin(s);return this.x*=a,this.y*=a,this.z*=a,this.w=r*Math.cos(s),this},log:function(){if(this.isReal())return this.w>0?this.set(0,0,0,Math.log(this.w)):this.set(Math.PI,0,0,Math.log(-this.w));const t=this.magnitude(),e=this.imag.normalize().multiply(Math.acos(this.w/t)),n=Math.log(t);return this.x=e.x,this.y=e.y,this.z=e.z,this.w=n,this},exp:function(){if(this.isReal())return this.set(0,0,0,Math.exp(this.w));const t=this.imag,e=t.magnitude(),n=Math.exp(this.w),i=n*Math.cos(e),o=t.multiply(n*Math.sin(e)/e);return this.x=o.x,this.y=o.y,this.z=o.z,this.w=i,this},slerp:function(t,e){return gt.slerp(this,ke.assign(t),e)},squad:function(t,e,n,i){return gt.slerp(gt.slerp(this,ke.assign(n),i),gt.slerp(ze.assign(t),je.assign(e),i),2*i*(1-i))},toString:function(){return this.x+" "+this.y+" "+this.z+" "+this.w}},Object.defineProperty(Ue.prototype,"0",{get:function(){return this.x},set:function(t){this.x=t},enumerable:!1,configurable:!1}),Object.defineProperty(Ue.prototype,"1",{get:function(){return this.y},set:function(t){this.y=t},enumerable:!1,configurable:!1}),Object.defineProperty(Ue.prototype,"2",{get:function(){return this.z},set:function(t){this.z=t},enumerable:!1,configurable:!1}),Object.defineProperty(Ue.prototype,"3",{get:function(){return this.w},set:function(t){this.w=t},enumerable:!1,configurable:!1}),Object.defineProperty(Ue.prototype,"real",{get:function(){return this.w},enumerable:!1,configurable:!1}),Object.defineProperty(Ue.prototype,"imag",{get:function(){const t=new xe(0,0,0);return function(){return t.set(this.x,this.y,this.z)}}(),enumerable:!1,configurable:!1}),Object.assign(Ue,{negate:function(t){return t.copy().negate()},inverse:function(t){return t.copy().inverse()},add:function(t,e){return t.copy().add(e)},subtract:function(t,e){return t.copy().subtract(e)},multiply:function(t,e){return t.copy().multiply(e)},multLeft:function(t,e){return t.copy().multLeft(e)},multRight:function(t,e){return t.copy().multRight(e)},divide:function(t,e){return t.copy().divide(e)},normalize:function(t){return t.copy().normalize()},slerp:function(t,e,n){return t.copy().slerp(e,n)},squad:function(t,e,n,i,o){return t.copy().squad(e,n,i,o)},spline:function(t,e,n){return Ge.assign(t),He.assign(e),qe.assign(n),Ge.dot(He)<0&&Ge.negate(),qe.dot(He)<0&&qe.negate(),Ye.assign(He).inverse(),He.multRight(ke.assign(Ye).multRight(Ge).log().add(ze.assign(Ye).multRight(qe).log()).divide(-4).exp()).normalize().copy()}});const ke=new Ue(0,0,0,1),ze=new Ue(0,0,0,1),je=new Ue(0,0,0,1),Ge=new Ue(0,0,0,1),He=new Ue(0,0,0,1),qe=new Ue(0,0,0,1),Ye=new Ue(0,0,0,1),We=Ue;n.set("standard/Math/Numbers/Quaternion",We);const Ke=We,Je=Symbol(),Ze=Symbol(),Qe=Symbol(),$e=Symbol();function tn(t,e,n,i){switch(this[Je]=0,this[Ze]=0,this[Qe]=1,this[$e]=0,arguments.length){case 0:return void(this.value=new Ke(0,0,0,1));case 1:return this.value=arguments[0],void this.update();case 2:{const t=arguments[0],e=arguments[1];return this.value=new Ke(0,0,0,1),e instanceof xe?this.setFromToVec(t,e):void this.set(t.x,t.y,t.z,e)}case 4:return this.value=new Ke(0,0,0,1),void this.set(t,e,n,i)}}tn.prototype={constructor:tn,length:4,[Symbol.iterator]:function*(){yield this[Je],yield this[Ze],yield this[Qe],yield this[$e]},update:function(){const t=this.get();return this[Je]=t.x,this[Ze]=t.y,this[Qe]=t.z,this[$e]=t.w,this},copy:function(){const t=Object.create(tn.prototype);return t[Je]=this[Je],t[Ze]=this[Ze],t[Qe]=this[Qe],t[$e]=this[$e],t.value=this.value.copy(),t},assign:function(t){return this[Je]=t[Je],this[Ze]=t[Ze],this[Qe]=t[Qe],this[$e]=t[$e],this.value.assign(t.value),this},set:function(t,e,n,i){this[Je]=t,this[Ze]=e,this[Qe]=n,this[$e]=i;const o=Math.hypot(t,e,n);if(0===o)return this.value.set(0,0,0,1),this;const r=gt.interval(i/2,0,Math.PI),s=Math.sin(r)/o;return this.value.set(t*s,e*s,n*s,Math.cos(r)),this},get:function(){const t=new Xe(0,0,0,0);return function(){const e=this.value;if(Math.abs(e.w)>1)return Xe.zAxis;{const n=2*Math.acos(e.w),i=Math.sin(n/2);if(0===i)return Xe.zAxis;{const o=e.imag.divide(i);return t.set(o.x,o.y,o.z,n)}}}}(),setAxisAngle:function(t,e){return this.set(t.x,t.y,t.z,e)},setFromToVec:function(){const t=new xe(0,0,0),e=new xe(0,0,0),n=new xe(0,0,0),i=new xe(0,0,0);return function(o,r){t.assign(o).normalize(),e.assign(r).normalize();const s=gt.clamp(t.dot(e),-1,1),a=n.assign(t).cross(e).normalize();return 0===a.magnitude()?s>0?this.value.set(0,0,0,1):(i.assign(t).cross(xe.xAxis),0===i.norm()&&i.assign(t).cross(xe.yAxis),i.normalize(),this.value.set(i.x,i.y,i.z,0)):(a.multiply(Math.sqrt(Math.abs(1-s)/2)),this.value.set(a.x,a.y,a.z,Math.sqrt(Math.abs(1+s)/2))),this.update(),this}}(),setAxis:function(t){this.set(t.x,t.y,t.z,this[$e])},getAxis:function(){const t=new xe(0,0,0);return function(){return t.set(this[Je],this[Ze],this[Qe])}}(),setMatrix:function(t){return this.value.setMatrix(t).normalize(),this.update(),this},getMatrix:function(t){return this.value.getMatrix(t)},equals:function(t){return this.value.equals(t.value)},inverse:function(){return this.value.inverse(),this.update(),this},multLeft:function(t){return this.value.multLeft(t.value).normalize(),this.update(),this},multRight:function(t){return this.value.multRight(t.value).normalize(),this.update(),this},multVecRot:function(t){return this.value.multVecQuat(t)},multRotVec:function(t){return this.value.multQuatVec(t)},normalize:function(){return this.value.normalize(),this.update(),this},pow:function(t){return this.value.pow(t),this.update(),this},slerp:function(t,e){return this.value.slerp(t.value,e),this.update(),this},squad:function(t,e,n,i){return this.value.squad(t.value,e.value,n.value,i),this.update(),this},toString:function(){return this[Je]+" "+this[Ze]+" "+this[Qe]+" "+this[$e]}};const en={get:function(){return this[Je]},set:function(t){this[Je]=t,this.set(t,this[Ze],this[Qe],this[$e])},enumerable:!0,configurable:!1},nn={get:function(){return this[Ze]},set:function(t){this[Ze]=t,this.set(this[Je],t,this[Qe],this[$e])},enumerable:!0,configurable:!1},on={get:function(){return this[Qe]},set:function(t){this[Qe]=t,this.set(this[Je],this[Ze],t,this[$e])},enumerable:!0,configurable:!1},rn={get:function(){return this[$e]},set:function(t){this[$e]=t,this.set(this[Je],this[Ze],this[Qe],t)},enumerable:!0,configurable:!1};Object.defineProperty(tn.prototype,"x",en),Object.defineProperty(tn.prototype,"y",nn),Object.defineProperty(tn.prototype,"z",on),Object.defineProperty(tn.prototype,"angle",rn),en.enumerable=!1,nn.enumerable=!1,on.enumerable=!1,rn.enumerable=!1,Object.defineProperty(tn.prototype,"0",en),Object.defineProperty(tn.prototype,"1",nn),Object.defineProperty(tn.prototype,"2",on),Object.defineProperty(tn.prototype,"3",rn),Object.assign(tn,{Identity:new tn,inverse:function(t){return t.copy().inverse()},multRight:function(t,e){return t.copy().multRight(e)},normalize:function(t){return t.copy().normalize()},slerp:function(t,e,n){return t.copy().slerp(e,n)},squad:function(t,e,n,i,o){return t.copy().squad(e,n,i,o)},spline:function(t,e,n){const i=Object.create(this.prototype);return i.value=Ke.spline(t.value,e.value,n.value),i.update(),i}});const sn=tn;n.set("standard/Math/Numbers/Rotation4",sn);const an=sn;function un(){arguments.length?(this[0]=arguments[0],this[1]=arguments[1],this[2]=arguments[2],this[3]=arguments[3],this[4]=arguments[4],this[5]=arguments[5],this[6]=arguments[6],this[7]=arguments[7],this[8]=arguments[8],this[9]=arguments[9],this[10]=arguments[10],this[11]=arguments[11],this[12]=arguments[12],this[13]=arguments[13],this[14]=arguments[14],this[15]=arguments[15]):this.identity()}un.prototype={constructor:un,order:4,length:16,[Symbol.iterator]:function*(){const t=this.length;for(let e=0;e<t;++e)yield this[e]},copy:function(){const t=Object.create(un.prototype);return t[0]=this[0],t[1]=this[1],t[2]=this[2],t[3]=this[3],t[4]=this[4],t[5]=this[5],t[6]=this[6],t[7]=this[7],t[8]=this[8],t[9]=this[9],t[10]=this[10],t[11]=this[11],t[12]=this[12],t[13]=this[13],t[14]=this[14],t[15]=this[15],t},assign:function(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this[3]=t[3],this[4]=t[4],this[5]=t[5],this[6]=t[6],this[7]=t[7],this[8]=t[8],this[9]=t[9],this[10]=t[10],this[11]=t[11],this[12]=t[12],this[13]=t[13],this[14]=t[14],this[15]=t[15],this},equals:function(t){return this[0]===t[0]&&this[1]===t[1]&&this[2]===t[2]&&this[3]===t[3]&&this[4]===t[4]&&this[5]===t[5]&&this[6]===t[6]&&this[7]===t[7]&&this[8]===t[8]&&this[9]===t[9]&&this[10]===t[10]&&this[11]===t[11]&&this[12]===t[12]&&this[13]===t[13]&&this[14]===t[14]&&this[15]===t[15]},set1:function(t,e,n){return this[t*this.order+e]=n,this},get1:function(t,e){return this[t*this.order+e]},set:function(){const t=new an,e=new xe(0,0,0);return function(n,i,o,r,s){switch(arguments.length){case 0:this.identity();break;case 1:null===n&&(n=xe.Zero),this.identity(),this.translate(n);break;case 2:null===n&&(n=xe.Zero),null===i&&(i=an.Identity),this.identity(),this.translate(n),i.equals(an.Identity)||this.rotate(i);break;case 3:null===n&&(n=xe.Zero),null===i&&(i=an.Identity),null===o&&(o=xe.One),this.identity(),this.translate(n),i.equals(an.Identity)||this.rotate(i),o.equals(xe.One)||this.scale(o);break;case 4:if(null===n&&(n=xe.Zero),null===i&&(i=an.Identity),null===o&&(o=xe.One),null===r&&(r=an.Identity),this.identity(),this.translate(n),i.equals(an.Identity)||this.rotate(i),!o.equals(xe.One)){!r.equals(an.Identity)?(this.rotate(r),this.scale(o),this.rotate(t.assign(r).inverse())):this.scale(o)}break;case 5:{null===n&&(n=xe.Zero),null===i&&(i=an.Identity),null===o&&(o=xe.One),null===r&&(r=an.Identity),null===s&&(s=xe.Zero),this.identity(),this.translate(n);const a=!s.equals(xe.Zero);a&&this.translate(s),i.equals(an.Identity)||this.rotate(i),o.equals(xe.One)||(r.equals(an.Identity)?this.scale(o):(this.rotate(r),this.scale(o),this.rotate(t.assign(r).inverse()))),a&&this.translate(e.assign(s).negate());break}case 16:this[0]=arguments[0],this[1]=arguments[1],this[2]=arguments[2],this[3]=arguments[3],this[4]=arguments[4],this[5]=arguments[5],this[6]=arguments[6],this[7]=arguments[7],this[8]=arguments[8],this[9]=arguments[9],this[10]=arguments[10],this[11]=arguments[11],this[12]=arguments[12],this[13]=arguments[13],this[14]=arguments[14],this[15]=arguments[15]}return this}}(),get:function(){const t=new xe(0,0,0),e=new an,n=new xe(0,0,0),i=new an,o=new xe(0,0,0),r=new Ie,s=new Ie,a=new xe(0,0,0);return function(u,c,l,h,d){switch(null===u&&(u=t),null===c&&(c=e),null===l&&(l=n),null===h&&(h=i),null===d&&(d=o),arguments.length){case 1:u.set(this[12],this[13],this[14]);break;case 2:this.factor(u,r,n,s),c.setMatrix(r);break;case 3:this.factor(u,r,l,s),c.setMatrix(r);break;case 4:this.factor(u,r,l,s),c.setMatrix(r),h.setMatrix(s);break;case 5:cn.set(a.assign(d).negate()),cn.multLeft(this),cn.translate(d),cn.get(u,c,l,h)}}}(),setRotation:function(t){return this.setQuaternion(t.value)},setQuaternion:function(t){const e=t.x,n=t.y,i=t.z,o=t.w,r=n*n,s=i*i,a=e*n,u=i*o,c=i*e,l=n*o,h=e*e,d=n*i,p=e*o;return this[0]=1-2*(r+s),this[1]=2*(a+u),this[2]=2*(c-l),this[3]=0,this[4]=2*(a-u),this[5]=1-2*(s+h),this[6]=2*(d+p),this[7]=0,this[8]=2*(c+l),this[9]=2*(d-p),this[10]=1-2*(r+h),this[11]=0,this[12]=0,this[13]=0,this[14]=0,this[15]=1,this},factor:function(){const t=new Ie,e=new Ie,n=new Ie,i={values:[],vectors:[[],[],[]]};return function(o,r,s,a){o.set(this[12],this[13],this[14]);const u=this.submatrix,c=u.determinant()<0?-1:1;n.assign(u).transpose().multLeft(u);const l=Ee(n,i);a.set(l.vectors[0][0],l.vectors[1][0],l.vectors[2][0],l.vectors[0][1],l.vectors[1][1],l.vectors[2][1],l.vectors[0][2],l.vectors[1][2],l.vectors[2][2]),s.x=c*Math.sqrt(l.values[0]),s.y=c*Math.sqrt(l.values[1]),s.z=c*Math.sqrt(l.values[2]),t[0]=1/s.x,t[4]=1/s.y,t[8]=1/s.z,r.assign(e.assign(a).transpose().multRight(t).multRight(a).multRight(u))}}(),determinant3:function(){const t=this[0],e=this[1],n=this[2],i=this[4],o=this[5],r=this[6],s=this[8],a=this[9],u=this[10];return t*(o*u-r*a)-e*(i*u-r*s)+n*(i*a-o*s)},determinant:function(){const t=this[0],e=this[1],n=this[2],i=this[3],o=this[4],r=this[5],s=this[6],a=this[7],u=this[8],c=this[9],l=this[10],h=this[11],d=this[12],p=this[13],f=this[14],g=this[15],m=l*g,_=f*h,x=s*g,y=f*a,w=s*h,S=l*a,T=n*g,b=f*i,v=n*h,C=l*i,E=n*a,O=s*i;return t*(m*r+y*c+w*p-_*r-x*c-S*p)+o*(_*e+T*c+C*p-m*e-b*c-v*p)+u*(x*e+b*r+E*p-y*e-T*r-O*p)+d*(S*e+v*r+O*c-w*e-C*r-E*c)},transpose:function(){let t;return t=this[1],this[1]=this[4],this[4]=t,t=this[2],this[2]=this[8],this[8]=t,t=this[3],this[3]=this[12],this[12]=t,t=this[6],this[6]=this[9],this[9]=t,t=this[7],this[7]=this[13],this[13]=t,t=this[11],this[11]=this[14],this[14]=t,this},inverse:function(){const t=this[0],e=this[1],n=this[2],i=this[3],o=this[4],r=this[5],s=this[6],a=this[7],u=this[8],c=this[9],l=this[10],h=this[11],d=this[12],p=this[13],f=this[14],g=this[15],m=l*g,_=f*h,x=s*g,y=f*a,w=s*h,S=l*a,T=n*g,b=f*i,v=n*h,C=l*i,E=n*a,O=s*i,N=u*p,F=d*c,I=o*p,M=d*r,D=o*c,V=u*r,R=t*p,P=d*e,A=t*c,L=u*e,B=t*r,X=o*e,U=m*r+y*c+w*p-(_*r+x*c+S*p),k=_*e+T*c+C*p-(m*e+b*c+v*p),z=x*e+b*r+E*p-(y*e+T*r+O*p),j=S*e+v*r+O*c-(w*e+C*r+E*c);let G=t*U+o*k+u*z+d*j;return G=1/G,this[0]=G*U,this[1]=G*k,this[2]=G*z,this[3]=G*j,this[4]=G*(_*o+x*u+S*d-m*o-y*u-w*d),this[5]=G*(m*t+b*u+v*d-_*t-T*u-C*d),this[6]=G*(y*t+T*o+O*d-x*t-b*o-E*d),this[7]=G*(w*t+C*o+E*u-S*t-v*o-O*u),this[8]=G*(N*a+M*h+D*g-F*a-I*h-V*g),this[9]=G*(F*i+R*h+L*g-N*i-P*h-A*g),this[10]=G*(I*i+P*a+B*g-M*i-R*a-X*g),this[11]=G*(V*i+A*a+X*h-D*i-L*a-B*h),this[12]=G*(I*l+V*f+F*s-D*f-N*s-M*l),this[13]=G*(A*f+N*n+P*l-R*l-L*f-F*n),this[14]=G*(R*s+X*f+M*n-B*f-I*n-P*s),this[15]=G*(B*l+D*n+L*s-A*s-X*l-V*n),this},multLeft:function(t){const e=this[0],n=this[1],i=this[2],o=this[3],r=this[4],s=this[5],a=this[6],u=this[7],c=this[8],l=this[9],h=this[10],d=this[11],p=this[12],f=this[13],g=this[14],m=this[15],_=t[0],x=t[1],y=t[2],w=t[3],S=t[4],T=t[5],b=t[6],v=t[7],C=t[8],E=t[9],O=t[10],N=t[11],F=t[12],I=t[13],M=t[14],D=t[15];return this[0]=e*_+r*x+c*y+p*w,this[1]=n*_+s*x+l*y+f*w,this[2]=i*_+a*x+h*y+g*w,this[3]=o*_+u*x+d*y+m*w,this[4]=e*S+r*T+c*b+p*v,this[5]=n*S+s*T+l*b+f*v,this[6]=i*S+a*T+h*b+g*v,this[7]=o*S+u*T+d*b+m*v,this[8]=e*C+r*E+c*O+p*N,this[9]=n*C+s*E+l*O+f*N,this[10]=i*C+a*E+h*O+g*N,this[11]=o*C+u*E+d*O+m*N,this[12]=e*F+r*I+c*M+p*D,this[13]=n*F+s*I+l*M+f*D,this[14]=i*F+a*I+h*M+g*D,this[15]=o*F+u*I+d*M+m*D,this},multRight:function(t){const e=this[0],n=this[1],i=this[2],o=this[3],r=this[4],s=this[5],a=this[6],u=this[7],c=this[8],l=this[9],h=this[10],d=this[11],p=this[12],f=this[13],g=this[14],m=this[15],_=t[0],x=t[1],y=t[2],w=t[3],S=t[4],T=t[5],b=t[6],v=t[7],C=t[8],E=t[9],O=t[10],N=t[11],F=t[12],I=t[13],M=t[14],D=t[15];return this[0]=e*_+n*S+i*C+o*F,this[1]=e*x+n*T+i*E+o*I,this[2]=e*y+n*b+i*O+o*M,this[3]=e*w+n*v+i*N+o*D,this[4]=r*_+s*S+a*C+u*F,this[5]=r*x+s*T+a*E+u*I,this[6]=r*y+s*b+a*O+u*M,this[7]=r*w+s*v+a*N+u*D,this[8]=c*_+l*S+h*C+d*F,this[9]=c*x+l*T+h*E+d*I,this[10]=c*y+l*b+h*O+d*M,this[11]=c*w+l*v+h*N+d*D,this[12]=p*_+f*S+g*C+m*F,this[13]=p*x+f*T+g*E+m*I,this[14]=p*y+f*b+g*O+m*M,this[15]=p*w+f*v+g*N+m*D,this},multVecMatrix:function(t){if(3===t.length){const e=t.x,n=t.y,i=t.z,o=1/(e*this[3]+n*this[7]+i*this[11]+this[15]);return t.x=(e*this[0]+n*this[4]+i*this[8]+this[12])*o,t.y=(e*this[1]+n*this[5]+i*this[9]+this[13])*o,t.z=(e*this[2]+n*this[6]+i*this[10]+this[14])*o,t}const e=t.x,n=t.y,i=t.z,o=t.w;return t.x=e*this[0]+n*this[4]+i*this[8]+o*this[12],t.y=e*this[1]+n*this[5]+i*this[9]+o*this[13],t.z=e*this[2]+n*this[6]+i*this[10]+o*this[14],t.w=e*this[3]+n*this[7]+i*this[11]+o*this[15],t},multMatrixVec:function(t){if(3===t.length){const e=t.x,n=t.y,i=t.z,o=1/(e*this[12]+n*this[13]+i*this[14]+this[15]);return t.x=(e*this[0]+n*this[1]+i*this[2]+this[3])*o,t.y=(e*this[4]+n*this[5]+i*this[6]+this[7])*o,t.z=(e*this[8]+n*this[9]+i*this[10]+this[11])*o,t}const e=t.x,n=t.y,i=t.z,o=t.w;return t.x=e*this[0]+n*this[1]+i*this[2]+o*this[3],t.y=e*this[4]+n*this[5]+i*this[6]+o*this[7],t.z=e*this[8]+n*this[9]+i*this[10]+o*this[11],t.w=e*this[12]+n*this[13]+i*this[14]+o*this[15],t},multDirMatrix:function(t){const e=t.x,n=t.y,i=t.z;return t.x=e*this[0]+n*this[4]+i*this[8],t.y=e*this[1]+n*this[5]+i*this[9],t.z=e*this[2]+n*this[6]+i*this[10],t},multMatrixDir:function(t){const e=t.x,n=t.y,i=t.z;return t.x=e*this[0]+n*this[1]+i*this[2],t.y=e*this[4]+n*this[5]+i*this[6],t.z=e*this[8]+n*this[9]+i*this[10],t},identity:function(){this[0]=1,this[1]=0,this[2]=0,this[3]=0,this[4]=0,this[5]=1,this[6]=0,this[7]=0,this[8]=0,this[9]=0,this[10]=1,this[11]=0,this[12]=0,this[13]=0,this[14]=0,this[15]=1},translate:function(t){const e=t.x,n=t.y,i=t.z;return this[12]+=this[0]*e+this[4]*n+this[8]*i,this[13]+=this[1]*e+this[5]*n+this[9]*i,this[14]+=this[2]*e+this[6]*n+this[10]*i,this},rotate:function(t){return this.multLeft(cn.setQuaternion(t.value)),this},scale:function(t){const e=t.x,n=t.y,i=t.z;return this[0]*=e,this[4]*=n,this[8]*=i,this[1]*=e,this[5]*=n,this[9]*=i,this[2]*=e,this[6]*=n,this[10]*=i,this},getDepth:function(t){const e=t.x,n=t.y,i=t.z,o=1/(e*this[3]+n*this[7]+i*this[11]+this[15]);return(e*this[2]+n*this[6]+i*this[10]+this[14])*o},toString:function(){return this[0]+" "+this[1]+" "+this[2]+" "+this[3]+" "+this[4]+" "+this[5]+" "+this[6]+" "+this[7]+" "+this[8]+" "+this[9]+" "+this[10]+" "+this[11]+" "+this[12]+" "+this[13]+" "+this[14]+" "+this[15]}},Object.defineProperty(un.prototype,"x",{get:function(){const t=new Xe(0,0,0,0);return function(){return t.set(this[0],this[1],this[2],this[3])}}(),enumerable:!1,configurable:!1}),Object.defineProperty(un.prototype,"y",{get:function(){const t=new Xe(0,0,0,0);return function(){return t.set(this[4],this[5],this[6],this[7])}}(),enumerable:!1,configurable:!1}),Object.defineProperty(un.prototype,"z",{get:function(){const t=new Xe(0,0,0,0);return function(){return t.set(this[8],this[9],this[10],this[11])}}(),enumerable:!1,configurable:!1}),Object.defineProperty(un.prototype,"w",{get:function(){const t=new Xe(0,0,0,0);return function(){return t.set(this[12],this[13],this[14],this[15])}}(),enumerable:!1,configurable:!1}),Object.defineProperty(un.prototype,"xAxis",{get:function(){const t=new xe(0,0,0);return function(){return t.set(this[0],this[1],this[2])}}(),enumerable:!1,configurable:!1}),Object.defineProperty(un.prototype,"yAxis",{get:function(){const t=new xe(0,0,0);return function(){return t.set(this[4],this[5],this[6])}}(),enumerable:!1,configurable:!1}),Object.defineProperty(un.prototype,"zAxis",{get:function(){const t=new xe(0,0,0);return function(){return t.set(this[8],this[9],this[10])}}(),enumerable:!1,configurable:!1}),Object.defineProperty(un.prototype,"origin",{get:function(){const t=new xe(0,0,0);return function(){return t.set(this[12],this[13],this[14])}}(),enumerable:!1,configurable:!1}),Object.defineProperty(un.prototype,"submatrix",{get:function(){const t=new Ie;return function(){return t[0]=this[0],t[1]=this[1],t[2]=this[2],t[3]=this[4],t[4]=this[5],t[5]=this[6],t[6]=this[8],t[7]=this[9],t[8]=this[10],t}}(),enumerable:!1,configurable:!1}),Object.assign(un,{Identity:new un,Rotation:function(t){return Object.create(this.prototype).setQuaternion(t.value)},Quaternion:function(t){return Object.create(this.prototype).setQuaternion(t)},Matrix3:function(t){return new un(t[0],t[1],t[2],0,t[3],t[4],t[5],0,t[6],t[7],t[8],0,0,0,0,1)},transpose:function(t){return t.copy().transpose()},inverse:function(t){return t.copy().inverse()},multLeft:function(t,e){return t.copy().multLeft(e)},multRight:function(t,e){return t.copy().multRight(e)}});const cn=new un,ln=un;n.set("standard/Math/Numbers/Matrix4",ln);const hn=ln;function dn(t,e,n,i){function o(t,e,n,i,o,r,s,a,u,c,l,h,d,p,f,g){switch(arguments.length){case 0:return lt.call(this,new hn);case 1:return lt.call(this,arguments[0]);case 4:{const t=arguments[0],e=arguments[1],n=arguments[2],i=arguments[3];return lt.call(this,new hn(t.x,t.y,t.z,t.w,e.x,e.y,e.z,e.w,n.x,n.y,n.z,n.w,i.x,i.y,i.z,i.w))}case 16:return lt.call(this,new hn(+t,+e,+n,+i,+o,+r,+s,+a,+u,+c,+l,+h,+d,+p,+f,+g))}throw new Error("Invalid arguments.")}o.prototype=Object.assign(Object.create(lt.prototype),ae(t,e,hn,n,i),{constructor:o});for(const t of Reflect.ownKeys(o.prototype))Object.defineProperty(o.prototype,t,{enumerable:!1});function r(t){Object.defineProperty(o.prototype,t,{get:function(){return this.getValue()[t]},set:function(e){this.getValue()[t]=e,this.addEvent()},enumerable:!0,configurable:!1})}for(let t=0,e=hn.prototype.length;t<e;++t)r(t);return o}const pn={SFMatrix4d:dn("SFMatrix4d",c.SFMatrix4d,Ae.SFVec3d,!0),SFMatrix4f:dn("SFMatrix4f",c.SFMatrix4f,Ae.SFVec3f,!1),VrmlMatrix:dn("VrmlMatrix",c.VrmlMatrix,Ae.SFVec3f,!1)};n.set("x_ite/Fields/SFMatrix4",pn);const fn=pn,gn={get:function(){const t=new WeakMap;return function(e){const n=t.get(e);if(n)return n;{const n=new bn(e);return t.set(e,n),n}}}()};n.set("x_ite/Fields/SFNodeCache",gn);const mn=gn,_n=Symbol(),xn=Symbol(),yn=Symbol(),wn={get:function(t,e){try{const n=t[e];if(void 0!==n)return n;const i=t.getValue().getField(e);if(i.getAccessType()===c.inputOnly)return;return i.valueOf()}catch(t){return}},set:function(t,e,n){if(e in t)return t[e]=n,!0;try{const i=t.getValue().getField(e);return i.getAccessType()!==c.outputOnly&&i.setValue(n),!0}catch(n){return console.error(t,e,n),!1}},has:function(t,e){try{return Boolean(t.getValue().getField(e))}catch(n){return e in t}},ownKeys:function(t){const e=t.getValue(),n=[];if(e)for(const t of e.getFieldDefinitions())n.push(t.name);return n},getOwnPropertyDescriptor:function(t,e){const n=t.getValue();if(n){const i=n.getFieldDefinitions().get(e);if(i)return{value:this.get(t,e),writable:i.accessType!==c.outputOnly,enumerable:!0,configurable:!0}}}};function Sn(t){const e=new Proxy(this,wn);return this[_n]=this,this[xn]=e,t?(t.addParent(e),lt.call(this,t)):lt.call(this,null),e}Sn.prototype=Object.assign(Object.create(lt.prototype),{constructor:Sn,[_n]:null,[xn]:null,[yn]:0,copy:function(t){const e=this[_n].getValue();return e?new Sn(t?e.copy(t):e):new Sn},getTypeName:function(){return"SFNode"},getType:function(){return c.SFNode},equals:function(t){const e=this[_n];return t?e.getValue()===t.getValue():null===e.getValue()},isDefaultValue:function(){return null===this[_n].getValue()},set:function(t){const e=this[_n],n=e.getValue();n&&(n.removeCloneCount(e[yn]),n.removeParent(e[xn])),t?(t.addParent(e[xn]),t.addCloneCount(e[yn]),lt.prototype.set.call(e,t)):lt.prototype.set.call(e,null)},getNodeTypeName:function(){const t=this[_n].getValue();if(t)return t.getTypeName();throw new Error("SFNode.getNodeTypeName: node is null.")},getNodeName:function(){const t=this[_n].getValue();if(t)return t.getName();throw new Error("SFNode.getNodeName: node is null.")},getNodeDisplayName:function(){const t=this[_n].getValue();if(t)return t.getDisplayName();throw new Error("SFNode.getNodeDisplayName: node is null.")},getNodeType:function(){const t=this[_n].getValue();if(t)return t.getType().slice();throw new Error("SFNode.getNodeType: node is null.")},getFieldDefinitions:function(){const t=this[_n].getValue();if(t)return t.getFieldDefinitions();throw new Error("SFNode.getFieldDefinitions: node is null.")},addFieldCallback:function(t,e,n){const i=this[_n];switch(arguments.length){case 2:return lt.prototype.addFieldCallback.apply(i,arguments);case 3:{const o=i.getValue();if(o)return o.getField(t).addFieldCallback(e,n);throw new Error("SFNode.addFieldCallback: node is null.")}}},removeFieldCallback:function(t,e){const n=this[_n];switch(arguments.length){case 1:return lt.prototype.removeFieldCallback.apply(n,arguments);case 2:{const i=n.getValue();if(i)return i.getField(t).removeFieldCallback(e);throw new Error("SFNode.removeFieldCallback: node is null.")}}},addCloneCount:function(t){const e=this[_n],n=e.getValue();e[yn]+=t,n&&n.addCloneCount(t)},removeCloneCount:function(t){const e=this[_n],n=e.getValue();e[yn]-=t,n&&n.removeCloneCount(t)},valueOf:function(){const t=this[_n].getValue();return t?mn.get(t):null},toVRMLString:function(t=Object.prototype){const e=new d(t),n=this.getValue();return n&&e.PushExecutionContext(n.getExecutionContext()),this.toVRMLStream(e),e.string},toXMLString:function(t=Object.prototype){const e=new d(t),n=this.getValue();return n&&e.PushExecutionContext(n.getExecutionContext()),this.toXMLStream(e),e.string},toJSONString:function(t=Object.prototype){const e=new d(t),n=this.getValue();return n&&e.PushExecutionContext(n.getExecutionContext()),this.toJSONStream(e),e.string},toStream:function(t){const e=this[_n].getValue();e?e.toStream(t):t.string+="NULL"},toVRMLStream:function(t){const e=this[_n].getValue();e?e.toVRMLStream(t):t.string+="NULL"},toXMLStream:function(t){const e=this[_n].getValue();e?e.toXMLStream(t):t.string+="\x3c!-- NULL --\x3e"},toJSONStream:function(t){this.toJSONStreamValue(t)},toJSONStreamValue:function(t){const e=this[_n].getValue();e?e.toJSONStream(t):t.string+="null"},dispose:function(){const t=this[_n],e=t.getValue();e&&e.dispose(),lt.prototype.dispose.call(t)}});for(const t of Reflect.ownKeys(Sn.prototype))Object.defineProperty(Sn.prototype,t,{enumerable:!1});const Tn=Sn;n.set("x_ite/Fields/SFNode",Tn);const bn=Tn,vn=Ae.SFVec3f,Cn=Ve.SFMatrix3f;function En(t,e,n,i){switch(arguments.length){case 0:return lt.call(this,new an);case 1:return arguments[0]instanceof Cn?lt.call(this,(new an).setMatrix(arguments[0].getValue())):lt.call(this,arguments[0]);case 2:return arguments[1]instanceof vn?lt.call(this,new an(arguments[0].getValue(),arguments[1].getValue())):lt.call(this,new an(arguments[0].getValue(),+arguments[1]));case 4:return lt.call(this,new an(+t,+e,+n,+i))}throw new Error("Invalid arguments.")}En.prototype=Object.assign(Object.create(lt.prototype),{constructor:En,[Symbol.iterator]:function*(){yield*this.getValue()},copy:function(){return new En(this.getValue().copy())},equals:function(t){return this.getValue().equals(t.getValue())},isDefaultValue:function(){return this.getValue().equals(an.Identity)},getTypeName:function(){return"SFRotation"},getType:function(){return c.SFRotation},set:function(t){this.getValue().assign(t)},setAxis:function(t){this.getValue().setAxis(t.getValue()),this.addEvent()},getAxis:function(){return new vn(this.getValue().getAxis().copy())},setMatrix:function(t){this.getValue().setMatrix(t.getValue()),this.addEvent()},getMatrix:function(){return new Cn(this.getValue().getMatrix(new Ie))},inverse:function(){return new En(an.inverse(this.getValue()))},multiply:function(t){return new En(an.multRight(this.getValue(),t.getValue()))},multVec:function(t){return new vn(this.getValue().multVecRot(t.getValue().copy()))},slerp:function(t,e){return new En(an.slerp(this.getValue(),t.getValue(),e))},toStream:function(t){const e=this.getValue();t.string+=t.DoublePrecision(e.x),t.string+=t.TidySpace(),t.string+=t.DoublePrecision(e.y),t.string+=t.TidySpace(),t.string+=t.DoublePrecision(e.z),t.string+=t.TidySpace(),t.string+=t.DoublePrecision(t.ToUnit("angle",e.angle))},toVRMLStream:function(t){this.toStream(t)},toXMLStream:function(t){this.toStream(t)},toJSONStream:function(t){t.string+="[",t.string+=t.TidySpace(),this.toJSONStreamValue(t),t.string+=t.TidySpace(),t.string+="]"},toJSONStreamValue:function(t){const e=this.getValue();t.string+=t.JSONNumber(t.DoublePrecision(e.x)),t.string+=",",t.string+=t.TidySpace(),t.string+=t.JSONNumber(t.DoublePrecision(e.y)),t.string+=",",t.string+=t.TidySpace(),t.string+=t.JSONNumber(t.DoublePrecision(e.z)),t.string+=",",t.string+=t.TidySpace(),t.string+=t.JSONNumber(t.DoublePrecision(t.ToUnit("angle",e.angle)))}});for(const t of Reflect.ownKeys(En.prototype))Object.defineProperty(En.prototype,t,{enumerable:!1});const On={get:function(){return this.getValue().x},set:function(t){this.getValue().x=+t,this.addEvent()},enumerable:!0,configurable:!1},Nn={get:function(){return this.getValue().y},set:function(t){this.getValue().y=+t,this.addEvent()},enumerable:!0,configurable:!1},Fn={get:function(){return this.getValue().z},set:function(t){this.getValue().z=+t,this.addEvent()},enumerable:!0,configurable:!1},In={get:function(){return this.getValue().angle},set:function(t){this.getValue().angle=+t,this.addEvent()},enumerable:!0,configurable:!1};Object.defineProperty(En.prototype,"x",On),Object.defineProperty(En.prototype,"y",Nn),Object.defineProperty(En.prototype,"z",Fn),Object.defineProperty(En.prototype,"angle",In),On.enumerable=!1,Nn.enumerable=!1,Fn.enumerable=!1,In.enumerable=!1,Object.defineProperty(En.prototype,"0",On),Object.defineProperty(En.prototype,"1",Nn),Object.defineProperty(En.prototype,"2",Fn),Object.defineProperty(En.prototype,"3",In);const Mn=En;n.set("x_ite/Fields/SFRotation",Mn);const Dn=Mn,Vn=/\\(.)/g,Rn=/([\\"])/g;function Pn(t){return lt.call(this,arguments.length?""+t:"")}Object.assign(Pn,{unescape:function(t){return t.replace(Vn,"$1")},escape:function(t){return t.replace(Rn,"\\$1")}}),Pn.prototype=Object.assign(Object.create(lt.prototype),{constructor:Pn,[Symbol.iterator]:function*(){yield*this.getValue()},copy:function(){return new Pn(this.getValue())},getTypeName:function(){return"SFString"},getType:function(){return c.SFString},isDefaultValue:function(){return""===this.getValue()},set:function(t){lt.prototype.set.call(this,""+t)},valueOf:lt.prototype.getValue,toStream:function(t){t.string+='"'+Pn.escape(this.getValue())+'"'},toVRMLStream:function(t){this.toStream(t)},toXMLStream:function(t){t.string+=t.XMLEncode(this.getValue())},toJSONStream:function(t){this.toJSONStreamValue(t)},toJSONStreamValue:function(t){t.string+=t.JSONEncode(this.getValue())}});for(const t of Reflect.ownKeys(Pn.prototype))Object.defineProperty(Pn.prototype,t,{enumerable:!1});Object.defineProperty(Pn.prototype,"length",{get:function(){return this.getValue().length},enumerable:!0,configurable:!1});const An=Pn;n.set("x_ite/Fields/SFString",An);const Ln=An;function Bn(t){return lt.call(this,arguments.length?+t:0)}Bn.prototype=Object.assign(Object.create(lt.prototype),{constructor:Bn,copy:function(){return new Bn(this.getValue())},getTypeName:function(){return"SFTime"},getType:function(){return c.SFTime},isDefaultValue:function(){return 0===this.getValue()},set:function(t){lt.prototype.set.call(this,+t)},valueOf:lt.prototype.getValue,toStream:function(t){t.string+=this.getValue()},toVRMLStream:function(t){this.toStream(t)},toXMLStream:function(t){this.toStream(t)},toJSONStream:function(t){this.toJSONStreamValue(t)},toJSONStreamValue:function(t){t.string+=t.JSONNumber(t.DoublePrecision(this.getValue()))}});for(const t of Reflect.ownKeys(Bn.prototype))Object.defineProperty(Bn.prototype,t,{enumerable:!1});const Xn=Bn;n.set("x_ite/Fields/SFTime",Xn);const Un=Xn;function kn(t,e,n){function i(t,e,n,i){switch(arguments.length){case 0:return lt.call(this,new Xe(0,0,0,0));case 1:return lt.call(this,arguments[0]);case 4:return lt.call(this,new Xe(+t,+e,+n,+i))}throw new Error("Invalid arguments.")}i.prototype=Object.assign(Object.create(lt.prototype),ce(t,e,Xe,n),{constructor:i});for(const t of Reflect.ownKeys(i.prototype))Object.defineProperty(i.prototype,t,{enumerable:!1});const o={get:function(){return this.getValue().x},set:function(t){this.getValue().x=+t,this.addEvent()},enumerable:!0,configurable:!1},r={get:function(){return this.getValue().y},set:function(t){this.getValue().y=+t,this.addEvent()},enumerable:!0,configurable:!1},s={get:function(){return this.getValue().z},set:function(t){this.getValue().z=+t,this.addEvent()},enumerable:!0,configurable:!1},a={get:function(){return this.getValue().w},set:function(t){this.getValue().w=+t,this.addEvent()},enumerable:!0,configurable:!1};return Object.defineProperty(i.prototype,"x",o),Object.defineProperty(i.prototype,"y",r),Object.defineProperty(i.prototype,"z",s),Object.defineProperty(i.prototype,"w",a),o.enumerable=!1,r.enumerable=!1,s.enumerable=!1,a.enumerable=!1,Object.defineProperty(i.prototype,"0",o),Object.defineProperty(i.prototype,"1",r),Object.defineProperty(i.prototype,"2",s),Object.defineProperty(i.prototype,"3",a),i}const zn={SFVec4d:kn("SFVec4d",c.SFVec4d,!0),SFVec4f:kn("SFVec4f",c.SFVec4f,!1)};n.set("x_ite/Fields/SFVec4",zn);const jn=zn;function Gn(t){lt.call(this,t)}Gn.prototype=Object.assign(Object.create(lt.prototype),{constructor:Gn,at:Array.prototype.at,concat:Array.prototype.concat,entries:Array.prototype.entries,every:Array.prototype.every,fill:Array.prototype.fill,filter:Array.prototype.filter,find:Array.prototype.find,findIndex:Array.prototype.findIndex,findLast:Array.prototype.findLast,findLastIndex:Array.prototype.findLastIndex,flat:Array.prototype.flat,flatMap:Array.prototype.flatMap,forEach:Array.prototype.forEach,includes:Array.prototype.includes,indexOf:Array.prototype.indexOf,join:Array.prototype.join,keys:Array.prototype.keys,lastIndexOf:Array.prototype.lastIndexOf,map:Array.prototype.map,reduce:Array.prototype.reduce,reduceRight:Array.prototype.reduceRight,slice:Array.prototype.slice,some:Array.prototype.some,values:Array.prototype.values});for(const t of Reflect.ownKeys(Gn.prototype))Object.defineProperty(Gn.prototype,t,{enumerable:!1});const Hn=Gn;n.set("x_ite/Base/X3DArrayField",Hn);const qn=Hn,Yn=Symbol(),Wn=Symbol(),Kn={get:function(t,e){const n=t[e];if(void 0!==n)return n;if("string"==typeof e){const n=t.getValue(),i=+e;return Number.isInteger(i)?(i>=n.length&&t.resize(i+1),n[i].valueOf()):t[e]}},set:function(t,e,n){if(e in t)return t[e]=n,!0;const i=t.getValue(),o=+e;return o>=i.length&&t.resize(o+1),i[o].setValue(n),!0},has:function(t,e){return Number.isInteger(+e)?e<t.getValue().length:e in t},ownKeys:function(t){return Object.keys(t.getValue())},getOwnPropertyDescriptor:function(t,e){if("string"!=typeof e)return;const n=+e;return Number.isInteger(n)&&n<t.getValue().length?Object.getOwnPropertyDescriptor(t.getValue(),e):void 0}};function Jn(t){const e=new Proxy(this,Kn);return qn.call(this,[]),this[Yn]=this,this[Wn]=e,t[0]instanceof Array&&(t=t[0]),Jn.prototype.push.apply(this,t),e}Jn.prototype=Object.assign(Object.create(qn.prototype),{constructor:Jn,[Yn]:null,[Wn]:null,[Symbol.iterator]:function*(){const t=this[Yn].getValue();for(const e of t)yield e.valueOf()},getTarget:function(){return this[Yn]},copy:function(){const t=this[Yn],e=t.create(),n=t.getValue();return Jn.prototype.push.apply(e,n),e.setModificationTime(0),e},equals:function(t){const e=this[Yn].getValue(),n=t.getValue(),i=e.length;if(e===n)return!0;if(i!==n.length)return!1;for(let t=0;t<i;++t)if(!e[t].equals(n[t]))return!1;return!0},set:function(t){const e=this[Yn];e.resize(t.length,void 0,!0);const n=e.getValue();for(let e=0,i=t.length;e<i;++e)n[e].set(t[e]instanceof lt?t[e].getValue():t[e])},isDefaultValue:function(){return 0===this.length},setValue:function(t){const e=this[Yn];e.set(t instanceof Jn?t.getValue():t),e.addEvent()},unshift:function(t){const e=this[Yn],n=e.getValue();for(let t=arguments.length-1;t>=0;--t){const i=new(e.getSingleType());i.setValue(arguments[t]),e.addChildObject(i),n.unshift(i)}return e.addEvent(),n.length},shift:function(){const t=this[Yn],e=t.getValue();if(e.length){const n=e.shift();return t.removeChildObject(n),t.addEvent(),n.valueOf()}},push:function(t){const e=this[Yn],n=e.getValue();for(const t of arguments){const i=new(e.getSingleType());i.setValue(t),e.addChildObject(i),n.push(i)}return e.addEvent(),n.length},pop:function(){const t=this[Yn],e=t.getValue();if(e.length){const n=e.pop();return t.removeChildObject(n),t.addEvent(),n.valueOf()}},splice:function(t,e){const n=this[Yn],i=n.getValue();t>i.length&&(t=i.length),t+e>i.length&&(e=i.length-t);const o=n.erase(t,t+e);return arguments.length>2&&n.insert(t,arguments,2,arguments.length),o},insert:function(t,e,n,i){const o=this[Yn],r=[t,0];for(let t=n;t<i;++t){const n=new(o.getSingleType());n.setValue(e[t]),o.addChildObject(n),r.push(n)}Array.prototype.splice.apply(o.getValue(),r),o.addEvent()},find:function(t,e,n){const i=this[Yn].getValue();if("function"==typeof n){for(let o=t;o<e;++o)if(n(i[o].valueOf()))return o;return e}for(let o=t;o<e;++o)if(i[o].equals(n))return o;return e},remove:function(t,e,n){const i=this[Yn],o=i.getValue();if("function"==typeof n){if((t=i.find(t,e,n))!==e)for(let i=t;++i<e;){const e=o[i];if(!n(e.valueOf())){const n=o[t];o[t++]=e,o[i]=n}}return t!==e&&i.addEvent(),t}if((t=i.find(t,e,n))!==e)for(let i=t;++i<e;){const e=o[i];if(!e.equals(n)){const n=o[t];o[t++]=e,o[i]=n}}return t!==e&&i.addEvent(),t},erase:function(t,e){const n=this[Yn],i=n.getValue().splice(t,e-t);for(const t of i)n.removeChildObject(t);return n.addEvent(),i.map((function(t){return t.valueOf()}))},resize:function(t,e,n){const i=this[Yn],o=i.getValue();if(t<o.length){for(let e=t,n=o.length;e<n;++e)i.removeChildObject(o[e]);o.length=t,n||i.addEvent()}else if(t>o.length){for(let n=o.length;n<t;++n){const t=new(i.getSingleType());void 0!==e&&t.setValue(e),i.addChildObject(t),o.push(t)}n||i.addEvent()}},addChildObject:function(t){t.addParent(this[Wn])},removeChildObject:function(t){t.removeParent(this[Wn])},toStream:function(t){const e=this[Yn],n=e.getValue();switch(n.length){case 0:t.string+="[",t.string+=t.TidySpace(),t.string+="]";break;case 1:t.PushUnitCategory(e.getUnit()),n[0].toStream(t),t.PopUnitCategory();break;default:t.PushUnitCategory(e.getUnit()),t.string+="[",t.string+=t.ListStart(),t.IncIndent();for(let e=0,i=n.length-1;e<i;++e)t.string+=t.ListIndent(),n[e].toStream(t),t.string+=t.Comma(),t.string+=t.ListBreak();t.string+=t.ListIndent(),n.at(-1).toStream(t),t.string+=t.ListEnd(),t.DecIndent(),t.string+=t.ListIndent(),t.string+="]",t.PopUnitCategory()}},toVRMLStream:function(t){this.toStream(t)},toXMLStream:function(t){const e=this[Yn];if(e.length){const n=e.getValue();t.PushUnitCategory(e.getUnit());for(let e=0,i=n.length-1;e<i;++e)n[e].toXMLStream(t),t.string+=t.Comma(),t.string+=t.TidySpace();n.at(-1).toXMLStream(t),t.PopUnitCategory()}},toJSONStream:function(t){const e=this[Yn],n=e.length;if(n){const i=this.getValue();t.PushUnitCategory(e.getUnit()),t.string+="[",t.string+=t.ListBreak(),t.string+=t.IncIndent();for(let e=0,o=n-1;e<o;++e)t.string+=t.ListIndent(),i[e].toJSONStreamValue(t),t.string+=",",t.string+=t.ListBreak();t.string+=t.ListIndent(),i.at(-1).toJSONStreamValue(t),t.string+=t.ListBreak(),t.string+=t.DecIndent(),t.string+=t.ListIndent(),t.string+="]",t.PopUnitCategory()}else t.string+="[",t.string+=t.TidySpace(),t.string+="]"},dispose:function(){const t=this[Yn],e=t.getValue();for(const n of e)t.removeChildObject(n);e.length=0,qn.prototype.dispose.call(t)}});for(const t of Reflect.ownKeys(Jn.prototype))Object.defineProperty(Jn.prototype,t,{enumerable:!1});Object.defineProperty(Jn.prototype,"length",{get:function(){return this[Yn].getValue().length},set:function(t){this[Yn].resize(t)},enumerable:!1,configurable:!1});const Zn=Jn;n.set("x_ite/Base/X3DObjectArrayField",Zn);const Qn=Zn,$n=Symbol(),ti=Symbol(),ei=Symbol(),ni=Symbol(),ii={get:function(t,e){const n=t[e];if(void 0!==n)return n;if("string"==typeof e){const n=+e;if(Number.isInteger(n)){const e=t.getComponents(),i=t.getValueType();let o=t.getValue();if(n>=t[ni]&&(o=t.resize(n+1)),1===e)return i(o[n]);{const o=t[ti][n];if(o)return o;{const o=new i,r=o.getValue(),s=n*e;return o.addEvent=si.bind(t,s,e,r),o.getValue=ri.bind(t,s,e,r),t[ti][n]=o,o}}}return t[e]}},set:function(t,e,n){if(e in t)return t[e]=n,!0;const i=t.getComponents();let o=+e,r=t.getValue();if(o>=t[ni]&&(r=t.resize(o+1)),1===i)r[o]=n;else{o*=i;for(let t=0;t<i;++t,++o)r[o]=n[t]}return t.addEvent(),!0},has:function(t,e){return Number.isInteger(+e)?e<t[ni]:e in t},ownKeys:function(t){const e=[];for(let n=0,i=t[ni];n<i;++n)e.push(String(n));return e},getOwnPropertyDescriptor:function(t,e){if("string"!=typeof e)return;const n=+e;return Number.isInteger(n)&&n<t[ni]?Object.getOwnPropertyDescriptor(t.getValue(),e):void 0}};function oi(t){return qn.call(this,new(this.getArrayType())(16)),this[$n]=this,this.getComponents()>1&&(this[ti]=[],this[ei]=[]),t[0]instanceof Array&&(t=t[0]),oi.prototype.push.apply(this,t),new Proxy(this,ii)}oi.prototype=Object.assign(Object.create(qn.prototype),{constructor:oi,[$n]:null,[ei]:null,[ni]:0,[Symbol.iterator]:function*(){const t=this[$n],e=t.getValue(),n=t.getComponents(),i=t.getValueType(),o=t[ni];if(1===n)for(let t=0;t<o;++t)yield i(e[t]);else for(let e=0;e<o;++e){const o=t[ti][e];if(o)yield o;else{const o=new i,r=o.getValue(),s=e*n;o.addEvent=si.bind(t,s,n,r),o.getValue=ri.bind(t,s,n,r),t[ti][e]=o,yield o}}},getTarget:function(){return this[$n]},copy:function(){const t=this[$n],e=t.getValue(),n=t.create(),i=new(t.getArrayType())(e);return n[ni]=t[ni],qn.prototype.set.call(n,i,t[ni]),n.setModificationTime(0),n},equals:function(t){if(this===t)return!0;const e=this[$n],n=e[ni];if(n!==t[ni])return!1;const i=e.getValue(),o=t.getValue();for(let t=0,r=n*e.getComponents();t<r;++t)if(i[t]!==o[t])return!1;return!0},assign:function(t){const e=this[$n];e.set(t.getValue(),t.length),e.addEvent()},set:function(t,e){const n=this[$n],i=n.getComponents(),o=n[ni];let r=n.getValue(),s=void 0!==e?e*i:t.length;const a=s%i;a&&(s-=a,console.warn("Array length must be multiple of components size, which is "+i+".")),s/=i,r.length<t.length?(r=n.grow(t.length),r.set(t),a&&r.fill(0,s*i,s*i+a)):(r.set(t),s<o&&r.fill(0,s*i,o*i)),n[ni]=s},isDefaultValue:function(){return 0===this[ni]},setValue:function(t){const e=this[$n];t instanceof e.constructor?e.assign(t):(e.set(t),e.addEvent())},unshift:function(t){const e=this[$n],n=e.getComponents(),i=e[ni],o=arguments.length,r=e.grow((i+o)*n);if(r.copyWithin(o*n,0,i*n),1===n)r.set(arguments,0);else for(let t=0,e=0;e<o;++e){const i=arguments[e];for(let e=0;e<n;++e,++t)r[t]=i[e]}return e[ni]+=o,e.addEvent(),r.length},shift:function(){const t=this[$n],e=t[ni];if(e){const i=t.getValue(),o=t.getComponents(),r=t.getValueType(),s=e-1;if(1===o)var n=r(i[0]);else{const e=t[ei];for(let t=0;t<o;++t)e[t]=i[t];n=new r(...e)}return i.copyWithin(0,o,e*o),i.fill(0,o*s,e*o),t[ni]=s,t.addEvent(),n}},push:function(t){const e=this[$n],n=e.getComponents(),i=e[ni],o=arguments.length,r=e.grow((i+o)*n);if(1===n)r.set(arguments,i);else for(let t=i*n,e=0;e<o;++e){const i=arguments[e];for(let e=0;e<n;++e,++t)r[t]=i[e]}return e[ni]+=o,e.addEvent(),e[ni]},pop:function(){const t=this[$n],e=t[ni];if(e){const i=t.getValue(),o=t.getComponents(),r=t.getValueType(),s=e-1;if(1===o)var n=r(i[e-1]);else{const e=t[ei];for(let t=0,n=s*o;t<o;++t,++n)e[t]=i[n];n=new r(...e)}return i.fill(0,s*o,e*o),t[ni]=s,t.addEvent(),n}},splice:function(t,e){const n=this[$n],i=n[ni];t>i&&(t=i),t+e>i&&(e=i-t);const o=n.erase(t,t+e);return arguments.length>2&&n.spliceInsert(t,Array.prototype.splice.call(arguments,2)),n.addEvent(),o},spliceInsert:function(t,e){const n=this[$n],i=n.getComponents(),o=n[ni],r=e.length,s=n.grow((o+r)*i);if(t*=i,s.copyWithin(t+r*i,t,o*i),1===i)s.set(e,t);else for(let n=0,o=t;n<r;++n){const t=e[n];for(let e=0;e<i;++e,++o)s[o]=t[e]}n[ni]+=r},insert:function(t,e,n,i){const o=this[$n],r=o[ni],s=e.getValue(),a=o.getComponents(),u=i-n,c=o.grow((r+u)*a);for(t*=a,n*=a,i*=a,c.copyWithin(t+u*a,t,r*a);n<i;++t,++n)c[t]=s[n];o[ni]+=u,o.addEvent()},erase:function(t,e){const n=this[$n],i=n.getValue(),o=n.getComponents(),r=e-t,s=n[ni],a=s-r,u=n.create(),c=u.grow(r*o);e*=o;for(let n=0,r=t*=o;r<e;++n,++r)c[n]=i[r];return i.copyWithin(t,e,s*o),i.fill(0,a*o,s*o),n[ni]=a,u[ni]=r,o>1&&(n[ti].length=a),n.addEvent(),u.slice()},resize:function(t,e,n){const i=this[$n],o=i[ni],r=i.getComponents();let s=i.getValue();if(t<o)s.fill(0,t*r,o*r),r>1&&(i[ti].length=t),n||i.addEvent();else if(t>o){if(s=i.grow(t*r),void 0!==e)if(1===r)s.fill(e,o*r,t*r);else for(let n=o*r,i=t*r;n<i;)for(let t=0;t<r;++t,++n)s[n]=e[t];n||i.addEvent()}return i[ni]=t,s},grow:function(t){const e=this[$n],n=e.getValue();if(t<n.length)return n;const i=gt.nextPowerOfTwo(t),o=new(e.getArrayType())(i);return o.set(n),qn.prototype.set.call(e,o),o},shrinkToFit:function(){const t=this[$n],e=t.getValue(),n=t[ni]*t.getComponents();if(e.length==n)return e;const i=e.subarray(0,n);return qn.prototype.set.call(t,i),i},toStream:function(t){const e=this[$n],n=e.getValue(),i=e[ni],o=e.getComponents(),r=new(e.getSingleType());switch(i){case 0:t.string+="[",t.string+=t.TidySpace(),t.string+="]";break;case 1:if(t.PushUnitCategory(e.getUnit()),1===o)r.set(n[0]),r.toStream(t);else{for(let t=0,e=0;t<o;++t,++e)r[t]=n[e];r.toStream(t)}t.PopUnitCategory();break;default:if(t.PushUnitCategory(e.getUnit()),t.string+="[",t.string+=t.ListStart(),t.IncIndent(),1===o){for(let e=0,s=i-1;e<s;++e)t.string+=t.ListIndent(),r.set(n[e*o]),r.toStream(t),t.string+=t.Comma(),t.string+=t.ListBreak();t.string+=t.ListIndent(),r.set(n[(i-1)*o]),r.toStream(t)}else{for(let e=0,s=i-1;e<s;++e){t.string+=t.ListIndent();for(let t=0,i=e*o;t<o;++t,++i)r[t]=n[i];r.toStream(t),t.string+=t.Comma(),t.string+=t.ListBreak()}t.string+=t.ListIndent();for(let t=0,e=(i-1)*o;t<o;++t,++e)r[t]=n[e];r.toStream(t)}t.string+=t.ListEnd(),t.DecIndent(),t.string+=t.ListIndent(),t.string+="]",t.PopUnitCategory()}},toVRMLStream:function(t){this.toStream(t)},toXMLStream:function(t){const e=this[$n],n=e[ni];if(n){const i=e.getValue(),o=e.getComponents(),r=new(e.getSingleType());if(t.PushUnitCategory(e.getUnit()),1===o){for(let e=0,s=n-1;e<s;++e)r.set(i[e*o]),r.toXMLStream(t),t.string+=t.Comma(),t.string+=t.TidySpace();r.set(i[(n-1)*o]),r.toXMLStream(t)}else{for(let e=0,s=n-1;e<s;++e){for(let t=0,n=e*o;t<o;++t,++n)r[t]=i[n];r.toXMLStream(t),t.string+=t.Comma(),t.string+=t.TidySpace()}for(let t=0,e=(n-1)*o;t<o;++t,++e)r[t]=i[e];r.toXMLStream(t)}t.PopUnitCategory()}},toJSONStream:function(t){const e=this[$n],n=e.length;if(n){const i=e.getValue(),o=e.getComponents(),r=new(e.getSingleType());if(t.PushUnitCategory(e.getUnit()),t.string+="[",t.string+=t.ListBreak(),t.string+=t.IncIndent(),1===o){for(let e=0,s=n-1;e<s;++e)t.string+=t.ListIndent(),r.set(i[e*o]),r.toJSONStreamValue(t),t.string+=",",t.string+=t.ListBreak();t.string+=t.ListIndent(),r.set(i[(n-1)*o]),r.toJSONStreamValue(t)}else{for(let e=0,s=n-1;e<s;++e){t.string+=t.ListIndent();for(let t=0,n=e*o;t<o;++t,++n)r[t]=i[n];r.toJSONStreamValue(t),t.string+=",",t.string+=t.ListBreak()}t.string+=t.ListIndent();for(let t=0,e=(n-1)*o;t<o;++t,++e)r[t]=i[e];r.toJSONStreamValue(t)}t.string+=t.ListBreak(),t.string+=t.DecIndent(),t.string+=t.ListIndent(),t.string+="]",t.PopUnitCategory()}else t.string+="[",t.string+=t.TidySpace(),t.string+="]"},dispose:function(){qn.prototype.dispose.call(this[$n])}});for(const t of Reflect.ownKeys(oi.prototype))Object.defineProperty(oi.prototype,t,{enumerable:!1});function ri(t,e,n){const i=this.getValue();for(let o=0;o<e;++o,++t)n[o]=i[t];return n}function si(t,e,n){const i=this.getValue();for(let o=0;o<e;++o,++t)i[t]=n[o];this.addEvent()}Object.defineProperty(oi.prototype,"length",{get:function(){return this[ni]},set:function(t){this[$n].resize(t)},enumerable:!1,configurable:!1});const ai=oi;n.set("x_ite/Base/X3DTypedArrayField",ai);const ui=ai,ci=Ve.SFMatrix3d,li=Ve.SFMatrix3f,hi=fn.SFMatrix4d,di=fn.SFMatrix4f,pi=ge.SFVec2d,fi=ge.SFVec2f,gi=Ae.SFVec3d,mi=Ae.SFVec3f,_i=jn.SFVec4d,xi=jn.SFVec4f,yi=Symbol();function wi(t){return Qn.call(this,arguments)}wi.prototype=Object.assign(Object.create(Qn.prototype),{constructor:wi,[yi]:0,getSingleType:function(){return bn},getValueType:function(){return bn},getArrayType:function(){return Array},getComponents:function(){return 1},getTypeName:function(){return"MFNode"},getType:function(){return c.MFNode},copy:function(t){if(t){const e=new wi;for(const n of this.getValue())e.push(n.copy(t));return e.setModificationTime(0),e}return Qn.prototype.copy.call(this)},addCloneCount:function(t){this[yi]+=t;for(const e of this.getValue())e.addCloneCount(t)},removeCloneCount:function(t){this[yi]-=t;for(const e of this.getValue())e.removeCloneCount(t)},addChildObject:function(t){Qn.prototype.addChildObject.call(this,t),t.addCloneCount(this[yi])},removeChildObject:function(t){Qn.prototype.removeChildObject.call(this,t),t.removeCloneCount(this[yi])},toStream:function(t){const e=this.getTarget(),n=e.getValue();switch(n.length){case 0:t.string+="[",t.string+=t.TidySpace(),t.string+="]";break;case 1:t.PushUnitCategory(e.getUnit()),n[0].toStream(t),t.PopUnitCategory();break;default:t.PushUnitCategory(e.getUnit()),t.string+="[",t.string+=t.TidyBreak(),t.IncIndent();for(let e=0,i=n.length;e<i;++e)t.string+=t.Indent(),n[e].toStream(t),t.string+=t.TidyBreak();t.DecIndent(),t.string+=t.Indent(),t.string+="]",t.PopUnitCategory()}},toVRMLString:function(){this.addCloneCount(1);const t=Qn.prototype.toVRMLString.call(this);return this.removeCloneCount(1),t},toVRMLStream:function(t){const e=this.getTarget().getValue();switch(e.length){case 0:t.string+="[",t.string+=t.TidySpace(),t.string+="]";break;case 1:t.EnterScope(),e[0].toVRMLStream(t),t.LeaveScope();break;default:t.EnterScope(),t.string+="[",t.string+=t.TidyBreak(),t.IncIndent();for(const n of e)t.string+=t.Indent(),n.toVRMLStream(t),t.string+=t.TidyBreak();t.DecIndent(),t.string+=t.Indent(),t.string+="]",t.LeaveScope()}},toXMLString:function(){this.addCloneCount(1);const t=Qn.prototype.toXMLString.call(this);return this.removeCloneCount(1),t},toXMLStream:function(t){const e=this.length;if(e){t.EnterScope();const n=this.getValue();for(let i=0,o=e-1;i<o;++i){const e=n[i].getValue();if(e)e.toXMLStream(t),t.string+=t.TidyBreak();else{t.string+=t.Indent(),t.string+="<",t.string+="NULL";const e=t.ContainerField();e&&(t.string+=t.Space(),t.string+="containerField='",t.string+=t.XMLEncode(e.getName()),t.string+="'"),t.string+="/>"}}const i=n.at(-1).getValue();if(i)i.toXMLStream(t);else{t.string+=t.Indent(),t.string+="<",t.string+="NULL";const e=t.ContainerField();e&&(t.string+=t.Space(),t.string+="containerField='",t.string+=t.XMLEncode(e.getName()),t.string+="'")}t.LeaveScope()}},toJSONStream:function(t){const e=this.length;if(e){const n=this.getValue();t.EnterScope(),t.string+="[",t.string+=t.TidyBreak(),t.string+=t.IncIndent();for(let i=0,o=e-1;i<o;++i)t.string+=t.Indent(),n[i]?n[i].toJSONStreamValue(t):t.string+="null",t.string+=",",t.string+=t.TidyBreak();t.string+=t.Indent(),n.at(-1)?n.at(-1).toJSONStreamValue(t):t.string+="null",t.string+=t.TidyBreak(),t.string+=t.DecIndent(),t.string+=t.Indent(),t.string+="]",t.LeaveScope()}else t.string+="[",t.string+=t.TidySpace(),t.string+="]"},dispose:function(){this.resize(0),Qn.prototype.dispose.call(this)}});for(const t of Reflect.ownKeys(wi.prototype))Object.defineProperty(wi.prototype,t,{enumerable:!1});function Si(t){return Qn.call(this,arguments)}Si.prototype=Object.assign(Object.create(Qn.prototype),{constructor:Si,getValueType:function(){return String},getSingleType:function(){return Ln},getArrayType:function(){return Array},getComponents:function(){return 1},getTypeName:function(){return"MFString"},getType:function(){return c.MFString},toXMLStream:function(t){const e=this.length;if(e){const n=this.getValue();for(let i=0,o=e-1;i<o;++i)t.string+='"',n[i].toXMLStream(t),t.string+='"',t.string+=t.Comma(),t.string+=t.TidySpace();t.string+='"',n.at(-1).toXMLStream(t),t.string+='"'}}});for(const t of Reflect.ownKeys(Si.prototype))Object.defineProperty(Si.prototype,t,{enumerable:!1});function Ti(t,e,n,i,o,r){function s(t){return ui.call(this,arguments)}s.prototype=Object.assign(Object.create(ui.prototype),{constructor:s,getSingleType:function(){return n},getValueType:function(){return i},getArrayType:function(){return o},getComponents:function(){return r},getTypeName:function(){return t},getType:function(){return e}});for(const t of Reflect.ownKeys(s.prototype))Object.defineProperty(s.prototype,t,{enumerable:!1});return s}function bi(t){return t}const vi={MFBool:Ti("MFBool",c.MFBool,pt,Boolean,Uint8Array,1),MFColor:Ti("MFColor",c.MFColor,Mt,Mt,Float32Array,3),MFColorRGBA:Ti("MFColorRGBA",c.MFColorRGBA,Jt,Jt,Float32Array,4),MFDouble:Ti("MFDouble",c.MFDouble,$t,bi,Float64Array,1),MFFloat:Ti("MFFloat",c.MFFloat,ne,bi,Float32Array,1),MFImage:function(t,e,n,i,o,r){function s(t){return Qn.call(this,arguments)}s.prototype=Object.assign(Object.create(Qn.prototype),{constructor:s,getSingleType:function(){return Di},getValueType:function(){return Di},getArrayType:function(){return o},getComponents:function(){return r},getTypeName:function(){return t},getType:function(){return e}});for(const t of Reflect.ownKeys(s.prototype))Object.defineProperty(s.prototype,t,{enumerable:!1});return s}("MFImage",c.MFImage,0,0,Array,1),MFInt32:Ti("MFInt32",c.MFInt32,re,bi,Int32Array,1),MFMatrix3d:Ti("MFMatrix3d",c.MFMatrix3d,ci,ci,Float64Array,9),MFMatrix3f:Ti("MFMatrix3f",c.MFMatrix3f,li,li,Float32Array,9),MFMatrix4d:Ti("MFMatrix4d",c.MFMatrix4d,hi,hi,Float64Array,16),MFMatrix4f:Ti("MFMatrix4f",c.MFMatrix4f,di,di,Float32Array,16),MFNode:wi,MFRotation:Ti("MFRotation",c.MFRotation,Dn,Dn,Float64Array,4),MFString:Si,MFTime:Ti("MFTime",c.MFTime,Un,bi,Float64Array,1),MFVec2d:Ti("MFVec2d",c.MFVec2d,pi,pi,Float64Array,2),MFVec2f:Ti("MFVec2f",c.MFVec2f,fi,fi,Float32Array,2),MFVec3d:Ti("MFVec3d",c.MFVec3d,gi,gi,Float64Array,3),MFVec3f:Ti("MFVec3f",c.MFVec3f,mi,mi,Float32Array,3),MFVec4d:Ti("MFVec4d",c.MFVec4d,_i,_i,Float64Array,4),MFVec4f:Ti("MFVec4f",c.MFVec4f,xi,xi,Float32Array,4)},Ci=vi;n.set("x_ite/Fields/ArrayFields",Ci);const Ei=Ci;function Oi(t,e,n,i){const o=Ei.MFInt32;this.width=~~t,this.height=~~e,this.comp=~~n,this.array=new o,this.array.setValue(i),this.array.length=this.width*this.height}function Ni(t,e,n,i){const o=Ei.MFInt32;return arguments[0]instanceof Oi?lt.call(this,arguments[0]):4===arguments.length?lt.call(this,new Oi(t,e,n,i)):lt.call(this,new Oi(0,0,0,new o)),this.getValue().getArray().addParent(this),this.addInterest("set_size__",this),this}Oi.prototype={constructor:Oi,copy:function(){return new Oi(this.width,this.height,this.comp,this.array)},equals:function(t){return this.width===t.width&&this.height===t.height&&this.comp===t.comp&&this.array.equals(t.array)},assign:function(t){this.width=t.width,this.height=t.height,this.comp=t.comp,this.array.assign(t.array)},set:function(t,e,n,i){this.width=~~t,this.height=~~e,this.comp=~~n,this.array.assign(i)},setWidth:function(t){this.width=~~t,this.array.length=this.width*this.height},getWidth:function(){return this.width},setHeight:function(t){this.height=~~t,this.array.length=this.width*this.height},getHeight:function(){return this.height},setComp:function(t){this.comp=~~t},getComp:function(){return this.comp},setArray:function(t){this.array.setValue(t),this.array.length=this.width*this.height},getArray:function(){return this.array}},Ni.prototype=Object.assign(Object.create(lt.prototype),{constructor:Ni,set_size__:function(){this.getValue().getArray().length=this.width*this.height},copy:function(){return new Ni(this.getValue().copy())},equals:function(t){return this.getValue().equals(t.getValue())},isDefaultValue:function(){return 0===this.width&&0===this.height&&0===this.comp},set:function(t){this.getValue().assign(t)},getTypeName:function(){return"SFImage"},getType:function(){return c.SFImage},toStream:function(t){const e=this.array;t.string+=this.width,t.string+=t.Space(),t.string+=this.height,t.string+=t.Space(),t.string+=this.comp,t.string+=t.AttribBreak(),t.IncIndent();for(let n=0,i=this.height;n<i;++n){t.string+=t.ListIndent();const o=n*this.width;for(let n=0,i=this.width;n<i;++n)t.string+="0x",t.string+=e[n+o].toString(16),n!==i-1&&(t.string+=t.Space());n!==i-1&&(t.string+=t.AttribBreak())}t.DecIndent()},toVRMLStream:function(t){this.toStream(t)},toXMLStream:function(t){this.toStream(t)},toJSONStream:function(t){t.string+="[",t.string+=t.ListBreak(),t.string+=t.IncIndent(),t.string+=t.ListIndent(),this.toJSONStreamValue(t),t.string+=t.DecIndent(),t.string+=t.ListBreak(),t.string+=t.ListIndent(),t.string+="]"},toJSONStreamValue:function(t){const e=this.array,n=e.length;if(t.string+=this.width,t.string+=",",t.string+=t.TidySpace(),t.string+=this.height,t.string+=",",t.string+=t.TidySpace(),t.string+=this.comp,t.string+=",",this.width&&this.height){t.string+=t.ListBreak(),t.string+=t.IncIndent();for(let i=0,o=this.height;i<o;++i){t.string+=t.ListIndent();const r=i*this.width;for(let i=0,o=this.width;i<o;++i)t.string+=e[i+r],i+r!==n-1&&(t.string+=","),i!==o-1&&(t.string+=t.TidySpace());i!==o-1&&(t.string+=t.ListBreak())}t.string+=t.DecIndent()}}});for(const t of Reflect.ownKeys(Ni.prototype))Object.defineProperty(Ni.prototype,t,{enumerable:!1});const Fi={get:function(){return this.getValue().getWidth()},set:function(t){this.getValue().setWidth(t),this.addEvent()},enumerable:!0,configurable:!1},Ii={get:function(){return this.getValue().getHeight()},set:function(t){this.getValue().setHeight(t),this.addEvent()},enumerable:!0,configurable:!1};Object.defineProperty(Ni.prototype,"width",Fi),Object.defineProperty(Ni.prototype,"height",Ii),Object.defineProperty(Ni.prototype,"comp",{get:function(){return this.getValue().getComp()},set:function(t){this.getValue().setComp(t),this.addEvent()},enumerable:!0,configurable:!1}),Object.defineProperty(Ni.prototype,"array",{get:function(){return this.getValue().getArray()},set:function(t){this.getValue().setArray(t),this.addEvent()},enumerable:!0,configurable:!1}),Fi.enumerable=!1,Ii.enumerable=!1,Object.defineProperty(Ni.prototype,"x",Fi),Object.defineProperty(Ni.prototype,"y",Ii);const Mi=Ni;n.set("x_ite/Fields/SFImage",Mi);const Di=Mi,Vi=Object.assign({SFBool:pt,SFColor:Mt,SFColorRGBA:Jt,SFDouble:$t,SFFloat:ne,SFImage:Di,SFInt32:re,SFMatrix3d:Ve.SFMatrix3d,SFMatrix3f:Ve.SFMatrix3f,SFMatrix4d:fn.SFMatrix4d,SFMatrix4f:fn.SFMatrix4f,SFNode:bn,SFRotation:Dn,SFString:Ln,SFTime:Un,SFVec2d:ge.SFVec2d,SFVec2f:ge.SFVec2f,SFVec3d:Ae.SFVec3d,SFVec3f:Ae.SFVec3f,SFVec4d:jn.SFVec4d,SFVec4f:jn.SFVec4f,VrmlMatrix:fn.VrmlMatrix},Ei);n.set("x_ite/Fields",Vi);const Ri=Vi,Pi=new Map,Ai=new Map,Li={addNodeTypeName:function(t){Pi.set(t,t),Pi.set(t.toUpperCase(),t)},getNodeTypeName:function(t){return Pi.get(t)},addFieldName:function(t){Ai.set(t,t),Ai.set(t.toLowerCase(),t)},getFieldName:function(t){return Ai.get(t)}};n.set("x_ite/Parser/HTMLSupport",Li);const Bi=Li,Xi=Symbol(),Ui=Symbol(),ki=Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions"),zi=Symbol(),ji=Symbol(),Gi=Symbol(),Hi=Symbol(),qi=Symbol(),Yi=Symbol(),Wi=Symbol("X3DBaseNode.set_live__"),Ki=Symbol(),Ji=Symbol();function Zi(t){if(!this[Xi]){P.call(this,t.getBrowser()),this[Xi]=t,this[Ui]=[c.X3DBaseNode],this[zi]=new J,this[ji]=new J,this[Gi]=new Map,this[Hi]=new J,this[Yi]=!0,this[qi]=!1,this[Ki]=!1,this[Ji]=0,this.canUserDefinedFields()&&(this[ki]=new Y(this[ki]));for(const t of this[ki])this.addField(t);this.addChildObjects("name_changed",new Ri.SFTime,"typeName_changed",new Ri.SFTime,"fields_changed",new Ri.SFTime,"cloneCount_changed",new Ri.SFTime)}}Zi.prototype=Object.assign(Object.create(P.prototype),{constructor:Zi,[ki]:new Y([]),setName:function(t){P.prototype.setName.call(this,t),this[qi]&&(this._name_changed=this.getBrowser().getCurrentTime())},getMainScene:function(){let t=this[Xi].getScene();for(;!t.isMainScene();)t=t.getScene();return t},getScene:function(){let t=this[Xi];for(;!t.isScene();)t=t.getExecutionContext();return t},getExecutionContext:function(){return this[Xi]},setExecutionContext:function(t){this[Xi]=t},addType:function(t){this[Ui].push(t)},getType:function(){return this[Ui]},getInnerNode:function(){return this},isLive:function(){function t(){return this._isLive}return function(){return Object.defineProperty(this,"isLive",{value:t,enumerable:!1,configurable:!0}),this.addChildObjects("isLive",new Ri.SFBool(this.getLiveState())),this._isLive.removeParent(this),this.getOuterNode&&this.getOuterNode()?this.getOuterNode().isLive().addInterest(Wi,this):this[Xi]!==this&&this[Xi].isLive().addInterest(Wi,this),this.isLive()}}(),setLive:function(t){this[Yi]=t.valueOf(),this[Wi]()},getLive:function(){return this[Yi]},getLiveState:function(){return this.getOuterNode&&this.getOuterNode()?this.getLive()&&this.getOuterNode().isLive().getValue():this!==this[Xi]?this.getLive()&&this[Xi].isLive().getValue():this.getLive()},[Wi]:function(){const t=this.getLiveState(),e=this.isLive();if(t){if(e.getValue())return;e.set(!0),e.processEvent()}else e.getValue()&&(e.set(!1),e.processEvent())},create:function(t){return new this.constructor(t||this[Xi])},setup:function(){const t={value:Function.prototype,enumerable:!1};return function(){Object.defineProperty(this,"setup",t);for(const t of this[zi])t.setTainted(!1);this.initialize(),this[qi]=!0}}(),initialize:function(){},isInitialized:function(){return this[qi]},copy:function(t){const e=this.create(t);if(this.canUserDefinedFields())for(const t of this[ki])e.getFields().has(t.name)||e.addUserDefinedField(t.accessType,t.name,t.value.copy());for(const t of this[zi])e.getFields().get(t.getName()).assign(t);return e.setup(),e},addChildObjects:function(t,e){for(let t=0,e=arguments.length;t<e;t+=2)this.addChildObject(arguments[t],arguments[t+1])},addChildObject:function(t,e){e.addParent(this),e.setName(t),Object.defineProperty(this,"_"+t,{get:function(){return e},set:function(t){e.setValue(t)},enumerable:!1,configurable:!1})},getFieldDefinitions:function(){return this[ki]},getFieldsAreEnumerable:function(){return!1},addField:function(t){const e=t.accessType,n=t.name,i=t.value.copy();i.setTainted(!this[qi]),i.addParent(this),i.setName(n),i.setAccessType(e),this[zi].add(n,i),this[ji].add(n,i),Object.defineProperty(this,"_"+n,{get:function(){return i},set:function(t){i.setValue(t)},enumerable:this.getFieldsAreEnumerable(),configurable:!0}),this.isPrivate()||i.addCloneCount(1),this[qi]&&(this._fields_changed=this.getBrowser().getCurrentTime())},getField:function(){const t=/^set_(.*?)$/,e=/^(.*?)_changed$/;return function(n){const i=this[zi].get(n)||this[Gi].get(n);if(i)return i;const o=n.match(t);if(o){const t=this[zi].get(o[1])||this[Gi].get(o[1]);if(t&&t.getAccessType()===c.inputOutput)return t}else{const t=n.match(e);if(t){const e=this[zi].get(t[1])||this[Gi].get(t[1]);if(e&&e.getAccessType()===c.inputOutput)return e}}throw new Error("Unknown field '"+n+"' in node class "+this.getTypeName()+".")}}(),addAlias:function(t,e){this[Gi].set(t,e),Object.defineProperty(this,"_"+t,{get:function(){return e},set:function(t){e.setValue(t)},enumerable:!0,configurable:!1}),e.isInitializable()&&Bi.addFieldName(t)},removeField:function(t){const e=this[ji].get(t);e&&(e.removeParent(this),this[zi].remove(t),this[ji].remove(t),delete this["_"+e.getName()],this.isPrivate()||e.removeCloneCount(1),this[qi]&&(this._fields_changed=this.getBrowser().getCurrentTime()))},canUserDefinedFields:function(){return!1},addUserDefinedField:function(t,e,n){this[Hi].has(e)&&this.removeUserDefinedField(e),n.setTainted(!this[qi]),n.addParent(this),n.setName(e),n.setAccessType(t),this[ki].add(e,new B(t,e,n)),this[zi].add(e,n),this[Hi].add(e,n),this.isPrivate()||n.addCloneCount(1),this[qi]&&(this._fields_changed=this.getBrowser().getCurrentTime())},removeUserDefinedField:function(t){const e=this[Hi].get(t);e&&(e.removeParent(this),this[zi].remove(t),this[Hi].remove(t),this[ki].remove(t),this.isPrivate()||e.removeCloneCount(1),this[qi]&&(this._fields_changed=this.getBrowser().getCurrentTime()))},getUserDefinedFields:function(){return this[Hi]},getPredefinedFields:function(){return this[ji]},getChangedFields:function(t){const e=[];if(t)for(const t of this[Hi])e.push(t);for(const n of this[ji])if(t&&(n.getInputRoutes().size||n.getOutputRoutes().size))e.push(n);else{if(0===n.getReferences().size){if(!n.isInitializable())continue;if(this.isDefaultValue(n))continue}e.push(n)}return e},isDefaultValue:function(t){const e=this.getFieldDefinitions().get(t.getName());return e?e.value.equals(t):!t.getModificationTime()},getFields:function(){return this[zi]},getSourceText:function(){return null},hasRoutes:function(){for(const t of this[zi]){if(t.getInputRoutes().size)return!0;if(t.getOutputRoutes().size)return!0}return!1},isPrivate:function(){return this[Ki]},setPrivate:function(t){if(this[Ki]=t,t)for(const t of this[zi])t.removeCloneCount(1);else for(const t of this[zi])t.addCloneCount(1)},getCloneCount:function(){return this[Ji]},addCloneCount:function(t){if(0===t)return;const e=this.getBrowser().getCurrentTime();this[Ji]+=t,this[Xi]._sceneGraph_changed=e,this[qi]&&(this._cloneCount_changed=e)},removeCloneCount:function(t){if(0===t)return;const e=this.getBrowser().getCurrentTime();this[Ji]-=t,this[Xi]._sceneGraph_changed=e,this[qi]&&(this._cloneCount_changed=e)},getEnum:function(t,e,n){return t.hasOwnProperty(e)?t[e]:n},dispose:function(){for(const t of this.getFields())t.dispose();P.prototype.dispose.call(this)}});for(const t of Reflect.ownKeys(Zi.prototype))Object.defineProperty(Zi.prototype,t,{enumerable:!1});const Qi=Zi;n.set("x_ite/Base/X3DBaseNode",Qi);const $i=Qi,to="8.4.4a";n.set("x_ite/Browser/VERSION",to);const eo=to;n.set("x_ite/DEBUG",false);const no=false,io=["ANGLE_instanced_arrays","EXT_blend_minmax","EXT_frag_depth","EXT_shader_texture_lod","EXT_texture_filter_anisotropic","OES_element_index_uint","OES_standard_derivatives","OES_texture_float","OES_texture_float_linear","OES_texture_half_float","OES_texture_half_float_linear","OES_vertex_array_object","WEBGL_compressed_texture_s3tc","WEBGL_debug_shaders","WEBGL_depth_texture","WEBGL_draw_buffers","WEBGL_lose_context","EXT_color_buffer_float","EXT_color_buffer_half_float","EXT_disjoint_timer_query","EXT_disjoint_timer_query_webgl2","EXT_sRGB","WEBGL_color_buffer_float","WEBGL_compressed_texture_astc","WEBGL_compressed_texture_atc","WEBGL_compressed_texture_etc","WEBGL_compressed_texture_etc1","WEBGL_compressed_texture_pvrtc","WEBGL_compressed_texture_s3tc","WEBGL_compressed_texture_s3tc_srgb","EXT_float_blend","OES_fbo_render_mipmap","WEBGL_get_buffer_sub_data_async","WEBGL_multiview","WEBGL_security_sensitive_resources","WEBGL_shared_resources","EXT_clip_cull_distance","WEBGL_debug","WEBGL_dynamic_texture","WEBGL_subarray_uploads","WEBGL_texture_multisample","WEBGL_texture_source_iframe","WEBGL_video_texture","EXT_texture_storage","OES_depth24","WEBGL_debug_shader_precision","WEBGL_draw_elements_no_range_check","WEBGL_subscribe_uniform","WEBGL_texture_from_depth_video"],oo={create:function(t,e,n){const i={preserveDrawingBuffer:n};let o=null;if(e>=2&&!o&&(o=t.getContext("webgl2",i),o&&(o.getVersion=function(){return 2})),e>=1&&!o&&(o=t.getContext("webgl",i)||t.getContext("experimental-webgl",i),o)){o.getVersion=function(){return 1};{const t=o.getExtension("OES_vertex_array_object");o.bindVertexArray=t.bindVertexArrayOES.bind(t),o.createVertexArray=t.createVertexArrayOES.bind(t),o.deleteVertexArray=t.deleteVertexArrayOES.bind(t),o.isVertexArray=t.isVertexArrayOES.bind(t)}}if(!o)throw new Error("Couldn't create WebGL context.");const r=o.getParameter(o.ALIASED_LINE_WIDTH_RANGE);1===r[0]&&1===r[1]?(o.lineWidth=Function.prototype,o.HAS_FEATURE_TRANSFORMED_LINES=o.getVersion()>=2):o.HAS_FEATURE_TRANSFORMED_LINES=!1,o.HAS_FEATURE_DEPTH_TEXTURE=o.getVersion()>=2||!!o.getExtension("WEBGL_depth_texture"),o.HAS_FEATURE_FRAG_DEPTH=o.getVersion()>=2||!!o.getExtension("EXT_frag_depth");for(const t of io)o.getExtension(t);return o}};n.set("x_ite/Browser/Core/Context",oo);const ro=oo,so='msgid ""\nmsgstr ""\n"Project-Id-Version: X_ITE\n"\n"POT-Creation-Date: 2015-12-23 04:56+0100\n"\n"PO-Revision-Date: 2015-12-23 04:57+0100\n"\n"Last-Translator: Holger Seelig <holger.seelig@yahoo.de>\n"\n"Language-Team: \n"\n"Language: de\n"\n"MIME-Version: 1.0\n"\n"Content-Type: text/plain; charset=UTF-8\n"\n"Content-Transfer-Encoding: 8bit\n"\n"X-Generator: Poedit 1.8.4\n"\n"X-Poedit-Basepath: ../x_ite\n"\n"Plural-Forms: nplurals=2; plural=(n != 1);\n"\n"X-Poedit-SourceCharset: UTF-8\n"\n"X-Poedit-SearchPath-0: .\n"\n\nmsgid "Less Properties"\nmsgstr "Weniger Eigenschaften"\n\nmsgid "More Properties"\nmsgstr "Mehr Eigenschaften"\n\nmsgid "Frame rate"\nmsgstr "Bildrate"\n\nmsgid "fps"\nmsgstr "BpS"\n\nmsgid "Speed"\nmsgstr "Geschwindigkeit"\n\nmsgid "m/s"\nmsgstr ""\n\nmsgid "km/h"\nmsgstr ""\n\nmsgid "Browser"\nmsgstr ""\n\nmsgid "ms"\nmsgstr ""\n\nmsgid "X3D total"\nmsgstr "X3D gesamt"\n\nmsgid "Event Processing"\nmsgstr "Ereignisverarbeitung"\n\nmsgid "Pointer"\nmsgstr "ZeigegerÃ¤t"\n\nmsgid "Camera"\nmsgstr "Kamera"\n\nmsgid "Collision Detection"\nmsgstr "Kollisionserkennung"\n\nmsgid "Rendering"\nmsgstr "Rendering"\n\nmsgid "Number of Shapes"\nmsgstr "Anzahl der Formen"\n\nmsgid "Number of Sensors"\nmsgstr "Anzahl der Sensoren"\n\nmsgid "Browser Timings"\nmsgstr "Zeitberechnung"\n\nmsgid "X_ITE Browser"\nmsgstr ""\n\nmsgid "Viewpoints"\nmsgstr "Ansichtspunkte"\n\nmsgid "Available Viewers"\nmsgstr "VerfÃ¼gbare Betrachter"\n\nmsgid "Straighten Horizon"\nmsgstr "Horizont gerade richten"\n\nmsgid "Primitive Quality"\nmsgstr "QualitÃ¤t der Grundobjekte"\n\nmsgid "High"\nmsgstr "Hoch"\n\nmsgid "high"\nmsgstr "hoch"\n\nmsgid "Medium"\nmsgstr "Mittel"\n\nmsgid "medium"\nmsgstr "mittel"\n\nmsgid "Low"\nmsgstr "Niedrig"\n\nmsgid "low"\nmsgstr "niedrig"\n\nmsgid "Texture Quality"\nmsgstr "Textur QualitÃ¤t"\n\nmsgid "Display Rubberband"\nmsgstr "Gummiband anzeigen"\n\nmsgid "Rubberband"\nmsgstr "Gummiband"\n\nmsgid "on"\nmsgstr "an"\n\nmsgid "off"\nmsgstr "aus"\n\nmsgid "Mute Browser"\nmsgstr "Browser stumm schalten"\n\nmsgid "Browser muted"\nmsgstr "Browser stumm geschalten"\n\nmsgid "Browser unmuted"\nmsgstr "Browser Ton an"\n\nmsgid "Leave Fullscreen"\nmsgstr "Vollbild verlassen"\n\nmsgid "Fullscreen"\nmsgstr "Vollbild"\n\nmsgid "About X_ITE"\nmsgstr "Ãber X_ITE"\n\nmsgid "Examine Viewer"\nmsgstr "Untersuchen"\n\nmsgid "Walk Viewer"\nmsgstr "Laufen"\n\nmsgid "Fly Viewer"\nmsgstr "Fliegen"\n\nmsgid "Plane Viewer"\nmsgstr "Ebenen Betrachter"\n\nmsgid "Look At Viewer"\nmsgstr "Auf Objekte zielen"\n\nmsgid "None Viewer"\nmsgstr "Kein Betrachter"\n\nmsgid "Loading %1 file"\nmsgstr "Lade %1 Datei"\n\nmsgid "Loading %1 files"\nmsgstr "Lade %1 Dateien"\n\nmsgid "Loading done"\nmsgstr "Fertig mit Laden"\n\nmsgid "Failed loading world."\nmsgstr "Laden der Dateien fehlgeschlagen."\n\nmsgid "Show World Info"\nmsgstr "World Info anzeigen"\n\nmsgid "Viewpoint is copied to clipboard."\nmsgstr "Ansichtspunkt wurde in die Zwischenablage kopiert."\n';n.set("locale/de.po",so);const ao=so,uo='msgid ""\nmsgstr ""\n"Project-Id-Version: X_ITE\n"\n"POT-Creation-Date: 2015-12-23 04:58+0100\n"\n"PO-Revision-Date: 2015-12-23 05:07+0100\n"\n"Last-Translator: Holger Seelig <holger.seelig@yahoo.de>\n"\n"Language-Team: \n"\n"Language: fr\n"\n"MIME-Version: 1.0\n"\n"Content-Type: text/plain; charset=UTF-8\n"\n"Content-Transfer-Encoding: 8bit\n"\n"X-Generator: Poedit 1.8.4\n"\n"X-Poedit-Basepath: ../x_ite\n"\n"Plural-Forms: nplurals=2; plural=(n != 1);\n"\n"X-Poedit-SourceCharset: UTF-8\n"\n"X-Poedit-SearchPath-0: .\n"\n\nmsgid "Less Properties"\nmsgstr "Moins de propriÃ©tÃ©s"\n\nmsgid "More Properties"\nmsgstr "Plus de propriÃ©tÃ©s"\n\nmsgid "Frame rate"\nmsgstr "FrÃ©quence"\n\nmsgid "fps"\nmsgstr "fps"\n\nmsgid "Speed"\nmsgstr "VÃ©locitÃ©"\n\nmsgid "m/s"\nmsgstr ""\n\nmsgid "km/h"\nmsgstr ""\n\nmsgid "Browser"\nmsgstr "X_ITE Navigateur"\n\nmsgid "ms"\nmsgstr ""\n\nmsgid "X3D total"\nmsgstr "X3D total"\n\nmsgid "Traitement des Ã©vÃ©nements"\nmsgstr "Routes"\n\nmsgid "Pointer"\nmsgstr "Pointeur"\n\nmsgid "Camera"\nmsgstr "CamÃ©ra"\n\nmsgid "Collision Detection"\nmsgstr "DÃ©tection des collisions"\n\nmsgid "Rendering"\nmsgstr "Rendement"\n\nmsgid "Number of Shapes"\nmsgstr "Nombre de formes"\n\nmsgid "Number of Sensors"\nmsgstr "Nombre de senseurs"\n\nmsgid "Browser Timings"\nmsgstr "Calcul du temps"\n\nmsgid "X_ITE Browser"\nmsgstr "X_ITE Navigateur"\n\nmsgid "Viewpoints"\nmsgstr "Points de vue"\n\nmsgid "Available Viewers"\nmsgstr "Visionneurs disponibles"\n\nmsgid "Straighten Horizon"\nmsgstr "Redresser l\'horizon"\n\nmsgid "Primitive Quality"\nmsgstr "QualitÃ© des objets simples"\n\nmsgid "High"\nmsgstr "Haut"\n\nmsgid "high"\nmsgstr "haut"\n\nmsgid "Medium"\nmsgstr "Moyenne"\n\nmsgid "medium"\nmsgstr "moyenne"\n\nmsgid "Low"\nmsgstr "Faible"\n\nmsgid "low"\nmsgstr "faible"\n\nmsgid "Texture Quality"\nmsgstr "QualitÃ© des textures"\n\nmsgid "Display Rubberband"\nmsgstr "PrÃ©senter le bande Ã©lastique"\n\nmsgid "Rubberband"\nmsgstr "Bande Ã©lastique"\n\nmsgid "on"\nmsgstr "marche"\n\nmsgid "off"\nmsgstr "arrÃªt"\n\nmsgid "Mute Browser"\nmsgstr "Rendre navigateur muet"\n\nmsgid "Browser muted"\nmsgstr "Navigateur muet"\n\nmsgid "Browser unmuted"\nmsgstr "Son de navigateur rÃ©activÃ©"\n\nmsgid "Leave Fullscreen"\nmsgstr "Sortie en plein Ã©cran"\n\nmsgid "Fullscreen"\nmsgstr "Plein Ã©cran"\n\nmsgid "About X_ITE"\nmsgstr "Ã propos de X_ITE"\n\nmsgid "Examine Viewer"\nmsgstr "Examiner"\n\nmsgid "Walk Viewer"\nmsgstr "Aller"\n\nmsgid "Fly Viewer"\nmsgstr "Voler"\n\nmsgid "Plane Viewer"\nmsgstr "Visionneur de la plaine"\n\nmsgid "Look At Viewer"\nmsgstr "Regarder un objet de prÃ¨s"\n\nmsgid "None Viewer"\nmsgstr "Pas de visionneur"\n\nmsgid "Loading %1 file"\nmsgstr "TÃ©lÃ©charger %1 fichier"\n\nmsgid "Loading %1 files"\nmsgstr "TÃ©lÃ©charger %1 fichiers"\n\nmsgid "Loading done"\nmsgstr "TÃ©lÃ©chargement fini"\n\nmsgid "Failed loading world."\nmsgstr "Le chargement des fichiers a Ã©chouÃ©."\n\nmsgid "Show World Info"\nmsgstr "Afficher World Info"\n\nmsgid "Viewpoint is copied to clipboard."\nmsgstr "Le point de vue est copiÃ© dans le presse-papiers."\n';n.set("locale/fr.po",uo);const co={en:"C",de:ao,fr:uo},lo=/msgid\s+"(.*?)"\nmsgstr\s+"(.*?)"\n/g,ho=function(){for(const t of navigator.languages){const e=t.split("-")[0];if(co[e])return e}return(navigator.language||navigator.userLanguage).split("-")[0]}();!function(t){if(co[t]){const i=function(t,e){const n=[];let i=null;for(;i=t.exec(e);)n.push(i);return n}(lo,co[t]),o=co[t]={};for(var e=0,n=i.length;e<n;++e)i[e][2].length&&(o[i[e][1]]=i[e][2])}}(ho);const po=function(t){const e=co[ho];if(void 0===e)return t;const n=e[t];return void 0===n?t:n};n.set("locale/gettext",po);const fo=po;var go=i(603);function mo(t){return t.toFixed(2)}function _o(t){$i.call(this,t),this.localStorage=this.getBrowser().getLocalStorage().addNameSpace("BrowserTimings."),this.enabled=!1}_o.prototype=Object.assign(Object.create($i.prototype),{constructor:_o,getTypeName:function(){return"BrowserTimings"},getComponentName:function(){return"X_ITE"},getContainerField:function(){return"browserTimings"},initialize:function(){$i.prototype.initialize.call(this),this.localStorage.addDefaultValues({type:"LESS"}),this.localeOptions={minimumFractionDigits:2,maximumFractionDigits:2},this.startTime=0,this.frames=0,this.element=go("<div></div>").hide().addClass("x_ite-private-browser-timings").appendTo(this.getBrowser().getSurface()),this.table=go("<table></table>").appendTo(this.element),this.header=go("<thead></thead>").append(go("<tr></tr>").append(go("<th colspan='2'></th>"))).appendTo(this.table),this.body=go("<tbody></tbody>").appendTo(this.table),this.footer=go("<tfoot></tfoot>").append(go("<tr></tr>").append(go("<td colspan='2'></td>"))).appendTo(this.table),this.button=go("<button></button>").attr("type","button").appendTo(this.footer.find("td")),this.rows=[],this.button.on("click touchend",this.set_type__.bind(this)),this.set_button__()},getEnabled:function(){return this.enabled},setEnabled:function(t){this.enabled!==t&&(this.enabled=t,t?(this.element.stop(!0,!0).fadeIn(),this.getBrowser().prepareEvents().addInterest("update",this),this.update()):(this.element.stop(!0,!0).fadeOut(),this.getBrowser().prepareEvents().removeInterest("update",this)))},set_type__:function(){"MORE"===this.localStorage.type?this.localStorage.type="LESS":this.localStorage.type="MORE",this.set_button__(),this.build()},set_button__:function(){"MORE"===this.localStorage.type?this.button.text(fo("Less Properties")):this.button.text(fo("More Properties"))},update:function(){const t=this.getBrowser().getCurrentTime();t-this.startTime>1?(this.build(),this.frames=0,this.startTime=t):++this.frames},build:function(){const t=this.getBrowser(),e=t.getCurrentTime(),n=navigator.language||navigator.userLanguage,i=this.localeOptions,o=this.rows;let r=0;if(o[r++]=go("<tr></tr>").append(go("<td></td>").text(fo("Frame rate")+":")).append(go("<td></td>").text(mo(this.frames/(e-this.startTime)).toLocaleString(n,i)+" "+fo("fps"))),o[r++]=go("<tr></tr>").append(go("<td></td>").text(fo("Speed")+":")).append(go("<td></td>").text(mo(this.getSpeed(t.currentSpeed)).toLocaleString(n,i)+" "+this.getSpeedUnit(t.currentSpeed))),"MORE"===this.localStorage.type){const e=t.getWorld().getLayerSet().getLayers(),s=t.getActiveLayer(),a=t.getSystemTime(),u=s&&t.getCollisionCount()?s.collisionTime:0,c=t.getCollisionTime()+u,l=t.getBrowserTime()-(t.getCameraTime()+t.getCollisionTime()+t.getDisplayTime()+u),h=t.prepareEvents().getInterests().size-1,d=t.sensorEvents().getInterests().size;let p=0,f=0;for(const t of e)p+=t.numOpaqueShapes,f+=t.numTransparentShapes;o[1].addClass("x_ite-private-more"),o[r++]=go("<tr></tr>").append(go("<td></td>").text(fo("Browser")+":")).append(go("<td></td>").text(mo(a).toLocaleString(n,i)+" "+fo("ms"))),o[r++]=go("<tr></tr>").append(go("<td></td>").text(fo("X3D total")+":")).append(go("<td></td>").text(mo(t.getBrowserTime()).toLocaleString(n,i)+" "+fo("ms"))),o[r++]=go("<tr></tr>").append(go("<td></td>").text(fo("Event Processing")+":")).append(go("<td></td>").text(mo(l).toLocaleString(n,i)+" "+fo("ms"))),o[r++]=go("<tr></tr>").append(go("<td></td>").text(fo("Pointer")+":")).append(go("<td></td>").text(mo(t.getPointerTime()).toLocaleString(n,i)+" "+fo("ms"))),o[r++]=go("<tr></tr>").append(go("<td></td>").text(fo("Camera")+":")).append(go("<td></td>").text(mo(t.getCameraTime()).toLocaleString(n,i)+" "+fo("ms"))),o[r++]=go("<tr></tr>").append(go("<td></td>").text(fo("Picking")+":")).append(go("<td></td>").text(mo(t.getPickingTime()).toLocaleString(n,i)+" "+fo("ms"))),o[r++]=go("<tr></tr>").append(go("<td></td>").text(fo("Collision Detection")+":")).append(go("<td></td>").text(mo(c).toLocaleString(n,i)+" "+fo("ms"))),o[r++]=go("<tr></tr>").append(go("<td></td>").text(fo("Rendering")+":")).append(go("<td></td>").text(mo(t.getDisplayTime()).toLocaleString(n,i)+" "+fo("ms"))),o[r++]=go("<tr></tr>").append(go("<td></td>").text(fo("Number of Shapes")+":")).append(go("<td></td>").text(p+" + "+f)),o[r++]=go("<tr></tr>").append(go("<td></td>").text(fo("Number of Sensors")+":")).append(go("<td></td>").text(h+d))}o.length=r,this.header.find("th").text(fo("Browser Timings")),this.body.empty(),this.body.append(o)},getSpeed:function(t){return t<15?t:3.6*t},getSpeedUnit:function(t){return fo(t<15?"m/s":"km/h")}});const xo=_o;n.set("x_ite/Browser/Core/BrowserTimings",xo);const yo=xo;let wo=0;const So={LOW:wo++,MEDIUM:wo++,HIGH:wo++};n.set("x_ite/Browser/Core/PrimitiveQuality",So);const To=So;let bo=0;const vo={POINT:bo++,WIREFRAME:bo++,FLAT:bo++,GOURAUD:bo++,PHONG:bo++};n.set("x_ite/Browser/Core/Shading",vo);const Co=vo;let Eo=0;const Oo={LOW:Eo++,MEDIUM:Eo++,HIGH:Eo++};n.set("x_ite/Browser/Core/TextureQuality",Oo);const No=Oo;function Fo(t){$i.call(this,t),this.addAlias("AntiAliased",this._Antialiased);const e=this.getBrowser();this.localStorage=e.getLocalStorage().addNameSpace("BrowserOptions."),this.textureQuality=No.MEDIUM,this.primitiveQuality=To.MEDIUM,this.shading=Co.GOURAUD}Fo.prototype=Object.assign(Object.create($i.prototype),{constructor:Fo,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new Y([new B(c.inputOutput,"SplashScreen",new Ri.SFBool(!0)),new B(c.inputOutput,"Dashboard",new Ri.SFBool(!0)),new B(c.inputOutput,"Rubberband",new Ri.SFBool(!0)),new B(c.inputOutput,"EnableInlineViewpoints",new Ri.SFBool(!0)),new B(c.inputOutput,"Antialiased",new Ri.SFBool(!0)),new B(c.inputOutput,"TextureQuality",new Ri.SFString("MEDIUM")),new B(c.inputOutput,"PrimitiveQuality",new Ri.SFString("MEDIUM")),new B(c.inputOutput,"QualityWhenMoving",new Ri.SFString("MEDIUM")),new B(c.inputOutput,"Shading",new Ri.SFString("GOURAUD")),new B(c.inputOutput,"MotionBlur",new Ri.SFBool),new B(c.inputOutput,"Gravity",new Ri.SFFloat(9.80665)),new B(c.inputOutput,"StraightenHorizon",new Ri.SFBool(!0)),new B(c.inputOutput,"LogarithmicDepthBuffer",new Ri.SFBool(!1)),new B(c.inputOutput,"Timings",new Ri.SFBool(!1))]),getTypeName:function(){return"BrowserOptions"},getComponentName:function(){return"X_ITE"},getContainerField:function(){return"browserOptions"},initialize:function(){$i.prototype.initialize.call(this),this.localStorage.addDefaultValues({Rubberband:this._Rubberband.getValue(),PrimitiveQuality:this._PrimitiveQuality.getValue(),TextureQuality:this._TextureQuality.getValue(),StraightenHorizon:this._StraightenHorizon.getValue(),Timings:this._Timings.getValue()}),this._Rubberband.addInterest("set_rubberband__",this),this._PrimitiveQuality.addInterest("set_primitiveQuality__",this),this._TextureQuality.addInterest("set_textureQuality__",this),this._Shading.addInterest("set_shading__",this),this._StraightenHorizon.addInterest("set_straightenHorizon__",this),this._LogarithmicDepthBuffer.addInterest("set_logarithmicDepthBuffer__",this),this._Timings.addInterest("set_timings__",this),this.configure()},configure:function(){const t=this.localStorage;for(const e of this.getFieldDefinitions()){const n=this.getField(e.name);void 0===t[e.name]&&(n.equals(e.value)||n.assign(e.value))}const e=t.Rubberband,n=t.PrimitiveQuality,i=t.TextureQuality,o=t.StraightenHorizon,r=t.Timings;e!==this._Rubberband.getValue()&&(this._Rubberband=e),n!==this._PrimitiveQuality.getValue()&&(this._PrimitiveQuality=n),i!==this._TextureQuality.getValue()&&(this._TextureQuality=i),o!==this._StraightenHorizon.getValue()&&(this._StraightenHorizon=o),r!==this._Timings.getValue()&&(this._Timings=r)},getAttribute:function(t){const e=this.getBrowser().getElement();return e.attr(t)||e.attr(t.toLowerCase())},toBoolean:function(t,e){return"true"===(t=String(t).toLowerCase())||"false"!==t&&e},getCache:function(){return this.toBoolean(this.getAttribute("cache"),!0)},getContextMenu:function(){return this.toBoolean(this.getAttribute("contextMenu"),!0)},getDebug:function(){return this.toBoolean(this.getAttribute("debug"),!1)},getNotifications:function(){return this.toBoolean(this.getAttribute("notifications"),!0)},getSplashScreen:function(){return this.toBoolean(this.getAttribute("splashScreen"),this._SplashScreen.getValue())},getPrimitiveQuality:function(){return this.primitiveQuality},getShading:function(){return this.shading},getTextureQuality:function(){return this.textureQuality},set_rubberband__:function(t){this.localStorage.Rubberband=t.getValue()},set_primitiveQuality__:function(t){const e=this.getBrowser(),n=t.getValue().toUpperCase();this.localStorage.PrimitiveQuality=n,this.primitiveQuality=this.getEnum(To,n,To.MEDIUM),"function"==typeof e.setPrimitiveQuality2D&&e.setPrimitiveQuality2D(this.primitiveQuality),"function"==typeof e.setPrimitiveQuality3D&&e.setPrimitiveQuality3D(this.primitiveQuality)},set_textureQuality__:function(t){const e=this.getBrowser(),n=t.getValue().toUpperCase();this.localStorage.TextureQuality=n,this.textureQuality=this.getEnum(No,n,No.MEDIUM),"function"==typeof e.setTextureQuality&&e.setTextureQuality(this.textureQuality)},set_shading__:function(){const t={[Co.POINT]:"POINT",[Co.WIREFRAME]:"WIREFRAME",[Co.FLAT]:"FLAT",[Co.GOURAUD]:"GOURAUD",[Co.PHONG]:"PHONG"};return function(e){const n=this.getBrowser(),i=e.getValue().toUpperCase().replace("POINTSET","POINT");this.shading=this.getEnum(Co,i,Co.GOURAUD),n.getRenderingProperties()._Shading=t[this.shading],n.setShading(this.shading)}}(),set_straightenHorizon__:function(t){this.localStorage.StraightenHorizon=t.getValue()},set_logarithmicDepthBuffer__:function(t){const e=this.getBrowser(),n=e.getContext();e.getRenderingProperties()._LogarithmicDepthBuffer=t.getValue()&&n.HAS_FEATURE_FRAG_DEPTH},set_timings__:function(t){this.localStorage.Timings=t.getValue(),this.getBrowser().getBrowserTimings().setEnabled(t.getValue())}});const Io=Fo;n.set("x_ite/Browser/Core/BrowserOptions",Io);const Mo=Io;function Do(t){$i.call(this,t)}Do.prototype=Object.assign(Object.create($i.prototype),{constructor:Do,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new Y([new B(c.initializeOnly,"ABSTRACT_NODES",new Ri.SFBool(!0)),new B(c.initializeOnly,"CONCRETE_NODES",new Ri.SFBool(!0)),new B(c.initializeOnly,"EXTERNAL_INTERACTIONS",new Ri.SFBool(!0)),new B(c.initializeOnly,"PROTOTYPE_CREATE",new Ri.SFBool(!0)),new B(c.initializeOnly,"DOM_IMPORT",new Ri.SFBool(!0)),new B(c.initializeOnly,"XML_ENCODING",new Ri.SFBool(!0)),new B(c.initializeOnly,"CLASSIC_VRML_ENCODING",new Ri.SFBool(!0)),new B(c.initializeOnly,"BINARY_ENCODING",new Ri.SFBool)]),getTypeName:function(){return"BrowserProperties"},getComponentName:function(){return"X_ITE"},getContainerField:function(){return"browserProperties"}});const Vo=Do;n.set("x_ite/Browser/Core/BrowserProperties",Vo);const Ro=Vo;function Po(t){$i.call(this,t),this.addAlias("AntiAliased",this._Antialiased)}Po.prototype=Object.assign(Object.create($i.prototype),{constructor:Po,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new Y([new B(c.outputOnly,"Shading",new Ri.SFString),new B(c.outputOnly,"MaxTextureSize",new Ri.SFInt32),new B(c.outputOnly,"TextureUnits",new Ri.SFInt32),new B(c.outputOnly,"MaxLights",new Ri.SFInt32),new B(c.outputOnly,"Antialiased",new Ri.SFBool(!0)),new B(c.outputOnly,"ColorDepth",new Ri.SFInt32),new B(c.outputOnly,"TextureMemory",new Ri.SFDouble),new B(c.outputOnly,"LogarithmicDepthBuffer",new Ri.SFBool(!1))]),getTypeName:function(){return"RenderingProperties"},getComponentName:function(){return"X_ITE"},getContainerField:function(){return"renderingProperties"},initialize:function(){$i.prototype.initialize.call(this);const t=this.getBrowser();this._MaxTextureSize=t.getMaxTextureSize(),this._TextureUnits=t.getMaxCombinedTextureUnits(),this._MaxLights=t.getMaxLights(),this._ColorDepth=t.getColorDepth(),this._TextureMemory=t.getTextureMemory()}});const Ao=Po;n.set("x_ite/Browser/Core/RenderingProperties",Ao);const Lo=Ao;var Bo=i(603);function Xo(t){$i.call(this,t),this.addChildObjects("string",new Ln)}Bo.fn.textWidth=function(t){const e=Bo(this).children(),n="<span>"+Bo(this).html()+"</span>";Bo(this).html(n);const i=Bo(this).find("span:first").width();return Bo(this).empty(),Bo(this).append(e),i},Xo.prototype=Object.assign(Object.create($i.prototype),{constructor:Xo,getTypeName:function(){return"Notification"},getComponentName:function(){return"X_ITE"},initialize:function(){$i.prototype.initialize.call(this),this.element=Bo("<div></div>").hide().addClass("x_ite-private-notification").appendTo(this.getBrowser().getSurface()).animate({width:0}),Bo("<span></span>").appendTo(this.element),this._string.addInterest("set_string__",this)},set_string__:function(){this.getBrowser().getBrowserOptions().getNotifications()&&0!==this._string.length&&(this.element.children().text(this._string.getValue()),this.element.stop(!0,!0).fadeIn(0).animate({width:this.element.textWidth()}).animate({delay:1},5e3).animate({width:0}).fadeOut(0))}});const Uo=Xo;n.set("x_ite/Browser/Core/Notification",Uo);const ko=Uo;i(151);var zo=i(603);const jo=Symbol();function Go(t){$i.call(this,t),this[jo]=null}Go.prototype=Object.assign(Object.create($i.prototype),{constructor:Go,getTypeName:function(){return"ContextMenu"},getComponentName:function(){return"X_ITE"},getContainerField:function(){return"contextMenu"},initialize:function(){$i.prototype.initialize.call(this);const t=this.getBrowser();this.init({element:t.getElement(),appendTo:t.getShadow(),build:this.build.bind(this),animation:{duration:500,show:"fadeIn",hide:"fadeOut"}})},getUserMenu:function(){return this[jo]},setUserMenu:function(t){this[jo]=t},createUserMenu:function(){const t={};if("function"==typeof this[jo]){const e=this[jo]();if(zo.isPlainObject(e))for(const n in e)t["user-"+n]=e[n]}return t},build:function(t){const e=this.getBrowser(),n=e.getElement().fullScreen();if(!e.getBrowserOptions().getContextMenu())return;const i={className:"x_ite-private-menu",items:{title:{name:e.getName()+" Browser v"+e.getVersion(),className:"context-menu-title context-menu-not-selectable"},separator0:"--------",viewpoints:{name:fo("Viewpoints"),className:"context-menu-icon x_ite-private-icon-viewpoint",items:this.getViewpoints()},"available-viewers":{name:fo("Available Viewers"),items:this.getAvailableViewers()},"straighten-horizon":{name:fo("Straighten Horizon"),type:"checkbox",selected:e.getBrowserOption("StraightenHorizon"),events:{click:function(t){const n=zo(t.target).is(":checked");if(e.setBrowserOption("StraightenHorizon",n),n){e.getNotification()._string=fo("Straighten Horizon")+": "+fo("on");const t=e.getActiveViewpoint();t&&t.straighten(e.getActiveLayer(),!0)}else e.getNotification()._string=fo("Straighten Horizon")+": "+fo("off")}.bind(this)}},"display-rubberband":{name:fo("Display Rubberband"),type:"checkbox",selected:e.getBrowserOption("Rubberband"),events:{click:function(t){const n=zo(t.target).is(":checked");e.setBrowserOption("Rubberband",n),e.getNotification()._string=n?fo("Rubberband")+": "+fo("on"):fo("Rubberband")+": "+fo("off")}.bind(this)}},separator1:"--------","primitive-quality":{name:fo("Primitive Quality"),className:"context-menu-icon x_ite-private-icon-primitive-quality",items:{high:{name:fo("High"),type:"radio",radio:"primitive-quality",selected:"HIGH"===e.getBrowserOption("PrimitiveQuality"),events:{click:function(){e.setBrowserOption("PrimitiveQuality","HIGH"),e.getNotification()._string=fo("Primitive Quality")+": "+fo("high")}.bind(this)}},medium:{name:fo("Medium"),type:"radio",radio:"primitive-quality",selected:"MEDIUM"===e.getBrowserOption("PrimitiveQuality"),events:{click:function(){e.setBrowserOption("PrimitiveQuality","MEDIUM"),e.getNotification()._string=fo("Primitive Quality")+": "+fo("medium")}.bind(this)}},low:{name:fo("Low"),type:"radio",radio:"primitive-quality",selected:"LOW"===e.getBrowserOption("PrimitiveQuality"),events:{click:function(){e.setBrowserOption("PrimitiveQuality","LOW"),e.getNotification()._string=fo("Primitive Quality")+": "+fo("low")}.bind(this)}}}},"texture-quality":{name:fo("Texture Quality"),className:"context-menu-icon x_ite-private-icon-texture-quality",items:{high:{name:fo("High"),type:"radio",radio:"texture-quality",selected:"HIGH"===e.getBrowserOption("TextureQuality"),events:{click:function(){e.setBrowserOption("TextureQuality","HIGH"),e.getNotification()._string=fo("Texture Quality")+": "+fo("high")}.bind(this)}},medium:{name:fo("Medium"),type:"radio",radio:"texture-quality",selected:"MEDIUM"===e.getBrowserOption("TextureQuality"),events:{click:function(){e.setBrowserOption("TextureQuality","MEDIUM"),e.getNotification()._string=fo("Texture Quality")+": "+fo("medium")}.bind(this)}},low:{name:fo("Low"),type:"radio",radio:"texture-quality",selected:"LOW"===e.getBrowserOption("TextureQuality"),events:{click:function(){e.setBrowserOption("TextureQuality","LOW"),e.getNotification()._string=fo("Texture Quality")+": "+fo("low")}.bind(this)}}}},shading:{name:fo("Shading"),className:"context-menu-icon x_ite-private-icon-shading",items:{point:{name:fo("Point"),type:"radio",radio:"shading",selected:"POINT"===e.getBrowserOption("Shading"),events:{click:function(){e.setBrowserOption("Shading","POINT"),e.getNotification()._string=fo("Shading")+": "+fo("Point")}.bind(this)}},wireframe:{name:fo("Wireframe"),type:"radio",radio:"shading",selected:"WIREFRAME"===e.getBrowserOption("Shading"),events:{click:function(){e.setBrowserOption("Shading","WIREFRAME"),e.getNotification()._string=fo("Shading")+": "+fo("Wireframe")}.bind(this)}},flat:{name:fo("Flat"),type:"radio",radio:"shading",selected:"FLAT"===e.getBrowserOption("Shading"),events:{click:function(){e.setBrowserOption("Shading","FLAT"),e.getNotification()._string=fo("Shading")+": "+fo("Flat")}.bind(this)}},gouraud:{name:fo("Gouraud"),type:"radio",radio:"shading",selected:"GOURAUD"===e.getBrowserOption("Shading"),events:{click:function(){e.setBrowserOption("Shading","GOURAUD"),e.getNotification()._string=fo("Shading")+": "+fo("Gouraud")}.bind(this)}},phong:{name:fo("Phong"),type:"radio",radio:"shading",selected:"PHONG"===e.getBrowserOption("Shading"),events:{click:function(){e.setBrowserOption("Shading","PHONG"),e.getNotification()._string=fo("Shading")+": "+fo("Phong")}.bind(this)}}}},separator2:"--------","browser-timings":{name:fo("Browser Timings"),type:"checkbox",selected:e.getBrowserOption("Timings"),events:{click:function(t){e.setBrowserOption("Timings",zo(t.target).is(":checked")),e.getSurface().focus()}.bind(this)}},fullscreen:{name:fo(n?"Leave Fullscreen":"Fullscreen"),className:"context-menu-icon "+(n?"x_ite-private-icon-leave-fullscreen":"x_ite-private-icon-enter-fullscreen"),callback:function(){e.getElement().toggleFullScreen()}.bind(this)},separator3:"--------"}};Object.assign(i.items,this.createUserMenu()),Object.assign(i.items,{separator4:"--------","world-info":{name:fo("Show World Info"),className:"context-menu-icon x_ite-private-icon-world-info",callback:function(){e.getShadow().find(".x_ite-private-world-info").remove();const t=e.getShadow().find(".x_ite-private-browser"),n=zo("<div></div>").addClass("x_ite-private-world-info-overlay").appendTo(t),i=zo("<div></div>").addClass("x_ite-private-world-info").appendTo(n),o=e.getExecutionContext().getWorldInfos()[0],r=o.title,s=o.info;zo("<div></div>").addClass("x_ite-private-world-info-top").text("World Info").appendTo(i),r.length&&zo("<div></div>").addClass("x_ite-private-world-info-title").text(r).appendTo(i);for(const t of s)zo("<div></div>").addClass("x_ite-private-world-info-info").text(t).appendTo(i);i.find("a").on("click",(function(t){t.stopPropagation()})),i.find("a[href^=http]").each((function(){-1===this.href.indexOf(location.hostname)&&zo(this).attr("target","_blank")})),n.on("click",(function(){n.remove()}))}},about:{name:fo("About X_ITE"),className:"context-menu-icon x_ite-private-icon-help-about",callback:function(){window.open(e.getProviderUrl())}}}),zo.isEmptyObject(i.items.viewpoints.items)&&delete i.items.viewpoints,Object.keys(i.items["available-viewers"].items).length<2&&delete i.items["available-viewers"],e.getCurrentViewer().match(/^(?:EXAMINE|FLY)$/)||delete i.items["straighten-horizon"],e.getDebug()||delete i.items.shading;const o=e.getExecutionContext().getWorldInfos()[0];return(!o||0===o.title.length&&0===o.info.length)&&delete i.items["world-info"],i},getViewpoints:function(){const t=this.getBrowser(),e=t.getActiveLayer();if(!e)return{};const n=t.getBrowserOption("EnableInlineViewpoints"),i=t.currentScene,o=e.getViewpoints().get(),r=e.getViewpoint(),s={};for(const e of o){const o=e._description.getValue();if(""===o)continue;if(!n&&e.getScene()!==i)continue;const a={name:o,callback:function(e){t.bindViewpoint(t.getActiveLayer(),e),t.getSurface().focus()}.bind(this,e)};e===r&&(a.className="context-menu-selected"),s["Viewpoint"+e.getId()]=a}return s},getAvailableViewers:function(){const t=this.getBrowser(),e=t._viewer.getValue(),n=t._availableViewers,i={};for(const o of n)i[o]={name:fo(this.getViewerName(o)),className:"context-menu-icon x_ite-private-icon-"+o.toLowerCase()+"-viewer",callback:function(e){t._viewer=e,t.getNotification()._string=fo(this.getViewerName(e)),t.getSurface().focus()}.bind(this,o)},o===e&&(i[o].className+=" context-menu-selected");return i},getViewerName:function(t){switch(t){case"EXAMINE":return fo("Examine Viewer");case"WALK":return fo("Walk Viewer");case"FLY":return fo("Fly Viewer");case"PLANE":return fo("Plane Viewer");case"LOOKAT":return fo("Look At Viewer");case"NONE":return fo("None Viewer")}},init:function(t){this.show=this.createRoot.bind(this,t),t.element.on("contextmenu",this.show)},show:function(t){},hide:function(t){},createRoot:function(t,e){const n=t.build(e);if(!n)return;const i=zo("<div></div>").addClass("context-menu-layer").addClass(n.className).appendTo(t.appendTo),o=this.hide=function(){return delete this.hide,i.remove(),r[t.animation.hide](t.animation.duration,(function(){r.remove(),t.events&&"function"==typeof t.events.hide&&t.events.hide()})),!1}.bind(this),r=zo("<ul></ul>").hide().addClass("context-menu-root").addClass("context-menu-list").addClass(n.className).appendTo(t.appendTo).offset({left:e.pageX,top:e.pageY});for(const t in n.items)r.append(this.createItem(n.items[t],"context-menu-root",t,2,o));return r[t.animation.show](t.animation.duration),r.offset({left:e.pageX,top:e.pageY}),r.offset().left-zo(document).scrollLeft()+r.outerWidth()>zo(window).width()&&r.offset({left:zo(document).scrollLeft()+Math.max(0,zo(window).width()-r.outerWidth())}),r.offset().top-zo(document).scrollTop()+r.outerHeight()>zo(window).height()&&r.offset({top:zo(document).scrollTop()+Math.max(0,zo(window).height()-r.outerHeight())}),r.find("ul").each((function(t,e){const n=(e=zo(e)).outerWidth()+r.outerWidth(),i=r.offset().left-zo(document).scrollLeft()+n>zo(window).width()?"right":"left";e.css("width",e.outerWidth()),e.css(i,e.parent().closest("ul").width()),e.outerHeight()>=zo(window).height()&&e.css({"max-height":"100vh","overflow-y":"scroll"})})),r.find("li").on("mouseenter touchstart",(function(t){t.stopImmediatePropagation();const e=zo(t.target).closest("li").children("ul");if(!e.length)return;e.css("top","");const n=e.offset().top+e.outerHeight()-zo(window).scrollTop()-zo(window).height();n>0&&e.offset({top:e.offset().top-n})})),i.on("click contextmenu",o),r.on("contextmenu",o),t.events&&"function"==typeof t.events.show&&t.events.show(r),!1},createItem:function(t,e,n,i,o){const r=zo("<li></li>").addClass("context-menu-item");switch(typeof t){case"string":t.match(/^-+$/)&&r.addClass(["context-menu-separator","context-menu-not-selectable"]);break;case"object":switch(t.className&&r.addClass(t.className),t.type){case"radio":case"checkbox":{const n=zo("<label></label>").appendTo(r),i=zo("<input></input>").appendTo(n);i.attr("type",t.type).attr("name","context-menu-input-"+(t.radio||e)),zo("<span></span>").text(t.name).appendTo(n),t.selected&&i.attr("checked","checked");for(const e in t.events)"function"==typeof t.events[e]&&i.on(e,t.events[e]);r.addClass("context-menu-input");break}default:t.name&&zo("<span></span>").text(t.name).appendTo(r),"function"==typeof t.callback&&r.on("click",t.callback).on("click",o)}}if("object"==typeof t.items&&i<3){const e=zo("<ul></ul>").addClass("context-menu-list").css({"z-index":i}).appendTo(r);for(const r in t.items)e.append(this.createItem(t.items[r],n,r,i+1,o));r.addClass("context-menu-submenu")}return r}});const Ho=Go;n.set("x_ite/Browser/Core/ContextMenu",Ho);const qo=Ho,Yo=Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions"),Wo=new Map,Ko=new Map;let Jo=c.X3DBaseNode;const Zo={addType:function(t,e){c[t]=++Jo,Wo.set(t,e),Bi.addNodeTypeName(t);for(const{name:t,accessType:n}of e.prototype[Yo])n&c.initializeOnly&&Bi.addFieldName(t)},getType:function(t){return Wo.get(t)},getTypes:()=>Array.from(Wo.values()),addAbstractType:function(t,e){c[t]=++Jo,Ko.set(t,e)},getAbstractType:function(t){return Ko.get(t)},getAbstractTypes:()=>Array.from(Ko.values())};n.set("x_ite/Configuration/SupportedNodes",Zo);const Qo=Zo;function $o(t){return G.call(this,t)}$o.prototype=Object.assign(Object.create(G.prototype),{constructor:$o,getTypeName:function(){return"NamedNodesArray"}});for(const t of Reflect.ownKeys($o.prototype))Object.defineProperty($o.prototype,t,{enumerable:!1});const tr=$o;n.set("x_ite/Execution/NamedNodesArray",tr);const er=tr;function nr(t){$i.call(this,t),this.addType(c.X3DNode)}nr.prototype=Object.assign(Object.create($i.prototype),{constructor:nr,copy:function(t){if(!t||t.getType().includes(c.X3DExecutionContext))return $i.prototype.copy.call(this,t);{const e=t.getBody();if(this.getName().length){const t=e.getNamedNodes().get(this.getName());if(t)return t}const n=this.create(e);this.getNeedsName()&&this.getExecutionContext().updateNamedNode(this.getExecutionContext().getUniqueName(),this),this.getName().length&&e.updateNamedNode(this.getName(),n);for(const e of this.getPredefinedFields())try{const i=n.getField(e.getName());if(e.hasReferences())for(const n of e.getReferences())try{i.addReference(t.getField(n.getName()))}catch(t){console.error(t.message)}else if(e.getAccessType()&c.initializeOnly)switch(e.getType()){case c.SFNode:case c.MFNode:i.assign(e.copy(t));break;default:i.assign(e)}i.setModificationTime(e.getModificationTime())}catch(t){console.log(t.message)}for(const e of this.getUserDefinedFields()){const i=e.copy(t);if(n.addUserDefinedField(e.getAccessType(),e.getName(),i),e.hasReferences())for(const n of e.getReferences())try{i.addReference(t.getField(n.getName()))}catch(e){console.error("No reference '"+n.getName()+"' inside execution context "+t.getTypeName()+" '"+t.getName()+"'.")}i.setModificationTime(e.getModificationTime())}return n.setup(),n}},getDisplayName:function(){const t=/_\d+$/;return function(){return this.getName().replace(t,"")}}(),getNeedsName:function(){if(this.getName().length)return!1;if(this.getCloneCount()>1)return!0;if(this.hasRoutes())return!0;const t=this.getExecutionContext();for(const e of t.getImportedNodes())if(e.getInlineNode()===this)return!0;if(t.isScene())for(const e of t.getExportedNodes())if(e.getLocalNode()===this)return!0;return!1},getFieldsAreEnumerable:function(){return!0},traverse:function(){},toStream:function(t){t.string+=this.getTypeName()+" { }"},toVRMLStream:function(t){t.EnterScope();const e=t.Name(this);if(e.length&&t.ExistsNode(this))return t.string+="USE",t.string+=t.Space(),t.string+=e,void t.LeaveScope();e.length&&(t.AddNode(this),t.string+="DEF",t.string+=t.Space(),t.string+=e,t.string+=t.Space()),t.string+=this.getTypeName(),t.string+=t.TidySpace(),t.string+="{";const n=this.getChangedFields(),i=this.getUserDefinedFields();if(this.canUserDefinedFields()&&i.length){let e=0,o=0;for(const n of i)e=Math.max(e,n.getTypeName().length),o=Math.max(o,t.AccessType(n.getAccessType()).length);const r=i.at(-1);t.string+=t.TidyBreak(),t.IncIndent();for(const n of i)this.toVRMLStreamUserDefinedField(t,n,e,o),t.string+=n===r?t.TidyBreak():t.Break();t.DecIndent(),0!==n.length&&(t.string+=t.TidyBreak())}if(0===n.length)i.length?t.string+=t.Indent():t.string+=t.TidySpace();else{const e=n.at(-1);0===i.length&&(t.string+=t.TidyBreak()),t.IncIndent();for(const i of n)this.toVRMLStreamField(t,i),t.string+=i===e?t.TidyBreak():t.Break();t.DecIndent(),t.string+=t.Indent()}t.string+="}",t.LeaveScope()},toVRMLStreamUserDefinedField:function(t,e,n,i){const o=t.IsSharedNode(this);if(0===e.getReferences().size||!t.ExecutionContext()||o)t.string+=t.Indent(),t.string+=t.PadRight(t.AccessType(e.getAccessType()),i),t.string+=t.Space(),t.string+=t.PadRight(e.getTypeName(),n),t.string+=t.Space(),t.string+=e.getName(),e.isInitializable()&&(t.string+=t.Space(),e.toVRMLStream(t));else{let o=0,r=!1;for(const s of e.getReferences())r=r||s.isInitializable(),t.string+=t.Indent(),t.string+=t.PadRight(t.AccessType(e.getAccessType()),i),t.string+=t.Space(),t.string+=t.PadRight(e.getTypeName(),n),t.string+=t.Space(),t.string+=e.getName(),t.string+=t.Space(),t.string+="IS",t.string+=t.Space(),t.string+=s.getName(),++o,o!==e.getReferences().size&&(t.string+=t.Break());e.getAccessType()!==c.inputOutput||r||e.isDefaultValue()||(t.string+=t.Break(),t.string+=t.Indent(),t.string+=t.PadRight(t.AccessType(e.getAccessType()),i),t.string+=t.Space(),t.string+=t.PadRight(e.getTypeName(),n),t.string+=t.Space(),t.string+=e.getName(),e.isInitializable()&&(t.string+=t.Space(),e.toVRMLStream(t)))}},toVRMLStreamField:function(t,e){const n=t.IsSharedNode(this);if(0===e.getReferences().size||!t.ExecutionContext()||n)e.isInitializable()&&(t.string+=t.Indent(),t.string+=e.getName(),t.string+=t.Space(),e.toVRMLStream(t));else{let n=0,i=!1;for(const o of e.getReferences())i=i||o.isInitializable(),t.string+=t.Indent(),t.string+=e.getName(),t.string+=t.Space(),t.string+="IS",t.string+=t.Space(),t.string+=o.getName(),++n,n!==e.getReferences().size&&(t.string+=t.Break());e.getAccessType()!==c.inputOutput||i||this.isDefaultValue(e)||(t.string+=t.Break(),t.string+=t.Indent(),t.string+=e.getName(),t.string+=t.Space(),e.toVRMLStream(t))}},toXMLStream:function(t){const e=t.IsSharedNode(this);t.EnterScope();const n=t.Name(this);if(n.length&&t.ExistsNode(this)){t.string+=t.Indent(),t.string+="<",t.string+=this.getTypeName(),t.string+=t.Space(),t.string+="USE='",t.string+=t.XMLEncode(n),t.string+="'";const e=t.ContainerField();return e&&e.getName()!==this.getContainerField()&&(t.string+=t.Space(),t.string+="containerField='",t.string+=t.XMLEncode(e.getName()),t.string+="'"),t.string+="/>",void t.LeaveScope()}t.string+=t.Indent(),t.string+="<",t.string+=this.getTypeName(),n.length&&(t.AddNode(this),t.string+=t.Space(),t.string+="DEF='",t.string+=t.XMLEncode(n),t.string+="'");const i=t.ContainerField();i&&i.getName()!==this.getContainerField()&&(t.string+=t.Space(),t.string+="containerField='",t.string+=t.XMLEncode(i.getName()),t.string+="'");const o=this.getChangedFields(),r=this.getUserDefinedFields(),s=[],a=[];let u=this.getSourceText();u&&0===u.length&&(u=null),t.IncIndent(),t.IncIndent();for(const n of o){let i=!1;if(t.ExecutionContext()&&n.getAccessType()===c.inputOutput&&0!==n.getReferences().size&&([...n.getReferences()].some((t=>t.isInitializable()))||(i=!this.isDefaultValue(n))),0===n.getReferences().size||!t.ExecutionContext()||e||i){if(i&&s.push(n),n.isInitializable())switch(n.getType()){case c.SFNode:case c.MFNode:a.push(n);break;default:if(n===u)break;t.string+=t.AttribBreak(),t.string+=t.ListIndent(),t.string+=n.getName(),t.string+="='",n.toXMLStream(t),t.string+="'"}}else s.push(n)}if(t.DecIndent(),t.DecIndent(),this.canUserDefinedFields()&&r.length||s.length&&!e||a.length||u){if(t.string+=">",t.string+=t.TidyBreak(),t.IncIndent(),this.canUserDefinedFields())for(const n of r){t.string+=t.Indent(),t.string+="<field",t.string+=t.Space(),t.string+="accessType='",t.string+=t.AccessType(n.getAccessType()),t.string+="'",t.string+=t.Space(),t.string+="type='",t.string+=n.getTypeName(),t.string+="'",t.string+=t.Space(),t.string+="name='",t.string+=t.XMLEncode(n.getName()),t.string+="'";let i=!1;if(t.ExecutionContext()&&n.getAccessType()===c.inputOutput&&0!==n.getReferences().size&&([...n.getReferences()].some((t=>t.isInitializable()))||(i=!this.isDefaultValue(n))),0===n.getReferences().size||!t.ExecutionContext()||e||i)if(i&&t.ExecutionContext()&&s.push(n),!n.isInitializable()||n.isDefaultValue())t.string+="/>",t.string+=t.TidyBreak();else switch(n.getType()){case c.SFNode:case c.MFNode:t.PushContainerField(n),t.string+=">",t.string+=t.TidyBreak(),t.IncIndent(),n.toXMLStream(t),t.string+=t.TidyBreak(),t.DecIndent(),t.string+=t.Indent(),t.string+="</field>",t.string+=t.TidyBreak(),t.PopContainerField();break;default:t.string+=t.Space(),t.string+="value='",n.toXMLStream(t),t.string+="'",t.string+="/>",t.string+=t.TidyBreak()}else t.ExecutionContext()&&s.push(n),t.string+="/>",t.string+=t.TidyBreak()}if(s.length&&!e){t.string+=t.Indent(),t.string+="<IS>",t.string+=t.TidyBreak(),t.IncIndent();for(const e of s){const n=e.getReferences();for(const i of n)t.string+=t.Indent(),t.string+="<connect",t.string+=t.Space(),t.string+="nodeField='",t.string+=t.XMLEncode(e.getName()),t.string+="'",t.string+=t.Space(),t.string+="protoField='",t.string+=t.XMLEncode(i.getName()),t.string+="'",t.string+="/>",t.string+=t.TidyBreak()}t.DecIndent(),t.string+=t.Indent(),t.string+="</IS>",t.string+=t.TidyBreak()}for(const e of a)t.PushContainerField(e),e.toXMLStream(t),t.string+=t.TidyBreak(),t.PopContainerField();if(u)for(const e of u)t.string+="<![CDATA[",t.string+=t.escapeCDATA(e),t.string+="]]>",t.string+=t.TidyBreak();t.DecIndent(),t.string+=t.Indent(),t.string+="</",t.string+=this.getTypeName(),t.string+=">"}else t.string+="/>";t.LeaveScope()},toJSONStream:function(t){try{const e=t.IsSharedNode(this);t.EnterScope();const n=t.Name(this);if(n.length&&t.ExistsNode(this))return t.string+="{",t.string+=t.TidySpace(),t.string+='"',t.string+=this.getTypeName(),t.string+='"',t.string+=":",t.string+=t.TidyBreak(),t.string+=t.IncIndent(),t.string+=t.Indent(),t.string+="{",t.string+=t.TidyBreak(),t.string+=t.IncIndent(),t.string+=t.Indent(),t.string+='"',t.string+="@USE",t.string+='"',t.string+=":",t.string+=t.TidySpace(),t.string+=t.JSONEncode(n),t.string+=t.TidyBreak(),t.string+=t.DecIndent(),t.string+=t.Indent(),t.string+="}",t.string+=t.TidyBreak(),t.string+=t.DecIndent(),t.string+=t.Indent(),t.string+="}",void t.LeaveScope();t.string+="{",t.string+=t.TidySpace(),t.string+='"',t.string+=this.getTypeName(),t.string+='"',t.string+=":",t.string+=t.TidyBreak(),t.string+=t.IncIndent(),t.string+=t.Indent(),t.string+="{",t.string+=t.TidyBreak(),t.string+=t.IncIndent(),n.length&&(t.AddNode(this),t.string+=t.Indent(),t.string+='"',t.string+="@DEF",t.string+='"',t.string+=":",t.string+=t.TidySpace(),t.string+=t.JSONEncode(n),t.string+=",",t.string+=t.TidyBreak());const i=this.getChangedFields(),o=this.getUserDefinedFields(),r=[];let s=this.getSourceText();if(s&&(1!==s.length&&(s=null),s&&!s[0].match(/^\s*(?:ecmascript|javascript|vrmlscript)\:/s)&&(s=null)),i.length){const n=[];for(const o of i){let i=!1;t.ExecutionContext()&&o.getAccessType()===c.inputOutput&&0!==o.getReferences().size&&([...o.getReferences()].some((t=>t.isInitializable()))||(i=!this.isDefaultValue(o))),0===o.getReferences().size||!t.ExecutionContext()||e||i?(i&&r.push(o),o!==s&&n.push(o)):r.push(o)}for(const e of n)if(e.isInitializable()){switch(e.getType()){case c.SFNode:case c.MFNode:t.string+=t.Indent(),t.string+='"',t.string+="-",t.string+=e.getName(),t.string+='"',t.string+=":",t.string+=t.TidySpace(),e.toJSONStream(t);break;default:t.string+=t.Indent(),t.string+='"',t.string+="@",t.string+=e.getName(),t.string+='"',t.string+=":",t.string+=t.TidySpace(),e.toJSONStream(t)}t.string+=",",t.string+=t.TidyBreak()}}if(this.canUserDefinedFields()&&o.length){t.string+=t.Indent(),t.string+='"',t.string+="field",t.string+='"',t.string+=":",t.string+=t.TidySpace(),t.string+="[",t.string+=t.TidyBreak(),t.string+=t.IncIndent();for(const n of o){t.string+=t.Indent(),t.string+="{",t.string+=t.TidyBreak(),t.string+=t.IncIndent(),t.string+=t.Indent(),t.string+='"',t.string+="@accessType",t.string+='"',t.string+=":",t.string+=t.TidySpace(),t.string+='"',t.string+=t.AccessType(n.getAccessType()),t.string+='"',t.string+=",",t.string+=t.TidyBreak(),t.string+=t.Indent(),t.string+='"',t.string+="@type",t.string+='"',t.string+=":",t.string+=t.TidySpace(),t.string+='"',t.string+=n.getTypeName(),t.string+='"',t.string+=",",t.string+=t.TidyBreak(),t.string+=t.Indent(),t.string+='"',t.string+="@name",t.string+='"',t.string+=":",t.string+=t.TidySpace(),t.string+=t.JSONEncode(n.getName());let i=!1;if(t.ExecutionContext()&&n.getAccessType()===c.inputOutput&&0!==n.getReferences().size&&([...n.getReferences()].some((t=>t.isInitializable()))||(i=!this.isDefaultValue(n))),0===n.getReferences().size||!t.ExecutionContext()||e||i)if(i&&t.ExecutionContext()&&r.push(n),!n.isInitializable()||n.isDefaultValue());else switch(t.string+=",",t.string+=t.TidyBreak(),n.getType()){case c.SFNode:t.string+=t.Indent(),t.string+='"',t.string+="-children",t.string+='"',t.string+=":",t.string+=t.TidySpace(),t.string+="[",t.string+=t.TidyBreak(),t.string+=t.IncIndent(),t.string+=t.Indent(),n.toJSONStream(t),t.string+=t.TidyBreak(),t.string+=t.DecIndent(),t.string+=t.Indent(),t.string+="]";break;case c.MFNode:t.string+=t.Indent(),t.string+='"',t.string+="-children",t.string+='"',t.string+=":",t.string+=t.TidySpace(),n.toJSONStream(t);break;default:t.string+=t.Indent(),t.string+='"',t.string+="@value",t.string+='"',t.string+=":",t.string+=t.TidySpace(),n.toJSONStream(t)}else t.ExecutionContext()&&r.push(n);t.string+=t.TidyBreak(),t.string+=t.DecIndent(),t.string+=t.Indent(),t.string+="}",n!==o.at(-1)&&(t.string+=","),t.string+=t.TidyBreak()}t.string+=t.DecIndent(),t.string+=t.Indent(),t.string+="]",t.string+=",",t.string+=t.TidyBreak()}else;if(s){t.string+=t.Indent(),t.string+='"',t.string+="#sourceText",t.string+='"',t.string+=":",t.string+=t.TidySpace(),t.string+="[",t.string+=t.TidyBreak(),t.string+=t.IncIndent();const e=s[0].split("\n");for(let n=0,i=e.length;n<i;++n)t.string+=t.ListIndent(),t.string+=t.JSONEncode(e[n]),n!==i-1&&(t.string+=","),t.string+=t.TidyBreak();t.string+=t.DecIndent(),t.string+=t.Indent(),t.string+="]",t.string+=",",t.string+=t.TidyBreak()}if(r.length&&!e){t.string+=t.Indent(),t.string+='"',t.string+="IS",t.string+='"',t.string+=":",t.string+=t.TidySpace(),t.string+="{",t.string+=t.TidyBreak(),t.string+=t.IncIndent(),t.string+=t.Indent(),t.string+='"',t.string+="connect",t.string+='"',t.string+=":",t.string+=t.TidySpace(),t.string+="[",t.string+=t.TidyBreak(),t.string+=t.IncIndent();for(const e of r){const n=[...e.getReferences()];for(const i of n)t.string+=t.Indent(),t.string+="{",t.string+=t.TidyBreak(),t.string+=t.IncIndent(),t.string+=t.Indent(),t.string+='"',t.string+="@nodeField",t.string+='"',t.string+=":",t.string+=t.TidySpace(),t.string+=t.JSONEncode(e.getName()),t.string+=",",t.string+=t.TidyBreak(),t.string+=t.Indent(),t.string+='"',t.string+="@protoField",t.string+='"',t.string+=":",t.string+=t.TidySpace(),t.string+=t.JSONEncode(i.getName()),t.string+=t.TidyBreak(),t.string+=t.DecIndent(),t.string+=t.Indent(),t.string+="}",e===r.at(-1)&&i===n.at(-1)||(t.string+=","),t.string+=t.TidyBreak()}t.string+=t.DecIndent(),t.string+=t.Indent(),t.string+="]",t.string+=t.TidyBreak(),t.string+=t.DecIndent(),t.string+=t.Indent(),t.string+="}",t.string+=t.TidyBreak()}t.string=t.string.replace(/,(\s*)$/s,"$1"),t.string+=t.DecIndent(),t.string+=t.Indent(),t.string+="}",t.string+=t.TidyBreak(),t.string+=t.DecIndent(),t.string+=t.Indent(),t.string+="}",t.LeaveScope()}catch(t){console.log(t)}},dispose:function(){const t=this.getExecutionContext();if(this.getName()&&t.removeNamedNode(this.getName()),!t.isMainScene()){const e=t.getExecutionContext();for(const t of e.getImportedNodes())try{t.getExportedNode()===this&&e.removeImportedNode(t.getImportedName())}catch(t){}}if(t.isScene())for(const e of t.getExportedNodes())e.getLocalNode()===this&&t.removeExportedNode(e.getExportedName());for(const t of new Set(this.getParents()))if(t instanceof Ri.SFNode){for(const e of new Set(t.getParents()))if(e instanceof Ri.MFNode){const n=e.length;e.erase(e.remove(0,n,t),n)}t.setValue(null)}$i.prototype.dispose.call(this)}});const ir=nr;n.set("x_ite/Components/Core/X3DNode",ir);const or=ir,rr=Symbol(),sr=Symbol(),ar=Symbol(),ur=Symbol();function cr(t,e,n,i){or.call(this,t),this[rr]=e,this[sr]=n,this[ar]=i,this[ur]=new Set,this[rr]._loadState.addInterest("set_loadState__",this)}cr.prototype=Object.assign(Object.create(or.prototype),{constructor:cr,getInlineNode:function(){return this[rr]},getExportedName:function(){return this[sr]},getExportedNode:function(){return this[rr].getInternalScene().getExportedNode(this[sr]).getValue()},getImportedName:function(){return this[ar]},addRoute:function(t,e,n,i){const o={sourceNode:t,sourceField:e,destinationNode:n,destinationField:i};this[ur].add(o),this[rr].checkLoadState()===c.COMPLETE_STATE&&this.resolveRoute(o)},resolveRoute:function(t){try{const e=t.sourceField,n=t.destinationField;let i=t.sourceNode,o=t.destinationNode;t.real&&t.real.dispose(),i instanceof cr&&(i=i.getExportedNode()),o instanceof cr&&(o=o.getExportedNode()),t.real=this.getExecutionContext().addSimpleRoute(i,e,o,n)}catch(t){console.error(t.message)}},deleteRoute:function(t){for(const e of this[ur])e.real===t&&this[ur].delete(e)},deleteRoutes:function(){for(const t of this[ur]){const e=t.real;e&&(delete t.real,this.getExecutionContext().deleteSimpleRoute(e))}},set_loadState__:function(){switch(this[rr].checkLoadState()){case c.NOT_STARTED_STATE:case c.FAILED_STATE:this.deleteRoutes();break;case c.COMPLETE_STATE:this.deleteRoutes();for(const t of this[ur])this.resolveRoute(t)}},toVRMLStream:function(t){if(!t.ExistsNode(this.getInlineNode()))throw new Error("X3DImportedNode.toXMLStream: Inline node does not exist.");t.string+=t.Indent(),t.string+="IMPORT",t.string+=t.Space(),t.string+=t.Name(this.getInlineNode()),t.string+=".",t.string+=this.getExportedName(),this.getImportedName()!==this.getExportedName()&&(t.string+=t.Space(),t.string+="AS",t.string+=t.Space(),t.string+=this.getImportedName());try{t.AddRouteNode(this),t.AddImportedNode(this.getExportedNode(),this.getImportedName())}catch(e){for(const e of this[ur]){const n=e.sourceNode,i=e.sourceField,o=e.destinationNode,r=e.destinationField;if(t.ExistsRouteNode(n)&&t.ExistsRouteNode(o)){const e=n instanceof cr?n.getImportedName():t.Name(n),s=o instanceof cr?o.getImportedName():t.Name(o);t.string+=t.Break(),t.string+=t.TidyBreak(),t.string+=t.Indent(),t.string+="ROUTE",t.string+=t.Space(),t.string+=e,t.string+=".",t.string+=i,t.string+=t.Space(),t.string+="TO",t.string+=t.Space(),t.string+=s,t.string+=".",t.string+=r}}}},toXMLStream:function(t){if(!t.ExistsNode(this.getInlineNode()))throw new Error("X3DImportedNode.toXMLStream: Inline node does not exist.");t.string+=t.Indent(),t.string+="<IMPORT",t.string+=t.Space(),t.string+="inlineDEF='",t.string+=t.XMLEncode(t.Name(this.getInlineNode())),t.string+="'",t.string+=t.Space(),t.string+="importedDEF='",t.string+=t.XMLEncode(this.getExportedName()),t.string+="'",this.getImportedName()!==this.getExportedName()&&(t.string+=t.Space(),t.string+="AS='",t.string+=t.XMLEncode(this.getImportedName()),t.string+="'"),t.string+="/>";try{t.AddRouteNode(this),t.AddImportedNode(this.getExportedNode(),this.getImportedName())}catch(e){for(const e of this[ur]){const n=e.sourceNode,i=e.sourceField,o=e.destinationNode,r=e.destinationField;if(t.ExistsRouteNode(n)&&t.ExistsRouteNode(o)){const e=n instanceof cr?n.getImportedName():t.Name(n),s=o instanceof cr?o.getImportedName():t.Name(o);t.string+=t.Break(),t.string+=t.TidyBreak(),t.string+=t.Indent(),t.string+="<ROUTE",t.string+=t.Space(),t.string+="fromNode='",t.string+=t.XMLEncode(e),t.string+="'",t.string+=t.Space(),t.string+="fromField='",t.string+=t.XMLEncode(i),t.string+="'",t.string+=t.Space(),t.string+="toNode='",t.string+=t.XMLEncode(s),t.string+="'",t.string+=t.Space(),t.string+="toField='",t.string+=t.XMLEncode(r),t.string+="'",t.string+="/>"}}}},toJSONStream:function(t){if(!t.ExistsNode(this.getInlineNode()))throw new Error("X3DImportedNode.toJSONStream: Inline node does not exist.");t.string+=t.Indent(),t.string+="{",t.string+=t.TidySpace(),t.string+='"',t.string+="IMPORT",t.string+='"',t.string+=":",t.string+=t.TidyBreak(),t.string+=t.IncIndent(),t.string+=t.Indent(),t.string+="{",t.string+=t.TidyBreak(),t.string+=t.IncIndent(),t.string+=t.Indent(),t.string+='"',t.string+="@inlineDEF",t.string+='"',t.string+=":",t.string+=t.TidySpace(),t.string+=t.JSONEncode(t.Name(this.getInlineNode())),t.string+=",",t.string+=t.TidyBreak(),t.string+=t.Indent(),t.string+='"',t.string+="@importedDEF",t.string+='"',t.string+=":",t.string+=t.TidySpace(),t.string+=t.JSONEncode(this.getExportedName()),this.getImportedName()!==this.getExportedName()?(t.string+=",",t.string+=t.TidyBreak(),t.string+=t.Indent(),t.string+='"',t.string+="@AS",t.string+='"',t.string+=":",t.string+=t.TidySpace(),t.string+=t.JSONEncode(this.getImportedName()),t.string+=t.TidyBreak()):t.string+=t.TidyBreak(),t.string+=t.DecIndent(),t.string+=t.Indent(),t.string+="}",t.string+=t.TidyBreak(),t.string+=t.DecIndent(),t.string+=t.Indent(),t.string+="}";try{t.AddRouteNode(this),t.AddImportedNode(this.getExportedNode(),this.getImportedName())}catch(e){for(const e of this[ur]){const n=e.sourceNode,i=e.sourceField,o=e.destinationNode,r=e.destinationField;if(t.ExistsRouteNode(n)&&t.ExistsRouteNode(o)){const e=n instanceof cr?n.getImportedName():t.Name(n),s=o instanceof cr?o.getImportedName():t.Name(o);t.string+=",",t.string+=t.TidyBreak(),t.string+=t.Indent(),t.string+="{",t.string+=t.TidySpace(),t.string+='"',t.string+="ROUTE",t.string+='"',t.string+=":",t.string+=t.TidyBreak(),t.string+=t.IncIndent(),t.string+=t.Indent(),t.string+="{",t.string+=t.TidyBreak(),t.string+=t.IncIndent(),t.string+=t.Indent(),t.string+='"',t.string+="@fromNode",t.string+='"',t.string+=":",t.string+=t.TidySpace(),t.string+=t.JSONEncode(e),t.string+=",",t.string+=t.TidyBreak(),t.string+=t.Indent(),t.string+='"',t.string+="@fromField",t.string+='"',t.string+=":",t.string+=t.TidySpace(),t.string+=t.JSONEncode(i),t.string+=",",t.string+=t.TidyBreak(),t.string+=t.Indent(),t.string+='"',t.string+="@toNode",t.string+='"',t.string+=":",t.string+=t.TidySpace(),t.string+=t.JSONEncode(s),t.string+=",",t.string+=t.TidyBreak(),t.string+=t.Indent(),t.string+='"',t.string+="@toField",t.string+='"',t.string+=":",t.string+=t.TidySpace(),t.string+=t.JSONEncode(r),t.string+=t.TidyBreak(),t.string+=t.DecIndent(),t.string+=t.Indent(),t.string+="}",t.string+=t.TidyBreak(),t.string+=t.DecIndent(),t.string+=t.Indent(),t.string+="}"}}}},dispose:function(){this[rr]._loadState.removeInterest("set_loadState__",this),this.deleteRoutes(),or.prototype.dispose.call(this)}});for(const t of Reflect.ownKeys(cr.prototype))Object.defineProperty(cr.prototype,t,{enumerable:!1});Object.defineProperty(cr.prototype,"inlineNode",{get:function(){return mn.get(this[rr])},enumerable:!0,configurable:!1}),Object.defineProperty(cr.prototype,"exportedName",{get:function(){return this[sr]},enumerable:!0,configurable:!1}),Object.defineProperty(cr.prototype,"exportedNode",{get:function(){return this[rr].getInternalScene().getExportedNode(this[sr])},enumerable:!0,configurable:!1}),Object.defineProperty(cr.prototype,"importedName",{get:function(){return this[ar]},enumerable:!0,configurable:!1});const lr=cr;n.set("x_ite/Execution/X3DImportedNode",lr);const hr=lr;function dr(t){return G.call(this,t)}dr.prototype=Object.assign(Object.create(G.prototype),{constructor:dr,getTypeName:function(){return"ImportedNodesArray"}});for(const t of Reflect.ownKeys(dr.prototype))Object.defineProperty(dr.prototype,t,{enumerable:!1});const pr=dr;n.set("x_ite/Execution/ImportedNodesArray",pr);const fr=pr;function gr(t){return G.call(this,t)}gr.prototype=Object.assign(Object.create(G.prototype),{constructor:gr,getTypeName:function(){return"ExternProtoDeclarationArray"}});for(const t of Reflect.ownKeys(gr.prototype))Object.defineProperty(gr.prototype,t,{enumerable:!1});const mr=gr;n.set("x_ite/Prototype/ExternProtoDeclarationArray",mr);const _r=mr;function xr(t){return G.call(this,t)}xr.prototype=Object.assign(Object.create(G.prototype),{constructor:xr,getTypeName:function(){return"ProtoDeclarationArray"}});for(const t of Reflect.ownKeys(xr.prototype))Object.defineProperty(xr.prototype,t,{enumerable:!1});const yr=xr;n.set("x_ite/Prototype/ProtoDeclarationArray",yr);const wr=yr,Sr=Symbol(),Tr=Symbol(),br=Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions"),vr=Symbol();function Cr(t,e){this[Sr]=e,this[Tr]=new Map(e.getFields().map((t=>[t,t.getName()]))),this[br]=e.getFieldDefinitions(),this[vr]=null,or.call(this,t),this.addType(c.X3DPrototypeInstance)}Cr.prototype=Object.assign(Object.create(or.prototype),{constructor:Cr,create:function(t){return new Cr(t,this[Sr])},getTypeName:function(){return this[Sr].getName()},getComponentName:function(){return"Core"},getContainerField:function(){return"children"},initialize:function(){or.prototype.initialize.call(this),this.setProtoNode(this[Sr])},construct:function(){this[vr]&&this[vr].dispose();const t=this[Sr].getProtoDeclaration();if(!t)return this[vr]=new $c(this.getExecutionContext()),this[vr].setOuterNode(this),this[vr].setup(),void(this.isInitialized()&&O.prototype.addEvent.call(this));if(this[Sr].isExternProto)for(const e of t.getUserDefinedFields())try{const t=this.getField(e.getName());if(t.getAccessType()!==e.getAccessType())continue;if(t.getType()!==e.getType())continue;if(!t.isInitializable())continue;if(t.getModificationTime())continue;if(t.hasReferences())continue;if(t.equals(e))continue;t.assign(e)}catch(n){this.addField(t.getFieldDefinitions().get(e.getName()))}this[vr]=new $c(t.getExecutionContext()),this[vr].setOuterNode(this),this.importExternProtos(t.getBody().externprotos),this.importProtos(t.getBody().protos),this.copyRootNodes(t.getBody().rootNodes),this.copyImportedNodes(t.getBody(),t.getBody().getImportedNodes()),this.copyRoutes(t.getBody(),t.getBody().routes),this[vr].setup(),this.isInitialized()&&O.prototype.addEvent.call(this),this[Sr]._updateInstances.removeInterest("construct",this),this[Sr]._updateInstances.addInterest("update",this)},update:function(){const t=this[Tr],e=new Map(this.getFields().map((t=>[t.getName(),t])));for(const t of e.values())this.removeField(t.getName());this[Tr]=new Map(this[Sr].getFields().map((t=>[t,t.getName()])));for(const t of this.getFieldDefinitions())this.addField(t);for(const n of this[Tr].keys()){const i=t.get(n);if(!i)continue;const o=this.getFields().get(n.getName()),r=e.get(i);r.addParent(this),r.setAccessType(o.getAccessType()),r.setName(o.getName()),this.getPredefinedFields().update(o.getName(),o.getName(),r),this.getFields().update(o.getName(),o.getName(),r),this.isPrivate()||r.addCloneCount(1),e.delete(i),o.dispose()}for(const t of e.values())t.dispose();this.construct()},getExtendedEventHandling:function(){return!1},getProtoNode:function(){return this[Sr]},setProtoNode:function(t){if(t!==this[Sr]){if(this[Sr]){const t=this[Sr];t._name_changed.removeFieldInterest(this._typeName_changed),t._updateInstances.removeInterest("construct",this),t._updateInstances.removeInterest("update",this)}this[Tr]=new Map(t.getFields().map((t=>[t,t.getName()]))),this[br]=t.getFieldDefinitions()}this[Sr]=t,t._name_changed.addFieldInterest(this._typeName_changed);const e=this.getExecutionContext().getOuterNode();e&&e.getType().includes(c.X3DProtoDeclaration)||(t.isExternProto?this[Sr].checkLoadState()===c.COMPLETE_STATE?this.construct():(t._updateInstances.addInterest("construct",this),t.requestImmediateLoad()):this.construct())},getBody:function(){return this[vr]},getInnerNode:function(){const t=this[vr].getRootNodes();if(t.length){const e=t[0];if(e)return e.getValue().getInnerNode()}throw new Error("Root node not available.")},importExternProtos:function(t){const e=this[vr].externprotos;for(const n of t)e.add(n.getName(),n)},importProtos:function(t){const e=this[vr].protos;for(const n of t)e.add(n.getName(),n)},copyRootNodes:function(t){const e=this[vr].getRootNodes();for(const n of t)e.push(n.copy(this))},copyImportedNodes:function(t,e){for(const t of e)try{const e=this[vr].getNamedNode(t.getInlineNode().getName()),n=t.getImportedName(),i=t.getExportedName();this[vr].addImportedNode(e,i,n)}catch(t){console.error("Bad IMPORT specification in copy: ",t)}},copyRoutes:function(t,e){for(const n of e)try{const e=this[vr].getLocalNode(t.getLocalName(n.sourceNode)),i=this[vr].getLocalNode(t.getLocalName(n.destinationNode));this[vr].addRoute(e,n.sourceField,i,n.destinationField)}catch(t){console.error(t)}},toXMLStream:function(t){const e=t.IsSharedNode(this);t.EnterScope();const n=t.Name(this);if(n.length&&t.ExistsNode(this)){t.string+=t.Indent(),t.string+="<ProtoInstance",t.string+=t.Space(),t.string+="name='",t.string+=t.XMLEncode(this.getTypeName()),t.string+="'",t.string+=t.Space(),t.string+="USE='",t.string+=t.XMLEncode(n),t.string+="'";const e=t.ContainerField();return e&&e.getName()!==this.getContainerField()&&(t.string+=t.Space(),t.string+="containerField='",t.string+=t.XMLEncode(e.getName()),t.string+="'"),t.string+="/>",void t.LeaveScope()}t.string+=t.Indent(),t.string+="<ProtoInstance",t.string+=t.Space(),t.string+="name='",t.string+=t.XMLEncode(this.getTypeName()),t.string+="'",n.length&&(t.AddNode(this),t.string+=t.Space(),t.string+="DEF='",t.string+=t.XMLEncode(n),t.string+="'");const i=t.ContainerField();i&&i.getName()!==this.getContainerField()&&(t.string+=t.Space(),t.string+="containerField='",t.string+=t.XMLEncode(i.getName()),t.string+="'");const o=this.getChangedFields();if(0===o.length)t.string+="/>";else{t.string+=">",t.string+=t.TidyBreak(),t.IncIndent();const n=[];for(const i of o){let o=!1;if(t.ExecutionContext()&&i.getAccessType()===c.inputOutput&&0!==i.getReferences().size&&([...i.getReferences()].some((t=>t.isInitializable()))||(o=!this.isDefaultValue(i))),0===i.getReferences().size||!t.ExecutionContext()||e||o)switch(o&&n.push(i),i.getType()){case c.MFNode:t.string+=t.Indent(),t.string+="<fieldValue",t.string+=t.Space(),t.string+="name='",t.string+=t.XMLEncode(i.getName()),t.string+="'",0===i.length?(t.string+="/>",t.string+=t.TidyBreak()):(t.PushContainerField(i),t.string+=">",t.string+=t.TidyBreak(),t.IncIndent(),i.toXMLStream(t),t.string+=t.TidyBreak(),t.DecIndent(),t.string+=t.Indent(),t.string+="</fieldValue>",t.string+=t.TidyBreak(),t.PopContainerField());break;case c.SFNode:if(null!==i.getValue()){t.PushContainerField(i),t.string+=t.Indent(),t.string+="<fieldValue",t.string+=t.Space(),t.string+="name='",t.string+=t.XMLEncode(i.getName()),t.string+="'",t.string+=">",t.string+=t.TidyBreak(),t.IncIndent(),i.toXMLStream(t),t.string+=t.TidyBreak(),t.DecIndent(),t.string+=t.Indent(),t.string+="</fieldValue>",t.string+=t.TidyBreak(),t.PopContainerField();break}default:t.string+=t.Indent(),t.string+="<fieldValue",t.string+=t.Space(),t.string+="name='",t.string+=t.XMLEncode(i.getName()),t.string+="'",t.string+=t.Space(),t.string+="value='",i.toXMLStream(t),t.string+="'",t.string+="/>",t.string+=t.TidyBreak()}else n.push(i)}if(n.length&&!e){t.string+=t.Indent(),t.string+="<IS>",t.string+=t.TidyBreak(),t.IncIndent();for(const e of n){const n=e.getReferences();for(const i of n)t.string+=t.Indent(),t.string+="<connect",t.string+=t.Space(),t.string+="nodeField='",t.string+=t.XMLEncode(e.getName()),t.string+="'",t.string+=t.Space(),t.string+="protoField='",t.string+=t.XMLEncode(i.getName()),t.string+="'",t.string+="/>",t.string+=t.TidyBreak()}t.DecIndent(),t.string+=t.Indent(),t.string+="</IS>",t.string+=t.TidyBreak()}t.DecIndent(),t.string+=t.Indent(),t.string+="</ProtoInstance>"}t.LeaveScope()},toJSONStream:function(t){const e=t.IsSharedNode(this);t.EnterScope();const n=t.Name(this);if(n.length&&t.ExistsNode(this))return t.string+="{",t.string+=t.TidySpace(),t.string+='"',t.string+="ProtoInstance",t.string+='"',t.string+=":",t.string+=t.TidyBreak(),t.string+=t.IncIndent(),t.string+=t.Indent(),t.string+="{",t.string+=t.TidyBreak(),t.string+=t.IncIndent(),t.string+=t.Indent(),t.string+='"',t.string+="@name",t.string+='"',t.string+=":",t.string+=t.TidySpace(),t.string+=t.JSONEncode(this.getTypeName()),t.string+=",",t.string+=t.TidyBreak(),t.string+=t.Indent(),t.string+='"',t.string+="@USE",t.string+='"',t.string+=":",t.string+=t.TidySpace(),t.string+=t.JSONEncode(n),t.string+=t.TidyBreak(),t.string+=t.DecIndent(),t.string+=t.Indent(),t.string+="}",t.string+=t.TidyBreak(),t.string+=t.DecIndent(),t.string+=t.Indent(),t.string+="}",void t.LeaveScope();t.string+="{",t.string+=t.TidySpace(),t.string+='"',t.string+="ProtoInstance",t.string+='"',t.string+=":",t.string+=t.TidyBreak(),t.string+=t.IncIndent(),t.string+=t.Indent(),t.string+="{",t.string+=t.TidyBreak(),t.string+=t.IncIndent(),n.length&&(t.AddNode(this),t.string+=t.Indent(),t.string+='"',t.string+="@DEF",t.string+='"',t.string+=":",t.string+=t.TidySpace(),t.string+=t.JSONEncode(n),t.string+=",",t.string+=t.TidyBreak()),t.string+=t.Indent(),t.string+='"',t.string+="@name",t.string+='"',t.string+=":",t.string+=t.TidySpace(),t.string+=t.JSONEncode(this.getTypeName()),t.string+=",",t.string+=t.TidyBreak();const i=this.getChangedFields(),o=[];if(i.length){t.string+=t.Indent(),t.string+='"',t.string+="fieldValue",t.string+='"',t.string+=":",t.string+=t.TidySpace(),t.string+="[",t.string+=t.TidyBreak(),t.string+=t.IncIndent();const n=[];for(const r of i){let i=!1;t.ExecutionContext()&&r.getAccessType()===c.inputOutput&&0!==r.getReferences().size&&([...r.getReferences()].some((t=>t.isInitializable()))||(i=!this.isDefaultValue(r))),0===r.getReferences().size||!t.ExecutionContext()||e||i?(i&&o.push(r),n.push(r)):o.push(r)}for(const e of n){switch(e.getType()){case c.SFNode:t.string+=t.Indent(),t.string+="{",t.string+=t.TidyBreak(),t.string+=t.IncIndent(),t.string+=t.Indent(),t.string+='"',t.string+="@name",t.string+='"',t.string+=":",t.string+=t.TidySpace(),t.string+=t.JSONEncode(e.getName()),t.string+=",",t.string+=t.TidyBreak(),t.string+=t.Indent(),t.string+='"',t.string+="-children",t.string+='"',t.string+=":",t.string+=t.TidySpace(),t.string+="[",t.string+=t.TidyBreak(),t.string+=t.IncIndent(),t.string+=t.Indent(),e.toJSONStream(t),t.string+=t.TidyBreak(),t.string+=t.DecIndent(),t.string+=t.Indent(),t.string+="]",t.string+=t.TidyBreak(),t.string+=t.DecIndent(),t.string+=t.Indent(),t.string+="}";break;case c.MFNode:t.string+=t.Indent(),t.string+="{",t.string+=t.TidyBreak(),t.string+=t.IncIndent(),t.string+=t.Indent(),t.string+='"',t.string+="@name",t.string+='"',t.string+=":",t.string+=t.TidySpace(),t.string+=t.JSONEncode(e.getName()),t.string+=",",t.string+=t.TidyBreak(),t.string+=t.Indent(),t.string+='"',t.string+="-children",t.string+='"',t.string+=":",t.string+=t.TidySpace(),e.toJSONStream(t),t.string+=t.TidyBreak(),t.string+=t.DecIndent(),t.string+=t.Indent(),t.string+="}";break;default:t.string+=t.Indent(),t.string+="{",t.string+=t.TidyBreak(),t.string+=t.IncIndent(),t.string+=t.Indent(),t.string+='"',t.string+="@name",t.string+='"',t.string+=":",t.string+=t.TidySpace(),t.string+=t.JSONEncode(e.getName()),t.string+=",",t.string+=t.TidyBreak(),t.string+=t.Indent(),t.string+='"',t.string+="@value",t.string+='"',t.string+=":",t.string+=t.TidySpace(),e.toJSONStream(t),t.string+=t.TidyBreak(),t.string+=t.DecIndent(),t.string+=t.Indent(),t.string+="}"}e!==n.at(-1)&&(t.string+=","),t.string+=t.TidyBreak()}if(t.string+=t.DecIndent(),t.string+=t.Indent(),t.string+="]",t.string+=",",t.string+=t.TidyBreak(),o.length&&!e){t.string+=t.Indent(),t.string+='"',t.string+="IS",t.string+='"',t.string+=":",t.string+=t.TidySpace(),t.string+="{",t.string+=t.TidyBreak(),t.string+=t.IncIndent(),t.string+=t.Indent(),t.string+='"',t.string+="connect",t.string+='"',t.string+=":",t.string+=t.TidySpace(),t.string+="[",t.string+=t.TidyBreak(),t.string+=t.IncIndent();for(const e of o){const n=[...e.getReferences()];for(const i of n)t.string+=t.Indent(),t.string+="{",t.string+=t.TidyBreak(),t.string+=t.IncIndent(),t.string+=t.Indent(),t.string+='"',t.string+="@nodeField",t.string+='"',t.string+=":",t.string+=t.TidySpace(),t.string+=t.JSONEncode(e.getName()),t.string+=",",t.string+=t.TidyBreak(),t.string+=t.Indent(),t.string+='"',t.string+="@protoField",t.string+='"',t.string+=":",t.string+=t.TidySpace(),t.string+=t.JSONEncode(i.getName()),t.string+=t.TidyBreak(),t.string+=t.DecIndent(),t.string+=t.Indent(),t.string+="}",e===o.at(-1)&&i===n.at(-1)||(t.string+=","),t.string+=t.TidyBreak()}t.string+=t.DecIndent(),t.string+=t.Indent(),t.string+="]",t.string+=t.TidyBreak(),t.string+=t.DecIndent(),t.string+=t.Indent(),t.string+="}",t.string+=",",t.string+=t.TidyBreak()}}t.string=t.string.replace(/,(\s*)$/s,"$1"),t.string+=t.DecIndent(),t.string+=t.Indent(),t.string+="}",t.string+=t.TidyBreak(),t.string+=t.DecIndent(),t.string+=t.Indent(),t.string+="}",t.LeaveScope()},dispose:function(){this[Sr]._updateInstances.removeInterest("construct",this),this[Sr]._updateInstances.removeInterest("update",this),this[vr]&&this[vr].dispose(),or.prototype.dispose.call(this)}});const Er=Cr;n.set("x_ite/Components/Core/X3DPrototypeInstance",Er);const Or=Er;function Nr(t){$i.call(this,t),this.addType(c.X3DProtoDeclarationNode),this.addChildObjects("updateInstances",new Ri.SFTime)}Qo.addAbstractType("X3DProtoDeclarationNode",Nr),Nr.prototype=Object.assign(Object.create($i.prototype),{constructor:Nr,canUserDefinedFields:function(){return!0},createInstance:function(t,e=!0){if(!1===e)return new Or(t,this);{const e=new Or(t,this);return e.setup(),mn.get(e)}},newInstance:function(){return this.createInstance(this.getExecutionContext())},requestUpdateInstances:function(){this._updateInstances=this.getBrowser().getCurrentTime()},updateInstances:function(){this._updateInstances.processEvent()}});for(const t of Reflect.ownKeys(Nr.prototype))Object.defineProperty(Nr.prototype,t,{enumerable:!1});const Fr=Nr;n.set("x_ite/Prototype/X3DProtoDeclarationNode",Fr);const Ir=Fr;Qo.addAbstractType("X3DProtoDeclaration",Dr);const Mr=Symbol();function Dr(t){Ir.call(this,t),this.addType(c.X3DProtoDeclaration),this[Mr]=new $c(t),this[Mr].setOuterNode(this),this[Mr].setLive(!1),this.setLive(!1)}Dr.prototype=Object.assign(Object.create(Ir.prototype),{constructor:Dr,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new Y([new B(c.inputOutput,"metadata",new Ri.SFNode)]),getTypeName:function(){return"X3DProtoDeclaration"},initialize:function(){Ir.prototype.initialize.call(this),this[Mr].setup()},getProtoDeclaration:function(){return this},getBody:function(){return this[Mr]},canUserDefinedFields:function(){return!0},toVRMLStream:function(t){t.string+=t.Indent(),t.string+="PROTO",t.string+=t.Space(),t.string+=this.getName(),t.string+=t.TidySpace(),t.string+="[",t.EnterScope();const e=this.getUserDefinedFields();if(0===e.length)t.string+=t.TidySpace();else{let n=0,i=0;for(const o of e)n=Math.max(n,o.getTypeName().length),i=Math.max(i,t.AccessType(o.getAccessType()).length);t.string+=t.TidyBreak(),t.IncIndent();for(const o of e)this.toVRMLStreamUserDefinedField(t,o,n,i),t.string+=t.Break();t.DecIndent(),t.string+=t.Indent()}t.LeaveScope(),t.string+="]",t.string+=t.TidyBreak(),t.string+=t.Indent(),t.string+="{",t.string+=t.TidyBreak(),t.IncIndent(),this[Mr].toVRMLStream(t),t.DecIndent(),t.string+=t.Indent(),t.string+="}"},toVRMLStreamUserDefinedField:function(t,e,n,i){t.string+=t.Indent(),t.string+=t.PadRight(t.AccessType(e.getAccessType()),i),t.string+=t.Space(),t.string+=t.PadRight(e.getTypeName(),n),t.string+=t.Space(),t.string+=e.getName(),e.isInitializable()&&(t.string+=t.Space(),e.toVRMLStream(t))},toXMLStream:function(t){t.string+=t.Indent(),t.string+="<ProtoDeclare",t.string+=t.Space(),t.string+="name='",t.string+=t.XMLEncode(this.getName()),t.string+="'",t.string+=">",t.string+=t.TidyBreak(),t.EnterScope();const e=this.getUserDefinedFields();if(0!==e.length){t.IncIndent(),t.string+=t.Indent(),t.string+="<ProtoInterface>",t.string+=t.TidyBreak(),t.IncIndent();for(const n of e)if(t.string+=t.Indent(),t.string+="<field",t.string+=t.Space(),t.string+="accessType='",t.string+=t.AccessType(n.getAccessType()),t.string+="'",t.string+=t.Space(),t.string+="type='",t.string+=n.getTypeName(),t.string+="'",t.string+=t.Space(),t.string+="name='",t.string+=t.XMLEncode(n.getName()),t.string+="'",n.isDefaultValue())t.string+="/>",t.string+=t.TidyBreak();else switch(n.getType()){case c.SFNode:case c.MFNode:t.PushContainerField(n),t.string+=t.TidyBreak(),t.IncIndent(),n.toXMLStream(t),t.string+=t.TidyBreak(),t.DecIndent(),t.string+=t.Indent(),t.string+="</field>",t.string+=t.TidyBreak(),t.PopContainerField();break;default:t.string+=t.Space(),t.string+="value='",n.toXMLStream(t),t.string+="'",t.string+="/>",t.string+=t.TidyBreak()}t.DecIndent(),t.string+=t.Indent(),t.string+="</ProtoInterface>",t.string+=t.TidyBreak(),t.DecIndent()}t.LeaveScope(),t.IncIndent(),t.string+=t.Indent(),t.string+="<ProtoBody>",t.string+=t.TidyBreak(),t.IncIndent(),this[Mr].toXMLStream(t),t.DecIndent(),t.string+=t.Indent(),t.string+="</ProtoBody>",t.string+=t.TidyBreak(),t.DecIndent(),t.string+=t.Indent(),t.string+="</ProtoDeclare>"},toJSONStream:function(t){t.string+=t.Indent(),t.string+="{",t.string+=t.TidySpace(),t.string+='"',t.string+="ProtoDeclare",t.string+='"',t.string+=":",t.string+=t.TidyBreak(),t.string+=t.IncIndent(),t.string+=t.Indent(),t.string+="{",t.string+=t.TidyBreak(),t.string+=t.IncIndent(),t.string+=t.Indent(),t.string+='"',t.string+="@name",t.string+='"',t.string+=":",t.string+=t.JSONEncode(this.getName()),t.string+=",",t.string+=t.TidyBreak(),t.string+=t.Indent(),t.string+='"',t.string+="ProtoInterface",t.string+='"',t.string+=":",t.string+=t.TidySpace(),t.string+="{",t.string+=t.TidyBreak(),t.string+=t.IncIndent(),t.EnterScope();const e=this.getUserDefinedFields();if(e.length){t.string+=t.Indent(),t.string+='"',t.string+="field",t.string+='"',t.string+=":",t.string+=t.TidySpace(),t.string+="[",t.string+=t.TidyBreak(),t.string+=t.IncIndent();for(const n of e){if(t.string+=t.Indent(),t.string+="{",t.string+=t.TidyBreak(),t.string+=t.IncIndent(),t.string+=t.Indent(),t.string+='"',t.string+="@accessType",t.string+='"',t.string+=":",t.string+=t.TidySpace(),t.string+='"',t.string+=t.AccessType(n.getAccessType()),t.string+='"',t.string+=",",t.string+=t.TidyBreak(),t.string+=t.Indent(),t.string+='"',t.string+="@type",t.string+='"',t.string+=":",t.string+=t.TidySpace(),t.string+='"',t.string+=n.getTypeName(),t.string+='"',t.string+=",",t.string+=t.TidyBreak(),t.string+=t.Indent(),t.string+='"',t.string+="@name",t.string+='"',t.string+=":",t.string+=t.TidySpace(),t.string+=t.JSONEncode(n.getName()),n.isDefaultValue())t.string+=t.TidyBreak();else switch(t.string+=",",t.string+=t.TidyBreak(),n.getType()){case c.SFNode:t.string+=t.Indent(),t.string+='"',t.string+="-children",t.string+='"',t.string+=":",t.string+=t.TidySpace(),t.string+="[",t.string+=t.TidyBreak(),t.string+=t.IncIndent(),t.string+=t.Indent(),n.toJSONStream(t),t.string+=t.TidyBreak(),t.string+=t.DecIndent(),t.string+=t.Indent(),t.string+="]",t.string+=t.TidyBreak();break;case c.MFNode:t.string+=t.Indent(),t.string+='"',t.string+="-children",t.string+='"',t.string+=":",t.string+=t.TidySpace(),n.toJSONStream(t),t.string+=t.TidyBreak();break;default:t.string+=t.Indent(),t.string+='"',t.string+="@value",t.string+='"',t.string+=":",t.string+=t.TidySpace(),n.toJSONStream(t),t.string+=t.TidyBreak()}t.string+=t.DecIndent(),t.string+=t.Indent(),t.string+="}",n!==e.at(-1)&&(t.string+=","),t.string+=t.TidyBreak()}t.string+=t.DecIndent(),t.string+=t.Indent(),t.string+="]"}t.string+=t.DecIndent(),t.string+=t.TidyBreak(),t.string+=t.Indent(),t.string+="}",t.string+=",",t.string+=t.TidyBreak(),t.LeaveScope(),t.string+=t.Indent(),t.string+='"',t.string+="ProtoBody",t.string+='"',t.string+=":",t.string+=t.TidySpace(),t.string+="{",t.string+=t.TidyBreak(),t.string+=t.IncIndent(),t.string+=t.Indent(),t.string+='"',t.string+="-children",t.string+='"',t.string+=":",t.string+=t.TidySpace(),t.string+="[",t.string+=t.TidyBreak(),t.string+=t.IncIndent(),this[Mr].toJSONStream(t),t.string=t.string.replace(/,(\s*)$/s,"$1"),t.string+=t.DecIndent(),t.string+=t.Indent(),t.string+="]",t.string+=t.TidyBreak(),t.string+=t.DecIndent(),t.string+=t.Indent(),t.string+="}",t.string+=t.TidyBreak(),t.string+=t.DecIndent(),t.string+=t.Indent(),t.string+="}",t.string+=t.TidyBreak(),t.string+=t.DecIndent(),t.string+=t.Indent(),t.string+="}"}});for(const t of Reflect.ownKeys(Dr.prototype))Object.defineProperty(Dr.prototype,t,{enumerable:!1});Object.defineProperty(Dr.prototype,"name",{get:function(){return this.getName()},enumerable:!0,configurable:!1}),Object.defineProperty(Dr.prototype,"fields",{get:function(){return this.getFieldDefinitions()},enumerable:!0,configurable:!1}),Object.defineProperty(Dr.prototype,"isExternProto",{get:function(){return!1},enumerable:!0,configurable:!1});const Vr=Dr;n.set("x_ite/Prototype/X3DProtoDeclaration",Vr);const Rr=Vr,Pr=Symbol(),Ar=Symbol(),Lr=Symbol(),Br=Symbol();function Xr(t){this.addType(c.X3DUrlObject),this.addChildObjects("loadState",new Ri.SFInt32(c.NOT_STARTED_STATE),"loadNow",new Ri.SFTime),this[Pr]=!0,this[Ar]=Date.now()}Xr.prototype={constructor:Xr,initialize:function(){this.isLive().addInterest("set_live__",this),this._load.addInterest("set_load__",this),this._url.addInterest("set_url__",this),this._loadNow.addInterest("loadNow",this),this._autoRefresh.addInterest("set_autoRefresh__",this),this._autoRefreshTimeLimit.addInterest("set_autoRefresh__",this)},setLoadState:function(t,e=!0){if(this._loadState=t,t===c.COMPLETE_STATE&&(this[Lr]=Date.now(),this.setAutoRefreshTimer(this._autoRefresh.getValue())),e)switch(t){case c.NOT_STARTED_STATE:break;case c.IN_PROGRESS_STATE:this.getScene().addLoadingObject(this);break;case c.COMPLETE_STATE:case c.FAILED_STATE:this.getScene().removeLoadingObject(this)}},checkLoadState:function(){return this._loadState.getValue()},getLoadState:function(){return this._loadState},setCache:function(t){this[Pr]=t},getCache:function(){return this[Pr]},requestImmediateLoad:function(t=!0){const e=this.checkLoadState();e!==c.COMPLETE_STATE&&e!==c.IN_PROGRESS_STATE&&this._load.getValue()&&0!==this._url.length&&(this.setCache(t),this.setLoadState(c.IN_PROGRESS_STATE),this.isInitialized()?this._loadNow=this.getBrowser().getCurrentTime():this.loadNow())},loadNow:function(){},requestUnload:function(){const t=this.checkLoadState();t!==c.NOT_STARTED_STATE&&t!==c.FAILED_STATE&&(this.setLoadState(c.NOT_STARTED_STATE),this.unLoadNow())},unLoadNow:function(){},setAutoRefreshTimer:function(t){if(clearTimeout(this[Br]),this._autoRefresh.getValue()<=0)return;const e=this._autoRefreshTimeLimit.getValue();0!==e&&(Date.now()-this[Ar])/1e3>e-t||(this[Br]=setTimeout(this.performAutoRefresh.bind(this),1e3*t))},performAutoRefresh:function(){this.setLoadState(c.NOT_STARTED_STATE),this.requestImmediateLoad(!1)},set_live__:function(){this.isLive().getValue()?this.set_autoRefresh__():clearTimeout(this[Br])},set_load__:function(){this._load.getValue()?this.requestImmediateLoad():this.requestUnload()},set_url__:function(){this._load.getValue()&&(this.setLoadState(c.NOT_STARTED_STATE),this.requestImmediateLoad())},set_autoRefresh__:function(){if(this.checkLoadState()!==c.COMPLETE_STATE)return;const t=(Date.now()-this[Lr])/1e3,e=this._autoRefresh.getValue();let n=e-t;n<0&&(n=Math.ceil(t/e)*e-t),this.setAutoRefreshTimer(n)},dispose:function(){}};const Ur=Xr;n.set("x_ite/Components/Networking/X3DUrlObject",Ur);const kr=Ur;function zr(t){this.scene=t,this.executionContexts=[t],this.prototypes=[],this.units=!0}zr.prototype={constructor:zr,getScene:function(){return this.scene},getBrowser:function(){return this.scene.getBrowser()},getExecutionContext:function(){return this.executionContexts.at(-1)},pushExecutionContext:function(t){return this.executionContexts.push(t)},popExecutionContext:function(){this.executionContexts.pop()},getPrototype:function(){return this.prototypes.at(-1)},pushPrototype:function(t){return this.prototypes.push(t)},popPrototype:function(){this.prototypes.pop()},isInsideProtoDefinition:function(){return Boolean(this.prototypes.length)},loadComponents:function(){const t=["Core","EnvironmentalEffects","EnvironmentalSensor","Geometry3D","Grouping","Interpolation","Lighting","Navigation","Networking","PointingDeviceSensor","Rendering","Scripting","Shape","Sound","Text","Texturing","Time"];return function(){const e=this.getBrowser(),n=this.getScene();return"2.0"===n.getSpecificationVersion()?e.loadComponents(t):Promise.all([e.loadComponents(n.getProfile()||e.getProfile("Full")),e.loadComponents(n.getComponents())])}}(),setUnits:function(t){if("boolean"==typeof arguments[0])return void(this.units=arguments[0]);const e=/Titania\s+V(\d+).*/,n=t.match(e);if(n){if(parseInt(n[1])<4)return void(this.units=!1)}this.units=!0},getUnits:function(){return this.units},fromUnit:function(t,e){return this.units?this.scene.fromUnit(t,e):e}};const jr=zr;n.set("x_ite/Parser/X3DParser",jr);const Gr=jr;var Hr={Whitespaces:new RegExp("([\\x20\\n,\\t\\r]+)","gy"),Comment:new RegExp("#(.*?)(?=[\\n\\r])","gy"),Header:new RegExp("^#(VRML|X3D) V(.*?) (utf8)(?:[ \\t]+(.*?))?[ \\t]*[\\n\\r]","gy"),AS:new RegExp("AS","gy"),COMPONENT:new RegExp("COMPONENT","gy"),DEF:new RegExp("DEF","gy"),EXPORT:new RegExp("EXPORT","gy"),EXTERNPROTO:new RegExp("EXTERNPROTO","gy"),FALSE:new RegExp("FALSE|false","gy"),IMPORT:new RegExp("IMPORT","gy"),IS:new RegExp("IS","gy"),META:new RegExp("META","gy"),NULL:new RegExp("NULL","gy"),TRUE:new RegExp("TRUE|true","gy"),PROFILE:new RegExp("PROFILE","gy"),PROTO:new RegExp("PROTO","gy"),ROUTE:new RegExp("ROUTE","gy"),TO:new RegExp("TO","gy"),UNIT:new RegExp("UNIT","gy"),USE:new RegExp("USE","gy"),OpenBrace:new RegExp("\\{","gy"),CloseBrace:new RegExp("\\}","gy"),OpenBracket:new RegExp("\\[","gy"),CloseBracket:new RegExp("\\]","gy"),Period:new RegExp("\\.","gy"),Colon:new RegExp("\\:","gy"),Id:new RegExp("([^\\x30-\\x39\\x00-\\x20\\x22\\x23\\x27\\x2b\\x2c\\x2d\\x2e\\x5b\\x5c\\x5d\\x7b\\x7d\\x7f]{1}[^\\x00-\\x20\\x22\\x23\\x27\\x2c\\x2e\\x5b\\x5c\\x5d\\x7b\\x7d\\x7f]*)","gy"),ComponentNameId:new RegExp("([^\\x30-\\x39\\x00-\\x20\\x22\\x23\\x27\\x2b\\x2c\\x2d\\x2e\\x5b\\x5c\\x5d\\x7b\\x7d\\x7f\\x3a]{1}[^\\x00-\\x20\\x22\\x23\\x27\\x2c\\x2e\\x5b\\x5c\\x5d\\x7b\\x7d\\x7f\\x3a]*)","gy"),initializeOnly:new RegExp("initializeOnly","gy"),inputOnly:new RegExp("inputOnly","gy"),outputOnly:new RegExp("outputOnly","gy"),inputOutput:new RegExp("inputOutput","gy"),field:new RegExp("field","gy"),eventIn:new RegExp("eventIn","gy"),eventOut:new RegExp("eventOut","gy"),exposedField:new RegExp("exposedField","gy"),FieldType:new RegExp("(MFBool|MFColorRGBA|MFColor|MFDouble|MFFloat|MFImage|MFInt32|MFMatrix3d|MFMatrix3f|MFMatrix4d|MFMatrix4f|MFNode|MFRotation|MFString|MFTime|MFVec2d|MFVec2f|MFVec3d|MFVec3f|MFVec4d|MFVec4f|SFBool|SFColorRGBA|SFColor|SFDouble|SFFloat|SFImage|SFInt32|SFMatrix3d|SFMatrix3f|SFMatrix4d|SFMatrix4f|SFNode|SFRotation|SFString|SFTime|SFVec2d|SFVec2f|SFVec3d|SFVec3f|SFVec4d|SFVec4f)","gy"),int32:new RegExp("((?:0[xX][\\da-fA-F]+)|(?:[+-]?\\d+))","gy"),double:new RegExp("([+-]?(?:(?:(?:\\d*\\.\\d+)|(?:\\d+(?:\\.)?))(?:[eE][+-]?\\d+)?))","gy"),string:new RegExp('"((?:[^\\\\"]|\\\\\\\\|\\\\\\")*)"',"gy"),Inf:new RegExp("[+]?(?:inf|Infinity)","gy"),NegativeInf:new RegExp("-(?:inf|Infinity)","gy"),NaN:new RegExp("[+-]?(nan|NaN)","gy"),Break:new RegExp("\\r?\\n","g")};function qr(t){return this.lastIndex=t.lastIndex,t.result=this.exec(t.input),!!t.result&&(t.lastIndex=this.lastIndex,!0)}for(var Yr in Hr)Hr[Yr].parse=qr;function Wr(t){Gr.call(this,t)}Wr.prototype=Object.assign(Object.create(Gr.prototype),{constructor:Wr,accessTypes:{field:c.initializeOnly,eventIn:c.inputOnly,eventOut:c.outputOnly,exposedField:c.inputOutput,initializeOnly:c.initializeOnly,inputOnly:c.inputOnly,outputOnly:c.outputOnly,inputOutput:c.inputOutput},SFBool:new Ri.SFBool,SFColor:new Ri.SFColor,SFColorRGBA:new Ri.SFColorRGBA,SFDouble:new Ri.SFDouble,SFFloat:new Ri.SFFloat,SFImage:new Ri.SFImage,SFInt32:new Ri.SFInt32,SFMatrix3f:new Ri.SFMatrix3f,SFMatrix3d:new Ri.SFMatrix3d,SFMatrix4f:new Ri.SFMatrix4f,SFMatrix4d:new Ri.SFMatrix4d,SFNode:new Ri.SFNode,SFRotation:new Ri.SFRotation,SFString:new Ri.SFString,SFTime:new Ri.SFTime,SFVec2d:new Ri.SFVec2d,SFVec2f:new Ri.SFVec2f,SFVec3d:new Ri.SFVec3d,SFVec3f:new Ri.SFVec3f,SFVec4d:new Ri.SFVec4d,SFVec4f:new Ri.SFVec4f,MFBool:new Ri.MFBool,MFColor:new Ri.MFColor,MFColorRGBA:new Ri.MFColorRGBA,MFDouble:new Ri.MFDouble,MFFloat:new Ri.MFFloat,MFImage:new Ri.MFImage,MFInt32:new Ri.MFInt32,MFMatrix3d:new Ri.MFMatrix3d,MFMatrix3f:new Ri.MFMatrix3f,MFMatrix4d:new Ri.MFMatrix4d,MFMatrix4f:new Ri.MFMatrix4f,MFNode:new Ri.MFNode,MFRotation:new Ri.MFRotation,MFString:new Ri.MFString,MFTime:new Ri.MFTime,MFVec2d:new Ri.MFVec2d,MFVec2f:new Ri.MFVec2f,MFVec3d:new Ri.MFVec3d,MFVec3f:new Ri.MFVec3f,MFVec4d:new Ri.MFVec4d,MFVec4f:new Ri.MFVec4f,isValid:function(){return!!this.input.match(/^(?:#X3D|#VRML|(?:[\x20\n,\t\r]*|#.*?[\r\n])*(PROFILE|COMPONENT|META|UNIT|EXTERNPROTO|PROTO|DEF|NULL|IMPORT|EXPORT|ROUTE|\w+(?:[\x20\n,\t\r]*|#.*?[\r\n])\{|$))/)},getInput:function(){return this.input},setInput:function(t){this.input=t,this.lineNumber=1,this.lastIndex=0},parseIntoScene:function(t,e){try{this.success=t,this.error=e,this.getScene().setEncoding("VRML"),this.getScene().setProfile(this.getBrowser().getProfile("Full")),this.x3dScene()}catch(e){throw new Error(this.getError(e))}},exception:function(t){if(this.getBrowser().isStrict())throw new Error(t);console.warn(t)},getError:function(t){var e=t.message,n=this.getLine(),i=this.getLastLine(),o=this.getLastLine(),r=i.length-n.length+1;return i.length>80&&(i=i.substr(r-40,80),o="",r=40),"\n********************************************************************************\nParser error at line "+this.lineNumber+":"+r+"\nin '"+this.getScene().getWorldURL()+"'\n\n"+o+"\n"+i+"\n"+Array(r).join(" ")+"^\n"+e+"\n********************************************************************************\n"},getLine:function(){for(var t=this.input,e=this.lastIndex,n="";e<t.length&&"\n"!==t[e]&&"\r"!==t[e];)n+=t[e++];return this.lastIndex=e,n},getLastLine:function(){var t=this.input,e=this.lastIndex,n="";for(e<t.length&&("\n"!==t[e]||"\r"!==t[e])&&--e;e>=0&&"\n"!==t[e]&&"\r"!==t[e];)n=t[e--]+n;return this.lastIndex=e,n},comments:function(){for(;this.comment(););},comment:function(){return!!this.whitespaces()||Hr.Comment.parse(this)},whitespaces:function(){return!!Hr.Whitespaces.parse(this)&&(this.xml||this.lines(this.result[1]),!0)},lines:function(t){var e=t.match(Hr.Break);e&&(this.lineNumber+=e.length)},x3dScene:function(){this.headerStatement(),this.profileStatement(),this.componentStatements(),this.unitStatements(),this.metaStatements();try{this.setUnits(this.getScene().getMetaData("generator"))}catch(t){}if(this.success)this.loadComponents().then((()=>{try{if(this.statements(this.getScene().rootNodes),this.lastIndex<this.input.length)throw new Error("Unknown statement.");this.success(this.getScene())}catch(t){this.error(new Error(this.getError(t)))}})).catch(this.error.bind(this));else if(this.statements(this.getScene().rootNodes),this.lastIndex<this.input.length)throw new Error("Unknown statement.")},headerStatement:function(){Hr.Header.lastIndex=0;var t=Hr.Header.exec(this.input);return!!t&&(this.getScene().setSpecificationVersion(t[2]),this.getScene().setEncoding("VRML"),!0)},profileStatement:function(){if(this.comments(),Hr.PROFILE.parse(this)){if(this.profileNameId()){var t=this.getBrowser().getProfile(this.result[1]);return void this.getScene().setProfile(t)}throw new Error("Expected a profile name.")}},componentStatements:function(){for(var t=this.componentStatement();t;)this.getScene().addComponent(t),t=this.componentStatement()},componentStatement:function(){if(this.comments(),Hr.COMPONENT.parse(this)){if(this.componentNameId()){var t=this.result[1];if(this.comments(),Hr.Colon.parse(this)){if(this.componentSupportLevel()){var e=this.value;return this.getBrowser().getComponent(t,e)}throw new Error("Expected a component support level.")}throw new Error("Expected a ':' after component name.")}throw new Error("Expected a component name.")}return null},componentSupportLevel:function(){return this.int32()},unitStatements:function(){for(;this.unitStatement(););},unitStatement:function(){if(this.comments(),Hr.UNIT.parse(this)){if(this.categoryNameId()){var t=this.result[1];if(this.unitNameId()){var e=this.result[1];if(this.unitConversionFactor()){var n=this.value;try{return this.getScene().updateUnit(t,e,n),!0}catch(t){return console.log(t.message),!0}}throw new Error("Expected unit conversion factor.")}throw new Error("Expected unit name identifier.")}throw new Error("Expected category name identifier after UNIT statement.")}return!1},unitConversionFactor:function(){return this.double()},metaStatements:function(){for(;this.metaStatement(););},metaStatement:function(){if(this.comments(),Hr.META.parse(this)){if(this.metakey()){var t=this.value;if(this.metavalue()){var e=this.value;return this.getScene().addMetaData(t,e),!0}throw new Error("Expected metadata value.")}throw new Error("Expected metadata key.")}return!1},metakey:function(){return this.string()},metavalue:function(){return this.string()},exportStatement:function(){if(this.comments(),Hr.EXPORT.parse(this)){if(this.nodeNameId()){var t=this.result[1],e="";this.comments();var n=this.getScene().getLocalNode(t);if(Hr.AS.parse(this)){if(!this.exportedNodeNameId())throw new Error("No name given after AS.");e=this.result[1]}else e=t;if(this.getScene()===this.getExecutionContext())return this.getScene().updateExportedNode(e,n),!0;throw new Error("Export statement not allowed here.")}throw new Error("No name given after EXPORT.")}return!1},importStatement:function(){if(this.comments(),Hr.IMPORT.parse(this)){if(this.nodeNameId()){var t=this.result[1],e=this.getExecutionContext().getNamedNode(t);if(this.comments(),Hr.Period.parse(this)){if(this.exportedNodeNameId()){var n=this.result[1],i=n;if(this.comments(),Hr.AS.parse(this)){if(!this.nodeNameId())throw new Error("No name given after AS.");i=this.result[1]}return this.getExecutionContext().updateImportedNode(e,n,i),!0}throw new Error("Expected exported node name.")}throw new Error("Expected a '.' after exported node name.")}throw new Error("No name given after IMPORT statement.")}return!1},statements:function(t){for(;this.statement(t););},statement:function(t){if(this.protoStatement())return!0;if(this.routeStatement())return!0;if(this.importStatement())return!0;if(this.exportStatement())return!0;var e=this.nodeStatement();return!1!==e&&(t.push(e),!0)},nodeStatement:function(){if(this.comments(),Hr.DEF.parse(this)){if(this.nodeNameId())return this.node(this.result[1]);throw new Error("No name given after DEF.")}if(Hr.USE.parse(this)){if(this.nodeNameId())return this.getExecutionContext().getNamedNode(this.result[1]).getValue();throw new Error("No name given after USE.")}return Hr.NULL.parse(this)?null:this.node("")},protoStatement:function(){return!!this.proto()||!!this.externproto()},protoStatements:function(){for(;this.protoStatement(););},proto:function(){if(this.comments(),Hr.PROTO.parse(this)){if(this.nodeTypeId()){var t=this.result[1];if(this.comments(),Hr.OpenBracket.parse(this)){var e=this.interfaceDeclarations();if(this.comments(),Hr.CloseBracket.parse(this)){if(this.comments(),Hr.OpenBrace.parse(this)){for(var n=new Rr(this.getExecutionContext()),i=0,o=e.length;i<o;++i){var r=e[i];n.addUserDefinedField(r.getAccessType(),r.getName(),r)}if(this.pushPrototype(n),this.pushExecutionContext(n.getBody()),this.protoBody(n.getBody().rootNodes),this.popExecutionContext(),this.popPrototype(),this.comments(),Hr.CloseBrace.parse(this)){n.setup();try{const e=this.getExecutionContext().getProtoDeclaration(t);this.getExecutionContext().updateProtoDeclaration(this.getExecutionContext().getUniqueProtoName(t),e)}catch(t){}return this.getExecutionContext().updateProtoDeclaration(t,n),!0}throw new Error("Expected a '}' at the end of PROTO body.")}throw new Error("Expected a '{' at the beginning of PROTO body.")}throw new Error("Expected a ']' at the end of PROTO interface declaration.")}throw new Error("Expected a '[' at the beginning of PROTO interface declaration.")}throw new Error("Invalid PROTO definition name.")}return!1},protoBody:function(t){this.protoStatements();const e=this.rootNodeStatement();!1!==e&&t.push(e),this.statements(t)},rootNodeStatement:function(){if(this.comments(),Hr.DEF.parse(this)){if(this.nodeNameId()){var t=this.result[0];if(!1!==(e=this.node(t)))return e;throw new Error("Expected node type name after DEF.")}throw new Error("No name given after DEF.")}var e;return!1!==(e=this.node(""))&&e},interfaceDeclarations:function(){for(var t=[],e=this.interfaceDeclaration();e;)t.push(e),e=this.interfaceDeclaration();return t},restrictedInterfaceDeclaration:function(){if(this.comments(),Hr.inputOnly.parse(this)||Hr.eventIn.parse(this)){if(this.fieldType()){var t=this.result[1];if(this.inputOnlyId()){var e=this.result[1];return(n=this[t].create()).setAccessType(c.inputOnly),n.setName(e),n}throw new Error("Expected a name for field.")}throw this.Id(),new Error("Unknown event or field type: '"+this.result[1]+"'.")}if(Hr.outputOnly.parse(this)||Hr.eventOut.parse(this)){if(this.fieldType()){t=this.result[1];if(this.outputOnlyId()){e=this.result[1];return(n=this[t].create()).setAccessType(c.outputOnly),n.setName(e),n}throw new Error("Expected a name for field.")}throw this.Id(),new Error("Unknown event or field type: '"+this.result[1]+"'.")}if(Hr.initializeOnly.parse(this)||Hr.field.parse(this)){if(this.fieldType()){t=this.result[1];if(this.initializeOnlyId()){e=this.result[1];var n=this[t].create();if(this.fieldValue(n))return n.setAccessType(c.initializeOnly),n.setName(e),n;throw new Error("Couldn't read value for field '"+e+"'.")}throw new Error("Expected a name for field.")}throw this.Id(),new Error("Unknown event or field type: '"+this.result[1]+"'.")}return null},interfaceDeclaration:function(){if(n=this.restrictedInterfaceDeclaration())return n;if(this.comments(),Hr.inputOutput.parse(this)||Hr.exposedField.parse(this)){if(this.fieldType()){var t=this.result[1];if(this.inputOutputId()){var e=this.result[1],n=this[t].create();if(this.fieldValue(n))return n.setAccessType(c.inputOutput),n.setName(e),n;throw new Error("Couldn't read value for field '"+e+"'.")}throw new Error("Expected a name for field.")}throw this.Id(),new Error("Unknown event or field type: '"+this.result[1]+"'.")}return null},externproto:function(){if(this.comments(),Hr.EXTERNPROTO.parse(this)){if(this.nodeTypeId()){var t=this.result[1];if(this.comments(),Hr.OpenBracket.parse(this)){var e=this.externInterfaceDeclarations();if(this.comments(),Hr.CloseBracket.parse(this)){if(this.URLList(this.MFString)){for(var n=new Dc(this.getExecutionContext(),this.MFString),i=0,o=e.length;i<o;++i){var r=e[i];n.addUserDefinedField(r.getAccessType(),r.getName(),r)}n.setup();try{const e=this.getExecutionContext().getExternProtoDeclaration(t);this.getExecutionContext().updateExternProtoDeclaration(this.getExecutionContext().getUniqueExternProtoName(t),e)}catch(t){}return this.getExecutionContext().updateExternProtoDeclaration(t,n),!0}throw new Error("Expected a URL list after EXTERNPROTO interface declaration '"+t+"'.")}throw new Error("Expected a ']' at the end of EXTERNPROTO interface declaration.")}throw new Error("Expected a '[' at the beginning of EXTERNPROTO interface declaration.")}throw new Error("Invalid EXTERNPROTO definition name.")}return!1},externInterfaceDeclarations:function(){for(var t=[],e=this.externInterfaceDeclaration();e;)t.push(e),e=this.externInterfaceDeclaration();return t},externInterfaceDeclaration:function(){if(this.comments(),Hr.inputOnly.parse(this)||Hr.eventIn.parse(this)){if(this.fieldType()){var t=this.result[1];if(this.inputOnlyId()){var e=this.result[1];return(n=this[t].create()).setAccessType(c.inputOnly),n.setName(e),n}throw new Error("Expected a name for field.")}throw this.Id(),new Error("Unknown event or field type: '"+this.result[1]+"'.")}if(Hr.outputOnly.parse(this)||Hr.eventOut.parse(this)){if(this.fieldType()){t=this.result[1];if(this.outputOnlyId()){e=this.result[1];return(n=this[t].create()).setAccessType(c.outputOnly),n.setName(e),n}throw new Error("Expected a name for field.")}throw this.Id(),new Error("Unknown event or field type: '"+this.result[1]+"'.")}if(Hr.initializeOnly.parse(this)||Hr.field.parse(this)){if(this.fieldType()){t=this.result[1];if(this.initializeOnlyId()){e=this.result[1];return(n=this[t].create()).setAccessType(c.initializeOnly),n.setName(e),n}throw new Error("Expected a name for field.")}throw this.Id(),new Error("Unknown event or field type: '"+this.result[1]+"'.")}if(Hr.inputOutput.parse(this)||Hr.exposedField.parse(this)){if(this.fieldType()){t=this.result[1];if(this.inputOutputId()){var n;e=this.result[1];return(n=this[t].create()).setAccessType(c.inputOutput),n.setName(e),n}throw new Error("Expected a name for field.")}throw this.Id(),new Error("Unknown event or field type: '"+this.result[1]+"'.")}return null},URLList:function(t){return this.mfstringValue(t)},routeStatement:function(){if(this.comments(),Hr.ROUTE.parse(this)){if(this.nodeNameId()){var t=this.result[1],e=this.getExecutionContext().getLocalNode(t);if(this.comments(),Hr.Period.parse(this)){if(this.outputOnlyId()){var n=this.result[1];if(this.comments(),Hr.TO.parse(this)){if(this.nodeNameId()){var i=this.result[1],o=this.getExecutionContext().getLocalNode(i);if(this.comments(),Hr.Period.parse(this)){if(this.inputOnlyId())try{var r=this.result[1];return this.getExecutionContext().addRoute(e,n,o,r),!0}catch(t){return this.exception(t.message),!0}throw new Error("Bad ROUTE specification: Expected a field name.")}throw new Error("Bad ROUTE specification: Expected a '.' after node name.")}throw new Error("Bad ROUTE specification: Expected a node name.")}throw new Error("Bad ROUTE specification: Expected a 'TO'.")}throw new Error("Bad ROUTE specification: Expected a field name.")}throw new Error("Bad ROUTE specification: Expected a '.' after node name.")}throw new Error("Bad ROUTE specification: Expected a node name.")}return!1},node:function(t){if(this.nodeTypeId()){var e=this.result[1],n=this.getExecutionContext().createProto(e,!1);if(!n&&!(n=this.getExecutionContext().createNode(e,!1)))throw new Error("Unknown node type or proto '"+e+"', you probably have insufficient component/profile statements.");if(t.length){try{var i=this.getExecutionContext().getNamedNode(t);this.getExecutionContext().updateNamedNode(this.getExecutionContext().getUniqueName(t),i)}catch(t){}this.getExecutionContext().updateNamedNode(t,n)}if(this.comments(),Hr.OpenBrace.parse(this)){if(n.canUserDefinedFields()?this.scriptBody(n):this.nodeBody(n),this.comments(),Hr.CloseBrace.parse(this))return this.isInsideProtoDefinition()||n.setup(),n;throw new Error("Expected '}' at the end of node body.")}throw new Error("Expected '{' at the beginning of node body.")}return!1},scriptBody:function(t){for(;this.scriptBodyElement(t););},scriptBodyElement:function(t){var e=this.lastIndex,n=this.lineNumber;if(this.Id()){var i=this.accessTypes[this.result[1]];if(i&&this.fieldType()){var o=this.result[1];if(this.Id()){var r=this.result[1];if(this.comments(),Hr.IS.parse(this)){if(this.isInsideProtoDefinition()){if(this.Id()){var s=this.result[1];try{var a=this.getPrototype().getField(s)}catch(t){return this.exception("No such event or field '"+s+"' inside PROTO "+this.getPrototype().getName()+" interface declaration."),!0}var u=this[o];if(u.getType()===a.getType()){if(a.isReference(i)){try{i===(l=t.getField(r)).getAccessType()&&a.getType()===l.getType()||(l=this.createUserDefinedField(t,i,r,u))}catch(e){var l=this.createUserDefinedField(t,i,r,u)}return l.addReference(a),!0}throw new Error("Field '"+r+"' and '"+a.getName()+"' in PROTO '"+this.getPrototype().getName()+"' are incompatible as an IS mapping.")}throw new Error("Field '"+r+"' and '"+a.getName()+"' in PROTO '"+this.getPrototype().getName()+"' have different types.")}throw new Error("No name give after IS statement.")}throw new Error("IS statement outside PROTO definition.")}}}}if(this.lastIndex=e,this.lineNumber=n,l=this.interfaceDeclaration()){try{if(l.getAccessType()===c.inputOutput){var h=t.getField(l.getName());if(h.getAccessType()===c.inputOutput&&l.getType()===h.getType())return h.setValue(l),!0}}catch(t){}return t.addUserDefinedField(l.getAccessType(),l.getName(),l),!0}return this.nodeBodyElement(t)},createUserDefinedField:function(t,e,n,i){var o=i.create();return t.addUserDefinedField(e,n,o),o},nodeBody:function(t){for(;this.nodeBodyElement(t););},nodeBodyElement:function(t){if(this.protoStatement())return!0;if(this.routeStatement())return!0;if(this.Id()){var e=this.result[1];try{var n=t.getField(e)}catch(n){throw new Error("Unknown field '"+e+"' in class '"+t.getTypeName()+"'.")}if(this.comments(),Hr.IS.parse(this)){if(this.isInsideProtoDefinition()){if(this.Id()){var i=this.result[1];try{var o=this.getPrototype().getField(i)}catch(t){return this.exception("No such event or field '"+i+"' inside PROTO "+this.getPrototype().getName()),!0}if(n.getType()===o.getType()){if(o.isReference(n.getAccessType()))return n.addReference(o),!0;throw new Error("Field '"+n.getName()+"' and '"+o.getName()+"' in PROTO "+this.getPrototype().getName()+" are incompatible as an IS mapping.")}throw new Error("Field '"+n.getName()+"' and '"+o.getName()+"' in PROTO "+this.getPrototype().getName()+" have different types.")}throw new Error("No name give after IS statement.")}throw new Error("IS statement outside PROTO definition.")}if(n.isInitializable()){if(this.fieldValue(n))return!0;throw new Error("Couldn't read value for field '"+e+"'.")}throw new Error("Couldn't assign value to "+this.accessTypeToString(n.getAccessType())+" field '"+e+"'.")}return!1},profileNameId:function(){return this.Id()},componentNameId:function(){return this.comments(),Hr.ComponentNameId.parse(this)},categoryNameId:function(){return this.Id()},unitNameId:function(){return this.Id()},exportedNodeNameId:function(){return this.Id()},nodeNameId:function(){return this.Id()},nodeTypeId:function(){return this.Id()},initializeOnlyId:function(){return this.Id()},inputOnlyId:function(){return this.Id()},outputOnlyId:function(){return this.Id()},inputOutputId:function(){return this.Id()},Id:function(){return this.comments(),Hr.Id.parse(this)},fieldType:function(){return this.comments(),Hr.FieldType.parse(this)},fieldValue:function(t){return this.fieldTypes[t.getType()].call(this,t)},double:function(){return this.comments(),Hr.double.parse(this)?(this.value=parseFloat(this.result[1]),!0):Hr.Inf.parse(this)?(this.value=Number.POSITIVE_INFINITY,!0):Hr.NegativeInf.parse(this)?(this.value=Number.NEGATIVE_INFINITY,!0):!!Hr.NaN.parse(this)&&(this.value=Number.NaN,!0)},int32:function(){return this.comments(),!!Hr.int32.parse(this)&&(this.value=parseInt(this.result[1]),!0)},string:function(){return this.comments(),!!Hr.string.parse(this)&&(this.value=Ri.SFString.unescape(this.result[1]),this.lines(this.value),!0)},sfboolValue:function(t){return this.comments(),Hr.TRUE.parse(this)?(t.setValue(!0),!0):!!Hr.FALSE.parse(this)&&(t.setValue(!1),!0)},mfboolValue:function(t){if(t.length=0,this.sfboolValue(this.SFBool))return t.push(this.SFBool),!0;if(Hr.OpenBracket.parse(this)){if(this.sfboolValues(t),this.comments(),Hr.CloseBracket.parse(this))return!0;throw new Error("Expected ']'.")}return!1},sfboolValues:function(t){for(t.length=0,t=t.getTarget();this.sfboolValue(this.SFBool);)t.push(this.SFBool)},sfcolorValue:function(t){if(this.double()){var e=this.value;if(this.double()){var n=this.value;if(this.double()){var i=this.value;return t.r=e,t.g=n,t.b=i,!0}}}return!1},mfcolorValue:function(t){if(t.length=0,this.sfcolorValue(this.SFColor))return t.push(this.SFColor),!0;if(Hr.OpenBracket.parse(this)){if(this.sfcolorValues(t),this.comments(),Hr.CloseBracket.parse(this))return!0;throw new Error("Expected ']'.")}return!1},sfcolorValues:function(t){for(t.length=0,t=t.getTarget();this.sfcolorValue(this.SFColor);)t.push(this.SFColor)},sfcolorrgbaValue:function(t){if(this.double()){var e=this.value;if(this.double()){var n=this.value;if(this.double()){var i=this.value;if(this.double()){var o=this.value;return t.r=e,t.g=n,t.b=i,t.a=o,!0}}}}return!1},mfcolorrgbaValue:function(t){if(t.length=0,this.sfcolorrgbaValue(this.SFColorRGBA))return t.push(this.SFColorRGBA),!0;if(Hr.OpenBracket.parse(this)){if(this.sfcolorrgbaValues(t),this.comments(),Hr.CloseBracket.parse(this))return!0;throw new Error("Expected ']'.")}return!1},sfcolorrgbaValues:function(t){for(t.length=0,t=t.getTarget();this.sfcolorrgbaValue(this.SFColorRGBA);)t.push(this.SFColorRGBA)},sfdoubleValue:function(t){return!!this.double()&&(t.setValue(this.fromUnit(t.getUnit(),this.value)),!0)},mfdoubleValue:function(t){if(t.length=0,this.SFDouble.setUnit(t.getUnit()),this.sfdoubleValue(this.SFDouble))return t.push(this.SFDouble),!0;if(Hr.OpenBracket.parse(this)){if(this.sfdoubleValues(t),this.comments(),Hr.CloseBracket.parse(this))return!0;throw new Error("Expected ']'.")}return!1},sfdoubleValues:function(t){for(t.length=0,t=t.getTarget(),this.SFDouble.setUnit(t.getUnit());this.sfdoubleValue(this.SFDouble);)t.push(this.SFDouble)},sffloatValue:function(t){return this.sfdoubleValue(t)},mffloatValue:function(t){if(t.length=0,this.SFFloat.setUnit(t.getUnit()),this.sffloatValue(this.SFFloat))return t.push(this.SFFloat),!0;if(Hr.OpenBracket.parse(this)){if(this.sffloatValues(t),this.comments(),Hr.CloseBracket.parse(this))return!0;throw new Error("Expected ']'.")}return!1},sffloatValues:function(t){for(t.length=0,t=t.getTarget(),this.SFFloat.setUnit(t.getUnit());this.sffloatValue(this.SFFloat);)t.push(this.SFFloat)},sfimageValue:function(t){if(this.int32()){var e=this.value;if(this.int32()){var n=this.value;if(this.int32()){var i=this.value,o=e*n;t.width=e,t.height=n,t.comp=i;for(var r=t.array,s=0;s<o;++s){if(!this.int32())return!1;r[s]=this.value}return!0}}}return!1},mfimageValue:function(t){if(t.length=0,this.sfimageValue(this.SFImage))return t.push(this.SFImage),!0;if(Hr.OpenBracket.parse(this)){if(this.sfimageValues(t),this.comments(),Hr.CloseBracket.parse(this))return!0;throw new Error("Expected ']'.")}return!1},sfimageValues:function(t){for(t.length=0,t=t.getTarget();this.sfimageValue(this.SFImage);)t.push(this.SFImage)},sfint32Value:function(t){return!!this.int32()&&(t.setValue(this.value),!0)},mfint32Value:function(t){if(t.length=0,this.sfint32Value(this.SFInt32))return t.push(this.SFInt32),!0;if(Hr.OpenBracket.parse(this)){if(this.sfint32Values(t),this.comments(),Hr.CloseBracket.parse(this))return!0;throw new Error("Expected ']'.")}return!1},sfint32Values:function(t){for(t.length=0,t=t.getTarget();this.sfint32Value(this.SFInt32);)t.push(this.SFInt32)},sfmatrix3dValue:function(t){if(this.double()){var e=this.value;if(this.double()){var n=this.value;if(this.double()){var i=this.value;if(this.double()){var o=this.value;if(this.double()){var r=this.value;if(this.double()){var s=this.value;if(this.double()){var a=this.value;if(this.double()){var u=this.value;if(this.double()){var c=this.value;return t[0]=e,t[1]=n,t[2]=i,t[3]=o,t[4]=r,t[5]=s,t[6]=a,t[7]=u,t[8]=c,!0}}}}}}}}}return!1},mfmatrix3dValue:function(t){if(t.length=0,this.sfmatrix3dValue(this.SFMatrix3d))return t.push(this.SFMatrix3d),!0;if(Hr.OpenBracket.parse(this)){if(this.sfmatrix3dValues(t),this.comments(),Hr.CloseBracket.parse(this))return!0;throw new Error("Expected ']'.")}return!1},sfmatrix3dValues:function(t){for(t.length=0,t=t.getTarget();this.sfmatrix3dValue(this.SFMatrix3d);)t.push(this.SFMatrix3d)},sfmatrix3fValue:function(t){return this.sfmatrix3dValue(t)},mfmatrix3fValue:function(t){if(t.length=0,this.sfmatrix3fValue(this.SFMatrix3f))return t.push(this.SFMatrix3f),!0;if(Hr.OpenBracket.parse(this)){if(this.sfmatrix3fValues(t),this.comments(),Hr.CloseBracket.parse(this))return!0;throw new Error("Expected ']'.")}return!1},sfmatrix3fValues:function(t){for(t.length=0,t=t.getTarget();this.sfmatrix3fValue(this.SFMatrix3f);)t.push(this.SFMatrix3f)},sfmatrix4dValue:function(t){if(this.double()){var e=this.value;if(this.double()){var n=this.value;if(this.double()){var i=this.value;if(this.double()){var o=this.value;if(this.double()){var r=this.value;if(this.double()){var s=this.value;if(this.double()){var a=this.value;if(this.double()){var u=this.value;if(this.double()){var c=this.value;if(this.double()){var l=this.value;if(this.double()){var h=this.value;if(this.double()){var d=this.value;if(this.double()){var p=this.value;if(this.double()){var f=this.value;if(this.double()){var g=this.value;if(this.double()){var m=this.value;return t[0]=e,t[1]=n,t[2]=i,t[3]=o,t[4]=r,t[5]=s,t[6]=a,t[7]=u,t[8]=c,t[9]=l,t[10]=h,t[11]=d,t[12]=p,t[13]=f,t[14]=g,t[15]=m,!0}}}}}}}}}}}}}}}}return!1},mfmatrix4dValue:function(t){if(t.length=0,this.sfmatrix4dValue(this.SFMatrix4d))return t.push(this.SFMatrix4d),!0;if(Hr.OpenBracket.parse(this)){if(this.sfmatrix4dValues(t),this.comments(),Hr.CloseBracket.parse(this))return!0;throw new Error("Expected ']'.")}return!1},sfmatrix4dValues:function(t){for(t.length=0,t=t.getTarget();this.sfmatrix4dValue(this.SFMatrix4d);)t.push(this.SFMatrix4d)},sfmatrix4fValue:function(t){return this.sfmatrix4dValue(t)},mfmatrix4fValue:function(t){if(t.length=0,this.sfmatrix4fValue(this.SFMatrix4f))return t.push(this.SFMatrix4f),!0;if(Hr.OpenBracket.parse(this)){if(this.sfmatrix4fValues(t),this.comments(),Hr.CloseBracket.parse(this))return!0;throw new Error("Expected ']'.")}return!1},sfmatrix4fValues:function(t){for(t.length=0,t=t.getTarget();this.sfmatrix4fValue(this.SFMatrix4f);)t.push(this.SFMatrix4f)},sfnodeValue:function(t){var e=this.nodeStatement();return!1!==e&&(t.setValue(e),!0)},mfnodeValue:function(t){t.length=0;var e=this.nodeStatement();if(!1!==e)return t.push(e),!0;if(Hr.OpenBracket.parse(this)){if(this.nodeStatements(t),this.comments(),Hr.CloseBracket.parse(this))return!0;throw new Error("Expected ']'.")}return!1},nodeStatements:function(t){this.statements(t)},sfrotationValue:function(t){if(this.double()){var e=this.value;if(this.double()){var n=this.value;if(this.double()){var i=this.value;if(this.double()){var o=this.value;return t.x=e,t.y=n,t.z=i,t.angle=this.fromUnit("angle",o),!0}}}}return!1},mfrotationValue:function(t){if(t.length=0,this.sfrotationValue(this.SFRotation))return t.push(this.SFRotation),!0;if(Hr.OpenBracket.parse(this)){if(this.sfrotationValues(t),this.comments(),Hr.CloseBracket.parse(this))return!0;throw new Error("Expected ']'.")}return!1},sfrotationValues:function(t){for(t.length=0,t=t.getTarget();this.sfrotationValue(this.SFRotation);)t.push(this.SFRotation)},sfstringValue:function(t){return!!this.string()&&(t.setValue(this.value),!0)},mfstringValue:function(t){if(t.length=0,this.sfstringValue(this.SFString))return t.push(this.SFString),!0;if(Hr.OpenBracket.parse(this)){if(this.sfstringValues(t),this.comments(),Hr.CloseBracket.parse(this))return!0;throw new Error("Expected ']'.")}return!1},sfstringValues:function(t){for(t.length=0,t=t.getTarget();this.sfstringValue(this.SFString);)t.push(this.SFString)},sftimeValue:function(t){return this.sfdoubleValue(t)},mftimeValue:function(t){if(t.length=0,this.sftimeValue(this.SFTime))return t.push(this.SFTime),!0;if(Hr.OpenBracket.parse(this)){if(this.sftimeValues(t),this.comments(),Hr.CloseBracket.parse(this))return!0;throw new Error("Expected ']'.")}return!1},sftimeValues:function(t){for(t.length=0,t=t.getTarget();this.sftimeValue(this.SFTime);)t.push(this.SFTime)},sfvec2dValue:function(t){if(this.double()){var e=this.value;if(this.double()){var n=this.value,i=t.getUnit();return t.x=this.fromUnit(i,e),t.y=this.fromUnit(i,n),!0}}return!1},mfvec2dValue:function(t){if(t.length=0,this.SFVec2d.setUnit(t.getUnit()),this.sfvec2dValue(this.SFVec2d))return t.push(this.SFVec2d),!0;if(Hr.OpenBracket.parse(this)){if(this.sfvec2dValues(t),this.comments(),Hr.CloseBracket.parse(this))return!0;throw new Error("Expected ']'.")}return!1},sfvec2dValues:function(t){for(t.length=0,t=t.getTarget(),this.SFVec2d.setUnit(t.getUnit());this.sfvec2dValue(this.SFVec2d);)t.push(this.SFVec2d)},sfvec2fValue:function(t){return this.sfvec2dValue(t)},mfvec2fValue:function(t){if(t.length=0,this.SFVec2f.setUnit(t.getUnit()),this.sfvec2fValue(this.SFVec2f))return t.push(this.SFVec2f),!0;if(Hr.OpenBracket.parse(this)){if(this.sfvec2fValues(t),this.comments(),Hr.CloseBracket.parse(this))return!0;throw new Error("Expected ']'.")}return!1},sfvec2fValues:function(t){for(t.length=0,t=t.getTarget(),this.SFVec2f.setUnit(t.getUnit());this.sfvec2fValue(this.SFVec2f);)t.push(this.SFVec2f)},sfvec3dValue:function(t){if(this.double()){var e=this.value;if(this.double()){var n=this.value;if(this.double()){var i=this.value,o=t.getUnit();return t.x=this.fromUnit(o,e),t.y=this.fromUnit(o,n),t.z=this.fromUnit(o,i),!0}}}return!1},mfvec3dValue:function(t){if(t.length=0,this.SFVec3d.setUnit(t.getUnit()),this.sfvec3dValue(this.SFVec3d))return t.push(this.SFVec3d),!0;if(Hr.OpenBracket.parse(this)){if(this.sfvec3dValues(t),this.comments(),Hr.CloseBracket.parse(this))return!0;throw new Error("Expected ']'.")}return!1},sfvec3dValues:function(t){for(t.length=0,t=t.getTarget(),this.SFVec3d.setUnit(t.getUnit());this.sfvec3dValue(this.SFVec3d);)t.push(this.SFVec3d)},sfvec3fValue:function(t){return this.sfvec3dValue(t)},mfvec3fValue:function(t){if(t.length=0,this.SFVec3f.setUnit(t.getUnit()),this.sfvec3fValue(this.SFVec3f))return t.push(this.SFVec3f),!0;if(Hr.OpenBracket.parse(this)){if(this.sfvec3fValues(t),this.comments(),Hr.CloseBracket.parse(this))return!0;throw new Error("Expected ']'.")}return!1},sfvec3fValues:function(t){for(t.length=0,t=t.getTarget(),this.SFVec3f.setUnit(t.getUnit());this.sfvec3fValue(this.SFVec3f);)t.push(this.SFVec3f)},sfvec4dValue:function(t){if(this.double()){var e=this.value;if(this.double()){var n=this.value;if(this.double()){var i=this.value;if(this.double()){var o=this.value,r=t.getUnit();return t.x=this.fromUnit(r,e),t.y=this.fromUnit(r,n),t.z=this.fromUnit(r,i),t.w=this.fromUnit(r,o),!0}}}}return!1},mfvec4dValue:function(t){if(t.length=0,this.SFVec4d.setUnit(t.getUnit()),this.sfvec4dValue(this.SFVec4d))return t.push(this.SFVec4d),!0;if(Hr.OpenBracket.parse(this)){if(this.sfvec4dValues(t),this.comments(),Hr.CloseBracket.parse(this))return!0;throw new Error("Expected ']'.")}return!1},sfvec4dValues:function(t){for(t.length=0,t=t.getTarget(),this.SFVec4d.setUnit(t.getUnit());this.sfvec4dValue(this.SFVec4d);)t.push(this.SFVec4d)},sfvec4fValue:function(t){return this.sfvec4dValue(t)},mfvec4fValue:function(t){if(t.length=0,this.SFVec4f.setUnit(t.getUnit()),this.sfvec4fValue(this.SFVec4f))return t.push(this.SFVec4f),!0;if(Hr.OpenBracket.parse(this)){if(this.sfvec4fValues(t),this.comments(),Hr.CloseBracket.parse(this))return!0;throw new Error("Expected ']'.")}return!1},sfvec4fValues:function(t){for(t.length=0,t=t.getTarget(),this.SFVec4f.setUnit(t.getUnit());this.sfvec4fValue(this.SFVec4f);)t.push(this.SFVec4f)},accessTypeToString:function(t){switch(t){case c.initializeOnly:return"initializeOnly";case c.inputOnly:return"inputOnly";case c.outputOnly:return"outputOnly";case c.inputOutput:return"inputOutput"}}}),Wr.prototype.fieldTypes=[],Wr.prototype.fieldTypes[c.SFBool]=Wr.prototype.sfboolValue,Wr.prototype.fieldTypes[c.SFColor]=Wr.prototype.sfcolorValue,Wr.prototype.fieldTypes[c.SFColorRGBA]=Wr.prototype.sfcolorrgbaValue,Wr.prototype.fieldTypes[c.SFDouble]=Wr.prototype.sfdoubleValue,Wr.prototype.fieldTypes[c.SFFloat]=Wr.prototype.sffloatValue,Wr.prototype.fieldTypes[c.SFImage]=Wr.prototype.sfimageValue,Wr.prototype.fieldTypes[c.SFInt32]=Wr.prototype.sfint32Value,Wr.prototype.fieldTypes[c.SFMatrix3f]=Wr.prototype.sfmatrix3dValue,Wr.prototype.fieldTypes[c.SFMatrix3d]=Wr.prototype.sfmatrix3fValue,Wr.prototype.fieldTypes[c.SFMatrix4f]=Wr.prototype.sfmatrix4dValue,Wr.prototype.fieldTypes[c.SFMatrix4d]=Wr.prototype.sfmatrix4fValue,Wr.prototype.fieldTypes[c.SFNode]=Wr.prototype.sfnodeValue,Wr.prototype.fieldTypes[c.SFRotation]=Wr.prototype.sfrotationValue,Wr.prototype.fieldTypes[c.SFString]=Wr.prototype.sfstringValue,Wr.prototype.fieldTypes[c.SFTime]=Wr.prototype.sftimeValue,Wr.prototype.fieldTypes[c.SFVec2d]=Wr.prototype.sfvec2dValue,Wr.prototype.fieldTypes[c.SFVec2f]=Wr.prototype.sfvec2fValue,Wr.prototype.fieldTypes[c.SFVec3d]=Wr.prototype.sfvec3dValue,Wr.prototype.fieldTypes[c.SFVec3f]=Wr.prototype.sfvec3fValue,Wr.prototype.fieldTypes[c.SFVec4d]=Wr.prototype.sfvec4dValue,Wr.prototype.fieldTypes[c.SFVec4f]=Wr.prototype.sfvec4fValue,Wr.prototype.fieldTypes[c.MFBool]=Wr.prototype.mfboolValue,Wr.prototype.fieldTypes[c.MFColor]=Wr.prototype.mfcolorValue,Wr.prototype.fieldTypes[c.MFColorRGBA]=Wr.prototype.mfcolorrgbaValue,Wr.prototype.fieldTypes[c.MFDouble]=Wr.prototype.mfdoubleValue,Wr.prototype.fieldTypes[c.MFFloat]=Wr.prototype.mffloatValue,Wr.prototype.fieldTypes[c.MFImage]=Wr.prototype.mfimageValue,Wr.prototype.fieldTypes[c.MFInt32]=Wr.prototype.mfint32Value,Wr.prototype.fieldTypes[c.MFMatrix3d]=Wr.prototype.mfmatrix3dValue,Wr.prototype.fieldTypes[c.MFMatrix3f]=Wr.prototype.mfmatrix3fValue,Wr.prototype.fieldTypes[c.MFMatrix4d]=Wr.prototype.mfmatrix4dValue,Wr.prototype.fieldTypes[c.MFMatrix4f]=Wr.prototype.mfmatrix4fValue,Wr.prototype.fieldTypes[c.MFNode]=Wr.prototype.mfnodeValue,Wr.prototype.fieldTypes[c.MFRotation]=Wr.prototype.mfrotationValue,Wr.prototype.fieldTypes[c.MFString]=Wr.prototype.mfstringValue,Wr.prototype.fieldTypes[c.MFTime]=Wr.prototype.mftimeValue,Wr.prototype.fieldTypes[c.MFVec2d]=Wr.prototype.mfvec2dValue,Wr.prototype.fieldTypes[c.MFVec2f]=Wr.prototype.mfvec2fValue,Wr.prototype.fieldTypes[c.MFVec3d]=Wr.prototype.mfvec3dValue,Wr.prototype.fieldTypes[c.MFVec3f]=Wr.prototype.mfvec3fValue,Wr.prototype.fieldTypes[c.MFVec4d]=Wr.prototype.mfvec4dValue,Wr.prototype.fieldTypes[c.MFVec4f]=Wr.prototype.mfvec4fValue,lt.prototype.fromString=function(t,e){const n=new Wr(e);if(n.setUnits(!!e),n.setInput(t),!n.fieldValue(this))throw new Error("Couldn't read value for field '"+this.getName()+"'.")};const Kr=Wr;n.set("x_ite/Parser/VRMLParser",Kr);const Jr=Kr;var Zr=i(603);const Qr={initializeOnly:c.initializeOnly,inputOnly:c.inputOnly,outputOnly:c.outputOnly,inputOutput:c.inputOutput};function $r(t){Gr.call(this,t),this.protoDeclarations=[],this.parents=[],this.parser=new Jr(t),this.url=new Ri.MFString,this.protoNames=new Map,this.protoFields=new WeakMap;try{this.setUnits(this.getScene().getMetaData("generator")),this.parser.setUnits(this.getUnits())}catch(t){}}$r.prototype=Object.assign(Object.create(Gr.prototype),{constructor:$r,isValid:function(){return this.input instanceof XMLDocument||this.input instanceof HTMLElement||null===this.input},getInput:function(){return this.input},setInput(t){try{"string"==typeof t&&(t=Zr.parseXML(t)),this.input=t,this.xml=this.isXML(t),this.xml||Object.assign(this,ss)}catch(t){this.input=void 0}},isXML:function(t){return!(t instanceof HTMLElement)},parseIntoScene:function(t,e){this.success=t,this.error=e,this.getScene().setEncoding("XML"),this.getScene().setProfile(this.getBrowser().getProfile("Full")),this.xmlElement(this.input)},xmlElement:function(t){if(null===t&&this.success)return this.success(this.getScene());switch(t.nodeName){case"#document":var e=Zr(t).children("X3D");if(e.length)for(var n=0;n<e.length;++n)this.x3dElement(e[n]);else this.success?this.loadComponents().then(function(){this.childrenElements(t),this.success(this.getScene())}.bind(this)).catch(function(t){this.error&&this.error(t)}.bind(this)):this.childrenElements(t);break;case"X3D":this.x3dElement(t);break;case"Scene":case"SCENE":this.success?this.loadComponents().then(function(){this.sceneElement(t),this.success(this.getScene())}.bind(this)).catch(function(t){this.error&&this.error(t)}.bind(this)):this.sceneElement(t);break;default:this.success?this.loadComponents().then(function(){this.childrenElements(t),this.success(this.getScene())}.bind(this)).catch(function(t){this.error&&this.error(t)}.bind(this)):this.childrenElements(t)}},x3dElement:function(t){try{var e=t.getAttribute("profile"),n=this.getBrowser().getProfile(e||"Full");Zr.data(this.scene,"X3D",t),this.getScene().setProfile(n)}catch(t){console.error(t)}var i=t.getAttribute("version");i&&this.getScene().setSpecificationVersion(i);for(var o=t.childNodes,r=0;r<o.length;++r)this.x3dElementChildHead(o[r]);if(this.success)this.loadComponents().then(function(){for(var t=0;t<o.length;++t)this.x3dElementChildScene(o[t]);this.success(this.getScene())}.bind(this)).catch(function(t){this.error&&this.error(t)}.bind(this));else for(r=0;r<o.length;++r)this.x3dElementChildScene(o[r])},x3dElementChildHead:function(t){switch(t.nodeName){case"head":case"HEAD":return void this.headElement(t)}},x3dElementChildScene:function(t){switch(t.nodeName){case"Scene":case"SCENE":return void this.sceneElement(t)}},headElement:function(t){for(var e=t.childNodes,n=0;n<e.length;++n)this.headElementChild(e[n]);try{this.setUnits(this.getScene().getMetaData("generator")),this.parser.setUnits(this.getUnits())}catch(t){}},headElementChild:function(t){switch(t.nodeName){case"component":case"COMPONENT":return void this.componentElement(t);case"unit":case"UNIT":return void this.unitElement(t);case"meta":case"META":return void this.metaElement(t)}},componentElement:function(t){try{var e=t.getAttribute("name"),n=parseInt(t.getAttribute("level"));if(null===e)return console.warn("XML Parser Error: Bad component statement: Expected name attribute.");if(null===n)return console.warn("XML Parser Error: Bad component statement: Expected level attribute.");var i=this.getBrowser().getComponent(e,n);this.getScene().addComponent(i)}catch(t){console.log(t.message)}},unitElement:function(t){var e=t.getAttribute("category"),n=t.getAttribute("name"),i=t.getAttribute("conversionFactor");return null===e?console.warn("XML Parser Error: Bad unit statement: Expected category attribute."):null===n?console.warn("XML Parser Error: Bad unit statement: Expected name attribute."):null===i?console.warn("XML Parser Error: Bad unit statement: Expected conversionFactor attribute."):void this.getScene().updateUnit(e,n,parseFloat(i))},metaElement:function(t){var e=t.getAttribute("name"),n=t.getAttribute("content");return null===e?console.warn("XML Parser Error: Bad meta statement: Expected name attribute."):null===n?console.warn("XML Parser Error: Bad meta statement: Expected content attribute."):void this.getScene().addMetaData(e,n)},sceneElement:function(t){Zr.data(t,"node",this.scene),this.childrenElements(t)},childrenElements:function(t){for(var e=t.childNodes,n=0;n<e.length;++n)this.childElement(e[n])},childElement:function(t){switch(t.nodeName){case"#comment":case"#text":return;case"#cdata-section":return void this.cdataNode(t);case"ExternProtoDeclare":case"EXTERNPROTODECLARE":return void this.externProtoDeclareElement(t);case"ProtoDeclare":case"PROTODECLARE":return void this.protoDeclareElement(t);case"IS":return void this.isElement(t);case"ProtoInstance":case"PROTOINSTANCE":return void this.protoInstanceElement(t);case"fieldValue":case"FIELDVALUE":return void this.fieldValueElement(t);case"field":case"FIELD":return void this.fieldElement(t);case"ROUTE":return void this.routeElement(t);case"IMPORT":return void this.importElement(t);case"EXPORT":return void this.exportElement(t);default:return void this.nodeElement(t)}},externProtoDeclareElement:function(t){var e=t.getAttribute("name");if(this.id(e)){var n=t.getAttribute("url");if(null===n)return console.warn("XML Parser Error: Bad ExternProtoDeclare statement: Expected url attribute.");this.parser.setInput(n),Jr.prototype.sfstringValues.call(this.parser,this.url);var i=new Dc(this.getExecutionContext(),this.url);this.pushParent(i),this.protoInterfaceElement(t),this.popParent(),this.addProtoFieldNames(i),i.setup();try{const t=this.getExecutionContext().getExternProtoDeclaration(e);this.getExecutionContext().updateExternProtoDeclaration(this.getExecutionContext().getUniqueExternProtoName(e),t)}catch(t){}this.getExecutionContext().updateExternProtoDeclaration(e,i),this.addProtoName(e)}},protoDeclareElement:function(t){var e=t.getAttribute("name");if(this.id(e)){for(var n=new Rr(this.getExecutionContext()),i=t.childNodes,o=0;o<i.length;++o){switch((r=i[o]).nodeName){case"ProtoInterface":case"PROTOINTERFACE":this.pushParent(n),this.protoInterfaceElement(r),this.popParent(),this.addProtoFieldNames(n);break;default:continue}break}for(o=0;o<i.length;++o){var r;switch((r=i[o]).nodeName){case"ProtoBody":case"PROTOBODY":this.pushPrototype(n),this.pushExecutionContext(n.getBody()),this.pushParent(n),this.protoBodyElement(r),this.popParent(),this.popExecutionContext(),this.popPrototype();break;default:continue}break}n.setup();try{const t=this.getExecutionContext().getProtoDeclaration(e);this.getExecutionContext().updateProtoDeclaration(this.getExecutionContext().getUniqueProtoName(e),t)}catch(t){}this.getExecutionContext().updateProtoDeclaration(e,n),this.addProtoName(e)}},protoInterfaceElement:function(t){for(var e=t.childNodes,n=0;n<e.length;++n)this.protoInterfaceElementChild(e[n])},protoInterfaceElementChild:function(t){switch(t.nodeName){case"field":case"FIELD":return void this.fieldElement(t)}},fieldElement:function(t){try{if(0===this.getParents().length)return;var e=this.getParent();if(!(e instanceof $i))return;if(!e.canUserDefinedFields())return;var n=Qr[t.getAttribute("accessType")];void 0===n&&(n=c.initializeOnly);var i=Ri[t.getAttribute("type")];if(void 0===i)return;var o=t.getAttribute("name");if(!this.id(o))return;var r=new i;n&c.initializeOnly&&(this.fieldValue(r,t.getAttribute("value")),this.pushParent(r),this.childrenElements(t),this.popParent()),e.addUserDefinedField(n,o,r)}catch(t){}},protoBodyElement:function(t){this.childrenElements(t)},isElement:function(t){if(this.isInsideProtoDefinition())for(var e=t.childNodes,n=0;n<e.length;++n)this.isElementChild(e[n])},isElementChild:function(t){switch(t.nodeName){case"connect":case"CONNECT":return void this.connectElement(t)}},connectElement:function(t){var e=t.getAttribute("nodeField"),n=t.getAttribute("protoField");if(null===e)return console.warn("XML Parser Error: Bad connect statement: Expected nodeField attribute.");if(null===n)return console.warn("XML Parser Error: Bad connect statement: Expected protoField attribute.");try{if(0===this.getParents().length)return;var i=this.getParent(),o=this.getPrototype();if(!(i instanceof $i))return;var r=i.getField(e),s=o.getField(n);if(r.getType()!==s.getType())throw new Error("Field '"+r.getName()+"' and '"+s.getName()+"' in PROTO "+this.proto.getName()+" have different types.");if(!s.isReference(r.getAccessType()))throw new Error("Field '"+r.getName()+"' and '"+s.getName()+"' in PROTO "+o.getName()+" are incompatible as an IS mapping.");r.addReference(s)}catch(t){console.warn("XML Parser Error: Couldn't create IS reference: "+t.message)}},protoInstanceElement:function(t){try{if(this.useAttribute(t))return;var e=t.getAttribute("name");if(this.id(e)){var n=this.getExecutionContext().createProto(e,!1);if(!n)throw new Error("Unknown proto or externproto type '"+e+"'.");Zr.data(t,"node",n),this.defAttribute(t,n),this.addNode(t,n),this.pushParent(n),this.childrenElements(t),this.isInsideProtoDefinition()||n.setup(),this.popParent()}}catch(t){console.warn("XML Parser Error: ",t.message)}},fieldValueElement:function(t){try{if(0===this.getParents().length)return;var e=this.getParent(),n=t.getAttribute("name");if(!(e instanceof Or))return;if(!this.id(n))return;var i=e.getField(n);i.getAccessType()&c.initializeOnly&&(i.getType()===c.MFNode&&(i.length=0),this.fieldValue(i,t.getAttribute("value")),this.pushParent(i),this.childrenElements(t),this.popParent())}catch(t){console.warn("XML Parser Error: Couldn't assign field value: "+t.message)}},nodeElement:function(t){try{if(this.useAttribute(t))return;var e=this.getExecutionContext().createProto(this.protoNameToCamelCase(t.nodeName),!1);if(e||(e=this.getExecutionContext().createNode(this.nodeNameToCamelCase(t.nodeName),!1)),!e)throw new Error("Unknown node type '"+t.nodeName+"', you probably have insufficient component/profile statements.");Zr.data(t,"node",e),"SCRIPT"===t.nodeName&&this.scriptElement(t),this.defAttribute(t,e),this.addNode(t,e),this.pushParent(e),this.nodeAttributes(t,e),this.childrenElements(t),this.isInsideProtoDefinition()||e.setup(),this.popParent()}catch(e){if("NULL"==t.nodeName)return void this.addNode(t,null);console.error("XML Parser Error: "+e.message)}},scriptElement(t){const e=(new DOMParser).parseFromString(t.outerHTML,"application/xml").children[0].childNodes;t.textContent="// Content moved into childNodes.";for(const n of e)1!==n.nodeType&&4!==n.nodeType||t.appendChild(n)},routeElement:function(t){try{var e=t.getAttribute("fromNode"),n=t.getAttribute("fromField"),i=t.getAttribute("toNode"),o=t.getAttribute("toField");if(null===e)throw new Error("Bad ROUTE statement: Expected fromNode attribute.");if(null===n)throw new Error("Bad ROUTE statement: Expected fromField attribute.");if(null===i)throw new Error("Bad ROUTE statement: Expected toNode attribute.");if(null===o)throw new Error("Bad ROUTE statement: Expected toField attribute.");var r=this.getExecutionContext(),s=r.getLocalNode(e),a=r.getLocalNode(i),u=r.addRoute(s,n,a,o);Zr.data(t,"node",u)}catch(t){console.warn("XML Parser Error: "+t.message)}},importElement:function(t){try{var e=t.getAttribute("inlineDEF"),n=t.getAttribute("importedDEF")||t.getAttribute("exportedDEF"),i=t.getAttribute("AS");if(null===e)throw new Error("Bad IMPORT statement: Expected inlineDEF attribute.");if(null===n)throw new Error("Bad IMPORT statement: Expected importedDEF attribute.");i||(i=n);var o=this.getExecutionContext().getNamedNode(e);this.getExecutionContext().updateImportedNode(o,n,i)}catch(t){console.warn("XML Parser Error: "+t.message)}},exportElement:function(t){try{if(this.getScene()!==this.getExecutionContext())return void console.warn("XML Parser Error: Export statement not allowed here.");var e=t.getAttribute("localDEF"),n=t.getAttribute("AS");if(null===e)throw new Error("Bad EXPORT statement: Expected localDEF attribute.");n||(n=e);var i=this.getExecutionContext().getLocalNode(e);this.getScene().updateExportedNode(n,i)}catch(t){console.warn("XML Parser Error: "+t.message)}},cdataNode:function(t){if(0!==this.getParents().length){var e=this.getParent();if(e instanceof $i){var n=e.getSourceText();n&&n.push(t.data)}}},useAttribute:function(t){try{var e=t.getAttribute("USE");if(this.id(e)){var n=this.getExecutionContext().getNamedNode(e);return this.addNode(t,n.getValue()),!0}}catch(t){console.warn("Invalid USE name: "+t.message)}return!1},defAttribute:function(t,e){try{var n=t.getAttribute("DEF");if(n){try{var i=this.getExecutionContext().getNamedNode(n);this.getExecutionContext().updateNamedNode(this.getExecutionContext().getUniqueName(n),i)}catch(t){}this.getExecutionContext().updateNamedNode(n,e)}}catch(t){console.warn("Invalid DEF name: "+t.message)}},nodeAttributes:function(t,e){for(var n=t.attributes,i=0;i<n.length;++i)this.nodeAttribute(n[i],e)},nodeAttribute:function(t,e){try{const n=e.getField(this.attributeToCamelCase(e,t.name));n.isInitializable()&&this.fieldValue(n,t.value)}catch(t){}},fieldValue:function(t,e){null!==e&&(this.parser.pushExecutionContext(this.getExecutionContext()),this.parser.setInput(e),this.fieldTypes[t.getType()].call(this.parser,t),this.parser.popExecutionContext())},id:function(t){return null!==t&&0!==t.length},getParents:function(){return this.parents},getParent:function(){return this.parents.at(-1)},pushParent:function(t){return this.parents.push(t)},popParent:function(){this.parents.pop()},addNode:function(t,e){if(0===this.parents.length||this.getParent()instanceof Rr)this.getExecutionContext().rootNodes.push(e);else{var n=this.getParent();if(n instanceof lt)switch(n.getType()){case c.SFNode:return void n.setValue(e);case c.MFNode:return void n.push(e)}else try{var i=t.getAttribute("containerField");if(!i){if(!e)throw new Error("NULL node must have a container field attribute.");i=e.getContainerField()}var o=n.getField(i);switch(o.getType()){case c.SFNode:return void o.setValue(e);case c.MFNode:return void o.push(e)}}catch(t){}}},addProtoName:function(t){},addProtoFieldNames:function(t){},protoNameToCamelCase:function(t){return t},nodeNameToCamelCase:function(t){return t},attributeToCamelCase:function(t,e){return e}}),$r.prototype.fieldTypes=[],$r.prototype.fieldTypes[c.SFBool]=Jr.prototype.sfboolValue,$r.prototype.fieldTypes[c.SFColor]=Jr.prototype.sfcolorValue,$r.prototype.fieldTypes[c.SFColorRGBA]=Jr.prototype.sfcolorrgbaValue,$r.prototype.fieldTypes[c.SFDouble]=Jr.prototype.sfdoubleValue,$r.prototype.fieldTypes[c.SFFloat]=Jr.prototype.sffloatValue,$r.prototype.fieldTypes[c.SFImage]=Jr.prototype.sfimageValue,$r.prototype.fieldTypes[c.SFInt32]=Jr.prototype.sfint32Value,$r.prototype.fieldTypes[c.SFMatrix3f]=Jr.prototype.sfmatrix3dValue,$r.prototype.fieldTypes[c.SFMatrix3d]=Jr.prototype.sfmatrix3fValue,$r.prototype.fieldTypes[c.SFMatrix4f]=Jr.prototype.sfmatrix4dValue,$r.prototype.fieldTypes[c.SFMatrix4d]=Jr.prototype.sfmatrix4fValue,$r.prototype.fieldTypes[c.SFNode]=function(t){t.setValue(null)},$r.prototype.fieldTypes[c.SFRotation]=Jr.prototype.sfrotationValue,$r.prototype.fieldTypes[c.SFString]=function(t){t.setValue(Ri.SFString.unescape(this.input))},$r.prototype.fieldTypes[c.SFTime]=Jr.prototype.sftimeValue,$r.prototype.fieldTypes[c.SFVec2d]=Jr.prototype.sfvec2dValue,$r.prototype.fieldTypes[c.SFVec2f]=Jr.prototype.sfvec2fValue,$r.prototype.fieldTypes[c.SFVec3d]=Jr.prototype.sfvec3dValue,$r.prototype.fieldTypes[c.SFVec3f]=Jr.prototype.sfvec3fValue,$r.prototype.fieldTypes[c.SFVec4d]=Jr.prototype.sfvec4dValue,$r.prototype.fieldTypes[c.SFVec4f]=Jr.prototype.sfvec4fValue,$r.prototype.fieldTypes[c.MFBool]=Jr.prototype.sfboolValues,$r.prototype.fieldTypes[c.MFColor]=Jr.prototype.sfcolorValues,$r.prototype.fieldTypes[c.MFColorRGBA]=Jr.prototype.sfcolorrgbaValues,$r.prototype.fieldTypes[c.MFDouble]=Jr.prototype.sfdoubleValues,$r.prototype.fieldTypes[c.MFFloat]=Jr.prototype.sffloatValues,$r.prototype.fieldTypes[c.MFImage]=Jr.prototype.sfimageValues,$r.prototype.fieldTypes[c.MFInt32]=Jr.prototype.sfint32Values,$r.prototype.fieldTypes[c.MFMatrix3d]=Jr.prototype.sfmatrix3dValues,$r.prototype.fieldTypes[c.MFMatrix3f]=Jr.prototype.sfmatrix3fValues,$r.prototype.fieldTypes[c.MFMatrix4d]=Jr.prototype.sfmatrix4dValues,$r.prototype.fieldTypes[c.MFMatrix4f]=Jr.prototype.sfmatrix4fValues,$r.prototype.fieldTypes[c.MFNode]=function(t){t.length=0},$r.prototype.fieldTypes[c.MFRotation]=Jr.prototype.sfrotationValues,$r.prototype.fieldTypes[c.MFString]=Jr.prototype.sfstringValues,$r.prototype.fieldTypes[c.MFTime]=Jr.prototype.sftimeValues,$r.prototype.fieldTypes[c.MFVec2d]=Jr.prototype.sfvec2dValues,$r.prototype.fieldTypes[c.MFVec2f]=Jr.prototype.sfvec2fValues,$r.prototype.fieldTypes[c.MFVec3d]=Jr.prototype.sfvec3dValues,$r.prototype.fieldTypes[c.MFVec3f]=Jr.prototype.sfvec3fValues,$r.prototype.fieldTypes[c.MFVec4d]=Jr.prototype.sfvec4dValues,$r.prototype.fieldTypes[c.MFVec4f]=Jr.prototype.sfvec4fValues;const ts=/\binf\b/g,es=/\bnan\b/g,ns=/^[\x20\n,\t\r"]+|[\x20\n,\t\r"]+$/g,is=/[\x20\n,\t\r"]+/,os=new RegExp('"((?:[^\\\\"]|\\\\\\\\|\\\\\\")*)"',"g");function rs(t){return t.replace(ts,"Infinity").replace(es,"NaN").replace(ns,"").split(is)}$r.prototype.fieldTypes[c.MFColor]=$r.prototype.fieldTypes[c.MFColorRGBA]=$r.prototype.fieldTypes[c.MFMatrix3d]=$r.prototype.fieldTypes[c.MFMatrix3f]=$r.prototype.fieldTypes[c.MFMatrix4d]=$r.prototype.fieldTypes[c.MFMatrix4f]=$r.prototype.fieldTypes[c.MFVec4d]=$r.prototype.fieldTypes[c.MFVec4f]=function(t){t.setValue(rs(this.getInput()).map((function(t){return parseFloat(t)})))},$r.prototype.fieldTypes[c.MFBool]=function(t){var e;t.setValue((e=this.getInput(),e.replace(ns,"").split(is)).map((function(t){return"true"===t||"TRUE"===t})))},$r.prototype.fieldTypes[c.MFInt32]=function(t){var e;t.setValue((e=this.getInput(),e.replace(ns,"").split(is)).map((function(t){return parseInt(t)})))},$r.prototype.fieldTypes[c.MFDouble]=$r.prototype.fieldTypes[c.MFFloat]=$r.prototype.fieldTypes[c.MFVec2d]=$r.prototype.fieldTypes[c.MFVec2f]=$r.prototype.fieldTypes[c.MFVec3d]=$r.prototype.fieldTypes[c.MFVec3f]=function(t){var e=t.getUnit();t.setValue(rs(this.getInput()).map((function(t){return this.fromUnit(e,parseFloat(t))}),this))},$r.prototype.fieldTypes[c.MFString]=function(t){t.setValue(function(t){for(var e=null,n=[];e=os.exec(t);)n.push(e[1]);return n.map(Ri.SFString.unescape)}(this.getInput()))};const ss={addProtoName:function(t){this.protoNames.set(t,t),this.protoNames.set(t.toUpperCase(),t)},addProtoFieldNames:function(){const t=new Set;for(const e of["DEF","USE","containerField"])t.add(e).add(e.toLowerCase());return function(e){const n=new Map;this.protoFields.set(e,n);for(const{name:i}of e.getFieldDefinitions())t.has(i)||(n.set(i,i),n.set(i.toLowerCase(),i))}}(),protoNameToCamelCase:function(t){return this.protoNames.get(t)},nodeNameToCamelCase:function(t){return Bi.getNodeTypeName(t)},attributeToCamelCase:function(t,e){return t instanceof Or?this.protoFields.get(t.getProtoNode()).get(e):Bi.getFieldName(e)}},as=$r;n.set("x_ite/Parser/XMLParser",as);const us=as;function cs(t){Gr.call(this,t),this.namespace="http://www.web3d.org/specifications/x3d-namespace"}cs.prototype=Object.assign(Object.create(Gr.prototype),{constructor:cs,isValid:function(){return this.input instanceof Object},getInput:function(){return this.input},setInput:function(t){try{"string"==typeof t&&(t=JSON.parse(t)),this.input=t}catch(t){this.input=void 0}},parseIntoScene:function(t,e){const n=this.createElement("X3D");this.convertToDOM(this.input,"",n);const i=new us(this.getScene());return i.setInput(n),i.parseIntoScene(t,e),n},elementSetAttribute:function(t,e,n){switch(e){case"SON schema":case"ncoding":break;default:"function"==typeof t.setAttribute&&t.setAttribute(e,n)}},convertChildren:function(t,e,n){for(const i in e)"object"==typeof e[i]&&(isNaN(parseInt(i))?this.convertObject(i,e,n,t.substr(1)):this.convertToDOM(e[i],i,n,t.substr(1)))},createElement:function(t,e){if(void 0===this.namespace)var n=document.createElement(t);else null==(n=document.createElementNS(this.namespace,t))&&(console.error("Trouble creating element for",t),n=document.createElement(t));return void 0!==e&&this.elementSetAttribute(n,"containerField",e),n},createCDATA:function(t,e,n){let i=n.trim().replace(/\\"/g,'\\"').replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&");do{i=(n=i).replace(/'([^'\r\n]*)\n([^']*)'/g,"'$1\\n$2'"),n!==i&&console.log("CDATA Replacing",n,"with",i)}while(i!==n);const o="<script> <![CDATA[ "+i+" ]]> <\/script>",r=(new DOMParser).parseFromString(o,"application/xml").children[0].childNodes[1];e.appendChild(r)},convertObject:function(t,e,n,i){if(null!==e&&"object"==typeof e[t])if("@"===t.substr(0,1))this.convertToDOM(e[t],t,n);else if("-"===t.substr(0,1))this.convertChildren(t,e[t],n);else if("#comment"===t)for(const i in e[t]){const o=document.createComment(this.commentStringToXML(e[t][i]));n.appendChild(o)}else if("#sourceCode"===t||"@sourceCode"===t||"#sourceText"===t)this.createCDATA(document,n,e[t].join("\r\n")+"\r\n");else if("connect"===t||"fieldValue"===t||"field"===t||"meta"===t||"component"===t){for(const o in e[t])if("object"==typeof e[t][o]){const r=this.createElement(t,i);this.convertToDOM(e[t][o],o,r),n.appendChild(r),n.appendChild(document.createTextNode("\n"))}}else{const o=this.createElement(t,i);this.convertToDOM(e[t],t,o),n.appendChild(o),n.appendChild(document.createTextNode("\n"))}},commentStringToXML:function(t){let e=t;return e!==(t=t.replace(/\\\\/g,"\\"))&&console.log("X3DJSONLD <!-> replacing",e,"with",t),t},SFStringToXML:function(t){const e=t;return e!==(t=(t=t.replace(/\\/g,"\\\\")).replace(/"/g,'\\"'))&&console.log("X3DJSONLD [] replacing",e,"with",t),t},JSONStringToXML:function(t){const e=t;return e!==(t=(t=t.replace(/\\/g,"\\\\")).replace(/\n/g,"\\n"))&&console.log("X3DJSONLD replacing",e,"with",t),t},convertToDOM:function(t,e,n,i){let o=!1,r=[],s=!1;for(const e in t)if(o=!isNaN(parseInt(e)),o)switch(typeof t[e]){case"number":case"boolean":r.push(t[e]);break;case"string":r.push(t[e]),s=!0;break;case"object":this.convertToDOM(t[e],e,n);break;case"undefined":break;default:console.error("Unknown type found in array "+typeof t[e])}else switch(typeof t[e]){case"object":"X3D"===e?this.convertToDOM(t[e],e,n):this.convertObject(e,t,n,i);break;case"number":case"boolean":this.elementSetAttribute(n,e.substr(1),t[e]);break;case"string":if("#comment"!==e)this.elementSetAttribute(n,e.substr(1),this.JSONStringToXML(t[e]));else{const i=document.createComment(this.commentStringToXML(t[e]));n.appendChild(i)}break;case"undefined":break;default:console.error("Unknown type found in object "+typeof t[e]),console.error(t)}if(o){if("@"===e.substr(0,1))if(s){s=!1;for(const t in r)r[t]=this.SFStringToXML(r[t]);this.elementSetAttribute(n,e.substr(1),'"'+r.join('" "')+'"')}else this.elementSetAttribute(n,e.substr(1),r.join(" "));o=!1}return n}});const ls=cs;n.set("x_ite/Parser/JSONParser",ls);const hs=ls;function ds(t){Gr.call(this,t)}ds.prototype=Object.assign(Object.create(Gr.prototype),{constructor:ds,parseIntoScene:function(t,e,n){for(const i of ds.Parser)try{const o=new i(this.getScene());if(o.setInput(t),o.isValid())return o.pushExecutionContext(this.getExecutionContext()),o.parseIntoScene(e,n),void o.popExecutionContext()}catch(t){if(!n)throw t;return void n(t)}throw this.getScene().worldURL.startsWith("data:")?new Error("Couldn't parse X3D. No suitable file handler found for 'data:' URL."):new Error("Couldn't parse X3D. No suitable file handler found for '"+this.getScene().worldURL+"'.")}}),ds.Parser=[us,hs,Jr];const ps=ds;n.set("x_ite/Parser/GoldenGate",ps);const fs=ps,gs=new xe(0,0,0),ms=new xe(0,0,0),_s=new hn;function xs(t,e){this.normal=e.copy(),this.distanceFromOrigin=e.dot(t)}xs.prototype={constructor:xs,copy:function(){const t=Object.create(xs.prototype);return t.normal=this.normal.copy(),t.distanceFromOrigin=this.distanceFromOrigin,t},assign:function(t){return this.normal.assign(t.normal),this.distanceFromOrigin=t.distanceFromOrigin,this},set:function(t,e){return this.normal.assign(e),this.distanceFromOrigin=e.dot(t),this},multRight:function(t){return ms.assign(this.normal).multiply(this.distanceFromOrigin),_s.assign(t).inverse(),_s.multMatrixDir(gs.assign(this.normal)).normalize(),t.multVecMatrix(ms),this.normal.assign(gs),this.distanceFromOrigin=gs.dot(ms),this},multLeft:function(t){return ms.assign(this.normal).multiply(this.distanceFromOrigin),_s.assign(t).inverse(),_s.multDirMatrix(gs.assign(this.normal)).normalize(),t.multMatrixVec(ms),this.normal.assign(gs),this.distanceFromOrigin=gs.dot(ms),this},getDistanceToPoint:function(t){return xe.dot(t,this.normal)-this.distanceFromOrigin},intersectsLine:function(t,e){const n=t.point,i=t.direction,o=i.dot(this.normal);if(0===o)return!1;const r=(this.distanceFromOrigin-this.normal.dot(n))/o;return e.x=n.x+i.x*r,e.y=n.y+i.y*r,e.z=n.z+i.z*r,!0},toString:function(){return this.normal.toString()+" "+this.distanceFromOrigin}};const ys=xs;n.set("standard/Math/Geometry/Plane3",ys);const ws=ys;var Ss=i(487);const Ts={area:function(){const t=new xe(0,0,0),e=new xe(0,0,0);return function(n,i,o){return t.assign(i).subtract(n).cross(e.assign(o).subtract(n)).magnitude()/2}}(),normal:function(t,e,n,i){const o=n.x-e.x,r=n.y-e.y,s=n.z-e.z,a=t.x-e.x,u=t.y-e.y,c=t.z-e.z;return i.set(r*c-s*u,s*a-o*c,o*u-r*a),i.normalize()},quadNormal:function(t,e,n,i,o){const r=n.x-t.x,s=n.y-t.y,a=n.z-t.z,u=i.x-e.x,c=i.y-e.y,l=i.z-e.z;return o.set(s*l-a*c,a*u-r*l,r*c-s*u),o.normalize()},triangulatePolygon:function(){const t=function(){const t=new Ss.GluTesselator;return t.gluTessCallback(Ss.gluEnum.GLU_TESS_VERTEX_DATA,(function(t,e){e[e.length]=t})),t.gluTessCallback(Ss.gluEnum.GLU_TESS_BEGIN,(function(t){t!==Ss.primitiveType.GL_TRIANGLES&&console.log("expected TRIANGLES but got type: "+t)})),t.gluTessCallback(Ss.gluEnum.GLU_TESS_ERROR,(function(t){console.log("error callback"),console.log("error number: "+t)})),t.gluTessCallback(Ss.gluEnum.GLU_TESS_COMBINE,(function(t,e,n){return e[0]})),t.gluTessCallback(Ss.gluEnum.GLU_TESS_EDGE_FLAG,(function(t){})),t.gluTessProperty(Ss.gluEnum.GLU_TESS_TOLERANCE,0),t.gluTessProperty(Ss.gluEnum.GLU_TESS_WINDING_RULE,Ss.windingRule.GLU_TESS_WINDING_ODD),t}();return function(){const e=arguments[arguments.length-1];t.gluTessBeginPolygon(e);for(let e=0,n=arguments.length-1;e<n;++e){t.gluTessBeginContour();for(const n of arguments[e])t.gluTessVertex(n,n);t.gluTessEndContour()}return t.gluTessEndPolygon(),e}}(),triangulateConvexPolygon:function(t,e){for(let n=1,i=t.length-1;n<i;++n)e.push(t[0],t[n],t[n+1])},getPolygonNormal:function(t,e){e.set(0,0,0);var n=t[0];for(let o=0,r=t.length;o<r;++o){var i=n;n=t[(o+1)%r];e.x+=(i.y-n.y)*(i.z+n.z),e.y+=(i.z-n.z)*(i.x+n.x),e.z+=(i.x-n.x)*(i.y+n.y)}return e.normalize()}},bs=Ts;n.set("standard/Math/Geometry/Triangle3",bs);const vs=bs,Cs={min:0,max:0},Es={min:0,max:0};function Os(){}function Ns(t,e,n){n.min=Number.POSITIVE_INFINITY,n.max=Number.NEGATIVE_INFINITY;for(const i of t){const t=i.dot(e);t<n.min&&(n.min=t),t>n.max&&(n.max=t)}}function Fs(t,e,n){return e<=t&&t<=n}Os.isSeparated=function(t,e,n){for(const s of t)if(Ns(e,s,Cs),Ns(n,s,Es),r=Es.max,!Fs(o=Es.min,i=Cs.min,Cs.max)&&!Fs(i,o,r))return!0;var i,o,r;return!1};const Is=Os;n.set("standard/Math/Algorithms/SAT",Is);const Ms=Is;function Ds(t,e,n){this.viewport=new Xe(0,0,0,0),this.scissor=new Xe(0,0,0,0),this.points=[new xe(0,0,0),new xe(0,0,0),new xe(0,0,0),new xe(0,0,0),new xe(0,0,0),new xe(0,0,0),new xe(0,0,0),new xe(0,0,0)],this.normals=[new xe(0,0,0),new xe(0,0,0),new xe(0,0,0),new xe(0,0,0),new xe(0,0,0),new xe(0,0,0)],this.edges=[new xe(0,0,0),new xe(0,0,0),new xe(0,0,0),new xe(0,0,0),new xe(0,0,0),new xe(0,0,0),new xe(0,0,0),new xe(0,0,0)],this.planes=[new ws(xe.Zero,xe.Zero),new ws(xe.Zero,xe.Zero),new ws(xe.Zero,xe.Zero),new ws(xe.Zero,xe.Zero),new ws(xe.Zero,xe.Zero),new ws(xe.Zero,xe.Zero)],arguments.length&&this.set(t,e,n)}Ds.prototype={constructor:Ds,set:function(){const t=new hn;return function(e,n,i){this.viewport.assign(n),this.scissor.assign(i);const o=this.points,r=o[0],s=o[1],a=o[2],u=o[3],c=o[4],l=o[5],h=o[6],d=o[7],p=i[0],f=p+i[2],g=i[1],m=g+i[3];t.assign(e).inverse(),Ds.unProjectPointMatrix(p,g,0,t,n,r),Ds.unProjectPointMatrix(f,g,0,t,n,s),Ds.unProjectPointMatrix(f,m,0,t,n,a),Ds.unProjectPointMatrix(p,m,0,t,n,u),Ds.unProjectPointMatrix(p,g,1,t,n,c),Ds.unProjectPointMatrix(f,g,1,t,n,l),Ds.unProjectPointMatrix(f,m,1,t,n,h),Ds.unProjectPointMatrix(p,m,1,t,n,d);const _=this.normals;vs.normal(r,s,a,_[0]),vs.normal(d,c,r,_[1]),vs.normal(h,a,s,_[2]),vs.normal(a,h,d,_[3]),vs.normal(s,r,c,_[4]),vs.normal(c,d,h,_[5]);const x=this.planes;return x[0].set(s,_[0]),x[1].set(c,_[1]),x[2].set(a,_[2]),x[3].set(h,_[3]),x[4].set(r,_[4]),x[5].set(d,_[5]),this.edges.tainted=!0,this}}(),getViewport:function(){return this.viewport},getScissor:function(){return this.scissor},getEdges:function(){const t=this.edges;if(t.tainted){const e=this.points;t[0].assign(e[0]).subtract(e[1]),t[1].assign(e[1]).subtract(e[2]),t[2].assign(e[2]).subtract(e[3]),t[3].assign(e[3]).subtract(e[0]),t[4].assign(e[0]).subtract(e[4]),t[5].assign(e[1]).subtract(e[5]),t[6].assign(e[2]).subtract(e[6]),t[7].assign(e[3]).subtract(e[7]),t.tainted=!1}return t},intersectsSphere:function(t,e){const n=this.planes;return!(n[0].getDistanceToPoint(e)>t)&&(!(n[1].getDistanceToPoint(e)>t)&&(!(n[2].getDistanceToPoint(e)>t)&&(!(n[3].getDistanceToPoint(e)>t)&&(!(n[4].getDistanceToPoint(e)>t)&&!(n[5].getDistanceToPoint(e)>t)))))},intersectsBox:function(){const t=[new xe(0,0,0),new xe(0,0,0),new xe(0,0,0),new xe(0,0,0),new xe(0,0,0),new xe(0,0,0),new xe(0,0,0),new xe(0,0,0)],e=[new xe(0,0,0),new xe(0,0,0),new xe(0,0,0)],n=[new xe(0,0,0),new xe(0,0,0),new xe(0,0,0)],i=[];for(let t=0;t<24;++t)i.push(new xe(0,0,0));return function(o){o.getPoints(t);const r=this.points;if(Ms.isSeparated(o.getNormals(e),t,r))return!1;if(Ms.isSeparated(this.normals,t,r))return!1;o.getAxes(n);const s=this.getEdges();for(let t=0;t<3;++t)for(let e=0;e<8;++e)i[3*t+e].assign(n[t]).cross(s[e]);return!Ms.isSeparated(i,t,r)}}()},Object.assign(Ds,{unProjectPoint:function(){const t=new hn;return function(e,n,i,o,r,s,a){return this.unProjectPointMatrix(e,n,i,t.assign(o).multRight(r).inverse(),s,a)}}(),unProjectPointMatrix:function(){const t=new Xe(0,0,0,0);return function(e,n,i,o,r,s){t.set((e-r[0])/r[2]*2-1,(n-r[1])/r[3]*2-1,2*i-1,1),o.multVecMatrix(t);const a=1/t.w;return s.set(t.x*a,t.y*a,t.z*a,1)}}(),unProjectRay:function(){const t=new hn;return function(e,n,i,o,r,s){return this.unProjectRayMatrix(e,n,t.assign(i).multRight(o).inverse(),r,s)}}(),unProjectRayMatrix:function(){const t=new xe(0,0,0),e=new xe(0,0,0);return function(n,i,o,r,s){return Ds.unProjectPointMatrix(n,i,0,o,r,t),Ds.unProjectPointMatrix(n,i,.9,o,r,e),s.setPoints(t,e)}}(),projectPoint:function(){const t=new Xe(0,0,0,0);return function(e,n,i,o,r){4===e.length?t.assign(e):t.set(e.x,e.y,e.z,1),i.multVecMatrix(n.multVecMatrix(t));const s=1/(2*t.w);return r.set((t.x*s+.5)*o[2]+o[0],(t.y*s+.5)*o[3]+o[1],t.z*s+.5)}}(),projectPointMatrix:function(){const t=new Xe(0,0,0,0);return function(e,n,i,o){4===e.length?t.assign(e):t.set(e.x,e.y,e.z,1),n.multVecMatrix(t);const r=1/(2*t.w);return o.set((t.x*r+.5)*i[2]+i[0],(t.y*r+.5)*i[3]+i[1],t.z*r+.5)}}(),projectLine:function(){const t=new hn;return function(e,n,i,o,r){return this.projectLineMatrix(e,t.assign(n).multRight(i),o,r)}}(),projectLineMatrix:function(){const t=new de(0,0),e=new de(0,0),n=new xe(0,0,0);return function(i,o,r,s){return Ds.projectPointMatrix(i.point,o,r,t),Ds.projectPointMatrix(n.assign(i.direction).multiply(1e9).add(i.point),o,r,e),s.setPoints(t,e)}}()});const Vs=Ds;n.set("standard/Math/Geometry/ViewVolume",Vs);const Rs=Vs;function Ps(t,e,n){const i=t.getContext();if(this.browser=t,this.width=e,this.height=n,this.array=new Uint8Array(e*n*4),this.lastBuffer=i.getParameter(i.FRAMEBUFFER_BINDING),this.buffer=i.createFramebuffer(),i.bindFramebuffer(i.FRAMEBUFFER,this.buffer),this.colorTexture=i.createTexture(),i.bindTexture(i.TEXTURE_2D,this.colorTexture),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.LINEAR),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,i.LINEAR),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,e,n,0,i.RGBA,i.UNSIGNED_BYTE,null),i.framebufferTexture2D(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.TEXTURE_2D,this.colorTexture,0),i.HAS_FEATURE_DEPTH_TEXTURE){this.depthTexture=i.createTexture(),i.bindTexture(i.TEXTURE_2D,this.depthTexture),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,i.NEAREST),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.NEAREST);const t=i.getVersion()>=2?i.DEPTH_COMPONENT24:i.DEPTH_COMPONENT;i.texImage2D(i.TEXTURE_2D,0,t,e,n,0,i.DEPTH_COMPONENT,i.UNSIGNED_INT,null),i.framebufferTexture2D(i.FRAMEBUFFER,i.DEPTH_ATTACHMENT,i.TEXTURE_2D,this.depthTexture,0)}else this.depthBuffer=i.createRenderbuffer(),i.bindRenderbuffer(i.RENDERBUFFER,this.depthBuffer),i.renderbufferStorage(i.RENDERBUFFER,i.DEPTH_COMPONENT16,e,n),i.framebufferRenderbuffer(i.FRAMEBUFFER,i.DEPTH_ATTACHMENT,i.RENDERBUFFER,this.depthBuffer);const o=i.checkFramebufferStatus(i.FRAMEBUFFER)===i.FRAMEBUFFER_COMPLETE;if(i.bindTexture(i.TEXTURE_2D,null),i.bindFramebuffer(i.FRAMEBUFFER,this.lastBuffer),!o)throw new Error("Couldn't create frame buffer.")}Ps.prototype={constructor:Ps,getWidth:function(){return this.width},getHeight:function(){return this.height},getColorTexture:function(){return this.colorTexture},getDepthTexture:function(){return this.depthTexture},readPixels:function(){const t=this.browser.getContext(),e=this.array,n=this.width,i=this.height;return t.readPixels(0,0,n,i,t.RGBA,t.UNSIGNED_BYTE,e),e},getDepth:function(){const t=new hn,e=new xe(0,0,0);return function(n,i){const o=this.browser.getContext(),r=this.array,s=this.width,a=this.height;let u=0,c=0,l=Number.POSITIVE_INFINITY;t.assign(n).inverse(),o.readPixels(0,0,s,a,o.RGBA,o.UNSIGNED_BYTE,r);for(let t=0,e=0;t<a;++t)for(let n=0;n<s;++n,e+=4){const i=r[e]/255+r[e+1]/65025+r[e+2]/16581375+r[e+3]/4228250625;i<l&&(u=n,c=t,l=i)}return Rs.unProjectPointMatrix(u,c,l,t,i,e),e.z}}(),bind:function(){const t=this.browser.getContext();this.lastBuffer=t.getParameter(t.FRAMEBUFFER_BINDING),t.bindFramebuffer(t.FRAMEBUFFER,this.buffer)},unbind:function(){const t=this.browser.getContext();t.bindFramebuffer(t.FRAMEBUFFER,this.lastBuffer)},delete:function(){const t=this.browser.getContext();t.deleteFramebuffer(this.buffer),t.deleteTexture(this.colorTexture),t.HAS_FEATURE_DEPTH_TEXTURE?t.deleteTexture(this.depthTexture):t.deleteRenderbuffer(this.depthBuffer)}};for(const t of Reflect.ownKeys(Ps.prototype))Object.defineProperty(Ps.prototype,t,{enumerable:!1});const As=Ps;n.set("x_ite/Rendering/TextureBuffer",As);const Ls=As;let Bs=0;const Xs={POINTER:Bs++,CAMERA:Bs++,PICKING:Bs++,COLLISION:Bs++,SHADOW:Bs++,DISPLAY:Bs++};n.set("x_ite/Rendering/TraverseType",Xs);const Us=Xs;function ks(t,e){this.array=t,this.auxiliary=[],e&&(this.compare=e)}ks.prototype={compare:function(t,e){return t<e},sort:function(t,e){this.mergeSort(t,e-1)},mergeSort:function(t,e){if(t<e){const n=t+e>>>1;this.mergeSort(t,n),this.mergeSort(n+1,e),this.merge(t,n,e)}},merge:function(t,e,n){let i,o,r;for(i=0,o=t;o<=e;)this.auxiliary[i++]=this.array[o++];for(i=0,r=t;r<o&&o<=n;)this.compare(this.array[o],this.auxiliary[i])?this.array[r++]=this.array[o++]:this.array[r++]=this.auxiliary[i++];for(;r<o;)this.array[r++]=this.auxiliary[i++]}};const zs=ks;n.set("standard/Math/Algorithms/MergeSort",zs);const js=zs,Gs={frustum:function(t,e,n,i,o,r,s){const a=e-t,u=i-n,c=r-o,l=2*o,h=(e+t)/a,d=(i+n)/u,p=-(r+o)/c,f=-l*r/c,g=l/a,m=l/u;return s.set(g,0,0,0,0,m,0,0,h,d,p,-1,0,0,f,0)},perspective:function(t,e,n,i,o,r){const s=Math.tan(t/2)*e;if(i>o){const t=i*s/o;return this.frustum(-t,t,-s,s,e,n,r)}{const t=o*s/i;return this.frustum(-s,s,-t,t,e,n,r)}},perspective2:function(t,e,n,i,o,r){const s=Math.tan(t/2)*e;return this.frustum(-s,s,-s,s,e,n,r)},ortho:function(t,e,n,i,o,r,s){const a=e-t,u=i-n,c=r-o,l=2/a,h=2/u,d=-2/c,p=-(e+t)/a,f=-(i+n)/u,g=-(r+o)/c;return s.set(l,0,0,0,0,h,0,0,0,0,d,0,p,f,g,1)},orthoBox:function(){const t=new xe(0,0,0),e=new xe(0,0,0);return function(n,i){return n.getExtents(t,e),this.ortho(t.x,e.x,t.y,e.y,-e.z,-t.z,i)}}()},Hs=Gs;n.set("standard/Math/Geometry/Camera",Hs);const qs=Hs;function Ys(t,e){switch(arguments.length){case 0:return void(this.matrix=new hn(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0));case 2:return void(this.matrix=new hn(t.x/2,0,0,0,0,t.y/2,0,0,0,0,t.z/2,0,e.x,e.y,e.z,1));case 3:{const t=arguments[0],e=arguments[1],n=(e.x-t.x)/2,i=(e.y-t.y)/2,o=(e.z-t.z)/2,r=(e.x+t.x)/2,s=(e.y+t.y)/2,a=(e.z+t.z)/2;return void(this.matrix=new hn(n,0,0,0,0,i,0,0,0,0,o,0,r,s,a,1))}}}Ys.prototype={constructor:Ys,copy:function(){const t=Object.create(Ys.prototype);return t.matrix=this.matrix.copy(),t},assign:function(t){return this.matrix.assign(t.matrix),this},equals:function(t){return this.matrix.equals(t.matrix)},getMatrix:function(){return this.matrix},set:function(t,e){const n=this.matrix;switch(arguments.length){case 0:return n[0]=.5,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=.5,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=.5,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=0,this;case 2:return n[0]=t.x/2,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=t.y/2,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=t.z/2,n[11]=0,n[12]=e.x,n[13]=e.y,n[14]=e.z,n[15]=1,this;case 3:{const t=arguments[0],e=arguments[1],n=(e.x-t.x)/2,i=(e.y-t.y)/2,o=(e.z-t.z)/2,r=(e.x+t.x)/2,s=(e.y+t.y)/2,a=(e.z+t.z)/2;return this.matrix.set(n,0,0,0,0,i,0,0,0,0,o,0,r,s,a,1),this}}},setExtents:function(t,e){const n=this.matrix,i=(e.x-t.x)/2,o=(e.y-t.y)/2,r=(e.z-t.z)/2,s=(e.x+t.x)/2,a=(e.y+t.y)/2,u=(e.z+t.z)/2;return n[0]=i,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=o,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=r,n[11]=0,n[12]=s,n[13]=a,n[14]=u,n[15]=1,this},getExtents:function(t,e){this.getAbsoluteExtents(t,e),t.add(this.center),e.add(this.center)},getAbsoluteExtents:function(){const t=new xe(0,0,0),e=new xe(0,0,0),n=new xe(0,0,0);return function(i,o){const r=this.matrix,s=r.xAxis,a=r.yAxis,u=r.zAxis;t.assign(a).add(u);const c=u.subtract(a);e.assign(s).add(t),n.assign(s).add(c);const l=t.subtract(s),h=c.subtract(s);i.assign(e),o.assign(e),i.min(l,h,n),o.max(l,h,n),e.negate(),l.negate(),h.negate(),n.negate(),i.min(e,l,h,n),o.max(e,l,h,n)}}(),getPoints:function(){const t=new xe(0,0,0),e=new xe(0,0,0),n=new xe(0,0,0),i=new xe(0,0,0);return function(o){const r=this.matrix;t.assign(r.xAxis),e.assign(r.yAxis),n.assign(r.zAxis),i.assign(e).add(n);const s=n.subtract(e);o[0].assign(t).add(i),o[1].assign(i).subtract(t),o[2].assign(s).subtract(t),o[3].assign(t).add(s),o[4].assign(o[2]).negate(),o[5].assign(o[3]).negate(),o[6].assign(o[0]).negate(),o[7].assign(o[1]).negate();const a=this.center;return o[0].add(a),o[1].add(a),o[2].add(a),o[3].add(a),o[4].add(a),o[5].add(a),o[6].add(a),o[7].add(a),o}}(),getAxes:function(t){const e=this.matrix;return t[0].assign(e.xAxis),t[1].assign(e.yAxis),t[2].assign(e.zAxis),t},getNormals:function(){const t=new xe(0,0,0),e=new xe(0,0,0),n=new xe(0,0,0),i=[xe.xAxis,xe.yAxis,xe.zAxis];return function(o){const r=this.matrix;if(t.assign(r.xAxis),e.assign(r.yAxis),n.assign(r.zAxis),0===t.norm()&&(t.assign(e).cross(n),0===t.norm())){for(const n of i)if(t.assign(n).cross(e),0!==t.norm())break;if(0===t.norm()){for(const e of i)if(t.assign(e).cross(n),0!==t.norm())break;0===t.norm()&&t.assign(xe.xAxis)}}if(0===e.norm()&&(e.assign(n).cross(t),0===e.norm())){for(const t of i)if(e.assign(t).cross(n),0!==e.norm())break;if(0===e.norm()){for(const n of i)if(e.assign(n).cross(t),0!==e.norm())break;0===e.norm()&&e.assign(xe.yAxis)}}if(0===n.norm()&&(n.assign(t).cross(e),0===n.norm())){for(const e of i)if(n.assign(e).cross(t),0!==n.norm())break;if(0===n.norm()){for(const t of i)if(n.assign(t).cross(e),0!==n.norm())break;0===n.norm()&&n.assign(xe.zAxis)}}return o[0].assign(e).cross(n).normalize(),o[1].assign(n).cross(t).normalize(),o[2].assign(t).cross(e).normalize(),o}}(),isEmpty:function(){return 0===this.matrix[15]},add:function(){const t=new xe(0,0,0),e=new xe(0,0,0),n=new xe(0,0,0),i=new xe(0,0,0);return function(o){return this.isEmpty()?this.assign(o):o.isEmpty()?this:(this.getExtents(t,e),o.getExtents(n,i),this.set(t.min(n),e.max(i),!0))}}(),multLeft:function(t){return this.matrix.multLeft(t),this},multRight:function(t){return this.matrix.multRight(t),this},containsPoint:function(){const t=new xe(0,0,0),e=new xe(0,0,0);return function(n){return this.getExtents(t,e),t.x<=n.x&&e.x>=n.x&&t.y<=n.y&&e.y>=n.y&&t.z<=n.z&&e.z>=n.z}}(),intersectsBox:function(){const t=[new xe(0,0,0),new xe(0,0,0),new xe(0,0,0),new xe(0,0,0),new xe(0,0,0),new xe(0,0,0),new xe(0,0,0),new xe(0,0,0)],e=[new xe(0,0,0),new xe(0,0,0),new xe(0,0,0),new xe(0,0,0),new xe(0,0,0),new xe(0,0,0),new xe(0,0,0),new xe(0,0,0)],n=[new xe(0,0,0),new xe(0,0,0),new xe(0,0,0)],i=[new xe(0,0,0),new xe(0,0,0),new xe(0,0,0)],o=[new xe(0,0,0),new xe(0,0,0),new xe(0,0,0),new xe(0,0,0),new xe(0,0,0),new xe(0,0,0),new xe(0,0,0),new xe(0,0,0),new xe(0,0,0)],r=[new xe(0,0,0),new xe(0,0,0),new xe(0,0,0)];return function(s){if(this.isEmpty())return!1;if(s.isEmpty())return!1;if(this.getPoints(t),s.getPoints(e),Ms.isSeparated(this.getNormals(r),t,e))return!1;if(Ms.isSeparated(s.getNormals(r),t,e))return!1;this.getAxes(n),s.getAxes(i);for(let t=0;t<3;++t)for(let e=0;e<3;++e)o[3*t+e].assign(n[t]).cross(i[e]);return!Ms.isSeparated(o,t,e)}}(),intersectsTriangle:function(){const t=[new xe(0,0,0),new xe(0,0,0),new xe(0,0,0),new xe(0,0,0),new xe(0,0,0),new xe(0,0,0),new xe(0,0,0),new xe(0,0,0)],e=[new xe(0,0,0),new xe(0,0,0),new xe(0,0,0)],n=[new xe(0,0,0),new xe(0,0,0),new xe(0,0,0),new xe(0,0,0),new xe(0,0,0),new xe(0,0,0),new xe(0,0,0),new xe(0,0,0),new xe(0,0,0)],i=[new xe(0,0,0),new xe(0,0,0),new xe(0,0,0)],o=[],r=[new xe(0,0,0)],s=[new xe(0,0,0),new xe(0,0,0),new xe(0,0,0)];return function(a,u,c){if(this.isEmpty())return!1;if(this.getPoints(t),o[0]=a,o[1]=u,o[2]=c,Ms.isSeparated(this.getNormals(i),t,o))return!1;if(vs.normal(a,u,c,r[0]),Ms.isSeparated(r,t,o))return!1;this.getAxes(e),s[0].assign(a).subtract(u),s[1].assign(u).subtract(c),s[2].assign(c).subtract(a);for(let t=0;t<3;++t)for(let i=0;i<3;++i)n[3*t+i].assign(e[t]).cross(s[i]);return!Ms.isSeparated(n,t,o)}}(),toString:function(){return this.size+", "+this.center}},Object.defineProperty(Ys.prototype,"size",{get:function(){const t=new xe(0,0,0),e=new xe(0,0,0);return function(){return this.getAbsoluteExtents(t,e),e.subtract(t)}}(),enumerable:!0,configurable:!1}),Object.defineProperty(Ys.prototype,"center",{get:function(){return this.matrix.origin},enumerable:!0,configurable:!1});const Ws=Ys;n.set("standard/Math/Geometry/Box3",Ws);const Ks=Ws;const Js=function(t){return Object.assign([new t],{top:0,set:function(t){this[this.top].assign(t)},get:function(){return this[this.top]},push:function(){const t=++this.top;t<this.length?this[t].assign(this[t-1]):this[t]=this[t-1].copy()},pushMatrix:function(t){const e=++this.top;e<this.length?this[e].assign(t):this[e]=t.copy()},pop:function(){--this.top},clear:function(){this.top=0},size:function(){return this.top+1},identity:function(){this[this.top].identity()},multLeft:function(t){this[this.top].multLeft(t)},translate:function(t){this[this.top].translate(t)},rotate:function(t){this[this.top].rotate(t)},scale:function(t){this[this.top].scale(t)}})};n.set("standard/Math/Utility/MatrixStack",Js);const Zs=Js;function Qs(t,e){return t.distance<e.distance}function $s(t){this.viewVolumes=[],this.cameraSpaceMatrix=new Zs(hn),this.viewMatrix=new Zs(hn),this.projectionMatrix=new Zs(hn),this.modelViewMatrix=new Zs(hn),this.viewportArray=new Int32Array(4),this.projectionMatrixArray=new Float32Array(16),this.cameraSpaceMatrixArray=new Float32Array(16),this.localObjectsCount=[0,0,0],this.globalObjects=[],this.localObjects=[],this.lights=[],this.globalShadows=[!1],this.localShadows=[!1],this.localFogs=[null],this.layouts=[],this.jointNodes=[],this.textureProjectors=[],this.generatedCubeMapTextures=[],this.collisions=[],this.numOpaqueShapes=0,this.numTransparentShapes=0,this.numCollisionShapes=0,this.numShadowShapes=0,this.opaqueShapes=[],this.transparentShapes=[],this.transparencySorter=new js(this.transparentShapes,Qs),this.collisionShapes=[],this.activeCollisions=new Set,this.shadowShapes=[],this.speed=0;try{this.depthBuffer=new Ls(t.getBrowser(),16,16)}catch(t){console.error(t),this.getDepth=function(){return 0}}}function ta(t,e){for(var n=0,i=e.length;n<i;++n)t[n]=e[n];t.length=i}$s.prototype={constructor:$s,initialize:function(){},isIndependent:function(){return!0},getRenderTime:function(){return this.renderTime},getViewVolumes:function(){return this.viewVolumes},getViewVolume:function(){return this.viewVolumes.at(-1)},getCameraSpaceMatrix:function(){return this.cameraSpaceMatrix},getViewMatrix:function(){return this.viewMatrix},getProjectionMatrix:function(){return this.projectionMatrix},getModelViewMatrix:function(){return this.modelViewMatrix},getViewportArray:function(){return this.viewportArray},getProjectionMatrixArray:function(){return this.projectionMatrixArray},getCameraSpaceMatrixArray:function(){return this.cameraSpaceMatrixArray},getGlobalObjects:function(){return this.globalObjects},getLocalObjects:function(){return this.localObjects},getLocalObjectsCount:function(){return this.localObjectsCount},getLights:function(){return this.lights},pushGlobalShadows:function(t){this.globalShadows.push(t||this.globalShadows.at(-1))},getGlobalShadows:function(){return this.globalShadows},pushLocalShadows:function(t){this.localShadows.push(t||this.localShadows.at(-1))},popLocalShadows:function(){this.localShadows.pop()},setGlobalFog:function(){const t=new hn;return function(e){if(e.getFogType()){const n=this.localFogs[0]||e.getFogs().pop();t.assign(e.getModelMatrix()).multRight(this.getViewMatrix().get()),n.set(e,t),this.localFogs[0]=n}else this.localFogs[0]=null}}(),getLocalFogs:function(){return this.localFogs},getLayouts:function(){return this.layouts},getJoints:function(){return this.jointNodes},getParentLayout:function(){return this.layouts.at(-1)},getTextureProjectors:function(){return this.textureProjectors},getGeneratedCubeMapTextures:function(){return this.generatedCubeMapTextures},getCollisions:function(){return this.collisions},setNumCollisionShapes:function(t){this.numCollisionShapes=t},getNumCollisionShapes:function(){return this.numCollisionShapes},getCollisionShapes:function(){return this.collisionShapes},setNumShadowShapes:function(t){this.numShadowShapes=t},getNumShadowShapes:function(){return this.numShadowShapes},getShadowShapes:function(){return this.shadowShapes},setNumOpaqueShapes:function(t){this.numOpaqueShapes=t},getNumOpaqueShapes:function(){return this.numOpaqueShapes},getOpaqueShapes:function(){return this.opaqueShapes},setNumTransparentShapes:function(t){this.numTransparentShapes=t},getNumTransparentShapes:function(){return this.numTransparentShapes},getTransparentShapes:function(){return this.transparentShapes},constrainTranslation:function(t,e){const n=this.getDistance(t)-this.getNavigationInfo().getCollisionRadius();if(n>0){return t.magnitude()>n?t.normalize().multiply(n):t}return e?this.constrainTranslation(t.normalize().multiply(n),!1):t.assign(xe.Zero)},getDistance:function(){const t=new hn,e=new hn,n=new an(0,0,1,0),i=new xe(0,0,0),o=new an(0,0,1,0);return function(r){const s=Date.now(),a=this.getViewpoint(),u=this.getNavigationInfo(),c=u.getCollisionRadius(),l=u.getStepHeight()-u.getAvatarHeight(),h=u.getNearValue(),d=u.getAvatarHeight();qs.ortho(-c,c,Math.min(l,-c),c,h,Math.max(2*c,2*d),t),n.assign(a._orientation.getValue()).inverse().multRight(a.getOrientation()),o.setFromToVec(xe.zAxis,i.assign(r).negate()).multRight(n),a.straightenHorizon(o),e.assign(a.getModelMatrix()),e.translate(a.getUserPosition()),e.rotate(o),e.inverse(),e.multRight(t),e.multLeft(a.getCameraSpaceMatrix()),this.getProjectionMatrix().pushMatrix(e);const p=this.getDepth(t);return this.getProjectionMatrix().pop(),this.collisionTime+=Date.now()-s,-p}}(),getDepth:function(){const t=new Xe(0,0,16,16),e=new Rs;return e.set(hn.Identity,t,t),function(n){this.depthBuffer.bind(),this.viewVolumes.push(e),this.depth(this.collisionShapes,this.numCollisionShapes);const i=this.depthBuffer.getDepth(n,t);return this.viewVolumes.pop(),this.depthBuffer.unbind(),i}}(),render:function(t,e,n){switch(t){case Us.COLLISION:this.numCollisionShapes=0,e.call(n,t,this),this.collide(),this.gravite();break;case Us.SHADOW:this.numShadowShapes=0,e.call(n,t,this),this.depth(this.shadowShapes,this.numShadowShapes);break;case Us.DISPLAY:this.lightIndex=0,this.numOpaqueShapes=0,this.numTransparentShapes=0,this.setGlobalFog(this.getFog()),e.call(n,t,this),this.draw()}},addCollisionShape:function(){const t=new xe(0,0,0),e=new xe(0,0,0);return function(n){const i=this.getModelViewMatrix().get();i.multDirMatrix(t.assign(n.getBBoxSize())),i.multVecMatrix(e.assign(n.getBBoxCenter()));const o=t.magnitude()/2,r=this.viewVolumes.at(-1);if(r.intersectsSphere(o,e)){const t=this.numCollisionShapes++;t===this.collisionShapes.length&&this.collisionShapes.push({renderObject:this,modelViewMatrix:new Float32Array(16),collisions:[],clipPlanes:[]});const e=this.collisionShapes[t];return e.modelViewMatrix.set(i),e.shapeNode=n,e.scissor=r.getScissor(),ta(e.collisions,this.collisions),ta(e.clipPlanes,this.localObjects),!0}return!1}}(),addShadowShape:function(){const t=new xe(0,0,0),e=new xe(0,0,0);return function(n){const i=this.getModelViewMatrix().get();i.multDirMatrix(t.assign(n.getBBoxSize())),i.multVecMatrix(e.assign(n.getBBoxCenter()));const o=t.magnitude()/2,r=this.viewVolumes.at(-1);if(r.intersectsSphere(o,e)){const t=this.numShadowShapes++;t===this.shadowShapes.length&&this.shadowShapes.push({renderObject:this,modelViewMatrix:new Float32Array(16),clipPlanes:[]});const e=this.shadowShapes[t];return e.modelViewMatrix.set(i),e.shapeNode=n,e.scissor=r.getScissor(),ta(e.clipPlanes,this.localObjects),!0}return!1}}(),addDisplayShape:function(){const t=new xe(0,0,0),e=new xe(0,0,0);return function(n){const i=this.getModelViewMatrix().get();i.multDirMatrix(t.assign(n.getBBoxSize())),i.multVecMatrix(e.assign(n.getBBoxCenter()));const o=t.magnitude()/2,r=this.viewVolumes.at(-1);if(r.intersectsSphere(o,e)){if(n.getTransparent()){const t=this.numTransparentShapes++;t===this.transparentShapes.length&&this.transparentShapes.push(this.createRenderContext(!0));var s=this.transparentShapes[t]}else{const t=this.numOpaqueShapes++;t===this.opaqueShapes.length&&this.opaqueShapes.push(this.createRenderContext(!1));s=this.opaqueShapes[t]}return s.modelViewMatrix.set(i),s.scissor.assign(r.getScissor()),s.shadows=this.localShadows.at(-1),s.fogNode=this.localFogs.at(-1),s.shapeNode=n,s.appearanceNode=n.getAppearance(),s.distance=e.z,ta(s.objectsCount,this.localObjectsCount),ta(s.localObjects,this.localObjects),!0}return!1}}(),createRenderContext:function(t){return{renderObject:this,transparent:t,modelViewMatrix:new Float32Array(16),scissor:new Xe(0,0,0,0),localObjects:[],objectsCount:[0,0,0]}},collide:function(){const t=new hn,e=new hn,n=new Ks(xe.Zero,xe.Zero),i=new xe(0,0,0);return function(){const o=new Set,r=2.2*this.getNavigationInfo().getCollisionRadius();i.set(r,r,r);for(let r=0,s=this.numCollisionShapes;r<s;++r){const s=this.collisionShapes[r],a=s.collisions;if(a.length&&(n.set(i,xe.Zero),n.multRight(t.assign(s.modelViewMatrix).inverse()),s.shapeNode.intersectsBox(n,s.clipPlanes,e.assign(s.modelViewMatrix))))for(const t of a)o.add(t)}if(this.activeCollisions.size){const t=o.size?gt.set_difference(this.activeCollisions,o,new Set):this.activeCollisions;for(const e of t)e.set_active(!1)}this.activeCollisions=o;for(const t of o)t.set_active(!0)}}(),gravite:function(){const t=new hn,e=new hn,n=new xe(0,0,0),i=new an(0,0,1,0);return function(){const o=this.getBrowser();if(o.getActiveLayer()===this){if("WALK"!==o.getCurrentViewer())return}else if("WALK"!==this.getNavigationInfo().getViewer())return;const r=this.getNavigationInfo(),s=this.getViewpoint(),a=r.getCollisionRadius(),u=r.getNearValue(),c=r.getAvatarHeight(),l=r.getStepHeight();qs.ortho(-a,a,-a,a,u,Math.max(2*a,2*c),t);const h=s.getUpVector(),d=i.setFromToVec(xe.zAxis,h);e.assign(s.getModelMatrix()),e.translate(s.getUserPosition()),e.rotate(d),e.inverse(),e.multRight(t),e.multLeft(s.getCameraSpaceMatrix()),this.getProjectionMatrix().pushMatrix(e);let p=-this.getDepth(t);this.getProjectionMatrix().pop(),p-=c;const f=i.setFromToVec(xe.yAxis,h);if(p>0){const t=this.speed?o.getCurrentFrameRate():1e6;this.speed-=o.getBrowserOptions()._Gravity.getValue()/t;let e=this.speed/t;e<-p&&(e=-p,this.speed=0),s._positionOffset=s._positionOffset.getValue().add(f.multVecRot(n.set(0,e,0)))}else this.speed=0,p=-p,p>.01&&p<l&&(this.constrainTranslation(f.multVecRot(n.set(0,p,0)),!1),s._positionOffset=n.add(s._positionOffset.getValue()))}}(),depth:function(){const t=new Float32Array(16);return function(e,n){const i=this.getBrowser().getContext(),o=this.getViewVolume().getViewport();t.set(this.getProjectionMatrix().get()),i.viewport(o[0],o[1],o[2],o[3]),i.scissor(o[0],o[1],o[2],o[3]),i.clearColor(1,0,0,0),i.clear(i.COLOR_BUFFER_BIT|i.DEPTH_BUFFER_BIT),i.depthMask(!0),i.enable(i.DEPTH_TEST),i.disable(i.BLEND),i.disable(i.CULL_FACE);for(let o=0;o<n;++o){const n=e[o],r=n.scissor;i.scissor(r.x,r.y,r.z,r.w),n.shapeNode.depth(i,n,t)}}}(),draw:function(){const t=this.getBrowser(),e=t.getContext(),n=this.getViewVolume().getViewport(),i=this.globalObjects,o=this.lights,r=this.textureProjectors,s=this.generatedCubeMapTextures,a=this.globalShadows,u=a.at(-1),c=this.getNavigationInfo()._headlight.getValue(),l=i.reduce(((t,e)=>t+!!e.lightNode),0),h=i.reduce(((t,e)=>t+!!e.textureProjectorNode),0);if(this.renderTime=Date.now(),this.isIndependent()){for(const t of o)t.renderShadowMap(this);for(const t of s)t.renderTexture(this)}c&&t.getHeadlight().setGlobalVariables(this);for(const t of o)t.setGlobalVariables(this);for(const t of r)t.setGlobalVariables(this);this.viewportArray.set(n),this.cameraSpaceMatrixArray.set(this.getCameraSpaceMatrix().get()),this.projectionMatrixArray.set(this.getProjectionMatrix().get()),e.viewport(n.x,n.y,n.z,n.w),e.scissor(n.x,n.y,n.z,n.w),e.clear(e.DEPTH_BUFFER_BIT),this.getBackground().display(e,this,n),e.depthMask(!0),e.enable(e.DEPTH_TEST),e.disable(e.BLEND);const d=this.opaqueShapes;for(let n=0,i=this.numOpaqueShapes;n<i;++n){const i=d[n],o=i.scissor;e.scissor(o.x,o.y,o.z,o.w),i.shadows=i.shadows||u,i.objectsCount[1]+=l,i.objectsCount[2]+=h,i.shapeNode.display(e,i),t.resetTextureUnits()}e.depthMask(!1),e.enable(e.BLEND);const p=this.transparentShapes;this.transparencySorter.sort(0,this.numTransparentShapes);for(let n=0,i=this.numTransparentShapes;n<i;++n){const i=p[n],o=i.scissor;e.scissor(o.x,o.y,o.z,o.w),i.shadows=i.shadows||u,i.objectsCount[1]+=l,i.objectsCount[2]+=h,i.shapeNode.display(e,i),t.resetTextureUnits()}if(e.depthMask(!0),e.disable(e.BLEND),this.isIndependent()){const e=t.getLocalObjects();for(const t of e)t.dispose();e.length=0;for(const t of i)t.dispose()}i.length=0,o.length=0,a.length=1,r.length=0,s.length=0}};const ea=$s;n.set("x_ite/Rendering/X3DRenderObject",ea);const na=ea;function ia(t,e){$i.call(this,t),this.array=[e],this.transitionNode=e.create(t)}ia.prototype=Object.assign(Object.create($i.prototype),{constructor:ia,getTypeName:function(){return"BindableStack"},get:function(){return this.array},top:function(){return this.transitionNode._transitionActive.getValue()?this.transitionNode:this.array.at(-1)},pushOnTop:function(t){t!==this.array[0]&&(this.array.at(-1)._isBound=!1,this.array.push(t)),t._isBound=!0,t._bindTime=this.getBrowser().getCurrentTime(),this.addNodeEvent()},update:function(t,e,n){if(0===e.length&&0===n.length)return;const i=this.top(),o=this.array.at(-1);for(const t of e){const e=this.array.indexOf(t);e>0&&this.array.splice(e,1)}o!==this.array[0]&&n.some((t=>!t._set_bind.getValue()&&t===o))&&this.array.pop();for(const t of n)if(t._set_bind.getValue()){const e=this.array.indexOf(t);e>-1&&this.array.splice(e,1),this.array.push(t)}const r=this.array.at(-1);r!==o&&(o._set_bind=!1,o._isBound=!1,r._set_bind=!0,r._isBound=!0,r._bindTime=this.getBrowser().getCurrentTime()),this.transitionNode=r.create(this.getExecutionContext()),this.transitionNode.setup(),this.transitionNode.transitionStart(t,i,r),this.transitionNode._transitionActive.getValue()&&this.transitionNode._transitionActive.addInterest("set_transitionActive__",this),this.addNodeEvent()},set_transitionActive__:function(t){t.getValue()||(this.transitionNode._transitionActive.removeInterest("set_transitionActive__",this),this.addNodeEvent())}});for(const t of Reflect.ownKeys(ia.prototype))Object.defineProperty(ia.prototype,t,{enumerable:!1});const oa=ia;n.set("x_ite/Execution/BindableStack",oa);const ra=oa;function sa(t,e){$i.call(this,t),this.collected=[e],this.array=[e],this.updateTime=0,this.removedNodes=[]}sa.prototype=Object.assign(Object.create($i.prototype),{constructor:sa,getTypeName:function(){return"BindableList"},get:function(){return this.array},getBound:function(t){if(this.array.length>1){const e=!1,n=this.getMainScene();if(t&&t.length)for(let i=1,o=this.array.length;i<o;++i){const o=this.array[i],r=o.getExecutionContext().getOuterNode(),s=r instanceof Or?r.getScene():o.getScene();if((e||s===n)&&o.getName()==t)return o}for(let t=1,i=this.array.length;t<i;++t){const i=this.array[t],o=i.getExecutionContext().getOuterNode(),r=o instanceof Or?o.getScene():i.getScene();if((e||r===n)&&i._isBound.getValue())return i}for(let t=1,i=this.array.length;t<i;++t){const i=this.array[t],o=i.getExecutionContext().getOuterNode(),r=o instanceof Or?o.getScene():i.getScene();if(e||r===n)return i}}return this.array[0]},push:function(t){return this.collected.push(t)},update:function(t,e){const n=this.collected.filter((t=>t._set_bind.getModificationTime()>this.updateTime)),i=this.removedNodes;if(!function(t,e){if(t.length!==e.length)return!1;for(let n=0;n<t.length;++n)if(t[n]!==e[n])return!1;return!0}(this.collected,this.array)){for(const t of this.array)-1===this.collected.indexOf(t)&&i.push(t);const t=this.array;this.array=this.collected,this.collected=t}this.collected.length=1,e.update(t,i,n),i.length=0,this.updateTime=Date.now()}});for(const t of Reflect.ownKeys(sa.prototype))Object.defineProperty(sa.prototype,t,{enumerable:!1});const aa=sa;n.set("x_ite/Execution/BindableList",aa);const ua=aa;function ca(t){this.getExecutionContext()||(or.call(this,t),this.addType(c.X3DChildNode),this.addChildObjects("isCameraObject",new Ri.SFBool),this.addChildObjects("isPickableObject",new Ri.SFBool),this._isCameraObject.setAccessType(c.outputOnly),this._isPickableObject.setAccessType(c.outputOnly))}ca.prototype=Object.assign(Object.create(or.prototype),{constructor:ca,setCameraObject:function(t){t!==this._isCameraObject.getValue()&&(this._isCameraObject=t)},getCameraObject:function(){return this._isCameraObject.getValue()},setPickableObject:function(t){t!==this._isPickableObject.getValue()&&(this._isPickableObject=t)},getPickableObject:function(){return this._isPickableObject.getValue()}});const la=ca;n.set("x_ite/Components/Core/X3DChildNode",la);const ha=la;function da(t){ha.call(this,t),this.addType(c.X3DBindableNode),this.addChildObjects("transitionActive",new Ri.SFBool)}da.prototype=Object.assign(Object.create(ha.prototype),{constructor:da,getCameraObject:function(){return!0},transitionStart:function(){}});const pa=da;n.set("x_ite/Components/Core/X3DBindableNode",pa);const fa=pa,ga={TELEPORT:!0,LINEAR:!0,ANIMATE:!0};function ma(t){fa.call(this,t),this.addType(c.NavigationInfo),this.addChildObjects("transitionStart",new Ri.SFBool,"availableViewers",new Ri.MFString,"viewer",new Ri.SFString("EXAMINE")),this._avatarSize.setUnit("length"),this._speed.setUnit("speed"),this._visibilityLimit.setUnit("speed")}ma.prototype=Object.assign(Object.create(fa.prototype),{constructor:ma,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new Y([new B(c.inputOutput,"metadata",new Ri.SFNode),new B(c.inputOnly,"set_bind",new Ri.SFBool),new B(c.inputOutput,"type",new Ri.MFString("EXAMINE","ANY")),new B(c.inputOutput,"avatarSize",new Ri.MFFloat(.25,1.6,.75)),new B(c.inputOutput,"speed",new Ri.SFFloat(1)),new B(c.inputOutput,"headlight",new Ri.SFBool(!0)),new B(c.inputOutput,"visibilityLimit",new Ri.SFFloat),new B(c.inputOutput,"transitionType",new Ri.MFString("LINEAR")),new B(c.inputOutput,"transitionTime",new Ri.SFTime(1)),new B(c.outputOnly,"transitionComplete",new Ri.SFBool),new B(c.outputOnly,"isBound",new Ri.SFBool),new B(c.outputOnly,"bindTime",new Ri.SFTime)]),getTypeName:function(){return"NavigationInfo"},getComponentName:function(){return"Navigation"},getContainerField:function(){return"children"},initialize:function(){fa.prototype.initialize.call(this),this._type.addInterest("set_type__",this),this._headlight.addInterest("set_headlight__",this),this._transitionStart.addInterest("set_transitionStart__",this),this._transitionComplete.addInterest("set_transitionComplete__",this),this._isBound.addInterest("set_isBound__",this),this.set_type__(),this.set_headlight__()},getViewer:function(){return this._viewer.getValue()},getCollisionRadius:function(){return this._avatarSize.length>0&&this._avatarSize[0]>0?this._avatarSize[0]:.25},getAvatarHeight:function(){return this._avatarSize.length>1?this._avatarSize[1]:1.6},getStepHeight:function(){return this._avatarSize.length>2?this._avatarSize[2]:.75},getNearValue:function(){const t=this.getCollisionRadius();return 0===t?1e-5:t/2},getFarValue:function(t){return this._visibilityLimit.getValue()?this._visibilityLimit.getValue():t.getMaxFarValue()},getTransitionType:function(){for(const t of this._transitionType){if(ga[t])return t}return"LINEAR"},set_type__:function(){this._viewer="EXAMINE";for(const t of this._type){switch(t){case"EXAMINE":case"WALK":case"FLY":case"LOOKAT":case"PLANE":case"NONE":this._viewer=t;break;case"PLANE_create3000.github.io":case"PLANE_create3000.de":this._viewer="PLANE";break;default:continue}break}let t=!1,e=!1,n=!1,i=!1,o=!1,r=!1;if(this._type.length)for(const s of this._type){switch(s){case"EXAMINE":default:t=!0;continue;case"WALK":e=!0;continue;case"FLY":n=!0;continue;case"LOOKAT":r=!0;continue;case"PLANE":i=!0;continue;case"NONE":o=!0;continue;case"ANY":t=!0,e=!0,n=!0,i=!0,o=!0,r=!0}break}else t=!0,e=!0,n=!0,i=!0,o=!0,r=!0;this._availableViewers.length=0,t&&this._availableViewers.push("EXAMINE"),e&&this._availableViewers.push("WALK"),n&&this._availableViewers.push("FLY"),i&&this._availableViewers.push("PLANE"),r&&this._availableViewers.push("LOOKAT"),o&&this._availableViewers.push("NONE")},set_headlight__:function(){this._headlight.getValue()?delete this.enable:this.enable=Function.prototype},set_transitionStart__:function(){this._transitionActive.getValue()||(this._transitionActive=!0)},set_transitionComplete__:function(){this._transitionActive.getValue()&&(this._transitionActive=!1)},set_isBound__:function(){this._isBound.getValue()||this._transitionActive.getValue()&&(this._transitionActive=!1)},enable:function(t,e){t===Us.DISPLAY&&this._headlight.getValue()&&e.getGlobalObjects().push(this.getBrowser().getHeadlight())},traverse:function(t,e){t===Us.CAMERA&&e.getLayer().getNavigationInfos().push(this)}});const _a=ma;n.set("x_ite/Components/Navigation/NavigationInfo",_a);const xa=_a;const ya=function(t){const e=[];return{size:0,pop:function(){return 0!==this.size?e[--this.size]:new t},push:function(t){e[this.size++]=t},clear:function(){e.length=0,this.size=0}}};n.set("standard/Utility/ObjectCache",ya);const wa=ya,Sa=wa(Ta);function Ta(){this.fogMatrix=new Float32Array(9)}function ba(t){this.addType(c.X3DFogObject),this._visibilityRange.setUnit("length"),this.hidden=!1,this.colorArray=new Float32Array(3)}Ta.prototype={constructor:Ta,set:function(t,e){this.fogNode=t,this.fogKey=String(t.getFogType()),this.fogMatrix.set(e.submatrix.inverse())},getFogKey:function(){return this.fogKey},setShaderUniforms:function(t,e){if(e.hasFog(this))return;const n=this.fogNode;t.uniform3fv(e.x3d_FogColor,n.colorArray),t.uniform1f(e.x3d_FogVisibilityRange,n.visibilityRange),t.uniformMatrix3fv(e.x3d_FogMatrix,!1,this.fogMatrix)},dispose:function(){Sa.push(this)}},ba.prototype={constructor:ba,initialize:function(){this._fogType.addInterest("set_fogType__",this),this._color.addInterest("set_color__",this),this._visibilityRange.addInterest("set_visibilityRange__",this),this.set_color__(),this.set_visibilityRange__()},setHidden:function(t){this.hidden=t,this.set_fogType__(),this.getBrowser().addBrowserEvent()},getHidden:function(){return this.hidden},getFogType:function(){return this.fogType},getFogs:function(){return Sa},set_fogType__:function(){const t=new Map([["LINEAR",1],["EXPONENTIAL",2]]);return function(){this.hidden||0===this.visibilityRange?this.fogType=0:this.fogType=t.get(this._fogType.getValue())||1}}(),set_color__:function(){const t=this._color.getValue(),e=this.colorArray;e[0]=t.r,e[1]=t.g,e[2]=t.b},set_visibilityRange__:function(){this.visibilityRange=Math.max(0,this._visibilityRange.getValue()),this.set_fogType__()},dispose:function(){}};const va=ba;n.set("x_ite/Components/EnvironmentalEffects/X3DFogObject",va);const Ca=va;function Ea(t){fa.call(this,t),Ca.call(this,t),this.addType(c.Fog),this.modelMatrix=new hn}Ea.prototype=Object.assign(Object.create(fa.prototype),Ca.prototype,{constructor:Ea,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new Y([new B(c.inputOutput,"metadata",new Ri.SFNode),new B(c.inputOnly,"set_bind",new Ri.SFBool),new B(c.inputOutput,"fogType",new Ri.SFString("LINEAR")),new B(c.inputOutput,"color",new Ri.SFColor(1,1,1)),new B(c.inputOutput,"visibilityRange",new Ri.SFFloat),new B(c.outputOnly,"isBound",new Ri.SFBool),new B(c.outputOnly,"bindTime",new Ri.SFTime)]),getTypeName:function(){return"Fog"},getComponentName:function(){return"EnvironmentalEffects"},getContainerField:function(){return"children"},initialize:function(){fa.prototype.initialize.call(this),Ca.prototype.initialize.call(this)},getModelMatrix:function(){return this.modelMatrix},traverse:function(t,e){t===Us.CAMERA&&(e.getLayer().getFogs().push(this),this.modelMatrix.assign(e.getModelViewMatrix().get()))},dispose:function(){Ca.prototype.dispose.call(this),fa.prototype.dispose.call(this)}});const Oa=Ea;n.set("x_ite/Components/EnvironmentalEffects/Fog",Oa);const Na=Oa;function Fa(){this.vertexArray=null,this.shaderNode=null,this.tainted=!0}Fa.prototype={update:function(t=!0){return this.tainted=this.tainted||t,this},enable:function(t,e){return this.tainted||this.shaderNode!==e?(t.deleteVertexArray(this.vertexArray),this.vertexArray=t.createVertexArray(),this.shaderNode=e,this.tainted=!1,t.bindVertexArray(this.vertexArray),!0):(t.bindVertexArray(this.vertexArray),!1)},disable:function(t){t.bindVertexArray(null)},delete:function(t){t.deleteVertexArray(this.vertexArray)}};const Ia=Fa;n.set("x_ite/Rendering/VertexArray",Ia);const Ma=Ia,Da=[new xe(0,0,1),new xe(0,0,-1),new xe(0,1,0),new xe(0,-1,0),new xe(1,0,0)];function Va(t){or.call(this,t),this.addType(c.X3DGeometryNode),this.addChildObjects("transparent",new Ri.SFBool,"bbox_changed",new Ri.SFTime,"rebuild",new Ri.SFTime),this._transparent.setAccessType(c.outputOnly),this._bbox_changed.setAccessType(c.outputOnly),this._rebuild.setAccessType(c.outputOnly);const e=this.getBrowser();this.min=new xe(0,0,0),this.max=new xe(0,0,0),this.bbox=new Ks(this.min,this.max,!0),this.solid=!0,this.primitiveMode=e.getContext().TRIANGLES,this.geometryType=3,this.flatShading=void 0,this.colorMaterial=!1,this.attribNodes=[],this.attribArrays=[],this.textureCoordinateMapping=new Map,this.multiTexCoords=[],this.texCoords=Va.createArray(),this.fogDepths=Va.createArray(),this.colors=Va.createArray(),this.normals=Va.createArray(),this.flatNormals=Va.createArray(),this.vertices=Va.createArray(),this.hasFogCoords=!1,this.hasNormals=!1,this.geometryKey="",this.vertexCount=0,this.planes=[];for(let t=0;t<5;++t)this.planes[t]=new ws(xe.Zero,xe.zAxis)}Va.createArray=function(){const t=[];return t.typedArray=new Float32Array,t.assign=function(t){const e=t.length;for(let n=0;n<e;++n)this[n]=t[n];this.length=e},t.getValue=function(){return this.typedArray},t.shrinkToFit=function(){this.length===this.typedArray.length?this.typedArray.set(this):this.typedArray=new Float32Array(this)},t},Va.prototype=Object.assign(Object.create(or.prototype),{constructor:Va,setup:function(){or.prototype.setup.call(this),this.rebuild()},initialize:function(){or.prototype.initialize.call(this);const t=this.getBrowser(),e=t.getContext();this.isLive().addInterest("set_live__",this),this.addInterest("requestRebuild",this),this._rebuild.addInterest("rebuild",this),this.frontFace=e.CCW,this.backFace=new Map([[e.CCW,e.CW],[e.CW,e.CCW]]),this.attribBuffers=[],this.textureCoordinateNode=t.getDefaultTextureCoordinate(),this.texCoordBuffers=Array.from({length:t.getMaxTextures()},(()=>e.createBuffer())),this.fogDepthBuffer=e.createBuffer(),this.colorBuffer=e.createBuffer(),this.normalBuffer=e.createBuffer(),this.vertexBuffer=e.createBuffer(),this.vertexArrayObject=new Ma,this.shadowArrayObject=new Ma,this.set_live__()},setGeometryType:function(t){this.geometryType=t},getGeometryType:function(){return this.geometryType},setTransparent:function(t){t!==this._transparent.getValue()&&(this._transparent=t)},getTransparent:function(){return this._transparent.getValue()},getBBox:function(){return this.bbox},setBBox:function(t){if(!t.equals(this.bbox)){t.getExtents(this.min,this.max),this.bbox.assign(t);for(let t=0;t<5;++t)this.planes[t].set(t%2?this.min:this.max,Da[t]);this._bbox_changed.addEvent()}},getMin:function(){return this.min},getMax:function(){return this.max},getMatrix:function(){return hn.Identity},setPrimitiveMode:function(t){this.primitiveMode=t},getPrimitiveMode:function(){return this.primitiveMode},setSolid:function(t){this.solid=t},setCCW:function(t){const e=this.getBrowser().getContext();this.frontFace=t?e.CCW:e.CW},getAttrib:function(){return this.attribNodes},getAttribs:function(){return this.attribArrays},getAttribBuffers:function(){return this.attribBuffers},setFogDepths:function(t){this.fogDepths.assign(t)},getFogDepths:function(){return this.fogDepths},setColors:function(t){this.colors.assign(t)},getColors:function(){return this.colors},setMultiTexCoords:function(t){const e=this.multiTexCoords,n=t.length;for(let i=0;i<n;++i)e[i]=t[i];e.length=n},getMultiTexCoords:function(){return this.multiTexCoords},getTexCoords:function(){return this.texCoords},getTextureCoordinate:function(){return this.textureCoordinateNode},setTextureCoordinate:function(t){this.textureCoordinateNode.removeInterest("updateTextureCoordinateMapping",this),this.textureCoordinateNode=t||this.getBrowser().getDefaultTextureCoordinate(),this.textureCoordinateNode.addInterest("updateTextureCoordinateMapping",this),this.updateTextureCoordinateMapping()},getTextureCoordinateMapping:function(){return this.textureCoordinateMapping},updateTextureCoordinateMapping:function(){this.textureCoordinateMapping.clear(),this.textureCoordinateNode.getTextureCoordinateMapping(this.textureCoordinateMapping)},setNormals:function(t){this.normals.assign(t)},getNormals:function(){return this.normals},setVertices:function(t){this.vertices.assign(t)},getVertices:function(){return this.vertices},updateVertexArrays:function(){this.vertexArrayObject.update(),this.shadowArrayObject.update(),this.updateParticlesShadow=!0,this.updateParticles=!0},buildTexCoords:function(){const t=this.texCoords;if(0===t.length){const e=this.getTexCoordParams(),n=e.min,i=e.Sindex,o=e.Tindex,r=e.Ssize,s=n[i],a=n[o],u=this.vertices.getValue();for(let e=0,n=u.length;e<n;e+=4)t.push((u[e+i]-s)/r,(u[e+o]-a)/r,0,1);t.shrinkToFit()}this.getMultiTexCoords().push(t)},getTexCoordParams:function(){const t={min:new xe(0,0,0),Ssize:0,Sindex:0,Tindex:0};return function(){const e=this.getBBox(),n=e.size,i=n.x,o=n.y,r=n.z;return t.min.assign(e.center).subtract(n.divide(2)),i>=o&&i>=r?(t.Ssize=i,t.Sindex=0,t.Tindex=o>=r?1:2):o>=i&&o>=r?(t.Ssize=o,t.Sindex=1,t.Tindex=i>=r?0:2):(t.Ssize=r,t.Sindex=2,t.Tindex=i>=o?0:1),t}}(),refineNormals:function(t,e,n){if(0===n)return e;const i=Math.cos(gt.clamp(n,0,Math.PI)),o=[];for(const n in t){const r=t[n];for(const t of r){const n=e[t],s=new xe(0,0,0);for(const t of r){const o=e[t];o.dot(n)>=i&&s.add(o)}o[t]=s.normalize()}}return o},transformLine:function(t){},transformMatrix:function(t){},isClipped:function(t,e){return e.some((function(e){return e.isClipped(t)}))},intersectsLine:function(t,e,n,i,o){return this.intersectsLineWithGeometry(t,e.getModelViewMatrix().get(),e.getLocalObjects(),o)},intersectsLineWithGeometry:function(){const t=new hn,e={u:0,v:0,t:0},n=new xe(0,0,0),i=new xe(0,0,0),o=new xe(0,0,0),r=new xe(0,0,0);return function(s,a,u,c){if(this.intersectsBBox(s)){this.transformLine(s),this.transformMatrix(t.assign(a));const l=this.multiTexCoords[0].getValue(),h=this.normals.getValue(),d=this.vertices.getValue(),p=this.vertexCount;for(let a=0;a<p;a+=3){const p=4*a;if(n.x=d[p],n.y=d[p+1],n.z=d[p+2],i.x=d[p+4],i.y=d[p+5],i.z=d[p+6],o.x=d[p+8],o.y=d[p+9],o.z=d[p+10],s.intersectsTriangle(n,i,o,e)){const n=e.u,i=e.v,o=e.t,s=new xe(o*d[p]+n*d[p+4]+i*d[p+8],o*d[p+1]+n*d[p+5]+i*d[p+9],o*d[p+2]+n*d[p+6]+i*d[p+10]);if(u.length&&this.isClipped(t.multVecMatrix(r.assign(s)),u))continue;const f=new de(o*l[p]+n*l[p+4]+i*l[p+8],o*l[p+1]+n*l[p+5]+i*l[p+9]),g=3*a,m=new xe(o*h[g]+n*h[g+3]+i*h[g+6],o*h[g+1]+n*h[g+4]+i*h[g+7],o*h[g+2]+n*h[g+5]+i*h[g+8]);c.push({texCoord:f,normal:m,point:this.getMatrix().multVecMatrix(s)})}}}return c.length}}(),getPlanesWithOffset:function(){const t=new xe(0,0,0),e=new xe(0,0,0),n=[];for(let t=0;t<5;++t)n[t]=new ws(xe.Zero,xe.zAxis);return function(i,o,r,s,a,u){t.set(i,o,r),e.set(s,a,u);for(let i=0;i<5;++i)n[i].set(i%2?t:e,Da[i]);return n}}(),intersectsBBox:function(){const t=new xe(0,0,0);return function(e,n){if(n)var i=this.min,o=this.max,r=i.x-n.x,s=o.x+n.x,a=i.y-n.y,u=o.y+n.y,c=i.z-n.z,l=o.z+n.z,h=this.getPlanesWithOffset(r,a,c,s,u,l);else i=this.min,o=this.max,r=i.x,s=o.x,a=i.y,u=o.y,c=i.z,l=o.z,h=this.planes;return!!(h[0].intersectsLine(e,t)&&t.x>=r&&t.x<=s&&t.y>=a&&t.y<=u)||(!!(h[1].intersectsLine(e,t)&&t.x>=r&&t.x<=s&&t.y>=a&&t.y<=u)||(!!(h[2].intersectsLine(e,t)&&t.x>=r&&t.x<=s&&t.z>=c&&t.z<=l)||(!!(h[3].intersectsLine(e,t)&&t.x>=r&&t.x<=s&&t.z>=c&&t.z<=l)||!!(h[4].intersectsLine(e,t)&&t.y>=a&&t.y<=u&&t.z>=c&&t.z<=l))))}}(),intersectsBox:function(){const t=new xe(0,0,0),e=new xe(0,0,0),n=new xe(0,0,0),i=new hn,o=new xe(0,0,0);return function(r,s,a){if(r.intersectsBox(this.bbox)){r.multRight(i.assign(this.getMatrix()).inverse()),this.transformMatrix(a);const u=this.vertices.getValue();for(let i=0,c=this.vertexCount;i<c;i+=3){const c=4*i;if(t.x=u[c],t.y=u[c+1],t.z=u[c+2],e.x=u[c+4],e.y=u[c+5],e.z=u[c+6],n.x=u[c+8],n.y=u[c+9],n.z=u[c+10],r.intersectsTriangle(t,e,n)){if(s.length){if(this.isClipped(a.multVecMatrix(o.assign(t)),s))continue;if(this.isClipped(a.multVecMatrix(o.assign(e)),s))continue;if(this.isClipped(a.multVecMatrix(o.assign(n)),s))continue}return!0}}}return!1}}(),set_live__:function(){this.isLive().getValue()?this.getBrowser().getBrowserOptions()._Shading.addInterest("set_shading__",this):this.getBrowser().getBrowserOptions()._Shading.removeInterest("set_shading__",this)},set_shading__:function(){const t=new xe(0,0,0),e=new xe(0,0,0),n=new xe(0,0,0),i=new xe(0,0,0);return function(o){const r=this.getBrowser(),s=r.getContext();if(this.geometryType<2)s.bindBuffer(s.ARRAY_BUFFER,this.normalBuffer),s.bufferData(s.ARRAY_BUFFER,this.normals.getValue(),s.DYNAMIC_DRAW);else{const o=r.getBrowserOptions().getShading()===Co.FLAT;if(o===this.flatShading)return;if(this.flatShading=o,o&&!this.flatNormals.length){const o=this.frontFace===s.CW,r=this.flatNormals,a=this.vertices.getValue();for(let s=0,u=a.length;s<u;s+=12)vs.normal(t.set(a[s],a[s+1],a[s+2]),e.set(a[s+4],a[s+5],a[s+6]),n.set(a[s+8],a[s+9],a[s+10]),i),o&&i.negate(),r.push(i.x,i.y,i.z,i.x,i.y,i.z,i.x,i.y,i.z);r.shrinkToFit()}s.bindBuffer(s.ARRAY_BUFFER,this.normalBuffer),s.bufferData(s.ARRAY_BUFFER,o?this.flatNormals.getValue():this.normals.getValue(),s.DYNAMIC_DRAW)}}}(),requestRebuild:function(){this._rebuild.addEvent()},rebuild:function(){const t=new xe(0,0,0);return function(){this.clear(),this.build();for(const t of this.attribArrays)t.shrinkToFit();for(const t of this.multiTexCoords)t.shrinkToFit();this.fogDepths.shrinkToFit(),this.colors.shrinkToFit(),this.normals.shrinkToFit(),this.vertices.shrinkToFit();const e=this.min,n=this.max,i=this.vertices.getValue();if(i.length){if(e.x===Number.POSITIVE_INFINITY)for(let o=0,r=i.length;o<r;o+=4)t.set(i[o],i[o+1],i[o+2]),e.min(t),n.max(t);this.bbox.setExtents(e,n)}else this.bbox.setExtents(e.set(0,0,0),n.set(0,0,0));this._bbox_changed.addEvent();for(let t=0;t<5;++t)this.planes[t].set(t%2?e:n,Da[t]);if(0===this.multiTexCoords.length&&this.buildTexCoords(),this.multiTexCoords.length){const t=this.getBrowser().getMaxTextures();for(let e=this.multiTexCoords.length;e<t;++e)this.multiTexCoords[e]=this.multiTexCoords.at(-1);this.multiTexCoords.length=t}this.transfer(),this.updateGeometryKey(),this.updateRenderFunctions()}}(),clear:function(){this.min.set(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),this.max.set(Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY);{const t=this.attribArrays;for(const e of t)e.length=0;const e=this.attribNodes.length;for(let n=t.length;n<e;++n)t[n]=Va.createArray();t.length=e}this.flatShading=void 0,this.fogDepths.length=0,this.colors.length=0,this.multiTexCoords.length=0,this.texCoords.length=0,this.normals.length=0,this.flatNormals.length=0,this.vertices.length=0},transfer:function(){const t=this.getBrowser().getContext();for(let e=this.attribBuffers.length,n=this.attribArrays.length;e<n;++e)this.attribBuffers.push(t.createBuffer());for(let e=0,n=this.attribArrays.length;e<n;++e)t.bindBuffer(t.ARRAY_BUFFER,this.attribBuffers[e]),t.bufferData(t.ARRAY_BUFFER,this.attribArrays[e].getValue(),t.DYNAMIC_DRAW);const e=this.hasFogCoords;t.bindBuffer(t.ARRAY_BUFFER,this.fogDepthBuffer),t.bufferData(t.ARRAY_BUFFER,this.fogDepths.getValue(),t.DYNAMIC_DRAW),this.hasFogCoords=!!this.fogDepths.length,this.hasFogCoords!==e&&this.updateVertexArrays();const n=this.colorMaterial;t.bindBuffer(t.ARRAY_BUFFER,this.colorBuffer),t.bufferData(t.ARRAY_BUFFER,this.colors.getValue(),t.DYNAMIC_DRAW),this.colorMaterial=!!this.colors.length,this.colorMaterial!==n&&this.updateVertexArrays();for(let e=0,n=this.multiTexCoords.length;e<n;++e)t.bindBuffer(t.ARRAY_BUFFER,this.texCoordBuffers[e]),t.bufferData(t.ARRAY_BUFFER,this.multiTexCoords[e].getValue(),t.DYNAMIC_DRAW);const i=this.hasNormals;this.set_shading__(this.getBrowser().getBrowserOptions()._Shading),this.hasNormals=!!this.normals.getValue().length,this.hasNormals!==i&&this.updateVertexArrays(),t.bindBuffer(t.ARRAY_BUFFER,this.vertexBuffer),t.bufferData(t.ARRAY_BUFFER,this.vertices.getValue(),t.DYNAMIC_DRAW),this.vertexCount=this.vertices.length/4},updateGeometryKey:function(){this.geometryKey="",this.geometryKey+=this.geometryType,this.geometryKey+=this.hasFogCoords?"1":"0",this.geometryKey+=this.colorMaterial?"1":"0",this.geometryKey+=this.hasNormals?"1":"0"},updateRenderFunctions:function(){this.vertexCount?(delete this.depth,delete this.display,delete this.displayParticlesDepth,delete this.displayParticles):(this.depth=Function.prototype,this.display=Function.prototype,this.displayParticlesDepth=Function.prototype,this.displayParticles=Function.prototype)},traverse:function(t,e){},depth:function(t,e,n){this.shadowArrayObject.enable(t,n)&&n.enableVertexAttribute(t,this.vertexBuffer,0,0),t.drawArrays(this.primitiveMode,0,this.vertexCount)},display:function(t,e){const n=e.appearanceNode,i=n.getShader(this,e);if(this.solid||!n.getBackMaterial()||this.getBrowser().getWireframe())this.displayGeometry(t,e,n,i,!0,!0);else{const o=n.getBackShader(this,e);this.displayGeometry(t,e,n,o,!0,!1),this.displayGeometry(t,e,n,i,!1,!0)}},displayGeometry:function(t,e,n,i,o,r){const s=this.getBrowser(),a=n.getBlendMode(),u=this.attribNodes,c=this.attribBuffers,l=s.getPrimitiveMode(this.primitiveMode);if(a&&a.enable(t),i.enable(t),i.setUniforms(t,this,e,r),this.vertexArrayObject.enable(t,i)){for(let e=0,n=u.length;e<n;++e)u[e].enable(t,i,c[e]);this.hasFogCoords&&i.enableFogDepthAttribute(t,this.fogDepthBuffer,0,0),this.colorMaterial&&i.enableColorAttribute(t,this.colorBuffer,0,0),i.enableTexCoordAttribute(t,this.texCoordBuffers,0,0),i.enableNormalAttribute(t,this.normalBuffer,0,0),i.enableVertexAttribute(t,this.vertexBuffer,0,0)}if(s.getWireframe())for(let e=0,n=this.vertexCount;e<n;e+=3)t.drawArrays(l,e,3);else{const n=hn.prototype.determinant3.call(e.modelViewMatrix)>0;t.frontFace(n?this.frontFace:this.backFace.get(this.frontFace)),e.transparent||o!==r?(t.enable(t.CULL_FACE),o&&!this.solid&&(t.cullFace(t.FRONT),t.drawArrays(l,0,this.vertexCount)),r&&(t.cullFace(t.BACK),t.drawArrays(l,0,this.vertexCount))):(this.solid?t.enable(t.CULL_FACE):t.disable(t.CULL_FACE),t.drawArrays(l,0,this.vertexCount))}a&&a.disable(t)},displayParticlesDepth:function(t,e,n,i){const o=i.outputParticles;if(o.shadowArrayObject.update(this.updateParticlesShadow).enable(t,n)){const e=i.particleStride;n.enableParticleAttribute(t,o,e,i.particleOffset,1),n.enableParticleMatrixAttribute(t,o,e,i.matrixOffset,1),n.enableVertexAttribute(t,this.vertexBuffer,0,0),this.updateParticlesShadow=!1}t.drawArraysInstanced(this.primitiveMode,0,this.vertexCount,i.numParticles)},displayParticles:function(t,e,n){const i=e.appearanceNode,o=i.getShader(this,e);if(this.solid||!i.getBackMaterial()||this.getBrowser().getWireframe())this.displayParticlesGeometry(t,e,i,o,!0,!0,n);else{const r=i.getBackShader(this,e);this.displayParticlesGeometry(t,e,i,r,!0,!1,n),this.displayParticlesGeometry(t,e,i,o,!1,!0,n)}},displayParticlesGeometry:function(t,e,n,i,o,r,s){const a=this.getBrowser(),u=n.getBlendMode(),c=this.attribNodes,l=this.attribBuffers,h=a.getPrimitiveMode(this.primitiveMode);u&&u.enable(t),i.enable(t),i.setUniforms(t,this,e,r);const d=s.outputParticles;if(d.vertexArrayObject.update(this.updateParticles).enable(t,i)){const e=s.particleStride;i.enableParticleAttribute(t,d,e,s.particleOffset,1),i.enableParticleMatrixAttribute(t,d,e,s.matrixOffset,1);for(let e=0,n=c.length;e<n;++e)c[e].enable(t,i,l[e]);this.hasFogCoords&&i.enableFogDepthAttribute(t,this.fogDepthBuffer,0,0),this.colorMaterial&&i.enableColorAttribute(t,this.colorBuffer,0,0),i.enableTexCoordAttribute(t,this.texCoordBuffers,0,0),i.enableNormalAttribute(t,this.normalBuffer,0,0),i.enableVertexAttribute(t,this.vertexBuffer,0,0),this.updateParticles=!1}const p=hn.prototype.determinant3.call(e.modelViewMatrix)>0;t.frontFace(p?this.frontFace:this.backFace.get(this.frontFace)),e.transparent||o!==r?(t.enable(t.CULL_FACE),o&&!this.solid&&(t.cullFace(t.FRONT),t.drawArraysInstanced(h,0,this.vertexCount,s.numParticles)),r&&(t.cullFace(t.BACK),t.drawArraysInstanced(h,0,this.vertexCount,s.numParticles))):(this.solid?t.enable(t.CULL_FACE):t.disable(t.CULL_FACE),t.drawArraysInstanced(h,0,this.vertexCount,s.numParticles)),u&&u.disable(t)}});const Ra=Va;n.set("x_ite/Components/Rendering/X3DGeometryNode",Ra);const Pa=Ra;function Aa(t={}){Object.assign(this,{geometryType:3,hasFogCoords:!1,colorMaterial:!1,hasNormals:!1,textureNode:!1,objectsCount:[0,0,0],textureCoordinateMapping:new Map,textureCoordinateNode:null},t),this.updateGeometryKey()}Aa.prototype={constructor:Aa,updateGeometryKey:Pa.prototype.updateGeometryKey,getTextureCoordinateMapping:function(){return this.textureCoordinateMapping},getTextureCoordinate:function(){return this.textureCoordinateNode}};const La=Aa;n.set("x_ite/Browser/Rendering/GeometryContext",La);const Ba=La;function Xa(t,e){this.real=t,this.imag=e}Xa.prototype={constructor:Xa,[Symbol.iterator]:function*(){yield this.real,yield this.imag},copy:function(){const t=Object.create(Xa.prototype);return t.real=this.real,t.imag=this.imag,t},assign:function(t){return this.real=t.real,this.imag=t.imag,this},equals:function(t){return this.real===t.real&&this.imag===t.imag},setPolar:function(t,e){return this.real=t*Math.cos(e),this.imag=t*Math.sin(e),this},conjugate:function(){return this.imag=-this.imag,this},negate:function(){return this.real=-this.real,this.imag=-this.imag,this},inverse:function(){const t=this.real*this.real+this.imag*this.imag;return this.real/=t,this.imag/=-t,this},add:function(t){return this.real+=t.real,this.imag+=t.imag,this},subtract:function(t){return this.real-=t.real,this.imag-=t.imag,this},multiply:function(t){return this.real*=t,this.imag*=t,this},multComp:function(){const t=this.real,e=this.imag;return this.real=t*value.real-e*value.imag,this.imag=t*value.imag+e*value.real,this},divComp:function(t){const e=this.real,n=this.imag,i=t.real,o=t.imag,r=i*i+o*o;return this.real=(e*i+n*o)/r,this.imag=(n*i-e*o)/r,this},toString:function(){return this.imag?this.real+" "+this.imag+"i":String(this.real)}},Object.defineProperty(Xa.prototype,"magnitude",{get:function(){return this.real?this.imag?Math.hypot(this.real,this.imag):Math.abs(this.real):Math.abs(this.imag)},set:function(t){this.setPolar(t,this.angle)},enumerable:!1,configurable:!1}),Object.defineProperty(Xa.prototype,"angle",{get:function(){return Math.atan2(this.imag,this.real)},set:function(t){this.setPolar(this.magnitude,t)},enumerable:!1,configurable:!1}),Object.assign(Xa,{Polar:function(t,e){return Object.create(Xa.prototype).setPolar(t,e)},multiply:function(t,e){return t.copy().multiply(e)},multComp:function(t,e){return t.copy().multComp(e)}});const Ua=Xa;n.set("standard/Math/Numbers/Complex",Ua);const ka=Ua;function za(t=0){this.value=t}za.prototype={constructor:za,get:function(t){const e=1<<t;return!!(this.value&e)},set:function(t,e){const n=1<<t;e?this.value|=n:this.value&=~n},clear:function(){this.value=0},valueOf:function(){return this.value},toString:function(t){return this.value.toString(t)}};const ja=za;n.set("standard/Utility/BitSet",ja);const Ga=ja,Ha=Math.SQRT2/2;function qa(t){fa.call(this,t),this.addType(c.X3DBackgroundNode),this._skyAngle.setUnit("angle"),this._groundAngle.setUnit("angle");this.getBrowser();this.hidden=!1,this.projectionMatrixArray=new Float32Array(16),this.modelMatrix=new hn,this.modelViewMatrixArray=new Float32Array(16),this.clipPlanes=[],this.colors=[],this.sphere=[],this.textureBits=new Ga,this.sphereContext=new Ba({colorMaterial:!0}),this.texturesContext=new Ba({textureNode:!0})}qa.prototype=Object.assign(Object.create(fa.prototype),{constructor:qa,initialize:function(){fa.prototype.initialize.call(this);const t=this.getBrowser(),e=t.getContext();this.colorBuffer=e.createBuffer(),this.sphereBuffer=e.createBuffer(),this.texCoordBuffers=new Array(t.getMaxTextures()).fill(e.createBuffer()),this.frontBuffer=e.createBuffer(),this.backBuffer=e.createBuffer(),this.leftBuffer=e.createBuffer(),this.rightBuffer=e.createBuffer(),this.topBuffer=e.createBuffer(),this.bottomBuffer=e.createBuffer(),this.sphereArrayObject=new Ma,this.frontArrayObject=new Ma,this.backArrayObject=new Ma,this.leftArrayObject=new Ma,this.rightArrayObject=new Ma,this.topArrayObject=new Ma,this.bottomArrayObject=new Ma,this._groundAngle.addInterest("build",this),this._groundColor.addInterest("build",this),this._skyAngle.addInterest("build",this),this._skyColor.addInterest("build",this),this.build(),this.transferRectangle()},set_frontTexture__:function(t){this.updateTexture("frontTexture",t,0)},set_backTexture__:function(t){this.updateTexture("backTexture",t,1)},set_leftTexture__:function(t){this.updateTexture("leftTexture",t,2)},set_rightTexture__:function(t){this.updateTexture("rightTexture",t,3)},set_topTexture__:function(t){this.updateTexture("topTexture",t,4)},set_bottomTexture__:function(t){this.updateTexture("bottomTexture",t,5)},updateTexture:function(t,e,n){this[t]&&this[t]._loadState.removeInterest("setTextureBit",this),this[t]=e,e?(e._loadState.addInterest("setTextureBit",this,n,e),this.setTextureBit(n,e,e._loadState)):this.textureBits.set(n,!1)},setTextureBit:function(t,e,n){this.textureBits.set(t,n.getValue()===c.COMPLETE_STATE||e&&e.getData())},setHidden:function(t){this.hidden=t,this.getBrowser().addBrowserEvent()},getHidden:function(){return this.hidden},getTransparent:function(){return!!this.hidden||0!==this._transparency.getValue()&&(!(this.frontTexture&&!this.frontTexture._transparent.getValue())||(!(this.backTexture&&!this.backTexture._transparent.getValue())||(!(this.leftTexture&&!this.leftTexture._transparent.getValue())||(!(this.rightTexture&&!this.rightTexture._transparent.getValue())||(!(this.topTexture&&!this.topTexture._transparent.getValue())||!(this.bottomTexture&&!this.bottomTexture._transparent.getValue()))))))},getColor:function(t,e,n){return e[gt.upperBound(n,0,n.length,t)]},build:function(){const t=Ha;if(this.colors.length=0,this.sphere.length=0,0===this._groundColor.length&&1==this._skyColor.length){this.sphere.vertices=36,this.sphere.push(t,t,-t,1,-t,t,-t,1,-t,-t,-t,1,t,t,-t,1,-t,-t,-t,1,t,-t,-t,1,-t,t,t,1,t,t,t,1,-t,-t,t,1,-t,-t,t,1,t,t,t,1,t,-t,t,1,-t,t,-t,1,-t,t,t,1,-t,-t,t,1,-t,t,-t,1,-t,-t,t,1,-t,-t,-t,1,t,t,t,1,t,t,-t,1,t,-t,t,1,t,-t,t,1,t,t,-t,1,t,-t,-t,1,t,t,t,1,-t,t,t,1,-t,t,-t,1,t,t,t,1,-t,t,-t,1,t,t,-t,1,-t,-t,t,1,t,-t,t,1,-t,-t,-t,1,-t,-t,-t,1,t,-t,t,1,t,-t,-t,1);const e=this._skyColor[0];for(let t=0,n=this.sphere.vertices;t<n;++t)this.colors.push(e.r,e.g,e.b,1)}else{if(this._skyColor.length>this._skyAngle.length){const t=this._skyAngle.slice();(0===t.length||t[0]>0)&&t.unshift(0),t.at(-1)<Math.PI&&t.push(Math.PI),2===t.length&&t.splice(1,0,(t[0]+t[1])/2),this.buildSphere(1,t,this._skyAngle,this._skyColor,!1)}if(this._groundColor.length>this._groundAngle.length){const t=this._groundAngle.slice().reverse();(0===t.length||t[0]<Math.PI/2)&&t.unshift(Math.PI/2),t.at(-1)>0&&t.push(0),this.buildSphere(1,t,this._groundAngle,this._groundColor,!0)}}this.transferSphere()},buildSphere:function(){const t=new ka(0,0),e=new ka(0,0),n=new ka(0,0),i=new ka(0,0),o=new ka(0,0),r=new ka(0,0);return function(s,a,u,c,l){const h=l?Math.PI/2:Math.PI,d=a.length-1;for(let p=0;p<d;++p){let d=gt.clamp(a[p],0,h),f=gt.clamp(a[p+1],0,h);l&&(d=Math.PI-d,f=Math.PI-f),t.setPolar(s,d),e.setPolar(s,f);const g=this.getColor(a[p],c,u),m=this.getColor(a[p+1],c,u);for(let s=0;s<20;++s){const a=s<19?s+1:0;let u=2*Math.PI*(s/20);n.setPolar(-t.imag,u),i.setPolar(-e.imag,u),u=2*Math.PI*(a/20),o.setPolar(-e.imag,u),r.setPolar(-t.imag,u),this.colors.push(g.r,g.g,g.b,1,m.r,m.g,m.b,1,m.r,m.g,m.b,1,g.r,g.g,g.b,1,g.r,g.g,g.b,1,m.r,m.g,m.b,1),this.sphere.push(n.imag,t.real,n.real,1,o.imag,e.real,o.real,1,i.imag,e.real,i.real,1,n.imag,t.real,n.real,1,r.imag,t.real,r.real,1,o.imag,e.real,o.real,1)}}}}(),transferSphere:function(){const t=this.getBrowser().getContext();t.bindBuffer(t.ARRAY_BUFFER,this.colorBuffer),t.bufferData(t.ARRAY_BUFFER,new Float32Array(this.colors),t.DYNAMIC_DRAW),t.bindBuffer(t.ARRAY_BUFFER,this.sphereBuffer),t.bufferData(t.ARRAY_BUFFER,new Float32Array(this.sphere),t.DYNAMIC_DRAW),this.sphereCount=this.sphere.length/4},transferRectangle:function(){const t=[1,1,0,1,0,1,0,1,0,0,0,1,1,1,0,1,0,0,0,1,1,0,0,1],e=[Ha,Ha,-Ha,1,-Ha,Ha,-Ha,1,-Ha,-Ha,-Ha,1,Ha,Ha,-Ha,1,-Ha,-Ha,-Ha,1,Ha,-Ha,-Ha,1],n=[-Ha,Ha,Ha,1,Ha,Ha,Ha,1,Ha,-Ha,Ha,1,-Ha,Ha,Ha,1,Ha,-Ha,Ha,1,-Ha,-Ha,Ha,1],i=[-Ha,Ha,-Ha,1,-Ha,Ha,Ha,1,-Ha,-Ha,Ha,1,-Ha,Ha,-Ha,1,-Ha,-Ha,Ha,1,-Ha,-Ha,-Ha,1],o=[Ha,Ha,Ha,1,Ha,Ha,-Ha,1,Ha,-Ha,-Ha,1,Ha,Ha,Ha,1,Ha,-Ha,-Ha,1,Ha,-Ha,Ha,1],r=[Ha,Ha,Ha,1,-Ha,Ha,Ha,1,-Ha,Ha,-Ha,1,Ha,Ha,Ha,1,-Ha,Ha,-Ha,1,Ha,Ha,-Ha,1],s=[Ha,-Ha,-Ha,1,-Ha,-Ha,-Ha,1,-Ha,-Ha,Ha,1,Ha,-Ha,-Ha,1,-Ha,-Ha,Ha,1,Ha,-Ha,Ha,1];return function(){const a=this.getBrowser().getContext();a.bindBuffer(a.ARRAY_BUFFER,this.texCoordBuffers[0]),a.bufferData(a.ARRAY_BUFFER,new Float32Array(t),a.DYNAMIC_DRAW),a.bindBuffer(a.ARRAY_BUFFER,this.frontBuffer),a.bufferData(a.ARRAY_BUFFER,new Float32Array(e),a.DYNAMIC_DRAW),a.bindBuffer(a.ARRAY_BUFFER,this.backBuffer),a.bufferData(a.ARRAY_BUFFER,new Float32Array(n),a.DYNAMIC_DRAW),a.bindBuffer(a.ARRAY_BUFFER,this.leftBuffer),a.bufferData(a.ARRAY_BUFFER,new Float32Array(i),a.DYNAMIC_DRAW),a.bindBuffer(a.ARRAY_BUFFER,this.rightBuffer),a.bufferData(a.ARRAY_BUFFER,new Float32Array(o),a.DYNAMIC_DRAW),a.bindBuffer(a.ARRAY_BUFFER,this.topBuffer),a.bufferData(a.ARRAY_BUFFER,new Float32Array(r),a.DYNAMIC_DRAW),a.bindBuffer(a.ARRAY_BUFFER,this.bottomBuffer),a.bufferData(a.ARRAY_BUFFER,new Float32Array(s),a.DYNAMIC_DRAW)}}(),traverse:function(t,e){switch(t){case Us.CAMERA:return e.getLayer().getBackgrounds().push(this),void this.modelMatrix.assign(e.getModelViewMatrix().get());case Us.DISPLAY:{const t=e.getLocalObjects(),n=this.clipPlanes;let i=0;for(let e=0,o=t.length;e<o;++e)t[e].isClipped&&(n[i++]=t[e]);return n.length=i,this.sphereContext.objectsCount[0]=n.length,void(this.texturesContext.objectsCount[0]=n.length)}}},display:function(){const t=new hn,e=new an,n=new xe(0,0,0);return function(i,o,r){this.hidden||(i.depthMask(!1),i.disable(i.DEPTH_TEST),i.enable(i.CULL_FACE),i.frontFace(i.CCW),this.projectionMatrixArray.set(o.getViewpoint().getProjectionMatrixWithLimits(.125,2e5,r)),t.assign(this.modelMatrix),t.multRight(o.getViewMatrix().get()),t.get(null,e),t.identity(),t.rotate(e),t.scale(n.set(1e5,1e5,1e5)),this.modelViewMatrixArray.set(t),this.drawSphere(o),+this.textureBits&&this.drawCube(o))}}(),drawSphere:function(t){const e=this._transparency.getValue();if(e>=1)return;const n=this.getBrowser(),i=n.getContext(),o=n.getDefaultMaterial().getShader(this.sphereContext);o.enable(i),o.setClipPlanes(i,this.clipPlanes),i.uniformMatrix4fv(o.x3d_ProjectionMatrix,!1,this.projectionMatrixArray),i.uniformMatrix4fv(o.x3d_ModelViewMatrix,!1,this.modelViewMatrixArray),i.uniform1f(o.x3d_Transparency,e),i.uniform1i(o.x3d_TextureCoordinateGeneratorMode[0],0),this.sphereArrayObject.enable(i,o)&&(o.enableColorAttribute(i,this.colorBuffer,0,0),o.enableVertexAttribute(i,this.sphereBuffer,0,0)),e?i.enable(i.BLEND):i.disable(i.BLEND),i.drawArrays(i.TRIANGLES,0,this.sphereCount)},drawCube:function(){const t=new Float32Array(hn.Identity);return function(e){const n=this.getBrowser(),i=n.getContext(),o=n.getDefaultMaterial().getShader(this.texturesContext);o.enable(i),o.setClipPlanes(i,this.clipPlanes),i.uniformMatrix4fv(o.x3d_ProjectionMatrix,!1,this.projectionMatrixArray),i.uniformMatrix4fv(o.x3d_ModelViewMatrix,!1,this.modelViewMatrixArray),i.uniformMatrix4fv(o.x3d_TextureMatrix[0],!1,t),i.uniform3f(o.x3d_EmissiveColor,1,1,1),i.uniform1f(o.x3d_Transparency,0),i.uniform1i(o.x3d_TextureCoordinateGeneratorMode[0],0),this.drawRectangle(i,n,o,e,this.frontTexture,this.frontBuffer,this.frontArrayObject),this.drawRectangle(i,n,o,e,this.backTexture,this.backBuffer,this.backArrayObject),this.drawRectangle(i,n,o,e,this.leftTexture,this.leftBuffer,this.leftArrayObject),this.drawRectangle(i,n,o,e,this.rightTexture,this.rightBuffer,this.rightArrayObject),this.drawRectangle(i,n,o,e,this.topTexture,this.topBuffer,this.topArrayObject),this.drawRectangle(i,n,o,e,this.bottomTexture,this.bottomBuffer,this.bottomArrayObject)}}(),drawRectangle:function(t,e,n,i,o,r,s){o&&(o.checkLoadState()===c.COMPLETE_STATE||o.getData())&&(o.setShaderUniforms(t,n,i),s.enable(t,n)&&(n.enableTexCoordAttribute(t,this.texCoordBuffers,0,0),n.enableVertexAttribute(t,r,0,0)),o._transparent.getValue()?t.enable(t.BLEND):t.disable(t.BLEND),t.drawArrays(t.TRIANGLES,0,6),e.resetTextureUnits())}});const Ya=qa;n.set("x_ite/Components/EnvironmentalEffects/X3DBackgroundNode",Ya);const Wa=Ya;function Ka(t){or.call(this,t),this.addType(c.X3DAppearanceChildNode)}Ka.prototype=Object.assign(Object.create(or.prototype),{constructor:Ka});const Ja=Ka;n.set("x_ite/Components/Shape/X3DAppearanceChildNode",Ja);const Za=Ja;function Qa(t){Za.call(this,t),this.addType(c.X3DTextureNode),this.addChildObjects("transparent",new Ri.SFBool),this._transparent.setAccessType(c.outputOnly)}Qa.prototype=Object.assign(Object.create(Za.prototype),{constructor:Qa,setTransparent:function(t){t!==this._transparent.getValue()&&(this._transparent=t)},getTransparent:function(){return this._transparent.getValue()}});const $a=Qa;n.set("x_ite/Components/Texturing/X3DTextureNode",$a);const tu=$a;const eu=function(t,e,n=!0){try{if(e&&(e instanceof Ri.SFNode&&(e=e.getValue()),e&&(n&&(e=e.getInnerNode()),e.getType().includes(t))))return e}catch(t){}return null};n.set("x_ite/Base/X3DCast",eu);const nu=eu;function iu(t){tu.call(this,t),this.addType(c.X3DSingleTextureNode)}iu.prototype=Object.assign(Object.create(tu.prototype),{constructor:iu,initialize:function(){tu.prototype.initialize.call(this),this._textureProperties.addInterest("set_textureProperties__",this,!0);const t=this.getBrowser().getContext();this.texture=t.createTexture(),this.set_textureProperties__(!1)},set_textureProperties__:function(t){this.texturePropertiesNode&&this.texturePropertiesNode.removeInterest("updateTextureParameters",this),this.texturePropertiesNode=nu(c.TextureProperties,this._textureProperties),this.texturePropertiesNode||(this.texturePropertiesNode=this.getBrowser().getDefaultTextureProperties()),this.texturePropertiesNode.addInterest("updateTextureParameters",this),t&&this.updateTextureParameters()},getCount:function(){return 1},getTexture:function(){return this.texture},updateTextureParameters:function(){const t=["EXT_texture_filter_anisotropic","MOZ_EXT_texture_filter_anisotropic","WEBKIT_EXT_texture_filter_anisotropic"];return function(e,n,i,o,r,s,a,u){const c=this.getBrowser().getContext();c.bindTexture(e,this.getTexture()),Math.max(o,r)<this.getBrowser().getMinTextureSize()&&!n?(c.texParameteri(e,c.TEXTURE_MIN_FILTER,c.NEAREST),c.texParameteri(e,c.TEXTURE_MAG_FILTER,c.NEAREST)):(i._generateMipMaps.getValue()&&c.generateMipmap(e),c.texParameteri(e,c.TEXTURE_MIN_FILTER,c[i.getMinificationFilter()]),c.texParameteri(e,c.TEXTURE_MAG_FILTER,c[i.getMagnificationFilter()])),n?(c.texParameteri(e,c.TEXTURE_WRAP_S,c[i.getBoundaryModeS()]),c.texParameteri(e,c.TEXTURE_WRAP_T,c[i.getBoundaryModeT()]),c.getVersion()>=2&&c.texParameteri(e,c.TEXTURE_WRAP_R,c[i.getBoundaryModeR()])):(c.texParameteri(e,c.TEXTURE_WRAP_S,s?c.REPEAT:c.CLAMP_TO_EDGE),c.texParameteri(e,c.TEXTURE_WRAP_T,a?c.REPEAT:c.CLAMP_TO_EDGE),c.getVersion()>=2&&c.texParameteri(e,c.TEXTURE_WRAP_R,u?c.REPEAT:c.CLAMP_TO_EDGE));for(const n of t){const t=c.getExtension(n);if(t){c.texParameterf(e,t.TEXTURE_MAX_ANISOTROPY_EXT,i._anisotropicDegree.getValue());break}}}}(),updateTextureBits:function(t,e=0){const n=this.getTextureType()-1;t.set(2*e+0,1&n),t.set(2*e+1,2&n)},getShaderOptions:function(){const t={2:"2D",3:"3D",4:"CUBE"};return function(e,n=0){e.push("X3D_TEXTURE"+n+"_"+t[this.getTextureType()])}}()});const ou=iu;n.set("x_ite/Components/Texturing/X3DSingleTextureNode",ou);const ru=ou,su=new Uint8Array([255,255,255,255]);function au(t){ru.call(this,t),this.addType(c.X3DTexture2DNode);const e=this.getBrowser().getContext();this.target=e.TEXTURE_2D,this.width=0,this.height=0,this.flipY=!1,this.data=null}au.prototype=Object.assign(Object.create(ru.prototype),{constructor:au,initialize:function(){ru.prototype.initialize.call(this),this._repeatS.addInterest("updateTextureParameters",this),this._repeatT.addInterest("updateTextureParameters",this);const t=this.getBrowser().getContext();t.bindTexture(t.TEXTURE_2D,this.getTexture()),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,su)},getTarget:function(){return this.target},getTextureType:function(){return 2},getTextureTypeString:function(){return"2D"},getWidth:function(){return this.width},getHeight:function(){return this.height},getFlipY:function(){return this.flipY},getData:function(){return this.data},clearTexture:function(){this.setTexture(1,1,!1,su,!1),this.data=null},setTexture:function(t,e,n,i,o){this.width=t,this.height=e,this.flipY=o,this.data=i;const r=this.getBrowser().getContext();r.pixelStorei(r.UNPACK_FLIP_Y_WEBGL,o),r.bindTexture(r.TEXTURE_2D,this.getTexture()),r.texImage2D(r.TEXTURE_2D,0,r.RGBA,t,e,0,r.RGBA,r.UNSIGNED_BYTE,i),r.pixelStorei(r.UNPACK_FLIP_Y_WEBGL,!1),this.setTransparent(n),this.updateTextureParameters(),this.addNodeEvent()},updateTexture:function(t,e){this.data=t;const n=this.getBrowser().getContext();n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,e),n.bindTexture(n.TEXTURE_2D,this.getTexture()),n.texSubImage2D(n.TEXTURE_2D,0,0,0,n.RGBA,n.UNSIGNED_BYTE,t),n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,!1),this.texturePropertiesNode._generateMipMaps.getValue()&&n.generateMipmap(n.TEXTURE_2D),this.addNodeEvent()},updateTextureParameters:function(){ru.prototype.updateTextureParameters.call(this,this.target,this._textureProperties.getValue(),this.texturePropertiesNode,this.width,this.height,this._repeatS.getValue(),this._repeatT.getValue(),!1)},setShaderUniforms:function(t,e,n,i=e.x3d_Texture[0]){const o=this.getBrowser().getTexture2DUnit();t.activeTexture(t.TEXTURE0+o),t.bindTexture(t.TEXTURE_2D,this.getTexture()),t.uniform1i(i.texture2D,o)}});const uu=au;n.set("x_ite/Components/Texturing/X3DTexture2DNode",uu);const cu=uu;var lu=i(603);function hu(t){cu.call(this,t),kr.call(this,t),this.addType(c.ImageTexture),this.image=lu("<img></img>"),this.canvas=lu("<canvas></canvas>"),this.urlStack=new Ri.MFString}hu.prototype=Object.assign(Object.create(cu.prototype),kr.prototype,{constructor:hu,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new Y([new B(c.inputOutput,"metadata",new Ri.SFNode),new B(c.inputOutput,"description",new Ri.SFString),new B(c.inputOutput,"load",new Ri.SFBool(!0)),new B(c.inputOutput,"url",new Ri.MFString),new B(c.inputOutput,"autoRefresh",new Ri.SFTime),new B(c.inputOutput,"autoRefreshTimeLimit",new Ri.SFTime(3600)),new B(c.initializeOnly,"repeatS",new Ri.SFBool(!0)),new B(c.initializeOnly,"repeatT",new Ri.SFBool(!0)),new B(c.initializeOnly,"textureProperties",new Ri.SFNode)]),getTypeName:function(){return"ImageTexture"},getComponentName:function(){return"Texturing"},getContainerField:function(){return"texture"},initialize:function(){cu.prototype.initialize.call(this),kr.prototype.initialize.call(this),this.image.on("load",this.setImage.bind(this)),this.image.on("abort error",this.setError.bind(this)),this.image[0].crossOrigin="Anonymous",this.requestImmediateLoad()},unLoadNow:function(){this.clearTexture()},loadNow:function(){this.urlStack.setValue(this._url),this.loadNext()},loadNext:function(){if(0===this.urlStack.length)return this.clearTexture(),void this.setLoadState(c.FAILED_STATE);this.URL=new URL(this.urlStack.shift(),this.getExecutionContext().getWorldURL()),"data:"!==this.URL.protocol&&(this.getBrowser().getBrowserOptions().getCache()&&this.getCache()||this.URL.searchParams.set("_",Date.now())),this.image.attr("src",this.URL.href)},setError:function(t){"data:"!==this.URL.protocol&&console.warn("Error loading image:",decodeURI(this.URL.href),t?t.type:void 0),this.loadNext()},setImage:function(){try{const t=this.getBrowser().getContext(),e=this.image[0],n=this.canvas[0],i=n.getContext("2d",{willReadFrequently:!0});let o=e.width,r=e.height;t.getVersion()>=2||gt.isPowerOfTwo(o)&&gt.isPowerOfTwo(r)?(n.width=o,n.height=r,i.clearRect(0,0,o,r),i.save(),i.translate(0,r),i.scale(1,-1),i.drawImage(e,0,0),i.restore()):(o=gt.nextPowerOfTwo(o),r=gt.nextPowerOfTwo(r),n.width=o,n.height=r,i.clearRect(0,0,o,r),i.save(),i.translate(0,r),i.scale(1,-1),i.drawImage(e,0,0,e.width,e.height,0,0,o,r),i.restore());const s=i.getImageData(0,0,o,r).data;let a=!1;for(let t=3,e=s.length;t<e;t+=4)if(255!==s[t]){a=!0;break}this.setTexture(o,r,a,new Uint8Array(s.buffer),!1),this.setLoadState(c.COMPLETE_STATE)}catch(t){console.log(t.message),this.setError()}},dispose:function(){kr.prototype.dispose.call(this),cu.prototype.dispose.call(this)}});const du=hu;n.set("x_ite/Components/Texturing/ImageTexture",du);const pu=du;function fu(t){Wa.call(this,t),this.addType(c.Background)}fu.prototype=Object.assign(Object.create(Wa.prototype),{constructor:fu,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new Y([new B(c.inputOutput,"metadata",new Ri.SFNode),new B(c.inputOnly,"set_bind",new Ri.SFBool),new B(c.inputOutput,"frontUrl",new Ri.MFString),new B(c.inputOutput,"backUrl",new Ri.MFString),new B(c.inputOutput,"leftUrl",new Ri.MFString),new B(c.inputOutput,"rightUrl",new Ri.MFString),new B(c.inputOutput,"topUrl",new Ri.MFString),new B(c.inputOutput,"bottomUrl",new Ri.MFString),new B(c.inputOutput,"skyAngle",new Ri.MFFloat),new B(c.inputOutput,"skyColor",new Ri.MFColor(new Ri.SFColor)),new B(c.inputOutput,"groundAngle",new Ri.MFFloat),new B(c.inputOutput,"groundColor",new Ri.MFColor),new B(c.inputOutput,"transparency",new Ri.SFFloat),new B(c.outputOnly,"isBound",new Ri.SFBool),new B(c.outputOnly,"bindTime",new Ri.SFTime)]),getTypeName:function(){return"Background"},getComponentName:function(){return"EnvironmentalEffects"},getContainerField:function(){return"children"},initialize:function(){Wa.prototype.initialize.call(this);const t=new pu(this.getExecutionContext()),e=new pu(this.getExecutionContext()),n=new pu(this.getExecutionContext()),i=new pu(this.getExecutionContext()),o=new pu(this.getExecutionContext()),r=new pu(this.getExecutionContext()),s=this.getBrowser().getBackgroundTextureProperties();this._frontUrl.addFieldInterest(t._url),this._backUrl.addFieldInterest(e._url),this._leftUrl.addFieldInterest(n._url),this._rightUrl.addFieldInterest(i._url),this._topUrl.addFieldInterest(o._url),this._bottomUrl.addFieldInterest(r._url),t._url=this._frontUrl,e._url=this._backUrl,n._url=this._leftUrl,i._url=this._rightUrl,o._url=this._topUrl,r._url=this._bottomUrl,t._textureProperties=s,e._textureProperties=s,n._textureProperties=s,i._textureProperties=s,o._textureProperties=s,r._textureProperties=s,t.setup(),e.setup(),n.setup(),i.setup(),o.setup(),r.setup(),this.set_frontTexture__(t),this.set_backTexture__(e),this.set_leftTexture__(n),this.set_rightTexture__(i),this.set_topTexture__(o),this.set_bottomTexture__(r)}});const gu=fu;n.set("x_ite/Components/EnvironmentalEffects/Background",gu);const mu=gu;function _u(t,e,n){or.call(this,t),na.call(this,t),this.addType(c.X3DLayerNode),t.getSpecificationVersion()<4&&this.addAlias("isPickable",this._pickable),this.groupNode=n,this.currentViewport=null,this.defaultNavigationInfo=new xa(t),this.defaultViewpoint=e,this.defaultBackground=new mu(t),this.defaultFog=new Na(t),this.navigationInfoStack=new ra(t,this.defaultNavigationInfo),this.viewpointStack=new ra(t,this.defaultViewpoint),this.backgroundStack=new ra(t,this.defaultBackground),this.fogStack=new ra(t,this.defaultFog),this.navigationInfos=new ua(t,this.defaultNavigationInfo),this.viewpoints=new ua(t,this.defaultViewpoint),this.backgrounds=new ua(t,this.defaultBackground),this.fogs=new ua(t,this.defaultFog),this.defaultBackground.setHidden(!0),this.defaultFog.setHidden(!0),this.collisionTime=0}_u.prototype=Object.assign(Object.create(or.prototype),na.prototype,{constructor:_u,layer0:!1,initialize:function(){or.prototype.initialize.call(this),na.prototype.initialize.call(this),this.defaultNavigationInfo.setup(),this.defaultViewpoint.setup(),this.defaultBackground.setup(),this.defaultFog.setup(),this.navigationInfoStack.setup(),this.viewpointStack.setup(),this.backgroundStack.setup(),this.fogStack.setup(),this.navigationInfos.setup(),this.viewpoints.setup(),this.backgrounds.setup(),this.fogs.setup(),this._viewport.addInterest("set_viewport__",this),this.set_viewport__()},isLayer0:function(t){this.layer0=t,this.defaultBackground.setHidden(!t)},getLayer:function(){return this},getGroup:function(){return this.groupNode},getViewport:function(){return this.currentViewport},getBackground:function(){return this.backgroundStack.top()},getFog:function(){return this.fogStack.top()},getNavigationInfo:function(){return this.navigationInfoStack.top()},getViewpoint:function(){return this.viewpointStack.top()},getBackgrounds:function(){return this.backgrounds},getFogs:function(){return this.fogs},getNavigationInfos:function(){return this.navigationInfos},getViewpoints:function(){return this.viewpoints},getUserViewpoints:function(){for(var t=[],e=0;e<this.viewpoints.get().length;++e){var n=this.viewpoints.get()[e];n._description.length&&t.push(n)}return t},getBackgroundStack:function(){return this.backgroundStack},getFogStack:function(){return this.fogStack},getNavigationInfoStack:function(){return this.navigationInfoStack},getViewpointStack:function(){return this.viewpointStack},getBBox:function(t,e){return this.groupNode.getBBox(t,e)},lookAt:function(t=1,e=!1){const n=this.getViewpoint(),i=this.getBBox(new Ks).multRight(hn.inverse(n.getModelMatrix()));n.lookAt(this,i.center,n.getLookAtDistance(i),t,e)},set_viewport__:function(){this.currentViewport=nu(c.X3DViewportNode,this._viewport),this.currentViewport||(this.currentViewport=this.getBrowser().getDefaultViewport())},bindBindables:function(t){this.traverse(Us.CAMERA,this);const e=this.navigationInfos.getBound(),n=this.backgrounds.getBound(),i=this.fogs.getBound(),o=this.viewpoints.getBound(t);this.navigationInfoStack.pushOnTop(e),this.viewpointStack.pushOnTop(o),this.backgroundStack.pushOnTop(n),this.fogStack.pushOnTop(i),o.resetUserOffsets()},traverse:function(t,e){e=e||this;var n=this.getViewpoint();switch(this.getProjectionMatrix().pushMatrix(n.getProjectionMatrix(this)),this.getCameraSpaceMatrix().pushMatrix(n.getCameraSpaceMatrix()),this.getViewMatrix().pushMatrix(n.getViewMatrix()),t){case Us.POINTER:this.pointer(t,e);break;case Us.CAMERA:this.camera(t,e);break;case Us.PICKING:this.picking(t,e);break;case Us.COLLISION:this.collision(t,e);break;case Us.SHADOW:case Us.DISPLAY:this.display(t,e)}this.getViewMatrix().pop(),this.getCameraSpaceMatrix().pop(),this.getProjectionMatrix().pop()},pointer:function(t,e){if(this._pickable.getValue()){var n=this.getBrowser(),i=this.currentViewport.getRectangle();if(n.getSelectedLayer()){if(n.getSelectedLayer()!==this)return}else if(!n.isPointerInRectangle(i))return;n.setHitRay(this.getProjectionMatrix().get(),i),this.getModelViewMatrix().pushMatrix(this.getViewMatrix().get()),this.currentViewport.push(this),this.groupNode.traverse(t,e),this.currentViewport.pop(this),this.getModelViewMatrix().pop()}},camera:function(t,e){this._visible.getValue()&&(this.getModelViewMatrix().pushMatrix(hn.Identity),this.currentViewport.push(this),this.groupNode.traverse(t,e),this.currentViewport.pop(this),this.getModelViewMatrix().pop(),this.navigationInfos.update(this,this.navigationInfoStack),this.viewpoints.update(this,this.viewpointStack),this.backgrounds.update(this,this.backgroundStack),this.fogs.update(this,this.fogStack),this.getViewpoint().update())},picking:function(t,e){this._pickable.getValue()&&(this.getModelViewMatrix().pushMatrix(hn.Identity),this.currentViewport.push(this),this.groupNode.traverse(t,e),this.currentViewport.pop(this),this.getModelViewMatrix().pop())},collision:function(){const t=new hn;return function(e,n){var i=this.getNavigationInfo();if(!i._transitionActive.getValue()){var o=i.getCollisionRadius(),r=i.getAvatarHeight(),s=Math.max(2*o,2*r);this.collisionTime=0,qs.ortho(-s,s,-s,s,-s,s,t),this.getProjectionMatrix().pushMatrix(t),this.getModelViewMatrix().pushMatrix(this.getViewMatrix().get()),this.currentViewport.push(this),n.render(e,this.groupNode.traverse,this.groupNode),this.currentViewport.pop(this),this.getModelViewMatrix().pop(),this.getProjectionMatrix().pop()}}}(),display:function(t,e){this._visible.getValue()&&(this.getNavigationInfo().enable(t,e),this.getModelViewMatrix().pushMatrix(this.getViewMatrix().get()),this.currentViewport.push(this),e.render(t,this.groupNode.traverse,this.groupNode),this.currentViewport.pop(this),this.getModelViewMatrix().pop())}});const xu=_u;n.set("x_ite/Components/Layering/X3DLayerNode",xu);const yu=xu;function wu(t){ha.call(this,t),this.addType(c.X3DSensorNode)}wu.prototype=Object.assign(Object.create(ha.prototype),{constructor:wu});const Su=wu;n.set("x_ite/Components/Core/X3DSensorNode",Su);const Tu=Su;function bu(t){this.addType(c.X3DTimeDependentNode),this.addChildObjects("initialized",new Ri.SFTime,"isEvenLive",new Ri.SFBool),this.startTimeValue=0,this.pauseTimeValue=0,this.resumeTimeValue=0,this.stopTimeValue=0,this.start=0,this.pause=0,this.pauseInterval=0,this.startTimeout=null,this.pauseTimeout=null,this.resumeTimeout=null,this.stopTimeout=null,this.disabled=!1}bu.prototype=Object.assign(Object.create(ha.prototype),{constructor:bu,initialize:function(){this.isLive().addInterest("set_live__",this),this._isEvenLive.addInterest("set_live__",this),this._initialized.addInterest("set_loop__",this),this._enabled.addInterest("set_enabled__",this),this._loop.addInterest("set_loop__",this),this._startTime.addInterest("set_startTime__",this),this._pauseTime.addInterest("set_pauseTime__",this),this._resumeTime.addInterest("set_resumeTime__",this),this._stopTime.addInterest("set_stopTime__",this),this.startTimeValue=this._startTime.getValue(),this.pauseTimeValue=this._pauseTime.getValue(),this.resumeTimeValue=this._resumeTime.getValue(),this.stopTimeValue=this._stopTime.getValue(),this._initialized=this.getBrowser().getCurrentTime()},getDisabled:function(){return this.disabled},getLiveState:function(){return this.getLive()&&(this.getExecutionContext().isLive().getValue()||this._isEvenLive.getValue())},getElapsedTime:function(){return this.getBrowser().getCurrentTime()-this.start-this.pauseInterval},resetElapsedTime:function(){this.start=this.getBrowser().getCurrentTime(),this.pause=this.getBrowser().getCurrentTime(),this.pauseInterval=0},set_live__:function(){this.isLive().getValue()||this._isEvenLive.getValue()?this.disabled&&(this.disabled=!1,this._isActive.getValue()&&!this._isPaused.getValue()&&this.real_resume()):this.disabled||!this._isActive.getValue()||this._isPaused.getValue()||(this.disabled=!0,this.real_pause())},set_enabled__:function(){this._enabled.getValue()?this.set_loop__():this.stop()},set_loop__:function(){this._enabled.getValue()&&this._loop.getValue()&&this.stopTimeValue<=this.startTimeValue&&this.startTimeValue<=this.getBrowser().getCurrentTime()&&this.do_start()},set_startTime__:function(){this.startTimeValue=this._startTime.getValue(),this._enabled.getValue()&&(this.removeTimeout("startTimeout"),this.startTimeValue<=this.getBrowser().getCurrentTime()?this.do_start():this.addTimeout("startTimeout","do_start",this.startTimeValue))},set_pauseTime__:function(){if(this.pauseTimeValue=this._pauseTime.getValue(),this._enabled.getValue()){if(this.removeTimeout("pauseTimeout"),this.pauseTimeValue<=this.resumeTimeValue)return;this.pauseTimeValue<=this.getBrowser().getCurrentTime()?this.do_pause():this.addTimeout("pauseTimeout","do_pause",this.pauseTimeValue)}},set_resumeTime__:function(){if(this.resumeTimeValue=this._resumeTime.getValue(),this._enabled.getValue()){if(this.removeTimeout("resumeTimeout"),this.resumeTimeValue<=this.pauseTimeValue)return;this.resumeTimeValue<=this.getBrowser().getCurrentTime()?this.do_resume():this.addTimeout("resumeTimeout","do_resume",this.resumeTimeValue)}},set_stopTime__:function(){if(this.stopTimeValue=this._stopTime.getValue(),this._enabled.getValue()){if(this.removeTimeout("stopTimeout"),this.stopTimeValue<=this.startTimeValue)return;this.stopTimeValue<=this.getBrowser().getCurrentTime()?this.do_stop():this.addTimeout("stopTimeout","do_stop",this.stopTimeValue)}},do_start:function(){this._isActive.getValue()||(this.resetElapsedTime(),this._isActive=!0,this.set_start(),this.isLive().getValue()?this.getBrowser().timeEvents().addInterest("set_time",this):(this.disabled=!0,this.real_pause()),this._elapsedTime=0)},do_pause:function(){this._isActive.getValue()&&!this._isPaused.getValue()&&(this._isPaused=!0,this.pauseTimeValue!==this.getBrowser().getCurrentTime()&&(this.pauseTimeValue=this.getBrowser().getCurrentTime()),this.isLive().getValue()&&this.real_pause())},real_pause:function(){this.pause=Date.now(),this.set_pause(),this.getBrowser().timeEvents().removeInterest("set_time",this)},do_resume:function(){this._isActive.getValue()&&this._isPaused.getValue()&&(this._isPaused=!1,this.resumeTimeValue!==this.getBrowser().getCurrentTime()&&(this.resumeTimeValue=this.getBrowser().getCurrentTime()),this.isLive().getValue()&&this.real_resume())},real_resume:function(){const t=(Date.now()-this.pause)/1e3;this.pauseInterval+=t,this.set_resume(t),this.getBrowser().timeEvents().addInterest("set_time",this),this.getBrowser().addBrowserEvent()},do_stop:function(){this.stop()},stop:function(){this._isActive.getValue()&&(this.set_stop(),this._elapsedTime=this.getElapsedTime(),this._isPaused.getValue()&&(this._isPaused=!1),this._isActive=!1,this.getBrowser().timeEvents().removeInterest("set_time",this))},timeout:function(t){this._enabled.getValue()&&(this.getBrowser().advanceTime(),this[t]())},addTimeout:function(t,e,n){this.removeTimeout(t),this[t]=setTimeout(this.timeout.bind(this,e),1e3*(n-this.getBrowser().getCurrentTime()))},removeTimeout:function(t){clearTimeout(this[t]),this[t]=null},set_start:function(){},set_pause:function(){},set_resume:function(){},set_stop:function(){},set_time:function(){},dispose:function(){}});const vu=bu;n.set("x_ite/Components/Time/X3DTimeDependentNode",vu);const Cu=vu;function Eu(t){Tu.call(this,t),Cu.call(this,t),this.addType(c.TimeSensor),this.addChildObjects("range",new Ri.MFFloat(0,0,1)),this.cycle=0,this.interval=0,this.fraction=0,this.first=0,this.last=1,this.scale=1}Eu.prototype=Object.assign(Object.create(Tu.prototype),Cu.prototype,{constructor:Eu,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new Y([new B(c.inputOutput,"metadata",new Ri.SFNode),new B(c.inputOutput,"description",new Ri.SFString),new B(c.inputOutput,"enabled",new Ri.SFBool(!0)),new B(c.inputOutput,"cycleInterval",new Ri.SFTime(1)),new B(c.inputOutput,"loop",new Ri.SFBool),new B(c.inputOutput,"startTime",new Ri.SFTime),new B(c.inputOutput,"resumeTime",new Ri.SFTime),new B(c.inputOutput,"pauseTime",new Ri.SFTime),new B(c.inputOutput,"stopTime",new Ri.SFTime),new B(c.outputOnly,"isPaused",new Ri.SFBool),new B(c.outputOnly,"isActive",new Ri.SFBool),new B(c.outputOnly,"cycleTime",new Ri.SFTime),new B(c.outputOnly,"elapsedTime",new Ri.SFTime),new B(c.outputOnly,"fraction_changed",new Ri.SFFloat),new B(c.outputOnly,"time",new Ri.SFTime)]),getTypeName:function(){return"TimeSensor"},getComponentName:function(){return"Time"},getContainerField:function(){return"children"},initialize:function(){Tu.prototype.initialize.call(this),Cu.prototype.initialize.call(this),this._cycleInterval.addInterest("set_cycleInterval__",this),this._range.addInterest("set_range__",this)},setRange:function(t,e,n){const i=this.getBrowser().getCurrentTime(),o=this._startTime.getValue(),r=this._cycleInterval.getValue();this.first=e,this.last=n,this.scale=this.last-this.first,this.interval=r*this.scale,this.fraction=gt.fract((t>=1?0:t)+(this.interval?(i-o)/this.interval:0)),this.cycle=i-(this.fraction-this.first)*r},set_cycleInterval__:function(){this._isActive.getValue()&&this.setRange(this.fraction,this._range[1],this._range[2])},set_range__:function(){this._isActive.getValue()&&(this.setRange(this._range[0],this._range[1],this._range[2]),this._isPaused.getValue()||this.set_fraction(this.getBrowser().getCurrentTime()))},set_start:function(){this.setRange(this._range[0],this._range[1],this._range[2]),this.isLive().getValue()&&(this._fraction_changed=this.fraction,this._time=this.getBrowser().getCurrentTime())},set_resume:function(t){const e=this.getBrowser().getCurrentTime(),n=this._startTime.getValue();this.setRange(this.interval?gt.fract(this.fraction-(e-n)/this.interval):0,this._range[1],this._range[2])},set_fraction:function(t){this._fraction_changed=this.fraction=this.first+(this.interval?gt.fract((t-this.cycle)/this.interval):0)*this.scale},set_time:function(){const t=this.getBrowser().getCurrentTime();t-this.cycle>=this.interval?this._loop.getValue()?this.interval&&(this.cycle+=this.interval*Math.floor((t-this.cycle)/this.interval),this._elapsedTime=this.getElapsedTime(),this._cycleTime=t,this.set_fraction(t)):(this._fraction_changed=this.fraction=this.last,this.stop()):(this._elapsedTime=this.getElapsedTime(),this.set_fraction(t)),this._time=t},dispose:function(){Cu.prototype.dispose.call(this),Tu.prototype.dispose.call(this)}});const Ou=Eu;n.set("x_ite/Components/Time/TimeSensor",Ou);const Nu=Ou;function Fu(t){ha.call(this,t),this.addType(c.X3DInterpolatorNode)}Fu.prototype=Object.assign(Object.create(ha.prototype),{constructor:Fu,setup:function(){this.set_key__(),this._key.length&&this.interpolate(0,0,0),ha.prototype.setup.call(this)},initialize:function(){ha.prototype.initialize.call(this),this._set_fraction.addInterest("set_fraction__",this),this._key.addInterest("set_key__",this)},set_fraction__:function(){const t=this._key,e=t.length,n=this._set_fraction.getValue();switch(e){case 0:return;case 1:return this.interpolate(0,0,0);default:{if(n<=t[0])return this.interpolate(0,1,0);const i=gt.upperBound(t,0,e,n);if(i!==e){const e=i-1,o=(n-t[e])/(t[i]-t[e]);this.interpolate(e,i,gt.clamp(o,0,1))}else this.interpolate(e-2,e-1,1)}}},set_key__:function(){this.set_keyValue__()},set_keyValue__:function(){},interpolate:function(){}});const Iu=Fu;n.set("x_ite/Components/Interpolation/X3DInterpolatorNode",Iu);const Mu=Iu;function Du(t){Mu.call(this,t),this.addType(c.EaseInEaseOut)}Du.prototype=Object.assign(Object.create(Mu.prototype),{constructor:Du,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new Y([new B(c.inputOutput,"metadata",new Ri.SFNode),new B(c.inputOnly,"set_fraction",new Ri.SFFloat),new B(c.inputOutput,"key",new Ri.MFFloat),new B(c.inputOutput,"easeInEaseOut",new Ri.MFVec2f),new B(c.outputOnly,"modifiedFraction_changed",new Ri.SFFloat)]),getTypeName:function(){return"EaseInEaseOut"},getComponentName:function(){return"Interpolation"},getContainerField:function(){return"children"},initialize:function(){Mu.prototype.initialize.call(this),this._easeInEaseOut.addInterest("set_keyValue__",this)},set_keyValue__:function(){this._easeInEaseOut.length<this._key.length&&this._easeInEaseOut.resize(this._key.length,this._easeInEaseOut.length?this._easeInEaseOut[this._easeInEaseOut.length-1]:new Ri.SFVec2f)},interpolate:function(t,e,n){let i=this._easeInEaseOut[t].y,o=this._easeInEaseOut[e].x;const r=i+o;if(r<0)this._modifiedFraction_changed=n;else{r>1&&(o/=r,i/=r);const t=1/(2-i-o);if(n<i)this._modifiedFraction_changed=t/i*n*n;else if(n<=1-o)this._modifiedFraction_changed=t*(2*n-i);else{const e=1-n;this._modifiedFraction_changed=1-t*e*e/o}}}});const Vu=Du;n.set("x_ite/Components/Interpolation/EaseInEaseOut",Vu);const Ru=Vu;function Pu(t){Mu.call(this,t),this.addType(c.PositionInterpolator)}Pu.prototype=Object.assign(Object.create(Mu.prototype),{constructor:Pu,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new Y([new B(c.inputOutput,"metadata",new Ri.SFNode),new B(c.inputOnly,"set_fraction",new Ri.SFFloat),new B(c.inputOutput,"key",new Ri.MFFloat),new B(c.inputOutput,"keyValue",new Ri.MFVec3f),new B(c.outputOnly,"value_changed",new Ri.SFVec3f)]),getTypeName:function(){return"PositionInterpolator"},getComponentName:function(){return"Interpolation"},getContainerField:function(){return"children"},initialize:function(){Mu.prototype.initialize.call(this),this._keyValue.addInterest("set_keyValue__",this)},set_keyValue__:function(){const t=this._key,e=this._keyValue;e.length<t.length&&e.resize(t.length,e.length?e[e.length-1]:new Ri.SFVec3f)},interpolate:function(){const t=new xe(0,0,0);return function(e,n,i){this._value_changed=t.assign(this._keyValue[e].getValue()).lerp(this._keyValue[n].getValue(),i)}}()});const Au=Pu;n.set("x_ite/Components/Interpolation/PositionInterpolator",Au);const Lu=Au;function Bu(t){Mu.call(this,t),this.addType(c.OrientationInterpolator),this._keyValue.setUnit("angle"),this._value_changed.setUnit("angle")}Bu.prototype=Object.assign(Object.create(Mu.prototype),{constructor:Bu,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new Y([new B(c.inputOutput,"metadata",new Ri.SFNode),new B(c.inputOnly,"set_fraction",new Ri.SFFloat),new B(c.inputOutput,"key",new Ri.MFFloat),new B(c.inputOutput,"keyValue",new Ri.MFRotation),new B(c.outputOnly,"value_changed",new Ri.SFRotation)]),getTypeName:function(){return"OrientationInterpolator"},getComponentName:function(){return"Interpolation"},getContainerField:function(){return"children"},initialize:function(){Mu.prototype.initialize.call(this),this._keyValue.addInterest("set_keyValue__",this)},set_keyValue__:function(){const t=this._key,e=this._keyValue;e.length<t.length&&e.resize(t.length,e.length?e[e.length-1]:new Ri.SFRotation)},interpolate:function(){const t=new an(0,0,1,0),e=new an(0,0,1,0);return function(n,i,o){t.assign(this._keyValue[n].getValue()),e.assign(this._keyValue[i].getValue()),this._value_changed=t.slerp(e,o)}}()});const Xu=Bu;n.set("x_ite/Components/Interpolation/OrientationInterpolator",Xu);const Uu=Xu;function ku(t){Mu.call(this,t),this.addType(c.ScalarInterpolator)}ku.prototype=Object.assign(Object.create(Mu.prototype),{constructor:ku,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new Y([new B(c.inputOutput,"metadata",new Ri.SFNode),new B(c.inputOnly,"set_fraction",new Ri.SFFloat),new B(c.inputOutput,"key",new Ri.MFFloat),new B(c.inputOutput,"keyValue",new Ri.MFFloat),new B(c.outputOnly,"value_changed",new Ri.SFFloat)]),getTypeName:function(){return"ScalarInterpolator"},getComponentName:function(){return"Interpolation"},getContainerField:function(){return"children"},initialize:function(){Mu.prototype.initialize.call(this),this._keyValue.addInterest("set_keyValue__",this)},set_keyValue__:function(){const t=this._key,e=this._keyValue;e.length<t.length&&e.resize(t.length,e.length?e[e.length-1]:0)},interpolate:function(t,e,n){this._value_changed=gt.lerp(this._keyValue[t],this._keyValue[e],n)}});const zu=ku;n.set("x_ite/Components/Interpolation/ScalarInterpolator",zu);const ju=zu;function Gu(t){fa.call(this,t),this.addType(c.X3DViewpointNode),this.addChildObjects("positionOffset",new Ri.SFVec3f,"orientationOffset",new Ri.SFRotation,"scaleOffset",new Ri.SFVec3f(1,1,1),"scaleOrientationOffset",new Ri.SFRotation,"centerOfRotationOffset",new Ri.SFVec3f,"fieldOfViewScale",new Ri.SFFloat(1)),this.userPosition=new xe(0,1,0),this.userOrientation=new an(0,0,1,0),this.userCenterOfRotation=new xe(0,0,0),this.modelMatrix=new hn,this.cameraSpaceMatrix=new hn(1,0,0,0,0,1,0,0,0,0,1,0,0,0,10,1),this.viewMatrix=new hn(1,0,0,0,0,1,0,0,0,0,1,0,0,0,-10,1);const e=this.getBrowser();this.timeSensor=new Nu(e.getPrivateScene()),this.easeInEaseOut=new Ru(e.getPrivateScene()),this.positionInterpolator=new Lu(e.getPrivateScene()),this.orientationInterpolator=new Uu(e.getPrivateScene()),this.scaleInterpolator=new Lu(e.getPrivateScene()),this.scaleOrientationInterpolator=new Uu(e.getPrivateScene()),this.fieldOfViewScaleInterpolator=new ju(e.getPrivateScene())}Gu.prototype=Object.assign(Object.create(fa.prototype),{constructor:Gu,initialize:function(){fa.prototype.initialize.call(this),this.timeSensor._stopTime=1,this.timeSensor.setup(),this.easeInEaseOut._key=new Ri.MFFloat(0,1),this.easeInEaseOut._easeInEaseOut=new Ri.MFVec2f(new Ri.SFVec2f(0,0),new Ri.SFVec2f(0,0)),this.easeInEaseOut.setup(),this.positionInterpolator._key=new Ri.MFFloat(0,1),this.orientationInterpolator._key=new Ri.MFFloat(0,1),this.scaleInterpolator._key=new Ri.MFFloat(0,1),this.scaleOrientationInterpolator._key=new Ri.MFFloat(0,1),this.fieldOfViewScaleInterpolator._key=new Ri.MFFloat(0,1),this.positionInterpolator.setup(),this.orientationInterpolator.setup(),this.scaleInterpolator.setup(),this.scaleOrientationInterpolator.setup(),this.fieldOfViewScaleInterpolator.setup(),this.timeSensor._isActive.addFieldInterest(this._transitionActive),this.timeSensor._fraction_changed.addFieldInterest(this.easeInEaseOut._set_fraction),this.easeInEaseOut._modifiedFraction_changed.addFieldInterest(this.positionInterpolator._set_fraction),this.easeInEaseOut._modifiedFraction_changed.addFieldInterest(this.orientationInterpolator._set_fraction),this.easeInEaseOut._modifiedFraction_changed.addFieldInterest(this.scaleInterpolator._set_fraction),this.easeInEaseOut._modifiedFraction_changed.addFieldInterest(this.scaleOrientationInterpolator._set_fraction),this.easeInEaseOut._modifiedFraction_changed.addFieldInterest(this.fieldOfViewScaleInterpolator._set_fraction),this.positionInterpolator._value_changed.addFieldInterest(this._positionOffset),this.orientationInterpolator._value_changed.addFieldInterest(this._orientationOffset),this.scaleInterpolator._value_changed.addFieldInterest(this._scaleOffset),this.scaleOrientationInterpolator._value_changed.addFieldInterest(this._scaleOrientationOffset),this.fieldOfViewScaleInterpolator._value_changed.addFieldInterest(this._fieldOfViewScale),this._nearDistance.addInterest("set_nearDistance__",this),this._farDistance.addInterest("set_farDistance__",this),this._viewAll.addInterest("set_viewAll__",this),this._navigationInfo.addInterest("set_navigationInfo__",this),this._isBound.addInterest("set_bound__",this),this.set_nearDistance__(),this.set_farDistance__(),this.set_navigationInfo__()},set_nearDistance__:function(){const t=this._nearDistance.getValue();this.nearDistance=t>=0?t:void 0},set_farDistance__:function(){const t=this._farDistance.getValue();this.farDistance=t>=0?t:void 0},set_viewAll__:function(){this._viewAll.getValue()&&this._isBound.getValue()&&(this._set_bind=!0)},set_navigationInfo__:function(){this.navigationInfoNode&&this._isBound.removeFieldInterest(this.navigationInfoNode._set_bind),this.navigationInfoNode=nu(c.NavigationInfo,this._navigationInfo),this.navigationInfoNode&&this._isBound.addFieldInterest(this.navigationInfoNode._set_bind)},set_bound__:function(){const t=this.getBrowser();this._isBound.getValue()?t.getNotification()._string=this._description:this.timeSensor._stopTime=t.getCurrentTime()},set_active__:function(t,e){this._isBound.getValue()&&!e.getValue()&&1===this.timeSensor._fraction_changed.getValue()&&(t._transitionComplete=!0)},setInterpolators:function(){},getPosition:function(){return this._position.getValue()},getUserPosition:function(){return this.userPosition.assign(this.getPosition()).add(this._positionOffset.getValue())},getOrientation:function(){return this._orientation.getValue()},getUserOrientation:function(){return this.userOrientation.assign(this.getOrientation()).multRight(this._orientationOffset.getValue())},getCenterOfRotation:function(){return this._centerOfRotation.getValue()},getUserCenterOfRotation:function(){return this.userCenterOfRotation.assign(this.getCenterOfRotation()).add(this._centerOfRotationOffset.getValue())},getProjectionMatrix:function(t){const e=t.getNavigationInfo();return this.getProjectionMatrixWithLimits(this.nearDistance??e.getNearValue(),this.farDistance??e.getFarValue(this),t.getLayer().getViewport().getRectangle())},getCameraSpaceMatrix:function(){return this.cameraSpaceMatrix},getViewMatrix:function(){return this.viewMatrix},getModelMatrix:function(){return this.modelMatrix},getMaxFarValue:function(){return this.getBrowser().getRenderingProperty("LogarithmicDepthBuffer")?1e10:1e5},getUpVector:function(){return xe.yAxis},getSpeedFactor:function(){return 1},setVRMLTransition:function(t){this.VRMLTransition=t},getVRMLTransition:function(){return this.VRMLTransition},transitionStart:function(t,e,n){if(this.to=n,n._jump.getValue()){const i=n.getRelativeTransformation(e);if(n._retainUserOffsets.getValue()||n.resetUserOffsets(),this!==n){for(const t of n.getFields())this.getField(t.getName()).assign(t);this.initialize()}this._viewAll.getValue()&&n.viewAll(t.getBBox(new Ks));const o=t.getNavigationInfo(),r=o._transitionTime.getValue();let s=o.getTransitionType();switch("2.0"===this.getExecutionContext().getSpecificationVersion()&&(s=n.getVRMLTransition()?"LINEAR":"TELEPORT"),n.setVRMLTransition(!1),r<=0&&(s="TELEPORT"),n.constructor!==e.constructor&&(s="TELEPORT"),s){case"TELEPORT":return void(o._transitionComplete=!0);case"ANIMATE":this.easeInEaseOut._easeInEaseOut=new Ri.MFVec2f(new Ri.SFVec2f(0,1),new Ri.SFVec2f(1,0));break;default:this.easeInEaseOut._easeInEaseOut=new Ri.MFVec2f(new Ri.SFVec2f(0,0),new Ri.SFVec2f(0,0))}t.getNavigationInfo()._transitionStart=!0,this.timeSensor._cycleInterval=r,this.timeSensor._stopTime=this.getBrowser().getCurrentTime(),this.timeSensor._startTime=this.getBrowser().getCurrentTime(),this.timeSensor._isActive.addInterest("set_active__",this,o),this.positionInterpolator._keyValue=new Ri.MFVec3f(i.position,n._positionOffset),this.orientationInterpolator._keyValue=new Ri.MFRotation(i.orientation,n._orientationOffset),this.scaleInterpolator._keyValue=new Ri.MFVec3f(i.scale,n._scaleOffset),this.scaleOrientationInterpolator._keyValue=new Ri.MFRotation(i.scaleOrientation,n._scaleOrientationOffset),this._positionOffset=i.position,this._orientationOffset=i.orientation,this._scaleOffset=i.scale,this._scaleOrientationOffset=i.scaleOrientation,this.setInterpolators(e,n,i),this._transitionActive=!0}else{const t=n.getRelativeTransformation(e);n._positionOffset=t.position,n._orientationOffset=t.orientation,n._scaleOffset=t.scale,n._scaleOrientationOffset=t.scaleOrientation,this.setInterpolators(e,n,t)}},transitionStop:function(){this.timeSensor._stopTime=this.getBrowser().getCurrentTime(),this.timeSensor._isActive.removeInterest("set_active__",this)},resetUserOffsets:function(){this._positionOffset=xe.Zero,this._orientationOffset=an.Identity,this._scaleOffset=xe.One,this._scaleOrientationOffset=an.Identity,this._centerOfRotationOffset=xe.Zero,this._fieldOfViewScale=1},getRelativeTransformation:function(){const t=new xe(0,0,0),e=new an(0,0,1,0),n=new xe(0,0,0),i=new an(0,0,1,0);return function(o){return this.modelMatrix.copy().multRight(o.getViewMatrix()).inverse().get(t,e,n,i),t.subtract(this.getPosition()),e.multLeft(this.getOrientation().copy().inverse()),{position:t,orientation:e,scale:n,scaleOrientation:i}}}(),getLookAtRotation:function(){const t=new xe(0,0,0),e=new xe(0,0,0),n=new xe(0,0,0),i=new Ie,o=new an;return function(r,s){const a=this.getUpVector(!0);return n.assign(r).subtract(s).normalize(),t.assign(a).cross(n).normalize(),e.assign(n).cross(t).normalize(),i.set(t.x,t.y,t.z,e.x,e.y,e.z,n.x,n.y,n.z),o.setMatrix(i),o}}(),lookAtPoint:function(t,e,n,i){this.getCameraSpaceMatrix().multVecMatrix(e),hn.inverse(this.getModelMatrix()).multVecMatrix(e);const o=2*t.getNavigationInfo().getNearValue();this.lookAt(t,e,o,n,i)},lookAtBBox:function(t,e,n,i){e=e.copy().multRight(hn.inverse(this.getModelMatrix()));const o=2*t.getNavigationInfo().getNearValue();this.lookAt(t,e.center,o,n,i)},lookAt:function(t,e,n,i,o){const r=e.copy().add(this.getUserOrientation().multVecRot(new xe(0,0,n))).subtract(this.getPosition());t.getNavigationInfo()._transitionStart=!0,this.timeSensor._cycleInterval=.2,this.timeSensor._stopTime=this.getBrowser().getCurrentTime(),this.timeSensor._startTime=this.getBrowser().getCurrentTime(),this.timeSensor._isActive.addInterest("set_active__",this,t.getNavigationInfo()),this.easeInEaseOut._easeInEaseOut=new Ri.MFVec2f(new Ri.SFVec2f(0,1),new Ri.SFVec2f(1,0));const s=xe.lerp(this._positionOffset.getValue(),r,i),a=xe.add(this.getPosition(),s).subtract(e);let u=an.multRight(this._orientationOffset.getValue(),new an(this.getUserOrientation().multVecRot(new xe(0,0,1)),a));o&&(u=an.inverse(this.getOrientation()).multRight(this.straightenHorizon(an.multRight(this.getOrientation(),u)))),this.positionInterpolator._keyValue=new Ri.MFVec3f(this._positionOffset,s),this.orientationInterpolator._keyValue=new Ri.MFRotation(this._orientationOffset,u),this.scaleInterpolator._keyValue=new Ri.MFVec3f(this._scaleOffset,xe.One),this.scaleOrientationInterpolator._keyValue=new Ri.MFRotation(this._scaleOrientationOffset,this._scaleOrientationOffset);const c=this.getRelativeTransformation(this);this._fieldOfViewScale=1,this._centerOfRotationOffset=xe.subtract(e,this.getCenterOfRotation()),this.setInterpolators(this,this,c)},straighten:function(t,e){t.getNavigationInfo()._transitionStart=!0,this.timeSensor._cycleInterval=.4,this.timeSensor._stopTime=this.getBrowser().getCurrentTime(),this.timeSensor._startTime=this.getBrowser().getCurrentTime(),this.timeSensor._isActive.addInterest("set_active__",this,t.getNavigationInfo()),this.easeInEaseOut._easeInEaseOut=new Ri.MFVec2f(new Ri.SFVec2f(0,1),new Ri.SFVec2f(1,0));const n=an.multRight(an.inverse(this.getOrientation()),this.straightenHorizon(this.getUserOrientation()));this.positionInterpolator._keyValue=new Ri.MFVec3f(this._positionOffset,this._positionOffset),this.orientationInterpolator._keyValue=new Ri.MFRotation(this._orientationOffset,n),this.scaleInterpolator._keyValue=new Ri.MFVec3f(this._scaleOffset,this._scaleOffset),this.scaleOrientationInterpolator._keyValue=new Ri.MFRotation(this._scaleOrientationOffset,this._scaleOrientationOffset);const i=this.getRelativeTransformation(this);this._fieldOfViewScale=1,this.setInterpolators(this,this,i)},straightenHorizon:function(){const t=new xe(0,0,0),e=new xe(0,0,0),n=new an(0,0,1,0);return function(i,o=this.getUpVector()){i.multVecRot(t.assign(xe.xAxis).negate()),i.multVecRot(e.assign(xe.zAxis));const r=e.cross(o);return Math.abs(e.dot(o))>=1||Math.abs(r.dot(t))>=1?i:(n.setFromToVec(t,r),i.multRight(n))}}(),viewAll:function(t){const e=t.center,n=this.getUserPosition().copy().subtract(e),i=this.getLookAtDistance(t),o=e.copy().add(n.normalize().multiply(i)),r=this.getLookAtRotation(o,e);this._positionOffset=o.subtract(this.getPosition()),this._orientationOffset=this.getOrientation().copy().inverse().multRight(r),this._centerOfRotationOffset=e.subtract(this.getCenterOfRotation()),this._fieldOfViewScale=1},traverse:function(t,e){t===Us.CAMERA&&(this.navigationInfoNode&&this.navigationInfoNode.traverse(t,e),e.getLayer().getViewpoints().push(this),this.modelMatrix.assign(e.getModelViewMatrix().get()))},update:function(){this.cameraSpaceMatrix.set(this.getUserPosition(),this.getUserOrientation(),this._scaleOffset.getValue(),this._scaleOrientationOffset.getValue()),this.cameraSpaceMatrix.multRight((this.to||this).modelMatrix),this.viewMatrix.assign(this.cameraSpaceMatrix).inverse()}});const Hu=Gu;n.set("x_ite/Components/Navigation/X3DViewpointNode",Hu);const qu=Hu;function Yu(t){qu.call(this,t),this.addType(c.Viewpoint),this._position.setUnit("length"),this._centerOfRotation.setUnit("length"),this._fieldOfView.setUnit("angle"),this.projectionMatrix=new hn}Yu.prototype=Object.assign(Object.create(qu.prototype),{constructor:Yu,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new Y([new B(c.inputOutput,"metadata",new Ri.SFNode),new B(c.inputOnly,"set_bind",new Ri.SFBool),new B(c.inputOutput,"description",new Ri.SFString),new B(c.inputOutput,"position",new Ri.SFVec3f(0,0,10)),new B(c.inputOutput,"orientation",new Ri.SFRotation),new B(c.inputOutput,"centerOfRotation",new Ri.SFVec3f),new B(c.inputOutput,"fieldOfView",new Ri.SFFloat(.7854)),new B(c.inputOutput,"nearDistance",new Ri.SFFloat(-1)),new B(c.inputOutput,"farDistance",new Ri.SFFloat(-1)),new B(c.inputOutput,"viewAll",new Ri.SFBool(!1)),new B(c.inputOutput,"jump",new Ri.SFBool(!0)),new B(c.inputOutput,"retainUserOffsets",new Ri.SFBool),new B(c.outputOnly,"isBound",new Ri.SFBool),new B(c.outputOnly,"bindTime",new Ri.SFTime),new B(c.inputOutput,"navigationInfo",new Ri.SFNode)]),getTypeName:function(){return"Viewpoint"},getComponentName:function(){return"Navigation"},getContainerField:function(){return"children"},getRelativeTransformation:function(t){const e=qu.prototype.getRelativeTransformation.call(this,t);return t.constructor===this.constructor&&(e.fieldOfView=t.getFieldOfView()),e},setInterpolators:function(t,e,n){if(t.constructor===e.constructor){const t=n.fieldOfView/e.getFieldOfView();this.fieldOfViewScaleInterpolator._keyValue=new Ri.MFFloat(t,e._fieldOfViewScale.getValue()),this._fieldOfViewScale=t}else this.fieldOfViewScaleInterpolator._keyValue=new Ri.MFFloat(e._fieldOfViewScale.getValue(),e._fieldOfViewScale.getValue()),this._fieldOfViewScale=e._fieldOfViewScale.getValue()},getLogarithmicDepthBuffer:function(){return!1},getFieldOfView:function(){const t=this._fieldOfView.getValue()*this._fieldOfViewScale.getValue();return t>0&&t<Math.PI?t:Math.PI/4},getScreenScale:function(t,e,n){const i=e[2],o=e[3];let r=Math.abs(t.z)*Math.tan(this.getFieldOfView()/2)*2;return r/=i>o?o:i,n.set(r,r,r)},getViewportSize:function(){const t=new de(0,0);return function(e,n){const i=e[2],o=e[3],r=n*Math.tan(this.getFieldOfView()/2)*2,s=i/o;return s>1?t.set(r*s,r):t.set(r,r/s)}}(),getLookAtDistance:function(t){return t.size.magnitude()/2/Math.tan(this.getFieldOfView()/2)},getProjectionMatrixWithLimits:function(t,e,n){return qs.perspective(this.getFieldOfView(),t,e,n[2],n[3],this.projectionMatrix)}});const Wu=Yu;n.set("x_ite/Components/Navigation/Viewpoint",Wu);const Ku=Wu;function Ju(t){this.addType(c.X3DBoundedObject),this.addChildObjects("transformSensors_changed",new Ri.SFTime),this._bboxSize.setUnit("length"),this._bboxCenter.setUnit("length"),this.childBBox=new Ks,this.transformSensorNodes=new Set}Ju.prototype={constructor:Ju,initialize:function(){},getDefaultBBoxSize:function(){const t=new xe(-1,-1,-1);return function(){return t}}(),getBBox:function(t,e,n){const i=this.childBBox;e.set();for(var o=0,r=t.length;o<r;++o){const r=t[o];r.getBBox&&e.add(r.getBBox(i,n))}return e},displayBBox:function(){const t=new Ks,e=new hn;return function(n,i){const o=i.getModelViewMatrix();this.getBBox(t),e.set(t.center,null,t.size),o.push(),o.multLeft(e),this.getBrowser().getBBoxNode().traverse(n,i),o.pop()}}(),addTransformSensor:function(t){this.transformSensorNodes.add(t),this._transformSensors_changed=this.getBrowser().getCurrentTime()},removeTransformSensor:function(t){this.transformSensorNodes.delete(t),this._transformSensors_changed=this.getBrowser().getCurrentTime()},getTransformSensors:function(){return this.transformSensorNodes},dispose:function(){}};const Zu=Ju;n.set("x_ite/Components/Grouping/X3DBoundedObject",Zu);const Qu=Zu;function $u(t){ha.call(this,t),Qu.call(this,t),this.addType(c.X3DGroupingNode),this.hidden=!1,this.allowedTypes=new Set,this.clipPlaneNodes=[],this.localFogNodes=[],this.lightNodes=[],this.textureProjectorNodes=[],this.pointingDeviceSensorNodes=[],this.maybeCameraObjects=[],this.cameraObjects=[],this.maybePickableSensorNodes=[],this.pickableSensorNodes=[],this.pickableObjects=[],this.childNodes=[],this.displayNodes=[],this.visibleNodes=[],this.boundedObjects=[],this.sensors=new Map}function tc(t,e,n,i,o,r){const s=new Set;for(let t=o;t<r;++t)s.add(i[t]);return t.remove(e,n,(function(t){return s.has(t)}))}$u.prototype=Object.assign(Object.create(ha.prototype),Qu.prototype,{constructor:$u,initialize:function(){ha.prototype.initialize.call(this),Qu.prototype.initialize.call(this),this._transformSensors_changed.addInterest("set_transformSensors__",this),this._addChildren.addInterest("set_addChildren__",this),this._removeChildren.addInterest("set_removeChildren__",this),this._children.addInterest("set_children__",this),this.set_children__()},getBBox:function(t,e){return this.getSubBBox(t,e)},getSubBBox:function(t,e){return this._bboxSize.getValue().equals(this.getDefaultBBoxSize())?Qu.prototype.getBBox.call(this,this.visibleNodes,t,e):t.set(this._bboxSize.getValue(),this._bboxCenter.getValue())},setHidden:function(t){t!==this.hidden&&(this.hidden=t,this.set_children__())},setAllowedTypes:function(){const t=this.allowedTypes;t.clear();for(const e of arguments)t.add(e)},set_addChildren__:function(){0!==this._addChildren.length&&(this._addChildren.setTainted(!0),this._addChildren.erase(tc(this._addChildren,0,this._addChildren.length,this._children,0,this._children.length),this._addChildren.length),this._children.isTainted()||(this._children.removeInterest("set_children__",this),this._children.addInterest("connectChildren",this)),this._children.insert(this._children.length,this._addChildren,0,this._addChildren.length),this.add(this._addChildren),this._addChildren.length=0,this._addChildren.setTainted(!1))},set_removeChildren__:function(){0!==this._removeChildren.length&&(this._removeChildren.setTainted(!0),this._children.length>0&&(this._children.isTainted()||(this._children.removeInterest("set_children__",this),this._children.addInterest("connectChildren",this)),this._children.erase(tc(this._children,0,this._children.length,this._removeChildren,0,this._removeChildren.length),this._children.length),this.remove(this._removeChildren)),this._removeChildren.length=0,this._removeChildren.setTainted(!1))},set_children__:function(){this.clear(),this.add(this._children)},connectChildren:function(){this._children.removeInterest("connectChildren",this),this._children.addInterest("set_children__",this)},clear:function(){for(const t of this.maybePickableSensorNodes)t._isPickableObject.removeInterest("set_pickableObjects__",this);for(const t of this.childNodes)t._isCameraObject.removeInterest("set_cameraObjects__",this),t._isPickableObject.removeInterest("set_pickableObjects__",this),nu(c.X3DBoundedObject,t)&&(t._visible.removeInterest("set_visibles__",this),t._bboxDisplay.removeInterest("set_bboxDisplays__",this));this.clipPlaneNodes.length=0,this.localFogNodes.length=0,this.lightNodes.length=0,this.textureProjectorNodes.length=0,this.pointingDeviceSensorNodes.length=0,this.maybeCameraObjects.length=0,this.maybePickableSensorNodes.length=0,this.childNodes.length=0},add:function(t){if(!this.hidden){for(const e of t)if(e)try{const t=e.getValue().getInnerNode(),n=t.getType();for(let e=n.length-1;e>=0;--e){switch(n[e]){case c.X3DPointingDeviceSensorNode:this.pointingDeviceSensorNodes.push(t);break;case c.ClipPlane:this.clipPlaneNodes.push(t);break;case c.LocalFog:this.localFogNodes.push(t);break;case c.X3DTextureProjectorNode:this.textureProjectorNodes.push(t);break;case c.X3DLightNode:this.lightNodes.push(t);break;case c.X3DBindableNode:this.maybeCameraObjects.push(t);break;case c.TransformSensor:case c.X3DPickSensorNode:t._isPickableObject.addInterest("set_pickableObjects__",this),this.maybePickableSensorNodes.push(t);break;case c.X3DBackgroundNode:case c.X3DChildNode:t._isCameraObject.addInterest("set_cameraObjects__",this),t._isPickableObject.addInterest("set_pickableObjects__",this),nu(c.X3DBoundedObject,t)&&(t._visible.addInterest("set_visibles__",this),t._bboxDisplay.addInterest("set_bboxDisplays__",this)),this.maybeCameraObjects.push(t),this.childNodes.push(t);break;case c.BooleanFilter:case c.BooleanToggle:case c.NurbsOrientationInterpolator:case c.NurbsPositionInterpolator:case c.NurbsSurfaceInterpolator:case c.TimeSensor:case c.X3DFollowerNode:case c.X3DInfoNode:case c.X3DInterpolatorNode:case c.X3DKeyDeviceSensorNode:case c.X3DLayoutNode:case c.X3DScriptNode:case c.X3DSequencerNode:case c.X3DTriggerNode:break;default:continue}break}}catch(t){}this.set_pickableObjects__(),this.set_displayNodes__(),this.set_visibles__(),this.set_bboxDisplays__()}},remove:function(t){for(const n of t)if(n)try{const t=n.getValue().getInnerNode(),i=t.getType();for(let n=i.length-1;n>=0;--n){switch(i[n]){case c.X3DPointingDeviceSensorNode:{const e=this.pointingDeviceSensorNodes.indexOf(t);e>=0&&this.pointingDeviceSensorNodes.splice(e,1);break}case c.ClipPlane:{const e=this.clipPlaneNodes.indexOf(t);e>=0&&this.clipPlaneNodes.splice(e,1);break}case c.LocalFog:{const e=this.localFogNodes.indexOf(t);e>=0&&this.localFogNodes.splice(e,1);break}case c.X3DTextureProjectorNode:{const e=this.textureProjectorNodes.indexOf(t);e>=0&&this.textureProjectorNodes.splice(e,1);break}case c.X3DLightNode:{const e=this.lightNodes.indexOf(t);e>=0&&this.lightNodes.splice(e,1);break}case c.X3DBindableNode:{const e=this.maybeCameraObjects.indexOf(t);e>=0&&this.maybeCameraObjects.splice(e,1);break}case c.TransformSensor:case c.X3DPickSensorNode:{t._isPickableObject.removeInterest("set_pickableObjects__",this);const e=this.maybePickableSensorNodes.indexOf(t);e>=0&&this.maybePickableSensorNodes.splice(e,1);break}case c.X3DBackgroundNode:case c.X3DChildNode:var e;t._isCameraObject.removeInterest("set_cameraObjects__",this),t._isPickableObject.removeInterest("set_pickableObjects__",this),nu(c.X3DBoundedObject,t)&&(t._visible.removeInterest("set_visibles__",this),t._bboxDisplay.removeInterest("set_bboxDisplays__",this)),(e=this.maybeCameraObjects.indexOf(t))>=0&&this.maybeCameraObjects.splice(e,1),(e=this.childNodes.indexOf(t))>=0&&this.childNodes.splice(e,1);break;case c.BooleanFilter:case c.BooleanToggle:case c.NurbsOrientationInterpolator:case c.NurbsPositionInterpolator:case c.NurbsSurfaceInterpolator:case c.TimeSensor:case c.X3DFollowerNode:case c.X3DInfoNode:case c.X3DInterpolatorNode:case c.X3DKeyDeviceSensorNode:case c.X3DLayoutNode:case c.X3DScriptNode:case c.X3DSequencerNode:case c.X3DTriggerNode:break;default:continue}break}}catch(t){}this.set_pickableObjects__(),this.set_displayNodes__(),this.set_visibles__(),this.set_bboxDisplays__()},set_cameraObjects__:function(){const t=this.cameraObjects;t.length=0;for(const e of this.maybeCameraObjects)e.getCameraObject()&&(nu(c.X3DBoundedObject,e)?e._visible.getValue()&&t.push(e):t.push(e));this.setCameraObject(Boolean(t.length))},set_pickableObjects__:function(){const t=this.pickableSensorNodes,e=this.pickableObjects;t.length=0,e.length=0;for(const e of this.maybePickableSensorNodes)e.getPickableObject()&&t.push(e);for(const t of this.childNodes)t.getPickableObject()&&e.push(t);this.set_transformSensors__()},set_transformSensors__:function(){this.setPickableObject(Boolean(this.getTransformSensors().size||this.pickableSensorNodes.length||this.pickableObjects.length))},set_displayNodes__:function(){const t=this.displayNodes;t.length=0;for(const e of this.clipPlaneNodes)t.push(e);for(const e of this.localFogNodes)t.push(e);for(const e of this.lightNodes)t.push(e);for(const e of this.textureProjectorNodes)t.push(e)},set_visibles__:function(){const t=this.childNodes,e=this.visibleNodes;e.length=0;for(const n of t)nu(c.X3DBoundedObject,n)?n._visible.getValue()&&e.push(n):e.push(n);this.set_cameraObjects__()},set_bboxDisplays__:function(){const t=this.boundedObjects;t.length=0;for(const e of this.childNodes)nu(c.X3DBoundedObject,e)&&e._bboxDisplay.getValue()&&t.push(e)},traverse:function(t,e){switch(t){case Us.POINTER:{const n=this.pointingDeviceSensorNodes,i=this.clipPlaneNodes,o=this.sensors;if(o.clear(),n.length){for(const t of n)t.push(e,o);o.size&&this.getBrowser().getSensors().push(o)}for(const t of i)t.push(e);for(const n of this.childNodes)n.traverse(t,e);for(const t of i)t.pop(e);return void(o.size&&this.getBrowser().getSensors().pop())}case Us.CAMERA:for(const n of this.cameraObjects)n.traverse(t,e);return;case Us.PICKING:{if(this.getTransformSensors().size){const t=e.getModelViewMatrix().get();for(const e of this.getTransformSensors())e.collect(t)}for(const n of this.pickableSensorNodes)n.traverse(t,e);const n=this.getBrowser(),i=n.getPickingHierarchy();if(i.push(this),n.getPickable().at(-1))for(const n of this.childNodes)n.traverse(t,e);else for(const n of this.pickableObjects)n.traverse(t,e);return void i.pop()}case Us.COLLISION:{const n=this.clipPlaneNodes;for(const t of n)t.push(e);for(const n of this.childNodes)n.traverse(t,e);for(const t of n)t.pop(e);return}case Us.SHADOW:{const n=this.clipPlaneNodes;for(const t of n)t.push(e);for(const n of this.visibleNodes)n.traverse(t,e);for(const t of n)t.push(e);return}case Us.DISPLAY:{const n=this.displayNodes;for(const t of n)t.push(e,this);for(const n of this.visibleNodes)n.traverse(t,e);for(const n of this.boundedObjects)n.displayBBox(t,e);for(const t of n)t.pop(e);return}}},dispose:function(){Qu.prototype.dispose.call(this),ha.prototype.dispose.call(this)}});const ec=$u;n.set("x_ite/Components/Grouping/X3DGroupingNode",ec);const nc=ec;function ic(t){nc.call(this,t),this.addType(c.Group)}ic.prototype=Object.assign(Object.create(nc.prototype),{constructor:ic,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new Y([new B(c.inputOutput,"metadata",new Ri.SFNode),new B(c.inputOutput,"visible",new Ri.SFBool(!0)),new B(c.inputOutput,"bboxDisplay",new Ri.SFBool),new B(c.initializeOnly,"bboxSize",new Ri.SFVec3f(-1,-1,-1)),new B(c.initializeOnly,"bboxCenter",new Ri.SFVec3f),new B(c.inputOnly,"addChildren",new Ri.MFNode),new B(c.inputOnly,"removeChildren",new Ri.MFNode),new B(c.inputOutput,"children",new Ri.MFNode)]),getTypeName:function(){return"Group"},getComponentName:function(){return"Grouping"},getContainerField:function(){return"children"}});const oc=ic;n.set("x_ite/Components/Grouping/Group",oc);const rc=oc;function sc(t){yu.call(this,t,new Ku(t),new rc(t)),this.addType(c.Layer)}sc.prototype=Object.assign(Object.create(yu.prototype),{constructor:sc,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new Y([new B(c.inputOutput,"metadata",new Ri.SFNode),new B(c.inputOutput,"pickable",new Ri.SFBool(!0)),new B(c.inputOutput,"objectType",new Ri.MFString("ALL")),new B(c.inputOutput,"visible",new Ri.SFBool(!0)),new B(c.inputOutput,"viewport",new Ri.SFNode),new B(c.inputOnly,"addChildren",new Ri.MFNode),new B(c.inputOnly,"removeChildren",new Ri.MFNode),new B(c.inputOutput,"children",new Ri.MFNode)]),getTypeName:function(){return"Layer"},getComponentName:function(){return"Layering"},getContainerField:function(){return"layers"},initialize:function(){yu.prototype.initialize.call(this),this._addChildren.addFieldInterest(this.getGroup()._addChildren),this._removeChildren.addFieldInterest(this.getGroup()._removeChildren),this._children.addFieldInterest(this.getGroup()._children),this.getGroup()._children=this._children,this.getGroup().setPrivate(!0),this.getGroup().setup()}});const ac=sc;n.set("x_ite/Components/Layering/Layer",ac);const uc=ac;function cc(t){or.call(this,t),this.addType(c.LayerSet),this.layerNodes=[new uc(t)],this.layerNode0=this.layerNodes[0],this.activeLayerNode=null}cc.prototype=Object.assign(Object.create(or.prototype),{constructor:cc,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new Y([new B(c.inputOutput,"metadata",new Ri.SFNode),new B(c.inputOutput,"activeLayer",new Ri.SFInt32),new B(c.inputOutput,"order",new Ri.MFInt32(0)),new B(c.inputOutput,"layers",new Ri.MFNode)]),getTypeName:function(){return"LayerSet"},getComponentName:function(){return"Layering"},getContainerField:function(){return"children"},initialize:function(){or.prototype.initialize.call(this),this.layerNode0.setPrivate(!0),this.layerNode0.setup(),this.layerNode0.isLayer0(!0),this._activeLayer.addInterest("set_activeLayer__",this),this._order.addInterest("set_layers__",this),this._layers.addInterest("set_layers__",this),this.set_layers__()},getActiveLayer:function(){return this.activeLayerNode},setLayer0:function(t){this.layerNode0=t,this.set_layers__()},getLayer0:function(){return this.layerNode0},getLayers:function(){return this.layerNodes},set_activeLayer__:function(){if(0===this._activeLayer.getValue())this.activeLayerNode!==this.layerNode0&&(this.activeLayerNode=this.layerNode0);else{const t=this._activeLayer-1;t>=0&&t<this._layers.length?this.activeLayerNode!==this._layers[t].getValue()&&(this.activeLayerNode=nu(c.X3DLayerNode,this._layers[t])):null!==this.activeLayerNode&&(this.activeLayerNode=null)}},set_layers__:function(){const t=this._layers.getValue();this.layerNodes.length=0;for(let e of this._order)if(0===e)this.layerNodes.push(this.layerNode0);else if(--e,e>=0&&e<t.length){const n=nu(c.X3DLayerNode,t[e]);n&&this.layerNodes.push(n)}this.set_activeLayer__()},bindBindables:function(t){const e=this._layers.getValue();this.layerNode0.bindBindables(t);for(let n=0,i=e.length;n<i;++n){const i=nu(c.X3DLayerNode,e[n]);i&&i.bindBindables(t)}},traverse:function(t,e){const n=this.layerNodes;if(t===Us.POINTER)for(let i=0,o=n.length;i<o;++i)this.getBrowser().setLayerNumber(i),n[i].traverse(t,e);else for(const i of n)i.traverse(t,e)}});const lc=cc;n.set("x_ite/Components/Layering/LayerSet",lc);const hc=lc;function dc(t){$i.call(this,t),this.addType(c.X3DWorld),this.addChildObjects("activeLayer",new bn(this.layer0)),this.defaultLayerSet=new hc(t),this.layerSet=this.defaultLayerSet,this.layer0=new uc(t)}Qo.addAbstractType("X3DWorld",dc),dc.prototype=Object.assign(Object.create($i.prototype),{constructor:dc,getTypeName:function(){return"X3DWorld"},initialize:function(){$i.prototype.initialize.call(this),this.layerSet.setPrivate(!0),this.layerSet.setup(),this.layerSet.setLayer0(this.layer0),this.layerSet._activeLayer.addInterest("set_rootNodes__",this),this.getExecutionContext().getRootNodes().addInterest("set_rootNodes__",this),this.set_rootNodes__(),this.layer0.setPrivate(!0),this.layer0.isLayer0(!0),this.layer0.setup(),this.set_activeLayer__()},getCache:function(){return!0},getLayerSet:function(){return this.layerSet},getActiveLayer:function(){return this._activeLayer.getValue()},set_rootNodes__:function(){const t=this.layerSet,e=this.getExecutionContext().getRootNodes();this.layerSet=this.defaultLayerSet,this.layer0._children=e;for(const t of e){const e=nu(c.LayerSet,t);e&&(this.layerSet=e)}this.layerSet!==t&&(this.layerSet.setLayer0(this.layer0),t._activeLayer.removeInterest("set_activeLayer__",this),this.layerSet._activeLayer.addInterest("set_activeLayer__",this),this.set_activeLayer__())},set_activeLayer__:function(){this._activeLayer=this.layerSet.getActiveLayer()},bindBindables:function(){const t=this.getExecutionContext().getWorldURL();this.layerSet.bindBindables(decodeURIComponent(new URL(t,t).hash.substr(1)))},traverse:function(t,e){this.layerSet.traverse(t,e)}});for(const t of Reflect.ownKeys(dc.prototype))Object.defineProperty(dc.prototype,t,{enumerable:!1});const pc=dc;n.set("x_ite/Execution/X3DWorld",pc);const fc=pc;const gc=function(t){t.ajaxTransport("+binary",(function(t,e,n){if(t.dataType&&"binary"==t.dataType)return{send:function(e,n){const i=t.xhr();if(i.open(t.type,t.url,t.async,t.username,t.password),t.xhrFields)for(const e in t.xhrFields)i[e]=t.xhrFields[e];t.mimeType&&i.overrideMimeType&&i.overrideMimeType(t.mimeType);for(const t in e)i.setRequestHeader(t,e[t]);i.onload=function(){i.onload=i.onerror=null;const e={};e[t.dataType]=i.response,n(i.status||200,i.statusText,e,i.getAllResponseHeaders())},i.onerror=function(){i.onload=i.onerror=null,n(i.status||404,i.statusText)},i.responseType=t.responseType||"blob",i.send(t.hasContent&&t.data||null)},abort:function(){const e=t.xhr();e.onload=e.onerror=null,e.abort()}}}))};n.set("standard/Networking/BinaryTransport",gc);const mc=gc;var _c=i(603),xc=i(235);mc(_c);const yc=/^\s*(?:vrmlscript|javascript|ecmascript)\:(.*)$/s,wc=/^data:(.*?)(?:;charset=(.*?))?(?:;(base64))?,(.*)$/s,Sc=/^(?:(.*?);(.*?)$)/,Tc=new RegExp(".(?:html|xhtml)$"),bc={"text/html":!0,"application/xhtml+xml":!0},vc=new Ri.MFString;function Cc(t,e){S.call(this),this.node=t,this.browser=t.getBrowser(),this.external=void 0===e?this.browser.isExternal():e,this.executionContext=this.external?t.getExecutionContext():this.browser.currentScene,this.userAgent=this.browser.getName()+"/"+this.browser.getVersion()+" (X3D Browser; +"+this.browser.getProviderUrl()+")",this.target="",this.url=[],this.URL=new URL(this.getReferer(),this.getReferer()),this.fileReader=new FileReader,this.text=!0}Cc.prototype=Object.assign(Object.create(S.prototype),{constructor:Cc,abort:function(){this.callback=Function.prototype,this.bindViewpoint=Function.prototype,this.foreign=Function.prototype},isPrivate:function(){return!0},getWorldURL:function(){return this.URL},createX3DFromString:function(t,e="",n,i){try{const o=this.browser.createScene();return this.node instanceof fc?o.loader=this:o.setExecutionContext(this.executionContext),o.setWorldURL(decodeURI(new URL(t,this.getReferer()).href)),n&&(n=this.setScene.bind(this,o,n,i)),new fs(o).parseIntoScene(e,n,i),o}catch(t){if(!i)throw i;i(t)}},setScene:function(t,e,n){t._initLoadCount.addInterest("set_initLoadCount__",this,t,e,n),t._initLoadCount.addEvent()},set_initLoadCount__:function(t,e,n,i){if(!i.getValue()){t._initLoadCount.removeInterest("set_initLoadCount__",this),delete t.loader;try{e(t)}catch(t){if(!n)throw t;n(t)}no}},createX3DFromURL:function(t,e,n,i,o){return this.bindViewpoint=i,this.foreign=o,this.target=this.getTarget(e||vc),n?this.loadDocument(t,this.createX3DFromURLAsync.bind(this,n)):this.createX3DFromURLSync(t)},createX3DFromURLAsync:function(t,e){null===e?t(null,this.URL):this.createX3DFromString(this.URL,e,t,this.loadDocumentError.bind(this))},createX3DFromURLSync:function(t){if(0===t.length)throw new Error("No URL given.");let e=null,n=!1;for(const i of t)if(this.URL=new URL(i,this.getReferer()),_c.ajax({url:decodeURI(this.URL.href),dataType:"text",async:!1,cache:this.browser.getBrowserOptions().getCache()&&this.node.getCache(),global:!1,context:this,success:function(t){try{e=this.createX3DFromString(this.URL,t),n=!0}catch(t){this.error(t)}},error:function(t,e,n){}}),n)return e;throw new Error("Couldn't load any url of '"+Array.prototype.join.call(t,", ")+"'.")},loadScript:function(t,e){this.script=!0,this.loadDocument(t,e)},loadDocument:function(t,e){if(this.url=t.copy(),this.callback=e,0===t.length)return this.loadDocumentError(new Error("No URL given."));this.loadDocumentAsync(this.url.shift())},loadBinaryDocument:function(t,e){if(this.url=t.copy(),this.callback=e,this.text=!1,0===t.length)return this.loadDocumentError(new Error("No URL given."));this.loadDocumentAsync(this.url.shift())},getTarget:function(t){for(const e of t){const t=e.split("=");if(2===t.length&&"target"===t[0])return t[1]}return""},loadDocumentAsync:function(t){try{if(0===t.length)return void this.loadDocumentError(new Error("URL is empty."));if(this.script){const e=yc.exec(t);if(e)return void this.callback(e[1])}{const e=wc.exec(t);if(e){let t=e[4];return t="base64"===e[3]?atob(t):unescape(t),void this.callback(t)}}if(this.URL=new URL(t,this.getReferer()),this.bindViewpoint&&this.URL.href.substr(0,this.getReferer().length)===this.getReferer())return void this.bindViewpoint(decodeURIComponent(this.URL.hash.substr(1)));if(this.foreign){if(this.target.length&&"_self"!==this.target)return this.foreign(this.URL.href,this.target);if(this.URL.href.match(Tc))return this.foreign(this.URL.href,this.target)}_c.ajax({url:decodeURI(this.URL.href),dataType:"binary",async:!0,cache:this.browser.getBrowserOptions().getCache()&&this.node.getCache(),global:!1,context:this,success:function(t,e,n){if(this.foreign&&bc[this.getContentType(n)])return this.foreign(this.URL.href,this.target);this.text?(this.fileReader.onload=this.readAsArrayBuffer.bind(this,t),this.fileReader.readAsArrayBuffer(t)):(this.fileReader.onload=this.readAsBinaryString.bind(this),this.fileReader.readAsBinaryString(t))},error:function(t,e,n){this.loadDocumentError(new Error(n))}})}catch(t){return void this.loadDocumentError(t)}},readAsArrayBuffer:function(t){try{this.callback(xc.ungzip(this.fileReader.result,{to:"string"}),this.URL)}catch(e){this.fileReader.onload=this.readAsText.bind(this,t),this.fileReader.readAsText(t)}},readAsText:function(t){try{this.callback(this.fileReader.result,this.URL)}catch(t){this.loadDocumentError(t)}},readAsBinaryString:function(){try{this.callback(this.fileReader.result,this.URL)}catch(t){this.loadDocumentError(t)}},loadDocumentError:function(t){this.error(t),this.url.length?this.loadDocumentAsync(this.url.shift()):this.callback(null)},error:function(t){"data:"===this.URL.protocol?console.warn("Couldn't load URL 'data':",t.message):console.warn("Couldn't load URL '"+decodeURI(this.URL.href)+"':",t.message)},getReferer:function(){return"X3DWorld"===this.node.getTypeName()&&this.external?this.browser.getLocation():this.executionContext.getWorldURL()},getContentType:function(t){const e=t.getResponseHeader("Content-Type"),n=Sc.exec(e);return n?n[1]:""}});for(const t of Reflect.ownKeys(Cc.prototype))Object.defineProperty(Cc.prototype,t,{enumerable:!1});const Ec=Cc;n.set("x_ite/InputOutput/FileLoader",Ec);const Oc=Ec;Qo.addAbstractType("X3DExternProtoDeclaration",Ic);const Nc=Symbol(),Fc=Symbol();function Ic(t,e){Ir.call(this,t),kr.call(this,t),this.addType(c.X3DExternProtoDeclaration),this.addChildObjects("load",new Ri.SFBool(!0),"url",e.copy(),"autoRefresh",new Ri.SFTime,"autoRefreshTimeLimit",new Ri.SFTime(3600))}Ic.prototype=Object.assign(Object.create(Ir.prototype),kr.prototype,{constructor:Ic,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new Y([new B(c.inputOutput,"metadata",new Ri.SFNode)]),getTypeName:function(){return"X3DExternProtoDeclaration"},initialize:function(){Ir.prototype.initialize.call(this),kr.prototype.initialize.call(this)},set_live__:function(){kr.prototype.set_live__.call(this),this.checkLoadState()===c.COMPLETE_STATE&&this[Fc].setLive(this.isLive().getValue())},canUserDefinedFields:function(){return!0},setProtoDeclaration:function(t){if(this[Nc]=t,t){for(const t of this.getUserDefinedFields())this.removeUserDefinedField(t.getName());for(const e of t.getUserDefinedFields())this.addUserDefinedField(e.getAccessType(),e.getName(),e)}this.updateInstances()},getProtoDeclaration:function(){return this[Nc]},loadNow:function(){this.getScene().addInitLoadCount(this),new Oc(this).createX3DFromURL(this._url,null,this.setInternalSceneAsync.bind(this))},setInternalSceneAsync:function(t){t?this.setInternalScene(t):this.setError(new Error("File could not be loaded.")),this.getScene().removeInitLoadCount(this)},setInternalScene:function(t){this[Fc]=t;const e=decodeURIComponent(new URL(this[Fc].getWorldURL()).hash.substr(1)),n=e?this[Fc].protos.get(e):this[Fc].protos[0];if(!n)throw new Error("PROTO not found");this[Fc].setLive(this.isLive().getValue()),this[Fc].setPrivate(this.getScene().isPrivate()),this[Fc].setExecutionContext(this.getExecutionContext()),this.setLoadState(c.COMPLETE_STATE),this.setProtoDeclaration(n)},getInternalScene:function(){return this[Fc]},setError:function(t){console.error("Error loading extern prototype:",t),this[Fc]=this.getBrowser().getPrivateScene(),this.setLoadState(c.FAILED_STATE),this.setProtoDeclaration(null)},toVRMLStream:function(t){t.string+=t.Indent(),t.string+="EXTERNPROTO",t.string+=t.Space(),t.string+=this.getName(),t.string+=t.TidySpace(),t.string+="[";const e=this.getUserDefinedFields();if(0===e.length)t.string+=t.TidySpace();else{let n=0,i=0;for(const o of e)n=Math.max(n,o.getTypeName().length),i=Math.max(i,t.AccessType(o.getAccessType()).length);t.string+=t.TidyBreak(),t.IncIndent();for(const o of e)this.toVRMLStreamUserDefinedField(t,o,n,i),t.string+=t.Break();t.DecIndent(),t.string+=t.Indent()}t.string+="]",t.string+=t.TidyBreak(),t.string+=t.Indent(),this._url.toVRMLStream(t)},toVRMLStreamUserDefinedField:function(t,e,n,i){t.string+=t.Indent(),t.string+=t.PadRight(t.AccessType(e.getAccessType()),i),t.string+=t.Space(),t.string+=t.PadRight(e.getTypeName(),n),t.string+=t.Space(),t.string+=e.getName()},toXMLStream:function(t){t.string+=t.Indent(),t.string+="<ExternProtoDeclare",t.string+=t.Space(),t.string+="name='",t.string+=t.XMLEncode(this.getName()),t.string+="'",t.string+=t.Space(),t.string+="url='",this._url.toXMLStream(t),t.string+="'",t.string+=">",t.string+=t.TidyBreak(),t.IncIndent();const e=this.getUserDefinedFields();for(const n of e)t.string+=t.Indent(),t.string+="<field",t.string+=t.Space(),t.string+="accessType='",t.string+=t.AccessType(n.getAccessType()),t.string+="'",t.string+=t.Space(),t.string+="type='",t.string+=n.getTypeName(),t.string+="'",t.string+=t.Space(),t.string+="name='",t.string+=t.XMLEncode(n.getName()),t.string+="'",t.string+="/>",t.string+=t.TidyBreak();t.DecIndent(),t.string+=t.Indent(),t.string+="</ExternProtoDeclare>"},toJSONStream:function(t){t.string+=t.Indent(),t.string+="{",t.string+=t.TidySpace(),t.string+='"',t.string+="ExternProtoDeclare",t.string+='"',t.string+=":",t.string+=t.TidyBreak(),t.string+=t.IncIndent(),t.string+=t.Indent(),t.string+="{",t.string+=t.TidyBreak(),t.string+=t.IncIndent(),t.string+=t.Indent(),t.string+='"',t.string+="@name",t.string+='"',t.string+=":",t.string+=t.JSONEncode(this.getName()),t.string+=",",t.string+=t.TidyBreak();const e=this.getUserDefinedFields();if(e.length){t.string+=t.Indent(),t.string+='"',t.string+="field",t.string+='"',t.string+=":",t.string+=t.TidySpace(),t.string+="[",t.string+=t.TidyBreak(),t.string+=t.IncIndent();for(const n of e)t.string+=t.Indent(),t.string+="{",t.string+=t.TidyBreak(),t.string+=t.IncIndent(),t.string+=t.Indent(),t.string+='"',t.string+="@accessType",t.string+='"',t.string+=":",t.string+=t.TidySpace(),t.string+='"',t.string+=t.AccessType(n.getAccessType()),t.string+='"',t.string+=",",t.string+=t.TidyBreak(),t.string+=t.Indent(),t.string+='"',t.string+="@type",t.string+='"',t.string+=":",t.string+=t.TidySpace(),t.string+='"',t.string+=n.getTypeName(),t.string+='"',t.string+=",",t.string+=t.TidyBreak(),t.string+=t.Indent(),t.string+='"',t.string+="@name",t.string+='"',t.string+=":",t.string+=t.TidySpace(),t.string+=t.JSONEncode(n.getName()),t.string+=t.TidyBreak(),t.string+=t.DecIndent(),t.string+=t.Indent(),t.string+="}",n!==e.at(-1)&&(t.string+=","),t.string+=t.TidyBreak();t.string+=t.DecIndent(),t.string+=t.Indent(),t.string+="]",t.string+=",",t.string+=t.TidyBreak()}t.string+=t.Indent(),t.string+='"',t.string+="@url",t.string+='"',t.string+=":",t.string+=t.TidySpace(),this._url.toJSONStream(t),t.string+=t.TidyBreak(),t.string+=t.DecIndent(),t.string+=t.Indent(),t.string+="}",t.string+=t.TidyBreak(),t.string+=t.DecIndent(),t.string+=t.Indent(),t.string+="}"}});for(const t of Reflect.ownKeys(Ic.prototype))Object.defineProperty(Ic.prototype,t,{enumerable:!1});Object.defineProperty(Ic.prototype,"name",{get:function(){return this.getName()},enumerable:!0,configurable:!1}),Object.defineProperty(Ic.prototype,"fields",{get:function(){return this.getFieldDefinitions()},enumerable:!0,configurable:!1}),Object.defineProperty(Ic.prototype,"isExternProto",{get:function(){return!0},enumerable:!0,configurable:!1}),Object.defineProperty(Ic.prototype,"urls",{get:function(){return this._url},enumerable:!0,configurable:!1}),Object.defineProperty(Ic.prototype,"loadState",{get:function(){return this.checkLoadState()},enumerable:!0,configurable:!1});const Mc=Ic;n.set("x_ite/Prototype/X3DExternProtoDeclaration",Mc);const Dc=Mc;function Vc(){return G.call(this)}Vc.prototype=Object.assign(Object.create(G.prototype),{constructor:Vc,getTypeName:function(){return"RouteArray"}});for(const t of Reflect.ownKeys(Vc.prototype))Object.defineProperty(Vc.prototype,t,{enumerable:!1});const Rc=Vc;n.set("x_ite/Routing/RouteArray",Rc);const Pc=Rc,Ac=Symbol(),Lc=Symbol(),Bc=Symbol(),Xc=Symbol(),Uc=Symbol();function kc(t,e,n,i,o){S.call(this,t),this[Ac]=t,this[Lc]=e,this[Bc]=n,this[Xc]=i,this[Uc]=o,n.addFieldInterest(o),n.addOutputRoute(this),o.addInputRoute(this)}kc.prototype=Object.assign(Object.create(S.prototype),{getTypeName:function(){return"X3DRoute"},getExecutionContext:function(){return this[Ac]},getSourceNode:function(){return this[Lc]},getSourceField:function(){return this[Bc]},getDestinationNode:function(){return this[Xc]},getDestinationField:function(){return this[Uc]},disconnect:function(){this[Bc].removeFieldInterest(this[Uc]),this[Bc].removeOutputRoute(this),this[Uc].removeInputRoute(this)},toVRMLStream:function(t){const e=t.LocalName(this[Lc]),n=t.LocalName(this[Xc]);t.string+=t.Indent(),t.string+="ROUTE",t.string+=t.Space(),t.string+=e,t.string+=".",t.string+=this[Bc].getName(),this[Bc].getAccessType()===c.inputOutput&&(t.string+="_changed"),t.string+=t.Space(),t.string+="TO",t.string+=t.Space(),t.string+=n,t.string+=".",this[Uc].getAccessType()===c.inputOutput&&(t.string+="set_"),t.string+=this[Uc].getName()},toXMLStream:function(t){const e=t.LocalName(this[Lc]),n=t.LocalName(this[Xc]);t.string+=t.Indent(),t.string+="<ROUTE",t.string+=t.Space(),t.string+="fromNode='",t.string+=t.XMLEncode(e),t.string+="'",t.string+=t.Space(),t.string+="fromField='",t.string+=t.XMLEncode(this[Bc].getName()),this[Bc].getAccessType()===c.inputOutput&&(t.string+="_changed"),t.string+="'",t.string+=t.Space(),t.string+="toNode='",t.string+=t.XMLEncode(n),t.string+="'",t.string+=t.Space(),t.string+="toField='",this[Uc].getAccessType()===c.inputOutput&&(t.string+="set_"),t.string+=t.XMLEncode(this[Uc].getName()),t.string+="'",t.string+="/>"},toJSONStream:function(t){const e=t.LocalName(this[Lc]),n=t.LocalName(this[Xc]);t.string+=t.Indent(),t.string+="{",t.string+=t.TidySpace(),t.string+='"',t.string+="ROUTE",t.string+='"',t.string+=":",t.string+=t.TidyBreak(),t.string+=t.IncIndent(),t.string+=t.Indent(),t.string+="{",t.string+=t.TidyBreak(),t.string+=t.IncIndent(),t.string+=t.Indent(),t.string+='"',t.string+="@fromNode",t.string+='"',t.string+=":",t.string+=t.TidySpace(),t.string+=t.JSONEncode(e),t.string+=",",t.string+=t.TidyBreak(),t.string+=t.Indent(),t.string+='"',t.string+="@fromField",t.string+='"',t.string+=":",t.string+=t.TidySpace(),t.string+=t.JSONEncode(this[Bc].getName()),t.string+=",",t.string+=t.TidyBreak(),t.string+=t.Indent(),t.string+='"',t.string+="@toNode",t.string+='"',t.string+=":",t.string+=t.TidySpace(),t.string+=t.JSONEncode(n),t.string+=",",t.string+=t.TidyBreak(),t.string+=t.Indent(),t.string+='"',t.string+="@toField",t.string+='"',t.string+=":",t.string+=t.TidySpace(),t.string+=t.JSONEncode(this[Uc].getName()),t.string+=t.TidyBreak(),t.string+=t.DecIndent(),t.string+=t.Indent(),t.string+="}",t.string+=t.TidyBreak(),t.string+=t.DecIndent(),t.string+=t.Indent(),t.string+="}"},dispose:function(){this.disconnect(),this[Ac].deleteRoute(this),S.prototype.dispose.call(this)}});for(const t of Reflect.ownKeys(kc.prototype))Object.defineProperty(kc.prototype,t,{enumerable:!1});Object.defineProperty(kc.prototype,"sourceNode",{get:function(){return mn.get(this[Lc])},enumerable:!0,configurable:!1}),Object.defineProperty(kc.prototype,"sourceField",{get:function(){return this[Bc].getName()},enumerable:!0,configurable:!1}),Object.defineProperty(kc.prototype,"destinationNode",{get:function(){return mn.get(this[Xc])},enumerable:!0,configurable:!1}),Object.defineProperty(kc.prototype,"destinationField",{get:function(){return this[Uc].getName()},enumerable:!0,configurable:!1});const zc=kc;n.set("x_ite/Routing/X3DRoute",zc);const jc=zc;Qo.addAbstractType("X3DExecutionContext",Jc);const Gc=Symbol(),Hc=Symbol(),qc=Symbol(),Yc=Symbol(),Wc=Symbol(),Kc=Symbol();function Jc(t){$i.call(this,t),this.addType(c.X3DExecutionContext),this.addChildObjects("rootNodes",new Ri.MFNode,"worldInfos",new Ri.MFNode,"sceneGraph_changed",new Ri.SFTime,"namedNodes_changed",new Ri.SFTime,"importedNodes_changed",new Ri.SFTime,"protos_changed",new Ri.SFTime,"externprotos_changed",new Ri.SFTime,"routes_changed",new Ri.SFTime),this._rootNodes.setAccessType(c.initializeOnly),this._rootNodes.addCloneCount(1),this[Gc]=new er,this[Hc]=new fr,this[qc]=new wr,this[Yc]=new _r,this[Wc]=new Pc}Jc.prototype=Object.assign(Object.create($i.prototype),{constructor:Jc,initialize:function(){$i.prototype.initialize.call(this),this.isScene()||this._sceneGraph_changed.addInterest("set_sceneGraph",this)},set_sceneGraph:function(){this.getExecutionContext()._sceneGraph_changed=this.getBrowser().getCurrentTime()},isScene:function(){return!1},getTypeName:function(){return"X3DExecutionContext"},[Kc]:null,getOuterNode:function(){return this[Kc]},setOuterNode:function(t){this[Kc]=t},getSpecificationVersion:function(){return this.getExecutionContext().getSpecificationVersion()},getEncoding:function(){return this.getExecutionContext().getEncoding()},getWorldURL:function(){return this.getExecutionContext().getWorldURL()},getProfile:function(){return this.getExecutionContext().getProfile()},getComponents:function(){return this.getExecutionContext().getComponents()},fromUnit:function(t,e){return this.getExecutionContext().fromUnit(t,e)},toUnit:function(t,e){return this.getExecutionContext().toUnit(t,e)},getUnits:function(){return this.getExecutionContext().getUnits()},createNode:function(t,e=!0){if(t=String(t),!1===e){const e=this.getBrowser().getSupportedNode(t);return e?new e(this):null}{const e=this.getBrowser().getSupportedNode(t);if(!e)throw new Error("Unknown node type '"+t+"'.");const n=new e(this);return n.setup(),mn.get(n)}},createProto:function(t,e=!0){t=String(t);let n=this;for(;;){const i=n.protos.get(t);if(i)return i.createInstance(this,e);const o=n.externprotos.get(t);if(o)return o.createInstance(this,e);if(n.isScene())break;n=n.getExecutionContext()}if(!1===e)return null;throw new Error("Unknown proto or externproto type '"+t+"'.")},addNamedNode:function(t,e){if(this[Gc].has(t))throw new Error("Couldn't add named node: node named '"+t+"' is already in use.");this.updateNamedNode(t,e)},updateNamedNode:function(t,e){if(t=String(t),!(e=nu(c.X3DNode,e,!1)))throw new Error("Couldn't update named node: node must be of type X3DNode.");if(e.getExecutionContext()!==this)throw new Error("Couldn't update named node: node does not belong to this execution context.");if(0===t.length)throw new Error("Couldn't update named node: node name is empty.");this.removeNamedNode(e.getName()),this.removeNamedNode(t),e.setName(t),this[Gc].add(t,e),this._namedNodes_changed=this.getBrowser().getCurrentTime()},removeNamedNode:function(t){t=String(t);const e=this[Gc].get(t);e&&(e.setName(""),this[Gc].remove(t),this._namedNodes_changed=this.getBrowser().getCurrentTime())},getNamedNode:function(t){t=String(t);const e=this[Gc].get(t);if(e)return mn.get(e);throw new Error("Named node '"+t+"' not found.")},getNamedNodes:function(){return this[Gc]},getUniqueName:function(t=""){return Zc.call(this,Gc,t)},addImportedNode:function(t,e,n){if(void 0===n&&(n=e),e=String(e),n=String(n),this[Hc].has(n))throw new Error("Couldn't add imported node: imported name '"+n+"' already in use.");this.updateImportedNode(t,e,n)},updateImportedNode:function(t,e,n){if(t=nu(c.Inline,t,!1),e=String(e),n=void 0===n?e:String(n),!t)throw new Error("Node must be of type Inline node.");if(t.getExecutionContext()!==this)throw new Error("Couldn't update imported node: Inline node does not belong to this execution context.");if(0===e.length)throw new Error("Couldn't update imported node: exported name is empty.");if(0===n.length)throw new Error("Couldn't update imported node: imported name is empty.");this.removeImportedNode(n);const i=new hr(this,t,e,n);this[Hc].add(n,i),this._importedNodes_changed=this.getBrowser().getCurrentTime()},removeImportedNode:function(t){t=String(t);const e=this[Hc].get(t);e&&(e.dispose(),this[Hc].remove(t),this._importedNodes_changed=this.getBrowser().getCurrentTime())},getImportedNode:function(t){t=String(t);const e=this[Hc].get(t);if(e)return mn.get(e.getExportedNode());throw new Error("Imported node '"+t+"' not found.")},getImportedNodes:function(){return this[Hc]},getLocalNode:function(t){t=String(t);try{return this.getNamedNode(t)}catch(e){const n=this[Hc].get(t);if(n)return mn.get(n);throw new Error("Unknown named or imported node '"+t+"'.")}},getLocalName:function(t){if(!(t=nu(c.X3DNode,t,!1)))throw new Error("Couldn't get local name: node must be of type X3DNode.");if(t.getExecutionContext()===this)return t.getName();for(const e of this[Hc])try{if(e.getExportedNode()===t)return e.getImportedName()}catch(t){}throw new Error("Couldn't get local name: node is shared.")},setRootNodes:function(){},getRootNodes:function(){return this._rootNodes},getProtoDeclaration:function(t){t=String(t);const e=this[qc].get(t);if(e)return e;throw new Error("Proto declaration '"+t+"' not found.")},addProtoDeclaration(t,e){if(t=String(t),!(e instanceof Rr))throw new Error("Couldn't add proto declaration: proto must be of type X3DProtoDeclaration.");if(this[qc].get(t))throw new Error("Couldn't add proto declaration: proto '"+t+"' already in use.");if(0===(t=String(t)).length)throw new Error("Couldn't add proto declaration: proto name is empty.");this[qc].add(t,e),e.setName(t),this._protos_changed=this.getBrowser().getCurrentTime()},updateProtoDeclaration(t,e){if(t=String(t),!(e instanceof Rr))throw new Error("Couldn't add proto declaration: proto must be of type X3DProtoDeclaration.");if(0===(t=String(t)).length)throw new Error("Couldn't add proto declaration: proto name is empty.");this[qc].update(e.getName(),t,e),e.setName(t),this._protos_changed=this.getBrowser().getCurrentTime()},removeProtoDeclaration(t){t=String(t),this[qc].remove(t),this._protos_changed=this.getBrowser().getCurrentTime()},getProtoDeclarations:function(){return this[qc]},getUniqueProtoName:function(t=""){return Zc.call(this,qc,t)},getExternProtoDeclaration:function(t){t=String(t);const e=this[Yc].get(t);if(e)return e;throw new Error("Extern proto declaration '"+t+"' not found.")},addExternProtoDeclaration(t,e){if(t=String(t),!(e instanceof Dc))throw new Error("Couldn't add extern proto declaration: extern proto must be of type X3DExternProtoDeclaration.");if(this[Yc].get(t))throw new Error("Couldn't add extern proto declaration: extern proto '"+t+"' already in use.");if(0===(t=String(t)).length)throw new Error("Couldn't add extern proto declaration: extern proto name is empty.");this[Yc].add(t,e),e.setName(t),this._externprotos_changed=this.getBrowser().getCurrentTime()},updateExternProtoDeclaration(t,e){if(t=String(t),!(e instanceof Dc))throw new Error("Couldn't add extern proto declaration: extern proto must be of type X3DExternProtoDeclaration.");if(0===(t=String(t)).length)throw new Error("Couldn't add extern proto declaration: extern proto name is empty.");this[Yc].update(e.getName(),t,e),e.setName(t),this._externprotos_changed=this.getBrowser().getCurrentTime()},removeExternProtoDeclaration(t){t=String(t),this[Yc].remove(t),this._externprotos_changed=this.getBrowser().getCurrentTime()},getExternProtoDeclarations:function(){return this[Yc]},getUniqueExternProtoName:function(t=""){return Zc.call(this,Yc,t)},addRoute:function(t,e,n,i){if(t=nu(c.X3DNode,t,!1),e=String(e),n=nu(c.X3DNode,n,!1),i=String(i),!t)throw new Error("Bad ROUTE specification: source node must be of type X3DNode.");if(!n)throw new Error("Bad ROUTE specification: destination node must be of type X3DNode.");let o=t instanceof hr?t:null,r=n instanceof hr?n:null;try{t.getExecutionContext()!==this&&(o=this.getLocalNode(this.getLocalName(t)).getValue())}catch(t){}try{n.getExecutionContext()!==this&&(r=this.getLocalNode(this.getLocalName(n)).getValue())}catch(t){}if(o instanceof hr&&r instanceof hr?(o.addRoute(o,e,r,i),r.addRoute(o,e,r,i)):o instanceof hr?o.addRoute(o,e,n,i):r instanceof hr&&r.addRoute(t,e,r,i),o!==t&&r!==n)return this.addSimpleRoute(t,e,n,i)},addSimpleRoute:function(t,e,n,i){try{if(e=t.getField(e),i=n.getField(i),!e.isOutput())throw new Error("Field named '"+e.getName()+"' in node named '"+t.getName()+"' of type "+t.getTypeName()+" is not an output field.");if(!i.isInput())throw new Error("Field named '"+i.getName()+"' in node named '"+n.getName()+"' of type "+n.getTypeName()+" is not an input field.");if(e.getType()!==i.getType())throw new Error("ROUTE types "+e.getTypeName()+" and "+i.getTypeName()+" do not match.");const o=e.getId()+"."+i.getId();let r=this[Wc].get(o);return r||(r=new jc(this,t,e,n,i),this[Wc].add(o,r),this._routes_changed=this.getBrowser().getCurrentTime(),r)}catch(t){throw new Error("Bad ROUTE specification: "+t.message)}},deleteRoute:function(t){if(4===arguments.length&&!(t=this.getRoute.apply(this,arguments)))return!1;this.deleteSimpleRoute(t)&&this.deleteImportedRoute(t.sourceNode,t.destinationNode,t)},deleteSimpleRoute:function(t){try{const e=t.getSourceField(),n=t.getDestinationField(),i=e.getId()+"."+n.getId();return this[Wc].remove(i),t.disconnect(),this._routes_changed=this.getBrowser().getCurrentTime(),!0}catch(t){return console.error(t),!1}},deleteImportedRoute(t,e,n){let i=null,o=null;try{t.getValue().getExecutionContext()!==this&&(i=this.getLocalNode(this.getLocalName(t)).getValue())}catch(t){}try{e.getValue().getExecutionContext()!==this&&(o=this.getLocalNode(this.getLocalName(e)).getValue())}catch(t){}i instanceof hr&&o instanceof hr?(i.deleteRoute(n),o.deleteRoute(n)):i instanceof hr?i.deleteRoute(n):o instanceof hr&&o.deleteRoute(n)},getRoute:function(t,e,n,i){if(t=nu(c.X3DNode,t,!1),e=String(e),n=nu(c.X3DNode,n,!1),i=String(i),!t)throw new Error("Bad ROUTE specification: sourceNode must be of type X3DNode.");if(!n)throw new Error("Bad ROUTE specification: destinationNode must be of type X3DNode.");e=t.getField(e),i=n.getField(i);const o=e.getId()+"."+i.getId();return this[Wc].get(o)},getRoutes:function(){return this[Wc]},getWorldInfos:function(){return this._worldInfos},addWorldInfo:function(t){this._worldInfos.push(t)},removeWorldInfo:function(t){for(let e=this._worldInfos.length-1;e>=0;--e)this._worldInfos[e].getValue()===t&&this._worldInfos.splice(e,1)},toVRMLStream:function(t){t.PushExecutionContext(this),t.EnterScope(),t.ImportedNodes(this.getImportedNodes()),this.getExternProtoDeclarations().toVRMLStream(t),this.getProtoDeclarations().toVRMLStream(t);const e=this.getRootNodes();for(let n=0,i=e.length;n<i;++n){const o=e[n];t.string+=t.Indent(),o?o.toVRMLStream(t):t.string+="NULL",t.string+=t.TidyBreak(),n!==i-1&&(t.string+=t.TidyBreak())}const n=this.getImportedNodes();n.length&&(t.string+=t.TidyBreak(),n.toVRMLStream(t));const i=this.getRoutes();i.length&&(t.string+=t.TidyBreak(),i.toVRMLStream(t)),t.LeaveScope(),t.PopExecutionContext()},toXMLStream:function(t){t.PushExecutionContext(this),t.EnterScope(),t.ImportedNodes(this.getImportedNodes()),this.getExternProtoDeclarations().toXMLStream(t),this.getProtoDeclarations().toXMLStream(t);const e=this.getRootNodes();e.length&&(e.toXMLStream(t),t.string+=t.TidyBreak()),this.getImportedNodes().toXMLStream(t),this.getRoutes().toXMLStream(t),t.LeaveScope(),t.PopExecutionContext()},toJSONStream:function(t){if(t.PushExecutionContext(this),t.EnterScope(),t.ImportedNodes(this.getImportedNodes()),this.getExternProtoDeclarations().toJSONStream(t,!0),this.getProtoDeclarations().toJSONStream(t,!0),this.getRootNodes().length)for(const e of this.getRootNodes())t.string+=t.Indent(),e?e.toJSONStream(t):(t.string+=t.Indent(),t.string+="null"),t.string+=",",t.string+=t.TidyBreak();this.getImportedNodes().toJSONStream(t,!0),this.getRoutes().toJSONStream(t,!0),t.LeaveScope(),t.PopExecutionContext()},dispose:function(){this._rootNodes.dispose();for(const t of this[Wc])this.deleteRoute(t);$i.prototype.dispose.call(this)}});const Zc=function(){const t=/_\d+$/;return function(e,n=""){let i=n=String(n).replace(t,""),o=64;for(;o&&(this[e].has(i)||0===i.length);){const t=o,e=o<<=1;i=n,i+="_",i+=Math.round(gt.random(t,e))}return i}}();for(const t of Reflect.ownKeys(Jc.prototype))Object.defineProperty(Jc.prototype,t,{enumerable:!1});Object.defineProperty(Jc.prototype,"specificationVersion",{get:function(){return this.getSpecificationVersion()},enumerable:!0,configurable:!1}),Object.defineProperty(Jc.prototype,"encoding",{get:function(){return this.getEncoding()},enumerable:!0,configurable:!1}),Object.defineProperty(Jc.prototype,"profile",{get:function(){return this.getProfile()},enumerable:!0,configurable:!1}),Object.defineProperty(Jc.prototype,"components",{get:function(){return this.getComponents()},enumerable:!0,configurable:!1}),Object.defineProperty(Jc.prototype,"worldURL",{get:function(){return this.getWorldURL()},enumerable:!0,configurable:!1}),Object.defineProperty(Jc.prototype,"units",{get:function(){return this.getUnits()},enumerable:!0,configurable:!1}),Object.defineProperty(Jc.prototype,"rootNodes",{get:function(){return this.getRootNodes()},set:function(t){this.setRootNodes(t)},enumerable:!0,configurable:!1}),Object.defineProperty(Jc.prototype,"protos",{get:function(){return this.getProtoDeclarations()},enumerable:!0,configurable:!1}),Object.defineProperty(Jc.prototype,"externprotos",{get:function(){return this.getExternProtoDeclarations()},enumerable:!0,configurable:!1}),Object.defineProperty(Jc.prototype,"routes",{get:function(){return this.getRoutes()},enumerable:!0,configurable:!1});const Qc=Jc;n.set("x_ite/Execution/X3DExecutionContext",Qc);const $c=Qc,tl={NODE_ENV:"object"==typeof process&&-1!==process.release.name.search(/node|io.js/)};n.set("x_ite/Browser/Networking/Features",tl);const el=tl,nl={getScriptUrl:function(){if(el.NODE_ENV)var t=i.g.require("url").pathToFileURL(__filename).href;else if(document.currentScript)t=document.currentScript.src;else t=document.location.href;return function(){return t}}(),getProviderUrl:function(t){return t?(this.getScriptUrl().match(/\.min\.js$/)&&(t+=".min"),new URL("assets/components/"+t+".js",this.getScriptUrl()).href):"https://create3000.github.io/x_ite/"},getFontsUrl:function(t){return new URL("assets/fonts/"+t,this.getScriptUrl()).href},getLinetypeUrl:function(){return new URL("assets/linetype/linetypes.png",this.getScriptUrl()).href},getHatchingUrl:function(t){return new URL("assets/hatching/"+t+".png",this.getScriptUrl()).href}};n.set("x_ite/Browser/Networking/URLs",nl);const il=nl;var ol=i(603);function rl({name:t,level:e,title:n,providerUrl:i,external:o=!1,dependencies:r=[]}){this.name=t,this.level=e,this.title=n,this.providerUrl=i||il.getProviderUrl(o&&t),ol.data(this,"external",o),ol.data(this,"dependencies",r)}rl.prototype=Object.assign(Object.create(S.prototype),{constructor:rl,getTypeName:function(){return"ComponentInfo"},toVRMLStream:function(t){t.string+="COMPONENT",t.string+=t.Space(),t.string+=this.name,t.string+=t.TidySpace(),t.string+=":",t.string+=t.TidySpace(),t.string+=this.level},toXMLStream:function(t){t.string+=t.Indent(),t.string+="<component",t.string+=t.Space(),t.string+="name='",t.string+=this.name,t.string+="'",t.string+=t.Space(),t.string+="level='",t.string+=this.level,t.string+="'",t.string+="/>"},toJSONStream:function(t){t.string+=t.Indent(),t.string+="{",t.string+=t.TidyBreak(),t.string+=t.IncIndent(),t.string+=t.Indent(),t.string+='"',t.string+="@name",t.string+='"',t.string+=":",t.string+=t.TidySpace(),t.string+='"',t.string+=this.name,t.string+='"',t.string+=",",t.string+=t.TidyBreak(),t.string+=t.Indent(),t.string+='"',t.string+="@level",t.string+='"',t.string+=":",t.string+=t.TidySpace(),t.string+=this.level,t.string+=t.TidyBreak(),t.string+=t.DecIndent(),t.string+=t.Indent(),t.string+="}"}});for(const t of Reflect.ownKeys(rl.prototype))Object.defineProperty(rl.prototype,t,{enumerable:!1});const sl=rl;n.set("x_ite/Configuration/ComponentInfo",sl);const al=sl;function ul(t){return G.call(this,t)}ul.prototype=Object.assign(Object.create(G.prototype),{constructor:ul,getTypeName:function(){return"ComponentInfoArray"},addComponent:function(t){this.add(t.name,new al(t))}});for(const t of Reflect.ownKeys(ul.prototype))Object.defineProperty(ul.prototype,t,{enumerable:!1});const cl=ul;n.set("x_ite/Configuration/ComponentInfoArray",cl);const ll=cl;function hl(t,e,n){Object.defineProperty(this,"category",{value:t,writable:!1}),this.name=e,this.conversionFactor=n}hl.prototype=Object.assign(Object.create(S.prototype),{constructor:hl,getTypeName:function(){return"UnitInfo"},toVRMLStream:function(t){t.string+="UNIT",t.string+=t.Space(),t.string+=this.category,t.string+=t.Space(),t.string+=this.name,t.string+=t.Space(),t.string+=this.conversionFactor},toXMLStream:function(t){t.string+=t.Indent(),t.string+="<unit",t.string+=t.Space(),t.string+="category='",t.string+=this.category,t.string+="'",t.string+=t.Space(),t.string+="name='",t.string+=t.XMLEncode(this.name),t.string+="'",t.string+=t.Space(),t.string+="conversionFactor='",t.string+=this.conversionFactor,t.string+="'",t.string+="/>"},toJSONStream:function(t,e){if(1===this.conversionFactor)throw new Error("conversionFactor is 1");t.string+=t.Indent(),t.string+="{",t.string+=t.TidyBreak(),t.string+=t.IncIndent(),t.string+=t.Indent(),t.string+='"',t.string+="@category",t.string+='"',t.string+=":",t.string+=t.TidySpace(),t.string+='"',t.string+=this.category,t.string+='"',t.string+=",",t.string+=t.TidyBreak(),t.string+=t.Indent(),t.string+='"',t.string+="@name",t.string+='"',t.string+=":",t.string+=t.TidySpace(),t.string+=t.JSONEncode(this.name),t.string+=",",t.string+=t.TidyBreak(),t.string+=t.Indent(),t.string+='"',t.string+="@conversionFactor",t.string+='"',t.string+=":",t.string+=t.TidySpace(),t.string+=t.DoublePrecision(this.conversionFactor),t.string+=t.TidyBreak(),t.string+=t.DecIndent(),t.string+=t.Indent(),t.string+="}"}});for(const t of Reflect.ownKeys(hl.prototype))Object.defineProperty(hl.prototype,t,{enumerable:!1});Object.defineProperty(hl.prototype,"conversion_factor",{get:function(){return this.conversionFactor},enumerable:!1,configurable:!1});const dl=hl;n.set("x_ite/Configuration/UnitInfo",dl);const pl=dl;function fl(t){return G.call(this,t)}fl.prototype=Object.assign(Object.create(G.prototype),{constructor:fl,getTypeName:function(){return"UnitInfoArray"}});for(const t of Reflect.ownKeys(fl.prototype))Object.defineProperty(fl.prototype,t,{enumerable:!1});const gl=fl;n.set("x_ite/Configuration/UnitInfoArray",gl);const ml=gl,_l=Symbol(),xl=Symbol();function yl(t,e){S.call(this),this[_l]=t,this[xl]=e}yl.prototype=Object.assign(Object.create(S.prototype),{constructor:yl,getExportedName:function(){return this[_l]},getLocalNode:function(){return this[xl]},toVRMLStream:function(t){const e=t.LocalName(this[xl]);t.string+=t.Indent(),t.string+="EXPORT",t.string+=t.Space(),t.string+=e,this[_l]!==e&&(t.string+=t.Space(),t.string+="AS",t.string+=t.Space(),t.string+=this[_l])},toXMLStream:function(t){const e=t.LocalName(this[xl]);t.string+=t.Indent(),t.string+="<EXPORT",t.string+=t.Space(),t.string+="localDEF='",t.string+=t.XMLEncode(e),t.string+="'",this[_l]!==e&&(t.string+=t.Space(),t.string+="AS='",t.string+=t.XMLEncode(this[_l]),t.string+="'"),t.string+="/>"},toJSONStream:function(t){const e=t.LocalName(this[xl]);t.string+=t.Indent(),t.string+="{",t.string+=t.TidySpace(),t.string+='"',t.string+="EXPORT",t.string+='"',t.string+=":",t.string+=t.TidyBreak(),t.string+=t.IncIndent(),t.string+=t.Indent(),t.string+="{",t.string+=t.TidyBreak(),t.string+=t.IncIndent(),t.string+=t.Indent(),t.string+='"',t.string+="@localDEF",t.string+='"',t.string+=":",t.string+=t.TidySpace(),t.string+=t.JSONEncode(e),this[_l]!==e?(t.string+=",",t.string+=t.TidyBreak(),t.string+=t.Indent(),t.string+='"',t.string+="@AS",t.string+='"',t.string+=":",t.string+=t.TidySpace(),t.string+=t.JSONEncode(this[_l]),t.string+=t.TidyBreak()):t.string+=t.TidyBreak(),t.string+=t.DecIndent(),t.string+=t.Indent(),t.string+="}",t.string+=t.TidyBreak(),t.string+=t.DecIndent(),t.string+=t.Indent(),t.string+="}"}});for(const t of Reflect.ownKeys(yl.prototype))Object.defineProperty(yl.prototype,t,{enumerable:!1});Object.defineProperty(yl.prototype,"exportedName",{get:function(){return mn.get(this[_l])},enumerable:!0,configurable:!1}),Object.defineProperty(yl.prototype,"localNode",{get:function(){return mn.get(this[xl])},enumerable:!0,configurable:!1});const wl=yl;n.set("x_ite/Execution/X3DExportedNode",wl);const Sl=wl;function Tl(t){return G.call(this,t)}Tl.prototype=Object.assign(Object.create(G.prototype),{constructor:Tl,getTypeName:function(){return"ExportedNodesArray"}});for(const t of Reflect.ownKeys(Tl.prototype))Object.defineProperty(Tl.prototype,t,{enumerable:!1});const bl=Tl;n.set("x_ite/Execution/ExportedNodesArray",bl);const vl=bl;Qo.addAbstractType("X3DScene",Rl);const Cl=Symbol(),El=Symbol(),Ol=Symbol(),Nl=Symbol(),Fl=Symbol(),Il=Symbol(),Ml=Symbol(),Dl=Symbol(),Vl="4.0";function Rl(t){$c.call(this,t),this.addType(c.X3DScene),this.addChildObjects("profile_changed",new Ri.SFTime,"components_changed",new Ri.SFTime,"units_changed",new Ri.SFTime,"metadata_changed",new Ri.SFTime,"exportedNodes_changed",new Ri.SFTime),this[Cl]=Vl,this[El]="SCRIPTED",this[Ol]=null,this[Nl]=new ll([]),this[Fl]=location.toString(),this[Il]=new ml,this[Il].add("angle",new pl("angle","radian",1)),this[Il].add("force",new pl("force","newton",1)),this[Il].add("length",new pl("length","metre",1)),this[Il].add("mass",new pl("mass","kilogram",1)),this[Ml]=new Map,this[Dl]=new vl,this.getRootNodes().setAccessType(c.inputOutput),this.setLive(!1)}Rl.prototype=Object.assign(Object.create($c.prototype),{constructor:Rl,getTypeName:function(){return"X3DScene"},isMainScene:function(){return this===this.getExecutionContext()},isScene:function(){return!0},setSpecificationVersion:function(t){this[Cl]=String(t)},getSpecificationVersion:function(){return this[Cl]},setEncoding:function(t){this[El]=String(t)},getEncoding:function(){return this[El]},setWorldURL:function(t){this[Fl]=String(t)},getWorldURL:function(){return this[Fl]},setProfile:function(t){this[Ol]=t,this._profile_changed=this.getBrowser().getCurrentTime()},getProfile:function(){return this[Ol]},addComponent:function(t){this[Nl].add(t.name,t),this._components_changed=this.getBrowser().getCurrentTime()},removeComponent:function(t){this[Nl].remove(t.name),this._components_changed=this.getBrowser().getCurrentTime()},getComponents:function(){return this[Nl]},updateUnit:function(t,e,n){const i=this[Il].get(t);i&&(i.name=String(e),i.conversionFactor=Number(n),this._units_changed=this.getBrowser().getCurrentTime())},getUnit:function(t){return this[Il].get(t)},getUnits:function(){return this[Il]},fromUnit:function(t,e){switch(t){case"angle":case"force":case"length":case"mass":return e*this.getUnits().get(t).conversionFactor;case"acceleration:":case"speed":return e*this.getUnits().get("length").conversionFactor;case"angularRate":return e*this.getUnits().get("angle").conversionFactor;case"area":return e*Math.pow(this.getUnits().get("length").conversionFactor,2);case"volume":return e*Math.pow(this.getUnits().get("length").conversionFactor,3)}return e},toUnit:function(t,e){switch(t){case"angle":case"force":case"length":case"mass":return e/this.getUnits().get(t).conversionFactor;case"acceleration:":case"speed":return e/this.getUnits().get("length").conversionFactor;case"angularRate":return e/this.getUnits().get("angle").conversionFactor;case"area":return e/Math.pow(this.getUnits().get("length").conversionFactor,2);case"volume":return e/Math.pow(this.getUnits().get("length").conversionFactor,3)}return e},setMetaData:function(t,e){if(!(t=String(t)).length)throw new Error("Couldn't add metadata: name is empty.");if(Array.isArray(e)||(e=[String(e)]),!e.length)throw new Error("Couldn't add metadata: values length is 0.");this[Ml].set(t,e.map((t=>String(t)))),this._metadata_changed=this.getBrowser().getCurrentTime()},addMetaData:function(t,e){if(t=String(t),e=String(e),!t.length)throw new Error("Couldn't add metadata: name is empty.");let n=this[Ml].get(t);n||this[Ml].set(t,n=[]),n.push(e)},removeMetaData:function(t){t=String(t),this[Ml].delete(t),this._metadata_changed=this.getBrowser().getCurrentTime()},getMetaData:function(t){t=String(t);const e=this[Ml].get(t);if(e)return e.slice()},getMetaDatas:function(){return new Map(this[Ml])},addExportedNode:function(t,e){if(t=String(t),this[Dl].has(t))throw new Error("Couldn't add exported node: exported name '"+t+"' already in use.");this.updateExportedNode(t,e),this._exportedNodes_changed=this.getBrowser().getCurrentTime()},updateExportedNode:function(t,e){if(t=String(t),e=nu(c.X3DNode,e,!1),0===t.length)throw new Error("Couldn't update exported node: node exported name is empty.");if(!e)throw new Error("Couldn't update exported node: node must be of type X3DNode.");this.removeExportedNode(t);const n=new Sl(t,e);this[Dl].add(t,n),this._exportedNodes_changed=this.getBrowser().getCurrentTime()},removeExportedNode:function(t){t=String(t),this[Dl].remove(t),this._exportedNodes_changed=this.getBrowser().getCurrentTime()},getExportedNode:function(t){t=String(t);const e=this[Dl].get(t);if(e)return mn.get(e.getLocalNode());throw new Error("Exported node '"+t+"' not found.")},getExportedNodes:function(){return this[Dl]},addRootNode:function(t){t=mn.get(nu(c.X3DNode,t,!1));const e=this.getRootNodes();for(const n of e)if(n.equals(t))return;e.push(t)},removeRootNode:function(t){t=mn.get(nu(c.X3DNode,t,!1));const e=this.getRootNodes(),n=e.length;e.erase(e.remove(0,n,t),n)},setRootNodes:function(t){if(!(t instanceof Ri.MFNode))throw new Error("Value must be of type MFNode.");this.getRootNodes().assign(t)},toVRMLStream:function(t){t.string+="#X3D V",t.string+=Vl,t.string+=t.Space(),t.string+="utf8",t.string+=t.Space(),t.string+=this.getBrowser().name,t.string+=t.Space(),t.string+="V",t.string+=this.getBrowser().version,t.string+=t.ForceBreak(),t.string+=t.ForceBreak();const e=this.getProfile();e&&(e.toVRMLStream(t),t.string+=t.Break(),t.string+=t.TidyBreak());const n=this.getComponents();n.length&&(n.toVRMLStream(t),t.string+=t.TidyBreak());{let e=!0;for(const n of this.getUnits())1!==n.conversionFactor&&(e=!1,n.toVRMLStream(t),t.string+=t.Break());e||(t.string+=t.TidyBreak())}const i=this.getMetaDatas();if(i.size){for(const[e,n]of i.entries())for(const i of n)t.string+="META",t.string+=t.Space(),t.string+=new Ri.SFString(e).toString(),t.string+=t.Space(),t.string+=new Ri.SFString(i).toString(),t.string+=t.Break();t.string+=t.TidyBreak()}const o=this.getExportedNodes();t.PushExecutionContext(this),t.EnterScope(),t.ExportedNodes(o),$c.prototype.toVRMLStream.call(this,t),o.length&&(t.string+=t.TidyBreak(),o.toVRMLStream(t)),t.LeaveScope(),t.PopExecutionContext()},toXMLStream:function(t){if(t.string+='<?xml version="1.0" encoding="UTF-8"?>',t.string+=t.TidyBreak(),t.string+='<!DOCTYPE X3D PUBLIC "ISO//Web3D//DTD X3D ',t.string+=Vl,t.string+='//EN" "http://www.web3d.org/specifications/x3d-',t.string+=Vl,t.string+='.dtd">',t.string+=t.TidyBreak(),t.string+="<X3D",t.string+=t.Space(),t.string+="profile='",t.string+=this.getProfile()?this.getProfile().name:"Full",t.string+="'",t.string+=t.Space(),t.string+="version='",t.string+=Vl,t.string+="'",t.string+=t.Space(),t.string+="xmlns:xsd='http://www.w3.org/2001/XMLSchema-instance'",t.string+=t.Space(),t.string+="xsd:noNamespaceSchemaLocation='http://www.web3d.org/specifications/x3d-",t.string+=Vl,t.string+=".xsd'>",t.string+=t.TidyBreak(),t.IncIndent(),this.getComponents().length||this.getUnits().some((t=>1!==t.conversionFactor))||this.getMetaDatas().size){t.string+=t.Indent(),t.string+="<head>",t.string+=t.TidyBreak(),t.IncIndent(),this.getComponents().toXMLStream(t);for(const e of this.getUnits())1!==e.conversionFactor&&(e.toXMLStream(t),t.string+=t.TidyBreak());for(const[e,n]of this.getMetaDatas().entries())for(const i of n)t.string+=t.Indent(),t.string+="<meta",t.string+=t.Space(),t.string+="name='",t.string+=t.XMLEncode(e),t.string+="'",t.string+=t.Space(),t.string+="content='",t.string+=t.XMLEncode(i),t.string+="'",t.string+="/>",t.string+=t.TidyBreak();t.DecIndent(),t.string+=t.Indent(),t.string+="</head>",t.string+=t.TidyBreak()}if(this.getExternProtoDeclarations().length||this.getProtoDeclarations().length||this.getRootNodes().length){t.string+=t.Indent(),t.string+="<Scene>",t.string+=t.TidyBreak(),t.IncIndent();const e=this.getExportedNodes();t.PushExecutionContext(this),t.EnterScope(),t.ExportedNodes(e),$c.prototype.toXMLStream.call(this,t),e.toXMLStream(t),t.LeaveScope(),t.PopExecutionContext(),t.DecIndent(),t.string+=t.Indent(),t.string+="</Scene>",t.string+=t.TidyBreak()}else t.string+=t.Indent(),t.string+="<Scene/>",t.string+=t.TidyBreak();t.DecIndent(),t.string+="</X3D>",t.string+=t.TidyBreak()},toJSONStream:function(t){t.string+="{",t.string+=t.TidySpace(),t.string+='"',t.string+="X3D",t.string+='"',t.string+=":",t.string+=t.TidySpace(),t.string+="{",t.string+=t.TidyBreak(),t.string+=t.IncIndent(),t.string+=t.IncIndent(),t.string+=t.Indent(),t.string+='"',t.string+="encoding",t.string+='"',t.string+=":",t.string+=t.TidySpace(),t.string+='"',t.string+="UTF-8",t.string+='"',t.string+=",",t.string+=t.TidyBreak(),t.string+=t.Indent(),t.string+='"',t.string+="@profile",t.string+='"',t.string+=":",t.string+=t.TidySpace(),t.string+='"',t.string+=this.getProfile()?this.getProfile().name:"Full",t.string+='"',t.string+=",",t.string+=t.TidyBreak(),t.string+=t.Indent(),t.string+='"',t.string+="@version",t.string+='"',t.string+=":",t.string+=t.TidySpace(),t.string+='"',t.string+=this.getSpecificationVersion(),t.string+='"',t.string+=",",t.string+=t.TidyBreak(),t.string+=t.Indent(),t.string+='"',t.string+="@xsd:noNamespaceSchemaLocation",t.string+='"',t.string+=":",t.string+=t.TidySpace(),t.string+='"',t.string+="http://www.web3d.org/specifications/x3d-",t.string+=Vl,t.string+=".xsd",t.string+='"',t.string+=",",t.string+=t.TidyBreak(),t.string+=t.Indent(),t.string+='"',t.string+="JSON schema",t.string+='"',t.string+=":",t.string+=t.TidySpace(),t.string+='"',t.string+="http://www.web3d.org/specifications/x3d-",t.string+=Vl,t.string+="-JSONSchema.json",t.string+='"',t.string+=",",t.string+=t.TidyBreak();const e=this.getUnits().some((t=>1!==t.conversionFactor));if(this.getComponents().length||e||this.getMetaDatas().size){let n=!1;if(t.string+=t.Indent(),t.string+='"',t.string+="head",t.string+='"',t.string+=":",t.string+=t.TidySpace(),t.string+="{",t.string+=t.TidyBreak(),t.string+=t.IncIndent(),this.getMetaDatas().size){n&&(t.string+=",",t.string+=t.TidyBreak()),t.string+=t.Indent(),t.string+='"',t.string+="meta",t.string+='"',t.string+=":",t.string+=t.TidySpace(),t.string+="[",t.string+=t.TidyBreak(),t.string+=t.IncIndent();for(const[e,[n,i]]of[...this.getMetaDatas()].entries())for(const[o,r]of i.entries())t.string+=t.Indent(),t.string+="{",t.string+=t.TidyBreak(),t.string+=t.IncIndent(),t.string+=t.Indent(),t.string+='"',t.string+="@name",t.string+='"',t.string+=":",t.string+=t.TidySpace(),t.string+=t.JSONEncode(n),t.string+=",",t.string+=t.TidyBreak(),t.string+=t.Indent(),t.string+='"',t.string+="@content",t.string+='"',t.string+=":",t.string+=t.TidySpace(),t.string+=t.JSONEncode(r),t.string+=t.TidyBreak(),t.string+=t.DecIndent(),t.string+=t.Indent(),t.string+="}",e===this.getMetaDatas().size-1&&o===i.length-1||(t.string+=","),t.string+=t.TidyBreak();t.string+=t.DecIndent(),t.string+=t.Indent(),t.string+="]",n=!0}this.getComponents().length&&(n&&(t.string+=",",t.string+=t.TidyBreak()),t.string+=t.Indent(),t.string+='"',t.string+="component",t.string+='"',t.string+=":",t.string+=t.TidySpace(),t.string+="[",t.string+=t.TidyBreak(),t.string+=t.IncIndent(),this.getComponents().toJSONStream(t),t.string+=t.DecIndent(),t.string+=t.Indent(),t.string+="]",n=!0),e&&(n&&(t.string+=",",t.string+=t.TidyBreak()),t.string+=t.Indent(),t.string+='"',t.string+="unit",t.string+='"',t.string+=":",t.string+=t.TidySpace(),t.string+="[",t.string+=t.TidyBreak(),t.string+=t.IncIndent(),this.getUnits().toJSONStream(t),t.string+=t.DecIndent(),t.string+=t.Indent(),t.string+="]",n=!0),t.string+=t.TidyBreak(),t.string+=t.DecIndent(),t.string+=t.Indent(),t.string+="}",t.string+=",",t.string+=t.TidyBreak()}t.string+=t.Indent(),t.string+='"',t.string+="Scene",t.string+='"',t.string+=":",t.string+=t.TidySpace(),t.string+="{",t.string+=t.TidyBreak(),t.string+=t.IncIndent(),t.string+=t.Indent(),t.string+='"',t.string+="-children",t.string+='"',t.string+=":",t.string+=t.TidySpace(),t.string+="[",t.string+=t.TidyBreak(),t.string+=t.IncIndent();const n=this.getExportedNodes();t.PushExecutionContext(this),t.EnterScope(),t.ExportedNodes(n),$c.prototype.toJSONStream.call(this,t),this.getExportedNodes().toJSONStream(t,!0),t.string=t.string.replace(/,(\s*)$/s,"$1"),t.LeaveScope(),t.PopExecutionContext(),t.string+=t.DecIndent(),t.string+=t.Indent(),t.string+="]",t.string+=t.TidyBreak(),t.string+=t.DecIndent(),t.string+=t.Indent(),t.string+="}",t.string+=t.TidyBreak(),t.string+=t.DecIndent(),t.string+=t.Indent(),t.string+="}",t.string+=t.TidyBreak(),t.string+=t.DecIndent(),t.string+=t.Indent(),t.string+="}",t.string+=t.TidyBreak()}});for(const t of Reflect.ownKeys(Rl.prototype))Object.defineProperty(Rl.prototype,t,{enumerable:!1});const Pl=Rl;n.set("x_ite/Execution/X3DScene",Pl);const Al=Pl,Ll=Symbol.for("X3DEventObject.browser"),Bl=Symbol();function Xl(t){this[Ll]=t,Al.call(this,this),this.addChildObjects("initLoadCount",new Ri.SFInt32,"loadCount",new Ri.SFInt32),this[Bl]=new Set}Xl.prototype=Object.assign(Object.create(Al.prototype),{constructor:Xl,setExecutionContext:function(t){if(!this.isMainScene()){const t=this.getScene();for(const e of this[Bl])t.removeLoadingObject(e)}if(Al.prototype.setExecutionContext.call(this,t),!this.isMainScene()){const t=this.getScene();for(const e of this[Bl])t.addLoadingObject(e)}},addInitLoadCount:function(t){this._initLoadCount=this._initLoadCount.getValue()+1},removeInitLoadCount:function(t){this._initLoadCount=this._initLoadCount.getValue()-1},getLoadingObjects:function(){return this[Bl]},addLoadingObject:function(t){if(this[Bl].has(t))return;this[Bl].add(t),this._loadCount=this[Bl].size;const e=this.getBrowser(),n=this.getScene();this!==e.getExecutionContext()&&this.loader!==e.loader||e.addLoadingObject(t),this.isMainScene()||n.addLoadingObject(t)},removeLoadingObject:function(t){if(!this[Bl].has(t))return;this[Bl].delete(t),this._loadCount=this[Bl].size;const e=this.getBrowser(),n=this.getScene();this!==e.getExecutionContext()&&this.loader!==e.loader||e.removeLoadingObject(t),this.isMainScene()||n.removeLoadingObject(t)}});for(const t of Reflect.ownKeys(Xl.prototype))Object.defineProperty(Xl.prototype,t,{enumerable:!1});const Ul=Xl;n.set("x_ite/Execution/Scene",Ul);const kl=Ul,zl=new WeakMap,jl=new WeakMap,Gl=new WeakMap,Hl={get:function(t,e){const n=t[e];if(void 0!==n)return n;const i=t.getStorage()[t.getNameSpace()+e];if(void 0===i||"undefined"===i||null===i)return t.getDefaultValue(e);return JSON.parse(i)},set:function(t,e,n){return void 0===n?t.getStorage().removeItem(t.getNameSpace()+e):t.getStorage()[t.getNameSpace()+e]=JSON.stringify(n),!0}};function ql(t,e){return this.target=this,zl.set(this,t),jl.set(this,e),Gl.set(this,{}),new Proxy(this,Hl)}ql.prototype={constructor:ql,getStorage:function(){return zl.get(this.target)},getNameSpace:function(){return jl.get(this.target)},addNameSpace:function(t){return new ql(this.getStorage(),this.getNameSpace()+t)},addDefaultValues:function(t){Object.assign(Gl.get(this.target),t)},getDefaultValue(t){const e=Gl.get(this.target)[t];return void 0===e?void 0:JSON.parse(JSON.stringify(e))},clear:function(){const t=this.getStorage(),e=this.getNameSpace();for(const n of Object.keys(t))n.startsWith(e)&&t.removeItem(n)}};const Yl=ql;n.set("standard/Utility/DataStorage",Yl);const Wl=Yl;var Kl=i(603);const Jl=Symbol(),Zl=Symbol(),Ql=Symbol(),$l=Symbol(),th=Symbol(),eh=Symbol(),nh=Symbol(),ih=Symbol(),oh=Symbol(),rh=Symbol(),sh=Symbol(),ah=Symbol(),uh=Symbol(),ch=Symbol(),lh=Symbol(),hh=Symbol(),dh=Symbol(),ph=Symbol(),fh=Symbol();let gh=0;function mh(t){const e=t.data("shadow"),n=Kl("<div></div>").addClass("x_ite-private-browser").attr("tabindex",0),i=Kl("<div></div>").addClass("x_ite-private-surface").appendTo(n),o=Kl("<div></div>").hide().addClass("x_ite-private-splash-screen").appendTo(n),r=(Kl("<div></div>").addClass("x_ite-private-spinner").appendTo(o),Kl("<div></div>").addClass("x_ite-private-progress").appendTo(o));Kl("<div></div>").addClass("x_ite-private-x_ite").html(this.getName()+"<span class='x_ite-private-x3d'>X3D</span>").appendTo(r),Kl("<div></div>").addClass("x_ite-private-progressbar").appendTo(r).append(Kl("<div></div>")),Kl("<div></div>").addClass("x_ite-private-spinner-text").appendTo(r),this[Jl]=++gh,this[Zl]=t,this[Ql]=e?e.append(n.hide()):this[Zl].prepend(n),this[$l]=i,this[th]=Kl("<canvas></canvas>").addClass("x_ite-private-canvas").prependTo(i),this[eh]=ro.create(this[th][0],2,"true"===t.attr("preserveDrawingBuffer")),this[nh]=o,e&&t.data("loaded").then((function(){n.show()})),this[ih]=new Wl(localStorage,"X_ITE.X3DBrowser("+this[Jl]+")."),this[oh]=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent),this[rh]=new yo(this.getPrivateScene()),this[sh]=new Mo(this.getPrivateScene()),this[ah]=new Ro(this.getPrivateScene()),this[uh]=new Lo(this.getPrivateScene()),this[ch]=new ko(this.getPrivateScene()),this[lh]=new qo(this.getPrivateScene()),this[fh]=1,this.addChildObjects("controlKey",new Ri.SFBool,"shiftKey",new Ri.SFBool,"altKey",new Ri.SFBool,"altGrKey",new Ri.SFBool)}mh.prototype={initialize:function(){this[rh].setup(),this[sh].setup(),this[ah].setup(),this[uh].setup(),this[ch].setup(),this[lh].setup(),Object.defineProperty(this.getElement().get(0),"src",{get:function(){return this.getExecutionContext().getWorldURL()}.bind(this),set:function(t){this.loadURL(new Ri.MFString(t),new Ri.MFString)}.bind(this),enumerable:!0,configurable:!1}),Object.defineProperty(this.getElement().get(0),"url",{get:function(){return new Ri.MFString(this.getExecutionContext().getWorldURL())}.bind(this),set:function(t){this.loadURL(t,new Ri.MFString)}.bind(this),enumerable:!0,configurable:!1}),this.getElement().on("keydown.X3DCoreContext",this[dh].bind(this)),this.getElement().on("keyup.X3DCoreContext",this[ph].bind(this))},getDebug:function(){return this.getBrowserOptions().getDebug()},getInstanceId:function(){return this[Jl]},isStrict:function(){return!1},getElement:function(){return this[Zl]},getShadow:function(){return this[Ql]},getSurface:function(){return this[$l]},getSplashScreen:function(){return this[nh]},getCanvas:function(){return this[th]},getContext:function(){return this[eh]},getMobile:function(){return this[oh]},getLocalStorage:function(){return this[ih]},getBrowserTimings:function(){return this[rh]},getBrowserOptions:function(){return this[sh]},getBrowserProperties:function(){return this[ah]},getRenderingProperties:function(){return this[uh]},getNotification:function(){return this[ch]},getContextMenu:function(){return this[lh]},getPrivateScene:function(){return this[hh]||(this[hh]=new kl(this),this[hh].setPrivate(!0),this[hh].setLive(!0),this[hh].setup()),this[hh]},getPixelPerPoint:function(){return this[fh]},connectedCallback:function(){const t=Kl("<div></div>").hide().css("height","10in").appendTo(this[Ql]);this[fh]=t.height()/720||1,t.remove()},attributeChangedCallback:function(t,e,n){switch(t.toLowerCase()){case"splashscreen":"true"!==n.toLowerCase()&&(this.getCanvas().show(),this.getSplashScreen().stop(!0,!0).hide());break;case"src":this.loadURL(new Ri.MFString(n),new Ri.MFString);break;case"url":this.loadURL(this.parseUrlAttribute(n),new Ri.MFString)}},parseUrlAttribute:function(t){const e=new Ri.MFString;return e.fromString("["+t+"]",this.getExecutionContext()),e},callBrowserEventHandler:function(t){const e=window.jQuery?window.jQuery(this.getElement().get(0)):this.getElement();for(const n of t.split(" "))e.trigger(n)},getShiftKey:function(){return this._shiftKey.getValue()},getControlKey:function(){return this._controlKey.getValue()},getAltKey:function(){return this._altKey.getValue()},getAltGrKey:function(){return this._altGrKey.getValue()},[dh]:function(t){switch(t.keyCode){case 16:this._shiftKey=!0;break;case 17:this._controlKey=!0;break;case 18:this._altKey=!0;break;case 49:this.getDebug()&&this.getControlKey()&&(t.preventDefault(),this.setBrowserOption("Shading","POINT"),this.getNotification()._string="Shading: Pointset");break;case 50:this.getDebug()&&this.getControlKey()&&(t.preventDefault(),this.setBrowserOption("Shading","WIREFRAME"),this.getNotification()._string="Shading: Wireframe");break;case 51:this.getDebug()&&this.getControlKey()&&(t.preventDefault(),this.setBrowserOption("Shading","FLAT"),this.getNotification()._string="Shading: Flat");break;case 52:this.getDebug()&&this.getControlKey()&&(t.preventDefault(),this.setBrowserOption("Shading","GOURAUD"),this.getNotification()._string="Shading: Gouraud");break;case 53:this.getDebug()&&this.getControlKey()&&(t.preventDefault(),this.setBrowserOption("Shading","PHONG"),this.getNotification()._string="Shading: Phong");break;case 83:this.getDebug()&&this.getControlKey()&&(t.preventDefault(),this.isLive().getValue()?this.endUpdate():this.beginUpdate(),this.getNotification()._string=this.isLive().getValue()?"Begin Update":"End Update");break;case 225:this._altGrKey=!0;break;case 171:case 187:this.getControlKey()&&(t.preventDefault(),this.setBrowserOption("Timings",!this.getBrowserOption("Timings")));break;case 36:t.preventDefault(),this.firstViewpoint();break;case 35:t.preventDefault(),this.lastViewpoint();break;case 33:t.preventDefault(),this.previousViewpoint();break;case 34:t.preventDefault(),this.nextViewpoint();break;case 119:if(this.getShiftKey()){t.preventDefault();const e=this.getActiveViewpoint();if(!e)break;const n=this.getPrivateScene().createNode(e.getTypeName());switch(e.getTypeName()){case"Viewpoint":n.position=e.getUserPosition(),n.orientation=e.getUserOrientation(),n.centerOfRotation=e.getUserCenterOfRotation(),n.fieldOfView=e.getFieldOfView();break;case"OrthoViewpoint":n.position=e.getUserPosition(),n.orientation=e.getUserOrientation(),n.centerOfRotation=e.getUserCenterOfRotation(),n.fieldOfView=new Ri.MFFloat(e.getMinimumX(),e.getMinimumY(),e.getMaximumX(),e.getMaximumY());break;case"GeoViewpoint":{const t=e._geoOrigin,i=new xe(0,0,0);if(t.getValue()&&"GeoOrigin"===t.getNodeTypeName()){const e=this.getPrivateScene().createNode("GeoOrigin");n.geoOrigin=e,e.geoSystem=t.geoSystem,e.geoCoords=t.geoCoords,e.rotateYUp=t.rotateYUp}n.geoSystem=e._geoSystem,n.position=e.getGeoCoord(e.getUserPosition(),i),n.orientation=e.getUserOrientation(),n.centerOfRotation=e.getGeoCoord(e.getUserCenterOfRotation(),i),n.fieldOfView=e.getFieldOfView();break}}let i;switch(this.getExecutionContext().getEncoding()){case"ASCII":case"VRML":i=n.toVRMLString();break;case"JSON":i=n.toJSONString();break;default:i=n.toXMLString()}i+="\n",this.copyToClipboard(i),this.getNotification()._string=fo("Viewpoint is copied to clipboard."),console.log("Copied Viewpoint to Clipboard."),console.debug(i)}}},[ph]:function(t){switch(t.which){case 16:this._shiftKey=!1;break;case 17:this._controlKey=!1;break;case 18:this._altKey=!1;break;case 225:this._altGrKey=!1}},copyToClipboard:function(t){const e=Kl("<textarea></textarea>");this.getShadow().find(".x_ite-private-browser").prepend(e),e.text(t).select(),document.execCommand("copy"),e.remove()}};const _h=mh;n.set("x_ite/Browser/Core/X3DCoreContext",_h);const xh=_h;function yh(t){or.call(this,t),this.addType(c.TextureProperties),t.getSpecificationVersion()<4&&(this._minificationFilter="DEFAULT",this._magnificationFilter="DEFAULT",this._textureCompression="DEFAULT")}yh.prototype=Object.assign(Object.create(or.prototype),{constructor:yh,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new Y([new B(c.inputOutput,"metadata",new Ri.SFNode),new B(c.inputOutput,"borderColor",new Ri.SFColorRGBA),new B(c.inputOutput,"borderWidth",new Ri.SFInt32),new B(c.inputOutput,"anisotropicDegree",new Ri.SFFloat(1)),new B(c.initializeOnly,"generateMipMaps",new Ri.SFBool),new B(c.inputOutput,"minificationFilter",new Ri.SFString("FASTEST")),new B(c.inputOutput,"magnificationFilter",new Ri.SFString("FASTEST")),new B(c.inputOutput,"boundaryModeS",new Ri.SFString("REPEAT")),new B(c.inputOutput,"boundaryModeT",new Ri.SFString("REPEAT")),new B(c.inputOutput,"boundaryModeR",new Ri.SFString("REPEAT")),new B(c.inputOutput,"textureCompression",new Ri.SFString("FASTEST")),new B(c.inputOutput,"texturePriority",new Ri.SFFloat)]),getTypeName:function(){return"TextureProperties"},getComponentName:function(){return"Texturing"},getContainerField:function(){return"textureProperties"},getBorderWidth:function(){return gt.clamp(this._borderWidth.getValue(),0,1)},getBoundaryMode:function(){const t=new Map([["CLAMP","CLAMP_TO_EDGE"],["CLAMP_TO_EDGE","CLAMP_TO_EDGE"],["CLAMP_TO_BOUNDARY","CLAMP_TO_EDGE"],["MIRRORED_REPEAT","MIRRORED_REPEAT"],["REPEAT","REPEAT"]]);return function(e){const n=t.get(e);return void 0!==n?n:"REPEAT"}}(),getBoundaryModeS:function(){return this.getBoundaryMode(this._boundaryModeS.getValue())},getBoundaryModeT:function(){return this.getBoundaryMode(this._boundaryModeT.getValue())},getBoundaryModeR:function(){return this.getBoundaryMode(this._boundaryModeR.getValue())},getMinificationFilter:function(){const t=new Map([["AVG_PIXEL_AVG_MIPMAP","LINEAR_MIPMAP_LINEAR"],["AVG_PIXEL","LINEAR"],["AVG_PIXEL_NEAREST_MIPMAP","LINEAR_MIPMAP_NEAREST"],["NEAREST_PIXEL_AVG_MIPMAP","NEAREST_MIPMAP_LINEAR"],["NEAREST_PIXEL_NEAREST_MIPMAP","NEAREST_MIPMAP_NEAREST"],["NEAREST_PIXEL","NEAREST"],["NICEST","LINEAR_MIPMAP_LINEAR"],["FASTEST","NEAREST"]]);return function(){if(this._generateMipMaps.getValue()){const e=t.get(this._minificationFilter.getValue());return void 0!==e?e:this.getBrowser().getDefaultTextureProperties().getMinificationFilter()}return"LINEAR"}}(),getMagnificationFilter:function(){const t=new Map([["AVG_PIXEL","LINEAR"],["NEAREST_PIXEL","NEAREST"],["NICEST","LINEAR"],["FASTEST","NEAREST"]]);return function(){const e=t.get(this._magnificationFilter.getValue());return void 0!==e?e:this.getBrowser().getDefaultTextureProperties().getMagnificationFilter()}}(),getTextureCompression:function(){const t=new Map([["DEFAULT","RGBA"],["NICEST","RGBA"],["FASTEST","RGBA"],["LOW","RGBA"],["MEDIUM","RGBA"],["HIGH","RGBA"]]);return function(){const e=this.getBrowser().getContext(),n=e.getExtension("WEBGL_compressed_texture_etc"),i=n?n[t.get(this._textureCompression.getValue())]:void 0;return void 0!==i?i:e.RGBA}}()});const wh=yh;n.set("x_ite/Components/Texturing/TextureProperties",wh);const Sh=wh,Th=Symbol();function bh(){}bh.prototype={initialize:function(){},getBackgroundTextureProperties:function(){return this[Th]=new Sh(this.getPrivateScene()),this[Th]._boundaryModeS="CLAMP_TO_EDGE",this[Th]._boundaryModeT="CLAMP_TO_EDGE",this[Th]._boundaryModeR="CLAMP_TO_EDGE",this[Th]._minificationFilter="NICEST",this[Th]._magnificationFilter="NICEST",this[Th]._textureCompression="DEFAULT",this[Th].setup(),this.getBackgroundTextureProperties=function(){return this[Th]},Object.defineProperty(this,"getBackgroundTextureProperties",{enumerable:!1}),this[Th]}};const vh=bh;n.set("x_ite/Browser/EnvironmentalEffects/X3DEnvironmentalEffectsContext",vh);const Ch=vh;function Eh(t){Pa.call(this,t),this.addType(c.X3DComposedGeometryNode),this.fogCoordNode=null,this.colorNode=null,this.texCoordNode=null,this.normalNode=null,this.coordNode=null}Eh.prototype=Object.assign(Object.create(Pa.prototype),{constructor:Eh,initialize:function(){Pa.prototype.initialize.call(this),this._attrib.addInterest("set_attrib__",this),this._fogCoord.addInterest("set_fogCoord__",this),this._color.addInterest("set_color__",this),this._texCoord.addInterest("set_texCoord__",this),this._normal.addInterest("set_normal__",this),this._coord.addInterest("set_coord__",this),this.set_attrib__(),this.set_fogCoord__(),this.set_color__(),this.set_texCoord__(),this.set_normal__(),this.set_coord__()},getFogCoord:function(){return this.fogCoordNode},getColor:function(){return this.colorNode},getTexCoord:function(){return this.texCoordNode},getNormal:function(){return this.normalNode},getCoord:function(){return this.coordNode},set_attrib__:function(){const t=this.getAttrib();for(const e of t)e.removeInterest("requestRebuild",this),e._attribute_changed.removeInterest("updateVertexArrays",this);t.length=0;for(const e of this._attrib){const n=nu(c.X3DVertexAttributeNode,e);n&&t.push(n)}for(const e of t)e.addInterest("requestRebuild",this),e._attribute_changed.addInterest("updateVertexArrays",this);this.updateVertexArrays()},set_fogCoord__:function(){this.fogCoordNode&&this.fogCoordNode.removeInterest("requestRebuild",this),this.fogCoordNode=nu(c.FogCoordinate,this._fogCoord),this.fogCoordNode&&this.fogCoordNode.addInterest("requestRebuild",this)},set_color__:function(){this.colorNode&&(this.colorNode.removeInterest("requestRebuild",this),this.colorNode._transparent.removeInterest("set_transparent__",this)),this.colorNode=nu(c.X3DColorNode,this._color),this.colorNode?(this.colorNode.addInterest("requestRebuild",this),this.colorNode._transparent.addInterest("set_transparent__",this),this.set_transparent__()):this.setTransparent(!1)},set_transparent__:function(){this.setTransparent(this.colorNode.getTransparent())},set_texCoord__:function(){this.texCoordNode&&this.texCoordNode.removeInterest("requestRebuild",this),this.texCoordNode=nu(c.X3DTextureCoordinateNode,this._texCoord),this.texCoordNode&&this.texCoordNode.addInterest("requestRebuild",this),this.setTextureCoordinate(this.texCoordNode)},set_normal__:function(){this.normalNode&&this.normalNode.removeInterest("requestRebuild",this),this.normalNode=nu(c.X3DNormalNode,this._normal),this.normalNode&&this.normalNode.addInterest("requestRebuild",this)},set_coord__:function(){this.coordNode&&this.coordNode.removeInterest("requestRebuild",this),this.coordNode=nu(c.X3DCoordinateNode,this._coord),this.coordNode&&this.coordNode.addInterest("requestRebuild",this)},getPolygonIndex:function(t){return t},getTriangleIndex:function(t){return t},build:function(t,e,n,i){if(!this.coordNode||this.coordNode.isEmpty())return;e-=e%t,i-=i%n;const o=this._colorPerVertex.getValue(),r=this._normalPerVertex.getValue(),s=this.getAttrib(),a=s.length,u=this.getAttribs(),c=this.getFogCoord(),l=this.getColor(),h=this.getTexCoord(),d=this.getNormal(),p=this.getCoord(),f=this.getFogDepths(),g=this.getColors(),m=this.getMultiTexCoords(),_=this.getNormals(),x=this.getVertices();h&&h.init(m);for(let t=0;t<i;++t){const e=Math.floor(t/n),i=this.getPolygonIndex(this.getTriangleIndex(t));for(let t=0;t<a;++t)s[t].addValue(i,u[t]);c&&c.addDepth(i,f),l&&(o?l.addColor(i,g):l.addColor(e,g)),h&&h.addTexCoord(i,m),d&&(r?d.addVector(i,_):d.addVector(e,_)),p.addPoint(i,x)}this.getNormal()||this.buildNormals(t,e,i),this.setSolid(this._solid.getValue()),this.setCCW(this._ccw.getValue())},buildNormals:function(t,e,n){const i=this.createNormals(t,e),o=this.getNormals();for(let t=0;t<n;++t){const e=i[this.getTriangleIndex(t)];o.push(e.x,e.y,e.z)}},createNormals:function(t,e){const n=this.createFaceNormals(t,e);if(this._normalPerVertex.getValue()){const t=[];for(let n=0;n<e;++n){const e=this.getPolygonIndex(n);let i=t[e];i||(i=t[e]=[]),i.push(n)}return this.refineNormals(t,n,Math.PI)}return n},createFaceNormals:function(t,e){const n=!this._ccw.getValue(),i=this.coordNode,o=[];for(let r=0;r<e;r+=t){const e=this.getPolygonNormal(r,t,i);n&&e.negate();for(let n=0;n<t;++n)o.push(e)}return o},getPolygonNormal:function(){let t=new xe(0,0,0),e=new xe(0,0,0);return function(n,i,o){const r=new xe(0,0,0);o.get1Point(this.getPolygonIndex(n),e);for(let s=0;s<i;++s){const a=t;t=e,e=a,o.get1Point(this.getPolygonIndex(n+(s+1)%i),e),r.x+=(t.y-e.y)*(t.z+e.z),r.y+=(t.z-e.z)*(t.x+e.x),r.z+=(t.x-e.x)*(t.y+e.y)}return r.normalize()}}()});const Oh=Eh;n.set("x_ite/Components/Rendering/X3DComposedGeometryNode",Oh);const Nh=Oh;function Fh(t){Nh.call(this,t),this.addType(c.IndexedFaceSet),this._creaseAngle.setUnit("angle")}Fh.prototype=Object.assign(Object.create(Nh.prototype),{constructor:Fh,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new Y([new B(c.inputOutput,"metadata",new Ri.SFNode),new B(c.inputOnly,"set_colorIndex",new Ri.MFInt32),new B(c.inputOnly,"set_texCoordIndex",new Ri.MFInt32),new B(c.inputOnly,"set_normalIndex",new Ri.MFInt32),new B(c.inputOnly,"set_coordIndex",new Ri.MFInt32),new B(c.initializeOnly,"solid",new Ri.SFBool(!0)),new B(c.initializeOnly,"ccw",new Ri.SFBool(!0)),new B(c.initializeOnly,"convex",new Ri.SFBool(!0)),new B(c.initializeOnly,"creaseAngle",new Ri.SFFloat),new B(c.initializeOnly,"colorPerVertex",new Ri.SFBool(!0)),new B(c.initializeOnly,"normalPerVertex",new Ri.SFBool(!0)),new B(c.initializeOnly,"colorIndex",new Ri.MFInt32),new B(c.initializeOnly,"texCoordIndex",new Ri.MFInt32),new B(c.initializeOnly,"normalIndex",new Ri.MFInt32),new B(c.initializeOnly,"coordIndex",new Ri.MFInt32),new B(c.inputOutput,"attrib",new Ri.MFNode),new B(c.inputOutput,"fogCoord",new Ri.SFNode),new B(c.inputOutput,"color",new Ri.SFNode),new B(c.inputOutput,"texCoord",new Ri.SFNode),new B(c.inputOutput,"normal",new Ri.SFNode),new B(c.inputOutput,"coord",new Ri.SFNode)]),getTypeName:function(){return"IndexedFaceSet"},getComponentName:function(){return"Geometry3D"},getContainerField:function(){return"geometry"},initialize:function(){Nh.prototype.initialize.call(this),this._set_colorIndex.addFieldInterest(this._colorIndex),this._set_texCoordIndex.addFieldInterest(this._texCoordIndex),this._set_normalIndex.addFieldInterest(this._normalIndex),this._set_coordIndex.addFieldInterest(this._coordIndex)},getTexCoordPerVertexIndex:function(t){return t<this._texCoordIndex.length?this._texCoordIndex[t]:this._coordIndex[t]},getColorPerVertexIndex:function(t){return t<this._colorIndex.length?this._colorIndex[t]:this._coordIndex[t]},getColorIndex:function(t){return t<this._colorIndex.length?this._colorIndex[t]:t},getNormalPerVertexIndex:function(t){return t<this._normalIndex.length?this._normalIndex[t]:this._coordIndex[t]},getNormalIndex:function(t){return t<this._normalIndex.length?this._normalIndex[t]:t},build:function(){const t=this.triangulate();if(0===t.length)return;const e=this._colorPerVertex.getValue(),n=this._normalPerVertex.getValue(),i=this._coordIndex.getValue(),o=this.getAttrib(),r=o.length,s=this.getAttribs(),a=this.getFogCoord(),u=this.getColor(),c=this.getTexCoord(),l=this.getNormal(),h=this.getCoord(),d=this.getFogDepths(),p=this.getColors(),f=this.getMultiTexCoords(),g=this.getNormals(),m=this.getVertices();c&&c.init(f);for(const _ of t){const t=_.triangles,x=_.face;for(const _ of t){const t=i[_];for(let e=0;e<r;++e)o[e].addValue(t,s[e]);a&&a.addDepth(t,d),u&&(e?u.addColor(this.getColorPerVertexIndex(_),p):u.addColor(this.getColorIndex(x),p)),c&&c.addTexCoord(this.getTexCoordPerVertexIndex(_),f),l&&(n?l.addVector(this.getNormalPerVertexIndex(_),g):l.addVector(this.getNormalIndex(x),g)),h.addPoint(t,m)}}this.getNormal()||this.buildNormals(t),this.setSolid(this._solid.getValue()),this.setCCW(this._ccw.getValue())},triangulate:function(){const t=this._convex.getValue(),e=this._coordIndex.length,n=[];if(!this.getCoord())return n;if(e&&this._coordIndex[e-1]>-1&&this._coordIndex.push(-1),e){const e=this._coordIndex.getValue(),i=this._coordIndex.length;let o=[];for(let r=0,s=0;r<i;++r){if(e[r]>-1)o.push(r);else{if(o.length)switch(o.length){case 0:case 1:case 2:o.length=0;break;case 3:n.push({vertices:o,triangles:o,face:s}),o=[];break;default:{const e=[],i={vertices:o,triangles:e,face:s};t?this.triangulateConvexPolygon(o,e):this.triangulatePolygon(o,e),e.length<3?o.length=0:(n.push(i),o=[]);break}}++s}}}return n},triangulatePolygon:function(){const t=[];return function(e,n){const i=this._coordIndex.getValue(),o=this.getCoord(),r=e.length;for(let n=0;n<r;++n){const r=e[n];let s=t[n];s||(s=t[n]=new xe(0,0,0)),s.index=r,o.get1Point(i[r],s)}t.length=r,vs.triangulatePolygon(t,n);for(let t=0,e=n.length;t<e;++t)n[t]=n[t].index}}(),triangulateConvexPolygon:function(t,e){for(let n=1,i=t.length-1;n<i;++n)e.push(t[0],t[n],t[n+1])},buildNormals:function(t){const e=this.createNormals(t),n=this.getNormals();for(const i of t)for(const t of i.triangles){const i=e[t];n.push(i.x,i.y,i.z)}},createNormals:function(){const t=[],e=[];return function(n){const i=!this._ccw.getValue(),o=this._coordIndex.getValue(),r=this.getCoord();t.length=0,e.length=0;for(const a of n){const n=a.vertices,u=n.length;switch(u){case 3:var s=r.getNormal(o[n[0]],o[n[1]],o[n[2]]);break;case 4:s=r.getQuadNormal(o[n[0]],o[n[1]],o[n[2]],o[n[3]]);break;default:s=this.getPolygonNormal(n,o,r)}for(let t=0;t<u;++t){const i=n[t],r=o[i];let s=e[r];s||(s=e[r]=[]),s.push(i)}i&&s.negate();for(let e=0;e<u;++e)t[n[e]]=s}return this.refineNormals(e,t,this._creaseAngle.getValue())}}(),getPolygonNormal:function(){let t=new xe(0,0,0),e=new xe(0,0,0);return function(n,i,o){const r=new xe(0,0,0);o.get1Point(i[n[0]],e);for(let s=0,a=n.length;s<a;++s){const u=t;t=e,e=u,o.get1Point(i[n[(s+1)%a]],e),r.x+=(t.y-e.y)*(t.z+e.z),r.y+=(t.z-e.z)*(t.x+e.x),r.z+=(t.x-e.x)*(t.y+e.y)}return r.normalize()}}()});const Ih=Fh;n.set("x_ite/Components/Geometry3D/IndexedFaceSet",Ih);const Mh=Ih;function Dh(t){or.call(this,t),this.addType(c.X3DGeometricPropertyNode)}Dh.prototype=Object.assign(Object.create(or.prototype),{constructor:Dh});const Vh=Dh;n.set("x_ite/Components/Rendering/X3DGeometricPropertyNode",Vh);const Rh=Vh;function Ph(t){Rh.call(this,t),this.addType(c.X3DCoordinateNode)}Ph.prototype=Object.assign(Object.create(Rh.prototype),{constructor:Ph,initialize:function(){Rh.prototype.initialize.call(this),this._point.addInterest("set_point__",this),this.set_point__()},set_point__:function(){this.point=this._point.getValue(),this.length=this._point.length},isEmpty:function(){return 0===this.length},getSize:function(){return this.length},set1Point:function(t,e){this._point[t]=e},get1Point:function(t,e){if(t<this.length){const n=this.point;return t*=3,e.set(n[t],n[t+1],n[t+2])}return e.set(0,0,0)},addPoint:function(t,e){if(t<this.length){const n=this.point;t*=3,e.push(n[t],n[t+1],n[t+2],1)}else e.push(0,0,0,1)},addPoints:function(t,e){const n=this.point;for(var i=0,o=3*this.length;i<o;i+=3)t.push(n[i],n[i+1],n[i+2],1);for(i=o,o=3*e;i<o;i+=3)t.push(0,0,0,1)},getNormal:function(){const t=new xe(0,0,0),e=new xe(0,0,0),n=new xe(0,0,0);return function(i,o,r){const s=this.length;return i<s&&o<s&&r<s?vs.normal(this.get1Point(i,t),this.get1Point(o,e),this.get1Point(r,n),new xe(0,0,0)):new xe(0,0,0)}}(),getQuadNormal:function(){const t=new xe(0,0,0),e=new xe(0,0,0),n=new xe(0,0,0),i=new xe(0,0,0);return function(o,r,s,a){const u=this.length;return o<u&&r<u&&s<u&&a<u?vs.quadNormal(this.get1Point(o,t),this.get1Point(r,e),this.get1Point(s,n),this.get1Point(a,i),new xe(0,0,0)):new xe(0,0,0)}}()});const Ah=Ph;n.set("x_ite/Components/Rendering/X3DCoordinateNode",Ah);const Lh=Ah;function Bh(t){Lh.call(this,t),this.addType(c.Coordinate),this._point.setUnit("length")}Bh.prototype=Object.assign(Object.create(Lh.prototype),{constructor:Bh,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new Y([new B(c.inputOutput,"metadata",new Ri.SFNode),new B(c.inputOutput,"point",new Ri.MFVec3f)]),getTypeName:function(){return"Coordinate"},getComponentName:function(){return"Rendering"},getContainerField:function(){return"coord"}});const Xh=Bh;n.set("x_ite/Components/Rendering/Coordinate",Xh);const Uh=Xh;function kh(t){Rh.call(this,t),this.addType(c.X3DTextureCoordinateNode)}kh.prototype=Object.assign(Object.create(Rh.prototype),{constructor:kh});const zh=kh;n.set("x_ite/Components/Texturing/X3DTextureCoordinateNode",zh);const jh=zh;function Gh(t){jh.call(this,t),this.addType(c.X3DSingleTextureCoordinateNode),this.texCoordArray=Pa.createArray()}Gh.prototype=Object.assign(Object.create(jh.prototype),{constructor:Gh,init:function(t){this.texCoordArray.length=0,t.push(this.texCoordArray)},getCount:function(){return 1},addTexCoord:function(t,e){this.addTexCoordToChannel(t,e[0])},getTextureCoordinateMapping:function(t,e=0){this._mapping.getValue()&&t.set(this._mapping.getValue(),e)},setShaderUniforms:function(t,e){for(let n=0,i=e.x3d_MaxTextures;n<i;++n)this.setShaderUniformsToChannel(t,e,n)},setShaderUniformsToChannel:function(t,e,n=0){t.uniform1i(e.x3d_TextureCoordinateGeneratorMode[n],0)}});const Hh=Gh;n.set("x_ite/Components/Texturing/X3DSingleTextureCoordinateNode",Hh);const qh=Hh;function Yh(t){qh.call(this,t),this.addType(c.TextureCoordinate)}Yh.prototype=Object.assign(Object.create(qh.prototype),{constructor:Yh,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new Y([new B(c.inputOutput,"metadata",new Ri.SFNode),new B(c.inputOutput,"mapping",new Ri.SFString),new B(c.inputOutput,"point",new Ri.MFVec2f)]),getTypeName:function(){return"TextureCoordinate"},getComponentName:function(){return"Texturing"},getContainerField:function(){return"texCoord"},initialize:function(){qh.prototype.initialize.call(this),this._point.addInterest("set_point__",this),this.set_point__()},set_point__:function(){this.point=this._point.getValue(),this.length=this._point.length},isEmpty:function(){return 0===this.length},getSize:function(){return this.length},get1Point:function(t,e){if(t>=0&&t<this.length){const n=this.point;return t*=2,e.set(n[t],n[t+1],0,1)}if(t>=0&&this.length){const n=this.point;return t%=this.length,t*=2,e.set(n[t],n[t+1],0,1)}return e.set(0,0,0,1)},addTexCoordToChannel:function(t,e){if(t>=0&&t<this.length){const n=this.point;t*=2,e.push(n[t],n[t+1],0,1)}else if(t>=0&&this.length){const n=this.point;t%=this.length,t*=2,e.push(n[t],n[t+1],0,1)}else e.push(0,0,0,1)},getTexCoord:function(t){const e=this.point,n=this.length;for(let i=0,o=0;i<n;++i,o+=2)t.push(e[o],e[o+1],0,1);return t}});const Wh=Yh;n.set("x_ite/Components/Texturing/TextureCoordinate",Wh);const Kh=Wh;function Jh(t){$i.call(this,t)}Jh.prototype=Object.assign(Object.create($i.prototype),{constructor:Jh,getTypeName:function(){return"BoxOptions"},getComponentName:function(){return"X_ITE"},getContainerField:function(){return"boxOptions"},initialize:function(){$i.prototype.initialize.call(this)},getGeometry:function(){if(this.geometry)return this.geometry;this.geometry=new Mh(this.getExecutionContext()),this.geometry._texCoord=new Kh(this.getExecutionContext()),this.geometry._coord=new Uh(this.getExecutionContext());const t=this.geometry,e=this.geometry._texCoord.getValue(),n=this.geometry._coord.getValue();return t._texCoordIndex=new Ri.MFInt32(0,1,2,3,-1,0,1,2,3,-1,0,1,2,3,-1,0,1,2,3,-1,0,1,2,3,-1,0,1,2,3,-1),t._coordIndex=new Ri.MFInt32(0,1,2,3,-1,5,4,7,6,-1,1,5,6,2,-1,4,0,3,7,-1,4,5,1,0,-1,3,2,6,7,-1),e._point=new Ri.MFVec2f(new Ri.SFVec2f(1,1),new Ri.SFVec2f(0,1),new Ri.SFVec2f(0,0),new Ri.SFVec2f(1,0)),n._point=new Ri.MFVec3f(new Ri.SFVec3f(1,1,1),new Ri.SFVec3f(-1,1,1),new Ri.SFVec3f(-1,-1,1),new Ri.SFVec3f(1,-1,1),new Ri.SFVec3f(1,1,-1),new Ri.SFVec3f(-1,1,-1),new Ri.SFVec3f(-1,-1,-1),new Ri.SFVec3f(1,-1,-1)),e.setup(),n.setup(),t.setup(),this.geometry}});const Zh=Jh;n.set("x_ite/Browser/Geometry3D/BoxOptions",Zh);const Qh=Zh;function $h(t){$i.call(this,t),this.addChildObjects("xDimension",new Ri.SFInt32(20),"yDimension",new Ri.SFInt32(1))}$h.prototype=Object.assign(Object.create($i.prototype),{constructor:$h,getTypeName:function(){return"ConeOptions"},getComponentName:function(){return"X_ITE"},getContainerField:function(){return"coneOptions"}});const td=$h;n.set("x_ite/Browser/Geometry3D/ConeOptions",td);const ed=td;function nd(t){$i.call(this,t),this.addChildObjects("xDimension",new Ri.SFInt32(20),"yDimension",new Ri.SFInt32(1))}nd.prototype=Object.assign(Object.create($i.prototype),{constructor:nd,getTypeName:function(){return"CylinderOptions"},getComponentName:function(){return"X_ITE"},getContainerField:function(){return"cylinderOptions"}});const id=nd;n.set("x_ite/Browser/Geometry3D/CylinderOptions",id);const od=id;function rd(t){$i.call(this,t),this.addChildObjects("xDimension",new Ri.SFInt32(32),"yDimension",new Ri.SFInt32(15))}rd.prototype=Object.assign(Object.create($i.prototype),{constructor:rd,getTypeName:function(){return"QuadSphereOptions"},getComponentName:function(){return"X_ITE"},getContainerField:function(){return"quadSphereOptions"},initialize:function(){$i.prototype.initialize.call(this),this.addInterest("eventsProcessed",this)},getGeometry:function(){return this.geometry||this.eventsProcessed(),this.geometry},createTexCoordIndex:function(){const t=this._xDimension.getValue()+1,e=this._yDimension.getValue(),n=this.geometry._texCoordIndex;for(let e=0,i=t-1;e<i;++e)n.push(e),n.push(e+t-1),n.push(e+t),n.push(-1);for(let i=t-1,o=0,r=e-3;o<r;++o,++i)for(let e=0,o=t-1;e<o;++e,++i)n.push(i),n.push(i+t),n.push(i+t+1),n.push(i+1),n.push(-1);let i=(e-2)*t-1;for(let e=0,o=t-1;e<o;++e,++i)n.push(i+t),n.push(i+1),n.push(i),n.push(-1)},createTexCoord:function(){const t=this._xDimension.getValue()+1,e=this._yDimension.getValue(),n=this.geometry._texCoord.getValue()._point,i=-.5/(t-1);for(let e=1;e<t;++e){const o=e/(t-1)+i;n.push(new de(o,1))}for(let i=1,o=e-1;i<o;++i){const o=1-i/(e-1);for(let e=0;e<t;++e){const i=e/(t-1);n.push(new de(i,o))}}for(let e=1;e<t;++e){const o=e/(t-1)+i;n.push(new de(o,0))}},createCoordIndex:function(){const t=this._xDimension.getValue()+1,e=this._yDimension.getValue(),n=this.geometry._coordIndex;let i=1;for(const e=t-1;i<e;++i)n.push(0),n.push(i),n.push(i+1),n.push(-1);n.push(0),n.push(i),n.push(1),n.push(-1);let o=1;for(let i=0,r=e-3;i<r;++i,++o){for(let e=0,i=t-2;e<i;++e,++o)n.push(o),n.push(o+t-1),n.push(o+t),n.push(o+1),n.push(-1);n.push(o),n.push(o+t-1),n.push(o+1),n.push(o-t+2),n.push(-1)}const r=o+t-1;for(let e=0,i=t-2;e<i;++e,++o)n.push(r),n.push(o+1),n.push(o),n.push(-1);n.push(r),n.push(r-t+1),n.push(o),n.push(-1)},createPoints:function(){const t=this._xDimension.getValue()+1,e=this._yDimension.getValue(),n=this.geometry._coord.getValue()._point;n.push(new xe(0,1,0));for(let i=1,o=e-1;i<o;++i){const e=ka.Polar(1,-Math.PI*i/o);for(let i=0,o=t-1;i<o;++i){const t=ka.Polar(e.imag,2*Math.PI*i/o);n.push(new xe(t.imag,e.real,t.real))}}n.push(new xe(0,-1,0))},eventsProcessed:function(){this.geometry=new Mh(this.getExecutionContext()),this.geometry._texCoord=new Kh(this.getExecutionContext()),this.geometry._coord=new Uh(this.getExecutionContext()),this.createTexCoordIndex(),this.createTexCoord(),this.createCoordIndex(),this.createPoints();const t=this.geometry,e=this.geometry._texCoord.getValue(),n=this.geometry._coord.getValue();t._creaseAngle=Math.PI,e.setup(),n.setup(),t.setup()}});const sd=rd;n.set("x_ite/Browser/Geometry3D/QuadSphereOptions",sd);const ad=sd;function ud(){}function cd(t,e){const n=new e(this.getPrivateScene());return n.setup(),this[t]=function(){return n},Object.defineProperty(this,t,{enumerable:!1}),n}ud.prototype={initialize:function(){this.setPrimitiveQuality3D(this.getBrowserOptions().getPrimitiveQuality())},getBoxOptions:function(){return cd.call(this,"getBoxOptions",Qh)},getConeOptions:function(){return cd.call(this,"getConeOptions",ed)},getCylinderOptions:function(){return cd.call(this,"getCylinderOptions",od)},getSphereOptions:function(){return cd.call(this,"getSphereOptions",ad)},setPrimitiveQuality3D:function(t){const e=this.getConeOptions(),n=this.getCylinderOptions(),i=this.getSphereOptions();switch(t){case To.LOW:e._xDimension=16,n._xDimension=16,i._xDimension=20,i._yDimension=9;break;case To.MEDIUM:e._xDimension=20,n._xDimension=20,i._xDimension=32,i._yDimension=15;break;case To.HIGH:e._xDimension=32,n._xDimension=32,i._xDimension=64,i._yDimension=31}}};const ld=ud;n.set("x_ite/Browser/Geometry3D/X3DGeometry3DContext",ld);const hd=ld;let dd=0;const pd={AUTO:dd++,OPAQUE:dd++,MASK:dd++,BLEND:dd++};n.set("x_ite/Browser/Shape/AlphaMode",pd);const fd=pd;function gd(t){ha.call(this,t),Qu.call(this,t),this.addType(c.X3DShapeNode),this.bbox=new Ks,this.bboxSize=new xe(0,0,0),this.bboxCenter=new xe(0,0,0)}gd.prototype=Object.assign(Object.create(ha.prototype),Qu.prototype,{constructor:gd,initialize:function(){ha.prototype.initialize.call(this),Qu.prototype.initialize.call(this),this._bboxSize.addInterest("set_bbox__",this),this._bboxCenter.addInterest("set_bbox__",this),this._appearance.addInterest("set_apparance__",this),this._geometry.addInterest("set_geometry__",this),this._appearance.addInterest("set_transparent__",this),this._geometry.addInterest("set_transparent__",this),this.set_apparance__(),this.set_geometry__(),this.set_transparent__()},getBBox:function(t,e){return e?this._castShadow.getValue()?t.assign(this.bbox):t.set():t.assign(this.bbox)},getBBoxSize:function(){return this.bboxSize},getBBoxCenter:function(){return this.bboxCenter},getAppearance:function(){return this.apparanceNode},getGeometry:function(){return this.geometryNode},setTransparent:function(t){this.transparent=t},getTransparent:function(){return this.transparent},set_bbox__:function(){this._bboxSize.getValue().equals(this.getDefaultBBoxSize())?this.getGeometry()?this.bbox.assign(this.getGeometry().getBBox()):this.bbox.set():this.bbox.set(this._bboxSize.getValue(),this._bboxCenter.getValue()),this.bboxSize.assign(this.bbox.size),this.bboxCenter.assign(this.bbox.center)},set_apparance__:function(){this.apparanceNode&&this.apparanceNode._transparent.removeInterest("set_transparent__",this),this.apparanceNode=nu(c.X3DAppearanceNode,this._appearance),this.apparanceNode?(this.apparanceNode._alphaMode.addInterest("set_transparent__",this),this.apparanceNode._transparent.addInterest("set_transparent__",this)):this.apparanceNode=this.getBrowser().getDefaultAppearance()},set_geometry__:function(){this.geometryNode&&(this.geometryNode._transparent.addInterest("set_transparent__",this),this.geometryNode._bbox_changed.addInterest("set_bbox__",this)),this.geometryNode=nu(c.X3DGeometryNode,this._geometry),this.geometryNode&&(this.geometryNode._transparent.addInterest("set_transparent__",this),this.geometryNode._bbox_changed.addInterest("set_bbox__",this)),this.set_bbox__()},set_transparent__:function(){this.apparanceNode.getAlphaMode()===fd.AUTO?this.transparent=this.apparanceNode.getTransparent()||this.geometryNode&&this.geometryNode.getTransparent():this.transparent=this.apparanceNode.getTransparent()},dispose:function(){Qu.prototype.dispose.call(this),ha.prototype.dispose.call(this)}});const md=gd;n.set("x_ite/Components/Shape/X3DShapeNode",md);const _d=md;function xd(t,e){this.point=t.copy(),this.direction=e.copy()}xd.prototype={constructor:xd,copy:function(){const t=Object.create(xd.prototype);return t.point=this.point.copy(),t.direction=this.direction.copy(),t},assign:function(t){return this.point.assign(t.point),this.direction.assign(t.direction),this},set:function(t,e){return this.point.assign(t),this.direction.assign(e),this},setPoints:function(t,e){return this.point.assign(t),this.direction.assign(e).subtract(t).normalize(),this},multMatrixLine:function(t){return t.multMatrixVec(this.point),t.multMatrixDir(this.direction).normalize(),this},multLineMatrix:function(t){return t.multVecMatrix(this.point),t.multDirMatrix(this.direction).normalize(),this},getClosestPointToPoint:function(t,e){const n=e.assign(t).subtract(this.point).dot(this.direction);return e.assign(this.direction).multiply(n).add(this.point)},getClosestPointToLine:function(){const t=new xe(0,0,0);return function(e,n){const i=this.point,o=e.point,r=this.direction,s=e.direction;let a=r.dot(s);return!(Math.abs(a)>=1)&&(t.assign(o).subtract(i),a=(t.dot(r)-a*t.dot(s))/(1-a*a),n.assign(r).multiply(a).add(i),!0)}}(),getPerpendicularVectorToPoint:function(){const t=new xe(0,0,0);return function(e,n){return n.assign(this.point).subtract(e),n.subtract(t.assign(this.direction).multiply(n.dot(this.direction)))}}(),getPerpendicularVectorToLine:function(){const t=new xe(0,0,0),e=new xe(0,0,0);return function(n,i){const o=i;t.assign(this.point).subtract(n.point);const r=t.dot(this.direction),s=t.dot(n.direction),a=this.direction.dot(n.direction),u=a*a,c=(r-s*a)/(1-u),l=-(s-r*a)/(1-u);return e.assign(this.direction).multiply(c),o.assign(n.direction).multiply(l),o.subtract(e).add(t)}}(),intersectsTriangle:function(){const t=new xe(0,0,0),e=new xe(0,0,0);return function(n,i,o,r){const s=i.subtract(n),a=o.subtract(n);t.assign(this.direction).cross(a);const u=s.dot(t);if(0===u)return!1;const c=1/u;e.assign(this.point).subtract(n);const l=e.dot(t)*c;if(l<0||l>1)return!1;const h=e.cross(s),d=this.direction.dot(h)*c;return!(d<0||l+d>1)&&(r.u=l,r.v=d,r.t=1-l-d,!0)}}(),toString:function(){return this.point+", "+this.direction}},xd.Points=function(t,e){const n=Object.create(xd.prototype);return n.point=t.copy(),n.direction=xe.subtract(e,t).normalize(),n};const yd=xd;n.set("standard/Math/Geometry/Line3",yd);const wd=yd;function Sd(t,e){this.array=t,e&&(this.compare=e)}Sd.prototype={compare:function(t,e){return t<e},sort:function(t,e){e-t>1&&this.quicksort(t,e-1)},quicksort:function(t,e){let n=t,i=e;const o=this.array,r=this.compare,s=o[t+e>>>1];for(;;){for(;r(o[n],s);)++n;for(;r(s,o[i]);)--i;if(!(n<i)){n===i&&(++n,--i);break}{const t=o[n];o[n]=o[i],o[i]=t,n++,i--}}t<i&&this.quicksort(t,i),n<e&&this.quicksort(n,e)}};const Td=Sd;n.set("standard/Math/Algorithms/QuickSort",Td);const bd=Td;function vd(t){_d.call(this,t),this.addType(c.Shape)}vd.prototype=Object.assign(Object.create(_d.prototype),{constructor:vd,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new Y([new B(c.inputOutput,"metadata",new Ri.SFNode),new B(c.inputOutput,"visible",new Ri.SFBool(!0)),new B(c.inputOutput,"castShadow",new Ri.SFBool(!0)),new B(c.inputOutput,"bboxDisplay",new Ri.SFBool),new B(c.initializeOnly,"bboxSize",new Ri.SFVec3f(-1,-1,-1)),new B(c.initializeOnly,"bboxCenter",new Ri.SFVec3f),new B(c.inputOutput,"appearance",new Ri.SFNode),new B(c.inputOutput,"geometry",new Ri.SFNode)]),getTypeName:function(){return"Shape"},getComponentName:function(){return"Shape"},getContainerField:function(){return"children"},initialize:function(){_d.prototype.initialize.call(this),this._transformSensors_changed.addInterest("set_transformSensors__",this),this.set_transformSensors__()},getShapeKey:function(){return 0},set_geometry__:function(){_d.prototype.set_geometry__.call(this),this.getGeometry()?delete this.traverse:this.traverse=Function.prototype},set_transformSensors__:function(){this.setPickableObject(this.getTransformSensors().size)},intersectsBox:function(t,e,n){return this.getGeometry().intersectsBox(t,e,n)},traverse:function(t,e){switch(t){case Us.POINTER:this.pointer(e);break;case Us.PICKING:this.picking(e);break;case Us.COLLISION:e.addCollisionShape(this);break;case Us.SHADOW:this._castShadow.getValue()&&e.addShadowShape(this);break;case Us.DISPLAY:e.addDisplayShape(this)&&this.getAppearance().traverse(t,e)}this.getGeometry().traverse(t,e)},pointer:function(){const t=new hn,e=new hn,n=new wd(new xe(0,0,0),new xe(0,0,0)),i=[],o=new bd(i,(function(t,e){return t.point.z>e.point.z})),r=function(t,e){return t.point.z>e};return function(s){const a=this.getBrowser();if(a.getPickOnlySensors()&&1===a.getSensors().length)return;const u=this.getGeometry();if(t.assign(s.getModelViewMatrix().get()),e.assign(t).inverse(),n.assign(a.getHitRay()).multLineMatrix(e),u.intersectsLine(n,s,e,this.getAppearance(),i)){for(const e of i)t.multVecMatrix(e.point);o.sort(0,i.length);const n=gt.lowerBound(i,0,i.length,-s.getNavigationInfo().getNearValue(),r);n!==i.length&&(e.multMatrixDir(i[n].normal).normalize(),a.addHit(i[n],s.getLayer(),this,t.multRight(s.getCameraSpaceMatrix().get()))),i.length=0}}}(),picking:function(t){const e=t.getModelViewMatrix().get();if(this.getTransformSensors().size)for(const t of this.getTransformSensors())t.collect(e);const n=this.getBrowser(),i=n.getPickSensors(),o=n.getPickingHierarchy();o.push(this);for(const t of i.at(-1))t.collect(this.getGeometry(),e,o);o.pop()},depth:function(t,e,n){const i=e.clipPlanes,o=this.getBrowser().getDepthShader(i.length,!1);o.enable(t),o.setClipPlanes(t,i),t.uniformMatrix4fv(o.x3d_ProjectionMatrix,!1,n),t.uniformMatrix4fv(o.x3d_ModelViewMatrix,!1,e.modelViewMatrix),this.getGeometry().depth(t,e,o)},display:function(t,e){this.getGeometry().display(t,e)}});const Cd=vd;n.set("x_ite/Components/Shape/Shape",Cd);const Ed=Cd;function Od(t,e){this.point=t.copy(),this.direction=e.copy()}Od.prototype={constructor:Od,copy:function(){const t=Object.create(Od.prototype);return t.point=this.point.copy(),t.direction=this.direction.copy(),t},assign:function(t){return this.point.assign(t.point),this.direction.assign(t.direction),this},set:function(t,e){return this.point.assign(t),this.direction.assign(e),this},setPoints:function(t,e){return this.point.assign(t),this.direction.assign(e).subtract(t).normalize(),this},multMatrixLine:function(t){return t.multMatrixVec(this.point),t.multMatrixDir(this.direction).normalize(),this},multLineMatrix:function(t){return t.multVecMatrix(this.point),t.multDirMatrix(this.direction).normalize(),this},getClosestPointToPoint:function(t,e){const n=e.assign(t).subtract(this.point).dot(this.direction);return e.assign(this.direction).multiply(n).add(this.point)},getPerpendicularVectorToPoint:function(){const t=new de(0,0);return function(e,n){return n.assign(this.point).subtract(e),n.subtract(t.assign(this.direction).multiply(n.dot(this.direction)))}}(),intersectsLine:function(){const t=new de(0,0);return function(e,n){const i=this.point,o=e.point,r=this.direction,s=e.direction,a=r.dot(s);if(Math.abs(a)>=1)return!1;t.assign(o).subtract(i);const u=(t.dot(r)-a*t.dot(s))/(1-a*a);return n.assign(r).multiply(u).add(i),!0}}(),toString:function(){return this.point+", "+this.direction}},Od.Points=function(t,e){const n=Object.create(Od.prototype);return n.point=t.copy(),n.direction=de.subtract(e,t).normalize(),n};const Nd=Od;n.set("standard/Math/Geometry/Line2",Nd);const Fd=Nd;function Id(t){this.getExecutionContext()||Pa.call(this,t);const e=this.getBrowser().getContext();this.transformVertexArrayObject=new Ma,this.thickVertexArrayObject=new Ma,this.lineStippleBuffer=e.createBuffer(),this.trianglesBuffer=e.createBuffer(),this.setGeometryType(1),this.setPrimitiveMode(e.LINES),this.setSolid(!1)}Id.prototype=Object.assign(Object.create(Pa.prototype),{constructor:Id,updateVertexArrays:function(){Pa.prototype.updateVertexArrays.call(this),this.transformVertexArrayObject.update(),this.thickVertexArrayObject.update()},intersectsLine:function(){const t=new Ks,e=new xe(0,0,0),n=new xe(0,0,0),i=new xe(0,0,0),o=new xe(0,0,0),r=new hn,s=new xe(0,0,0),a=new xe(0,0,0),u=new de(0,0),c=new de(0,0),l=new Fd(de.Zero,de.yAxis),h=new de(0,0),d=new wd(xe.Zero,xe.zAxis),p=new wd(xe.Zero,xe.zAxis),f=new xe(0,0,0),g=new Se,m=new xe(0,0,0);return function(_,x,y,w,S){const T=x.getModelViewMatrix().get(),b=x.getViewVolume().getViewport(),v=(t.assign(this.getBBox()).multRight(T).getExtents(e,n),w.getLineProperties()),C=Math.max(1.5,v&&v.getApplied()?v.getLinewidthScaleFactor()/2:1),E=x.getViewpoint().getScreenScale(e,b,i),O=y.multDirMatrix(E.multiply(C)),N=x.getViewpoint().getScreenScale(n,b,o),F=y.multDirMatrix(N.multiply(C));if(this.intersectsBBox(_,O.abs().max(F.abs()))){const t=this.getBrowser().getPointer(),e=x.getProjectionMatrix().get(),n=x.getLocalObjects(),i=this.getVertices(),o=i.length;r.assign(T).multRight(e);for(let _=0;_<o;_+=8)if(s.set(i[_+0],i[_+1],i[_+2]),a.set(i[_+4],i[_+5],i[_+6]),Rs.projectPointMatrix(s,r,b,u),Rs.projectPointMatrix(a,r,b,c),l.setPoints(u,c),l.getClosestPointToPoint(t,h)){const i=u.distance(c),o=u.distance(h),r=c.distance(h);if(o<=i&&r<=i&&h.distance(t)<=C){if(n.length&&this.isClipped(T.multVecMatrix(m.assign(h)),n))continue;const r=l.direction,u=g.set(r.x,r.y,-r.y,r.x).inverse().multVecMatrix(t.copy().subtract(h)),c=u.set(o/i,(u.y/C+1)/2),_=a.copy().subtract(s).normalize();Rs.unProjectRay(h.x,h.y,T,e,b,d),p.setPoints(s,a).getClosestPointToLine(d,f),S.push({texCoord:c,normal:_,point:f.copy()})}}}return S.length}}(),intersectsLineWithGeometry:function(){return!1},intersectsBox:function(t,e,n){return!1},buildTexCoords:function(){const t=this.getTexCoords();if(t.getValue().length/6!=this.getVertices().length/8){const e=this.getBrowser().getContext(),n=this.getVertices().length/8;t.length=6*n,t.fill(0),t.shrinkToFit(),e.bindBuffer(e.ARRAY_BUFFER,this.lineStippleBuffer),e.bufferData(e.ARRAY_BUFFER,t.getValue(),e.DYNAMIC_DRAW),e.bindBuffer(e.ARRAY_BUFFER,this.trianglesBuffer),e.bufferData(e.ARRAY_BUFFER,new Float32Array(90*n),e.DYNAMIC_DRAW)}},updateLengthSoFar:function(){const t=new hn,e=new Xe(0,0,0),n=new Xe(0,0,0),i=new de(0,0),o=new de(0,0);return function(r,s){const a=s.renderObject.getViewVolume().getViewport(),u=s.renderObject.getProjectionMatrix().get(),c=this.getTexCoords().getValue(),l=this.getVertices(),h=l.length;t.assign(s.modelViewMatrix).multRight(u);let d=0;for(let r=0,s=0;r<h;r+=8,s+=6)e.set(l[r],l[r+1],l[r+2],l[r+3]),n.set(l[r+4],l[r+5],l[r+6],l[r+7]),Rs.projectPointMatrix(e,t,a,i),Rs.projectPointMatrix(n,t,a,o),c[s]=o.x,c[s+1]=o.y,c[s+3]=i.x,c[s+4]=i.y,c[s+5]=d,d+=o.subtract(i).magnitude();r.bindBuffer(r.ARRAY_BUFFER,this.lineStippleBuffer),r.bufferData(r.ARRAY_BUFFER,c,r.DYNAMIC_DRAW)}}(),display:function(){const t=new hn,e=new Float32Array(16),n=new Float32Array(16);return function(i,o){const r=this.getBrowser(),s=o.appearanceNode,a=s.getLineProperties(),u=s.getShader(this,o),c=s.getBlendMode(),l=this.getAttrib(),h=this.getAttribBuffers();if(a&&(a.getApplied()&&1!==a.getLinetype()&&this.updateLengthSoFar(i,o),a.getTransformLines())){const s=o.renderObject,l=s.getViewVolume().getViewport(),h=s.getProjectionMatrix().get(),d=r.getPrimitiveMode(i.TRIANGLES),p=r.getLineTransformShader();if(e.set(t.assign(o.modelViewMatrix).multRight(h)),n.set(t.inverse()),p.enable(i),i.uniform4f(p.viewport,l.x,l.y,l.z,l.w),i.uniformMatrix4fv(p.modelViewProjectionMatrix,!1,e),i.uniformMatrix4fv(p.invModelViewProjectionMatrix,!1,n),i.uniform1f(p.scale,a.getLinewidthScaleFactor()/2),this.transformVertexArrayObject.enable(i,u)){const t=6*Float32Array.BYTES_PER_ELEMENT,e=0,n=3*Float32Array.BYTES_PER_ELEMENT,o=2*Float32Array.BYTES_PER_ELEMENT,r=0,s=1*Float32Array.BYTES_PER_ELEMENT,a=8*Float32Array.BYTES_PER_ELEMENT,u=0,c=4*Float32Array.BYTES_PER_ELEMENT,l=6*Float32Array.BYTES_PER_ELEMENT,h=0,d=3*Float32Array.BYTES_PER_ELEMENT,f=8*Float32Array.BYTES_PER_ELEMENT,g=0,m=4*Float32Array.BYTES_PER_ELEMENT;p.enableFloatAttrib(i,"x3d_LineStipple0",this.lineStippleBuffer,3,t,e),p.enableFloatAttrib(i,"x3d_LineStipple1",this.lineStippleBuffer,3,t,n),this.hasFogCoords&&(p.enableFloatAttrib(i,"x3d_FogDepth0",this.fogDepthBuffer,1,o,r),p.enableFloatAttrib(i,"x3d_FogDepth1",this.fogDepthBuffer,1,o,s)),this.colorMaterial&&(p.enableFloatAttrib(i,"x3d_Color0",this.colorBuffer,4,a,u),p.enableFloatAttrib(i,"x3d_Color1",this.colorBuffer,4,a,c)),this.hasNormals&&(p.enableFloatAttrib(i,"x3d_Normal0",this.normalBuffer,3,l,h),p.enableFloatAttrib(i,"x3d_Normal1",this.normalBuffer,3,l,d)),p.enableFloatAttrib(i,"x3d_Vertex0",this.vertexBuffer,4,f,g),p.enableFloatAttrib(i,"x3d_Vertex1",this.vertexBuffer,4,f,m)}if(i.bindTransformFeedback(i.TRANSFORM_FEEDBACK,r.getLineTransformFeedback()),i.bindBufferBase(i.TRANSFORM_FEEDBACK_BUFFER,0,this.trianglesBuffer),i.enable(i.RASTERIZER_DISCARD),i.beginTransformFeedback(i.POINTS),i.drawArraysInstanced(i.POINTS,0,this.vertexCount/2,2),i.endTransformFeedback(),i.disable(i.RASTERIZER_DISCARD),i.bindTransformFeedback(i.TRANSFORM_FEEDBACK,null),c&&c.enable(i),u.enable(i),u.setUniforms(i,this,o),this.thickVertexArrayObject.enable(i,u)){const t=15*Float32Array.BYTES_PER_ELEMENT,e=0,n=3*Float32Array.BYTES_PER_ELEMENT,o=4*Float32Array.BYTES_PER_ELEMENT,r=8*Float32Array.BYTES_PER_ELEMENT,s=11*Float32Array.BYTES_PER_ELEMENT;u.enableLineStippleAttribute(i,this.trianglesBuffer,t,e),this.hasFogCoords&&u.enableFogDepthAttribute(i,this.trianglesBuffer,t,n),this.colorMaterial&&u.enableColorAttribute(i,this.trianglesBuffer,t,o),this.hasNormals&&u.enableNormalAttribute(i,this.trianglesBuffer,t,r),u.enableVertexAttribute(i,this.trianglesBuffer,t,s),i.bindBuffer(i.ARRAY_BUFFER,null)}if(r.getWireframe())for(let t=0,e=3*this.vertexCount;t<e;t+=3)i.drawArrays(d,t,3);else i.frontFace(i.CCW),i.enable(i.CULL_FACE),i.drawArrays(d,0,3*this.vertexCount);return void(c&&c.disable(i))}const d=r.getPrimitiveMode(this.getPrimitiveMode());if(c&&c.enable(i),u.enable(i),u.setUniforms(i,this,o),this.vertexArrayObject.enable(i,u)){for(let t=0,e=l.length;t<e;++t)l[t].enable(i,u,h[t]);u.enableLineStippleAttribute(i,this.lineStippleBuffer,0,0),this.hasFogCoords&&u.enableFogDepthAttribute(i,this.fogDepthBuffer,0,0),this.colorMaterial&&u.enableColorAttribute(i,this.colorBuffer,0,0),this.hasNormals&&u.enableNormalAttribute(i,this.normalBuffer,0,0),u.enableVertexAttribute(i,this.vertexBuffer,0,0)}i.drawArrays(d,0,this.vertexCount),c&&c.disable(i),i.lineWidth(1)}}(),displayParticles:function(t,e,n){const i=this.getBrowser(),o=e.appearanceNode,r=o.getShader(this,e),s=o.getBlendMode(),a=this.getAttrib(),u=this.getAttribBuffers(),c=i.getPrimitiveMode(this.getPrimitiveMode());s&&s.enable(t),r.enable(t),r.setUniforms(t,this,e);const l=n.outputParticles;if(l.vertexArrayObject.update(this.updateParticles).enable(t,r)){const e=n.particleStride;r.enableParticleAttribute(t,l,e,n.particleOffset,1),r.enableParticleMatrixAttribute(t,l,e,n.matrixOffset,1);for(let e=0,n=a.length;e<n;++e)a[e].enable(t,r,u[e]);this.hasFogCoords&&r.enableFogDepthAttribute(t,this.fogDepthBuffer,0,0),this.colorMaterial&&r.enableColorAttribute(t,this.colorBuffer,0,0),this.hasNormals&&r.enableNormalAttribute(t,this.normalBuffer,0,0),r.enableVertexAttribute(t,this.vertexBuffer,0,0),this.updateParticles=!1}t.drawArraysInstanced(c,0,this.vertexCount,n.numParticles),s&&s.disable(t),t.lineWidth(1)}});const Md=Id;n.set("x_ite/Components/Rendering/X3DLineGeometryNode",Md);const Dd=Md;function Vd(t){Dd.call(this,t),this.addType(c.IndexedLineSet),this.fogCoordNode=null,this.colorNode=null,this.normalNode=null,this.coordNode=null}Vd.prototype=Object.assign(Object.create(Dd.prototype),{constructor:Vd,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new Y([new B(c.inputOutput,"metadata",new Ri.SFNode),new B(c.inputOnly,"set_colorIndex",new Ri.MFInt32),new B(c.inputOnly,"set_coordIndex",new Ri.MFInt32),new B(c.initializeOnly,"colorPerVertex",new Ri.SFBool(!0)),new B(c.initializeOnly,"colorIndex",new Ri.MFInt32),new B(c.initializeOnly,"coordIndex",new Ri.MFInt32),new B(c.inputOutput,"attrib",new Ri.MFNode),new B(c.inputOutput,"fogCoord",new Ri.SFNode),new B(c.inputOutput,"color",new Ri.SFNode),new B(c.inputOutput,"normal",new Ri.SFNode),new B(c.inputOutput,"coord",new Ri.SFNode)]),getTypeName:function(){return"IndexedLineSet"},getComponentName:function(){return"Rendering"},getContainerField:function(){return"geometry"},initialize:function(){Dd.prototype.initialize.call(this),this._set_colorIndex.addFieldInterest(this._colorIndex),this._set_coordIndex.addFieldInterest(this._coordIndex),this._attrib.addInterest("set_attrib__",this),this._fogCoord.addInterest("set_fogCoord__",this),this._color.addInterest("set_color__",this),this._normal.addInterest("set_normal__",this),this._coord.addInterest("set_coord__",this),this.set_attrib__(),this.set_fogCoord__(),this.set_color__(),this.set_normal__(),this.set_coord__()},set_attrib__:function(){const t=this.getAttrib();for(const e of t)e.removeInterest("requestRebuild",this),e._attribute_changed.removeInterest("updateVertexArrays",this);t.length=0;for(const e of this._attrib){const n=nu(c.X3DVertexAttributeNode,e);n&&t.push(n)}for(const e of t)e.addInterest("requestRebuild",this),e._attribute_changed.addInterest("updateVertexArrays",this);this.updateVertexArrays()},set_fogCoord__:function(){this.fogCoordNode&&this.fogCoordNode.removeInterest("requestRebuild",this),this.fogCoordNode=nu(c.FogCoordinate,this._fogCoord),this.fogCoordNode&&this.fogCoordNode.addInterest("requestRebuild",this)},set_color__:function(){this.colorNode&&(this.colorNode.removeInterest("requestRebuild",this),this.colorNode._transparent.removeInterest("set_transparent__",this)),this.colorNode=nu(c.X3DColorNode,this._color),this.colorNode?(this.colorNode.addInterest("requestRebuild",this),this.colorNode._transparent.addInterest("set_transparent__",this),this.set_transparent__()):this.setTransparent(!1)},set_transparent__:function(){this.setTransparent(this.colorNode.getTransparent())},set_normal__:function(){this.normalNode&&this.normalNode.removeInterest("requestRebuild",this),this.normalNode=nu(c.X3DNormalNode,this._normal),this.normalNode&&this.normalNode.addInterest("requestRebuild",this)},set_coord__:function(){this.coordNode&&this.coordNode.removeInterest("requestRebuild",this),this.coordNode=nu(c.X3DCoordinateNode,this._coord),this.coordNode&&this.coordNode.addInterest("requestRebuild",this)},getColorPerVertexIndex:function(t){return t<this._colorIndex.length?this._colorIndex[t]:this._coordIndex[t]},getColorIndex:function(t){return t<this._colorIndex.length?this._colorIndex[t]:t},getPolylineIndices:function(){const t=this._coordIndex,e=[];let n=[];if(t.length){for(let i=0,o=t.length;i<o;++i){t[i]>=0?n.push(i):(e.push(n),n=[])}t[t.length-1]>=0&&e.push(n)}return e},build:function(){if(!this.coordNode||this.coordNode.isEmpty())return;const t=this._coordIndex,e=this.getPolylineIndices(),n=this._colorPerVertex.getValue(),i=this.getAttrib(),o=i.length,r=this.getAttribs(),s=this.fogCoordNode,a=this.colorNode,u=this.coordNode,c=this.normalNode,l=this.getFogDepths(),h=this.getColors(),d=this.getNormals(),p=this.getVertices();let f=0;for(const g of e){if(g.length>1)for(let e=0,m=g.length-1;e<m;++e)for(let m=e,_=e+2;m<_;++m){const e=g[m],_=t[e];for(let t=0;t<o;++t)i[t].addValue(_,r[t]);s&&s.addDepth(_,l),a&&(n?a.addColor(this.getColorPerVertexIndex(e),h):a.addColor(this.getColorIndex(f),h)),c&&c.addVector(_,d),u.addPoint(_,p)}++f}}});const Rd=Vd;n.set("x_ite/Components/Rendering/IndexedLineSet",Rd);const Pd=Rd;function Ad(t){Rh.call(this,t),this.addType(c.X3DColorNode),this.addChildObjects("transparent",new Ri.SFBool),this._transparent.setAccessType(c.outputOnly)}Ad.prototype=Object.assign(Object.create(Rh.prototype),{constructor:Ad,setTransparent:function(t){t!==this._transparent.getValue()&&(this._transparent=t)},getTransparent:function(){return this._transparent.getValue()}});const Ld=Ad;n.set("x_ite/Components/Rendering/X3DColorNode",Ld);const Bd=Ld;function Xd(t){Bd.call(this,t),this.addType(c.Color)}Xd.prototype=Object.assign(Object.create(Bd.prototype),{constructor:Xd,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new Y([new B(c.inputOutput,"metadata",new Ri.SFNode),new B(c.inputOutput,"color",new Ri.MFColor)]),getTypeName:function(){return"Color"},getComponentName:function(){return"Rendering"},getContainerField:function(){return"color"},initialize:function(){Bd.prototype.initialize.call(this),this._color.addInterest("set_color__",this),this.set_color__()},set_color__:function(){this.color=this._color.getValue(),this.length=this._color.length},addColor:function(t,e){if(t>=0&&t<this.length){const n=this.color;t*=3,e.push(n[t],n[t+1],n[t+2],1)}else if(this.length){const n=this.color;t=3*(this.length-1),e.push(n[t],n[t+1],n[t+2],1)}else e.push(1,1,1,1)},addColors:function(t,e){if(this.length){const o=this.color;for(var n=0,i=3*Math.min(e,this.length);n<i;n+=3)t.push(o[n],o[n+1],o[n+2],1);if(this.length<e){const r=o[n=3*(this.length-1)],s=o[n+1],a=o[n+2];for(n=i,i=3*e;n<i;n+=3)t.push(r,s,a,1)}}else for(let n=0;n<e;++n)t.push(1,1,1,1);return t}});const Ud=Xd;n.set("x_ite/Components/Rendering/Color",Ud);const kd=Ud,zd=Symbol();function jd(){}jd.prototype={initialize:function(){},getBBoxNode:function(){const t=new Ed(this.getPrivateScene()),e=new Pd(this.getPrivateScene()),n=new kd(this.getPrivateScene()),i=new Uh(this.getPrivateScene());return t._geometry=e,e._coordIndex=new Ri.MFFloat(0,1,2,3,0,-1,4,5,6,7,4,-1,0,4,-1,1,5,-1,2,6,-1,3,7,-1),e._color=n,e._coord=i,n._color=new Ri.MFColor(new Ri.SFColor(1,1,1)),i._point=new Ri.MFVec3f(new Ri.SFVec3f(.5,.5,.5),new Ri.SFVec3f(-.5,.5,.5),new Ri.SFVec3f(-.5,-.5,.5),new Ri.SFVec3f(.5,-.5,.5),new Ri.SFVec3f(.5,.5,-.5),new Ri.SFVec3f(-.5,.5,-.5),new Ri.SFVec3f(-.5,-.5,-.5),new Ri.SFVec3f(.5,-.5,-.5)),i.setup(),n.setup(),e.setup(),t.setup(),this[zd]=t,this.getBBoxNode=function(){return this[zd]},Object.defineProperty(this,"getBBoxNode",{enumerable:!1}),t}};const Gd=jd;n.set("x_ite/Browser/Grouping/X3DGroupingContext",Gd);const Hd=Gd;function qd(t){nc.call(this,t),this.addType(c.X3DViewportNode)}qd.prototype=Object.assign(Object.create(nc.prototype),{constructor:qd});const Yd=qd;n.set("x_ite/Components/Layering/X3DViewportNode",Yd);const Wd=Yd,Kd=wa(Rs);function Jd(t){Wd.call(this,t),this.addType(c.Viewport),this.rectangle=new Xe(0,0,0,0)}Jd.prototype=Object.assign(Object.create(Wd.prototype),{constructor:Jd,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new Y([new B(c.inputOutput,"metadata",new Ri.SFNode),new B(c.inputOutput,"clipBoundary",new Ri.MFFloat(0,1,0,1)),new B(c.inputOutput,"visible",new Ri.SFBool(!0)),new B(c.inputOutput,"bboxDisplay",new Ri.SFBool),new B(c.initializeOnly,"bboxSize",new Ri.SFVec3f(-1,-1,-1)),new B(c.initializeOnly,"bboxCenter",new Ri.SFVec3f),new B(c.inputOnly,"addChildren",new Ri.MFNode),new B(c.inputOnly,"removeChildren",new Ri.MFNode),new B(c.inputOutput,"children",new Ri.MFNode)]),getTypeName:function(){return"Viewport"},getComponentName:function(){return"Layering"},getContainerField:function(){return"viewport"},getRectangle:function(){const t=this.getBrowser().getViewport(),e=Math.floor(t[2]*this.getLeft()),n=Math.floor(t[2]*this.getRight()),i=Math.floor(t[3]*this.getBottom()),o=Math.floor(t[3]*this.getTop());return this.rectangle.set(e,i,Math.max(0,n-e),Math.max(0,o-i)),this.rectangle},getLeft:function(){return this._clipBoundary.length>0?this._clipBoundary[0]:0},getRight:function(){return this._clipBoundary.length>1?this._clipBoundary[1]:1},getBottom:function(){return this._clipBoundary.length>2?this._clipBoundary[2]:0},getTop:function(){return this._clipBoundary.length>3?this._clipBoundary[3]:1},traverse:function(t,e){if(this.push(e),t===Us.POINTER)this.getBrowser().isPointerInRectangle(this.rectangle)&&Wd.prototype.traverse.call(this,t,e);else Wd.prototype.traverse.call(this,t,e);this.pop(e)},push:function(t){const e=t.getViewVolumes(),n=this.getRectangle(),i=e.length?e.at(-1).getViewport():n,o=Kd.pop();o.set(t.getProjectionMatrix().get(),i,n),e.push(o)},pop:function(t){Kd.push(t.getViewVolumes().pop())}});const Zd=Jd;n.set("x_ite/Components/Layering/Viewport",Zd);const Qd=Zd,$d=Symbol();function tp(){this[$d]=new Qd(this.getPrivateScene())}tp.prototype={initialize:function(){this[$d].setPrivate(!0),this[$d].setup()},getDefaultViewport:function(){return this[$d]}};const ep=tp;n.set("x_ite/Browser/Layering/X3DLayeringContext",ep);const np=ep,ip=Symbol(),op=Symbol();function rp(){const t=this.getContext(),e=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS);this[ip]=e>8?8:2,this[op]=[]}rp.prototype={initialize:function(){},getMaxLights:function(){return this[ip]},popShadowBuffer:function(t){try{const e=this[op][t];if(e){if(e.length)return e.pop()}else this[op][t]=[];return new Ls(this,t,t)}catch(t){return console.error(t),null}},pushShadowBuffer:function(t){t&&this[op][t.getWidth()].push(t)}};const sp=rp;n.set("x_ite/Browser/Lighting/X3DLightingContext",sp);const ap=sp;function up(t){qu.call(this,t),this.addType(c.OrthoViewpoint),this.addChildObjects("fieldOfViewOffset",new Ri.MFFloat(0,0,0,0)),this._position.setUnit("length"),this._centerOfRotation.setUnit("length"),this._fieldOfView.setUnit("length"),this.projectionMatrix=new hn,this.fieldOfViewOffsetInterpolator0=new ju(this.getBrowser().getPrivateScene()),this.fieldOfViewOffsetInterpolator1=new ju(this.getBrowser().getPrivateScene()),this.fieldOfViewOffsetInterpolator2=new ju(this.getBrowser().getPrivateScene()),this.fieldOfViewOffsetInterpolator3=new ju(this.getBrowser().getPrivateScene())}up.prototype=Object.assign(Object.create(qu.prototype),{constructor:up,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new Y([new B(c.inputOutput,"metadata",new Ri.SFNode),new B(c.inputOnly,"set_bind",new Ri.SFBool),new B(c.inputOutput,"description",new Ri.SFString),new B(c.inputOutput,"position",new Ri.SFVec3f(0,0,10)),new B(c.inputOutput,"orientation",new Ri.SFRotation),new B(c.inputOutput,"centerOfRotation",new Ri.SFVec3f),new B(c.inputOutput,"fieldOfView",new Ri.MFFloat(-1,-1,1,1)),new B(c.inputOutput,"nearDistance",new Ri.SFFloat(-1)),new B(c.inputOutput,"farDistance",new Ri.SFFloat(-1)),new B(c.inputOutput,"viewAll",new Ri.SFBool(!1)),new B(c.inputOutput,"jump",new Ri.SFBool(!0)),new B(c.inputOutput,"retainUserOffsets",new Ri.SFBool),new B(c.outputOnly,"isBound",new Ri.SFBool),new B(c.outputOnly,"bindTime",new Ri.SFTime),new B(c.inputOutput,"navigationInfo",new Ri.SFNode)]),getTypeName:function(){return"OrthoViewpoint"},getComponentName:function(){return"Navigation"},getContainerField:function(){return"children"},initialize:function(){qu.prototype.initialize.call(this),this.fieldOfViewOffsetInterpolator0._key=new Ri.MFFloat(0,1),this.fieldOfViewOffsetInterpolator1._key=new Ri.MFFloat(0,1),this.fieldOfViewOffsetInterpolator2._key=new Ri.MFFloat(0,1),this.fieldOfViewOffsetInterpolator3._key=new Ri.MFFloat(0,1),this.fieldOfViewOffsetInterpolator0.setup(),this.fieldOfViewOffsetInterpolator1.setup(),this.fieldOfViewOffsetInterpolator2.setup(),this.fieldOfViewOffsetInterpolator3.setup(),this.easeInEaseOut._modifiedFraction_changed.addFieldInterest(this.fieldOfViewOffsetInterpolator0._set_fraction),this.easeInEaseOut._modifiedFraction_changed.addFieldInterest(this.fieldOfViewOffsetInterpolator1._set_fraction),this.easeInEaseOut._modifiedFraction_changed.addFieldInterest(this.fieldOfViewOffsetInterpolator2._set_fraction),this.easeInEaseOut._modifiedFraction_changed.addFieldInterest(this.fieldOfViewOffsetInterpolator3._set_fraction),this.fieldOfViewOffsetInterpolator0._value_changed.addInterest("set_fieldOfViewOffset__",this),this.fieldOfViewOffsetInterpolator1._value_changed.addInterest("set_fieldOfViewOffset__",this),this.fieldOfViewOffsetInterpolator2._value_changed.addInterest("set_fieldOfViewOffset__",this),this.fieldOfViewOffsetInterpolator3._value_changed.addInterest("set_fieldOfViewOffset__",this)},set_fieldOfViewOffset__:function(){this._fieldOfViewOffset[0]=this.fieldOfViewOffsetInterpolator0._value_changed.getValue(),this._fieldOfViewOffset[1]=this.fieldOfViewOffsetInterpolator1._value_changed.getValue(),this._fieldOfViewOffset[2]=this.fieldOfViewOffsetInterpolator2._value_changed.getValue(),this._fieldOfViewOffset[3]=this.fieldOfViewOffsetInterpolator3._value_changed.getValue()},resetUserOffsets:function(){qu.prototype.resetUserOffsets.call(this),this._fieldOfViewOffset[0]=0,this._fieldOfViewOffset[1]=0,this._fieldOfViewOffset[2]=0,this._fieldOfViewOffset[3]=0},getRelativeTransformation:function(t){const e=qu.prototype.getRelativeTransformation.call(this,t);return t.constructor===this.constructor&&(e.userMinimumX=t.getUserMinimumX(),e.userMinimumY=t.getUserMinimumY(),e.userMaximumX=t.getUserMaximumX(),e.userMaximumY=t.getUserMaximumY()),e},setInterpolators:function(t,e,n){if(t.constructor===e.constructor){const t=n.userMinimumX-e.getMinimumX(),i=n.userMinimumY-e.getMinimumY(),o=n.userMaximumX-e.getMaximumX(),r=n.userMaximumY-e.getMaximumY();this.fieldOfViewOffsetInterpolator0._keyValue=new Ri.MFFloat(t,e._fieldOfViewOffset[0]),this.fieldOfViewOffsetInterpolator1._keyValue=new Ri.MFFloat(i,e._fieldOfViewOffset[1]),this.fieldOfViewOffsetInterpolator2._keyValue=new Ri.MFFloat(o,e._fieldOfViewOffset[2]),this.fieldOfViewOffsetInterpolator3._keyValue=new Ri.MFFloat(r,e._fieldOfViewOffset[3]),this.fieldOfViewScaleInterpolator._keyValue=new Ri.MFFloat(1,e._fieldOfViewScale.getValue()),this._fieldOfViewOffset[0]=n.offset0,this._fieldOfViewOffset[1]=n.offset1,this._fieldOfViewOffset[2]=n.offset2,this._fieldOfViewOffset[3]=n.offset3,this._fieldOfViewScale=1}else this.fieldOfViewOffsetInterpolator0._keyValue=new Ri.MFFloat(e._fieldOfViewOffset[0],e._fieldOfViewOffset[0]),this.fieldOfViewOffsetInterpolator1._keyValue=new Ri.MFFloat(e._fieldOfViewOffset[1],e._fieldOfViewOffset[1]),this.fieldOfViewOffsetInterpolator2._keyValue=new Ri.MFFloat(e._fieldOfViewOffset[2],e._fieldOfViewOffset[2]),this.fieldOfViewOffsetInterpolator3._keyValue=new Ri.MFFloat(e._fieldOfViewOffset[3],e._fieldOfViewOffset[3]),this.fieldOfViewScaleInterpolator._keyValue=new Ri.MFFloat(1,e._fieldOfViewOffset.getValue()),this._fieldOfViewOffset=e._fieldOfViewOffset.getValue(),this._fieldOfViewScale=1},getLogarithmicDepthBuffer:function(){return!1},getMinimumX:function(){return this._fieldOfView.length>0?this._fieldOfView[0]:-1},getUserMinimumX:function(){return(this.getMinimumX()+this._fieldOfViewOffset[0])*this._fieldOfViewScale.getValue()},getMinimumY:function(){return this._fieldOfView.length>1?this._fieldOfView[1]:-1},getUserMinimumY:function(){return(this.getMinimumY()+this._fieldOfViewOffset[1])*this._fieldOfViewScale.getValue()},getMaximumX:function(){return this._fieldOfView.length>2?this._fieldOfView[2]:1},getUserMaximumX:function(){return(this.getMaximumX()+this._fieldOfViewOffset[2])*this._fieldOfViewScale.getValue()},getMaximumY:function(){return this._fieldOfView.length>3?this._fieldOfView[3]:1},getUserMaximumY:function(){return(this.getMaximumY()+this._fieldOfViewOffset[3])*this._fieldOfViewScale.getValue()},getSizeX:function(){return this.getMaximumX()-this.getMinimumX()},getUserSizeX:function(){return this.getUserMaximumX()-this.getUserMinimumX()},getSizeY:function(){return this.getMaximumY()-this.getMinimumY()},getUserSizeY:function(){return this.getUserMaximumY()-this.getUserMinimumY()},getMaxFarValue:function(){return 1e5},getScreenScale:function(t,e,n){const i=e[2],o=e[3],r=this.getUserSizeX(),s=this.getUserSizeY();if(i/o>r/s){const t=s/o;return n.set(t,t,t)}{const t=r/i;return n.set(t,t,t)}},getViewportSize:function(){const t=new de(0,0);return function(e,n){const i=e[2],o=e[3],r=this.getUserSizeX(),s=this.getUserSizeY(),a=i/o;return a>r/s?t.set(s*a,s):t.set(r,r/a)}}(),getLookAtDistance:function(t){return t.size.magnitude()/2+10},getProjectionMatrixWithLimits:function(t,e,n){const i=n[2]/n[3],o=this.getUserSizeX(),r=this.getUserSizeY();if(i>o/r){const n=(this.getUserMinimumX()+this.getUserMaximumX())/2,o=r*i/2;return qs.ortho(n-o,n+o,this.getUserMinimumY(),this.getUserMaximumY(),t,e,this.projectionMatrix)}{const n=(this.getUserMinimumY()+this.getUserMaximumY())/2,r=o/i/2;return qs.ortho(this.getUserMinimumX(),this.getUserMaximumX(),n-r,n+r,t,e,this.projectionMatrix)}},viewAll:function(t){const e=t.size,n=e.x/this.getSizeX(),i=e.y/this.getSizeY(),o=1.1*Math.max(n,i);this._fieldOfViewOffset[0]=this.getMinimumX()*o-this.getMinimumX(),this._fieldOfViewOffset[1]=this.getMinimumY()*o-this.getMinimumY(),this._fieldOfViewOffset[2]=this.getMaximumX()*o-this.getMaximumX(),this._fieldOfViewOffset[3]=this.getMaximumY()*o-this.getMaximumY(),qu.prototype.viewAll.call(this,t)}});const cp=up;n.set("x_ite/Components/Navigation/OrthoViewpoint",cp);const lp=cp;function hp(t,e){$i.call(this,t),this.navigationInfo=e}hp.prototype=Object.assign(Object.create($i.prototype),{constructor:hp,getTypeName:function(){return"X3DViewer"},initialize:function(){},getActiveLayer:function(){return this.getBrowser().getActiveLayer()},getViewport:function(){return this.getBrowser().getActiveLayer().getViewport()},getNavigationInfo:function(){return this.navigationInfo},getActiveViewpoint:function(){return this.getBrowser().getActiveLayer().getViewpoint()},getStraightenHorizon:function(){return this.getBrowser().getBrowserOption("StraightenHorizon")},getButton:function(t){return 0===t&&this.getBrowser().getAltKey()?1:t},getPointOnCenterPlane:function(){const t=new xe(0,0,-1),e=new xe(0,0,0),n=new xe(0,0,0);return function(i,o,r){const s=this.getNavigationInfo(),a=this.getActiveViewpoint(),u=this.getViewport().getRectangle(),c=a.getProjectionMatrixWithLimits(s.getNearValue(),s.getFarValue(a),u);if(Rs.unProjectPoint(i,this.getBrowser().getViewport()[3]-o,.9,hn.Identity,c,u,n),a instanceof lp)return r.set(n.x,n.y,-this.getDistanceToCenter(e).magnitude());const l=n.normalize();return r.assign(l).multiply(this.getDistanceToCenter(e).magnitude()/l.dot(t))}}(),getDistanceToCenter:function(t,e){const n=this.getActiveViewpoint();return t.assign(n.getPosition()).add(e||n._positionOffset.getValue()).subtract(n.getUserCenterOfRotation())},trackballProjectToSphere:function(t,e,n){const i=this.getViewport().getRectangle();return e=this.getBrowser().getViewport()[3]-e,t=(t-i[0])/i[2]-.5,e=(e-i[1])/i[3]-.5,n.set(t,e,function(t,e,n){const i=Math.hypot(e,n);if(i<t*Math.sqrt(.5))return Math.sqrt(t*t-i*i);const o=t/Math.sqrt(2);return o*o/i}(.5,t,e))},lookAtPoint:function(t,e,n){if(!this.touch(t,e))return;const i=this.getBrowser().getNearestHit();this.getActiveViewpoint().lookAtPoint(this.getActiveLayer(),i.intersection.point,.381966,n)},lookAtBBox:function(){const t=new Ks;return function(e,n,i){if(!this.touch(e,n))return;const o=this.getBrowser().getNearestHit();o.shape.getBBox(t).multRight(o.modelViewMatrix),this.getActiveViewpoint().lookAtBBox(this.getActiveLayer(),t,.381966,i)}}(),touch:function(t,e){return this.getBrowser().touch(t,e,!1),this.getBrowser().getHits().length},dispose:function(){}});const dp=hp;n.set("x_ite/Browser/Navigation/X3DViewer",dp);const pp=dp;function fp(t){ha.call(this,t),this.addType(c.X3DFollowerNode),this.buffer=[],this.a=this.getVector(),this.vector=this.getVector()}fp.prototype=Object.assign(Object.create(ha.prototype),{constructor:fp,initialize:function(){ha.prototype.initialize.call(this),this.isLive().addInterest("set_live__",this)},getBuffer:function(){return this.buffer},getValue:function(){return this._set_value.getValue()},getDestination:function(){return this._set_destination.getValue()},getInitialValue:function(){return this._initialValue.getValue()},getInitialDestination:function(){return this._initialDestination.getValue()},setValue:function(t){this._value_changed=t},setDestination:function(t){this.destination.assign(t)},duplicate:function(t){return t.copy()},assign:function(t,e,n){t[e].assign(n)},equals:function(t,e,n){return this.a.assign(t).subtract(e).magnitude()<n},interpolate:function(t,e,n){return this.vector.assign(t).lerp(e,n)},set_live__:function(){(this.isLive().getValue()||this.isPrivate())&&this._isActive.getValue()?(this.getBrowser().prepareEvents().addInterest("prepareEvents",this),this.getBrowser().addBrowserEvent()):this.getBrowser().prepareEvents().removeInterest("prepareEvents",this)},set_active:function(t){t!==this._isActive.getValue()&&(this._isActive=t,this.set_live__())}});const gp=fp;n.set("x_ite/Components/Followers/X3DFollowerNode",gp);const mp=gp;function _p(t){mp.call(this,t),this.addType(c.X3DChaserNode),this.destination=null,this.previousValue=null,this.bufferEndTime=0,this.stepTime=0,this.deltaOut=this.getVector()}_p.prototype=Object.assign(Object.create(mp.prototype),{constructor:_p,initialize:function(){mp.prototype.initialize.call(this),this._set_value.addInterest("set_value__",this),this._set_destination.addInterest("set_destination__",this),this._duration.addInterest("set_duration__",this),this.set_duration__();var t=this.getBuffer(),e=this.getInitialValue(),n=this.getInitialDestination(),i=this.getNumBuffers();this.bufferEndTime=this.getBrowser().getCurrentTime(),this.previousValue=this.duplicate(e),t[0]=this.duplicate(n);for(var o=1;o<i;++o)t[o]=this.duplicate(e);this.destination=this.duplicate(n),this.equals(n,e,this.getTolerance())?this.setValue(n):this.set_active(!0)},getNumBuffers:function(){return 60},getTolerance:function(){return 1e-8},getArray:function(){return this.getVector()},setPreviousValue:function(t){this.previousValue.assign(t)},step:function(t,e,n){this.output.add(this.deltaOut.assign(t).subtract(e).multiply(n))},stepResponse:function(t){if(t<=0)return 0;var e=this._duration.getValue();return t>=e?1:.5-.5*Math.cos(t/e*Math.PI)},set_value__:function(){this._isActive.getValue()||(this.bufferEndTime=this.getBrowser().getCurrentTime());for(var t=this.getBuffer(),e=this.getValue(),n=0,i=t.length;n<i;++n)this.assign(t,n,e);this.setPreviousValue(e),this.setValue(e),this.set_active(!0)},set_destination__:function(){this.setDestination(this.getDestination()),this._isActive.getValue()||(this.bufferEndTime=this.getBrowser().getCurrentTime()),this.set_active(!0)},set_duration__:function(){this.stepTime=this._duration.getValue()/this.getNumBuffers()},prepareEvents:function(){var t=this.getBuffer(),e=t.length,n=this.updateBuffer();this.output=this.interpolate(this.previousValue,t[e-1],this.stepResponse((e-1+n)*this.stepTime));for(var i=e-2;i>=0;--i)this.step(t[i],t[i+1],this.stepResponse((i+n)*this.stepTime));this.setValue(this.output),this.equals(this.output,this.destination,this.getTolerance())&&this.set_active(!1)},updateBuffer:function(){var t=this.getBuffer(),e=t.length,n=(this.getBrowser().getCurrentTime()-this.bufferEndTime)/this.stepTime;if(n>=1){var i=Math.floor(n);if(n-=i,i<e){this.setPreviousValue(t[e-i]);for(var o=e-1;o>=i;--o)this.assign(t,o,t[o-i]);for(o=0;o<i;++o){var r=o/i;this.assign(t,o,this.interpolate(this.destination,t[i],r))}}else{this.setPreviousValue(i==e?t[0]:this.destination);for(o=0;o<e;++o)this.assign(t,o,this.destination)}this.bufferEndTime+=i*this.stepTime}return n}});const xp=_p;n.set("x_ite/Components/Followers/X3DChaserNode",xp);const yp=xp;function wp(t){yp.call(this,t),this.addType(c.PositionChaser)}wp.prototype=Object.assign(Object.create(yp.prototype),{constructor:wp,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new Y([new B(c.inputOutput,"metadata",new Ri.SFNode),new B(c.inputOnly,"set_value",new Ri.SFVec3f),new B(c.inputOnly,"set_destination",new Ri.SFVec3f),new B(c.initializeOnly,"initialValue",new Ri.SFVec3f),new B(c.initializeOnly,"initialDestination",new Ri.SFVec3f),new B(c.initializeOnly,"duration",new Ri.SFTime(1)),new B(c.outputOnly,"isActive",new Ri.SFBool),new B(c.outputOnly,"value_changed",new Ri.SFVec3f)]),getTypeName:function(){return"PositionChaser"},getComponentName:function(){return"Followers"},getContainerField:function(){return"children"},getVector:function(){return new xe(0,0,0)}});const Sp=wp;n.set("x_ite/Components/Followers/PositionChaser",Sp);const Tp=Sp;var bp=new an(0,0,1,0),vp=new an(0,0,1,0);function Cp(t){yp.call(this,t),this.addType(c.OrientationChaser),this._set_value.setUnit("angle"),this._set_destination.setUnit("angle"),this._initialValue.setUnit("angle"),this._initialDestination.setUnit("angle"),this._value_changed.setUnit("angle")}Cp.prototype=Object.assign(Object.create(yp.prototype),{constructor:Cp,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new Y([new B(c.inputOutput,"metadata",new Ri.SFNode),new B(c.inputOnly,"set_value",new Ri.SFRotation),new B(c.inputOnly,"set_destination",new Ri.SFRotation),new B(c.initializeOnly,"initialValue",new Ri.SFRotation),new B(c.initializeOnly,"initialDestination",new Ri.SFRotation),new B(c.initializeOnly,"duration",new Ri.SFTime(1)),new B(c.outputOnly,"isActive",new Ri.SFBool),new B(c.outputOnly,"value_changed",new Ri.SFRotation)]),getTypeName:function(){return"OrientationChaser"},getComponentName:function(){return"Followers"},getContainerField:function(){return"children"},getVector:function(){return new an(0,0,1,0)},equals:function(t,e,n){return bp.assign(t).inverse().multRight(e),Math.abs(bp.angle)<n},interpolate:function(t,e,n){return vp.assign(t).slerp(e,n)},step:function(t,e,n){this.deltaOut.assign(e).inverse().multRight(t).multLeft(this.output),this.output.slerp(this.deltaOut,n)}});const Ep=Cp;n.set("x_ite/Components/Followers/OrientationChaser",Ep);const Op=Ep;i(50);var Np=i(603);const Fp=/Mac OS X/i.test(navigator.userAgent),Ip=Fp?1/120:.05;function Mp(t,e){pp.call(this,t,e),this.button=-1,this.orientationOffset=new an(0,0,1,0),this.fromVector=new xe(0,0,0),this.toVector=new xe(0,0,0),this.fromPoint=new xe(0,0,0),this.toPoint=new xe(0,0,0),this.rotation=new an(0,0,1,0),this.direction=new xe(0,0,0),this.axis=new xe(0,0,0),this.pressTime=0,this.motionTime=0,this.touchMode=0,this.touch1=new de(0,0),this.touch2=new de(0,0),this.tapStart=0,this.dblTapInterval=.4,this.initialPositionOffset=new xe(0,0,0),this.initialOrientationOffset=new an(0,0,1,0),this.positionChaser=new Tp(t),this.centerOfRotationChaser=new Tp(t),this.rotationChaser=new Op(t),this.timeSensor=new Nu(t)}Mp.prototype=Object.assign(Object.create(pp.prototype),{constructor:Mp,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new Y([new B(c.outputOnly,"isActive",new Ri.SFBool)]),initialize:function(){pp.prototype.initialize.call(this);const t=this.getBrowser(),e=t.getSurface();this.getNavigationInfo()._transitionStart.addInterest("disconnect",this),t.getBrowserOptions()._StraightenHorizon.addInterest("disconnect",this),t._activeViewpoint.addInterest("set_activeViewpoint__",this),e.on("mousedown.ExamineViewer",this.mousedown.bind(this)),e.on("mouseup.ExamineViewer",this.mouseup.bind(this)),e.on("dblclick.ExamineViewer",this.dblclick.bind(this)),e.on("mousewheel.ExamineViewer",this.mousewheel.bind(this)),e.on("touchstart.ExamineViewer",this.touchstart.bind(this)),e.on("touchend.ExamineViewer",this.touchend.bind(this)),this.positionChaser._duration=.2,this.positionChaser.setPrivate(!0),this.positionChaser.setup(),this.centerOfRotationChaser._duration=.2,this.centerOfRotationChaser.setPrivate(!0),this.centerOfRotationChaser.setup(),this.rotationChaser._duration=.2,this.rotationChaser.setPrivate(!0),this.rotationChaser.setup(),this.timeSensor._loop=!0,this.timeSensor._stopTime=t.getCurrentTime(),this.timeSensor.setPrivate(!0),this.timeSensor.setup(),this.timeSensor._fraction_changed.addInterest("spin",this),this.set_activeViewpoint__()},set_activeViewpoint__:function(){if(this.getStraightenHorizon()){const t=this.getActiveViewpoint();t&&(t._orientationOffset=this.getOrientationOffset(an.Identity,t._orientationOffset.getValue(),!1))}this.disconnect()},mousedown:function(t){if(this.button>=0)return;this.pressTime=Date.now();const e=this.getBrowser().getSurface().offset(),n=t.pageX-e.left,i=t.pageY-e.top;switch(this.getButton(t.button)){case 0:t.preventDefault(),t.stopImmediatePropagation(),this.button=t.button,Np(document).on("mouseup.ExamineViewer"+this.getId(),this.mouseup.bind(this)),Np(document).on("mousemove.ExamineViewer"+this.getId(),this.mousemove.bind(this)),Np(document).on("touchend.ExamineViewer"+this.getId(),this.touchend.bind(this)),Np(document).on("touchmove.ExamineViewer"+this.getId(),this.touchmove.bind(this)),this.disconnect(),this.getActiveViewpoint().transitionStop(),this.getBrowser().setCursor("MOVE"),this.trackballProjectToSphere(n,i,this.fromVector),this.rotation.assign(an.Identity),this.motionTime=0,this._isActive=!0;break;case 1:t.preventDefault(),t.stopImmediatePropagation(),this.button=t.button,Np(document).on("mouseup.ExamineViewer"+this.getId(),this.mouseup.bind(this)),Np(document).on("mousemove.ExamineViewer"+this.getId(),this.mousemove.bind(this)),Np(document).on("touchend.ExamineViewer"+this.getId(),this.touchend.bind(this)),Np(document).on("touchmove.ExamineViewer"+this.getId(),this.touchmove.bind(this)),this.disconnect(),this.getActiveViewpoint().transitionStop(),this.getBrowser().setCursor("MOVE"),this.getPointOnCenterPlane(n,i,this.fromPoint),this._isActive=!0}},mouseup:function(t){if(t.button===this.button)switch(this.button=-1,Np(document).off(".ExamineViewer"+this.getId()),this.getButton(t.button)){case 0:t.preventDefault(),t.stopImmediatePropagation();this.getActiveViewpoint();this.getBrowser().setCursor("DEFAULT"),Math.abs(this.rotation.angle)>.003&&Date.now()-this.motionTime<40&&this.addSpinning(this.rotation),this._isActive=!1;break;case 1:t.preventDefault(),t.stopImmediatePropagation(),this.getBrowser().setCursor("DEFAULT"),this._isActive=!1}},dblclick:function(t){t.preventDefault(),t.stopImmediatePropagation();const e=this.getBrowser().getSurface(),n=e.offset(),i=t.pageX-n.left-parseFloat(e.css("borderLeftWidth")),o=e.innerHeight()-(t.pageY-n.top-parseFloat(e.css("borderTopWidth")));this.disconnect(),this.lookAtBBox(i,o,this.getStraightenHorizon())},mousemove:function(){const t=new xe(0,0,0);return function(e){const n=this.getBrowser().getSurface().offset(),i=e.pageX-n.left,o=e.pageY-n.top;switch(this.getButton(this.button)){case 0:{e.preventDefault(),e.stopImmediatePropagation();const t=this.trackballProjectToSphere(i,o,this.toVector);if(this.rotation.setFromToVec(t,this.fromVector),Math.abs(this.rotation.angle)<.003&&Date.now()-this.pressTime<50)return;this.addRotate(this.rotation),this.fromVector.assign(t),this.motionTime=Date.now();break}case 1:{e.preventDefault(),e.stopImmediatePropagation();const n=this.getActiveViewpoint(),r=this.getPointOnCenterPlane(i,o,this.toPoint),s=n.getUserOrientation().multVecRot(t.assign(this.fromPoint).subtract(r));this.addMove(s,s),this.fromPoint.assign(r);break}}}}(),mousewheel:function(){const t=new xe(0,0,0),e=new xe(0,0,0);return function(n){n.preventDefault(),n.stopImmediatePropagation();const i=this.getBrowser(),o=this.getActiveViewpoint();i.prepareEvents().removeInterest("spin",this),o.transitionStop(),this.getDistanceToCenter(t).multiply(n.zoomFactor||Ip),o.getUserOrientation().multVecRot(e.set(0,0,t.magnitude())),n.deltaY>0?this.addMove(e.negate(),xe.Zero):n.deltaY<0&&this.addMove(e,xe.Zero)}}(),touchstart:function(t){const e=t.originalEvent.touches;switch(e.length){case 1:t.button=0,t.pageX=e[0].pageX,t.pageY=e[0].pageY,this.mousedown(t),this.touch1.set(e[0].pageX,e[0].pageY);break;case 2:this.touchend(t),t.button=1,t.pageX=(e[0].pageX+e[1].pageX)/2,t.pageY=(e[0].pageY+e[1].pageY)/2,this.mousedown(t),this.touch1.set(e[0].pageX,e[0].pageY),this.touch2.set(e[1].pageX,e[1].pageY);break;case 3:this.touchend(t)}},touchend:function(t){switch(this.button){case 0:t.button=0,t.pageX=this.touch1.x,t.pageY=this.touch1.y,this.mouseup(t),this.tapedTwice?this.dblclick(t):(this.tapedTwice=!0,setTimeout(function(){this.tapedTwice=!1}.bind(this),300));break;case 1:this.touchMode=0,t.button=1,this.mouseup(t)}},touchmove:function(){const t=new de(0,0),e=new de(0,0);return function(n){const i=n.originalEvent.touches;switch(i.length){case 1:n.pageX=i[0].pageX,n.pageY=i[0].pageY,this.mousemove(n);break;case 2:{t.set(i[0].pageX,i[0].pageY).subtract(this.touch1).normalize(),e.set(i[1].pageX,i[1].pageY).subtract(this.touch2).normalize();const o=t.dot(e)>.7,r=t.dot(e)<-.7;switch(this.touchMode||(o?1:r?2:0)){case 1:this.touchMode=1,n.pageX=(i[0].pageX+i[1].pageX)/2,n.pageY=(i[0].pageY+i[1].pageY)/2,this.mousemove(n);break;case 2:{this.touchMode=2;const t=this.touch1.distance(this.touch2);this.touch1.set(i[0].pageX,i[0].pageY),this.touch2.set(i[1].pageX,i[1].pageY);const e=this.touch1.distance(this.touch2)-t;n.deltaY=e,n.zoomFactor=Math.abs(e)/Np(window).width(),this.mousewheel(n);break}}this.touch1.set(i[0].pageX,i[0].pageY),this.touch2.set(i[1].pageX,i[1].pageY);break}}}}(),set_positionOffset__:function(t){this.getActiveViewpoint()._positionOffset=t},set_centerOfRotationOffset__:function(t){this.getActiveViewpoint()._centerOfRotationOffset=t},set_rotation__:function(t){const e=this.getActiveViewpoint();e._orientationOffset=this.getOrientationOffset(t.getValue(),this.initialOrientationOffset,!1),e._positionOffset=this.getPositionOffset(this.initialPositionOffset,this.initialOrientationOffset,e._orientationOffset.getValue())},addRotate:function(){const t=new an;return function(e){const n=this.getActiveViewpoint();if(this.rotationChaser._isActive.getValue()&&this.rotationChaser._value_changed.hasInterest("set_rotation__",this))try{t.assign(this.rotationChaser._set_destination.getValue()).multLeft(e),this.getOrientationOffset(t,this.initialOrientationOffset,!0),this.rotationChaser._set_destination=t}catch(n){e=this.getHorizonRotation(e),t.assign(this.rotationChaser._set_destination.getValue()).multLeft(e),this.rotationChaser._set_destination=t}else try{this.initialOrientationOffset.assign(n._orientationOffset.getValue()),this.initialPositionOffset.assign(n._positionOffset.getValue()),this.getOrientationOffset(e,this.initialOrientationOffset,!0),this.rotationChaser._set_value=an.Identity,this.rotationChaser._set_destination=e}catch(t){this.rotationChaser._set_value=an.Identity,this.rotationChaser._set_destination=this.getHorizonRotation(e)}this.disconnect(),this.rotationChaser._value_changed.addInterest("set_rotation__",this)}}(),addSpinning:function(t){if(this.disconnect(),this.getStraightenHorizon()){const e=this.getActiveViewpoint(),n=e.getUserPosition(),i=e.getUserCenterOfRotation(),o=xe.subtract(n,i),r=this.getHorizonRotation(t),s=e.getUpVector(!0);this.axis.assign(s),r.getAxis().dot(xe.yAxis)<0!=r.angle<0&&this.axis.negate(),this.timeSensor._cycleInterval=Math.PI/(.4*t.angle*30),this.timeSensor._startTime=this.getBrowser().getCurrentTime();const a=e.getLookAtRotation(n,i);this.direction.assign(o),this.orientationOffset.assign(e.getUserOrientation()).multRight(a.inverse())}else this.getBrowser().prepareEvents().addInterest("spin",this),this.rotation.assign(t)},spin:function(){const t=new xe(0,0,0),e=new xe(0,0,0),n=new an,i=new an;return function(){const o=this.getActiveViewpoint();if(this.getStraightenHorizon()){const i=o.getUserCenterOfRotation(),r=this.timeSensor._fraction_changed.getValue(),s=new an(this.axis,2*Math.PI*r).multVecRot(t.assign(this.direction)).add(i),a=o.getLookAtRotation(s,o.getUserCenterOfRotation());e.assign(s).subtract(o.getPosition()),n.assign(o.getOrientation()).inverse().multRight(this.orientationOffset).multRight(a),o._positionOffset=e,o._orientationOffset=n}else i.assign(an.Identity).slerp(this.rotation,24/this.getBrowser().getCurrentFrameRate()),this.orientationOffset.assign(o._orientationOffset.getValue()),o._orientationOffset=this.getOrientationOffset(i,this.orientationOffset),o._positionOffset=this.getPositionOffset(o._positionOffset.getValue(),this.orientationOffset,o._orientationOffset.getValue())}}(),addMove:function(){const t=new xe(0,0,0),e=new xe(0,0,0);return function(n,i){const o=this.getActiveViewpoint();this.positionChaser._isActive.getValue()&&this.positionChaser._value_changed.hasInterest("set_positionOffset__",this)?(t.assign(this.positionChaser._set_destination.getValue()).add(n),this.positionChaser._set_destination=t):(t.assign(o._positionOffset.getValue()).add(n),this.positionChaser._set_value=o._positionOffset,this.positionChaser._set_destination=t),this.centerOfRotationChaser._isActive.getValue()&&this.centerOfRotationChaser._value_changed.hasInterest("set_centerOfRotationOffset__",this)?(e.assign(this.centerOfRotationChaser._set_destination.getValue()).add(i),this.centerOfRotationChaser._set_destination=e):(e.assign(o._centerOfRotationOffset.getValue()).add(i),this.centerOfRotationChaser._set_value=o._centerOfRotationOffset,this.centerOfRotationChaser._set_destination=e),this.disconnect(),this.positionChaser._value_changed.addInterest("set_positionOffset__",this),this.centerOfRotationChaser._value_changed.addInterest("set_centerOfRotationOffset__",this)}}(),getPositionOffset:function(){const t=new xe(0,0,0),e=new xe(0,0,0),n=new an(0,0,1,0);return function(i,o,r){return this.getDistanceToCenter(t,i),n.assign(o).inverse().multRight(r).multVecRot(e.assign(t)).subtract(t).add(i)}}(),getOrientationOffset:function(){const t=new an(0,0,1,0),e=new an(0,0,1,0),n=new xe(0,0,0);return function(i,o,r){const s=this.getActiveViewpoint(),a=this.getStraightenHorizon();t.assign(i).multRight(s.getOrientation()).multRight(o),a&&s.straightenHorizon(t,s.getUpVector(!0));const u=e.assign(s.getOrientation()).inverse().multRight(t);if(a){if(!r)return u;const e=t.multVecRot(n.assign(xe.zAxis));if(Math.abs(s.getUpVector(!0).dot(e))<.97)return u;throw new Error("Critical angle")}return u}}(),getHorizonRotation:function(){const t=new xe(0,0,0);return function(e){const n=e.multVecRot(t.assign(xe.zAxis)),i=xe.cross(xe.yAxis,n),o=xe.cross(i,xe.yAxis);return new an(xe.zAxis,o)}}(),disconnect:function(){const t=this.getBrowser();this.positionChaser._value_changed.removeInterest("set_positionOffset__",this),this.centerOfRotationChaser._value_changed.removeInterest("set_centerOfRotationOffset__",this),this.rotationChaser._value_changed.removeInterest("set_rotation__",this),this.timeSensor._stopTime=t.getCurrentTime(),t.prepareEvents().removeInterest("spin",this)},dispose:function(){const t=this.getBrowser();this.disconnect(),this.getNavigationInfo()._transitionStart.removeInterest("disconnect",this),t.getBrowserOptions()._StraightenHorizon.removeInterest("disconnect",this),t._activeViewpoint.removeInterest("set_activeViewpoint__",this),t.getSurface().off(".ExamineViewer"),Np(document).off(".ExamineViewer"+this.getId())}});const Dp=Mp;n.set("x_ite/Browser/Navigation/ExamineViewer",Dp);const Vp=Dp;i(50);var Rp=i(603);const Pp=/Mac OS X/i.test(navigator.userAgent),Ap=.007,Lp=Pp?Math.PI/512:Math.PI/32;function Bp(t,e){pp.call(this,t,e);const n=this.getBrowser().getContext();this.button=-1,this.fromVector=new xe(0,0,0),this.toVector=new xe(0,0,0),this.direction=new xe(0,0,0),this.startTime=0,this.event=null,this.lookAround=!1,this.orientationChaser=new Op(t),this.lineCount=2,this.lineArray=new Float32Array(4*this.lineCount).fill(1),this.lineBuffer=n.createBuffer(),this.lineArrayObject=new Ma,this.geometryContext=new Ba({geometryType:1})}Bp.prototype=Object.assign(Object.create(pp.prototype),{constructor:Bp,initialize:function(){pp.prototype.initialize.call(this);const t=this.getBrowser(),e=t.getSurface();e.on("mousedown.X3DFlyViewer",this.mousedown.bind(this)),e.on("mouseup.X3DFlyViewer",this.mouseup.bind(this)),e.on("mousewheel.X3DFlyViewer",this.mousewheel.bind(this)),e.on("touchstart.X3DFlyViewer",this.touchstart.bind(this)),e.on("touchend.X3DFlyViewer",this.touchend.bind(this)),t._controlKey.addInterest("set_controlKey__",this),this.orientationChaser._duration=.3,this.orientationChaser.setPrivate(!0),this.orientationChaser.setup()},addCollision:function(){},removeCollision:function(){},set_controlKey__:function(){this.event&&0===this.event.button&&(this.button=-1,this.mousedown(this.event))},mousedown:function(t){if(this.button>=0)return;this.event=t;const e=this.getBrowser().getSurface().offset(),n=t.pageX-e.left,i=t.pageY-e.top;switch(this.getButton(t.button)){case 0:t.preventDefault(),t.stopImmediatePropagation(),this.button=t.button,Rp(document).on("mouseup.X3DFlyViewer"+this.getId(),this.mouseup.bind(this)),Rp(document).on("mousemove.X3DFlyViewer"+this.getId(),this.mousemove.bind(this)),Rp(document).on("touchend.X3DFlyViewer"+this.getId(),this.touchend.bind(this)),Rp(document).on("touchmove.X3DFlyViewer"+this.getId(),this.touchmove.bind(this)),this.disconnect(),this.getActiveViewpoint().transitionStop(),this.getBrowser().setCursor("MOVE"),this.addCollision(),this.getBrowser().getControlKey()||this.lookAround?this.trackballProjectToSphere(n,i,this.fromVector):(this.fromVector.set(n,0,i),this.toVector.assign(this.fromVector),this.getFlyDirection(this.fromVector,this.toVector,this.direction),this.addFly(),this.getBrowser().getBrowserOption("Rubberband")&&this.getBrowser().finished().addInterest("display",this,0)),this._isActive=!0;break;case 1:t.preventDefault(),t.stopImmediatePropagation(),this.button=t.button,Rp(document).on("mouseup.X3DFlyViewer"+this.getId(),this.mouseup.bind(this)),Rp(document).on("mousemove.X3DFlyViewer"+this.getId(),this.mousemove.bind(this)),this.disconnect(),this.getActiveViewpoint().transitionStop(),this.getBrowser().setCursor("MOVE"),this.addCollision(),this.fromVector.set(n,-i,0),this.toVector.assign(this.fromVector),this.direction.set(0,0,0),this.addPan(),this.getBrowser().getBrowserOption("Rubberband")&&this.getBrowser().finished().addInterest("display",this,1),this._isActive=!0}},mouseup:function(t){t.preventDefault(),t.button===this.button&&(this.event=null,this.button=-1,Rp(document).off(".X3DFlyViewer"+this.getId()),this.disconnect(),this.getBrowser().setCursor("DEFAULT"),this.removeCollision(),this._isActive=!1)},mousemove:function(t){this.getBrowser().addBrowserEvent(),this.event=t;const e=this.getBrowser().getSurface().offset(),n=t.pageX-e.left,i=t.pageY-e.top;switch(this.getButton(this.button)){case 0:if(this.getBrowser().getControlKey()||this.lookAround){t.preventDefault(),t.stopImmediatePropagation();const e=this.trackballProjectToSphere(n,i,this.toVector);this.addRotation(this.fromVector,e),this.fromVector.assign(e);break}this.toVector.set(n,0,i),this.getFlyDirection(this.fromVector,this.toVector,this.direction);break;case 1:t.preventDefault(),t.stopImmediatePropagation(),this.toVector.set(n,-i,0),this.direction.assign(this.toVector).subtract(this.fromVector)}},mousewheel:function(t){t.preventDefault(),t.stopImmediatePropagation();this.getActiveViewpoint().transitionStop(),t.deltaY>0?this.addRoll(-Lp):t.deltaY<0&&this.addRoll(Lp)},touchstart:function(t){const e=t.originalEvent.touches;switch(e.length){case 1:t.button=0,t.pageX=e[0].pageX,t.pageY=e[0].pageY,this.mousedown(t);break;case 2:this.touchend(t),this.lookAround=!0,t.button=0,t.pageX=(e[0].pageX+e[1].pageX)/2,t.pageY=(e[0].pageY+e[1].pageY)/2,this.mousedown(t);break;case 3:this.touchend(t)}},touchend:function(t){if(0===this.button)this.lookAround=!1,t.button=0,this.mouseup(t)},touchmove:function(t){const e=t.originalEvent.touches;switch(e.length){case 1:t.button=0,t.pageX=e[0].pageX,t.pageY=e[0].pageY,this.mousemove(t);break;case 2:t.button=0,t.pageX=(e[0].pageX+e[1].pageX)/2,t.pageY=(e[0].pageY+e[1].pageY)/2,this.mousemove(t)}},fly:function(){const t=new xe(0,0,0),e=new xe(0,0,0),n=new xe(0,0,0),i=new an(0,0,1,0),o=new an(0,0,1,0),r=new an(0,0,1,0);return function(){const s=this.getNavigationInfo(),a=this.getActiveViewpoint(),u=Date.now(),c=(u-this.startTime)/1e3;t.assign(a.getUpVector()),this.direction.z>0?r.setFromToVec(this.direction,n.set(0,0,1)):r.setFromToVec(n.set(0,0,-1),this.direction);const l=this.direction.magnitude();let h=1-r.angle/(Math.PI/2);h*=s._speed.getValue(),h*=a.getSpeedFactor(),h*=this.getBrowser().getShiftKey()?.028:Ap,h*=c;const d=this.getTranslationOffset(e.assign(this.direction).multiply(h));this.getActiveLayer().constrainTranslation(d,!0),a._positionOffset=d.add(a._positionOffset.getValue());const p=1.4*c*Math.pow(l/(l+40),2);i.assign(an.Identity).slerp(r,p).multRight(a.getUserOrientation()),this.getStraightenHorizon()&&a.straightenHorizon(i),o.assign(a.getOrientation()).inverse().multRight(i),a._orientationOffset=o,this.startTime=u}}(),pan:function(){const t=new xe(0,0,0),e=new xe(0,0,0);return function(){const n=this.getNavigationInfo(),i=this.getActiveViewpoint(),o=Date.now(),r=(o-this.startTime)/1e3,s=i.getUpVector();this.constrainPanDirection(t.assign(this.direction));let a=1;a*=n._speed.getValue(),a*=i.getSpeedFactor(),a*=this.getBrowser().getShiftKey()?.0098:.007,a*=r;const u=i.getUserOrientation().multRight(new an(i.getUserOrientation().multVecRot(e.assign(xe.yAxis)),s)).multVecRot(t.multiply(a));this.getActiveLayer().constrainTranslation(u,!0),i._positionOffset=u.add(i._positionOffset.getValue()),this.startTime=o}}(),set_orientationOffset__:function(t){this.getActiveViewpoint()._orientationOffset=t},addFly:function(){this.startTime||(this.getBrowser().prepareEvents().addInterest("fly",this),this.getBrowser().addBrowserEvent(),this.startTime=Date.now())},addPan:function(){this.startTime||(this.disconnect(),this.getBrowser().prepareEvents().addInterest("pan",this),this.getBrowser().addBrowserEvent(),this.startTime=Date.now())},addRoll:function(){const t=new an(0,0,1,0),e=new an(0,0,1,0);return function(n){const i=this.getActiveViewpoint();this.orientationChaser._isActive.getValue()&&this.orientationChaser._value_changed.hasInterest("set_orientationOffset__",this)?(t.assign(i.getOrientation()).inverse().multRight(e.set(1,0,0,n)).multRight(i.getOrientation()).multRight(this.orientationChaser._set_destination.getValue()),this.orientationChaser._set_destination=t):(t.assign(i.getOrientation()).inverse().multRight(e.set(1,0,0,n)).multRight(i.getUserOrientation()),this.orientationChaser._set_value=i._orientationOffset,this.orientationChaser._set_destination=t),this.disconnect(),this.orientationChaser._value_changed.addInterest("set_orientationOffset__",this)}}(),addRotation:function(){const t=new an(0,0,1,0),e=new an(0,0,1,0);return function(n,i){const o=this.getActiveViewpoint();this.orientationChaser._isActive.getValue()&&this.orientationChaser._value_changed.hasInterest("set_orientationOffset__",this)?(t.setFromToVec(i,n).multRight(o.getOrientation()).multRight(this.orientationChaser._set_destination.getValue()),this.getStraightenHorizon()&&o.straightenHorizon(t),e.assign(o.getOrientation()).inverse().multRight(t),this.orientationChaser._set_destination=e):(t.setFromToVec(i,n).multRight(o.getUserOrientation()),this.getStraightenHorizon()&&o.straightenHorizon(t),e.assign(o.getOrientation()).inverse().multRight(t),this.orientationChaser._set_value=o._orientationOffset,this.orientationChaser._set_destination=e),this.disconnect(),this.orientationChaser._value_changed.addInterest("set_orientationOffset__",this)}}(),display:function(){const t=new xe(0,0,0),e=new xe(0,0,0),n=new hn,i=new Float32Array(hn.Identity),o=new Float32Array(hn.Identity),r=[];return function(s){const a=this.getBrowser(),u=a.getContext(),c=a.getViewport(),l=c[2],h=c[3];i.set(qs.ortho(0,l,0,h,-1,1,n)),0===s?(t.set(this.fromVector.x,h-this.fromVector.z,0),e.set(this.toVector.x,h-this.toVector.z,0)):(t.set(this.fromVector.x,h+this.fromVector.y,0),e.set(this.toVector.x,h+this.toVector.y,0)),this.lineArray.set(t,0),this.lineArray.set(e,4),u.bindBuffer(u.ARRAY_BUFFER,this.lineBuffer),u.bufferData(u.ARRAY_BUFFER,this.lineArray,u.DYNAMIC_DRAW);const d=a.getDefaultMaterial().getShader(this.geometryContext);d.enable(u),d.setClipPlanes(u,r),u.uniformMatrix4fv(d.x3d_ProjectionMatrix,!1,i),u.uniformMatrix4fv(d.x3d_ModelViewMatrix,!1,o),this.lineArrayObject.enable(u,d)&&d.enableVertexAttribute(u,this.lineBuffer,0,0),u.disable(u.DEPTH_TEST),u.uniform3f(d.x3d_EmissiveColor,0,0,0),u.uniform1f(d.x3d_Transparency,0),u.drawArrays(u.LINES,0,this.lineCount),u.uniform3f(d.x3d_EmissiveColor,1,1,1),u.drawArrays(u.LINES,0,this.lineCount)}}(),disconnect:function(){const t=this.getBrowser();t.addBrowserEvent(),t.prepareEvents().removeInterest("fly",this),t.prepareEvents().removeInterest("pan",this),t.finished().removeInterest("display",this),this.orientationChaser._value_changed.removeInterest("set_orientationOffset__",this),this.startTime=0},dispose:function(){const t=this.getBrowser().getContext();t.deleteBuffer(this.lineBuffer),this.lineArrayObject.delete(t),this.disconnect(),this.getBrowser()._controlKey.removeInterest("set_controlKey__",this),this.getBrowser().getSurface().off(".X3DFlyViewer"),Rp(document).off(".X3DFlyViewer"+this.getId())}});const Xp=Bp;n.set("x_ite/Browser/Navigation/X3DFlyViewer",Xp);const Up=Xp;function kp(t,e){Up.call(this,t,e)}kp.prototype=Object.assign(Object.create(Up.prototype),{constructor:kp,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new Y([new B(c.outputOnly,"isActive",new Ri.SFBool)]),initialize:function(){Up.prototype.initialize.call(this),this.getBrowser().addCollision(this)},getStraightenHorizon:function(){return!0},getFlyDirection:function(t,e,n){return n.assign(e).subtract(t)},getTranslationOffset:function(){const t=new xe(0,0,0),e=new an(0,0,1,0),n=new an(0,0,1,0);return function(i){const o=this.getActiveViewpoint(),r=o.getUpVector();e.assign(o.getUserOrientation()),e.multVecRot(t.assign(xe.yAxis)),n.setFromToVec(t,r);return e.multRight(n).multVecRot(i)}}(),constrainPanDirection:function(t){return t.y<0&&(t.y=0),t},dispose:function(){this.getBrowser().removeCollision(this),Up.prototype.dispose.call(this)}});const zp=kp;n.set("x_ite/Browser/Navigation/WalkViewer",zp);const jp=zp;function Gp(t,e){Up.call(this,t,e)}Gp.prototype=Object.assign(Object.create(Up.prototype),{constructor:Gp,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new Y([new B(c.outputOnly,"isActive",new Ri.SFBool)]),addCollision:function(){this.getBrowser().addCollision(this)},removeCollision:function(){this.getBrowser().removeCollision(this)},getFlyDirection:function(t,e,n){return n.assign(e).subtract(t)},getTranslationOffset:function(t){return this.getActiveViewpoint().getUserOrientation().multVecRot(t)},constrainPanDirection:function(t){return t}});const Hp=Gp;n.set("x_ite/Browser/Navigation/FlyViewer",Hp);const qp=Hp;i(50);var Yp=i(603);const Wp=/Mac OS X/i.test(navigator.userAgent)?1/160:.05,Kp=new xe(0,0,0),Jp=new xe(0,0,0),Zp=new xe(0,0,0);function Qp(t,e){pp.call(this,t,e),this.button=-1,this.fromPoint=new xe(0,0,0),this.toPoint=new xe(0,0,0)}Qp.prototype=Object.assign(Object.create(pp.prototype),{constructor:Qp,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new Y([new B(c.outputOnly,"isActive",new Ri.SFBool)]),initialize:function(){pp.prototype.initialize.call(this);const t=this.getBrowser().getSurface();t.on("mousedown.PlaneViewer",this.mousedown.bind(this)),t.on("mouseup.PlaneViewer",this.mouseup.bind(this)),t.on("mousemove.PlaneViewer",this.mousemove.bind(this)),t.on("mousewheel.PlaneViewer",this.mousewheel.bind(this))},mousedown:function(t){if(this.button>=0)return;const e=this.getBrowser().getSurface().offset(),n=t.pageX-e.left,i=t.pageY-e.top;if(1===this.getButton(t.button))t.preventDefault(),t.stopImmediatePropagation(),this.button=t.button,this.getBrowser().getSurface().off("mousemove.PlaneViewer"),Yp(document).on("mouseup.PlaneViewer"+this.getId(),this.mouseup.bind(this)),Yp(document).on("mousemove.PlaneViewer"+this.getId(),this.mousemove.bind(this)),this.getActiveViewpoint().transitionStop(),this.getBrowser().setCursor("MOVE"),this.getPointOnCenterPlane(n,i,this.fromPoint),this._isActive=!0},mouseup:function(t){t.preventDefault(),t.stopImmediatePropagation(),t.button===this.button&&(this.button=-1,Yp(document).off(".PlaneViewer"+this.getId()),this.getBrowser().getSurface().on("mousemove.PlaneViewer",this.mousemove.bind(this)),this.getBrowser().setCursor("DEFAULT"),this._isActive=!1)},mousemove:function(t){const e=this.getBrowser().getSurface().offset(),n=t.pageX-e.left,i=t.pageY-e.top;switch(this.getButton(this.button)){case 1:{t.preventDefault(),t.stopImmediatePropagation();const e=this.getActiveViewpoint(),o=this.getPointOnCenterPlane(n,i,this.toPoint),r=e.getUserOrientation().multVecRot(this.fromPoint.subtract(o));e._positionOffset=Jp.assign(e._positionOffset.getValue()).add(r),e._centerOfRotationOffset=Zp.assign(e._centerOfRotationOffset.getValue()).add(r),this.fromPoint.assign(o);break}}},mousewheel:function(t){t.preventDefault(),t.stopImmediatePropagation();const e=this.getBrowser().getSurface().offset(),n=t.pageX-e.left,i=t.pageY-e.top,o=this.getActiveViewpoint(),r=this.getPointOnCenterPlane(n,i,this.fromPoint);o.transitionStop(),t.deltaY>0?o._fieldOfViewScale=Math.max(1e-5,o._fieldOfViewScale.getValue()*(1-Wp)):t.deltaY<0&&(o._fieldOfViewScale=o._fieldOfViewScale.getValue()*(1+Wp),this.constrainFieldOfViewScale());const s=this.getPointOnCenterPlane(n,i,this.toPoint),a=o.getUserOrientation().multVecRot(Kp.assign(r).subtract(s));o._positionOffset=Jp.assign(o._positionOffset.getValue()).add(a),o._centerOfRotationOffset=Zp.assign(o._centerOfRotationOffset.getValue()).add(a)},constrainFieldOfViewScale:function(){const t=this.getActiveViewpoint();t.getTypeName().match(/^(?:Viewpoint|GeoViewpoint)$/)&&t._fieldOfView.getValue()*t._fieldOfViewScale.getValue()>=Math.PI&&(t._fieldOfViewScale=(Math.PI-.001)/t._fieldOfView.getValue())},dispose:function(){this.getBrowser().getSurface().off(".PlaneViewer"),Yp(document).off(".PlaneViewer"+this.getId())}});const $p=Qp;n.set("x_ite/Browser/Navigation/PlaneViewer",$p);const tf=$p;function ef(t,e){pp.call(this,t,e)}ef.prototype=Object.assign(Object.create(pp.prototype),{constructor:ef,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new Y([new B(c.outputOnly,"isActive",new Ri.SFBool)])});const nf=ef;n.set("x_ite/Browser/Navigation/NoneViewer",nf);const of=nf;i(50);var rf=i(603);const sf=/Mac OS X/i.test(navigator.userAgent)?1/120:.05;function af(t,e){pp.call(this,t,e),this.button=-1,this.fromVector=new xe(0,0,0),this.toVector=new xe(0,0,0),this.touch1=new de(0,0),this.touch2=new de(0,0),this.tapStart=0,this.dblTapInterval=.4,this.positionChaser=new Tp(t),this.centerOfRotationChaser=new Tp(t),this.orientationChaser=new Op(t)}af.prototype=Object.assign(Object.create(pp.prototype),{constructor:af,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new Y([new B(c.outputOnly,"isActive",new Ri.SFBool)]),initialize:function(){pp.prototype.initialize.call(this);const t=this.getBrowser().getSurface();t.on("mousedown.LookAtViewer",this.mousedown.bind(this)),t.on("mouseup.LookAtViewer",this.mouseup.bind(this)),t.on("dblclick.LookAtViewer",this.dblclick.bind(this)),t.on("mousewheel.LookAtViewer",this.mousewheel.bind(this)),t.on("touchstart.LookAtViewer",this.touchstart.bind(this)),t.on("touchend.LookAtViewer",this.touchend.bind(this)),this.positionChaser._duration=.3,this.positionChaser.setPrivate(!0),this.positionChaser.setup(),this.centerOfRotationChaser._duration=.3,this.centerOfRotationChaser.setPrivate(!0),this.centerOfRotationChaser.setup(),this.orientationChaser._duration=.3,this.orientationChaser.setPrivate(!0),this.orientationChaser.setup()},mousedown:function(t){if(this.button>=0)return;const e=this.getBrowser().getSurface().offset(),n=t.pageX-e.left,i=t.pageY-e.top;if(0===t.button)t.preventDefault(),t.stopImmediatePropagation(),this.button=t.button,rf(document).on("mouseup.LookAtViewer"+this.getId(),this.mouseup.bind(this)),rf(document).on("mousemove.LookAtViewer"+this.getId(),this.mousemove.bind(this)),rf(document).on("touchend.LookAtViewer"+this.getId(),this.mouseup.bind(this)),rf(document).on("touchmove.LookAtViewer"+this.getId(),this.touchmove.bind(this)),this.getActiveViewpoint().transitionStop(),this.trackballProjectToSphere(n,i,this.fromVector),this._isActive=!0},mouseup:function(t){if(t.button===this.button&&(this.button=-1,rf(document).off(".LookAtViewer"+this.getId()),0===t.button))t.preventDefault(),t.stopImmediatePropagation(),this._isActive=!1},dblclick:function(t){t.preventDefault(),t.stopImmediatePropagation();const e=this.getBrowser().getSurface(),n=e.offset(),i=t.pageX-n.left-parseFloat(e.css("borderLeftWidth")),o=e.innerHeight()-(t.pageY-n.top-parseFloat(e.css("borderTopWidth")));this.disconnect(),this.lookAtPoint(i,o,this.getStraightenHorizon())},mousemove:function(t){this.getBrowser().addBrowserEvent(),this.event=t;const e=this.getBrowser().getSurface().offset(),n=t.pageX-e.left,i=t.pageY-e.top;switch(this.button){case 0:{t.preventDefault(),t.stopImmediatePropagation();const e=this.trackballProjectToSphere(n,i,this.toVector);this.addRotation(this.fromVector,e),this.fromVector.assign(e);break}}},mousewheel:function(){const t=new xe(0,0,0),e=new xe(0,0,0);return function(n){n.preventDefault(),n.stopImmediatePropagation();const i=this.getActiveViewpoint();i.transitionStop(),t=this.getDistanceToCenter(t).multiply(n.zoomFactor||sf),e=i.getUserOrientation().multVecRot(e.set(0,0,t.magnitude())),n.deltaY>0?this.addMove(e.negate(),xe.Zero):n.deltaY<0&&this.addMove(e,xe.Zero)}}(),touchstart:function(t){const e=t.originalEvent.touches;switch(e.length){case 1:this.touch1.set(e[0].pageX,e[0].pageY);break;case 2:this.touchend(t),t.button=0,t.pageX=(e[0].pageX+e[1].pageX)/2,t.pageY=(e[0].pageY+e[1].pageY)/2,this.mousedown(t),this.touch1.set(e[0].pageX,e[0].pageY),this.touch2.set(e[1].pageX,e[1].pageY);break;case 3:this.touchend(t)}},touchend:function(t){if(0===this.button)this.mouseup(t);this.getBrowser().getCurrentTime()-this.tapStart<this.dblTapInterval&&(t.button=1,t.pageX=this.touch1.x,t.pageY=this.touch1.y,this.dblclick(t)),this.tapStart=this.getBrowser().getCurrentTime()},touchmove:function(){const t=new de(0,0),e=new de(0,0);return function(n){const i=n.originalEvent.touches;switch(i.length){case 1:break;case 2:{t.set(i[0].pageX,i[0].pageY).subtract(this.touch1).normalize(),e.set(i[1].pageX,i[1].pageY).subtract(this.touch2).normalize();const o=t.dot(e)>.7,r=t.dot(e)<-.7;if(o)n.button=0,n.pageX=(i[0].pageX+i[1].pageX)/2,n.pageY=(i[0].pageY+i[1].pageY)/2,this.mousemove(n);else if(r){const t=this.touch1.distance(this.touch2);this.touch1.set(i[0].pageX,i[0].pageY),this.touch2.set(i[1].pageX,i[1].pageY);const e=this.touch1.distance(this.touch2)-t;n.deltaY=e,n.zoomFactor=Math.abs(e)/rf(window).width(),this.mousewheel(n)}this.touch1.set(i[0].pageX,i[0].pageY),this.touch2.set(i[1].pageX,i[1].pageY);break}}}}(),set_positionOffset__:function(t){this.getActiveViewpoint()._positionOffset=t},set_centerOfRotationOffset__:function(t){this.getActiveViewpoint()._centerOfRotationOffset=t},set_orientationOffset__:function(t){this.getActiveViewpoint()._orientationOffset=t},addMove:function(){const t=new xe(0,0,0),e=new xe(0,0,0);return function(n,i){const o=this.getActiveViewpoint();this.positionChaser._isActive.getValue()&&this.positionChaser._value_changed.hasInterest("set_positionOffset__",this)?(t.assign(this.positionChaser._set_destination.getValue()).add(n),this.positionChaser._set_destination=t):(t.assign(o._positionOffset.getValue()).add(n),this.positionChaser._set_value=o._positionOffset,this.positionChaser._set_destination=t),this.centerOfRotationChaser._isActive.getValue()&&this.centerOfRotationChaser._value_changed.hasInterest("set_centerOfRotationOffset__",this)?(e.assign(this.centerOfRotationChaser._set_destination.getValue()).add(i),this.centerOfRotationChaser._set_destination=e):(e.assign(o._centerOfRotationOffset.getValue()).add(i),this.centerOfRotationChaser._set_value=o._centerOfRotationOffset,this.centerOfRotationChaser._set_destination=e),this.disconnect(),this.positionChaser._value_changed.addInterest("set_positionOffset__",this),this.centerOfRotationChaser._value_changed.addInterest("set_centerOfRotationOffset__",this)}}(),addRotation:function(){const t=new an(0,0,1,0),e=new an(0,0,1,0);return function(n,i){const o=this.getActiveViewpoint();this.orientationChaser._isActive.getValue()&&this.orientationChaser._value_changed.hasInterest("set_orientationOffset__",this)?(t.setFromToVec(i,n).multRight(o.getOrientation()).multRight(this.orientationChaser._set_destination.getValue()),o.straightenHorizon(t),e.assign(o.getOrientation()).inverse().multRight(t),this.orientationChaser._set_destination=e):(t.setFromToVec(i,n).multRight(o.getUserOrientation()),o.straightenHorizon(t),e.assign(o.getOrientation()).inverse().multRight(t),this.orientationChaser._set_value=o._orientationOffset,this.orientationChaser._set_destination=e),this.disconnect(),this.orientationChaser._value_changed.addInterest("set_orientationOffset__",this)}}(),disconnect:function(){this.orientationChaser._value_changed.removeInterest("set_orientationOffset__",this),this.positionChaser._value_changed.removeInterest("set_positionOffset__",this),this.centerOfRotationChaser._value_changed.removeInterest("set_centerOfRotationOffset__",this)},dispose:function(){this.getBrowser().getSurface().off(".LookAtViewer"),rf(document).off(".LookAtViewer"+this.getId())}});const uf=af;n.set("x_ite/Browser/Navigation/LookAtViewer",uf);const cf=uf;function lf(t){ha.call(this,t),this.addType(c.X3DLightNode)}lf.prototype=Object.assign(Object.create(ha.prototype),{constructor:lf,initialize:function(){ha.prototype.initialize.call(this),this._on.addInterest("set_on__",this),this._intensity.addInterest("set_on__",this),this.set_on__()},set_on__:function(){this._on.getValue()&&this.getIntensity()>0?(delete this.push,delete this.pop):(this.push=Function.prototype,this.pop=Function.prototype)},getGlobal:function(){return this._global.getValue()},getColor:function(){return this._color.getValue()},getIntensity:function(){return Math.max(this._intensity.getValue(),0)},getAmbientIntensity:function(){return gt.clamp(this._ambientIntensity.getValue(),0,1)},getDirection:function(){return this._direction.getValue()},getShadows:function(){return this._shadows.getValue()},getShadowColor:function(){return this._shadowColor.getValue()},getShadowIntensity:function(){return this.getShadows()?gt.clamp(this._shadowIntensity.getValue(),0,1):0},getShadowBias:function(){return gt.clamp(this._shadowBias.getValue(),0,1)},getShadowMapSize:function(){return Math.min(this._shadowMapSize.getValue(),this.getBrowser().getMaxTextureSize())},getBiasMatrix:function(){const t=new hn(.5,0,0,0,0,.5,0,0,0,0,.5,0,.5,.5,.5,1);return function(){return t}}(),push:function(t,e){if(t.isIndependent()){const n=this.getLights().pop();this._global.getValue()?(n.set(this,t.getLayer().getGroup(),t.getModelViewMatrix().get()),t.getGlobalObjects().push(n),t.getLights().push(n),t.pushGlobalShadows(!!this.getShadowIntensity())):(n.set(this,e,t.getModelViewMatrix().get()),t.getLocalObjects().push(n),t.getLights().push(n),t.pushLocalShadows(!!this.getShadowIntensity()),++t.getLocalObjectsCount()[1])}else{const e=t.getLightContainer();this._global.getValue()?(e.getModelViewMatrix().pushMatrix(t.getModelViewMatrix().get()),t.getGlobalObjects().push(e),t.getLights().push(e),t.pushGlobalShadows(!!this.getShadowIntensity())):(e.getModelViewMatrix().pushMatrix(t.getModelViewMatrix().get()),t.getLocalObjects().push(e),t.getLights().push(e),t.pushLocalShadows(!!this.getShadowIntensity()),++t.getLocalObjectsCount()[1])}},pop:function(t){this._global.getValue()||(t.isIndependent()?this.getBrowser().getLocalObjects().push(t.getLocalObjects().pop()):t.getLocalObjects().pop(),t.popLocalShadows(),--t.getLocalObjectsCount()[1])}});const hf=lf;n.set("x_ite/Components/Lighting/X3DLightNode",hf);const df=hf,pf=wa(ff);function ff(){this.direction=new xe(0,0,0),this.shadowBuffer=null,this.bbox=new Ks,this.viewVolume=new Rs,this.viewport=new Xe(0,0,0,0),this.projectionMatrix=new hn,this.modelViewMatrix=new Zs(hn),this.modelMatrix=new hn,this.invLightSpaceMatrix=new hn,this.invLightSpaceProjectionMatrix=new hn,this.shadowMatrix=new hn,this.shadowMatrixArray=new Float32Array(16),this.rotation=new an,this.textureUnit=void 0}function gf(t){df.call(this,t),this.addType(c.DirectionalLight),"2.0"===t.getSpecificationVersion()&&(this._global=!0)}ff.prototype={constructor:ff,set:function(t,e,n){const i=t.getShadowMapSize();this.browser=t.getBrowser(),this.lightNode=t,this.groupNode=e,this.modelViewMatrix.pushMatrix(n),t.getShadowIntensity()>0&&i>0&&(this.shadowBuffer=this.browser.popShadowBuffer(i),this.shadowBuffer||console.warn("Couldn't create shadow buffer."))},setGroup:function(t){this.groupNode=t},getModelViewMatrix:function(){return this.modelViewMatrix},renderShadowMap:function(t){if(!this.shadowBuffer)return;const e=this.lightNode,n=t.getCameraSpaceMatrix().get(),i=this.modelMatrix.assign(this.modelViewMatrix.get()).multRight(n),o=this.invLightSpaceMatrix.assign(e.getGlobal()?i:hn.Identity);o.rotate(this.rotation.setFromToVec(xe.zAxis,this.direction.assign(e.getDirection()).negate())),o.inverse();const r=this.groupNode.getSubBBox(this.bbox,!0).multRight(o),s=e.getShadowMapSize(),a=this.viewport.set(0,0,s,s),u=qs.orthoBox(r,this.projectionMatrix);this.shadowBuffer.bind(),t.getViewVolumes().push(this.viewVolume.set(u,a,a)),t.getProjectionMatrix().pushMatrix(u),t.getModelViewMatrix().pushMatrix(o),t.render(Us.SHADOW,nc.prototype.traverse,this.groupNode),t.getModelViewMatrix().pop(),t.getProjectionMatrix().pop(),t.getViewVolumes().pop(),this.shadowBuffer.unbind(),e.getGlobal()||o.multLeft(i.inverse()),this.invLightSpaceProjectionMatrix.assign(o).multRight(u).multRight(e.getBiasMatrix())},setGlobalVariables:function(t){this.modelViewMatrix.get().multDirMatrix(this.direction.assign(this.lightNode.getDirection())).normalize(),this.shadowBuffer&&(this.shadowMatrix.assign(t.getCameraSpaceMatrix().get()).multRight(this.invLightSpaceProjectionMatrix),this.shadowMatrixArray.set(this.shadowMatrix))},setShaderUniforms:function(t,e){const n=e.numLights++;if(this.shadowBuffer){const i=this.lightNode.getGlobal()?this.textureUnit=void 0!==this.textureUnit?this.textureUnit:this.browser.popTexture2DUnit():this.browser.getTexture2DUnit();void 0!==i?(t.activeTexture(t.TEXTURE0+i),t.HAS_FEATURE_DEPTH_TEXTURE?t.bindTexture(t.TEXTURE_2D,this.shadowBuffer.getDepthTexture()):t.bindTexture(t.TEXTURE_2D,this.shadowBuffer.getColorTexture()),t.uniform1i(e.x3d_ShadowMap[n],i)):console.warn("Not enough combined texture units for shadow map available.")}if(e.hasLight(n,this))return;const i=this.lightNode,o=i.getColor(),r=this.direction;if(t.uniform1i(e.x3d_LightType[n],1),t.uniform3f(e.x3d_LightColor[n],o.r,o.g,o.b),t.uniform1f(e.x3d_LightIntensity[n],i.getIntensity()),t.uniform1f(e.x3d_LightAmbientIntensity[n],i.getAmbientIntensity()),t.uniform3f(e.x3d_LightDirection[n],r.x,r.y,r.z),this.shadowBuffer){const o=i.getShadowColor();t.uniform3f(e.x3d_ShadowColor[n],o.r,o.g,o.b),t.uniform1f(e.x3d_ShadowIntensity[n],i.getShadowIntensity()),t.uniform1f(e.x3d_ShadowBias[n],i.getShadowBias()),t.uniformMatrix4fv(e.x3d_ShadowMatrix[n],!1,this.shadowMatrixArray),t.uniform1i(e.x3d_ShadowMapSize[n],i.getShadowMapSize())}},dispose:function(){this.browser.pushShadowBuffer(this.shadowBuffer),this.browser.pushTexture2DUnit(this.textureUnit),this.modelViewMatrix.clear(),this.shadowBuffer=null,this.textureUnit=void 0,pf.push(this)}},gf.prototype=Object.assign(Object.create(df.prototype),{constructor:gf,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new Y([new B(c.inputOutput,"metadata",new Ri.SFNode),new B(c.inputOutput,"global",new Ri.SFBool(!1)),new B(c.inputOutput,"on",new Ri.SFBool(!0)),new B(c.inputOutput,"color",new Ri.SFColor(1,1,1)),new B(c.inputOutput,"intensity",new Ri.SFFloat(1)),new B(c.inputOutput,"ambientIntensity",new Ri.SFFloat),new B(c.inputOutput,"direction",new Ri.SFVec3f(0,0,-1)),new B(c.inputOutput,"shadows",new Ri.SFBool),new B(c.inputOutput,"shadowColor",new Ri.SFColor),new B(c.inputOutput,"shadowIntensity",new Ri.SFFloat(1)),new B(c.inputOutput,"shadowBias",new Ri.SFFloat(.005)),new B(c.initializeOnly,"shadowMapSize",new Ri.SFInt32(1024))]),getTypeName:function(){return"DirectionalLight"},getComponentName:function(){return"Lighting"},getContainerField:function(){return"children"},getLights:function(){return pf}});const mf=gf;n.set("x_ite/Components/Lighting/DirectionalLight",mf);const _f=mf,xf=Symbol(),yf=Symbol(),wf=Symbol();function Sf(){this.addChildObjects("activeLayer",new Ri.SFNode,"activeNavigationInfo",new Ri.SFNode,"activeViewpoint",new Ri.SFNode,"availableViewers",new Ri.MFString,"viewer",new Ri.SFString("EXAMINE")),this[xf]=new Set,this[yf]=new of(this)}Sf.prototype={initialize:function(){this._viewer.addInterest("set_viewer__",this),this.initialized().addInterest("set_world__",this),this.shutdown().addInterest("remove_world__",this),this[wf]=function(t){const e=new _f(t.getPrivateScene());e.setup();const n=e.getLights().pop();return n.set(e,null,hn.Identity),n.dispose=Function.prototype,n}(this),this[yf].setup()},getHeadlight:function(){return this[wf]},getActiveLayer:function(){return this._activeLayer.getValue()},getActiveNavigationInfo:function(){return this._activeNavigationInfo.getValue()},getActiveViewpoint:function(){return this._activeViewpoint.getValue()},getCurrentViewer:function(){return this._viewer.getValue()},getViewer:function(){return this[yf]},addCollision:function(t){this[xf].add(t)},removeCollision:function(t){this[xf].delete(t)},getCollisionCount:function(){return this[xf].size},remove_world__:function(){this.getWorld()._activeLayer.removeInterest("set_activeLayer__",this)},set_world__:function(){this.getWorld()._activeLayer.addInterest("set_activeLayer__",this),this.set_activeLayer__()},set_activeLayer__:function(){this._activeLayer.getValue()&&(this._activeLayer.getValue().getNavigationInfoStack().removeInterest("set_activeNavigationInfo__",this),this._activeLayer.getValue().getViewpointStack().removeInterest("set_activeViewpoint__",this)),this._activeLayer=this.getWorld().getActiveLayer(),this._activeLayer.getValue()&&(this._activeLayer.getValue().getNavigationInfoStack().addInterest("set_activeNavigationInfo__",this),this._activeLayer.getValue().getViewpointStack().addInterest("set_activeViewpoint__",this)),this.set_activeNavigationInfo__(),this.set_activeViewpoint__()},set_activeNavigationInfo__:function(){this._activeNavigationInfo.getValue()&&this._activeNavigationInfo.getValue()._viewer.removeFieldInterest(this._viewer),this._activeLayer.getValue()?(this._activeNavigationInfo=this._activeLayer.getValue().getNavigationInfo(),this._activeNavigationInfo.getValue()._viewer.addFieldInterest(this._viewer),this._viewer=this._activeNavigationInfo.getValue()._viewer):(this._activeNavigationInfo=null,this._viewer="NONE")},set_activeViewpoint__:function(){this._activeLayer.getValue()?this._activeViewpoint=this._activeLayer.getValue().getViewpoint():this._activeViewpoint=null},set_viewer__:function(t){const e=this._activeNavigationInfo.getValue();switch(e?this._availableViewers=e._availableViewers:this._availableViewers.length=0,this[yf]&&this[yf].dispose(),t.getValue()){case"EXAMINE":default:this[yf]=new Vp(this,e);break;case"WALK":this[yf]=new jp(this,e);break;case"FLY":this[yf]=new qp(this,e);break;case"PLANE":case"PLANE_create3000.github.io":case"PLANE_create3000.de":this[yf]=new tf(this,e);break;case"NONE":this[yf]=new of(this,e);break;case"LOOKAT":this[yf]=new cf(this,e)}this[yf].setup()}};const Tf=Sf;n.set("x_ite/Browser/Navigation/X3DNavigationContext",Tf);const bf=Tf,vf=Symbol(),Cf=Symbol(),Ef=Symbol(),Of=Symbol(),Nf=Symbol();function Ff(){this.addChildObjects("loadCount",new Ri.SFInt32),this[vf]=0,this[Cf]=new Set,this[Ef]=!1,this[Of]=function(t){let e=t.baseURI;return e.startsWith("about:")&&(e=document.baseURI),e}(this.getElement()[0])}Ff.prototype={initialize:function(){},getProviderUrl:function(){return il.getProviderUrl()},getLocation:function(){return this[Of]},getDefaultScene:function(){return this[Nf]=this.createScene(),this[Nf].setPrivate(!0),this[Nf].setLive(!0),this[Nf].setup(),this.getDefaultScene=function(){return this[Nf]},Object.defineProperty(this,"getDefaultScene",{enumerable:!1}),this[Nf]},setBrowserLoading:function(t){this[Ef]=t,this.setLoadCount(0),t?(this.resetLoadCount(),this.getShadow().find(".x_ite-private-world-info").remove(),this.getBrowserOptions().getSplashScreen()&&(this.getContextMenu().hide(),this.getCanvas().hide(),this.getSplashScreen().stop(!0,!0).show())):this.getBrowserOptions().getSplashScreen()&&(this.getCanvas().show(),this.getSplashScreen().stop(!0,!0).show().fadeOut(2e3))},getLoading:function(){return this[Ef]},addLoadingObject:function(t){this[Cf].has(t)||(++this[vf],this[Cf].add(t),this.setLoadCount(this[Cf].size),this.setCursor("DEFAULT"))},removeLoadingObject:function(t){this[Cf].has(t)&&(this[Cf].delete(t),this.setLoadCount(this[Cf].size))},setLoadCount:function(t){this._loadCount=t;const e=[...this[Cf]].filter((t=>t.isPrivate)).reduce(((t,e)=>t+!e.isPrivate()),0);if(t||this[Ef])var n=fo(1==e?"Loading %1 file":"Loading %1 files").replace("%1",e||1);else{n=fo("Loading done");this.setCursor("DEFAULT")}this[Ef]||(this.getNotification()._string=n),this.getSplashScreen().find(".x_ite-private-spinner-text").text(n),this.getSplashScreen().find(".x_ite-private-progressbar div").css("width",100-100*t/this[vf]+"%")},resetLoadCount:function(){this._loadCount=0,this[vf]=0,this[Cf].clear();for(const t of this.getPrivateScene().getLoadingObjects())this.addLoadingObject(t)}};const If=Ff;n.set("x_ite/Browser/Networking/X3DNetworkingContext",If);const Mf=If,Df=Symbol(),Vf=Symbol(),Rf=Symbol(),Pf=Symbol(),Af=Symbol();function Lf(){this[Df]=new Set,this[Vf]=[new Set],this[Rf]=[],this[Pf]=[!1],this[Af]=0}Lf.prototype={initialize:function(){},addTransformSensor:function(t){this[Df].add(t),this.enablePicking()},removeTransformSensor:function(t){this[Df].delete(t),this.enablePicking()},addPickSensor:function(t){this[Vf][0].add(t),this.enablePicking()},removePickSensor:function(t){this[Vf][0].delete(t),this.enablePicking()},getPickSensors:function(){return this[Vf]},getPickingHierarchy:function(){return this[Rf]},getPickable:function(){return this[Pf]},enablePicking:function(){this[Df].size||this[Vf][0].size?this._sensorEvents.addInterest("picking",this):this._sensorEvents.removeInterest("picking",this)},picking:function(){const t=Date.now();this.getWorld().traverse(Us.PICKING,null);for(const t of this[Df])t.process();for(const t of this[Vf][0])t.process();this[Af]=Date.now()-t},getPickingTime:function(){return this[Af]}};const Bf=Lf;n.set("x_ite/Browser/Picking/X3DPickingContext",Bf);const Xf=Bf;i(50);var Uf=i(603);function kf(t){$i.call(this,t),this.cursor="DEFAULT",this.isOver=!1,this.motionTime=0}kf.prototype=Object.assign(Object.create($i.prototype),{constructor:kf,getTypeName:function(){return"PointingDevice"},initialize:function(){const t=this.getBrowser().getSurface();t.on("mousedown.PointingDevice"+this.getId(),this.mousedown.bind(this)),t.on("mouseup.PointingDevice"+this.getId(),this.mouseup.bind(this)),t.on("dblclick.PointingDevice"+this.getId(),this.dblclick.bind(this)),t.on("mousemove.PointingDevice"+this.getId(),this.mousemove.bind(this)),t.on("mouseout.PointingDevice"+this.getId(),this.onmouseout.bind(this)),t.on("touchstart.PointingDevice"+this.getId(),this.touchstart.bind(this)),t.on("touchend.PointingDevice"+this.getId(),this.touchend.bind(this))},mousewheel:function(t){},mousedown:function(t){const e=this.getBrowser();if(e.getElement().focus(),!(e.getShiftKey()&&e.getControlKey()||0!==t.button)){const n=e.getSurface(),i=n.offset(),o=t.pageX-i.left-parseFloat(n.css("borderLeftWidth")),r=n.innerHeight()-(t.pageY-i.top-parseFloat(n.css("borderTopWidth")));n.off("mousemove.PointingDevice"+this.getId()),Uf(document).on("mouseup.PointingDevice"+this.getId(),this.mouseup.bind(this)),Uf(document).on("mousemove.PointingDevice"+this.getId(),this.mousemove.bind(this)),Uf(document).on("touchend.PointingDevice"+this.getId(),this.touchend.bind(this)),Uf(document).on("touchmove.PointingDevice"+this.getId(),this.touchmove.bind(this)),e.buttonPressEvent(o,r)&&(t.preventDefault(),t.stopImmediatePropagation(),e.setCursor("HAND"),e.finished().addInterest("onverifymotion",this,o,r))}},mouseup:function(t){if(t.preventDefault(),0===t.button){const e=this.getBrowser(),n=e.getSurface(),i=n.offset(),o=t.pageX-i.left-parseFloat(n.css("borderLeftWidth")),r=n.innerHeight()-(t.pageY-i.top-parseFloat(n.css("borderTopWidth")));Uf(document).off(".PointingDevice"+this.getId()),n.on("mousemove.PointingDevice"+this.getId(),this.mousemove.bind(this)),e.buttonReleaseEvent(),e.setCursor(this.isOver?"HAND":"DEFAULT"),e.finished().addInterest("onverifymotion",this,o,r),e.addBrowserEvent(),this.cursor="DEFAULT"}},dblclick:function(t){this.isOver&&t.stopImmediatePropagation()},mousemove:function(t){t.preventDefault();const e=this.getBrowser();if(this.motionTime===e.getCurrentTime())return;this.motionTime=e.getCurrentTime();const n=e.getSurface(),i=n.offset(),o=t.pageX-i.left-parseFloat(n.css("borderLeftWidth")),r=n.innerHeight()-(t.pageY-i.top-parseFloat(n.css("borderTopWidth")));this.onmotion(o,r)},touchstart:function(t){const e=t.originalEvent.touches;switch(e.length){case 1:{t.button=0,t.pageX=e[0].pageX,t.pageY=e[0].pageY,this.mousedown(t);const n=this.getBrowser().getNearestHit();n&&0!==n.sensors.size||(this.touchX=t.pageX,this.touchY=t.pageY,this.touchTimeout=setTimeout(this.showContextMenu.bind(this,t),1200));break}case 2:this.touchend(t)}},touchend:function(t){t.button=0,this.mouseup(t),clearTimeout(this.touchTimeout)},touchmove:function(t){const e=t.originalEvent.touches;if(1===e.length)t.button=0,t.pageX=e[0].pageX,t.pageY=e[0].pageY,this.mousemove(t),Math.hypot(this.touchX-t.pageX,this.touchY-t.pageY)>7&&clearTimeout(this.touchTimeout)},onmotion:function(t,e){const n=this.getBrowser();n.motionNotifyEvent(t,e)?this.isOver||(this.isOver=!0,this.cursor=n.getCursor(),n.setCursor("HAND")):this.isOver&&(this.isOver=!1,n.setCursor(this.cursor))},onmouseout:function(t){this.getBrowser().leaveNotifyEvent()},onverifymotion:function(t,e){this.getBrowser().finished().removeInterest("onverifymotion",this),this.onmotion(t,e)},showContextMenu:function(t){this.getBrowser().getContextMenu().show(t)}});const zf=kf;n.set("x_ite/Browser/PointingDeviceSensor/PointingDevice",zf);const jf=zf,Gf=Symbol(),Hf=Symbol(),qf=Symbol(),Yf=Symbol(),Wf=Symbol(),Kf=Symbol(),Jf=Symbol(),Zf=Symbol(),Qf=Symbol(),$f=Symbol(),tg=Symbol(),eg=Symbol(),ng=Symbol(),ig=Symbol(),og=new wd(xe.Zero,xe.Zero);function rg(){this[Gf]=new jf(this),this[qf]=new de(0,0),this[Yf]=new wd(xe.Zero,xe.Zero),this[Wf]=[],this[Kf]=[new Map],this[Zf]=null,this[Qf]=new Set,this[$f]=new Set,this[tg]=new js(this[Wf],(function(t,e){return t.intersection.point.z<e.intersection.point.z})),this[ng]=new js(this[Wf],(function(t,e){return t.layerNumber<e.layerNumber})),this[ig]=0}rg.prototype={initialize:function(){this.setCursor("DEFAULT"),this[Gf].setup()},setCursor:function(t){const e=this.getSurface();switch(this[Hf]=t,t){case"HAND":e.css("cursor","pointer");break;case"MOVE":e.css("cursor","move");break;case"CROSSHAIR":e.css("cursor","crosshair");break;default:this._loadCount.getValue()?e.css("cursor","wait"):this[Gf]&&this[Gf].isOver?e.css("cursor","pointer"):e.css("cursor","default")}},getCursor:function(){return this[Hf]},getPointer:function(){return this[qf]},isPointerInRectangle:function(t){return this[qf].x>t.x&&this[qf].x<t.x+t.z&&this[qf].y>t.y&&this[qf].y<t.y+t.w},setLayerNumber:function(t){this[eg]=t},getSelectedLayer:function(){return this[Zf]},setHitRay:function(t,e){Rs.unProjectRay(this[qf].x,this[qf].y,hn.Identity,t,e,this[Yf])},getHitRay:function(){return this[Yf]},getSensors:function(){return this[Kf]},getPickOnlySensors:function(){return this[Jf]},addHit:function(t,e,n,i){const o=this[Kf].at(-1);this[Wf].push({pointer:this[qf],hitRay:this[Yf].copy(),intersection:t,sensors:new Set(o.values()),layer:e,layerNumber:this[eg],shape:n,modelViewMatrix:i.copy()})},getHits:function(){return this[Wf]},getNearestHit:function(){return this[Wf].at(-1)},buttonPressEvent:function(t,e){if(this.touch(t,e,!0),0===this[Wf].length)return!1;const n=this.getNearestHit();this[Zf]=n.layer,this[$f]=n.sensors;for(const t of this[$f])t.set_active__(!0,n);return!!n.sensors.size},buttonReleaseEvent:function(){this[Zf]=null;for(const t of this[$f])t.set_active__(!1,null);return this[$f]=new Set,!0},motionNotifyEvent:function(t,e){return this.touch(t,e,!0),this.motion(),!(!this[Wf].length||!this[Wf].at(-1).sensors.size)},leaveNotifyEvent:function(){},touch:function(t,e,n){if(this.getViewer()._isActive.getValue())return void(this[ig]=0);const i=Date.now();this[Jf]=n,this[qf].set(t,e),this[Wf].length=0,this.getWorld().traverse(Us.POINTER,null),this[tg].sort(0,this[Wf].length),this[ng].sort(0,this[Wf].length),this.addBrowserEvent(),this[ig]=Date.now()-i},motion:function(){if(this[Wf].length)var t=this[Wf].at(-1);else t={pointer:this[qf],modelViewMatrix:new hn,hitRay:this[Zf]?this[Yf]:og,intersection:null,sensors:new Set,shape:null,layer:null,layerNumber:0};if(this[Wf].length)var e=gt.set_difference(this[Qf],t.sensors,new Set);else e=new Set(this[Qf]);for(const n of e)n.set_over__(!1,t);if(this[Wf].length){this[Qf]=t.sensors;for(const e of this[Qf])e.set_over__(!0,t)}else this[Qf]=new Set;for(const e of this[$f])e.set_motion__(t)},getPointerTime:function(){return this[ig]}};const sg=rg;n.set("x_ite/Browser/PointingDeviceSensor/X3DPointingDeviceSensorContext",sg);const ag=sg;var ug=i(603),cg=i(126);const lg=Symbol(),hg=Symbol(),dg=Symbol(),pg=Symbol();function fg(){this[lg]=[0,0,300,150],this[hg]=[],this[dg]=new Map}fg.prototype={initialize:function(){const t=this.getContext();t.enable(t.SCISSOR_TEST),t.depthFunc(t.LEQUAL),t.clearDepth(1),t.blendFuncSeparate(t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA,t.ONE,t.ONE_MINUS_SRC_ALPHA),t.blendEquationSeparate(t.FUNC_ADD,t.FUNC_ADD),ug(document).on("webkitfullscreenchange mozfullscreenchange fullscreenchange MSFullscreenChange",this.onfullscreen.bind(this)),this[pg]=new cg(this.getSurface(),this.reshape.bind(this)),this.getSurface().css("position",""),this.reshape()},getRenderer:function(){const t=this.getContext();if(!navigator.userAgent.match(/Firefox/)){const e=t.getExtension("WEBGL_debug_renderer_info");if(e)return t.getParameter(e.UNMASKED_RENDERER_WEBGL)}return t.getParameter(t.RENDERER)},getVendor:function(){const t=this.getContext();if(!navigator.userAgent.match(/Firefox/)){const e=t.getExtension("WEBGL_debug_renderer_info");if(e)return t.getParameter(e.UNMASKED_VENDOR_WEBGL)}return t.getParameter(t.VENDOR)},getWebGLVersion:function(){const t=this.getContext();return t.getParameter(t.VERSION)},getAntialiased:function(){const t=this.getContext();return t.getParameter(t.SAMPLES)>0},getMaxClipPlanes:function(){return 6},getDepthSize:function(){const t=this.getContext();return t.getParameter(t.DEPTH_BITS)},getColorDepth:function(){const t=this.getContext();return t.getParameter(t.RED_BITS)+t.getParameter(t.BLUE_BITS)+t.getParameter(t.GREEN_BITS)+t.getParameter(t.ALPHA_BITS)},getViewport:function(){return this[lg]},getLocalObjects:function(){return this[hg]},getDepthShader:function(t,e){let n="";return n+=t,n+=e?"1":"0",this[dg].get(n)||this.createDepthShader(n,t,e)},createDepthShader:function(t,e,n){const i=[];e&&(i.push("X3D_CLIP_PLANES"),i.push("X3D_NUM_CLIP_PLANES "+e)),n&&i.push("X3D_PARTICLE_SYSTEM");const o=this.createShader("DepthShader","Depth","Depth",i);return this[dg].set(t,o),o},reshape:function(){const t=this.getContext(),e=this.getCanvas(),n=e.width(),i=e.height(),o=e[0];o.width=n,o.height=i,this[lg][2]=n,this[lg][3]=i,t.viewport(0,0,n,i),t.scissor(0,0,n,i),this.addBrowserEvent()},onfullscreen:function(){const t=this.getElement();t.fullScreen()?t.addClass("x_ite-fullscreen"):t.removeClass("x_ite-fullscreen")}};const gg=fg;n.set("x_ite/Browser/Rendering/X3DRenderingContext",gg);const mg=gg,_g=Symbol();function xg(){this[_g]=[this]}xg.prototype={initialize:function(){},isExternal:function(){return 1===this[_g].length},getScriptStack:function(){return this[_g]}};const yg=xg;n.set("x_ite/Browser/Scripting/X3DScriptingContext",yg);const wg=yg,Sg="\n#if defined (X3D_CLIP_PLANES)\n\nuniform vec4 x3d_ClipPlane [X3D_NUM_CLIP_PLANES];\n\nvoid\nclip ()\n{\n   for (int i = 0; i < X3D_NUM_CLIP_PLANES; ++ i)\n   {\n      if (dot (vertex, x3d_ClipPlane [i] .xyz) - x3d_ClipPlane [i] .w < 0.0)\n         discard;\n   }\n}\n\n#endif\n";n.set("assets/shaders/webgl1/include/ClipPlanes.glsl",Sg);const Tg=Sg,bg="\n#define MANUAL_SRGB\n\nvec4\nSRGBtoLINEAR (const in vec4 srgbIn)\n{\n   #if defined (MANUAL_SRGB)\n      #if defined (SRGB_FAST_APPROXIMATION)\n         vec3 linOut = pow (srgbIn .xyz, vec3 (2.2));\n      #else //SRGB_FAST_APPROXIMATION\n         vec3 bLess  = step (vec3 (0.04045), srgbIn .xyz);\n         vec3 linOut = mix (srgbIn .xyz / vec3 (12.92), pow ((srgbIn .xyz + vec3 (0.055)) / vec3 (1.055), vec3 (2.4)), bLess);\n      #endif //SRGB_FAST_APPROXIMATION\n      return vec4 (linOut, srgbIn .w);\n   #else //MANUAL_SRGB\n      return srgbIn;\n   #endif //MANUAL_SRGB\n}\n\nvec4\nGamma (const in vec4 color)\n{\n   #if defined (MANUAL_SRGB)\n      return vec4 (pow (color .rgb, vec3 (1.0 / 2.2)), color .a);\n   #else\n      return color;\n   #endif\n}\n";n.set("assets/shaders/webgl1/include/Colors.glsl",bg);const vg=bg,Cg="\n#if defined (X3D_FOG)\n\nuniform x3d_FogParameters x3d_Fog;\n\nfloat\ngetFogInterpolant ()\n{\n   // Returns 0.0 for fog color and 1.0 for material color.\n\n   #if defined (X3D_FOG_COORDS)\n      return clamp (1.0 - fogDepth, 0.0, 1.0);\n   #else\n      float visibilityRange = x3d_Fog .visibilityRange;\n      float dV              = length (x3d_Fog .matrix * vertex);\n\n      #if defined (X3D_FOG_LINEAR)\n         return max (0.0, visibilityRange - dV) / visibilityRange;\n      #elif defined (X3D_FOG_EXPONENTIAL)\n         return exp (-dV / max (0.001, visibilityRange - dV));\n      #endif\n   #endif\n}\n\nvec3\ngetFogColor (const in vec3 color)\n{\n   return mix (x3d_Fog .color, color, getFogInterpolant ());\n}\n\n#endif\n";n.set("assets/shaders/webgl1/include/Fog.glsl",Cg);const Eg=Cg,Og='\n#if defined (X3D_LOGARITHMIC_DEPTH_BUFFER)\n   #extension GL_EXT_frag_depth : enable\n#endif\n\nuniform float x3d_AlphaCutoff;\n\n#if defined (X3D_FOG) && defined (X3D_FOG_COORDS)\n   varying float fogDepth;\n#endif\n\n#if defined (X3D_COLOR_MATERIAL)\n   varying vec4 color;\n#endif\n\n#if ! defined (X3D_GEOMETRY_0D) && ! defined (X3D_GEOMETRY_1D)\n   #if defined (X3D_TEXTURE) || defined (X3D_MATERIAL_TEXTURES)\n      #if X3D_NUM_TEXTURE_COORDINATES > 0\n         varying vec4 texCoord0;\n      #endif\n\n      #if X3D_NUM_TEXTURE_COORDINATES > 1\n         varying vec4 texCoord1;\n      #endif\n   #endif\n#else\n   #if defined (X3D_TEXTURE) || defined (X3D_MATERIAL_TEXTURES)\n      #if X3D_NUM_TEXTURE_COORDINATES > 0\n         vec4 texCoord0 = vec4 (0.0);\n      #endif\n\n      #if X3D_NUM_TEXTURE_COORDINATES > 1\n         vec4 texCoord1 = vec4 (0.0);\n      #endif\n   #endif\n#endif\n\n#if defined (X3D_NORMALS)\n   varying vec3 normal;\n\n   #if defined (X3D_TEXTURE) || defined (X3D_MATERIAL_TEXTURES)\n      varying vec3 localNormal;\n   #endif\n#else\n   const vec3 normal = vec3 (0.0, 0.0, 1.0);\n\n   #if defined (X3D_TEXTURE) || defined (X3D_MATERIAL_TEXTURES)\n      const vec3 localNormal = vec3 (0.0, 0.0, 1.0);\n   #endif\n#endif\n\nvarying vec3 vertex;\n\n#if defined (X3D_TEXTURE) || defined (X3D_MATERIAL_TEXTURES)\n   varying vec3 localVertex;\n#endif\n\n#if defined (X3D_LOGARITHMIC_DEPTH_BUFFER)\n   uniform float x3d_LogarithmicFarFactor1_2;\n   varying float depth;\n#endif\n\n#pragma X3D include "Point.glsl"\n#pragma X3D include "Hatch.glsl"\n#pragma X3D include "Fog.glsl"\n#pragma X3D include "ClipPlanes.glsl"\n#pragma X3D include "Texture.glsl"\n\nvec4\ngetMaterialColor ();\n\nvec4\ngetFinalColor ()\n{\n   #if defined (X3D_GEOMETRY_0D) && defined (X3D_STYLE_PROPERTIES)\n      #if defined (X3D_TEXTURE) || defined (X3D_MATERIAL_TEXTURES)\n         setTexCoords ();\n\n         return getMaterialColor ();\n       #else\n         return getPointColor (getMaterialColor ());\n      #endif\n   #else\n      return getMaterialColor ();\n   #endif\n}\nvoid\nfragment_main ()\n{\n   #if defined (X3D_CLIP_PLANES)\n      clip ();\n   #endif\n\n   vec4 finalColor = getFinalColor ();\n\n   #if (defined (X3D_GEOMETRY_2D) || defined (X3D_GEOMETRY_3D)) && defined (X3D_STYLE_PROPERTIES)\n      finalColor = getHatchColor (finalColor);\n   #endif\n\n   #if defined (X3D_FOG)\n      finalColor .rgb = getFogColor (finalColor .rgb);\n   #endif\n\n   if (finalColor .a < x3d_AlphaCutoff)\n      discard;\n\n   gl_FragColor = finalColor;\n\n   #if defined (X3D_LOGARITHMIC_DEPTH_BUFFER)\n      //https://outerra.blogspot.com/2013/07/logarithmic-depth-buffer-optimizations.html\n      gl_FragDepthEXT = log2 (depth) * x3d_LogarithmicFarFactor1_2;\n   #endif\n}\n';n.set("assets/shaders/webgl1/include/Fragment.glsl",Og);const Ng=Og,Fg="\n#if (defined (X3D_GEOMETRY_2D) || defined (X3D_GEOMETRY_3D)) && defined (X3D_STYLE_PROPERTIES)\n\nuniform x3d_FillPropertiesParameters x3d_FillProperties;\n\nvec4\ngetHatchColor (vec4 color)\n{\n   vec4 finalColor = x3d_FillProperties .filled ? color : vec4 (0.0);\n\n   if (x3d_FillProperties .hatched)\n   {\n      vec4 hatch = texture2D (x3d_FillProperties .texture, gl_FragCoord .xy / 32.0);\n\n      hatch .rgb *= x3d_FillProperties .hatchColor;\n      finalColor  = mix (finalColor, hatch, hatch .a);\n   }\n\n   return finalColor;\n}\n\n#endif\n";n.set("assets/shaders/webgl1/include/Hatch.glsl",Fg);const Ig=Fg,Mg='\nuniform x3d_MaterialParameters x3d_Material;\n\n#if defined (X3D_LIGHTING)\n\n#pragma X3D include "SpotFactor.glsl"\n#pragma X3D include "Shadow.glsl"\n\nuniform x3d_LightSourceParameters x3d_LightSource [X3D_NUM_LIGHTS];\n\nvec3\ngetMaterialColor (const in vec3 vertex, const in vec3 N, const in vec3 ambientColor, const in vec3 diffuseColor, const in vec3 specularColor, const in float shininess)\n{\n   // Apply light sources\n\n   vec3 V = normalize (-vertex);\n\n   vec3 finalColor = vec3 (0.0);\n\n   for (int i = 0; i < X3D_NUM_LIGHTS; ++ i)\n   {\n      x3d_LightSourceParameters light = x3d_LightSource [i];\n\n      vec3  vL = light .location - vertex;\n      float dL = length (light .matrix * vL);\n      bool  di = light .type == x3d_DirectionalLight;\n\n      if (di || dL <= light .radius)\n      {\n         vec3 d = light .direction;\n         vec3 c = light .attenuation;\n         vec3 L = di ? -d : normalize (vL);      // Normalized vector from point on geometry to light source i position.\n         vec3 H = normalize (L + V);             // Specular term\n\n         float lightAngle     = max (dot (N, L), 0.0);      // Angle between normal and light ray.\n         vec3  diffuseTerm    = diffuseColor * lightAngle;\n         float specularFactor = shininess > 0.0 ? pow (max (dot (N, H), 0.0), shininess * 128.0) : 1.0;\n         vec3  specularTerm   = specularColor * specularFactor;\n\n         float attenuationFactor     = di ? 1.0 : 1.0 / max (dot (c, vec3 (1.0, dL, dL * dL)), 1.0);\n         float spotFactor            = light .type == x3d_SpotLight ? getSpotFactor (light .cutOffAngle, light .beamWidth, L, d) : 1.0;\n         float attenuationSpotFactor = attenuationFactor * spotFactor;\n         vec3  ambientTerm           = light .ambientIntensity * ambientColor;\n         vec3  diffuseSpecularTerm   = light .intensity * (diffuseTerm + specularTerm);\n\n         #if defined (X3D_FRAGMENT_SHADER) && defined (X3D_SHADOWS)\n            if (lightAngle > 0.0)\n               diffuseSpecularTerm = mix (diffuseSpecularTerm, light .shadowColor, getShadowIntensity (i, light));\n         #endif\n\n         finalColor += attenuationSpotFactor * light .color * (ambientTerm + diffuseSpecularTerm);\n      }\n   }\n\n   return finalColor;\n}\n\n#endif\n';n.set("assets/shaders/webgl1/include/Material.glsl",Mg);const Dg=Mg,Vg="\n#if defined (X3D_NORMAL_TEXTURE)\n// Tangent-Bitangent-Normal-Matrix\nmat3\ngetTBNMatrix (const in vec2 texCoord)\n{\n   vec3 pos_dx = dFdx (vertex);\n   vec3 pos_dy = dFdy (vertex);\n   vec3 tex_dx = dFdx (vec3 (texCoord, 0.0));\n   vec3 tex_dy = dFdy (vec3 (texCoord, 0.0));\n   vec3 t      = (tex_dy .t * pos_dx - tex_dx .t * pos_dy) / (tex_dx .s * tex_dy.t - tex_dy .s * tex_dx .t);\n   vec3 N      = normalize (normal); // OR generated face normal: n = normalize (cross (pos_dx, pos_dy));\n   vec3 T      = normalize (t - N * dot (N, t));\n   vec3 B      = normalize (cross (N, T));\n   mat3 tbn    = mat3 (T, B, N);\n\n   return tbn;\n}\n#endif\n\n#if defined (X3D_NORMAL_TEXTURE)\nuniform x3d_NormalTextureParameters x3d_NormalTexture;\n#endif\n\nvec3\ngetNormalVector (const in float normalScale)\n{\n   float facing = gl_FrontFacing ? 1.0 : -1.0;\n\n   // Get normal vector.\n\n   #if defined (X3D_NORMAL_TEXTURE) && ! defined (X3D_NORMAL_TEXTURE_3D)\n      vec3 texCoord = getTexCoord (x3d_NormalTexture .textureTransformMapping, x3d_NormalTexture .textureCoordinateMapping);\n      vec3 scale    = vec3 (vec2 (normalScale), 1.0);\n      mat3 tbn      = getTBNMatrix (texCoord .st);\n\n      #if defined (X3D_NORMAL_TEXTURE_2D)\n         vec3 n = texture2D (x3d_NormalTexture .texture2D, texCoord .st) .rgb;\n      #elif defined (X3D_NORMAL_TEXTURE_CUBE)\n         vec3 n = textureCube (x3d_NormalTexture .textureCube, texCoord) .rgb;\n      #endif\n\n      return normalize (tbn * ((n * 2.0 - 1.0) * scale)) * facing;\n   #else\n      return normalize (normal) * facing;\n   #endif\n}\n";n.set("assets/shaders/webgl1/include/Normal.glsl",Vg);const Rg=Vg,Pg="\nvec4\npack (const in float value)\n{\n   const vec3 bitShifts = vec3 (255.0,\n                                255.0 * 255.0,\n                                255.0 * 255.0 * 255.0);\n\n   return vec4 (value, fract (value * bitShifts));\n}\n\n#if defined (X3D_DEPTH_TEXTURE)\n\nfloat\nunpack (const in vec4 color)\n{\n   return color .r;\n}\n\n#else\n\nfloat\nunpack (const vec4 color)\n{\n   const vec3 bitShifts = vec3 (1.0 / 255.0,\n                                1.0 / (255.0 * 255.0),\n                                1.0 / (255.0 * 255.0 * 255.0));\n\n   return color .x + dot (color .gba, bitShifts);\n}\n\n#endif\n";n.set("assets/shaders/webgl1/include/Pack.glsl",Pg);const Ag=Pg,Lg="\n//https://gist.github.com/patriciogonzalezvivo/670c22f3966e662d2f83\n\nfloat rand (vec2 co) { return fract (sin (dot (co.xy, vec2 (12.9898,78.233))) * 43758.5453); }\nfloat rand (vec2 co, float l) { return rand (vec2 (rand (co), l)); }\nfloat rand (vec2 co, float l, float t) { return rand (vec2 (rand (co, l), t)); }\n\nfloat\nperlin (vec2 p, float dim, float time)\n{\n   const float M_PI = 3.14159265358979323846;\n\n   vec2 pos   = floor (p * dim);\n   vec2 posx  = pos + vec2 (1.0, 0.0);\n   vec2 posy  = pos + vec2 (0.0, 1.0);\n   vec2 posxy = pos + vec2 (1.0);\n\n   float c   = rand (pos,   dim, time);\n   float cx  = rand (posx,  dim, time);\n   float cy  = rand (posy,  dim, time);\n   float cxy = rand (posxy, dim, time);\n\n   vec2 d = fract (p * dim);\n\n   d = -0.5 * cos (d * M_PI) + 0.5;\n\n   float ccx    = mix (c,   cx,    d.x);\n   float cycxy  = mix (cy,  cxy,   d.x);\n   float center = mix (ccx, cycxy, d.y);\n\n   return center * 2.0 - 1.0;\n}\n\nvec3\nperlin (vec3 p)\n{\n   return vec3 (perlin (p.xy, 1.0, 0.0),\n                perlin (p.yz, 1.0, 0.0),\n                perlin (p.zx, 1.0, 0.0));\n}\n";n.set("assets/shaders/webgl1/include/Perlin.glsl",Lg);const Bg=Lg,Xg="\n#if defined (X3D_GEOMETRY_0D) && defined (X3D_STYLE_PROPERTIES)\n\nvarying float pointSize;\n\n#if defined (X3D_TEXTURE) || defined (X3D_MATERIAL_TEXTURES)\nvoid\nsetTexCoords ()\n{\n   vec4 texCoord = vec4 (gl_PointCoord .x, 1.0 - gl_PointCoord .y, 0.0, 1.0);\n\n   #if X3D_NUM_TEXTURE_COORDINATES > 0\n      texCoord0 = texCoord;\n   #endif\n\n   #if X3D_NUM_TEXTURE_COORDINATES > 1\n      texCoord1 = texCoord;\n   #endif\n}\n#endif\n\nvec4\ngetPointColor (in vec4 color)\n{\n   if (pointSize > 1.0)\n      color .a *= clamp (pointSize * (0.5 - distance (vec2 (0.5), gl_PointCoord)), 0.0, 1.0);\n\n   else\n      color .a *= pointSize;\n\n   return color;\n}\n\n#endif\n";n.set("assets/shaders/webgl1/include/Point.glsl",Xg);const Ug=Xg,kg="\n#if defined (X3D_GEOMETRY_0D) && defined (X3D_STYLE_PROPERTIES)\n\nuniform x3d_PointPropertiesParameters x3d_PointProperties;\n\nvarying float pointSize;\n\nfloat\ngetPointSize (const in vec3 vertex)\n{\n   // Determine point size.\n\n   float pointSizeMinValue = x3d_PointProperties .pointSizeMinValue;\n   float pointSizeMaxValue = x3d_PointProperties .pointSizeMaxValue;\n   vec3  attenuation       = x3d_PointProperties .attenuation;\n   float dL                = length (vertex);\n   float pointSize         = 0.0;\n\n   pointSize  = x3d_PointProperties .pointSizeScaleFactor;\n   pointSize /= dot (attenuation, vec3 (1.0, dL, dL * dL));\n   pointSize  = clamp (pointSize, pointSizeMinValue, pointSizeMaxValue);\n\n   #if defined (X3D_TEXTURE) || defined (X3D_MATERIAL_TEXTURE)\n      return pointSize;\n   #else\n      return pointSize + 1.0 - step (pointSize, 1.0);\n   #endif\n}\n\n#endif\n";n.set("assets/shaders/webgl1/include/PointSize.glsl",kg);const zg=kg,jg='\n#if defined (X3D_FRAGMENT_SHADER) && defined (X3D_SHADOWS)\n\n#pragma X3D include "Pack.glsl"\n\nuniform sampler2D x3d_ShadowMap [X3D_NUM_LIGHTS];\n\nfloat\ngetShadowDepth (const in int index, const in vec2 shadowCoord)\n{\n   #if X3D_NUM_LIGHTS > 0\n   if (index == 0)\n      return unpack (texture2D (x3d_ShadowMap [0], shadowCoord));\n   #endif\n\n   #if X3D_NUM_LIGHTS > 1\n   if (index == 1)\n      return unpack (texture2D (x3d_ShadowMap [1], shadowCoord));\n   #endif\n\n   #if X3D_NUM_LIGHTS > 2\n   if (index == 2)\n      return unpack (texture2D (x3d_ShadowMap [2], shadowCoord));\n   #endif\n\n   #if X3D_NUM_LIGHTS > 3\n   if (index == 3)\n      return unpack (texture2D (x3d_ShadowMap [3], shadowCoord));\n   #endif\n\n   #if X3D_NUM_LIGHTS > 4\n   if (index == 4)\n      return unpack (texture2D (x3d_ShadowMap [4], shadowCoord));\n   #endif\n\n   #if X3D_NUM_LIGHTS > 5\n   if (index == 5)\n      return unpack (texture2D (x3d_ShadowMap [5], shadowCoord));\n   #endif\n\n   #if X3D_NUM_LIGHTS > 6\n   if (index == 6)\n      return unpack (texture2D (x3d_ShadowMap [6], shadowCoord));\n   #endif\n\n   #if X3D_NUM_LIGHTS > 7\n   if (index == 7)\n      return unpack (texture2D (x3d_ShadowMap [7], shadowCoord));\n   #endif\n\n   return 0.0;\n}\n\nfloat\ntexture2DCompare (const in int index, const in vec2 texCoord, const in float compare)\n{\n   float shadowDepth = getShadowDepth (index, texCoord);\n\n   return (1.0 - step (1.0, shadowDepth)) * step (shadowDepth, compare);\n}\n\nfloat\ntexture2DShadowLerp (const in int index, const in vec2 texelSize, const in float shadowMapSize, const in vec2 texCoord, const in float compare)\n{\n   const vec2 offset = vec2 (0.0, 1.0);\n\n   vec2 centroidTexCoord = floor (texCoord * shadowMapSize + 0.5) / shadowMapSize;\n\n   float lb = texture2DCompare (index, centroidTexCoord + texelSize * offset .xx, compare);\n   float lt = texture2DCompare (index, centroidTexCoord + texelSize * offset .xy, compare);\n   float rb = texture2DCompare (index, centroidTexCoord + texelSize * offset .yx, compare);\n   float rt = texture2DCompare (index, centroidTexCoord + texelSize * offset .yy, compare);\n\n   vec2 f = fract (texCoord * shadowMapSize + 0.5);\n\n   float a = mix (lb, lt, f.y);\n   float b = mix (rb, rt, f.y);\n   float c = mix (a, b, f.x);\n\n   return c;\n}\n\n//https://gist.github.com/tschw/da10c43c467ce8afd0c4\nvec2\ncubeToUVCompact (in vec3 v, const float texelSizeY)\n{\n   // Compact layout:\n   //\n   // xzXZ\t\tChar: Axis\n   // yyYY\t\tCase: Sign\n\n   // Number of texels to avoid at the edge of each square\n\n   vec3 absV = abs (v);\n\n   // Intersect unit cube\n\n   float scaleToCube = 1.0 / max (absV .x, max (absV .y, absV .z));\n\n   absV *= scaleToCube;\n\n   // Apply scale to avoid seams\n\n   // one texel less per square (half a texel on each side)\n   v *= scaleToCube * (1.0 - 2.0 * texelSizeY);\n\n   // Unwrap\n\n   // space: -1 ... 1 range for each square\n   //\n   // #X##\t\tdim    := ( 4 , 2 )\n   //  # #\t\tcenter := ( 1 , 1 )\n\n   vec2 planar = v .xy;\n\n   float almostATexel = 1.5 * texelSizeY;\n   float almostOne    = 1.0 - almostATexel;\n\n   if (absV .z >= almostOne)\n   {\n      // zZ\n\n      if (v .z > 0.0)\n         planar .x = 4.0 - v .x;\n   }\n   else if (absV .x >= almostOne)\n   {\n      // xX\n\n      float signX = sign (v .x);\n\n      planar .x = v .z * signX + 2.0 * signX;\n   }\n   else if (absV .y >= almostOne)\n   {\n      // yY\n\n      float signY = sign (v .y);\n\n      planar .x = (v .x + 0.5 + signY) * 2.0;\n      planar .y = v .z * signY - 2.0;\n   }\n\n   // Transform to UV space\n\n   // scale := 0.5 / dim\n   // translate := ( center + 0.5 ) / dim\n   return vec2 (0.125, 0.25) * planar + vec2 (0.375, 0.75);\n}\n\nmat4\ngetPointLightRotations (const in vec3 vector)\n{\n   mat4 rotations [6];\n   rotations [0] = mat4 ( 0, 0 , 1, 0,   0, 1,  0, 0,  -1,  0,  0, 0,   0, 0, 0, 1);  // left\n   rotations [1] = mat4 ( 0, 0, -1, 0,   0, 1,  0, 0,   1,  0,  0, 0,   0, 0, 0, 1);  // right\n   rotations [2] = mat4 (-1, 0,  0, 0,   0, 1,  0, 0,   0,  0, -1, 0,   0, 0, 0, 1);  // front\n   rotations [3] = mat4 ( 1, 0,  0, 0,   0, 1,  0, 0,   0,  0,  1, 0,   0, 0, 0, 1);  // back\n   rotations [4] = mat4 ( 1, 0,  0, 0,   0, 0,  1, 0,   0, -1,  0, 0,   0, 0, 0, 1);  // bottom\n   rotations [5] = mat4 ( 1, 0,  0, 0,   0, 0, -1, 0,   0,  1,  0, 0,   0, 0, 0, 1);  // top\n\n   vec3 a = abs (vector .xyz);\n\n   if (a .x > a .y)\n   {\n      if (a .x > a .z)\n         return vector .x > 0.0 ? rotations [1] : rotations [0];\n      else\n         return vector .z > 0.0 ? rotations [2] : rotations [3];\n   }\n   else\n   {\n      if (a .y > a .z)\n         return vector .y > 0.0 ? rotations [5] : rotations [4];\n      else\n         return vector .z > 0.0 ? rotations [2] : rotations [3];\n   }\n\n   return rotations [3];\n}\n\n// DEBUG\n//vec4 tex;\n\nfloat\ngetShadowIntensity (const in int index, const in x3d_LightSourceParameters light)\n{\n   if (light .type == x3d_PointLight)\n   {\n      const mat4 biasMatrix = mat4 (0.5, 0.0, 0.0, 0.0,\n                                    0.0, 0.5, 0.0, 0.0,\n                                    0.0, 0.0, 0.5, 0.0,\n                                    0.5, 0.5, 0.5, 1.0);\n\n      const mat4 projectionMatrix = mat4 (1.0, 0.0, 0.0, 0.0, 0.0, 0.5, 0.0, 0.0, 0.0, 0.0, -1.000025000312504, -1.0, 0, 0.0, -0.25000312503906297, 0.0);\n\n      vec2 texelSize = vec2 (1.0) / (float (light .shadowMapSize) * vec2 (4.0, 2.0));\n\n      // for point lights, the uniform @vShadowCoord is re-purposed to hold\n      // the vector from the light to the world-space position of the fragment.\n      vec4 shadowCoord     = light .shadowMatrix * vec4 (vertex, 1.0);\n      vec3 lightToPosition = shadowCoord .xyz;\n\n      shadowCoord       = biasMatrix * (projectionMatrix * (getPointLightRotations (lightToPosition) * shadowCoord));\n      shadowCoord .z   -= light .shadowBias;\n      shadowCoord .xyz /= shadowCoord .w;\n\n      // DEBUG\n      //tex = texture2D (x3d_ShadowMap [0], cubeToUVCompact (lightToPosition, texelSize .y));\n\n      #if defined (X3D_PCF_FILTERING) || defined (X3D_PCF_SOFT_FILTERING)\n\n         vec2 offset = vec2 (-1, 1) * (texelSize .y * 42.0);\n\n         float value = (\n            texture2DCompare (index, cubeToUVCompact (lightToPosition + offset .xyy, texelSize .y), shadowCoord .z) +\n            texture2DCompare (index, cubeToUVCompact (lightToPosition + offset .yyy, texelSize .y), shadowCoord .z) +\n            texture2DCompare (index, cubeToUVCompact (lightToPosition + offset .xyx, texelSize .y), shadowCoord .z) +\n            texture2DCompare (index, cubeToUVCompact (lightToPosition + offset .yyx, texelSize .y), shadowCoord .z) +\n            texture2DCompare (index, cubeToUVCompact (lightToPosition, texelSize .y), shadowCoord .z) +\n            texture2DCompare (index, cubeToUVCompact (lightToPosition + offset .xxy, texelSize .y), shadowCoord .z) +\n            texture2DCompare (index, cubeToUVCompact (lightToPosition + offset .yxy, texelSize .y), shadowCoord .z) +\n            texture2DCompare (index, cubeToUVCompact (lightToPosition + offset .xxx, texelSize .y), shadowCoord .z) +\n            texture2DCompare (index, cubeToUVCompact (lightToPosition + offset .yxx, texelSize .y), shadowCoord .z)\n         ) * (1.0 / 9.0);\n\n         return light .shadowIntensity * value;\n\n      #else // no percentage-closer filtering\n\n         float value = texture2DCompare (index, cubeToUVCompact (lightToPosition, texelSize .y), shadowCoord .z);\n\n         return light .shadowIntensity * value;\n\n      #endif\n   }\n   else\n   {\n      #if defined (X3D_PCF_FILTERING)\n\n         vec2 texelSize   = vec2 (1.0) / vec2 (light .shadowMapSize);\n         vec4 shadowCoord = light .shadowMatrix * vec4 (vertex, 1.0);\n\n         shadowCoord .z   -= light .shadowBias;\n         shadowCoord .xyz /= shadowCoord .w;\n\n         float dx0 = - texelSize .x;\n         float dy0 = - texelSize .y;\n         float dx1 = + texelSize .x;\n         float dy1 = + texelSize .y;\n\n         float value = (\n            texture2DCompare (index, shadowCoord .xy + vec2 (dx0, dy0), shadowCoord .z) +\n            texture2DCompare (index, shadowCoord .xy + vec2 (0.0, dy0), shadowCoord .z) +\n            texture2DCompare (index, shadowCoord .xy + vec2 (dx1, dy0), shadowCoord .z) +\n            texture2DCompare (index, shadowCoord .xy + vec2 (dx0, 0.0), shadowCoord .z) +\n            texture2DCompare (index, shadowCoord .xy, shadowCoord .z) +\n            texture2DCompare (index, shadowCoord .xy + vec2 (dx1, 0.0), shadowCoord .z) +\n            texture2DCompare (index, shadowCoord .xy + vec2 (dx0, dy1), shadowCoord .z) +\n            texture2DCompare (index, shadowCoord .xy + vec2 (0.0, dy1), shadowCoord .z) +\n            texture2DCompare (index, shadowCoord .xy + vec2 (dx1, dy1), shadowCoord .z)\n         ) * (1.0 / 9.0);\n\n         return light .shadowIntensity * value;\n\n      #elif defined (X3D_PCF_SOFT_FILTERING)\n\n         vec2 texelSize   = vec2 (1.0) / vec2 (light .shadowMapSize);\n         vec4 shadowCoord = light .shadowMatrix * vec4 (vertex, 1.0);\n\n         shadowCoord .z   -= light .shadowBias;\n         shadowCoord .xyz /= shadowCoord .w;\n\n         float dx0 = - texelSize.x;\n         float dy0 = - texelSize.y;\n         float dx1 = + texelSize.x;\n         float dy1 = + texelSize.y;\n\n         float value = (\n            texture2DShadowLerp (index, texelSize, float (shadowMapSize), shadowCoord .xy + vec2 (dx0, dy0), shadowCoord .z) +\n            texture2DShadowLerp (index, texelSize, float (shadowMapSize), shadowCoord .xy + vec2 (0.0, dy0), shadowCoord .z) +\n            texture2DShadowLerp (index, texelSize, float (shadowMapSize), shadowCoord .xy + vec2 (dx1, dy0), shadowCoord .z) +\n            texture2DShadowLerp (index, texelSize, float (shadowMapSize), shadowCoord .xy + vec2 (dx0, 0.0), shadowCoord .z) +\n            texture2DShadowLerp (index, texelSize, float (shadowMapSize), shadowCoord .xy, shadowCoord .z) +\n            texture2DShadowLerp (index, texelSize, float (shadowMapSize), shadowCoord .xy + vec2 (dx1, 0.0), shadowCoord .z) +\n            texture2DShadowLerp (index, texelSize, float (shadowMapSize), shadowCoord .xy + vec2 (dx0, dy1), shadowCoord .z) +\n            texture2DShadowLerp (index, texelSize, float (shadowMapSize), shadowCoord .xy + vec2 (0.0, dy1), shadowCoord .z) +\n            texture2DShadowLerp (index, texelSize, float (shadowMapSize), shadowCoord .xy + vec2 (dx1, dy1), shadowCoord .z)\n         ) * ( 1.0 / 9.0 );\n\n         return light .shadowIntensity * value;\n\n      #else // no percentage-closer filtering\n\n         vec4 shadowCoord = shadowMatrix * vec4 (vertex, 1.0);\n\n         shadowCoord .z   -= shadowBias;\n         shadowCoord .xyz /= shadowCoord .w;\n\n         float value = texture2DCompare (index, shadowCoord .xy, shadowCoord .z);\n\n         return light .shadowIntensity * value;\n\n      #endif\n   }\n\n   return 0.0;\n}\n\n#endif\n';n.set("assets/shaders/webgl1/include/Shadow.glsl",jg);const Gg=jg,Hg="\nfloat\ngetSpotFactor (const in float cutOffAngle, const in float beamWidth, const in vec3 L, const in vec3 d)\n{\n   float spotAngle = acos (clamp (dot (-L, d), -1.0, 1.0));\n\n   if (spotAngle >= cutOffAngle)\n      return 0.0;\n   else if (spotAngle <= beamWidth)\n      return 1.0;\n\n   return (spotAngle - cutOffAngle) / (beamWidth - cutOffAngle);\n}\n";n.set("assets/shaders/webgl1/include/SpotFactor.glsl",Hg);const qg=Hg,Yg='\n#if defined (X3D_TEXTURE) || defined (X3D_MATERIAL_TEXTURES)\n\n#pragma X3D include "Perlin.glsl"\n\nuniform mat4 x3d_TextureMatrix [X3D_NUM_TEXTURE_TRANSFORMS];\n\nmat4\ngetTextureMatrix (const in int i)\n{\n   #if defined (X3D_MULTI_TEXTURING)\n      mat4 textureMatrix = mat4 (0.0);\n\n      #if X3D_NUM_TEXTURE_TRANSFORMS > 0\n      if (i == 0)\n         textureMatrix = x3d_TextureMatrix [0];\n      #endif\n\n      #if X3D_NUM_TEXTURE_TRANSFORMS > 1\n      else if (i == 1)\n         textureMatrix = x3d_TextureMatrix [1];\n      #endif\n\n      return textureMatrix;\n   #else\n      return x3d_TextureMatrix [0];\n   #endif\n}\n\nvec4\ngetTexCoord (const in int i)\n{\n   #if defined (X3D_MULTI_TEXTURING)\n      vec4 texCoord = vec4 (0.0);\n\n      #if X3D_NUM_TEXTURE_COORDINATES > 0\n      if (i == 0)\n         texCoord = texCoord0;\n      #endif\n\n      #if X3D_NUM_TEXTURE_COORDINATES > 1\n      else if (i == 1)\n         texCoord = texCoord1;\n      #endif\n\n      return texCoord;\n   #else\n      return texCoord0;\n   #endif\n}\n\nvec4\ngetTexCoord (const in x3d_TextureCoordinateGeneratorParameters textureCoordinateGenerator, const in int textureTransformMapping, const in int textureCoordinateMapping)\n{\n   int mode = textureCoordinateGenerator .mode;\n\n   if (mode == x3d_None)\n   {\n      return getTextureMatrix (textureTransformMapping) * getTexCoord (textureCoordinateMapping);\n   }\n   else if (mode == x3d_Sphere)\n   {\n      vec2 N = normalize (gl_FrontFacing ? normal : -normal) .xy;\n\n      return vec4 (N * 0.5 + 0.5, 0.0, 1.0);\n   }\n   else if (mode == x3d_CameraSpaceNormal)\n   {\n      vec3 N = normalize (gl_FrontFacing ? normal : -normal);\n\n      return vec4 (N, 1.0);\n   }\n   else if (mode == x3d_CameraSpacePosition)\n   {\n      return vec4 (vertex, 1.0);\n   }\n   else if (mode == x3d_CameraSpaceReflectionVector)\n   {\n      vec3 N = normalize (gl_FrontFacing ? normal : -normal);\n\n      return vec4 (reflect (normalize (vertex), -N), 1.0);\n   }\n   else if (mode == x3d_SphereLocal)\n   {\n      vec2 N = normalize (gl_FrontFacing ? localNormal : -localNormal) .xy;\n\n      return vec4 (N * 0.5 + 0.5, 0.0, 1.0);\n   }\n   else if (mode == x3d_Coord)\n   {\n      return vec4 (localVertex, 1.0);\n   }\n   else if (mode == x3d_CoordEye)\n   {\n      return vec4 (vertex, 1.0);\n   }\n   else if (mode == x3d_Noise)\n   {\n      vec3 scale       = vec3 (textureCoordinateGenerator .parameter [0], textureCoordinateGenerator .parameter [1], textureCoordinateGenerator .parameter [2]);\n      vec3 translation = vec3 (textureCoordinateGenerator .parameter [3], textureCoordinateGenerator .parameter [4], textureCoordinateGenerator .parameter [5]);\n\n      return vec4 (perlin (localVertex * scale + translation), 1.0);\n   }\n   else if (mode == x3d_NoiseEye)\n   {\n      vec3 scale       = vec3 (textureCoordinateGenerator .parameter [0], textureCoordinateGenerator .parameter [1], textureCoordinateGenerator .parameter [2]);\n      vec3 translation = vec3 (textureCoordinateGenerator .parameter [3], textureCoordinateGenerator .parameter [4], textureCoordinateGenerator .parameter [5]);\n\n      return vec4 (perlin (vertex * scale + translation), 1.0);\n   }\n   else if (mode == x3d_SphereReflect)\n   {\n      vec3  N   = normalize (gl_FrontFacing ? normal : -normal);\n      float eta = textureCoordinateGenerator .parameter [0];\n\n      return vec4 (refract (normalize (vertex), -N, eta), 1.0);\n   }\n   else if (mode == x3d_SphereReflectLocal)\n   {\n      vec3  N   = normalize (gl_FrontFacing ? localNormal : -localNormal);\n      float eta = textureCoordinateGenerator .parameter [0];\n      vec3  eye = vec3 (textureCoordinateGenerator .parameter [1], textureCoordinateGenerator .parameter [2], textureCoordinateGenerator .parameter [3]);\n\n      return vec4 (refract (normalize (localVertex - eye), -N, eta), 1.0);\n   }\n\n   return getTextureMatrix (textureTransformMapping) * getTexCoord (textureCoordinateMapping);\n}\n\nuniform x3d_TextureCoordinateGeneratorParameters x3d_TextureCoordinateGenerator [X3D_NUM_TEXTURE_COORDINATES];\n\nvec3\ngetTexCoord (const in int textureTransformMapping, const in int textureCoordinateMapping)\n{\n   vec4 texCoord;\n\n   #if X3D_NUM_TEXTURE_COORDINATES > 0\n   if (textureCoordinateMapping == 0)\n      texCoord = getTexCoord (x3d_TextureCoordinateGenerator [0], textureTransformMapping, textureCoordinateMapping);\n   #endif\n\n   #if X3D_NUM_TEXTURE_COORDINATES > 1\n   else if (textureCoordinateMapping == 1)\n      texCoord = getTexCoord (x3d_TextureCoordinateGenerator [1], textureTransformMapping, textureCoordinateMapping);\n   #endif\n\n   texCoord .stp /= texCoord .q;\n\n   #if defined (X3D_GEOMETRY_2D)\n      if (gl_FrontFacing == false)\n         texCoord .s = 1.0 - texCoord .s;\n   #endif\n\n   return texCoord .stp;\n}\n\n#endif // X3D_TEXTURE || X3D_MATERIAL_TEXTURES\n\n#if defined (X3D_TEXTURE)\n\nuniform sampler2D   x3d_Texture2D [X3D_NUM_TEXTURES];\nuniform samplerCube x3d_TextureCube [X3D_NUM_TEXTURES];\n\n#if defined (X3D_MULTI_TEXTURING)\nvec4\ngetTexture (const in int i, const in vec3 texCoord)\n{\n   vec4 textureColor = vec4 (0.0);\n\n   #if X3D_NUM_TEXTURES > 0\n   if (i == 0)\n   {\n      #if defined (X3D_TEXTURE0_2D)\n         textureColor = texture2D (x3d_Texture2D [0], texCoord .st);\n      #elif defined (X3D_TEXTURE0_CUBE)\n         textureColor = textureCube (x3d_TextureCube [0], texCoord .stp);\n      #endif\n   }\n   #endif\n\n   #if X3D_NUM_TEXTURES > 1\n   else if (i == 1)\n   {\n      #if defined (X3D_TEXTURE0_2D)\n         textureColor = texture2D (x3d_Texture2D [1], texCoord .st);\n      #elif defined (X3D_TEXTURE0_CUBE)\n         textureColor = textureCube (x3d_TextureCube [1], texCoord .stp);\n      #endif\n   }\n   #endif\n\n   return textureColor;\n}\n#endif\n\n#if defined (X3D_MULTI_TEXTURING)\n   uniform vec4 x3d_MultiTextureColor;\n   uniform x3d_MultiTextureParameters x3d_MultiTexture [X3D_NUM_TEXTURES];\n#endif\n\nvec4\ngetTextureColor (const in vec4 diffuseColor, const in vec4 specularColor)\n{\n   #if defined (X3D_MULTI_TEXTURING)\n      vec4 currentColor = diffuseColor;\n\n      for (int i = 0; i < X3D_NUM_TEXTURES; ++ i)\n      {\n         // Get texture color.\n\n         vec3 texCoord     = getTexCoord (i, i);\n         vec4 textureColor = getTexture (i, texCoord);\n\n         // Multi texturing\n\n         x3d_MultiTextureParameters multiTexture = x3d_MultiTexture [i];\n\n         vec4 arg1 = textureColor;\n         vec4 arg2 = currentColor;\n\n         // Source\n\n         int source = multiTexture .source;\n\n         if (source == x3d_Diffuse)\n         {\n            arg1 = diffuseColor;\n         }\n         else if (source == x3d_Specular)\n         {\n            arg1 = specularColor;\n         }\n         else if (source == x3d_Factor)\n         {\n            arg1 = x3d_MultiTextureColor;\n         }\n\n         // Function\n\n         int function = multiTexture .function;\n\n         if (function == x3d_Complement)\n         {\n            arg1 = 1.0 - arg1;\n         }\n         else if (function == x3d_AlphaReplicate)\n         {\n            arg1 .a = arg2 .a;\n         }\n\n         // Mode\n\n         int mode      = multiTexture .mode;\n         int alphaMode = multiTexture .alphaMode;\n\n         // RGB\n\n         if (mode == x3d_Replace)\n         {\n            currentColor .rgb = arg1 .rgb;\n         }\n         else if (mode == x3d_Modulate)\n         {\n            currentColor .rgb = arg1 .rgb * arg2 .rgb;\n         }\n         else if (mode == x3d_Modulate2X)\n         {\n            currentColor .rgb = (arg1 .rgb * arg2 .rgb) * 2.0;\n         }\n         else if (mode == x3d_Modulate4X)\n         {\n            currentColor .rgb = (arg1 .rgb * arg2 .rgb) * 4.0;\n         }\n         else if (mode == x3d_Add)\n         {\n            currentColor .rgb = arg1 .rgb + arg2 .rgb;\n         }\n         else if (mode == x3d_AddSigned)\n         {\n            currentColor .rgb = arg1 .rgb + arg2 .rgb - 0.5;\n         }\n         else if (mode == x3d_AddSigned2X)\n         {\n            currentColor .rgb = (arg1 .rgb + arg2 .rgb - 0.5) * 2.0;\n         }\n         else if (mode == x3d_AddSmooth)\n         {\n            currentColor .rgb = arg1 .rgb + (1.0 - arg1 .rgb) * arg2 .rgb;\n         }\n         else if (mode == x3d_Subtract)\n         {\n            currentColor .rgb = arg1 .rgb - arg2 .rgb;\n         }\n         else if (mode == x3d_BlendDiffuseAlpha)\n         {\n            currentColor .rgb = arg1 .rgb * diffuseColor .a + arg2 .rgb * (1.0 - diffuseColor .a);\n         }\n         else if (mode == x3d_BlendTextureAlpha)\n         {\n            currentColor .rgb = arg1 .rgb * arg1 .a + arg2 .rgb * (1.0 - arg1 .a);\n         }\n         else if (mode == x3d_BlendFactorAlpha)\n         {\n            currentColor .rgb = arg1 .rgb * x3d_MultiTextureColor .a + arg2 .rgb * (1.0 - x3d_MultiTextureColor .a);\n         }\n         else if (mode == x3d_BlendCurrentAlpha)\n         {\n            currentColor .rgb = arg1 .rgb * arg2 .a + arg2 .rgb * (1.0 - arg2 .a);\n         }\n         else if (mode == x3d_ModulateAlphaAddColor)\n         {\n            currentColor .rgb = arg1 .rgb + arg1 .a * arg2 .rgb;\n         }\n         else if (mode == x3d_ModulateInvAlphaAddColor)\n         {\n            currentColor .rgb = (1.0 - arg1 .a) * arg2 .rgb + arg1 .rgb;\n         }\n         else if (mode == x3d_ModulateInvColorAddAlpha)\n         {\n            currentColor .rgb = (1.0 - arg1 .rgb) * arg2 .rgb + arg1 .a;\n         }\n         else if (mode == x3d_DotProduct3)\n         {\n            currentColor .rgb = vec3 (dot (arg1 .rgb * 2.0 - 1.0, arg2 .rgb * 2.0 - 1.0));\n         }\n         else if (mode == x3d_SelectArg1)\n         {\n            currentColor .rgb = arg1 .rgb;\n         }\n         else if (mode == x3d_SelectArg2)\n         {\n            currentColor .rgb = arg2 .rgb;\n         }\n         else if (mode == x3d_Off)\n            ;\n\n         // Alpha\n\n         if (alphaMode == x3d_Replace)\n         {\n            currentColor .a = arg1 .a;\n         }\n         else if (alphaMode == x3d_Modulate)\n         {\n            currentColor .a = arg1 .a * arg2 .a;\n         }\n         else if (alphaMode == x3d_Modulate2X)\n         {\n            currentColor .a = (arg1 .a * arg2 .a) * 2.0;\n         }\n         else if (alphaMode == x3d_Modulate4X)\n         {\n            currentColor .a = (arg1 .a * arg2 .a) * 4.0;\n         }\n         else if (alphaMode == x3d_Add)\n         {\n            currentColor .a = arg1 .a + arg2 .a;\n         }\n         else if (alphaMode == x3d_AddSigned)\n         {\n            currentColor .a = arg1 .a + arg2 .a - 0.5;\n         }\n         else if (alphaMode == x3d_AddSigned2X)\n         {\n            currentColor .a = (arg1 .a + arg2 .a - 0.5) * 2.0;\n         }\n         else if (alphaMode == x3d_AddSmooth)\n         {\n            currentColor .a = arg1 .a + (1.0 - arg1 .a) * arg2 .a;\n         }\n         else if (alphaMode == x3d_Subtract)\n         {\n            currentColor .a = arg1 .a - arg2 .a;\n         }\n         else if (alphaMode == x3d_BlendDiffuseAlpha)\n         {\n            currentColor .a = arg1 .a * diffuseColor .a + arg2 .a * (1.0 - diffuseColor .a);\n         }\n         else if (alphaMode == x3d_BlendTextureAlpha)\n         {\n            currentColor .a = arg1 .a * arg1 .a + arg2 .a * (1.0 - arg1 .a);\n         }\n         else if (alphaMode == x3d_BlendFactorAlpha)\n         {\n            currentColor .a = arg1 .a * x3d_MultiTextureColor .a + arg2 .a * (1.0 - x3d_MultiTextureColor .a);\n         }\n         else if (alphaMode == x3d_BlendCurrentAlpha)\n         {\n            currentColor .a = arg1 .a * arg2 .a + arg2 .a * (1.0 - arg2 .a);\n         }\n         else if (alphaMode == x3d_ModulateAlphaAddColor)\n         {\n            currentColor .a = arg1 .a + arg1 .a * arg2 .a;\n         }\n         else if (alphaMode == x3d_ModulateInvAlphaAddColor)\n         {\n            currentColor .a = (1.0 - arg1 .a) * arg2 .a + arg1 .a;\n         }\n         else if (alphaMode == x3d_ModulateInvColorAddAlpha)\n         {\n            currentColor .a = (1.0 - arg1 .a) * arg2 .a + arg1 .a;\n         }\n         else if (alphaMode == x3d_DotProduct3)\n         {\n            currentColor .a = dot (arg1 .rgb * 2.0 - 1.0, arg2 .rgb * 2.0 - 1.0);\n         }\n         else if (alphaMode == x3d_SelectArg1)\n         {\n            currentColor .a = arg1 .a;\n         }\n         else if (alphaMode == x3d_SelectArg2)\n         {\n            currentColor .a = arg2 .a;\n         }\n         else if (alphaMode == x3d_Off)\n            ;\n      }\n\n      return currentColor;\n   #else\n      // Get texture color.\n\n      vec3 texCoord = getTexCoord (0, 0);\n\n      #if defined (X3D_TEXTURE0_2D)\n         vec4 textureColor = texture2D (x3d_Texture2D [0], texCoord .st);\n      #elif defined (X3D_TEXTURE0_CUBE)\n         vec4 textureColor = textureCube (x3d_TextureCube [0], texCoord .stp);\n      #endif\n\n      return diffuseColor * textureColor;\n   #endif\n}\n\n#endif\n\n#if defined (X3D_PROJECTIVE_TEXTURE_MAPPING)\n\nuniform sampler2D x3d_ProjectiveTexture [X3D_NUM_TEXTURE_PROJECTORS];\nuniform mat4      x3d_ProjectiveTextureMatrix [X3D_NUM_TEXTURE_PROJECTORS];\nuniform vec3      x3d_ProjectiveTextureLocation [X3D_NUM_TEXTURE_PROJECTORS];\n\nvec4\ngetProjectiveTexture (const in int i, const in vec2 texCoord)\n{\n   vec4 color = vec4 (0.0);\n\n   #if X3D_NUM_TEXTURE_PROJECTORS > 0\n   if (i == 0)\n      color = texture2D (x3d_ProjectiveTexture [0], texCoord);\n   #endif\n\n   #if X3D_NUM_TEXTURE_PROJECTORS > 1\n   else if (i == 1)\n      color = texture2D (x3d_ProjectiveTexture [1], texCoord);\n   #endif\n\n   return color;\n}\n\nvec4\ngetProjectiveTextureColor (in vec4 currentColor)\n{\n   vec3 N = gl_FrontFacing ? normal : -normal;\n\n   for (int i = 0; i < X3D_NUM_TEXTURE_PROJECTORS; ++ i)\n   {\n      vec4 texCoord = x3d_ProjectiveTextureMatrix [i] * vec4 (vertex, 1.0);\n\n      texCoord .stp /= texCoord .q;\n\n      if (texCoord .s < 0.0 || texCoord .s > 1.0)\n         continue;\n\n      if (texCoord .t < 0.0 || texCoord .t > 1.0)\n         continue;\n\n      if (texCoord .p < 0.0 || texCoord .p > 1.0)\n         continue;\n\n      // We do not need to normalze p, as we only need the sign of the dot product.\n      vec3 p = x3d_ProjectiveTextureLocation [i] - vertex;\n\n      if (dot (N, p) < 0.0)\n         continue;\n\n      currentColor *= getProjectiveTexture (i, texCoord .st);\n   }\n\n   return currentColor;\n}\n\n#endif // X3D_PROJECTIVE_TEXTURE_MAPPING\n';n.set("assets/shaders/webgl1/include/Texture.glsl",Yg);const Wg=Yg,Kg='\n// Uniforms\n\nuniform mat4 x3d_ProjectionMatrix;\nuniform mat4 x3d_ModelViewMatrix;\n\n// Attributes\n\n#if defined (X3D_FOG) && defined (X3D_FOG_COORDS)\n   attribute float x3d_FogDepth;\n#endif\n\n#if defined (X3D_COLOR_MATERIAL)\n   attribute vec4 x3d_Color;\n#endif\n\n#if ! defined (X3D_GEOMETRY_0D) && ! defined (X3D_GEOMETRY_1D)\n   #if defined (X3D_TEXTURE) || defined (X3D_MATERIAL_TEXTURES)\n      #if X3D_NUM_TEXTURE_COORDINATES > 0\n         attribute vec4 x3d_TexCoord0;\n      #endif\n\n      #if X3D_NUM_TEXTURE_COORDINATES > 1\n         attribute vec4 x3d_TexCoord1;\n      #endif\n   #endif\n#endif\n\nattribute vec4 x3d_Vertex;\n\n// Varyings\n\n#if defined (X3D_FOG) && defined (X3D_FOG_COORDS)\n   varying float fogDepth;\n#endif\n\n#if defined (X3D_COLOR_MATERIAL)\n   varying vec4 color;\n#endif\n\n#if ! defined (X3D_GEOMETRY_0D) && ! defined (X3D_GEOMETRY_1D)\n   #if defined (X3D_TEXTURE) || defined (X3D_MATERIAL_TEXTURES)\n      #if X3D_NUM_TEXTURE_COORDINATES > 0\n         varying vec4 texCoord0;\n      #endif\n\n      #if X3D_NUM_TEXTURE_COORDINATES > 1\n         varying vec4 texCoord1;\n      #endif\n   #endif\n#endif\n\n#if defined (X3D_NORMALS)\n   uniform mat3 x3d_NormalMatrix;\n   attribute vec3 x3d_Normal;\n   varying vec3 normal;\n\n   #if defined (X3D_TEXTURE) || defined (X3D_MATERIAL_TEXTURES)\n      varying vec3 localNormal;\n   #endif\n#endif\n\nvarying vec3 vertex;\n\n#if defined (X3D_TEXTURE) || defined (X3D_MATERIAL_TEXTURES)\n   varying vec3 localVertex;\n#endif\n\n#if defined (X3D_LOGARITHMIC_DEPTH_BUFFER)\n   varying float depth;\n#endif\n\n// Main\n\n#pragma X3D include "PointSize.glsl"\n\nvoid\nvertex_main ()\n{\n   vec4 position = x3d_ModelViewMatrix * x3d_Vertex;\n\n   vertex = position .xyz;\n\n   #if defined (X3D_GEOMETRY_0D)\n      #if defined (X3D_STYLE_PROPERTIES)\n         gl_PointSize = pointSize = getPointSize (vertex);\n      #else\n         gl_PointSize = 1.0;\n      #endif\n   #endif\n\n   #if defined (X3D_FOG) && defined (X3D_FOG_COORDS)\n      fogDepth = x3d_FogDepth;\n   #endif\n\n   #if defined (X3D_COLOR_MATERIAL)\n      color = x3d_Color;\n   #endif\n\n   #if ! defined (X3D_GEOMETRY_0D) && ! defined (X3D_GEOMETRY_1D)\n      #if defined (X3D_TEXTURE) || defined (X3D_MATERIAL_TEXTURES)\n         #if X3D_NUM_TEXTURE_COORDINATES > 0\n            texCoord0 = x3d_TexCoord0;\n         #endif\n\n         #if X3D_NUM_TEXTURE_COORDINATES > 1\n            texCoord1 = x3d_TexCoord1;\n         #endif\n      #endif\n   #endif\n\n   #if defined (X3D_NORMALS)\n      normal      = x3d_NormalMatrix * x3d_Normal;\n\n      #if defined (X3D_TEXTURE) || defined (X3D_MATERIAL_TEXTURES)\n         localNormal = x3d_Normal;\n      #endif\n   #endif\n\n   #if defined (X3D_TEXTURE) || defined (X3D_MATERIAL_TEXTURES)\n      localVertex = x3d_Vertex .xyz;\n   #endif\n\n   gl_Position = x3d_ProjectionMatrix * position;\n\n   #if defined (X3D_LOGARITHMIC_DEPTH_BUFFER)\n      depth = 1.0 + gl_Position .w;\n   #endif\n}\n';n.set("assets/shaders/webgl1/include/Vertex.glsl",Kg);const Jg=Kg,Zg="\n#if defined (X3D_CLIP_PLANES)\n\nuniform vec4 x3d_ClipPlane [X3D_NUM_CLIP_PLANES];\n\nvoid\nclip ()\n{\n   for (int i = 0; i < X3D_NUM_CLIP_PLANES; ++ i)\n   {\n      if (dot (vertex, x3d_ClipPlane [i] .xyz) - x3d_ClipPlane [i] .w < 0.0)\n         discard;\n   }\n}\n\n#endif\n";n.set("assets/shaders/webgl2/include/ClipPlanes.glsl",Zg);const Qg=Zg,$g="\n#define MANUAL_SRGB\n\nvec4\nSRGBtoLINEAR (const in vec4 srgbIn)\n{\n   #if defined (MANUAL_SRGB)\n      #if defined (SRGB_FAST_APPROXIMATION)\n         vec3 linOut = pow (srgbIn .xyz, vec3 (2.2));\n      #else //SRGB_FAST_APPROXIMATION\n         vec3 bLess  = step (vec3 (0.04045), srgbIn .xyz);\n         vec3 linOut = mix (srgbIn .xyz / vec3 (12.92), pow ((srgbIn .xyz + vec3 (0.055)) / vec3 (1.055), vec3 (2.4)), bLess);\n      #endif //SRGB_FAST_APPROXIMATION\n      return vec4 (linOut, srgbIn .w);\n   #else //MANUAL_SRGB\n      return srgbIn;\n   #endif //MANUAL_SRGB\n}\n\nvec4\nGamma (const in vec4 color)\n{\n   #if defined (MANUAL_SRGB)\n      return vec4 (pow (color .rgb, vec3 (1.0 / 2.2)), color .a);\n   #else\n      return color;\n   #endif\n}\n";n.set("assets/shaders/webgl2/include/Colors.glsl",$g);const tm=$g,em="\n#if defined (X3D_FOG)\n\nuniform x3d_FogParameters x3d_Fog;\n\nfloat\ngetFogInterpolant ()\n{\n   // Returns 0.0 for fog color and 1.0 for material color.\n\n   #if defined (X3D_FOG_COORDS)\n      return clamp (1.0 - fogDepth, 0.0, 1.0);\n   #else\n      float visibilityRange = x3d_Fog .visibilityRange;\n      float dV              = length (x3d_Fog .matrix * vertex);\n\n      #if defined (X3D_FOG_LINEAR)\n         return max (0.0, visibilityRange - dV) / visibilityRange;\n      #elif defined (X3D_FOG_EXPONENTIAL)\n         return exp (-dV / max (0.001, visibilityRange - dV));\n      #endif\n   #endif\n}\n\nvec3\ngetFogColor (const in vec3 color)\n{\n   return mix (x3d_Fog .color, color, getFogInterpolant ());\n}\n\n#endif\n";n.set("assets/shaders/webgl2/include/Fog.glsl",em);const nm=em,im='\nuniform float x3d_AlphaCutoff;\n\n#if defined (X3D_FOG) && defined (X3D_FOG_COORDS)\n   in float fogDepth;\n#endif\n\n#if defined (X3D_COLOR_MATERIAL)\n   in vec4 color;\n#endif\n\n#if ! defined (X3D_GEOMETRY_0D) && ! defined (X3D_GEOMETRY_1D)\n   #if defined (X3D_TEXTURE) || defined (X3D_MATERIAL_TEXTURES)\n      #if X3D_NUM_TEXTURE_COORDINATES > 0\n         in vec4 texCoord0;\n      #endif\n\n      #if X3D_NUM_TEXTURE_COORDINATES > 1\n         in vec4 texCoord1;\n      #endif\n   #endif\n#else\n   #if defined (X3D_TEXTURE) || defined (X3D_MATERIAL_TEXTURES)\n      #if X3D_NUM_TEXTURE_COORDINATES > 0\n         vec4 texCoord0 = vec4 (0.0);\n      #endif\n\n      #if X3D_NUM_TEXTURE_COORDINATES > 1\n         vec4 texCoord1 = vec4 (0.0);\n      #endif\n   #endif\n#endif\n\n#if defined (X3D_NORMALS)\n   in vec3 normal;\n\n   #if defined (X3D_TEXTURE) || defined (X3D_MATERIAL_TEXTURES)\n      in vec3 localNormal;\n   #endif\n#else\n   const vec3 normal = vec3 (0.0, 0.0, 1.0);\n\n   #if defined (X3D_TEXTURE) || defined (X3D_MATERIAL_TEXTURES)\n      const vec3 localNormal = vec3 (0.0, 0.0, 1.0);\n   #endif\n#endif\n\nin vec3 vertex;\n\n#if defined (X3D_TEXTURE) || defined (X3D_MATERIAL_TEXTURES)\n   in vec3 localVertex;\n#endif\n\n#if defined (X3D_LOGARITHMIC_DEPTH_BUFFER)\n   uniform float x3d_LogarithmicFarFactor1_2;\n   in float depth;\n#endif\n\nout vec4 x3d_FragColor;\n\n#pragma X3D include "Point.glsl"\n#pragma X3D include "Stipple.glsl"\n#pragma X3D include "Hatch.glsl"\n#pragma X3D include "Fog.glsl"\n#pragma X3D include "ClipPlanes.glsl"\n#pragma X3D include "Texture.glsl"\n\nvec4\ngetMaterialColor ();\n\nvec4\ngetFinalColor ()\n{\n   #if defined (X3D_GEOMETRY_0D) && defined (X3D_STYLE_PROPERTIES)\n      #if defined (X3D_TEXTURE) || defined (X3D_MATERIAL_TEXTURES)\n         setTexCoords ();\n\n         return getMaterialColor ();\n       #else\n         return getPointColor (getMaterialColor ());\n      #endif\n   #else\n      return getMaterialColor ();\n   #endif\n}\n\nvoid\nfragment_main ()\n{\n   #if defined (X3D_CLIP_PLANES)\n      clip ();\n   #endif\n\n   #if defined (X3D_GEOMETRY_1D) && defined (X3D_STYLE_PROPERTIES)\n      stipple ();\n   #endif\n\n   vec4 finalColor = getFinalColor ();\n\n   #if (defined (X3D_GEOMETRY_2D) || defined (X3D_GEOMETRY_3D)) && defined (X3D_STYLE_PROPERTIES)\n      finalColor = getHatchColor (finalColor);\n   #endif\n\n   #if defined (X3D_FOG)\n      finalColor .rgb = getFogColor (finalColor .rgb);\n   #endif\n\n   if (finalColor .a < x3d_AlphaCutoff)\n      discard;\n\n   x3d_FragColor = finalColor;\n\n   #if defined (X3D_LOGARITHMIC_DEPTH_BUFFER)\n      //https://outerra.blogspot.com/2013/07/logarithmic-depth-buffer-optimizations.html\n      gl_FragDepth = log2 (depth) * x3d_LogarithmicFarFactor1_2;\n   #endif\n}\n';n.set("assets/shaders/webgl2/include/Fragment.glsl",im);const om=im,rm="\n#if (defined (X3D_GEOMETRY_2D) || defined (X3D_GEOMETRY_3D)) && defined (X3D_STYLE_PROPERTIES)\n\nuniform x3d_FillPropertiesParameters x3d_FillProperties;\n\nvec4\ngetHatchColor (vec4 color)\n{\n   vec4 finalColor = x3d_FillProperties .filled ? color : vec4 (0.0);\n\n   if (x3d_FillProperties .hatched)\n   {\n      vec4 hatch = texture (x3d_FillProperties .texture, gl_FragCoord .xy / 32.0);\n\n      hatch .rgb *= x3d_FillProperties .hatchColor;\n      finalColor  = mix (finalColor, hatch, hatch .a);\n   }\n\n   return finalColor;\n}\n\n#endif\n";n.set("assets/shaders/webgl2/include/Hatch.glsl",rm);const sm=rm,am="\nstruct Line2\n{\n   vec2 point;\n   vec2 direction;\n};\n\nLine2\nline2 (const in vec2 point1, const in vec2 point2)\n{\n   return Line2 (point1, normalize (point2 - point1));\n}\n\nvec2\nclosest_point (const in Line2 line, const in vec2 point)\n{\n   vec2  r = point - line .point;\n   float d = dot (r, line .direction);\n\n   return line .direction * d + line .point;\n}\n";n.set("assets/shaders/webgl2/include/Line2.glsl",am);const um=am,cm='\nuniform x3d_MaterialParameters x3d_Material;\n\n#if defined (X3D_LIGHTING)\n\n#pragma X3D include "SpotFactor.glsl"\n#pragma X3D include "Shadow.glsl"\n\nuniform x3d_LightSourceParameters x3d_LightSource [X3D_NUM_LIGHTS];\n\nvec3\ngetMaterialColor (const in vec3 vertex, const in vec3 N, const in vec3 ambientColor, const in vec3 diffuseColor, const in vec3 specularColor, const in float shininess)\n{\n   // Apply light sources\n\n   vec3 V = normalize (-vertex);\n\n   vec3 finalColor = vec3 (0.0);\n\n   for (int i = 0; i < X3D_NUM_LIGHTS; ++ i)\n   {\n      x3d_LightSourceParameters light = x3d_LightSource [i];\n\n      vec3  vL = light .location - vertex;\n      float dL = length (light .matrix * vL);\n      bool  di = light .type == x3d_DirectionalLight;\n\n      if (di || dL <= light .radius)\n      {\n         vec3 d = light .direction;\n         vec3 c = light .attenuation;\n         vec3 L = di ? -d : normalize (vL);      // Normalized vector from point on geometry to light source i position.\n         vec3 H = normalize (L + V);             // Specular term\n\n         float lightAngle     = max (dot (N, L), 0.0);      // Angle between normal and light ray.\n         vec3  diffuseTerm    = diffuseColor * lightAngle;\n         float specularFactor = shininess > 0.0 ? pow (max (dot (N, H), 0.0), shininess * 128.0) : 1.0;\n         vec3  specularTerm   = specularColor * specularFactor;\n\n         float attenuationFactor     = di ? 1.0 : 1.0 / max (dot (c, vec3 (1.0, dL, dL * dL)), 1.0);\n         float spotFactor            = light .type == x3d_SpotLight ? getSpotFactor (light .cutOffAngle, light .beamWidth, L, d) : 1.0;\n         float attenuationSpotFactor = attenuationFactor * spotFactor;\n         vec3  ambientTerm           = light .ambientIntensity * ambientColor;\n         vec3  diffuseSpecularTerm   = light .intensity * (diffuseTerm + specularTerm);\n\n         #if defined (X3D_FRAGMENT_SHADER) && defined (X3D_SHADOWS)\n            if (lightAngle > 0.0)\n               diffuseSpecularTerm = mix (diffuseSpecularTerm, light .shadowColor, getShadowIntensity (i, light));\n         #endif\n\n         finalColor += attenuationSpotFactor * light .color * (ambientTerm + diffuseSpecularTerm);\n      }\n   }\n\n   return finalColor;\n}\n\n#endif\n';n.set("assets/shaders/webgl2/include/Material.glsl",cm);const lm=cm,hm="\n#if defined (X3D_NORMAL_TEXTURE)\n// Tangent-Bitangent-Normal-Matrix\nmat3\ngetTBNMatrix (const in vec2 texCoord)\n{\n   vec3 pos_dx = dFdx (vertex);\n   vec3 pos_dy = dFdy (vertex);\n   vec3 tex_dx = dFdx (vec3 (texCoord, 0.0));\n   vec3 tex_dy = dFdy (vec3 (texCoord, 0.0));\n   vec3 t      = (tex_dy .t * pos_dx - tex_dx .t * pos_dy) / (tex_dx .s * tex_dy.t - tex_dy .s * tex_dx .t);\n   vec3 N      = normalize (normal); // OR generated face normal: n = normalize (cross (pos_dx, pos_dy));\n   vec3 T      = normalize (t - N * dot (N, t));\n   vec3 B      = normalize (cross (N, T));\n   mat3 tbn    = mat3 (T, B, N);\n\n   return tbn;\n}\n#endif\n\n#if defined (X3D_NORMAL_TEXTURE)\nuniform x3d_NormalTextureParameters x3d_NormalTexture;\n#endif\n\nvec3\ngetNormalVector (const in float normalScale)\n{\n   float facing = gl_FrontFacing ? 1.0 : -1.0;\n\n   // Get normal vector.\n\n   #if defined (X3D_NORMAL_TEXTURE)\n      vec3 texCoord = getTexCoord (x3d_NormalTexture .textureTransformMapping, x3d_NormalTexture .textureCoordinateMapping);\n      vec3 scale    = vec3 (vec2 (normalScale), 1.0);\n      mat3 tbn      = getTBNMatrix (texCoord .st);\n\n      #if defined (X3D_NORMAL_TEXTURE_2D)\n         vec3 n = texture (x3d_NormalTexture .texture2D, texCoord .st) .rgb;\n      #elif defined (X3D_NORMAL_TEXTURE_3D)\n         vec3 n = texture (x3d_NormalTexture .texture3D, texCoord) .rgb;\n      #elif defined (X3D_NORMAL_TEXTURE_CUBE)\n         vec3 n = texture (x3d_NormalTexture .textureCube, texCoord) .rgb;\n      #endif\n\n      return normalize (tbn * ((n * 2.0 - 1.0) * scale)) * facing;\n   #else\n      return normalize (normal) * facing;\n   #endif\n}\n";n.set("assets/shaders/webgl2/include/Normal.glsl",hm);const dm=hm,pm="\nvec4\npack (const in float value)\n{\n   const vec3 bitShifts = vec3 (255.0,\n                                255.0 * 255.0,\n                                255.0 * 255.0 * 255.0);\n\n   return vec4 (value, fract (value * bitShifts));\n}\n\n#if defined (X3D_DEPTH_TEXTURE)\n\nfloat\nunpack (const in vec4 color)\n{\n   return color .r;\n}\n\n#else\n\nfloat\nunpack (const vec4 color)\n{\n   const vec3 bitShifts = vec3 (1.0 / 255.0,\n                                1.0 / (255.0 * 255.0),\n                                1.0 / (255.0 * 255.0 * 255.0));\n\n   return color .x + dot (color .gba, bitShifts);\n}\n\n#endif\n";n.set("assets/shaders/webgl2/include/Pack.glsl",pm);const fm=pm,gm="\n#if defined (X3D_PARTICLE_SYSTEM)\n\nin vec4 x3d_Particle;\nin mat4 x3d_ParticleMatrix;\n\nuniform sampler2D x3d_TexCoordRamp;\n\nvec4\ntexelFetch (const in sampler2D sampler, const in int index, const in int lod)\n{\n   int   x = textureSize (sampler, lod) .x;\n   ivec2 p = ivec2 (index % x, index / x);\n   vec4  t = texelFetch (sampler, p, lod);\n\n   return t;\n}\n\n#if defined (X3D_TEX_COORD_RAMP)\nvec4\ngetTexCoord (const in vec4 texCoord)\n{\n   const int map [6] = int [6] (0, 1, 2, 0, 2, 3);\n\n   int index0 = int (x3d_Particle [3]);\n\n   return texelFetch (x3d_TexCoordRamp, index0 + map [gl_VertexID % 6], 0);\n}\n#else\n   #define getTexCoord(texCoord) texCoord\n#endif\n\nvec4\ngetVertex (const in vec4 vertex)\n{\n   return x3d_ParticleMatrix * vertex;\n}\n\n#else\n\n#define getVertex(vertex) vertex\n#define getTexCoord(texCoord) texCoord\n\n#endif\n";n.set("assets/shaders/webgl2/include/Particle.glsl",gm);const mm=gm,_m="\n//https://gist.github.com/patriciogonzalezvivo/670c22f3966e662d2f83\n\nfloat rand (vec2 co) { return fract (sin (dot (co.xy, vec2 (12.9898,78.233))) * 43758.5453); }\nfloat rand (vec2 co, float l) { return rand (vec2 (rand (co), l)); }\nfloat rand (vec2 co, float l, float t) { return rand (vec2 (rand (co, l), t)); }\n\nfloat\nperlin (vec2 p, float dim, float time)\n{\n   const float M_PI = 3.14159265358979323846;\n\n   vec2 pos   = floor (p * dim);\n   vec2 posx  = pos + vec2 (1.0, 0.0);\n   vec2 posy  = pos + vec2 (0.0, 1.0);\n   vec2 posxy = pos + vec2 (1.0);\n\n   float c   = rand (pos,   dim, time);\n   float cx  = rand (posx,  dim, time);\n   float cy  = rand (posy,  dim, time);\n   float cxy = rand (posxy, dim, time);\n\n   vec2 d = fract (p * dim);\n\n   d = -0.5 * cos (d * M_PI) + 0.5;\n\n   float ccx    = mix (c,   cx,    d.x);\n   float cycxy  = mix (cy,  cxy,   d.x);\n   float center = mix (ccx, cycxy, d.y);\n\n   return center * 2.0 - 1.0;\n}\n\nvec3\nperlin (vec3 p)\n{\n   return vec3 (perlin (p.xy, 1.0, 0.0),\n                perlin (p.yz, 1.0, 0.0),\n                perlin (p.zx, 1.0, 0.0));\n}\n";n.set("assets/shaders/webgl2/include/Perlin.glsl",_m);const xm=_m,ym="\n#if defined (X3D_GEOMETRY_0D) && defined (X3D_STYLE_PROPERTIES)\n\nin float pointSize;\n\n#if defined (X3D_TEXTURE) || defined (X3D_MATERIAL_TEXTURES)\nvoid\nsetTexCoords ()\n{\n   vec4 texCoord = vec4 (gl_PointCoord .x, 1.0 - gl_PointCoord .y, 0.0, 1.0);\n\n   #if X3D_NUM_TEXTURE_COORDINATES > 0\n      texCoord0 = texCoord;\n   #endif\n\n   #if X3D_NUM_TEXTURE_COORDINATES > 1\n      texCoord1 = texCoord;\n   #endif\n}\n#endif\n\nvec4\ngetPointColor (in vec4 color)\n{\n   if (pointSize > 1.0)\n      color .a *= clamp (pointSize * (0.5 - distance (vec2 (0.5), gl_PointCoord)), 0.0, 1.0);\n\n   else\n      color .a *= pointSize;\n\n   return color;\n}\n\n#endif\n";n.set("assets/shaders/webgl2/include/Point.glsl",ym);const wm=ym,Sm="\n#if defined (X3D_GEOMETRY_0D) && defined (X3D_STYLE_PROPERTIES)\n\nuniform x3d_PointPropertiesParameters x3d_PointProperties;\n\nout float pointSize;\n\nfloat\ngetPointSize (const in vec3 vertex)\n{\n   // Determine point size.\n\n   float pointSizeMinValue = x3d_PointProperties .pointSizeMinValue;\n   float pointSizeMaxValue = x3d_PointProperties .pointSizeMaxValue;\n   vec3  attenuation       = x3d_PointProperties .attenuation;\n   float dL                = length (vertex);\n   float pointSize         = 0.0;\n\n   pointSize  = x3d_PointProperties .pointSizeScaleFactor;\n   pointSize /= dot (attenuation, vec3 (1.0, dL, dL * dL));\n   pointSize  = clamp (pointSize, pointSizeMinValue, pointSizeMaxValue);\n\n   #if defined (X3D_TEXTURE) || defined (X3D_MATERIAL_TEXTURE)\n      return pointSize;\n   #else\n      return pointSize + 1.0 - step (pointSize, 1.0);\n   #endif\n}\n\n#endif\n";n.set("assets/shaders/webgl2/include/PointSize.glsl",Sm);const Tm=Sm,bm='\n#if defined (X3D_FRAGMENT_SHADER) && defined (X3D_SHADOWS)\n\n#pragma X3D include "Pack.glsl"\n\nuniform sampler2D x3d_ShadowMap [X3D_NUM_LIGHTS];\n\nfloat\ngetShadowDepth (const in int index, const in vec2 shadowCoord)\n{\n   switch (index)\n   {\n      #if X3D_NUM_LIGHTS > 0\n      case 0:\n      {\n         return unpack (texture (x3d_ShadowMap [0], shadowCoord));\n      }\n      #endif\n      #if X3D_NUM_LIGHTS > 1\n      case 1:\n      {\n         return unpack (texture (x3d_ShadowMap [1], shadowCoord));\n      }\n      #endif\n      #if X3D_NUM_LIGHTS > 2\n      case 2:\n      {\n         return unpack (texture (x3d_ShadowMap [2], shadowCoord));\n      }\n      #endif\n      #if X3D_NUM_LIGHTS > 3\n      case 3:\n      {\n         return unpack (texture (x3d_ShadowMap [3], shadowCoord));\n      }\n      #endif\n      #if X3D_NUM_LIGHTS > 4\n      case 4:\n      {\n         return unpack (texture (x3d_ShadowMap [4], shadowCoord));\n      }\n      #endif\n      #if X3D_NUM_LIGHTS > 5\n      case 5:\n      {\n         return unpack (texture (x3d_ShadowMap [5], shadowCoord));\n      }\n      #endif\n      #if X3D_NUM_LIGHTS > 6\n      case 6:\n      {\n         return unpack (texture (x3d_ShadowMap [6], shadowCoord));\n      }\n      #endif\n      #if X3D_NUM_LIGHTS > 7\n      case 7:\n      {\n         return unpack (texture (x3d_ShadowMap [7], shadowCoord));\n      }\n      #endif\n      default:\n      {\n         return 0.0;\n      }\n   }\n}\n\nfloat\ntexture2DCompare (const in int index, const in vec2 texCoord, const in float compare)\n{\n   float shadowDepth = getShadowDepth (index, texCoord);\n\n   return (1.0 - step (1.0, shadowDepth)) * step (shadowDepth, compare);\n}\n\nfloat\ntexture2DShadowLerp (const in int index, const in vec2 texelSize, const in float shadowMapSize, const in vec2 texCoord, const in float compare)\n{\n   const vec2 offset = vec2 (0.0, 1.0);\n\n   vec2 centroidTexCoord = floor (texCoord * shadowMapSize + 0.5) / shadowMapSize;\n\n   float lb = texture2DCompare (index, centroidTexCoord + texelSize * offset .xx, compare);\n   float lt = texture2DCompare (index, centroidTexCoord + texelSize * offset .xy, compare);\n   float rb = texture2DCompare (index, centroidTexCoord + texelSize * offset .yx, compare);\n   float rt = texture2DCompare (index, centroidTexCoord + texelSize * offset .yy, compare);\n\n   vec2 f = fract (texCoord * shadowMapSize + 0.5);\n\n   float a = mix (lb, lt, f.y);\n   float b = mix (rb, rt, f.y);\n   float c = mix (a, b, f.x);\n\n   return c;\n}\n\n//https://gist.github.com/tschw/da10c43c467ce8afd0c4\nvec2\ncubeToUVCompact (in vec3 v, const float texelSizeY)\n{\n   // Compact layout:\n   //\n   // xzXZ\t\tChar: Axis\n   // yyYY\t\tCase: Sign\n\n   // Number of texels to avoid at the edge of each square\n\n   vec3 absV = abs (v);\n\n   // Intersect unit cube\n\n   float scaleToCube = 1.0 / max (absV .x, max (absV .y, absV .z));\n\n   absV *= scaleToCube;\n\n   // Apply scale to avoid seams\n\n   // one texel less per square (half a texel on each side)\n   v *= scaleToCube * (1.0 - 2.0 * texelSizeY);\n\n   // Unwrap\n\n   // space: -1 ... 1 range for each square\n   //\n   // #X##\t\tdim    := ( 4 , 2 )\n   //  # #\t\tcenter := ( 1 , 1 )\n\n   vec2 planar = v .xy;\n\n   float almostATexel = 1.5 * texelSizeY;\n   float almostOne    = 1.0 - almostATexel;\n\n   if (absV .z >= almostOne)\n   {\n      // zZ\n\n      if (v .z > 0.0)\n         planar .x = 4.0 - v .x;\n   }\n   else if (absV .x >= almostOne)\n   {\n      // xX\n\n      float signX = sign (v .x);\n\n      planar .x = v .z * signX + 2.0 * signX;\n   }\n   else if (absV .y >= almostOne)\n   {\n      // yY\n\n      float signY = sign (v .y);\n\n      planar .x = (v .x + 0.5 + signY) * 2.0;\n      planar .y = v .z * signY - 2.0;\n   }\n\n   // Transform to UV space\n\n   // scale := 0.5 / dim\n   // translate := ( center + 0.5 ) / dim\n   return vec2 (0.125, 0.25) * planar + vec2 (0.375, 0.75);\n}\n\nmat4\ngetPointLightRotations (const in vec3 vector)\n{\n   mat4 rotations [6];\n   rotations [0] = mat4 ( 0, 0 , 1, 0,   0, 1,  0, 0,  -1,  0,  0, 0,   0, 0, 0, 1);  // left\n   rotations [1] = mat4 ( 0, 0, -1, 0,   0, 1,  0, 0,   1,  0,  0, 0,   0, 0, 0, 1);  // right\n   rotations [2] = mat4 (-1, 0,  0, 0,   0, 1,  0, 0,   0,  0, -1, 0,   0, 0, 0, 1);  // front\n   rotations [3] = mat4 ( 1, 0,  0, 0,   0, 1,  0, 0,   0,  0,  1, 0,   0, 0, 0, 1);  // back\n   rotations [4] = mat4 ( 1, 0,  0, 0,   0, 0,  1, 0,   0, -1,  0, 0,   0, 0, 0, 1);  // bottom\n   rotations [5] = mat4 ( 1, 0,  0, 0,   0, 0, -1, 0,   0,  1,  0, 0,   0, 0, 0, 1);  // top\n\n   vec3 a = abs (vector .xyz);\n\n   if (a .x > a .y)\n   {\n      if (a .x > a .z)\n         return vector .x > 0.0 ? rotations [1] : rotations [0];\n      else\n         return vector .z > 0.0 ? rotations [2] : rotations [3];\n   }\n   else\n   {\n      if (a .y > a .z)\n         return vector .y > 0.0 ? rotations [5] : rotations [4];\n      else\n         return vector .z > 0.0 ? rotations [2] : rotations [3];\n   }\n\n   return rotations [3];\n}\n\n// DEBUG\n//vec4 tex;\n\nfloat\ngetShadowIntensity (const in int index, const in x3d_LightSourceParameters light)\n{\n   if (light .type == x3d_PointLight)\n   {\n      const mat4 biasMatrix = mat4 (0.5, 0.0, 0.0, 0.0,\n                                    0.0, 0.5, 0.0, 0.0,\n                                    0.0, 0.0, 0.5, 0.0,\n                                    0.5, 0.5, 0.5, 1.0);\n\n      const mat4 projectionMatrix = mat4 (1.0, 0.0, 0.0, 0.0, 0.0, 0.5, 0.0, 0.0, 0.0, 0.0, -1.000025000312504, -1.0, 0, 0.0, -0.25000312503906297, 0.0);\n\n      vec2 texelSize = vec2 (1.0) / (float (light .shadowMapSize) * vec2 (4.0, 2.0));\n\n      // for point lights, the uniform @vShadowCoord is re-purposed to hold\n      // the vector from the light to the world-space position of the fragment.\n      vec4 shadowCoord     = light .shadowMatrix * vec4 (vertex, 1.0);\n      vec3 lightToPosition = shadowCoord .xyz;\n\n      shadowCoord       = biasMatrix * (projectionMatrix * (getPointLightRotations (lightToPosition) * shadowCoord));\n      shadowCoord .z   -= light .shadowBias;\n      shadowCoord .xyz /= shadowCoord .w;\n\n      // DEBUG\n      //tex = texture2D (x3d_ShadowMap [0], cubeToUVCompact (lightToPosition, texelSize .y));\n\n      #if defined (X3D_PCF_FILTERING) || defined (X3D_PCF_SOFT_FILTERING)\n\n         vec2 offset = vec2 (-1, 1) * (texelSize .y * 42.0);\n\n         float value = (\n            texture2DCompare (index, cubeToUVCompact (lightToPosition + offset .xyy, texelSize .y), shadowCoord .z) +\n            texture2DCompare (index, cubeToUVCompact (lightToPosition + offset .yyy, texelSize .y), shadowCoord .z) +\n            texture2DCompare (index, cubeToUVCompact (lightToPosition + offset .xyx, texelSize .y), shadowCoord .z) +\n            texture2DCompare (index, cubeToUVCompact (lightToPosition + offset .yyx, texelSize .y), shadowCoord .z) +\n            texture2DCompare (index, cubeToUVCompact (lightToPosition, texelSize .y), shadowCoord .z) +\n            texture2DCompare (index, cubeToUVCompact (lightToPosition + offset .xxy, texelSize .y), shadowCoord .z) +\n            texture2DCompare (index, cubeToUVCompact (lightToPosition + offset .yxy, texelSize .y), shadowCoord .z) +\n            texture2DCompare (index, cubeToUVCompact (lightToPosition + offset .xxx, texelSize .y), shadowCoord .z) +\n            texture2DCompare (index, cubeToUVCompact (lightToPosition + offset .yxx, texelSize .y), shadowCoord .z)\n         ) * (1.0 / 9.0);\n\n         return light .shadowIntensity * value;\n\n      #else // no percentage-closer filtering\n\n         float value = texture2DCompare (index, cubeToUVCompact (lightToPosition, texelSize .y), shadowCoord .z);\n\n         return light .shadowIntensity * value;\n\n      #endif\n   }\n   else\n   {\n      #if defined (X3D_PCF_FILTERING)\n\n         vec2 texelSize   = vec2 (1.0) / vec2 (light .shadowMapSize);\n         vec4 shadowCoord = light .shadowMatrix * vec4 (vertex, 1.0);\n\n         shadowCoord .z   -= light .shadowBias;\n         shadowCoord .xyz /= shadowCoord .w;\n\n         float dx0 = - texelSize .x;\n         float dy0 = - texelSize .y;\n         float dx1 = + texelSize .x;\n         float dy1 = + texelSize .y;\n\n         float value = (\n            texture2DCompare (index, shadowCoord .xy + vec2 (dx0, dy0), shadowCoord .z) +\n            texture2DCompare (index, shadowCoord .xy + vec2 (0.0, dy0), shadowCoord .z) +\n            texture2DCompare (index, shadowCoord .xy + vec2 (dx1, dy0), shadowCoord .z) +\n            texture2DCompare (index, shadowCoord .xy + vec2 (dx0, 0.0), shadowCoord .z) +\n            texture2DCompare (index, shadowCoord .xy, shadowCoord .z) +\n            texture2DCompare (index, shadowCoord .xy + vec2 (dx1, 0.0), shadowCoord .z) +\n            texture2DCompare (index, shadowCoord .xy + vec2 (dx0, dy1), shadowCoord .z) +\n            texture2DCompare (index, shadowCoord .xy + vec2 (0.0, dy1), shadowCoord .z) +\n            texture2DCompare (index, shadowCoord .xy + vec2 (dx1, dy1), shadowCoord .z)\n         ) * (1.0 / 9.0);\n\n         return light .shadowIntensity * value;\n\n      #elif defined (X3D_PCF_SOFT_FILTERING)\n\n         vec2 texelSize   = vec2 (1.0) / vec2 (light .shadowMapSize);\n         vec4 shadowCoord = light .shadowMatrix * vec4 (vertex, 1.0);\n\n         shadowCoord .z   -= light .shadowBias;\n         shadowCoord .xyz /= shadowCoord .w;\n\n         float dx0 = - texelSize.x;\n         float dy0 = - texelSize.y;\n         float dx1 = + texelSize.x;\n         float dy1 = + texelSize.y;\n\n         float value = (\n            texture2DShadowLerp (index, texelSize, float (shadowMapSize), shadowCoord .xy + vec2 (dx0, dy0), shadowCoord .z) +\n            texture2DShadowLerp (index, texelSize, float (shadowMapSize), shadowCoord .xy + vec2 (0.0, dy0), shadowCoord .z) +\n            texture2DShadowLerp (index, texelSize, float (shadowMapSize), shadowCoord .xy + vec2 (dx1, dy0), shadowCoord .z) +\n            texture2DShadowLerp (index, texelSize, float (shadowMapSize), shadowCoord .xy + vec2 (dx0, 0.0), shadowCoord .z) +\n            texture2DShadowLerp (index, texelSize, float (shadowMapSize), shadowCoord .xy, shadowCoord .z) +\n            texture2DShadowLerp (index, texelSize, float (shadowMapSize), shadowCoord .xy + vec2 (dx1, 0.0), shadowCoord .z) +\n            texture2DShadowLerp (index, texelSize, float (shadowMapSize), shadowCoord .xy + vec2 (dx0, dy1), shadowCoord .z) +\n            texture2DShadowLerp (index, texelSize, float (shadowMapSize), shadowCoord .xy + vec2 (0.0, dy1), shadowCoord .z) +\n            texture2DShadowLerp (index, texelSize, float (shadowMapSize), shadowCoord .xy + vec2 (dx1, dy1), shadowCoord .z)\n         ) * ( 1.0 / 9.0 );\n\n         return light .shadowIntensity * value;\n\n      #else // no percentage-closer filtering\n\n         vec4 shadowCoord = shadowMatrix * vec4 (vertex, 1.0);\n\n         shadowCoord .z   -= shadowBias;\n         shadowCoord .xyz /= shadowCoord .w;\n\n         float value = texture2DCompare (index, shadowCoord .xy, shadowCoord .z);\n\n         return light .shadowIntensity * value;\n\n      #endif\n   }\n\n   return 0.0;\n}\n\n#endif\n';n.set("assets/shaders/webgl2/include/Shadow.glsl",bm);const vm=bm,Cm='\n#if defined (X3D_GEOMETRY_1D) && defined (X3D_STYLE_PROPERTIES)\n\n#pragma X3D include "Line2.glsl"\n\nuniform x3d_LinePropertiesParameters x3d_LineProperties;\n\nflat in float lengthSoFar; // in px\nflat in vec2  startPoint;  // in px\nin vec2       midPoint;    // in px\n\nvoid\nstipple ()\n{\n   vec2  point = closest_point (line2 (startPoint, midPoint), gl_FragCoord .xy);\n   float s     = (lengthSoFar + length (point - startPoint)) * x3d_LineProperties .lineStippleScale;\n\n   #if defined (X3D_TEXTURE) || defined (X3D_MATERIAL_TEXTURES)\n      #if X3D_NUM_TEXTURE_COORDINATES > 0\n         texCoord0 = vec4 (s, 0.0, 0.0, 1.0);\n      #endif\n\n      #if X3D_NUM_TEXTURE_COORDINATES > 1\n         texCoord1 = vec4 (s, 0.0, 0.0, 1.0);\n      #endif\n   #endif\n\n   if (x3d_LineProperties .linetype != 16)\n   {\n      int   linetype = x3d_LineProperties .linetype;\n      int   height   = textureSize (x3d_LineProperties .texture, 0) .y;\n      float t        = 1.0 - float (linetype * 2 + 1) / float (height * 2);\n      float alpha    = texture (x3d_LineProperties .texture, vec2 (s, t)) .a;\n\n      if (alpha != 1.0)\n         discard;\n   }\n}\n\n#endif\n';n.set("assets/shaders/webgl2/include/Stipple.glsl",Cm);const Em=Cm,Om="\nfloat\ngetSpotFactor (const in float cutOffAngle, const in float beamWidth, const in vec3 L, const in vec3 d)\n{\n   float spotAngle = acos (clamp (dot (-L, d), -1.0, 1.0));\n\n   if (spotAngle >= cutOffAngle)\n      return 0.0;\n   else if (spotAngle <= beamWidth)\n      return 1.0;\n\n   return (spotAngle - cutOffAngle) / (beamWidth - cutOffAngle);\n}\n";n.set("assets/shaders/webgl2/include/SpotFactor.glsl",Om);const Nm=Om,Fm='\n#if defined (X3D_TEXTURE) || defined (X3D_MATERIAL_TEXTURES)\n\n#pragma X3D include "Perlin.glsl"\n\nvec4\ngetTexCoord (const in int i)\n{\n   #if defined (X3D_MULTI_TEXTURING)\n      switch (i)\n      {\n         #if X3D_NUM_TEXTURE_COORDINATES > 0\n         case 0:\n            return texCoord0;\n         #endif\n         #if X3D_NUM_TEXTURE_COORDINATES > 1\n         case 1:\n            return texCoord1;\n         #endif\n      }\n\n      return vec4 (0.0);\n   #else\n      return texCoord0;\n   #endif\n}\n\nuniform mat4 x3d_TextureMatrix [X3D_NUM_TEXTURE_TRANSFORMS];\n\nvec4\ngetTexCoord (const in x3d_TextureCoordinateGeneratorParameters textureCoordinateGenerator, const in int textureTransformMapping, const in int textureCoordinateMapping)\n{\n   int mode = textureCoordinateGenerator .mode;\n\n   switch (mode)\n   {\n      case x3d_None:\n      {\n         return x3d_TextureMatrix [textureTransformMapping] * getTexCoord (textureCoordinateMapping);\n      }\n      case x3d_Sphere:\n      {\n         vec2 N = normalize (gl_FrontFacing ? normal : -normal) .xy;\n\n         return vec4 (N * 0.5 + 0.5, 0.0, 1.0);\n      }\n      case x3d_CameraSpaceNormal:\n      {\n         vec3 N = normalize (gl_FrontFacing ? normal : -normal);\n\n         return vec4 (N, 1.0);\n      }\n      case x3d_CameraSpacePosition:\n      {\n         return vec4 (vertex, 1.0);\n      }\n      case x3d_CameraSpaceReflectionVector:\n      {\n         vec3 N = normalize (gl_FrontFacing ? normal : -normal);\n\n         return vec4 (reflect (normalize (vertex), -N), 1.0);\n      }\n      case x3d_SphereLocal:\n      {\n         vec2 N = normalize (gl_FrontFacing ? localNormal : -localNormal) .xy;\n\n         return vec4 (N * 0.5 + 0.5, 0.0, 1.0);\n      }\n      case x3d_Coord:\n      {\n         return vec4 (localVertex, 1.0);\n      }\n      case x3d_CoordEye:\n      {\n         return vec4 (vertex, 1.0);\n      }\n      case x3d_Noise:\n      {\n         vec3 scale       = vec3 (textureCoordinateGenerator .parameter [0], textureCoordinateGenerator .parameter [1], textureCoordinateGenerator .parameter [2]);\n         vec3 translation = vec3 (textureCoordinateGenerator .parameter [3], textureCoordinateGenerator .parameter [4], textureCoordinateGenerator .parameter [5]);\n\n         return vec4 (perlin (localVertex * scale + translation), 1.0);\n      }\n      case x3d_NoiseEye:\n      {\n         vec3 scale       = vec3 (textureCoordinateGenerator .parameter [0], textureCoordinateGenerator .parameter [1], textureCoordinateGenerator .parameter [2]);\n         vec3 translation = vec3 (textureCoordinateGenerator .parameter [3], textureCoordinateGenerator .parameter [4], textureCoordinateGenerator .parameter [5]);\n\n         return vec4 (perlin (vertex * scale + translation), 1.0);\n      }\n      case x3d_SphereReflect:\n      {\n         vec3  N   = normalize (gl_FrontFacing ? normal : -normal);\n         float eta = textureCoordinateGenerator .parameter [0];\n\n         return vec4 (refract (normalize (vertex), -N, eta), 1.0);\n      }\n      case x3d_SphereReflectLocal:\n      {\n         vec3  N   = normalize (gl_FrontFacing ? localNormal : -localNormal);\n         float eta = textureCoordinateGenerator .parameter [0];\n         vec3  eye = vec3 (textureCoordinateGenerator .parameter [1], textureCoordinateGenerator .parameter [2], textureCoordinateGenerator .parameter [3]);\n\n         return vec4 (refract (normalize (localVertex - eye), -N, eta), 1.0);\n      }\n      default:\n      {\n         return x3d_TextureMatrix [textureTransformMapping] * getTexCoord (textureCoordinateMapping);\n      }\n   }\n}\n\nuniform x3d_TextureCoordinateGeneratorParameters x3d_TextureCoordinateGenerator [X3D_NUM_TEXTURE_COORDINATES];\n\nvec3\ngetTexCoord (const in int textureTransformMapping, const in int textureCoordinateMapping)\n{\n   vec4 texCoord = getTexCoord (x3d_TextureCoordinateGenerator [textureCoordinateMapping], textureTransformMapping, textureCoordinateMapping);\n\n   texCoord .stp /= texCoord .q;\n\n   #if defined (X3D_GEOMETRY_2D)\n      if (gl_FrontFacing == false)\n         texCoord .s = 1.0 - texCoord .s;\n   #endif\n\n   return texCoord .stp;\n}\n\n#endif // X3D_TEXTURE || X3D_MATERIAL_TEXTURES\n\n#if defined (X3D_TEXTURE)\n\nuniform int         x3d_TextureType [X3D_NUM_TEXTURES];\nuniform sampler2D   x3d_Texture2D [X3D_NUM_TEXTURES];\nuniform sampler3D   x3d_Texture3D [X3D_NUM_TEXTURES];\nuniform samplerCube x3d_TextureCube [X3D_NUM_TEXTURES];\n\n#if defined (X3D_MULTI_TEXTURING)\nvec4\ngetTexture (const in int i, const in vec3 texCoord)\n{\n   switch (i)\n   {\n      #if X3D_NUM_TEXTURES > 0\n      case 0:\n         #if defined (X3D_TEXTURE0_2D)\n            return texture (x3d_Texture2D [0], texCoord .st);\n         #elif defined (X3D_TEXTURE0_3D)\n            return texture (x3d_Texture3D [0], texCoord .stp);\n         #elif defined (X3D_TEXTURE0_CUBE)\n            return texture (x3d_TextureCube [0], texCoord .stp);\n         #endif\n      #endif\n      #if X3D_NUM_TEXTURES > 1\n      case 1:\n         #if defined (X3D_TEXTURE0_2D)\n            return texture (x3d_Texture2D [1], texCoord .st);\n         #elif defined (X3D_TEXTURE0_3D)\n            return texture (x3d_Texture3D [1], texCoord .stp);\n         #elif defined (X3D_TEXTURE0_CUBE)\n            return texture (x3d_TextureCube [1], texCoord .stp);\n         #endif\n      #endif\n   }\n\n   return vec4 (0.0);\n}\n#endif\n\n#if defined (X3D_MULTI_TEXTURING)\n   uniform vec4 x3d_MultiTextureColor;\n   uniform x3d_MultiTextureParameters x3d_MultiTexture [X3D_NUM_TEXTURES];\n#endif\n\nvec4\ngetTextureColor (const in vec4 diffuseColor, const in vec4 specularColor)\n{\n   #if defined (X3D_MULTI_TEXTURING)\n      vec4 currentColor = diffuseColor;\n\n      for (int i = 0; i < X3D_NUM_TEXTURES; ++ i)\n      {\n         // Get texture color.\n\n         vec3 texCoord     = getTexCoord (i, i);\n         vec4 textureColor = getTexture (i, texCoord);\n\n         // Multi texturing\n\n         x3d_MultiTextureParameters multiTexture = x3d_MultiTexture [i];\n\n         vec4 arg1 = textureColor;\n         vec4 arg2 = currentColor;\n\n         // Source\n\n         int source = multiTexture .source;\n\n         switch (source)\n         {\n            case x3d_Diffuse:\n            {\n               arg1 = diffuseColor;\n               break;\n            }\n            case x3d_Specular:\n            {\n               arg1 = specularColor;\n               break;\n            }\n            case x3d_Factor:\n            {\n               arg1 = x3d_MultiTextureColor;\n               break;\n            }\n         }\n\n         // Function\n\n         int function = multiTexture .function;\n\n         switch (function)\n         {\n            case x3d_Complement:\n            {\n               arg1 = 1.0 - arg1;\n               break;\n            }\n            case x3d_AlphaReplicate:\n            {\n               arg1 .a = arg2 .a;\n               break;\n            }\n         }\n\n         // Mode\n\n         int mode      = multiTexture .mode;\n         int alphaMode = multiTexture .alphaMode;\n\n         // RGB\n\n         switch (mode)\n         {\n            case x3d_Replace:\n            {\n               currentColor .rgb = arg1 .rgb;\n               break;\n            }\n            case x3d_Modulate:\n            {\n               currentColor .rgb = arg1 .rgb * arg2 .rgb;\n               break;\n            }\n            case x3d_Modulate2X:\n            {\n               currentColor .rgb = (arg1 .rgb * arg2 .rgb) * 2.0;\n               break;\n            }\n            case x3d_Modulate4X:\n            {\n               currentColor .rgb = (arg1 .rgb * arg2 .rgb) * 4.0;\n               break;\n            }\n            case x3d_Add:\n            {\n               currentColor .rgb = arg1 .rgb + arg2 .rgb;\n               break;\n            }\n            case x3d_AddSigned:\n            {\n               currentColor .rgb = arg1 .rgb + arg2 .rgb - 0.5;\n               break;\n            }\n            case x3d_AddSigned2X:\n            {\n               currentColor .rgb = (arg1 .rgb + arg2 .rgb - 0.5) * 2.0;\n               break;\n            }\n            case x3d_AddSmooth:\n            {\n               currentColor .rgb = arg1 .rgb + (1.0 - arg1 .rgb) * arg2 .rgb;\n               break;\n            }\n            case x3d_Subtract:\n            {\n               currentColor .rgb = arg1 .rgb - arg2 .rgb;\n               break;\n            }\n            case x3d_BlendDiffuseAlpha:\n            {\n               currentColor .rgb = arg1 .rgb * diffuseColor .a + arg2 .rgb * (1.0 - diffuseColor .a);\n               break;\n            }\n            case x3d_BlendTextureAlpha:\n            {\n               currentColor .rgb = arg1 .rgb * arg1 .a + arg2 .rgb * (1.0 - arg1 .a);\n               break;\n            }\n            case x3d_BlendFactorAlpha:\n            {\n               currentColor .rgb = arg1 .rgb * x3d_MultiTextureColor .a + arg2 .rgb * (1.0 - x3d_MultiTextureColor .a);\n               break;\n            }\n            case x3d_BlendCurrentAlpha:\n            {\n               currentColor .rgb = arg1 .rgb * arg2 .a + arg2 .rgb * (1.0 - arg2 .a);\n               break;\n            }\n            case x3d_ModulateAlphaAddColor:\n            {\n               currentColor .rgb = arg1 .rgb + arg1 .a * arg2 .rgb;\n               break;\n            }\n            case x3d_ModulateInvAlphaAddColor:\n            {\n               currentColor .rgb = (1.0 - arg1 .a) * arg2 .rgb + arg1 .rgb;\n               break;\n            }\n            case x3d_ModulateInvColorAddAlpha:\n            {\n               currentColor .rgb = (1.0 - arg1 .rgb) * arg2 .rgb + arg1 .a;\n               break;\n            }\n            case x3d_DotProduct3:\n            {\n               currentColor .rgb = vec3 (dot (arg1 .rgb * 2.0 - 1.0, arg2 .rgb * 2.0 - 1.0));\n               break;\n            }\n            case x3d_SelectArg1:\n            {\n               currentColor .rgb = arg1 .rgb;\n               break;\n            }\n            case x3d_SelectArg2:\n            {\n               currentColor .rgb = arg2 .rgb;\n               break;\n            }\n            case x3d_Off:\n            {\n               break;\n            }\n         }\n\n         // Alpha\n\n         switch (alphaMode)\n         {\n            case x3d_Replace:\n            {\n               currentColor .a = arg1 .a;\n               break;\n            }\n            case x3d_Modulate:\n            {\n               currentColor .a = arg1 .a * arg2 .a;\n               break;\n            }\n            case x3d_Modulate2X:\n            {\n               currentColor .a = (arg1 .a * arg2 .a) * 2.0;\n               break;\n            }\n            case x3d_Modulate4X:\n            {\n               currentColor .a = (arg1 .a * arg2 .a) * 4.0;\n               break;\n            }\n            case x3d_Add:\n            {\n               currentColor .a = arg1 .a + arg2 .a;\n               break;\n            }\n            case x3d_AddSigned:\n            {\n               currentColor .a = arg1 .a + arg2 .a - 0.5;\n               break;\n            }\n            case x3d_AddSigned2X:\n            {\n               currentColor .a = (arg1 .a + arg2 .a - 0.5) * 2.0;\n               break;\n            }\n            case x3d_AddSmooth:\n            {\n               currentColor .a = arg1 .a + (1.0 - arg1 .a) * arg2 .a;\n               break;\n            }\n            case x3d_Subtract:\n            {\n               currentColor .a = arg1 .a - arg2 .a;\n               break;\n            }\n            case x3d_BlendDiffuseAlpha:\n            {\n               currentColor .a = arg1 .a * diffuseColor .a + arg2 .a * (1.0 - diffuseColor .a);\n               break;\n            }\n            case x3d_BlendTextureAlpha:\n            {\n               currentColor .a = arg1 .a * arg1 .a + arg2 .a * (1.0 - arg1 .a);\n               break;\n            }\n            case x3d_BlendFactorAlpha:\n            {\n               currentColor .a = arg1 .a * x3d_MultiTextureColor .a + arg2 .a * (1.0 - x3d_MultiTextureColor .a);\n               break;\n            }\n            case x3d_BlendCurrentAlpha:\n            {\n               currentColor .a = arg1 .a * arg2 .a + arg2 .a * (1.0 - arg2 .a);\n               break;\n            }\n            case x3d_ModulateAlphaAddColor:\n            {\n               currentColor .a = arg1 .a + arg1 .a * arg2 .a;\n               break;\n            }\n            case x3d_ModulateInvAlphaAddColor:\n            {\n               currentColor .a = (1.0 - arg1 .a) * arg2 .a + arg1 .a;\n               break;\n            }\n            case x3d_ModulateInvColorAddAlpha:\n            {\n               currentColor .a = (1.0 - arg1 .a) * arg2 .a + arg1 .a;\n               break;\n            }\n            case x3d_DotProduct3:\n            {\n               currentColor .a = dot (arg1 .rgb * 2.0 - 1.0, arg2 .rgb * 2.0 - 1.0);\n               break;\n            }\n            case x3d_SelectArg1:\n            {\n               currentColor .a = arg1 .a;\n               break;\n            }\n            case x3d_SelectArg2:\n            {\n               currentColor .a = arg2 .a;\n               break;\n            }\n            case x3d_Off:\n            {\n               break;\n            }\n         }\n      }\n\n      return currentColor;\n   #else\n      // Get texture color.\n\n      vec3 texCoord = getTexCoord (0, 0);\n\n      #if defined (X3D_TEXTURE0_2D)\n         vec4 textureColor = texture (x3d_Texture2D [0], texCoord .st);\n      #elif defined (X3D_TEXTURE0_3D)\n         vec4 textureColor = texture (x3d_Texture3D [0], texCoord .stp);\n      #elif defined (X3D_TEXTURE0_CUBE)\n         vec4 textureColor = texture (x3d_TextureCube [0], texCoord .stp);\n      #endif\n\n      return diffuseColor * textureColor;\n   #endif\n}\n\n#endif // X3D_TEXTURE\n\n#if defined (X3D_PROJECTIVE_TEXTURE_MAPPING)\n\nuniform sampler2D x3d_ProjectiveTexture [X3D_NUM_TEXTURE_PROJECTORS];\nuniform mat4      x3d_ProjectiveTextureMatrix [X3D_NUM_TEXTURE_PROJECTORS];\nuniform vec3      x3d_ProjectiveTextureLocation [X3D_NUM_TEXTURE_PROJECTORS];\n\nvec4\ngetProjectiveTexture (const in int i, const in vec2 texCoord)\n{\n   switch (i)\n   {\n      #if X3D_NUM_TEXTURE_PROJECTORS > 0\n      case 0:\n         return texture (x3d_ProjectiveTexture [0], texCoord);\n      #endif\n      #if X3D_NUM_TEXTURE_PROJECTORS > 1\n      case 1:\n         return texture (x3d_ProjectiveTexture [1], texCoord);\n      #endif\n   }\n\n   return vec4 (0.0);\n}\n\nvec4\ngetProjectiveTextureColor (in vec4 currentColor)\n{\n   vec3 N = gl_FrontFacing ? normal : -normal;\n\n   for (int i = 0; i < X3D_NUM_TEXTURE_PROJECTORS; ++ i)\n   {\n      vec4 texCoord = x3d_ProjectiveTextureMatrix [i] * vec4 (vertex, 1.0);\n\n      texCoord .stp /= texCoord .q;\n\n      if (texCoord .s < 0.0 || texCoord .s > 1.0)\n         continue;\n\n      if (texCoord .t < 0.0 || texCoord .t > 1.0)\n         continue;\n\n      if (texCoord .p < 0.0 || texCoord .p > 1.0)\n         continue;\n\n      // We do not need to normalze p, as we only need the sign of the dot product.\n      vec3 p = x3d_ProjectiveTextureLocation [i] - vertex;\n\n      if (dot (N, p) < 0.0)\n         continue;\n\n      currentColor *= getProjectiveTexture (i, texCoord .st);\n   }\n\n   return currentColor;\n}\n\n#endif // X3D_PROJECTIVE_TEXTURE_MAPPING\n';n.set("assets/shaders/webgl2/include/Texture.glsl",Fm);const Im=Fm,Mm='\n// Uniforms\n\nuniform mat4 x3d_ProjectionMatrix;\nuniform mat4 x3d_ModelViewMatrix;\n\n// Attributes\n\n#if defined (X3D_GEOMETRY_1D) && defined (X3D_STYLE_PROPERTIES)\n   in vec3 x3d_LineStipple;\n#endif\n\n#if defined (X3D_FOG) && defined (X3D_FOG_COORDS)\n   in float x3d_FogDepth;\n#endif\n\n#if defined (X3D_COLOR_MATERIAL)\n   in vec4  x3d_Color;\n#endif\n\n#if ! defined (X3D_GEOMETRY_0D) && ! defined (X3D_GEOMETRY_1D)\n   #if defined (X3D_TEXTURE) || defined (X3D_MATERIAL_TEXTURES)\n      #if X3D_NUM_TEXTURE_COORDINATES > 0\n         in vec4 x3d_TexCoord0;\n      #endif\n\n      #if X3D_NUM_TEXTURE_COORDINATES > 1\n         in vec4 x3d_TexCoord1;\n      #endif\n   #endif\n#endif\n\nin vec4 x3d_Vertex;\n\n// Varyings\n\n#if defined (X3D_FOG) && defined (X3D_FOG_COORDS)\n   out float fogDepth;\n#endif\n\n#if defined (X3D_COLOR_MATERIAL)\n   out vec4 color;\n#endif\n\n#if ! defined (X3D_GEOMETRY_0D) && ! defined (X3D_GEOMETRY_1D)\n   #if defined (X3D_TEXTURE) || defined (X3D_MATERIAL_TEXTURES)\n      #if X3D_NUM_TEXTURE_COORDINATES > 0\n         out vec4 texCoord0;\n      #endif\n\n      #if X3D_NUM_TEXTURE_COORDINATES > 1\n         out vec4 texCoord1;\n      #endif\n   #endif\n#endif\n\n#if defined (X3D_NORMALS)\n   uniform mat3 x3d_NormalMatrix;\n   in  vec3 x3d_Normal;\n   out vec3 normal;\n\n   #if defined (X3D_TEXTURE) || defined (X3D_MATERIAL_TEXTURES)\n      out vec3 localNormal;\n   #endif\n#endif\n\n#if defined (X3D_GEOMETRY_1D) && defined (X3D_STYLE_PROPERTIES)\n   flat out float lengthSoFar;\n   flat out vec2  startPoint;\n   out vec2       midPoint;\n#endif\n\nout vec3 vertex;\n\n#if defined (X3D_TEXTURE) || defined (X3D_MATERIAL_TEXTURES)\n   out vec3 localVertex;\n#endif\n\n#if defined (X3D_LOGARITHMIC_DEPTH_BUFFER)\n   out float depth;\n#endif\n\n// Main\n\n#pragma X3D include "Particle.glsl"\n#pragma X3D include "PointSize.glsl"\n\nvoid\nvertex_main ()\n{\n   vec4 position = x3d_ModelViewMatrix * getVertex (x3d_Vertex);\n\n   vertex = position .xyz;\n\n   #if defined (X3D_GEOMETRY_0D)\n      #if defined (X3D_STYLE_PROPERTIES)\n         gl_PointSize = pointSize = getPointSize (vertex);\n      #else\n         gl_PointSize = 1.0;\n      #endif\n   #endif\n\n   #if defined (X3D_GEOMETRY_1D) && defined (X3D_STYLE_PROPERTIES)\n      lengthSoFar = x3d_LineStipple .z;\n      startPoint  = x3d_LineStipple .xy;\n      midPoint    = x3d_LineStipple .xy;\n   #endif\n\n   #if defined (X3D_FOG) && defined (X3D_FOG_COORDS)\n      fogDepth = x3d_FogDepth;\n   #endif\n\n   #if defined (X3D_COLOR_MATERIAL)\n      color = x3d_Color;\n   #endif\n\n   #if ! defined (X3D_GEOMETRY_0D) && ! defined (X3D_GEOMETRY_1D)\n      #if defined (X3D_TEXTURE) || defined (X3D_MATERIAL_TEXTURES)\n         #if X3D_NUM_TEXTURE_COORDINATES > 0\n            texCoord0 = getTexCoord (x3d_TexCoord0);\n         #endif\n\n         #if X3D_NUM_TEXTURE_COORDINATES > 1\n            texCoord1 = getTexCoord (x3d_TexCoord1);\n         #endif\n      #endif\n   #endif\n\n   #if defined (X3D_NORMALS)\n      normal = x3d_NormalMatrix * x3d_Normal;\n\n      #if defined (X3D_TEXTURE) || defined (X3D_MATERIAL_TEXTURES)\n         localNormal = x3d_Normal;\n      #endif\n   #endif\n\n   #if defined (X3D_TEXTURE) || defined (X3D_MATERIAL_TEXTURES)\n      localVertex = x3d_Vertex .xyz;\n   #endif\n\n   gl_Position = x3d_ProjectionMatrix * position;\n\n   #if defined (X3D_LOGARITHMIC_DEPTH_BUFFER)\n      depth = 1.0 + gl_Position .w;\n   #endif\n}\n';n.set("assets/shaders/webgl2/include/Vertex.glsl",Mm);const Dm=Mm,Vm='\nprecision highp float;\nprecision highp int;\nprecision highp sampler2D;\nprecision highp samplerCube;\n\n#pragma X3D include "include/Vertex.glsl"\n\nvoid\nmain ()\n{\n   vertex_main ();\n}\n';n.set("assets/shaders/webgl1/Default.vs",Vm);const Rm=Vm,Pm="\nprecision highp float;\nprecision highp int;\n\nuniform mat4 x3d_ProjectionMatrix;\nuniform mat4 x3d_ModelViewMatrix;\n\nattribute vec4 x3d_Vertex;\n\nvarying vec3 vertex;\n\nvoid\nmain ()\n{\n   vec4 position = x3d_ModelViewMatrix * x3d_Vertex;\n\n   vertex = position .xyz;\n\n   gl_Position = x3d_ProjectionMatrix * position;\n}\n";n.set("assets/shaders/webgl1/Depth.vs",Pm);const Am=Pm,Lm='\nprecision highp float;\nprecision highp int;\nprecision highp sampler2D;\nprecision highp samplerCube;\n\n#pragma X3D include "include/Vertex.glsl"\n#pragma X3D include "include/Material.glsl"\n\nvarying vec4 frontColor;\n\n#if ! defined (X3D_GEOMETRY_0D) && ! defined (X3D_GEOMETRY_1D)\n   varying vec4 backColor;\n#endif\n\nvec4\ngetMaterialColor (const in vec3 N,\n                  const in vec3 vertex,\n                  const in x3d_MaterialParameters material)\n{\n   // Get diffuse parameter.\n\n   float alpha = 1.0 - x3d_Material .transparency;\n\n   #if defined (X3D_COLOR_MATERIAL)\n      vec4 diffuseParameter = vec4 (color .rgb, color .a * alpha);\n   #else\n      vec4 diffuseParameter = vec4 (x3d_Material .diffuseColor, alpha);\n   #endif\n\n   // Get material color.\n\n   vec3 ambientColor = diffuseParameter .rgb * material .ambientIntensity;\n\n   #if defined (X3D_LIGHTING)\n      vec3 finalColor = getMaterialColor (vertex, N, ambientColor, diffuseParameter .rgb, material .specularColor, material .shininess);\n   #else\n      vec3 finalColor = vec3 (0.0);\n   #endif\n\n   finalColor += material .emissiveColor;\n\n   return vec4 (finalColor, diffuseParameter .a);\n}\n\nvoid\nmain ()\n{\n   vertex_main ();\n\n   normal     = normalize (normal);\n   frontColor = getMaterialColor (normal, vertex, x3d_Material);\n\n   #if ! defined (X3D_GEOMETRY_0D) && ! defined (X3D_GEOMETRY_1D)\n      backColor = getMaterialColor (-normal, vertex, x3d_Material);\n   #endif\n}\n';n.set("assets/shaders/webgl1/Gouraud.vs",Lm);const Bm=Lm,Xm='\nprecision highp float;\nprecision highp int;\n\nvarying vec3 vertex;\n\n#pragma X3D include "include/ClipPlanes.glsl"\n#pragma X3D include "include/Pack.glsl"\n\nvoid\nmain ()\n{\n   #if defined (X3D_CLIP_PLANES)\n      clip ();\n   #endif\n\n   gl_FragColor = pack (gl_FragCoord .z);\n}\n';n.set("assets/shaders/webgl1/Depth.fs",Xm);const Um=Xm,km='\nprecision highp float;\nprecision highp int;\nprecision highp sampler2D;\nprecision highp samplerCube;\n\n#pragma X3D include "include/Fragment.glsl"\n\nvarying vec4 frontColor;\n\n#if ! defined (X3D_GEOMETRY_0D) && ! defined (X3D_GEOMETRY_1D)\n   varying vec4 backColor;\n#endif\n\nvec4\ngetMaterialColor ()\n{\n   #if defined (X3D_GEOMETRY_0D) || defined (X3D_GEOMETRY_1D)\n      vec4 finalColor = frontColor;\n   #else\n      vec4 finalColor = gl_FrontFacing ? frontColor : backColor;\n   #endif\n\n   #if defined (X3D_TEXTURE)\n      finalColor = getTextureColor (finalColor, vec4 (1.0));\n   #endif\n\n   #if defined (X3D_PROJECTIVE_TEXTURE_MAPPING)\n      finalColor = getProjectiveTextureColor (finalColor);\n   #endif\n\n   return finalColor;\n}\n\nvoid\nmain ()\n{\n   fragment_main ();\n}\n';n.set("assets/shaders/webgl1/Gouraud.fs",km);const zm=km,jm='\n// https://github.com/cx20/gltf-test/blob/master/examples/khronos-gltf-loader/shaders/pbr-frag.glsl\n\n#extension GL_EXT_shader_texture_lod: enable\n#extension GL_OES_standard_derivatives : enable\n\nprecision highp float;\nprecision highp int;\nprecision highp sampler2D;\nprecision highp samplerCube;\n\n#pragma X3D include "include/Fragment.glsl"\n#pragma X3D include "include/Colors.glsl"\n#pragma X3D include "include/Normal.glsl"\n#pragma X3D include "include/SpotFactor.glsl"\n#pragma X3D include "include/Shadow.glsl"\n\n#if defined (X3D_LIGHTING)\n   uniform x3d_LightSourceParameters x3d_LightSource [X3D_NUM_LIGHTS];\n#endif\n\nuniform x3d_PhysicalMaterialParameters x3d_Material;\n\n#if defined (USE_IBL)\n   uniform samplerCube diffuseEnvironmentTexture;\n   uniform samplerCube specularEnvironmentTexture;\n   uniform sampler2D brdfLUT;\n#endif\n\n#if defined (X3D_BASE_TEXTURE)\nuniform x3d_BaseTextureParameters x3d_BaseTexture;\n#endif\n\nvec4\ngetBaseColor ()\n{\n   // Get base parameter.\n\n   float alpha = 1.0 - x3d_Material .transparency;\n\n   #if defined (X3D_COLOR_MATERIAL)\n      vec4 baseParameter = vec4 (color .rgb, color .a * alpha);\n   #else\n      vec4 baseParameter = vec4 (x3d_Material .baseColor, alpha);\n   #endif\n\n   // Get texture color.\n\n   #if defined (X3D_BASE_TEXTURE)\n      vec3 texCoord = getTexCoord (x3d_BaseTexture .textureTransformMapping, x3d_BaseTexture .textureCoordinateMapping);\n      #if defined (X3D_BASE_TEXTURE_2D)\n         return baseParameter * SRGBtoLINEAR (texture2D (x3d_BaseTexture .texture2D, texCoord .st));\n      #elif defined (X3D_BASE_TEXTURE_CUBE)\n         return baseParameter * SRGBtoLINEAR (textureCube (x3d_BaseTexture .textureCube, texCoord));\n      #endif\n   #elif defined (X3D_TEXTURE)\n      return getTextureColor (baseParameter, vec4 (vec3 (1.0), alpha));\n   #else\n      return baseParameter;\n   #endif\n}\n\n#if defined (X3D_EMISSIVE_TEXTURE)\nuniform x3d_EmissiveTextureParameters x3d_EmissiveTexture;\n#endif\n\nvec3\ngetEmissiveColor ()\n{\n   // Get emissive parameter.\n\n   vec3 emissiveParameter = x3d_Material .emissiveColor;\n\n   // Get texture color.\n\n   #if defined (X3D_EMISSIVE_TEXTURE)\n      vec3 texCoord = getTexCoord (x3d_EmissiveTexture .textureTransformMapping, x3d_EmissiveTexture .textureCoordinateMapping);\n\n      #if defined (X3D_EMISSIVE_TEXTURE_2D)\n         return emissiveParameter * SRGBtoLINEAR (texture2D (x3d_EmissiveTexture .texture2D, texCoord .st)) .rgb;\n      #elif defined (X3D_EMISSIVE_TEXTURE_CUBE)\n         return emissiveParameter * SRGBtoLINEAR (textureCube (x3d_EmissiveTexture .textureCube, texCoord)) .rgb;\n      #endif\n   #else\n      return emissiveParameter .rgb;\n   #endif\n}\n\n#if defined (X3D_METALLIC_ROUGHNESS_TEXTURE)\nuniform x3d_MetallicRoughnessTextureParameters x3d_MetallicRoughnessTexture;\n#endif\n\nvec2\ngetMetallicRoughness ()\n{\n   // Metallic and Roughness material properties are packed together\n   // In glTF, these factors can be specified by fixed scalar values\n   // or from a metallic-roughness map\n   float metallic            = x3d_Material .metallic;\n   float perceptualRoughness = x3d_Material .roughness;\n\n   // Get texture color.\n\n   #if defined (X3D_METALLIC_ROUGHNESS_TEXTURE)\n      vec3 texCoord = getTexCoord (x3d_MetallicRoughnessTexture .textureTransformMapping, x3d_MetallicRoughnessTexture .textureCoordinateMapping);\n      // Roughness is stored in the \'g\' channel, metallic is stored in the \'b\' channel.\n      // This layout intentionally reserves the \'r\' channel for (optional) occlusion map data\n      #if defined (X3D_METALLIC_ROUGHNESS_TEXTURE_2D)\n         vec4 mrSample = texture2D (x3d_MetallicRoughnessTexture .texture2D, texCoord .st);\n      #elif defined (X3D_METALLIC_ROUGHNESS_TEXTURE_CUBE)\n         vec4 mrSample = textureCube (x3d_MetallicRoughnessTexture .textureCube, texCoord);\n      #endif\n      metallic            *= mrSample .b;\n      perceptualRoughness *= mrSample .g;\n\n      return vec2 (metallic, perceptualRoughness);\n   #else\n      return vec2 (metallic, perceptualRoughness);\n   #endif\n}\n\n#if defined (X3D_OCCLUSION_TEXTURE)\nuniform x3d_OcclusionTextureParameters x3d_OcclusionTexture;\n#endif\n\nfloat\ngetOcclusionFactor ()\n{\n   // Get texture color.\n\n   #if defined (X3D_OCCLUSION_TEXTURE)\n      vec3 texCoord = getTexCoord (x3d_OcclusionTexture .textureTransformMapping, x3d_OcclusionTexture .textureCoordinateMapping);\n\n      #if defined (X3D_OCCLUSION_TEXTURE_2D)\n         return texture2D (x3d_OcclusionTexture .texture2D, texCoord .st) .r;\n      #elif defined (X3D_OCCLUSION_TEXTURE_CUBE)\n         return textureCube (x3d_OcclusionTexture .textureCube, texCoord) .r;\n      #endif\n   #else\n      return 1.0;\n   #endif\n}\n\n// Encapsulate the various inputs used by the various functions in the shading equation\n// We store values in this struct to simplify the integration of alternative implementations\n// of the shading terms, outlined in the Readme.MD Appendix.\nstruct PBRInfo\n{\n   float NdotL;                  // cos angle between normal and light direction\n   float NdotV;                  // cos angle between normal and view direction\n   float NdotH;                  // cos angle between normal and half vector\n   float LdotH;                  // cos angle between light direction and half vector\n   float VdotH;                  // cos angle between view direction and half vector\n   float perceptualRoughness;    // roughness value, as authored by the model creator (input to shader)\n   float metalness;              // metallic value at the surface\n   vec3 reflectance0;            // full reflectance color (normal incidence angle)\n   vec3 reflectance90;           // reflectance color at grazing angle\n   float alphaRoughness;         // roughness mapped to a more linear change in the roughness (proposed by [2])\n   vec3 diffuseColor;            // color contribution from diffuse lighting\n   vec3 specularColor;           // color contribution from specular lighting\n};\n\nconst float M_PI           = 3.141592653589793;\nconst float c_MinRoughness = 0.04;\n\n#if defined (USE_IBL)\n// Calculation of the lighting contribution from an optional Image Based Light source.\n// Precomputed Environment Maps are required uniform inputs and are computed as outlined in [1].\n// See our README.md on Environment Maps [3] for additional discussion.\nvec3\ngetIBLContribution (const in PBRInfo pbrInputs, vec3 n, const in vec3 reflection)\n{\n   float mipCount = 9.0; // resolution of 512x512\n   float lod      = pbrInputs .perceptualRoughness * mipCount;\n\n   // retrieve a scale and bias to F0. See [1], Figure 3\n   vec3 brdf         = SRGBtoLINEAR (texture2D (brdfLUT, vec2 (pbrInputs .NdotV, 1.0 - pbrInputs .perceptualRoughness))) .rgb;\n   vec3 diffuseLight = SRGBtoLINEAR (textureCube (diffuseEnvironmentTexture, n)) .rgb;\n\n   #if defined (USE_TEX_LOD)\n      vec3 specularLight = SRGBtoLINEAR (textureCubeLodEXT (specularEnvironmentTexture, reflection, lod)) .rgb;\n   #else\n      vec3 specularLight = SRGBtoLINEAR (textureCube (specularEnvironmentTexture, reflection)) .rgb;\n   #endif\n\n   vec3 diffuse  = diffuseLight * pbrInputs .diffuseColor;\n   vec3 specular = specularLight * (pbrInputs .specularColor * brdf .x + brdf .y);\n\n   return diffuse + specular;\n}\n#endif\n\n// Basic Lambertian diffuse\n// Implementation from Lambert\'s Photometria https://archive.org/details/lambertsphotome00lambgoog\n// See also [1], Equation 1\nvec3\ndiffuse (const in PBRInfo pbrInputs)\n{\n   return pbrInputs .diffuseColor / M_PI;\n}\n\n// The following equation models the Fresnel reflectance term of the spec equation (aka F())\n// Implementation of fresnel from [4], Equation 15\nvec3\nspecularReflection (const in PBRInfo pbrInputs)\n{\n   return pbrInputs .reflectance0 + (pbrInputs .reflectance90 - pbrInputs .reflectance0) * pow (clamp (1.0 - pbrInputs .VdotH, 0.0, 1.0), 5.0);\n}\n\n// This calculates the specular geometric attenuation (aka G()),\n// where rougher material will reflect less light back to the viewer.\n// This implementation is based on [1] Equation 4, and we adopt their modifications to\n// alphaRoughness as input as originally proposed in [2].\nfloat\ngeometricOcclusion (const in PBRInfo pbrInputs)\n{\n   float NdotL = pbrInputs .NdotL;\n   float NdotV = pbrInputs .NdotV;\n   float r     = pbrInputs .alphaRoughness;\n\n   float attenuationL = 2.0 * NdotL / (NdotL + sqrt (r * r + (1.0 - r * r) * (NdotL * NdotL)));\n   float attenuationV = 2.0 * NdotV / (NdotV + sqrt (r * r + (1.0 - r * r) * (NdotV * NdotV)));\n\n   return attenuationL * attenuationV;\n}\n\n// The following equation(s) model the distribution of microfacet normals across the area being drawn (aka D())\n// Implementation from "Average Irregularity Representation of a Roughened Surface for Ray Reflection" by T. S. Trowbridge, and K. P. Reitz\n// Follows the distribution function recommended in the SIGGRAPH 2013 course notes from EPIC Games [1], Equation 3.\nfloat\nmicrofacetDistribution (const in PBRInfo pbrInputs)\n{\n   float roughnessSq = pbrInputs .alphaRoughness * pbrInputs .alphaRoughness;\n   float f           = (pbrInputs .NdotH * roughnessSq - pbrInputs .NdotH) * pbrInputs .NdotH + 1.0;\n\n   return roughnessSq / (M_PI * f * f);\n}\n\nvec4\ngetMaterialColor ()\n{\n   // Metallic and Roughness material properties are packed together\n   // In glTF, these factors can be specified by fixed scalar values\n   // or from a metallic-roughness map.\n\n   vec2  metallicRoughness   = getMetallicRoughness ();\n   float perceptualRoughness = clamp (metallicRoughness [1], c_MinRoughness, 1.0);\n   float metallic            = clamp (metallicRoughness [0], 0.0, 1.0);\n\n   // Roughness is authored as perceptual roughness; as is convention,\n   // convert to material roughness by squaring the perceptual roughness [2].\n   float alphaRoughness = perceptualRoughness * perceptualRoughness;\n\n   // The albedo may be defined from a base texture or a flat color.\n   vec4  baseColor    = getBaseColor ();\n   float alpha        = baseColor .a;\n   vec3  f0           = vec3 (0.04);\n   vec3  diffuseColor = baseColor .rgb * (vec3 (1.0) - f0);\n   diffuseColor *= 1.0 - metallic;\n\n   vec3 specularColor = mix (f0, baseColor .rgb, metallic);\n\n   // Compute reflectance.\n   float reflectance = max (max (specularColor .r, specularColor .g), specularColor .b);\n\n   // For typical incident reflectance range (between 4% to 100%) set the grazing reflectance to 100% for typical fresnel effect.\n   // For very low reflectance range on highly diffuse objects (below 4%), incrementally reduce grazing reflecance to 0%.\n   float reflectance90          = clamp (reflectance * 25.0, 0.0, 1.0);\n   vec3  specularEnvironmentR0  = specularColor .rgb;\n   vec3  specularEnvironmentR90 = vec3 (1.0, 1.0, 1.0) * reflectance90;\n\n   // Apply light sources\n\n   vec3 n = getNormalVector (x3d_Material .normalScale);  // normal at surface point\n   vec3 v = normalize (-vertex); // Vector from surface point to camera\n\n   vec3 finalColor = vec3 (0.0);\n\n   #if defined (X3D_LIGHTING)\n   for (int i = 0; i < X3D_NUM_LIGHTS; i ++)\n   {\n      x3d_LightSourceParameters light = x3d_LightSource [i];\n\n      vec3  vL = light .location - vertex; // Light to fragment\n      float dL = length (light .matrix * vL);\n      bool  di = light .type == x3d_DirectionalLight;\n\n      if (di || dL <= light .radius)\n      {\n         vec3 d = light .direction;\n         vec3 c = light .attenuation;\n         vec3 L = di ? -d : normalize (vL); // Normalized vector from point on geometry to light source i position.\n\n         vec3 l = normalize (L);       // Vector from surface point to light\n         vec3 h = normalize (l + v);   // Half vector between both l and v\n\n         float NdotL = clamp (dot (n, l), 0.001, 1.0);\n         float NdotV = abs (dot (n, v)) + 0.001;\n         float NdotH = clamp (dot (n, h), 0.0, 1.0);\n         float LdotH = clamp (dot (l, h), 0.0, 1.0);\n         float VdotH = clamp (dot (v, h), 0.0, 1.0);\n\n         PBRInfo pbrInputs = PBRInfo (\n            NdotL,\n            NdotV,\n            NdotH,\n            LdotH,\n            VdotH,\n            perceptualRoughness,\n            metallic,\n            specularEnvironmentR0,\n            specularEnvironmentR90,\n            alphaRoughness,\n            diffuseColor,\n            specularColor\n         );\n\n         // Calculate the shading terms for the microfacet specular shading model.\n         vec3  F = specularReflection (pbrInputs);\n         float G = geometricOcclusion (pbrInputs);\n         float D = microfacetDistribution (pbrInputs);\n\n         float attenuationFactor     = di ? 1.0 : 1.0 / max (dot (c, vec3 (1.0, dL, dL * dL)), 1.0);\n         float spotFactor            = light .type == x3d_SpotLight ? getSpotFactor (light .cutOffAngle, light .beamWidth, L, d) : 1.0;\n         float attenuationSpotFactor = attenuationFactor * spotFactor;\n\n         // Calculation of analytical lighting contribution\n         vec3 diffuseContrib     = (1.0 - F) * diffuse (pbrInputs);\n         vec3 specContrib        = F * G * D / (4.0 * NdotL * NdotV);\n         vec3 diffuseSpecContrib = light .intensity * (diffuseContrib + specContrib);\n\n         #if defined (X3D_SHADOWS)\n            if (NdotL > 0.001)\n               diffuseSpecContrib = mix (diffuseSpecContrib, light .shadowColor, getShadowIntensity (i, light));\n         #endif\n\n         vec3 color = NdotL * attenuationSpotFactor * light .color * diffuseSpecContrib;\n\n         finalColor += color;\n      }\n   }\n   #endif\n\n   // Calculate lighting contribution from image based lighting source (IBL).\n   #if defined (USE_IBL)\n   vec3 reflection = -normalize (reflect (v, n));\n   finalColor += getIBLContribution (pbrInputs, n, reflection);\n   #endif\n\n   // Apply optional PBR terms for additional (optional) shading.\n   #if defined (X3D_OCCLUSION_TEXTURE)\n   finalColor = mix (finalColor, finalColor * getOcclusionFactor (), x3d_Material .occlusionStrength);\n   #endif\n\n   finalColor += getEmissiveColor ();\n\n   // Combine with alpha and do gamma correction.\n   return Gamma (vec4 (finalColor, alpha));\n}\n\nvoid\nmain ()\n{\n   fragment_main ();\n}\n';n.set("assets/shaders/webgl1/PBR.fs",jm);const Gm=jm,Hm='\nprecision highp float;\nprecision highp int;\nprecision highp sampler2D;\nprecision highp samplerCube;\n\n#pragma X3D include "include/Fragment.glsl"\n#pragma X3D include "include/Material.glsl"\n#pragma X3D include "include/Normal.glsl"\n\n#if defined (X3D_AMBIENT_TEXTURE)\nuniform x3d_AmbientTextureParameters x3d_AmbientTexture;\n#endif\n\nvec3\ngetAmbientColor (const in vec3 diffuseColor)\n{\n   // Get ambient parameter.\n\n   vec3 ambientParameter = x3d_Material .ambientIntensity * diffuseColor;\n\n   // Get texture color.\n\n   #if defined (X3D_AMBIENT_TEXTURE)\n      vec3 texCoord = getTexCoord (x3d_AmbientTexture .textureTransformMapping, x3d_AmbientTexture .textureCoordinateMapping);\n\n      #if defined (X3D_AMBIENT_TEXTURE_2D)\n         return ambientParameter * texture2D (x3d_AmbientTexture .texture2D, texCoord .st) .rgb;\n      #elif defined (X3D_AMBIENT_TEXTURE_CUBE)\n         return ambientParameter * textureCube (x3d_AmbientTexture .textureCube, texCoord) .rgb;\n      #endif\n   #else\n      return ambientParameter;\n   #endif\n}\n\n#if defined (X3D_DIFFUSE_TEXTURE)\nuniform x3d_DiffuseTextureParameters x3d_DiffuseTexture;\n#endif\n\nvec4\ngetDiffuseColor ()\n{\n   // Get diffuse parameter.\n\n   float alpha = 1.0 - x3d_Material .transparency;\n\n   #if defined (X3D_COLOR_MATERIAL)\n      vec4 diffuseParameter = vec4 (color .rgb, color .a * alpha);\n   #else\n      vec4 diffuseParameter = vec4 (x3d_Material .diffuseColor, alpha);\n   #endif\n\n   // Get texture color.\n\n   #if defined (X3D_DIFFUSE_TEXTURE)\n      vec3 texCoord = getTexCoord (x3d_DiffuseTexture .textureTransformMapping, x3d_DiffuseTexture .textureCoordinateMapping);\n\n      #if defined (X3D_DIFFUSE_TEXTURE_2D)\n         return diffuseParameter * texture2D (x3d_DiffuseTexture .texture2D, texCoord .st);\n      #elif defined (X3D_DIFFUSE_TEXTURE_CUBE)\n         return diffuseParameter * textureCube (x3d_DiffuseTexture .textureCube, texCoord);\n      #endif\n   #elif defined (X3D_TEXTURE)\n      return getTextureColor (diffuseParameter, vec4 (x3d_Material .specularColor, alpha));\n   #else\n      return diffuseParameter;\n   #endif\n}\n\n#if defined (X3D_SPECULAR_TEXTURE)\nuniform x3d_SpecularTextureParameters x3d_SpecularTexture;\n#endif\n\nvec3\ngetSpecularColor ()\n{\n   // Get specular parameter.\n\n   vec3 specularParameter = x3d_Material .specularColor;\n\n   // Get texture color.\n\n   #if defined (X3D_SPECULAR_TEXTURE)\n      vec3 texCoord = getTexCoord (x3d_SpecularTexture .textureTransformMapping, x3d_SpecularTexture .textureCoordinateMapping);\n\n      #if defined (X3D_SPECULAR_TEXTURE_2D)\n         return specularParameter * texture2D (x3d_SpecularTexture .texture2D, texCoord .st) .rgb;\n      #elif defined (X3D_SPECULAR_TEXTURE_CUBE)\n         return specularParameter * textureCube (x3d_SpecularTexture .textureCube, texCoord) .rgb;\n      #endif\n   #else\n      return specularParameter;\n   #endif\n}\n\n#if defined (X3D_EMISSIVE_TEXTURE)\nuniform x3d_EmissiveTextureParameters x3d_EmissiveTexture;\n#endif\n\nvec3\ngetEmissiveColor ()\n{\n   // Get emissive parameter.\n\n   vec3 emissiveParameter = x3d_Material .emissiveColor;\n\n   // Get texture color.\n\n   #if defined (X3D_EMISSIVE_TEXTURE)\n      vec3 texCoord = getTexCoord (x3d_EmissiveTexture .textureTransformMapping, x3d_EmissiveTexture .textureCoordinateMapping);\n\n      #if defined (X3D_EMISSIVE_TEXTURE_2D)\n         return emissiveParameter * texture2D (x3d_EmissiveTexture .texture2D, texCoord .st) .rgb;\n      #elif defined (X3D_EMISSIVE_TEXTURE_CUBE)\n         return emissiveParameter * textureCube (x3d_EmissiveTexture .textureCube, texCoord) .rgb;\n      #endif\n   #else\n      return emissiveParameter;\n   #endif\n}\n\n#if defined (X3D_SHININESS_TEXTURE)\nuniform x3d_ShininessTextureParameters x3d_ShininessTexture;\n#endif\n\nfloat\ngetShininessFactor ()\n{\n   // Get shininess parameter.\n\n   float shininess = x3d_Material .shininess;\n\n   // Get texture color.\n\n   #if defined (X3D_SHININESS_TEXTURE)\n      vec3 texCoord = getTexCoord (x3d_ShininessTexture .textureTransformMapping, x3d_ShininessTexture .textureCoordinateMapping);\n\n      #if defined (X3D_SHININESS_TEXTURE_2D)\n         return shininess * texture2D (x3d_ShininessTexture .texture2D, texCoord .st) .a;\n      #elif defined (X3D_SHININESS_TEXTURE_CUBE)\n         return shininess * textureCube (x3d_ShininessTexture .textureCube, texCoord) .a;\n      #endif\n   #else\n      return shininess;\n   #endif\n}\n\n#if defined (X3D_OCCLUSION_TEXTURE)\nuniform x3d_OcclusionTextureParameters x3d_OcclusionTexture;\n#endif\n\nfloat\ngetOcclusionFactor ()\n{\n   // Get texture color.\n\n   #if defined (X3D_OCCLUSION_TEXTURE)\n      vec3 texCoord = getTexCoord (x3d_OcclusionTexture .textureTransformMapping, x3d_OcclusionTexture .textureCoordinateMapping);\n\n      #if defined (X3D_OCCLUSION_TEXTURE_2D)\n         return texture2D (x3d_OcclusionTexture .texture2D, texCoord .st) .r;\n      #elif defined (X3D_OCCLUSION_TEXTURE_CUBE)\n         return textureCube (x3d_OcclusionTexture .textureCube, texCoord) .r;\n      #endif\n   #else\n      return 1.0;\n   #endif\n}\n\nvec4\ngetMaterialColor ()\n{\n   // Calculate diffuseColor & alpha\n\n   vec4  diffuseColorAlpha = getDiffuseColor ();\n   float alpha             = diffuseColorAlpha .a;\n   vec3  diffuseColor      = diffuseColorAlpha .rgb;\n   vec3  ambientColor      = getAmbientColor (diffuseColor);\n   vec3  specularColor     = getSpecularColor ();\n   float shininess         = getShininessFactor ();\n   float normalScale       = x3d_Material .normalScale;\n\n   #if defined (X3D_PROJECTIVE_TEXTURE_MAPPING)\n      vec4 P = getProjectiveTextureColor (vec4 (1.0));\n\n      diffuseColor *= P .rgb;\n      alpha        *= P .a;\n   #endif\n\n   #if defined (X3D_LIGHTING)\n      vec3 finalColor = getMaterialColor (vertex, getNormalVector (normalScale), ambientColor, diffuseColor, specularColor, shininess);\n   #else\n      vec3 finalColor = vec3 (0.0);\n   #endif\n\n   #if defined (X3D_OCCLUSION_TEXTURE)\n   finalColor = mix (finalColor, finalColor * getOcclusionFactor (), x3d_Material .occlusionStrength);\n   #endif\n\n   finalColor += getEmissiveColor ();\n\n   return vec4 (finalColor, alpha);\n}\n\nvoid\nmain ()\n{\n   fragment_main ();\n}\n';n.set("assets/shaders/webgl1/Phong.fs",Hm);const qm=Hm,Ym='\nprecision highp float;\nprecision highp int;\nprecision highp sampler2D;\nprecision highp samplerCube;\n\n#pragma X3D include "include/Fragment.glsl"\nuniform x3d_UnlitMaterialParameters x3d_Material;\n\n#if defined (X3D_EMISSIVE_TEXTURE)\nuniform x3d_EmissiveTextureParameters x3d_EmissiveTexture;\n#endif\n\nvec4\ngetEmissiveColor ()\n{\n   // Get emissive parameter.\n\n   float alpha = 1.0 - x3d_Material .transparency;\n\n   #if defined (X3D_COLOR_MATERIAL)\n      vec4 emissiveParameter = vec4 (color .rgb, color .a * alpha);\n   #else\n      vec4 emissiveParameter = vec4 (x3d_Material .emissiveColor, alpha);\n   #endif\n\n   // Get texture color.\n\n   #if defined (X3D_EMISSIVE_TEXTURE)\n      vec3 texCoord = getTexCoord (x3d_EmissiveTexture .textureTransformMapping, x3d_EmissiveTexture .textureCoordinateMapping);\n\n      #if defined (X3D_EMISSIVE_TEXTURE_2D)\n         return emissiveParameter * texture2D (x3d_EmissiveTexture .texture2D, texCoord .st);\n      #elif defined (X3D_EMISSIVE_TEXTURE_CUBE)\n         return emissiveParameter * textureCube (x3d_EmissiveTexture .textureCube, texCoord);\n      #endif\n   #elif defined (X3D_TEXTURE)\n      return getTextureColor (emissiveParameter, vec4 (vec3 (1.0), alpha));\n   #else\n      return emissiveParameter;\n   #endif\n}\n\nvec4\ngetMaterialColor ()\n{\n   return getEmissiveColor ();\n}\n\nvoid\nmain ()\n{\n   fragment_main ();\n}\n';n.set("assets/shaders/webgl1/Unlit.fs",Ym);const Wm=Ym,Km='#version 300 es\n\nprecision highp float;\nprecision highp int;\nprecision highp sampler2D;\nprecision highp sampler3D;\nprecision highp samplerCube;\n\n#pragma X3D include "include/Vertex.glsl"\n\nvoid\nmain ()\n{\n   vertex_main ();\n}\n';n.set("assets/shaders/webgl2/Default.vs",Km);const Jm=Km,Zm='#version 300 es\n\nprecision highp float;\nprecision highp int;\nprecision highp sampler2D;\n\nuniform mat4 x3d_ProjectionMatrix;\nuniform mat4 x3d_ModelViewMatrix;\n\nin vec4 x3d_Vertex;\n\nout vec3 vertex;\n\n#pragma X3D include "include/Particle.glsl"\n\nvoid\nmain ()\n{\n   vec4 position = x3d_ModelViewMatrix * getVertex (x3d_Vertex);\n\n   vertex = position .xyz;\n\n   gl_Position = x3d_ProjectionMatrix * position;\n}\n';n.set("assets/shaders/webgl2/Depth.vs",Zm);const Qm=Zm,$m='#version 300 es\n\nprecision highp float;\nprecision highp int;\nprecision highp sampler2D;\nprecision highp sampler3D;\nprecision highp samplerCube;\n\n#pragma X3D include "include/Vertex.glsl"\n#pragma X3D include "include/Material.glsl"\n\nout vec4 frontColor;\n\n#if ! defined (X3D_GEOMETRY_0D) && ! defined (X3D_GEOMETRY_1D)\n   out vec4 backColor;\n#endif\n\nvec4\ngetMaterialColor (const in vec3 N,\n                  const in vec3 vertex,\n                  const in x3d_MaterialParameters material)\n{\n   // Get diffuse parameter.\n\n   float alpha = 1.0 - x3d_Material .transparency;\n\n   #if defined (X3D_COLOR_MATERIAL)\n      vec4 diffuseParameter = vec4 (color .rgb, color .a * alpha);\n   #else\n      vec4 diffuseParameter = vec4 (x3d_Material .diffuseColor, alpha);\n   #endif\n\n   // Get material color.\n\n   vec3 ambientColor = diffuseParameter .rgb * material .ambientIntensity;\n\n   #if defined (X3D_LIGHTING)\n      vec3 finalColor = getMaterialColor (vertex, N, ambientColor, diffuseParameter .rgb, material .specularColor, material .shininess);\n   #else\n      vec3 finalColor = vec3 (0.0);\n   #endif\n\n   finalColor += material .emissiveColor;\n\n   return vec4 (finalColor, diffuseParameter .a);\n}\n\nvoid\nmain ()\n{\n   vertex_main ();\n\n   normal     = normalize (normal);\n   frontColor = getMaterialColor (normal, vertex, x3d_Material);\n\n   #if ! defined (X3D_GEOMETRY_0D) && ! defined (X3D_GEOMETRY_1D)\n      backColor = getMaterialColor (-normal, vertex, x3d_Material);\n   #endif\n}\n';n.set("assets/shaders/webgl2/Gouraud.vs",$m);const t_=$m,e_="#version 300 es\n\nprecision highp float;\n\nuniform vec4  viewport;\nuniform mat4  modelViewProjectionMatrix;\nuniform mat4  invModelViewProjectionMatrix;\nuniform float scale;\n\nin vec3 x3d_LineStipple0; in float x3d_FogDepth0; in vec4 x3d_Color0; in vec3 x3d_Normal0; in vec4 x3d_Vertex0;\nin vec3 x3d_LineStipple1; in float x3d_FogDepth1; in vec4 x3d_Color1; in vec3 x3d_Normal1; in vec4 x3d_Vertex1;\n\nout vec3 lineStipple0; out float fogDepth0; out vec4 color0; out vec3 normal0; out vec4 vertex0;\nout vec3 lineStipple1; out float fogDepth1; out vec4 color1; out vec3 normal1; out vec4 vertex1;\nout vec3 lineStipple2; out float fogDepth2; out vec4 color2; out vec3 normal2; out vec4 vertex2;\n\nvec3\nprojectPoint (const in vec4 point, const in mat4 modelViewProjectionMatrix, const in vec4 viewport)\n{\n   vec4 vin = modelViewProjectionMatrix * point;\n\n   vin .xyz = vin .xyz / (2.0 * vin .w) + 0.5;\n\n   return vec3 (vin .xy * viewport .zw + viewport .xy, vin .z);\n}\n\nvec4\nunProjectPoint (const in vec3 win, const in mat4 invModelViewProjection, const in vec4 viewport)\n{\n   vec4 vin = vec4 ((win .xy - viewport .xy) / viewport .zw * 2.0 - 1.0, 2.0 * win .z - 1.0, 1.0);\n\n   vin = invModelViewProjection * vin;\n\n   return vec4 (vin .xyz / vin .w, 1.0);\n}\n\nvoid\nmain ()\n{\n   vec3 projected0 = projectPoint (x3d_Vertex0, modelViewProjectionMatrix, viewport);\n   vec3 projected1 = projectPoint (x3d_Vertex1, modelViewProjectionMatrix, viewport);\n   vec2 direction  = normalize (projected1 .xy - projected0 .xy);\n   vec2 offset     = vec2 (-direction .y, direction .x) * scale;\n\n   // 0 - 3\n   // | Â |\n   // 1 - 2\n\n   if (gl_InstanceID == 0)\n   {\n      vec2 pq0 = projected0 .xy + offset;\n      vec2 pq1 = projected0 .xy - offset;\n      vec2 pq2 = projected1 .xy - offset;\n\n      vec4 p0 = unProjectPoint (vec3 (pq0 .xy, projected0 .z), invModelViewProjectionMatrix, viewport);\n      vec4 p1 = unProjectPoint (vec3 (pq1 .xy, projected0 .z), invModelViewProjectionMatrix, viewport);\n      vec4 p2 = unProjectPoint (vec3 (pq2 .xy, projected1 .z), invModelViewProjectionMatrix, viewport);\n\n      lineStipple0 = x3d_LineStipple0; fogDepth0 = x3d_FogDepth0; color0 = x3d_Color0; normal0 = x3d_Normal0; vertex0 = p0;\n      lineStipple1 = x3d_LineStipple0; fogDepth1 = x3d_FogDepth0; color1 = x3d_Color0; normal1 = x3d_Normal0; vertex1 = p1;\n      lineStipple2 = x3d_LineStipple1; fogDepth2 = x3d_FogDepth1; color2 = x3d_Color1; normal2 = x3d_Normal1; vertex2 = p2;\n   }\n   else\n   {\n      vec2 pq0 = projected0 .xy + offset;\n      vec2 pq2 = projected1 .xy - offset;\n      vec2 pq3 = projected1 .xy + offset;\n\n      vec4 p0 = unProjectPoint (vec3 (pq0 .xy, projected0 .z), invModelViewProjectionMatrix, viewport);\n      vec4 p2 = unProjectPoint (vec3 (pq2 .xy, projected1 .z), invModelViewProjectionMatrix, viewport);\n      vec4 p3 = unProjectPoint (vec3 (pq3 .xy, projected1 .z), invModelViewProjectionMatrix, viewport);\n\n      lineStipple0 = x3d_LineStipple0; fogDepth0 = x3d_FogDepth0; color0 = x3d_Color0; normal0 = x3d_Normal0; vertex0 = p0;\n      lineStipple1 = x3d_LineStipple1; fogDepth1 = x3d_FogDepth1; color1 = x3d_Color1; normal1 = x3d_Normal1; vertex1 = p2;\n      lineStipple2 = x3d_LineStipple1; fogDepth2 = x3d_FogDepth1; color2 = x3d_Color1; normal2 = x3d_Normal1; vertex2 = p3;\n   }\n}\n";n.set("assets/shaders/webgl2/LineTransform.vs",e_);const n_=e_,i_='#version 300 es\n\nprecision highp float;\nprecision highp int;\n\nin vec3 vertex;\n\nout vec4 x3d_FragColor;\n\n#pragma X3D include "include/ClipPlanes.glsl"\n#pragma X3D include "include/Pack.glsl"\n\nvoid\nmain ()\n{\n   #if defined (X3D_CLIP_PLANES)\n      clip ();\n   #endif\n\n   x3d_FragColor = pack (gl_FragCoord .z);\n}\n';n.set("assets/shaders/webgl2/Depth.fs",i_);const o_=i_,r_='#version 300 es\n\nprecision highp float;\nprecision highp int;\nprecision highp sampler2D;\nprecision highp sampler3D;\nprecision highp samplerCube;\n\n#pragma X3D include "include/Fragment.glsl"\n\nin vec4 frontColor;\n\n#if ! defined (X3D_GEOMETRY_0D) && ! defined (X3D_GEOMETRY_1D)\n   in vec4 backColor;\n#endif\n\nvec4\ngetMaterialColor ()\n{\n   #if defined (X3D_GEOMETRY_0D) || defined (X3D_GEOMETRY_1D)\n      vec4 finalColor = frontColor;\n   #else\n      vec4 finalColor = gl_FrontFacing ? frontColor : backColor;\n   #endif\n\n   #if defined (X3D_TEXTURE)\n      finalColor = getTextureColor (finalColor, vec4 (1.0));\n   #endif\n\n   #if defined (X3D_PROJECTIVE_TEXTURE_MAPPING)\n      finalColor = getProjectiveTextureColor (finalColor);\n   #endif\n\n   return finalColor;\n}\n\nvoid\nmain ()\n{\n   fragment_main ();\n}\n';n.set("assets/shaders/webgl2/Gouraud.fs",r_);const s_=r_,a_="#version 300 es\n\nprecision highp float;\n\nvoid\nmain () { }\n";n.set("assets/shaders/webgl2/LineTransform.fs",a_);const u_=a_,c_='#version 300 es\n\n// https://github.com/cx20/gltf-test/blob/master/examples/khronos-gltf-loader/shaders/pbr-frag.glsl\n\nprecision highp float;\nprecision highp int;\nprecision highp sampler2D;\nprecision highp sampler3D;\nprecision highp samplerCube;\n\n#pragma X3D include "include/Fragment.glsl"\n#pragma X3D include "include/Colors.glsl"\n#pragma X3D include "include/Normal.glsl"\n#pragma X3D include "include/SpotFactor.glsl"\n#pragma X3D include "include/Shadow.glsl"\n\n#if defined (X3D_LIGHTING)\n   uniform x3d_LightSourceParameters x3d_LightSource [X3D_NUM_LIGHTS];\n#endif\n\nuniform x3d_PhysicalMaterialParameters x3d_Material;\n\n#if defined (USE_IBL)\n   uniform samplerCube diffuseEnvironmentTexture;\n   uniform samplerCube specularEnvironmentTexture;\n   uniform sampler2D brdfLUT;\n#endif\n\n#if defined (X3D_BASE_TEXTURE)\nuniform x3d_BaseTextureParameters x3d_BaseTexture;\n#endif\n\nvec4\ngetBaseColor ()\n{\n   // Get base parameter.\n\n   float alpha = 1.0 - x3d_Material .transparency;\n\n   #if defined (X3D_COLOR_MATERIAL)\n      vec4 baseParameter = vec4 (color .rgb, color .a * alpha);\n   #else\n      vec4 baseParameter = vec4 (x3d_Material .baseColor, alpha);\n   #endif\n\n   // Get texture color.\n\n   #if defined (X3D_BASE_TEXTURE)\n      vec3 texCoord = getTexCoord (x3d_BaseTexture .textureTransformMapping, x3d_BaseTexture .textureCoordinateMapping);\n      #if defined (X3D_BASE_TEXTURE_2D)\n         return baseParameter * SRGBtoLINEAR (texture (x3d_BaseTexture .texture2D, texCoord .st));\n      #elif defined (X3D_BASE_TEXTURE_3D)\n         return baseParameter * SRGBtoLINEAR (texture (x3d_BaseTexture .texture3D, texCoord));\n      #elif defined (X3D_BASE_TEXTURE_CUBE)\n         return baseParameter * SRGBtoLINEAR (texture (x3d_BaseTexture .textureCube, texCoord));\n      #endif\n   #elif defined (X3D_TEXTURE)\n      return getTextureColor (baseParameter, vec4 (vec3 (1.0), alpha));\n   #else\n      return baseParameter;\n   #endif\n}\n\n#if defined (X3D_EMISSIVE_TEXTURE)\nuniform x3d_EmissiveTextureParameters x3d_EmissiveTexture;\n#endif\n\nvec3\ngetEmissiveColor ()\n{\n   // Get emissive parameter.\n\n   vec3 emissiveParameter = x3d_Material .emissiveColor;\n\n   // Get texture color.\n\n   #if defined (X3D_EMISSIVE_TEXTURE)\n      vec3 texCoord = getTexCoord (x3d_EmissiveTexture .textureTransformMapping, x3d_EmissiveTexture .textureCoordinateMapping);\n\n      #if defined (X3D_EMISSIVE_TEXTURE_2D)\n         return emissiveParameter * SRGBtoLINEAR (texture (x3d_EmissiveTexture .texture2D, texCoord .st)) .rgb;\n      #elif defined (X3D_EMISSIVE_TEXTURE_3D)\n         return emissiveParameter * SRGBtoLINEAR (texture (x3d_EmissiveTexture .texture3D, texCoord)) .rgb;\n      #elif defined (X3D_EMISSIVE_TEXTURE_CUBE)\n         return emissiveParameter * SRGBtoLINEAR (texture (x3d_EmissiveTexture .textureCube, texCoord)) .rgb;\n      #endif\n   #else\n      return emissiveParameter .rgb;\n   #endif\n}\n\n#if defined (X3D_METALLIC_ROUGHNESS_TEXTURE)\nuniform x3d_MetallicRoughnessTextureParameters x3d_MetallicRoughnessTexture;\n#endif\n\nvec2\ngetMetallicRoughness ()\n{\n   // Metallic and Roughness material properties are packed together\n   // In glTF, these factors can be specified by fixed scalar values\n   // or from a metallic-roughness map\n   float metallic            = x3d_Material .metallic;\n   float perceptualRoughness = x3d_Material .roughness;\n\n   // Get texture color.\n\n   #if defined (X3D_METALLIC_ROUGHNESS_TEXTURE)\n      vec3 texCoord = getTexCoord (x3d_MetallicRoughnessTexture .textureTransformMapping, x3d_MetallicRoughnessTexture .textureCoordinateMapping);\n      // Roughness is stored in the \'g\' channel, metallic is stored in the \'b\' channel.\n      // This layout intentionally reserves the \'r\' channel for (optional) occlusion map data\n      #if defined (X3D_METALLIC_ROUGHNESS_TEXTURE_2D)\n         vec4 mrSample = texture (x3d_MetallicRoughnessTexture .texture2D, texCoord .st);\n      #elif defined (X3D_METALLIC_ROUGHNESS_TEXTURE_3D)\n         vec4 mrSample = texture (x3d_MetallicRoughnessTexture .texture3D, texCoord);\n      #elif defined (X3D_METALLIC_ROUGHNESS_TEXTURE_CUBE)\n         vec4 mrSample = texture (x3d_MetallicRoughnessTexture .textureCube, texCoord);\n      #endif\n      metallic            *= mrSample .b;\n      perceptualRoughness *= mrSample .g;\n\n      return vec2 (metallic, perceptualRoughness);\n   #else\n      return vec2 (metallic, perceptualRoughness);\n   #endif\n}\n\n#if defined (X3D_OCCLUSION_TEXTURE)\nuniform x3d_OcclusionTextureParameters x3d_OcclusionTexture;\n#endif\n\nfloat\ngetOcclusionFactor ()\n{\n   // Get texture color.\n\n   #if defined (X3D_OCCLUSION_TEXTURE)\n      vec3 texCoord = getTexCoord (x3d_OcclusionTexture .textureTransformMapping, x3d_OcclusionTexture .textureCoordinateMapping);\n\n      #if defined (X3D_OCCLUSION_TEXTURE_2D)\n         return texture (x3d_OcclusionTexture .texture2D, texCoord .st) .r;\n      #elif defined (X3D_OCCLUSION_TEXTURE_3D)\n         return texture (x3d_OcclusionTexture .texture3D, texCoord) .r;\n      #elif defined (X3D_OCCLUSION_TEXTURE_CUBE)\n         return texture (x3d_OcclusionTexture .textureCube, texCoord) .r;\n      #endif\n   #else\n      return 1.0;\n   #endif\n}\n\n// Encapsulate the various inputs used by the various functions in the shading equation\n// We store values in this struct to simplify the integration of alternative implementations\n// of the shading terms, outlined in the Readme.MD Appendix.\nstruct PBRInfo\n{\n   float NdotL;                  // cos angle between normal and light direction\n   float NdotV;                  // cos angle between normal and view direction\n   float NdotH;                  // cos angle between normal and half vector\n   float LdotH;                  // cos angle between light direction and half vector\n   float VdotH;                  // cos angle between view direction and half vector\n   float perceptualRoughness;    // roughness value, as authored by the model creator (input to shader)\n   float metalness;              // metallic value at the surface\n   vec3 reflectance0;            // full reflectance color (normal incidence angle)\n   vec3 reflectance90;           // reflectance color at grazing angle\n   float alphaRoughness;         // roughness mapped to a more linear change in the roughness (proposed by [2])\n   vec3 diffuseColor;            // color contribution from diffuse lighting\n   vec3 specularColor;           // color contribution from specular lighting\n};\n\nconst float M_PI           = 3.141592653589793;\nconst float c_MinRoughness = 0.04;\n\n#if defined (USE_IBL)\n// Calculation of the lighting contribution from an optional Image Based Light source.\n// Precomputed Environment Maps are required uniform inputs and are computed as outlined in [1].\n// See our README.md on Environment Maps [3] for additional discussion.\nvec3\ngetIBLContribution (const in PBRInfo pbrInputs, vec3 n, const in vec3 reflection)\n{\n   float mipCount = 9.0; // resolution of 512x512\n   float lod      = pbrInputs .perceptualRoughness * mipCount;\n\n   // retrieve a scale and bias to F0. See [1], Figure 3\n   vec3 brdf         = SRGBtoLINEAR (texture (brdfLUT, vec2 (pbrInputs .NdotV, 1.0 - pbrInputs .perceptualRoughness))) .rgb;\n   vec3 diffuseLight = SRGBtoLINEAR (textureCube (diffuseEnvironmentTexture, n)) .rgb;\n\n   #if defined (USE_TEX_LOD)\n      vec3 specularLight = SRGBtoLINEAR (textureCubeLodEXT (specularEnvironmentTexture, reflection, lod)) .rgb;\n   #else\n      vec3 specularLight = SRGBtoLINEAR (textureCube (specularEnvironmentTexture, reflection)) .rgb;\n   #endif\n\n   vec3 diffuse  = diffuseLight * pbrInputs .diffuseColor;\n   vec3 specular = specularLight * (pbrInputs .specularColor * brdf .x + brdf .y);\n\n   return diffuse + specular;\n}\n#endif\n\n// Basic Lambertian diffuse\n// Implementation from Lambert\'s Photometria https://archive.org/details/lambertsphotome00lambgoog\n// See also [1], Equation 1\nvec3\ndiffuse (const in PBRInfo pbrInputs)\n{\n   return pbrInputs .diffuseColor / M_PI;\n}\n\n// The following equation models the Fresnel reflectance term of the spec equation (aka F())\n// Implementation of fresnel from [4], Equation 15\nvec3\nspecularReflection (const in PBRInfo pbrInputs)\n{\n   return pbrInputs .reflectance0 + (pbrInputs .reflectance90 - pbrInputs .reflectance0) * pow (clamp (1.0 - pbrInputs .VdotH, 0.0, 1.0), 5.0);\n}\n\n// This calculates the specular geometric attenuation (aka G()),\n// where rougher material will reflect less light back to the viewer.\n// This implementation is based on [1] Equation 4, and we adopt their modifications to\n// alphaRoughness as input as originally proposed in [2].\nfloat\ngeometricOcclusion (const in PBRInfo pbrInputs)\n{\n   float NdotL = pbrInputs .NdotL;\n   float NdotV = pbrInputs .NdotV;\n   float r     = pbrInputs .alphaRoughness;\n\n   float attenuationL = 2.0 * NdotL / (NdotL + sqrt (r * r + (1.0 - r * r) * (NdotL * NdotL)));\n   float attenuationV = 2.0 * NdotV / (NdotV + sqrt (r * r + (1.0 - r * r) * (NdotV * NdotV)));\n\n   return attenuationL * attenuationV;\n}\n\n// The following equation(s) model the distribution of microfacet normals across the area being drawn (aka D())\n// Implementation from "Average Irregularity Representation of a Roughened Surface for Ray Reflection" by T. S. Trowbridge, and K. P. Reitz\n// Follows the distribution function recommended in the SIGGRAPH 2013 course notes from EPIC Games [1], Equation 3.\nfloat\nmicrofacetDistribution (const in PBRInfo pbrInputs)\n{\n   float roughnessSq = pbrInputs .alphaRoughness * pbrInputs .alphaRoughness;\n   float f           = (pbrInputs .NdotH * roughnessSq - pbrInputs .NdotH) * pbrInputs .NdotH + 1.0;\n\n   return roughnessSq / (M_PI * f * f);\n}\n\nvec4\ngetMaterialColor ()\n{\n   // Metallic and Roughness material properties are packed together\n   // In glTF, these factors can be specified by fixed scalar values\n   // or from a metallic-roughness map.\n\n   vec2  metallicRoughness   = getMetallicRoughness ();\n   float perceptualRoughness = clamp (metallicRoughness [1], c_MinRoughness, 1.0);\n   float metallic            = clamp (metallicRoughness [0], 0.0, 1.0);\n\n   // Roughness is authored as perceptual roughness; as is convention,\n   // convert to material roughness by squaring the perceptual roughness [2].\n   float alphaRoughness = perceptualRoughness * perceptualRoughness;\n\n   // The albedo may be defined from a base texture or a flat color.\n   vec4  baseColor    = getBaseColor ();\n   float alpha        = baseColor .a;\n   vec3  f0           = vec3 (0.04);\n   vec3  diffuseColor = baseColor .rgb * (vec3 (1.0) - f0);\n   diffuseColor *= 1.0 - metallic;\n\n   vec3 specularColor = mix (f0, baseColor .rgb, metallic);\n\n   // Compute reflectance.\n   float reflectance = max (max (specularColor .r, specularColor .g), specularColor .b);\n\n   // For typical incident reflectance range (between 4% to 100%) set the grazing reflectance to 100% for typical fresnel effect.\n   // For very low reflectance range on highly diffuse objects (below 4%), incrementally reduce grazing reflecance to 0%.\n   float reflectance90          = clamp (reflectance * 25.0, 0.0, 1.0);\n   vec3  specularEnvironmentR0  = specularColor .rgb;\n   vec3  specularEnvironmentR90 = vec3 (1.0, 1.0, 1.0) * reflectance90;\n\n   // Apply light sources\n\n   vec3 n = getNormalVector (x3d_Material .normalScale);  // normal at surface point\n   vec3 v = normalize (-vertex); // Vector from surface point to camera\n\n   vec3 finalColor = vec3 (0.0);\n\n   #if defined (X3D_LIGHTING)\n   for (int i = 0; i < X3D_NUM_LIGHTS; i ++)\n   {\n      x3d_LightSourceParameters light = x3d_LightSource [i];\n\n      vec3  vL = light .location - vertex; // Light to fragment\n      float dL = length (light .matrix * vL);\n      bool  di = light .type == x3d_DirectionalLight;\n\n      if (di || dL <= light .radius)\n      {\n         vec3 d = light .direction;\n         vec3 c = light .attenuation;\n         vec3 L = di ? -d : normalize (vL); // Normalized vector from point on geometry to light source i position.\n\n         vec3 l = normalize (L);       // Vector from surface point to light\n         vec3 h = normalize (l + v);   // Half vector between both l and v\n\n         float NdotL = clamp (dot (n, l), 0.001, 1.0);\n         float NdotV = abs (dot (n, v)) + 0.001;\n         float NdotH = clamp (dot (n, h), 0.0, 1.0);\n         float LdotH = clamp (dot (l, h), 0.0, 1.0);\n         float VdotH = clamp (dot (v, h), 0.0, 1.0);\n\n         PBRInfo pbrInputs = PBRInfo (\n            NdotL,\n            NdotV,\n            NdotH,\n            LdotH,\n            VdotH,\n            perceptualRoughness,\n            metallic,\n            specularEnvironmentR0,\n            specularEnvironmentR90,\n            alphaRoughness,\n            diffuseColor,\n            specularColor\n         );\n\n         // Calculate the shading terms for the microfacet specular shading model.\n         vec3  F = specularReflection (pbrInputs);\n         float G = geometricOcclusion (pbrInputs);\n         float D = microfacetDistribution (pbrInputs);\n\n         float attenuationFactor     = di ? 1.0 : 1.0 / max (dot (c, vec3 (1.0, dL, dL * dL)), 1.0);\n         float spotFactor            = light .type == x3d_SpotLight ? getSpotFactor (light .cutOffAngle, light .beamWidth, L, d) : 1.0;\n         float attenuationSpotFactor = attenuationFactor * spotFactor;\n\n         // Calculation of analytical lighting contribution\n         vec3 diffuseContrib     = (1.0 - F) * diffuse (pbrInputs);\n         vec3 specContrib        = F * G * D / (4.0 * NdotL * NdotV);\n         vec3 diffuseSpecContrib = light .intensity * (diffuseContrib + specContrib);\n\n         #if defined (X3D_SHADOWS)\n            if (NdotL > 0.001)\n               diffuseSpecContrib = mix (diffuseSpecContrib, light .shadowColor, getShadowIntensity (i, light));\n         #endif\n\n         vec3 color = NdotL * attenuationSpotFactor * light .color * diffuseSpecContrib;\n\n         finalColor += color;\n      }\n   }\n   #endif\n\n   // Calculate lighting contribution from image based lighting source (IBL).\n   #if defined (USE_IBL)\n   vec3 reflection = -normalize (reflect (v, n));\n   finalColor += getIBLContribution (pbrInputs, n, reflection);\n   #endif\n\n   // Apply optional PBR terms for additional (optional) shading.\n   #if defined (X3D_OCCLUSION_TEXTURE)\n   finalColor = mix (finalColor, finalColor * getOcclusionFactor (), x3d_Material .occlusionStrength);\n   #endif\n\n   finalColor += getEmissiveColor ();\n\n   // Combine with alpha and do gamma correction.\n   return Gamma (vec4 (finalColor, alpha));\n}\n\nvoid\nmain ()\n{\n   fragment_main ();\n}\n';n.set("assets/shaders/webgl2/PBR.fs",c_);const l_=c_,h_='#version 300 es\n\nprecision highp float;\nprecision highp int;\nprecision highp sampler2D;\nprecision highp sampler3D;\nprecision highp samplerCube;\n\n#pragma X3D include "include/Fragment.glsl"\n#pragma X3D include "include/Material.glsl"\n#pragma X3D include "include/Normal.glsl"\n\n#if defined (X3D_AMBIENT_TEXTURE)\nuniform x3d_AmbientTextureParameters x3d_AmbientTexture;\n#endif\n\nvec3\ngetAmbientColor (const in vec3 diffuseColor)\n{\n   // Get ambient parameter.\n\n   vec3 ambientParameter = x3d_Material .ambientIntensity * diffuseColor;\n\n   // Get texture color.\n\n   #if defined (X3D_AMBIENT_TEXTURE)\n      vec3 texCoord = getTexCoord (x3d_AmbientTexture .textureTransformMapping, x3d_AmbientTexture .textureCoordinateMapping);\n\n      #if defined (X3D_AMBIENT_TEXTURE_2D)\n         return ambientParameter * texture (x3d_AmbientTexture .texture2D, texCoord .st) .rgb;\n      #elif defined (X3D_AMBIENT_TEXTURE_3D)\n         return ambientParameter * texture (x3d_AmbientTexture .texture3D, texCoord) .rgb;\n      #elif defined (X3D_AMBIENT_TEXTURE_CUBE)\n         return ambientParameter * texture (x3d_AmbientTexture .textureCube, texCoord) .rgb;\n      #endif\n   #else\n      return ambientParameter;\n   #endif\n}\n\n#if defined (X3D_DIFFUSE_TEXTURE)\nuniform x3d_DiffuseTextureParameters x3d_DiffuseTexture;\n#endif\n\nvec4\ngetDiffuseColor ()\n{\n   // Get diffuse parameter.\n\n   float alpha = 1.0 - x3d_Material .transparency;\n\n   #if defined (X3D_COLOR_MATERIAL)\n      vec4 diffuseParameter = vec4 (color .rgb, color .a * alpha);\n   #else\n      vec4 diffuseParameter = vec4 (x3d_Material .diffuseColor, alpha);\n   #endif\n\n   // Get texture color.\n\n   #if defined (X3D_DIFFUSE_TEXTURE)\n      vec3 texCoord = getTexCoord (x3d_DiffuseTexture .textureTransformMapping, x3d_DiffuseTexture .textureCoordinateMapping);\n\n      #if defined (X3D_DIFFUSE_TEXTURE_2D)\n         return diffuseParameter * texture (x3d_DiffuseTexture .texture2D, texCoord .st);\n      #elif defined (X3D_DIFFUSE_TEXTURE_3D)\n         return diffuseParameter * texture (x3d_DiffuseTexture .texture3D, texCoord);\n      #elif defined (X3D_DIFFUSE_TEXTURE_CUBE)\n         return diffuseParameter * texture (x3d_DiffuseTexture .textureCube, texCoord);\n      #endif\n   #elif defined (X3D_TEXTURE)\n      return getTextureColor (diffuseParameter, vec4 (x3d_Material .specularColor, alpha));\n   #else\n      return diffuseParameter;\n   #endif\n}\n\n#if defined (X3D_SPECULAR_TEXTURE)\nuniform x3d_SpecularTextureParameters x3d_SpecularTexture;\n#endif\n\nvec3\ngetSpecularColor ()\n{\n   // Get specular parameter.\n\n   vec3 specularParameter = x3d_Material .specularColor;\n\n   // Get texture color.\n\n   #if defined (X3D_SPECULAR_TEXTURE)\n      vec3 texCoord = getTexCoord (x3d_SpecularTexture .textureTransformMapping, x3d_SpecularTexture .textureCoordinateMapping);\n\n      #if defined (X3D_SPECULAR_TEXTURE_2D)\n         return specularParameter * texture (x3d_SpecularTexture .texture2D, texCoord .st) .rgb;\n      #elif defined (X3D_SPECULAR_TEXTURE_3D)\n         return specularParameter * texture (x3d_SpecularTexture .texture3D, texCoord) .rgb;\n      #elif defined (X3D_SPECULAR_TEXTURE_CUBE)\n         return specularParameter * texture (x3d_SpecularTexture .textureCube, texCoord) .rgb;\n      #endif\n   #else\n      return specularParameter;\n   #endif\n}\n\n#if defined (X3D_EMISSIVE_TEXTURE)\nuniform x3d_EmissiveTextureParameters x3d_EmissiveTexture;\n#endif\n\nvec3\ngetEmissiveColor ()\n{\n   // Get emissive parameter.\n\n   vec3 emissiveParameter = x3d_Material .emissiveColor;\n\n   // Get texture color.\n\n   #if defined (X3D_EMISSIVE_TEXTURE)\n      vec3 texCoord = getTexCoord (x3d_EmissiveTexture .textureTransformMapping, x3d_EmissiveTexture .textureCoordinateMapping);\n\n      #if defined (X3D_EMISSIVE_TEXTURE_2D)\n         return emissiveParameter * texture (x3d_EmissiveTexture .texture2D, texCoord .st) .rgb;\n      #elif defined (X3D_EMISSIVE_TEXTURE_3D)\n         return emissiveParameter * texture (x3d_EmissiveTexture .texture3D, texCoord) .rgb;\n      #elif defined (X3D_EMISSIVE_TEXTURE_CUBE)\n         return emissiveParameter * texture (x3d_EmissiveTexture .textureCube, texCoord) .rgb;\n      #endif\n   #else\n      return emissiveParameter;\n   #endif\n}\n\n#if defined (X3D_SHININESS_TEXTURE)\nuniform x3d_ShininessTextureParameters x3d_ShininessTexture;\n#endif\n\nfloat\ngetShininessFactor ()\n{\n   // Get shininess parameter.\n\n   float shininess = x3d_Material .shininess;\n\n   // Get texture color.\n\n   #if defined (X3D_SHININESS_TEXTURE)\n      vec3 texCoord = getTexCoord (x3d_ShininessTexture .textureTransformMapping, x3d_ShininessTexture .textureCoordinateMapping);\n\n      #if defined (X3D_SHININESS_TEXTURE_2D)\n         return shininess * texture (x3d_ShininessTexture .texture2D, texCoord .st) .a;\n      #elif defined (X3D_SHININESS_TEXTURE_3D)\n         return shininess * texture (x3d_ShininessTexture .texture3D, texCoord) .a;\n      #elif defined (X3D_SHININESS_TEXTURE_CUBE)\n         return shininess * texture (x3d_ShininessTexture .textureCube, texCoord) .a;\n      #endif\n   #else\n      return shininess;\n   #endif\n}\n\n#if defined (X3D_OCCLUSION_TEXTURE)\nuniform x3d_OcclusionTextureParameters x3d_OcclusionTexture;\n#endif\n\nfloat\ngetOcclusionFactor ()\n{\n   // Get texture color.\n\n   #if defined (X3D_OCCLUSION_TEXTURE)\n      vec3 texCoord = getTexCoord (x3d_OcclusionTexture .textureTransformMapping, x3d_OcclusionTexture .textureCoordinateMapping);\n\n      #if defined (X3D_OCCLUSION_TEXTURE_2D)\n         return texture (x3d_OcclusionTexture .texture2D, texCoord .st) .r;\n      #elif defined (X3D_OCCLUSION_TEXTURE_3D)\n         return texture (x3d_OcclusionTexture .texture3D, texCoord) .r;\n      #elif defined (X3D_OCCLUSION_TEXTURE_CUBE)\n         return texture (x3d_OcclusionTexture .textureCube, texCoord) .r;\n      #endif\n   #else\n      return 1.0;\n   #endif\n}\n\nvec4\ngetMaterialColor ()\n{\n   // Calculate diffuseColor & alpha\n\n   vec4  diffuseColorAlpha = getDiffuseColor ();\n   float alpha             = diffuseColorAlpha .a;\n   vec3  diffuseColor      = diffuseColorAlpha .rgb;\n   vec3  ambientColor      = getAmbientColor (diffuseColor);\n   vec3  specularColor     = getSpecularColor ();\n   float shininess         = getShininessFactor ();\n   float normalScale       = x3d_Material .normalScale;\n\n   #if defined (X3D_PROJECTIVE_TEXTURE_MAPPING)\n      vec4 P = getProjectiveTextureColor (vec4 (1.0));\n\n      diffuseColor *= P .rgb;\n      alpha        *= P .a;\n   #endif\n\n   #if defined (X3D_LIGHTING)\n      vec3 finalColor = getMaterialColor (vertex, getNormalVector (normalScale), ambientColor, diffuseColor, specularColor, shininess);\n   #else\n      vec3 finalColor = vec3 (0.0);\n   #endif\n\n   #if defined (X3D_OCCLUSION_TEXTURE)\n   finalColor = mix (finalColor, finalColor * getOcclusionFactor (), x3d_Material .occlusionStrength);\n   #endif\n\n   finalColor += getEmissiveColor ();\n\n   return vec4 (finalColor, alpha);\n}\n\nvoid\nmain ()\n{\n   fragment_main ();\n}\n';n.set("assets/shaders/webgl2/Phong.fs",h_);const d_=h_,p_='#version 300 es\n\nprecision highp float;\nprecision highp int;\nprecision highp sampler2D;\nprecision highp sampler3D;\nprecision highp samplerCube;\n\n#pragma X3D include "include/Fragment.glsl"\n\nuniform x3d_UnlitMaterialParameters x3d_Material;\n\n#if defined (X3D_EMISSIVE_TEXTURE)\nuniform x3d_EmissiveTextureParameters x3d_EmissiveTexture;\n#endif\n\nvec4\ngetEmissiveColor ()\n{\n   // Get emissive parameter.\n\n   float alpha = 1.0 - x3d_Material .transparency;\n\n   #if defined (X3D_COLOR_MATERIAL)\n      vec4 emissiveParameter = vec4 (color .rgb, color .a * alpha);\n   #else\n      vec4 emissiveParameter = vec4 (x3d_Material .emissiveColor, alpha);\n   #endif\n\n   // Get texture color.\n\n   #if defined (X3D_EMISSIVE_TEXTURE)\n      vec3 texCoord = getTexCoord (x3d_EmissiveTexture .textureTransformMapping, x3d_EmissiveTexture .textureCoordinateMapping);\n\n      #if defined (X3D_EMISSIVE_TEXTURE_2D)\n         return emissiveParameter * texture (x3d_EmissiveTexture .texture2D, texCoord .st);\n      #elif defined (X3D_EMISSIVE_TEXTURE_3D)\n         return emissiveParameter * texture (x3d_EmissiveTexture .texture3D, texCoord);\n      #elif defined (X3D_EMISSIVE_TEXTURE_CUBE)\n         return emissiveParameter * texture (x3d_EmissiveTexture .textureCube, texCoord);\n      #endif\n   #elif defined (X3D_TEXTURE)\n      return getTextureColor (emissiveParameter, vec4 (vec3 (1.0), alpha));\n   #else\n      return emissiveParameter;\n   #endif\n}\n\nvec4\ngetMaterialColor ()\n{\n   return getEmissiveColor ();\n}\n\nvoid\nmain ()\n{\n   fragment_main ();\n}\n';n.set("assets/shaders/webgl2/Unlit.fs",p_);const f_={includes:{1:{ClipPlanes:Tg,Colors:vg,Fog:Eg,Fragment:Ng,Hatch:Ig,Material:Dg,Normal:Rg,Pack:Ag,Perlin:Bg,Point:Ug,PointSize:zg,Shadow:Gg,SpotFactor:qg,Texture:Wg,Vertex:Jg},2:{ClipPlanes:Qg,Colors:tm,Fog:nm,Fragment:om,Hatch:sm,Line2:um,Material:lm,Normal:dm,Pack:fm,Particle:mm,Perlin:xm,Point:wm,PointSize:Tm,Shadow:vm,Stipple:Em,SpotFactor:Nm,Texture:Im,Vertex:Dm}},vertex:{1:{Default:Rm,Depth:Am,Gouraud:Bm},2:{Default:Jm,Depth:Qm,Gouraud:t_,LineTransform:n_}},fragment:{1:{Depth:Um,Gouraud:zm,PBR:Gm,Phong:qm,Unlit:Wm},2:{Depth:o_,Gouraud:s_,LineTransform:u_,PBR:l_,Phong:d_,Unlit:p_}}};n.set("x_ite/Browser/Shaders/Shaders",f_);const g_=f_;function m_(t){Za.call(this,t),this.addType(c.X3DShaderNode),this.valid=!1,this.selected=0}m_.prototype=Object.assign(Object.create(Za.prototype),{constructor:m_,setValid:function(t){this._isValid=this.valid=t},isValid:function(){return this.valid},select:function(){++this.selected,this._isSelected.getValue()||(this._isSelected=!0)},deselect:function(){--this.selected,0===this.selected&&this._isSelected.getValue()&&(this._isSelected=!1)}});const __=m_;n.set("x_ite/Components/Shaders/X3DShaderNode",__);const x_=__,y_=Symbol.for("X3DField.uniformLocation");function w_(t){this.addType(c.X3DProgrammableShaderObject),this.uniformNames=[],this.x3d_ClipPlane=[],this.x3d_LightType=[],this.x3d_LightOn=[],this.x3d_LightColor=[],this.x3d_LightIntensity=[],this.x3d_LightAmbientIntensity=[],this.x3d_LightAttenuation=[],this.x3d_LightLocation=[],this.x3d_LightDirection=[],this.x3d_LightBeamWidth=[],this.x3d_LightCutOffAngle=[],this.x3d_LightRadius=[],this.x3d_LightMatrix=[],this.x3d_ShadowIntensity=[],this.x3d_ShadowColor=[],this.x3d_ShadowBias=[],this.x3d_ShadowMatrix=[],this.x3d_ShadowMapSize=[],this.x3d_ShadowMap=[],this.x3d_Texture=[],this.x3d_MultiTextureMode=[],this.x3d_MultiTextureAlphaMode=[],this.x3d_MultiTextureSource=[],this.x3d_MultiTextureFunction=[],this.x3d_TextureCoordinateGeneratorMode=[],this.x3d_TextureCoordinateGeneratorParameter=[],this.x3d_ProjectiveTexture=[],this.x3d_ProjectiveTextureMatrix=[],this.x3d_ProjectiveTextureLocation=[],this.x3d_TexCoord=[],this.x3d_TextureMatrix=[],this.numClipPlanes=0,this.fogNode=null,this.numLights=0,this.numGlobalLights=0,this.lightNodes=[],this.numProjectiveTextures=0,this.numGlobalProjectiveTextures=0,this.projectiveTextureNodes=[],this.textures=new Set}function S_(t){return t[0].toLowerCase()+t.slice(1)}w_.prototype={constructor:w_,initialize:function(){const t=this.getBrowser();t.getRenderingProperties()._LogarithmicDepthBuffer.addInterest("set_logarithmicDepthBuffer__",this),this.x3d_MaxTextures=t.getMaxTextures(),this.set_logarithmicDepthBuffer__()},set_logarithmicDepthBuffer__:function(){this.logarithmicDepthBuffer=this.getBrowser().getRenderingProperty("LogarithmicDepthBuffer")},canUserDefinedFields:function(){return!0},getUniformNames:function(){return this.uniformNames},setUniformNames:function(t){this.uniformNames=t},getDefaultUniformsAndAttributes:function(){const t=this.getProgram(),e=this.getBrowser(),n=e.getContext(),i=e.getMaxClipPlanes(),o=e.getMaxLights(),r=e.getMaxTextures();n.useProgram(t);for(const e of this.uniformNames)this[e]=n.getUniformLocation(t,e);this.x3d_LogarithmicFarFactor1_2=n.getUniformLocation(t,"x3d_LogarithmicFarFactor1_2");for(let e=0;e<i;++e)this.x3d_ClipPlane[e]=n.getUniformLocation(t,"x3d_ClipPlane["+e+"]");this.x3d_FogColor=this.getUniformLocation(n,t,"x3d_Fog.color","x3d_FogColor"),this.x3d_FogVisibilityRange=this.getUniformLocation(n,t,"x3d_Fog.visibilityRange","x3d_FogVisibilityRange"),this.x3d_FogMatrix=this.getUniformLocation(n,t,"x3d_Fog.matrix","x3d_FogMatrix"),this.x3d_AlphaCutoff=n.getUniformLocation(t,"x3d_AlphaCutoff"),this.x3d_PointPropertiesPointSizeScaleFactor=n.getUniformLocation(t,"x3d_PointProperties.pointSizeScaleFactor"),this.x3d_PointPropertiesPointSizeMinValue=n.getUniformLocation(t,"x3d_PointProperties.pointSizeMinValue"),this.x3d_PointPropertiesPointSizeMaxValue=n.getUniformLocation(t,"x3d_PointProperties.pointSizeMaxValue"),this.x3d_PointPropertiesAttenuation=n.getUniformLocation(t,"x3d_PointProperties.attenuation"),this.x3d_LinePropertiesApplied=n.getUniformLocation(t,"x3d_LineProperties.applied"),this.x3d_LinePropertiesLinetype=n.getUniformLocation(t,"x3d_LineProperties.linetype"),this.x3d_LineStippleScale=n.getUniformLocation(t,"x3d_LineProperties.lineStippleScale"),this.x3d_LinePropertiesTexture=n.getUniformLocation(t,"x3d_LineProperties.texture"),this.x3d_FillPropertiesFilled=n.getUniformLocation(t,"x3d_FillProperties.filled"),this.x3d_FillPropertiesHatched=n.getUniformLocation(t,"x3d_FillProperties.hatched"),this.x3d_FillPropertiesHatchColor=n.getUniformLocation(t,"x3d_FillProperties.hatchColor"),this.x3d_FillPropertiesTexture=n.getUniformLocation(t,"x3d_FillProperties.texture");for(let e=0;e<o;++e)this.x3d_LightType[e]=this.getUniformLocation(n,t,"x3d_LightSource["+e+"].type","x3d_LightType["+e+"]"),this.x3d_LightColor[e]=this.getUniformLocation(n,t,"x3d_LightSource["+e+"].color","x3d_LightColor["+e+"]"),this.x3d_LightAmbientIntensity[e]=this.getUniformLocation(n,t,"x3d_LightSource["+e+"].ambientIntensity","x3d_LightAmbientIntensity["+e+"]"),this.x3d_LightIntensity[e]=this.getUniformLocation(n,t,"x3d_LightSource["+e+"].intensity","x3d_LightIntensity["+e+"]"),this.x3d_LightAttenuation[e]=this.getUniformLocation(n,t,"x3d_LightSource["+e+"].attenuation","x3d_LightAttenuation["+e+"]"),this.x3d_LightLocation[e]=this.getUniformLocation(n,t,"x3d_LightSource["+e+"].location","x3d_LightLocation["+e+"]"),this.x3d_LightDirection[e]=this.getUniformLocation(n,t,"x3d_LightSource["+e+"].direction","x3d_LightDirection["+e+"]"),this.x3d_LightBeamWidth[e]=this.getUniformLocation(n,t,"x3d_LightSource["+e+"].beamWidth","x3d_LightBeamWidth["+e+"]"),this.x3d_LightCutOffAngle[e]=this.getUniformLocation(n,t,"x3d_LightSource["+e+"].cutOffAngle","x3d_LightCutOffAngle["+e+"]"),this.x3d_LightRadius[e]=this.getUniformLocation(n,t,"x3d_LightSource["+e+"].radius","x3d_LightRadius["+e+"]"),this.x3d_LightMatrix[e]=this.getUniformLocation(n,t,"x3d_LightSource["+e+"].matrix","x3d_LightMatrix["+e+"]"),this.x3d_ShadowIntensity[e]=n.getUniformLocation(t,"x3d_LightSource["+e+"].shadowIntensity"),this.x3d_ShadowColor[e]=n.getUniformLocation(t,"x3d_LightSource["+e+"].shadowColor"),this.x3d_ShadowBias[e]=n.getUniformLocation(t,"x3d_LightSource["+e+"].shadowBias"),this.x3d_ShadowMatrix[e]=n.getUniformLocation(t,"x3d_LightSource["+e+"].shadowMatrix"),this.x3d_ShadowMapSize[e]=n.getUniformLocation(t,"x3d_LightSource["+e+"].shadowMapSize"),this.x3d_ShadowMap[e]=n.getUniformLocation(t,"x3d_ShadowMap["+e+"]");this.x3d_AmbientIntensity=this.getUniformLocation(n,t,"x3d_Material.ambientIntensity","x3d_FrontMaterial.ambientIntensity"),this.x3d_DiffuseColor=this.getUniformLocation(n,t,"x3d_Material.diffuseColor","x3d_FrontMaterial.diffuseColor"),this.x3d_SpecularColor=this.getUniformLocation(n,t,"x3d_Material.specularColor","x3d_FrontMaterial.specularColor"),this.x3d_EmissiveColor=this.getUniformLocation(n,t,"x3d_Material.emissiveColor","x3d_FrontMaterial.emissiveColor"),this.x3d_Shininess=this.getUniformLocation(n,t,"x3d_Material.shininess","x3d_FrontMaterial.shininess"),this.x3d_BaseColor=n.getUniformLocation(t,"x3d_Material.baseColor"),this.x3d_Metallic=n.getUniformLocation(t,"x3d_Material.metallic"),this.x3d_Roughness=n.getUniformLocation(t,"x3d_Material.roughness"),this.x3d_OcclusionStrength=n.getUniformLocation(t,"x3d_Material.occlusionStrength"),this.x3d_NormalScale=n.getUniformLocation(t,"x3d_Material.normalScale"),this.x3d_Transparency=this.getUniformLocation(n,t,"x3d_Material.transparency","x3d_FrontMaterial.transparency");const s=["x3d_AmbientTexture","x3d_DiffuseTexture","x3d_SpecularTexture","x3d_EmissiveTexture","x3d_ShininessTexture","x3d_BaseTexture","x3d_MetallicRoughnessTexture","x3d_OcclusionTexture","x3d_NormalTexture"];for(const e of s)this[e]={textureTransformMapping:n.getUniformLocation(t,e+".textureTransformMapping"),textureCoordinateMapping:n.getUniformLocation(t,e+".textureCoordinateMapping"),texture2D:n.getUniformLocation(t,e+".texture2D"),texture3D:n.getUniformLocation(t,e+".texture3D"),textureCube:n.getUniformLocation(t,e+".textureCube")};this.x3d_MultiTextureColor=n.getUniformLocation(t,"x3d_MultiTextureColor"),this.x3d_TexCoord.length=0;for(let e=0;e<r;++e){const i=this.getAttribLocation(n,t,"x3d_TexCoord"+e,e?"":"x3d_TexCoord");-1!==i&&this.x3d_TexCoord.push([e,i]),this.x3d_TextureMatrix[e]=n.getUniformLocation(t,"x3d_TextureMatrix["+e+"]"),this.x3d_TextureCoordinateGeneratorMode[e]=n.getUniformLocation(t,"x3d_TextureCoordinateGenerator["+e+"].mode"),this.x3d_TextureCoordinateGeneratorParameter[e]=n.getUniformLocation(t,"x3d_TextureCoordinateGenerator["+e+"].parameter"),this.x3d_Texture[e]={texture2D:n.getUniformLocation(t,"x3d_Texture2D["+e+"]"),texture3D:n.getUniformLocation(t,"x3d_Texture3D["+e+"]"),textureCube:this.getUniformLocation(n,t,"x3d_TextureCube["+e+"]","x3d_CubeMapTexture["+e+"]")},this.x3d_MultiTextureMode[e]=n.getUniformLocation(t,"x3d_MultiTexture["+e+"].mode"),this.x3d_MultiTextureAlphaMode[e]=n.getUniformLocation(t,"x3d_MultiTexture["+e+"].alphaMode"),this.x3d_MultiTextureSource[e]=n.getUniformLocation(t,"x3d_MultiTexture["+e+"].source"),this.x3d_MultiTextureFunction[e]=n.getUniformLocation(t,"x3d_MultiTexture["+e+"].function"),this.x3d_ProjectiveTexture[e]=n.getUniformLocation(t,"x3d_ProjectiveTexture["+e+"]"),this.x3d_ProjectiveTextureMatrix[e]=n.getUniformLocation(t,"x3d_ProjectiveTextureMatrix["+e+"]"),this.x3d_ProjectiveTextureLocation[e]=n.getUniformLocation(t,"x3d_ProjectiveTextureLocation["+e+"]")}this.x3d_TexCoordRamp=n.getUniformLocation(t,"x3d_TexCoordRamp"),this.x3d_Viewport=n.getUniformLocation(t,"x3d_Viewport"),this.x3d_ProjectionMatrix=n.getUniformLocation(t,"x3d_ProjectionMatrix"),this.x3d_ModelViewMatrix=n.getUniformLocation(t,"x3d_ModelViewMatrix"),this.x3d_NormalMatrix=n.getUniformLocation(t,"x3d_NormalMatrix"),this.x3d_CameraSpaceMatrix=n.getUniformLocation(t,"x3d_CameraSpaceMatrix");const a=["LineStipple","FogDepth","Color","Normal","Vertex","Particle","ParticleMatrix"];for(const e of a){const i=n.getAttribLocation(t,`x3d_${e}`);this[`x3d_${e}`]=i,i<0?(this[`enable${e}Attribute`]=Function.prototype,this[`${S_(e)}AttributeDivisor`]=Function.prototype):(delete this[`enable${e}Attribute`],delete this[`${S_(e)}AttributeDivisor`])}0===this.x3d_TexCoord.length?(this.enableTexCoordAttribute=Function.prototype,this.texCoordAttributeDivisor=Function.prototype):(delete this.enableTexCoordAttribute,delete this.texCoordAttributeDivisor),n.uniform1f(this.x3d_LineStippleScale,e.getLineStippleScale()),n.uniform1i(this.x3d_LinePropertiesTexture,e.getDefaultTexture2DUnit()),n.uniform1i(this.x3d_FillPropertiesTexture,e.getDefaultTexture2DUnit());for(const t of s)n.uniform1i(this[t].texture2D,e.getDefaultTexture2DUnit()),n.uniform1i(this[t].texture3D,e.getDefaultTexture3DUnit()),n.uniform1i(this[t].textureCube,e.getDefaultTextureCubeUnit());for(const t of this.x3d_Texture)n.uniform1i(t.texture2D,e.getDefaultTexture2DUnit()),n.getVersion()>=2&&n.uniform1i(t.texture3D,e.getDefaultTexture3DUnit()),n.uniform1i(t.textureCube,e.getDefaultTextureCubeUnit());for(const t of this.x3d_ShadowMap)n.uniform1i(t,e.getDefaultTexture2DUnit());for(const t of this.x3d_ProjectiveTexture)n.uniform1i(t,e.getDefaultTexture2DUnit());n.uniform1i(this.x3d_TexCoordRamp,e.getDefaultTexture2DUnit())},getUniformLocation:function(t,e,n,i){let o=t.getUniformLocation(e,n);return o||(i?(o=t.getUniformLocation(e,i),o&&console.warn(this.getTypeName(),this.getName(),"Using uniform location name '"+i+"' is depreciated, use '"+n+"'. See https://create3000.github.io/x_ite/custom-shaders."),o):0)},getAttribLocation:function(t,e,n,i){let o=t.getAttribLocation(e,n);return o>=0?o:i?(o=t.getAttribLocation(e,i),o>=0&&console.warn(this.getTypeName(),this.getName(),"Using attribute location name '"+i+"' is depreciated, use '"+n+"'. See https://create3000.github.io/x_ite/custom-shaders."),o):-1},addShaderFields:function(){const t=this.getProgram(),e=this.getBrowser().getContext();e.useProgram(t),this.textures.clear();for(const n of this.getUserDefinedFields()){const i=e.getUniformLocation(t,n.getName());if(i){switch(n.getType()){case c.SFImage:i.array=new Int32Array(3+n.array.length);break;case c.SFMatrix3d:case c.SFMatrix3f:case c.SFRotation:i.array=new Float32Array(9);break;case c.SFMatrix4d:case c.SFMatrix4f:i.array=new Float32Array(16);break;case c.SFNode:break;case c.MFBool:case c.MFInt32:i.array=new Int32Array(this.getLocationLength(e,t,n));break;case c.MFFloat:case c.MFDouble:case c.MFTime:i.array=new Float32Array(this.getLocationLength(e,t,n));break;case c.MFImage:i.array=new Int32Array(this.getImagesLength(n));break;case c.MFMatrix3d:case c.MFMatrix3f:case c.MFRotation:i.array=new Float32Array(9*this.getLocationLength(e,t,n));break;case c.MFMatrix4d:case c.MFMatrix4f:i.array=new Float32Array(16*this.getLocationLength(e,t,n));break;case c.MFNode:{const o=i.locations=[];for(let i=0;;++i){const r=e.getUniformLocation(t,n.getName()+"["+i+"]");if(!r)break;o.push(r)}break}case c.MFVec2d:case c.MFVec2f:i.array=new Float32Array(2*this.getLocationLength(e,t,n));break;case c.MFVec3d:case c.MFVec3f:case c.MFColor:i.array=new Float32Array(3*this.getLocationLength(e,t,n));break;case c.MFVec4d:case c.MFVec4f:case c.MFColorRGBA:i.array=new Float32Array(4*this.getLocationLength(e,t,n))}i.array?n[y_]=i.array.length?i:null:n[y_]=i,n.addInterest("set_field__",this),this.set_field__(n)}}},removeShaderFields:function(){for(const t of this.getUserDefinedFields())t.removeInterest("set_field__",this)},set_field__:function(){const t=new Float32Array(9);return function(e){const n=this.getProgram(),i=this.getBrowser().getContext(),o=e[y_];if(i.useProgram(n),o)switch(e.getType()){case c.SFBool:case c.SFInt32:return void i.uniform1i(o,e.getValue());case c.SFColor:{const t=e.getValue();return void i.uniform3f(o,t.r,t.g,t.b)}case c.SFColorRGBA:{const t=e.getValue();return void i.uniform4f(o,t.r,t.g,t.b,t.a)}case c.SFDouble:case c.SFFloat:case c.SFTime:return void i.uniform1f(o,e.getValue());case c.SFImage:{let t=o.array;const n=e.array,r=3+n.length;r!==t.length&&(t=o.array=new Int32Array(r)),t[0]=e.width,t[1]=e.height,t[2]=e.comp;for(let e=3,i=0,o=n.length;i<o;++i,++e)t[e]=n[i];return void i.uniform1iv(o,t)}case c.SFMatrix3d:case c.SFMatrix3f:return o.array.set(e.getValue()),void i.uniformMatrix3fv(o,!1,o.array);case c.SFMatrix4d:case c.SFMatrix4f:return o.array.set(e.getValue()),void i.uniformMatrix4fv(o,!1,o.array);case c.SFNode:{const t=nu(c.X3DTextureNode,e);return void(t?(o.name=e.getName(),o.texture=t,this.textures.add(o)):this.textures.delete(o))}case c.SFRotation:return e.getValue().getMatrix(o.array),void i.uniformMatrix3fv(o,!1,o.array);case c.SFString:return;case c.SFVec2d:case c.SFVec2f:{const t=e.getValue();return void i.uniform2f(o,t.x,t.y)}case c.SFVec3d:case c.SFVec3f:{const t=e.getValue();return void i.uniform3f(o,t.x,t.y,t.z)}case c.SFVec4d:case c.SFVec4f:{const t=e.getValue();return void i.uniform4f(o,t.x,t.y,t.z,t.w)}case c.MFBool:case c.MFInt32:{const t=o.array;for(var r=0,s=e.length;r<s;++r)t[r]=e[r];for(let e=t.length;r<e;++r)t[r]=0;return void i.uniform1iv(o,t)}case c.MFColor:{const t=o.array;r=0;var a=0;for(s=e.length;r<s;++r){const n=e[r];t[a++]=n.r,t[a++]=n.g,t[a++]=n.b}for(let e=t.length;a<e;++a)t[a]=0;return void i.uniform3fv(o,t)}case c.MFColorRGBA:{const t=o.array;for(r=0,a=0,s=e.length;r<s;++r){const n=e[r];t[a++]=n.r,t[a++]=n.g,t[a++]=n.b,t[a++]=n.a}for(let e=t.length;a<e;++a)t[a]=0;return void i.uniform4fv(o,t)}case c.MFDouble:case c.MFFloat:case c.MFTime:{const t=o.array;for(r=0,s=e.length;r<s;++r)t[r]=e[r];for(let e=t.length;r<e;++r)t[r]=0;return void i.uniform1fv(o,t)}case c.MFImage:{const t=o.array;for(let n=0,i=0,o=e.length;n<o;++n){const o=e[n],r=o.array;t[i++]=o.width,t[i++]=o.height,t[i++]=o.comp;for(let e=0,n=r.length;e<n;++e)t[i++]=r[e]}return void i.uniform1iv(o,t)}case c.MFMatrix3d:case c.MFMatrix3f:{const t=o.array;for(r=0,a=0,s=e.length;r<s;++r){const n=e[r];for(let e=0;e<9;++e)t[a++]=n[e]}for(let e=t.length;a<e;++a)t[a]=0;return void i.uniformMatrix3fv(o,!1,t)}case c.MFMatrix4d:case c.MFMatrix4f:{const t=o.array;for(r=0,a=0,s=e.length;r<s;++r){const n=e[r];for(let e=0;e<16;++e)t[a++]=n[e]}for(let e=t.length;a<e;++a)t[a]=0;return void i.uniformMatrix4fv(o,!1,t)}case c.MFNode:{const t=o.locations;for(let n=0,i=e.length;n<i;++n){const i=nu(c.X3DTextureNode,e[n]);i?(t[n].name=e.getName(),t[n].texture=i,this.textures.add(t[n])):this.textures.delete(t[n])}return}case c.MFRotation:{const n=o.array;for(r=0,a=0,s=e.length;r<s;++r)e[r].getValue().getMatrix(t),n[a++]=t[0],n[a++]=t[1],n[a++]=t[2],n[a++]=t[3],n[a++]=t[4],n[a++]=t[5],n[a++]=t[6],n[a++]=t[7],n[a++]=t[8];for(let t=n.length;a<t;++a)n[a]=0;return void i.uniformMatrix3fv(o,!1,n)}case c.MFString:return;case c.MFVec2d:case c.MFVec2f:{const t=o.array;for(r=0,a=0,s=e.length;r<s;++r){const n=e[r];t[a++]=n.x,t[a++]=n.y}for(let e=t.length;a<e;++a)t[a]=0;return void i.uniform2fv(o,t)}case c.MFVec3d:case c.MFVec3f:{const t=o.array;for(r=0,a=0,s=e.length;r<s;++r){const n=e[r];t[a++]=n.x,t[a++]=n.y,t[a++]=n.z}for(let e=t.length;a<e;++a)t[a]=0;return void i.uniform3fv(o,t)}case c.MFVec4d:case c.MFVec4f:{const t=o.array;for(r=0,a=0,s=e.length;r<s;++r){const n=e[r];t[a++]=n.x,t[a++]=n.y,t[a++]=n.z,t[a++]=n.w}for(let e=t.length;a<e;++a)t[a]=0;return void i.uniform4fv(o,t)}}}}(),getImagesLength:function(t){const e=t.getValue();let n=3*e.length;for(const t of e)n+=t.array.length;return n},getLocationLength:function(t,e,n){const i=n.getName();for(let n=0;;++n){if(!t.getUniformLocation(e,i+"["+n+"]"))return n}},hasFog:function(t){return this.fogNode===t||(this.fogNode=t,!1)},hasLight:function(t,e){return this.lightNodes[t]===e||(this.lightNodes[t]=e,!1)},hasTextureProjector:function(t,e){return this.projectiveTextureNodes[t]===e||(this.projectiveTextureNodes[t]=e,!1)},setClipPlanes:function(t,e){this.numClipPlanes=0;for(const n of e)n.setShaderUniforms(t,this)},setUniforms:function(){const t=new Float32Array(9);return function(e,n,i,o=!0){const r=i.renderObject,s=i.fogNode,a=i.appearanceNode,u=a.getStyleProperties(n.geometryType),c=o?a.getMaterial():a.getBackMaterial(),l=i.textureNode||a.getTexture(),h=i.modelViewMatrix;if(this.renderTime!==r.getRenderTime()){this.renderTime=r.getRenderTime(),e.uniform4iv(this.x3d_Viewport,r.getViewportArray()),e.uniformMatrix4fv(this.x3d_ProjectionMatrix,!1,r.getProjectionMatrixArray()),e.uniformMatrix4fv(this.x3d_CameraSpaceMatrix,!1,r.getCameraSpaceMatrixArray()),this.fogNode=null,this.numLights=0,this.numProjectiveTextures=0,this.lightNodes.length=0,this.projectiveTextureNodes.length=0;const t=r.getGlobalObjects();for(const n of t)n.setShaderUniforms(e,this,r);this.numGlobalLights=this.numLights,this.numGlobalProjectiveTextures=this.numProjectiveTextures;const n=r.getViewpoint();if(this.logarithmicDepthBuffer||n.getLogarithmicDepthBuffer()){const t=r.getNavigationInfo();e.uniform1f(this.x3d_LogarithmicFarFactor1_2,1/Math.log2(t.getFarValue(n)+1))}}e.uniformMatrix4fv(this.x3d_ModelViewMatrix,!1,h),n.hasNormals&&(t[0]=h[0],t[3]=h[1],t[6]=h[2],t[1]=h[4],t[4]=h[5],t[7]=h[6],t[2]=h[8],t[5]=h[9],t[8]=h[10],Ie.prototype.inverse.call(t),e.uniformMatrix3fv(this.x3d_NormalMatrix,!1,t)),s&&s.setShaderUniforms(e,this),this.numClipPlanes=0,this.numLights=this.numGlobalLights,this.numProjectiveTextures=this.numGlobalProjectiveTextures;for(const t of i.localObjects)t.setShaderUniforms(e,this,r);e.uniform1f(this.x3d_AlphaCutoff,a.getAlphaCutoff()),u&&u.setShaderUniforms(e,this),c.setShaderUniforms(e,this,r,a.getTextureTransformMapping(),n.getTextureCoordinateMapping(),o),l&&l.setShaderUniforms(e,this,r),a.getTextureTransform().setShaderUniforms(e,this),n.getTextureCoordinate().setShaderUniforms(e,this)}}(),enable:function(t){t.useProgram(this.getProgram());for(const e of this.textures){const n=e.texture,i=this.getBrowser().getTextureUnit(n.getTextureType());if(void 0===i)return void console.warn("Not enough combined texture units for uniform variable '"+e.name+"' available.");t.activeTexture(t.TEXTURE0+i),t.bindTexture(n.getTarget(),n.getTexture()),t.uniform1i(e,i)}},enableFloatAttrib:function(t,e,n,i,o,r){const s=t.getAttribLocation(this.getProgram(),e);-1!==s&&(t.bindBuffer(t.ARRAY_BUFFER,n),t.enableVertexAttribArray(s),t.vertexAttribPointer(s,i,t.FLOAT,!1,o,r))},enableMatrix3Attrib:function(t,e,n,i,o){const r=t.getAttribLocation(this.getProgram(),e);if(-1!==r){i=i||36,t.bindBuffer(t.ARRAY_BUFFER,n);for(let e=0;e<3;++e){const n=r+e;t.enableVertexAttribArray(n),t.vertexAttribPointer(n,3,t.FLOAT,!1,i,o+12*e)}}},enableMatrix4Attrib:function(t,e,n,i,o){const r=t.getAttribLocation(this.getProgram(),e);if(-1!==r){i=i||64,t.bindBuffer(t.ARRAY_BUFFER,n);for(let e=0;e<4;++e){const n=r+e;t.enableVertexAttribArray(n),t.vertexAttribPointer(n,4,t.FLOAT,!1,i,o+16*e)}}},enableLineStippleAttribute:function(t,e,n,i){const o=this.x3d_LineStipple;t.bindBuffer(t.ARRAY_BUFFER,e),t.enableVertexAttribArray(o),t.vertexAttribPointer(o,3,t.FLOAT,!1,n,i)},enableFogDepthAttribute:function(t,e,n,i){const o=this.x3d_FogDepth;t.bindBuffer(t.ARRAY_BUFFER,e),t.enableVertexAttribArray(o),t.vertexAttribPointer(o,1,t.FLOAT,!1,n,i)},enableColorAttribute:function(t,e,n,i){const o=this.x3d_Color;t.bindBuffer(t.ARRAY_BUFFER,e),t.enableVertexAttribArray(o),t.vertexAttribPointer(o,4,t.FLOAT,!1,n,i)},colorAttributeDivisor:function(t,e){t.vertexAttribDivisor(this.x3d_Color,e)},enableTexCoordAttribute:function(t,e,n,i){for(const[o,r]of this.x3d_TexCoord)t.bindBuffer(t.ARRAY_BUFFER,e[o]),t.enableVertexAttribArray(r),t.vertexAttribPointer(r,4,t.FLOAT,!1,n,i)},texCoordAttributeDivisor:function(t,e){for(const[n,i]of this.x3d_TexCoord)t.vertexAttribDivisor(i,e)},enableNormalAttribute:function(t,e,n,i){const o=this.x3d_Normal;t.bindBuffer(t.ARRAY_BUFFER,e),t.enableVertexAttribArray(o),t.vertexAttribPointer(o,3,t.FLOAT,!1,n,i)},normalAttributeDivisor:function(t,e){t.vertexAttribDivisor(this.x3d_Normal,e)},enableVertexAttribute:function(t,e,n,i){const o=this.x3d_Vertex;t.bindBuffer(t.ARRAY_BUFFER,e),t.enableVertexAttribArray(o),t.vertexAttribPointer(o,4,t.FLOAT,!1,n,i)},vertexAttributeDivisor:function(t,e){t.vertexAttribDivisor(this.x3d_Vertex,e)},enableParticleAttribute:function(t,e,n,i,o){const r=this.x3d_Particle;t.bindBuffer(t.ARRAY_BUFFER,e),t.enableVertexAttribArray(r),t.vertexAttribPointer(r,4,t.FLOAT,!1,n,i),t.vertexAttribDivisor(r,o)},enableParticleMatrixAttribute:function(t,e,n,i,o){const r=this.x3d_ParticleMatrix;n=n||64,t.bindBuffer(t.ARRAY_BUFFER,e);for(let e=0;e<4;++e){const s=r+e;t.enableVertexAttribArray(s),t.vertexAttribPointer(s,4,t.FLOAT,!1,n,i+16*e),t.vertexAttribDivisor(s,o)}},getProgramInfo:function(){function t(t,e){return t<e?-1:t>e?1:0}const e=this.getProgram(),n=this.getBrowser().getContext(),i={attributes:[],uniforms:[],attributeCount:0,uniformCount:0},o=n.getProgramParameter(e,n.ACTIVE_UNIFORMS),r=n.getProgramParameter(e,n.ACTIVE_ATTRIBUTES),s={35664:"vec2",35665:"vec3",35666:"vec4",35667:"ivec2",35668:"ivec3",35669:"ivec4",35670:"bool",35671:"bvec2",35672:"bvec3",35673:"bvec4",35674:"mat2",35675:"mat3",35676:"mat4",35678:"sampler2D",35680:"samplerCube",5120:"byte",5121:"ubyte",5122:"short",5123:"ushort",5124:"int",5125:"uint",5126:"float"};for(let t=0;t<o;++t){const o=n.getActiveUniform(e,t);o.typeName=s[o.type],i.uniforms.push(Object.assign({},o)),i.uniformCount+=o.size}for(let t=0;t<r;++t){const o=n.getActiveAttrib(e,t);o.typeName=s[o.type],i.attributes.push(Object.assign({},o)),i.attributeCount+=o.size}return i.uniforms.sort((function(e,n){return t(e.name,n.name)})),i.attributes.sort((function(e,n){return t(e.name,n.name)})),i},printProgramInfo:function(){const t=this.getProgramInfo();console.log(this.getName()),console.table(t.attributes),console.log(this.getName(),"attributeCount",t.attributeCount),console.log(this.getName()),console.table(t.uniforms),console.log(this.getName(),"uniformCount",t.uniformCount)},dispose:function(){}};const T_=w_;n.set("x_ite/Components/Shaders/X3DProgrammableShaderObject",T_);const b_=T_;function v_(t){Tu.call(this,t),this.addType(c.X3DNetworkSensorNode)}v_.prototype=Object.assign(Object.create(Tu.prototype),{constructor:v_});const C_=v_;n.set("x_ite/Components/Networking/X3DNetworkSensorNode",C_);const E_=C_;function O_(t){E_.call(this,t),this.addType(c.LoadSensor),this.urlObjects=[],this.aborted=!1,this.timeOutId=void 0,this.addAlias("watchList",this._children)}O_.prototype=Object.assign(Object.create(E_.prototype),{constructor:O_,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new Y([new B(c.inputOutput,"metadata",new Ri.SFNode),new B(c.inputOutput,"enabled",new Ri.SFBool(!0)),new B(c.inputOutput,"timeOut",new Ri.SFTime),new B(c.outputOnly,"isActive",new Ri.SFBool),new B(c.outputOnly,"isLoaded",new Ri.SFBool),new B(c.outputOnly,"progress",new Ri.SFFloat),new B(c.outputOnly,"loadTime",new Ri.SFTime),new B(c.inputOutput,"children",new Ri.MFNode)]),getTypeName:function(){return"LoadSensor"},getComponentName:function(){return"Networking"},getContainerField:function(){return"children"},initialize:function(){E_.prototype.initialize.call(this),this._enabled.addInterest("set_enabled__",this),this._timeOut.addInterest("set_timeOut__",this),this._children.addInterest("set_children__",this),this.set_children__()},set_enabled__:function(){this._enabled.getValue()?this.reset():(this.abort(),this.remove())},set_timeOut__:function(){this._isActive.getValue()&&(this.clearTimeout(),this.aborted=!1,this._timeOut.getValue()>0&&(this.timeOutId=setTimeout(this.abort.bind(this),1e3*this._timeOut.getValue())))},set_children__:function(){this.reset()},set_loadState__:function(t){switch(t.checkLoadState()){case c.NOT_STARTED_STATE:break;case c.IN_PROGRESS_STATE:case c.COMPLETE_STATE:case c.FAILED_STATE:this.count()}},count:function(){const t=this.urlObjects;let e=0,n=0;for(const i of t)e+=i.checkLoadState()==c.COMPLETE_STATE,n+=i.checkLoadState()==c.FAILED_STATE;const i=e==t.length,o=e/t.length;this.aborted||n||i?(this.clearTimeout(),this._isActive=!1,this._isLoaded=i,this._progress=o,i&&(this._loadTime=this.getBrowser().getCurrentTime())):this._isActive.getValue()?this._progress=o:(this._isActive=!0,this._progress=o,this.set_timeOut__())},abort:function(){this.clearTimeout(),this.aborted=!0,this._enabled.getValue()&&this.count()},reset:function(){if(this.remove(),!this._enabled.getValue())return;const t=this.urlObjects;for(const e of this._children){const n=nu(c.X3DUrlObject,e);n&&(t.push(n),n._loadState.addInterest("set_loadState__",this,n))}this.count()},remove:function(){this.clearTimeout();const t=this.urlObjects;for(const e of t)e._loadState.removeInterest("set_loadState__",this);t.length=0},clearTimeout:function(){clearTimeout(this.timeOutId),this.timeOutId=void 0}});const N_=O_;n.set("x_ite/Components/Networking/LoadSensor",N_);const F_=N_;function I_(t){x_.call(this,t),b_.call(this,t),this.addType(c.ComposedShader),this.loadSensor=new F_(t),this.transformFeedbackVaryings=[]}I_.prototype=Object.assign(Object.create(x_.prototype),b_.prototype,{constructor:I_,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new Y([new B(c.inputOutput,"metadata",new Ri.SFNode),new B(c.inputOnly,"activate",new Ri.SFBool),new B(c.outputOnly,"isSelected",new Ri.SFBool),new B(c.outputOnly,"isValid",new Ri.SFBool),new B(c.initializeOnly,"language",new Ri.SFString),new B(c.inputOutput,"parts",new Ri.MFNode)]),wireframe:!1,getTypeName:function(){return"ComposedShader"},getComponentName:function(){return"Shaders"},getContainerField:function(){return"shaders"},initialize:function(){x_.prototype.initialize.call(this),b_.prototype.initialize.call(this),this.isLive().addInterest("set_live__",this),this._activate.addInterest("set_activate__",this),this._parts.addFieldInterest(this.loadSensor._watchList),this.loadSensor._isLoaded.addInterest("connectLoaded",this),this.loadSensor._watchList=this._parts,this.loadSensor.setPrivate(!0),this.loadSensor.setup(),this.loadSensor._isLoaded.getValue()?this.set_loaded__():this.connectLoaded()},connectLoaded:function(){this.loadSensor._isLoaded.removeInterest("connectLoaded",this),this.loadSensor._isLoaded.addInterest("set_loaded__",this)},addUserDefinedField:function(t,e,n){const i=this.isInitialized()&&this.isLive().getValue()&&this.isValid();i&&this.removeShaderFields(),x_.prototype.addUserDefinedField.call(this,t,e,n),i&&this.addShaderFields()},removeUserDefinedField:function(t){const e=this.isInitialized()&&this.isLive().getValue()&&this.isValid();e&&this.removeShaderFields(),x_.prototype.removeUserDefinedField.call(this,t),e&&this.addShaderFields()},setTransformFeedbackVaryings:function(t){this.transformFeedbackVaryings=t},getProgram:function(){return this.program},set_live__:function(){this.isLive().getValue()?this.isValid()&&this.addShaderFields():this.isValid()&&this.removeShaderFields()},set_activate__:function(){this._activate.getValue()&&this.set_loaded__()},set_loaded__:function(){if(this.loadSensor._isLoaded.getValue()&&"GLSL"===this._language.getValue()){const t=this.getBrowser().getContext(),e=t.createProgram();this.isValid()&&this.removeShaderFields(),t.deleteProgram(this.program),this.program=e;for(const n of this._parts){const i=nu(c.ShaderPart,n);i&&t.attachShader(e,i.getShader())}this.transformFeedbackVaryings.length&&t.transformFeedbackVaryings(e,this.transformFeedbackVaryings,t.INTERLEAVED_ATTRIBS),t.linkProgram(e),t.getProgramParameter(e,t.LINK_STATUS)?(this.setValid(!0),this.getDefaultUniformsAndAttributes(),this.addShaderFields()):(this.setValid(!1),this._parts.length&&console.warn("Couldn't initialize "+this.getTypeName()+" '"+this.getName()+"': "+t.getProgramInfoLog(e)))}else this.setValid(!1)},dispose:function(){this.getBrowser().getContext().deleteProgram(this.program),b_.prototype.dispose.call(this),x_.prototype.dispose.call(this)}});const M_=I_;n.set("x_ite/Components/Shaders/ComposedShader",M_);const D_=M_,V_="\n#if defined (X3D_FOG)\nstruct x3d_FogParameters {\n   mediump int   type;\n   mediump vec3  color;\n   mediump float visibilityRange;\n   mediump mat3  matrix;\n};\n#endif\n\n//uniform x3d_FogParameters x3d_Fog;\n\n#if defined (X3D_LIGHTING)\nstruct x3d_LightSourceParameters {\n   mediump int   type;\n   mediump vec3  color;\n   mediump float intensity;\n   mediump float ambientIntensity;\n   mediump vec3  attenuation;\n   mediump vec3  location;\n   mediump vec3  direction;\n   mediump float radius;\n   mediump float beamWidth;\n   mediump float cutOffAngle;\n   mediump mat3  matrix;\n   #if defined (X3D_SHADOWS)\n   mediump vec3  shadowColor;\n   mediump float shadowIntensity;\n   mediump float shadowBias;\n   mediump mat4  shadowMatrix;\n   mediump int   shadowMapSize;\n   #endif\n};\n#endif\n\n//uniform x3d_LightSourceParameters x3d_LightSource [x3d_MaxLights];\n\n#if defined (X3D_GEOMETRY_0D) && defined (X3D_STYLE_PROPERTIES)\nstruct x3d_PointPropertiesParameters\n{\n   mediump float pointSizeScaleFactor;\n   mediump float pointSizeMinValue;\n   mediump float pointSizeMaxValue;\n   mediump vec3  attenuation;\n};\n#endif\n\n//uniform x3d_PointPropertiesParameters x3d_PointProperties;\n\n#if defined (X3D_GEOMETRY_1D) && defined (X3D_STYLE_PROPERTIES)\nstruct x3d_LinePropertiesParameters\n{\n   bool          applied;\n   mediump int   linetype;\n   mediump float lineStippleScale;\n   sampler2D     texture;\n};\n#endif\n\n//uniform x3d_LinePropertiesParameters x3d_LineProperties;\n\n#if (defined (X3D_GEOMETRY_2D) || defined (X3D_GEOMETRY_3D)) && defined (X3D_STYLE_PROPERTIES)\nstruct x3d_FillPropertiesParameters\n{\n   bool         filled;\n   bool         hatched;\n   mediump vec3 hatchColor;\n   sampler2D    texture;\n};\n#endif\n\n//uniform x3d_FillPropertiesParameters x3d_FillProperties;\n\n#if defined (X3D_UNLIT_MATERIAL)\nstruct x3d_UnlitMaterialParameters\n{\n   mediump vec3  emissiveColor;\n   mediump float normalScale;\n   mediump float transparency;\n};\n#endif\n\n//uniform x3d_UnlitMaterialParameters x3d_Material;\n\n#if defined (X3D_MATERIAL)\nstruct x3d_MaterialParameters\n{\n   mediump float ambientIntensity;\n   mediump vec3  diffuseColor;\n   mediump vec3  specularColor;\n   mediump vec3  emissiveColor;\n   mediump float shininess;\n   mediump float occlusionStrength;\n   mediump float normalScale;\n   mediump float transparency;\n};\n#endif\n\n//uniform x3d_MaterialParameters x3d_Material;\n\n#if defined (X3D_PHYSICAL_MATERIAL)\nstruct x3d_PhysicalMaterialParameters\n{\n   mediump vec3  baseColor;\n   mediump vec3  emissiveColor;\n   mediump float metallic;\n   mediump float roughness;\n   mediump float occlusionStrength;\n   mediump float normalScale;\n   mediump float transparency;\n};\n#endif\n\n//uniform x3d_PhysicalMaterialParameters x3d_Material;\n\n#if defined (X3D_AMBIENT_TEXTURE)\nstruct x3d_AmbientTextureParameters\n{\n   mediump int         textureTransformMapping;\n   mediump int         textureCoordinateMapping;\n   #if defined (X3D_AMBIENT_TEXTURE_2D)\n   mediump sampler2D   texture2D;\n   #endif\n   #if defined (X3D_AMBIENT_TEXTURE_3D) && __VERSION__ != 100\n   mediump sampler3D   texture3D;\n   #endif\n   #if defined (X3D_AMBIENT_TEXTURE_CUBE)\n   mediump samplerCube textureCube;\n   #endif\n};\n#endif\n\n//uniform x3d_AmbientTextureParameters x3d_AmbientTexture;\n\n#if defined (X3D_DIFFUSE_TEXTURE)\nstruct x3d_DiffuseTextureParameters\n{\n   mediump int         textureTransformMapping;\n   mediump int         textureCoordinateMapping;\n   #if defined (X3D_DIFFUSE_TEXTURE_2D)\n   mediump sampler2D   texture2D;\n   #endif\n   #if defined (X3D_DIFFUSE_TEXTURE_3D) && __VERSION__ != 100\n   mediump sampler3D   texture3D;\n   #endif\n   #if defined (X3D_DIFFUSE_TEXTURE_CUBE)\n   mediump samplerCube textureCube;\n   #endif\n};\n#endif\n\n//uniform x3d_DiffuseTextureParameters x3d_DiffuseTexture;\n\n#if defined (X3D_SPECULAR_TEXTURE)\nstruct x3d_SpecularTextureParameters\n{\n   mediump int         textureTransformMapping;\n   mediump int         textureCoordinateMapping;\n   #if defined (X3D_SPECULAR_TEXTURE_2D)\n   mediump sampler2D   texture2D;\n   #endif\n   #if defined (X3D_SPECULAR_TEXTURE_3D) && __VERSION__ != 100\n   mediump sampler3D   texture3D;\n   #endif\n   #if defined (X3D_SPECULAR_TEXTURE_CUBE)\n   mediump samplerCube textureCube;\n   #endif\n};\n#endif\n\n//uniform x3d_SpecularTextureParameters x3d_SpecularTexture;\n\n#if defined (X3D_EMISSIVE_TEXTURE)\nstruct x3d_EmissiveTextureParameters\n{\n   mediump int         textureTransformMapping;\n   mediump int         textureCoordinateMapping;\n   #if defined (X3D_EMISSIVE_TEXTURE_2D)\n   mediump sampler2D   texture2D;\n   #endif\n   #if defined (X3D_EMISSIVE_TEXTURE_3D) && __VERSION__ != 100\n   mediump sampler3D   texture3D;\n   #endif\n   #if defined (X3D_EMISSIVE_TEXTURE_CUBE)\n   mediump samplerCube textureCube;\n   #endif\n};\n#endif\n\n//uniform x3d_EmissiveTextureParameters x3d_EmissiveTexture;\n\n#if defined (X3D_SHININESS_TEXTURE)\nstruct x3d_ShininessTextureParameters\n{\n   mediump int         textureTransformMapping;\n   mediump int         textureCoordinateMapping;\n   #if defined (X3D_SHININESS_TEXTURE_2D)\n   mediump sampler2D   texture2D;\n   #endif\n   #if defined (X3D_SHININESS_TEXTURE_3D) && __VERSION__ != 100\n   mediump sampler3D   texture3D;\n   #endif\n   #if defined (X3D_SHININESS_TEXTURE_CUBE)\n   mediump samplerCube textureCube;\n   #endif\n};\n#endif\n\n//uniform x3d_ShininessTextureParameters x3d_ShininessTexture;\n\n#if defined (X3D_BASE_TEXTURE)\nstruct x3d_BaseTextureParameters\n{\n   mediump int         textureTransformMapping;\n   mediump int         textureCoordinateMapping;\n   #if defined (X3D_BASE_TEXTURE_2D)\n   mediump sampler2D   texture2D;\n   #endif\n   #if defined (X3D_BASE_TEXTURE_3D) && __VERSION__ != 100\n   mediump sampler3D   texture3D;\n   #endif\n   #if defined (X3D_BASE_TEXTURE_CUBE)\n   mediump samplerCube textureCube;\n   #endif\n};\n#endif\n\n//uniform x3d_BaseTextureParameters x3d_BaseTexture;\n\n#if defined (X3D_METALLIC_ROUGHNESS_TEXTURE)\nstruct x3d_MetallicRoughnessTextureParameters\n{\n   mediump int         textureTransformMapping;\n   mediump int         textureCoordinateMapping;\n   #if defined (X3D_METALLIC_ROUGHNESS_TEXTURE_2D)\n   mediump sampler2D   texture2D;\n   #endif\n   #if defined (X3D_METALLIC_ROUGHNESS_TEXTURE_3D) && __VERSION__ != 100\n   mediump sampler3D   texture3D;\n   #endif\n   #if defined (X3D_METALLIC_ROUGHNESS_TEXTURE_CUBE)\n   mediump samplerCube textureCube;\n   #endif\n};\n#endif\n\n//uniform x3d_MetallicRoughnessTextureParameters x3d_MetallicRoughnessTexture;\n\n#if defined (X3D_OCCLUSION_TEXTURE)\nstruct x3d_OcclusionTextureParameters\n{\n   mediump int         textureTransformMapping;\n   mediump int         textureCoordinateMapping;\n   #if defined (X3D_OCCLUSION_TEXTURE_2D)\n   mediump sampler2D   texture2D;\n   #endif\n   #if defined (X3D_OCCLUSION_TEXTURE_3D) && __VERSION__ != 100\n   mediump sampler3D   texture3D;\n   #endif\n   #if defined (X3D_OCCLUSION_TEXTURE_CUBE)\n   mediump samplerCube textureCube;\n   #endif\n};\n#endif\n\n//uniform x3d_OcclusionTextureParameters x3d_OcclusionTexture;\n\n#if defined (X3D_NORMAL_TEXTURE)\nstruct x3d_NormalTextureParameters\n{\n   mediump int         textureTransformMapping;\n   mediump int         textureCoordinateMapping;\n   #if defined (X3D_NORMAL_TEXTURE_2D)\n   mediump sampler2D   texture2D;\n   #endif\n   #if defined (X3D_NORMAL_TEXTURE_3D) && __VERSION__ != 100\n   mediump sampler3D   texture3D;\n   #endif\n   #if defined (X3D_NORMAL_TEXTURE_CUBE)\n   mediump samplerCube textureCube;\n   #endif\n};\n#endif\n\n//uniform x3d_NormalTextureParameters x3d_NormalTexture;\n\n#if defined (X3D_MULTI_TEXTURING)\nstruct x3d_MultiTextureParameters\n{\n   mediump int mode;\n   mediump int alphaMode;\n   mediump int source;\n   mediump int function;\n};\n#endif\n\n//uniform x3d_MultiTextureParameters x3d_MultiTexture [x3d_MaxTextures];\n\n#if defined (X3D_TEXTURE) || defined (X3D_MATERIAL_TEXTURES)\nstruct x3d_TextureCoordinateGeneratorParameters\n{\n   mediump int   mode;\n   mediump float parameter [6];\n};\n#endif\n\n//uniform x3d_TextureCoordinateGeneratorParameters x3d_TextureCoordinateGenerator [x3d_MaxTextures];\n";n.set("assets/shaders/Types.glsl",V_);const R_=V_;let P_=0;const A_={REPLACE:P_++,MODULATE:P_++,MODULATE2X:P_++,MODULATE4X:P_++,ADD:P_++,ADDSIGNED:P_++,ADDSIGNED2X:P_++,ADDSMOOTH:P_++,SUBTRACT:P_++,BLENDDIFFUSEALPHA:P_++,BLENDTEXTUREALPHA:P_++,BLENDFACTORALPHA:P_++,BLENDCURRENTALPHA:P_++,MODULATEALPHA_ADDCOLOR:P_++,MODULATEINVALPHA_ADDCOLOR:P_++,MODULATEINVCOLOR_ADDALPHA:P_++,DOTPRODUCT3:P_++,SELECTARG1:P_++,SELECTARG2:P_++,OFF:P_++};n.set("x_ite/Browser/Texturing/ModeType",A_);const L_=A_;let B_=0;const X_={DEFAULT:B_++,DIFFUSE:B_++,SPECULAR:B_++,FACTOR:B_++};n.set("x_ite/Browser/Texturing/SourceType",X_);const U_=X_;let k_=0;const z_={DEFAULT:k_++,COMPLEMENT:k_++,ALPHAREPLICATE:k_++};n.set("x_ite/Browser/Texturing/FunctionType",z_);const j_=z_;let G_=0;const H_={NONE:G_++,SPHERE:G_++,CAMERASPACENORMAL:G_++,CAMERASPACEPOSITION:G_++,CAMERASPACEREFLECTIONVECTOR:G_++,SPHERE_LOCAL:G_++,COORD:G_++,COORD_EYE:G_++,NOISE:G_++,NOISE_EYE:G_++,SPHERE_REFLECT:G_++,SPHERE_REFLECT_LOCAL:G_++};n.set("x_ite/Browser/Texturing/TextureCoordinateGeneratorModeType",H_);const q_=H_,Y_={getSource:function(t,e,n,i){const o="\\s+|/\\*[\\s\\S]*?\\*/|//.*?\\n",r="#line\\s+.*?\\n|#if\\s+.*?\\n|#elif\\s+.*?\\n|#ifdef\\s+.*?\\n|#ifndef\\s+.*?\\n|#else.*?\\n|#endif.*?\\n|#define\\s+(?:[^\\n\\\\]|\\\\[^\\r\\n]|\\\\\\r?\\n)*\\n|#undef\\s+.*?\\n|#pragma\\s+.*?\\n",s=new RegExp("^((?:"+o+"|"+r+")*(?:#version\\s+.*?\\n)?(?:"+o+"|"+r+"|#extension\\s+.*?\\n)*)([\\s\\S]*)$"),a=n.match(s);if(!a)return n;let u="";u+="#define X_ITE\n",t.HAS_FEATURE_DEPTH_TEXTURE&&(u+="#define X3D_DEPTH_TEXTURE\n");for(const t of i)u+="#define "+t+"\n";let c="";c+="#define x3d_None 0\n",c+="#define x3d_Points      0\n",c+="#define x3d_Lines       1\n",c+="#define x3d_Geometry2D  2\n",c+="#define x3d_Geometry3D  3\n",c+="#define x3d_MaxClipPlanes  "+e.getMaxClipPlanes()+"\n",c+="#define x3d_LinearFog        1\n",c+="#define x3d_ExponentialFog   2\n",c+="#define x3d_Exponential2Fog  3\n",c+="#define x3d_MaxLights         "+e.getMaxLights()+"\n",c+="#define x3d_DirectionalLight  1\n",c+="#define x3d_PointLight        2\n",c+="#define x3d_SpotLight         3\n",c+="#define x3d_MaxTextures      "+e.getMaxTextures()+"\n",c+="#define x3d_TextureType2D    2\n",c+="#define x3d_TextureType3D    3\n",c+="#define x3d_TextureTypeCube  4\n",c+="#define x3d_Replace                   "+L_.REPLACE+"\n",c+="#define x3d_Modulate                  "+L_.MODULATE+"\n",c+="#define x3d_Modulate2X                "+L_.MODULATE2X+"\n",c+="#define x3d_Modulate4X                "+L_.MODULATE4X+"\n",c+="#define x3d_Add                       "+L_.ADD+"\n",c+="#define x3d_AddSigned                 "+L_.ADDSIGNED+"\n",c+="#define x3d_AddSigned2X               "+L_.ADDSIGNED2X+"\n",c+="#define x3d_AddSmooth                 "+L_.ADDSMOOTH+"\n",c+="#define x3d_Subtract                  "+L_.SUBTRACT+"\n",c+="#define x3d_BlendDiffuseAlpha         "+L_.BLENDDIFFUSEALPHA+"\n",c+="#define x3d_BlendTextureAlpha         "+L_.BLENDTEXTUREALPHA+"\n",c+="#define x3d_BlendFactorAlpha          "+L_.BLENDFACTORALPHA+"\n",c+="#define x3d_BlendCurrentAlpha         "+L_.BLENDCURRENTALPHA+"\n",c+="#define x3d_ModulateAlphaAddColor     "+L_.MODULATEALPHA_ADDCOLOR+"\n",c+="#define x3d_ModulateInvAlphaAddColor  "+L_.MODULATEINVALPHA_ADDCOLOR+"\n",c+="#define x3d_ModulateInvColorAddAlpha  "+L_.MODULATEINVCOLOR_ADDALPHA+"\n",c+="#define x3d_DotProduct3               "+L_.DOTPRODUCT3+"\n",c+="#define x3d_SelectArg1                "+L_.SELECTARG1+"\n",c+="#define x3d_SelectArg2                "+L_.SELECTARG2+"\n",c+="#define x3d_Off                       "+L_.OFF+"\n",c+="#define x3d_Diffuse  "+U_.DIFFUSE+"\n",c+="#define x3d_Specular "+U_.SPECULAR+"\n",c+="#define x3d_Factor   "+U_.FACTOR+"\n",c+="#define x3d_Complement     "+j_.COMPLEMENT+"\n",c+="#define x3d_AlphaReplicate "+j_.ALPHAREPLICATE+"\n",c+="#define x3d_Sphere                      "+q_.SPHERE+"\n",c+="#define x3d_CameraSpaceNormal           "+q_.CAMERASPACENORMAL+"\n",c+="#define x3d_CameraSpacePosition         "+q_.CAMERASPACEPOSITION+"\n",c+="#define x3d_CameraSpaceReflectionVector "+q_.CAMERASPACEREFLECTIONVECTOR+"\n",c+="#define x3d_SphereLocal                 "+q_.SPHERE_LOCAL+"\n",c+="#define x3d_Coord                       "+q_.COORD+"\n",c+="#define x3d_CoordEye                    "+q_.COORD_EYE+"\n",c+="#define x3d_Noise                       "+q_.NOISE+"\n",c+="#define x3d_NoiseEye                    "+q_.NOISE_EYE+"\n",c+="#define x3d_SphereReflect               "+q_.SPHERE_REFLECT+"\n",c+="#define x3d_SphereReflectLocal          "+q_.SPHERE_REFLECT_LOCAL+"\n",c+="#define x3d_GeometryPoints  0\n",c+="#define x3d_GeometryLines   1\n",c+="#define x3d_NoneClipPlane   vec4 (88.0, 51.0, 68.0, 33.0)\n",c+="#define x3d_NoneFog         0\n",c+="#define x3d_NoneLight       0\n",c+="#define x3d_NoneTexture     0\n";const l=n.match(/\s*precision\s+(lowp|mediump|highp)\s+float\s*;/),h=n.match(/\s*precision\s+(lowp|mediump|highp)\s+int\s*;/),d=l?l[1]:"mediump",p=h?h[1]:"mediump",f=R_.replace(/mediump\s+(float|vec2|vec3|mat3|mat4)/g,d+" $1").replace(/mediump\s+(int)/g,p+" $1"),g=(a[1].match(/\n/g)||[]).length+1;return a[1]+u+c+f+"#line "+(g+1)+" -1\n"+a[2]}};const W_=Y_;n.set("x_ite/Browser/Shaders/ShaderSource",W_);const K_=W_,J_=/^\s*#pragma\s+X3D\s+include\s+".*?([^\/]+)\.glsl"\s*$/;function Z_(t){this.includes=g_.includes[t.getVersion()],this.sourceFileNumbers={};for(const[t,e]of Object.getOwnPropertyNames(this.includes).entries())this.sourceFileNumbers[e]=t+1}Z_.prototype={getSourceFileName:function(t){return Object.getOwnPropertyNames(this.includes)[t-1]},process:function(t,e=0){const n=t.split("\n");t="";for(let i=0,o=n.length;i<o;++i){const o=n[i],r=o.match(J_);r?(t+="#line 1 "+this.sourceFileNumbers[r[1]]+"\n",t+=this.process(this.includes[r[1]],this.sourceFileNumbers[r[1]]),t+="\n",t+="#line "+(i+2)+" "+e+"\n"):(t+=o,t+="\n")}return t}};const Q_=Z_;n.set("x_ite/Browser/Shaders/ShaderCompiler",Q_);const $_=Q_,tx=["X3D_GEOMETRY_0D","X3D_GEOMETRY_1D","X3D_GEOMETRY_2D","X3D_GEOMETRY_3D","X3D_FOG","X3D_STYLE_PROPERTIES","X3D_UNLIT_MATERIAL","X3D_MATERIAL","X3D_LIGHTING","X3D_TEXTURE","X3D_MULTI_TEXTURING"];function ex(t){or.call(this,t),kr.call(this,t),this.addType(c.ShaderPart),this.options=[]}ex.prototype=Object.assign(Object.create(or.prototype),kr.prototype,{constructor:ex,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new Y([new B(c.inputOutput,"metadata",new Ri.SFNode),new B(c.inputOutput,"description",new Ri.SFString),new B(c.initializeOnly,"type",new Ri.SFString("VERTEX")),new B(c.inputOutput,"load",new Ri.SFBool(!0)),new B(c.inputOutput,"url",new Ri.MFString),new B(c.inputOutput,"autoRefresh",new Ri.SFTime),new B(c.inputOutput,"autoRefreshTimeLimit",new Ri.SFTime(3600))]),getTypeName:function(){return"ShaderPart"},getComponentName:function(){return"Shaders"},getContainerField:function(){return"parts"},initialize:function(){or.prototype.initialize.call(this),kr.prototype.initialize.call(this),this.isPrivate()||(this.options=tx.slice()),this._type.addInterest("set_type__",this),this.requestImmediateLoad()},set_type__:function(){this.setLoadState(c.NOT_STARTED_STATE),this.requestImmediateLoad()},getSourceText:function(){return this._url},getOptions:function(){return this.options},setOptions:function(t){this.options=t},getShader:function(){return this.shader},getShaderType:function(){const t=new Map([["VERTEX","VERTEX_SHADER"],["TESS_CONTROL","TESS_CONTROL_SHADER"],["TESS_EVALUATION","TESS_EVALUATION_SHADER"],["GEOMETRY","GEOMETRY_SHADER"],["FRAGMENT","FRAGMENT_SHADER"],["COMPUTE","COMPUTE_SHADER"]]);return function(){return t.get(this._type.getValue())||"VERTEX_SHADER"}}(),unLoadNow:function(){this.valid=!1},loadNow:function(){new Oc(this).loadDocument(this._url,function(t,e){if(null===t)this.setLoadState(c.FAILED_STATE);else{const n=this.getBrowser(),i=n.getContext(),o=this.getShaderType(),r=["X3D_"+o].concat(this.options),s=new $_(i),a=K_.getSource(i,n,s.process(t),r),u=i.createShader(i[o]);if(i.deleteShader(this.shader),this.shader=u,i.shaderSource(u,a),i.compileShader(u),!i.getShaderParameter(u,i.COMPILE_STATUS)){const t=this.getTypeName(),n=this.getName(),o=i.getShaderInfoLog(u),r=o.match(/(\d+):(\d+)/);if(r){const i=s.getSourceFileName(r[1])||e||this.getExecutionContext().getWorldURL();throw new Error("Error in "+t+" '"+n+"' in URL '"+i+"', line "+r[2]+", "+o)}{const i=e||this.getExecutionContext().getWorldURL();throw new Error("Error in "+t+" '"+n+"' in URL '"+i+"', "+o)}}this.setLoadState(c.COMPLETE_STATE)}}.bind(this))},dispose:function(){this.getBrowser().getContext().deleteShader(this.shader),kr.prototype.dispose.call(this),or.prototype.dispose.call(this)}});const nx=ex;n.set("x_ite/Components/Shaders/ShaderPart",nx);const ix=nx,ox=Symbol(),rx=Symbol(),sx=(Symbol(),Symbol());function ax(){this[ox]=!1,this[rx]=new Map,this[sx]=new Map}ax.prototype={initialize:function(){this.setShading(this.getBrowserOptions().getShading())},getShadingLanguageVersion:function(){const t=this.getContext();return t.getParameter(t.SHADING_LANGUAGE_VERSION)},getMaxVertexUniformVectors:function(){const t=this.getContext();return t.getParameter(t.MAX_VERTEX_UNIFORM_VECTORS)},getMaxFragmentUniformVectors:function(){const t=this.getContext();return t.getParameter(t.MAX_FRAGMENT_UNIFORM_VECTORS)},getMaxVertexAttribs:function(){const t=this.getContext();return t.getParameter(t.MAX_VERTEX_ATTRIBS)},getMaxVaryingVectors:function(){const t=this.getContext();return t.getParameter(t.MAX_VARYING_VECTORS)},getWireframe:function(){return this[ox]},getPrimitiveMode:function(t){return this[rx].get(t)},getShaders:function(){return this[sx]},setShading:function(t){const e=this.getContext();switch(t){case Co.POINT:this[ox]=!1,this[rx].set(e.POINTS,e.POINTS),this[rx].set(e.LINES,e.POINTS),this[rx].set(e.TRIANGLES,e.POINTS);break;case Co.WIREFRAME:this[ox]=!0,this[rx].set(e.POINTS,e.POINTS),this[rx].set(e.LINES,e.LINES),this[rx].set(e.TRIANGLES,e.LINE_LOOP);break;default:this[ox]=!1,this[rx].set(e.POINTS,e.POINTS),this[rx].set(e.LINES,e.LINES),this[rx].set(e.TRIANGLES,e.TRIANGLES)}},createShader:function(t,e,n=e,i=[],o=[],r=[]){this.getDebug()&&console.info("Initializing "+t);const s=this.getContext().getVersion(),a=new ix(this.getPrivateScene());a._url.push(e.startsWith("data:")?e:"data:x-shader/x-vertex,"+g_.vertex[s][e]),a.setPrivate(!0),a.setName(t+"Vertex"),a.setOptions(i),a.setup();const u=new ix(this.getPrivateScene());u._type="FRAGMENT",u._url.push(n.startsWith("data:")?n:"data:x-shader/x-fragment,"+g_.fragment[s][n]),u.setPrivate(!0),u.setName(t+"Fragment"),u.setOptions(i),u.setup();const c=new D_(this.getPrivateScene());return c._language="GLSL",c._parts.push(a),c._parts.push(u),c.setPrivate(!0),c.setName(t),c.setUniformNames(o),c.setTransformFeedbackVaryings(r),c.setup(),c}};const ux=ax;n.set("x_ite/Browser/Shaders/X3DShadersContext",ux);const cx=ux;function lx(t){or.call(this,t),this.addType(c.X3DAppearanceNode),this.addChildObjects("transparent",new Ri.SFBool),this._transparent.setAccessType(c.outputOnly)}lx.prototype=Object.assign(Object.create(or.prototype),{constructor:lx,setTransparent:function(t){t!==this._transparent.getValue()&&(this._transparent=t)},getTransparent:function(){return this._transparent.getValue()}});const hx=lx;n.set("x_ite/Components/Shape/X3DAppearanceNode",hx);const dx=hx;function px(t){dx.call(this,t),this.addType(c.Appearance),this.stylePropertiesNode=[],this.textureTransformMapping=new Map,this.textureBits=new Ga,this.shaderNodes=[]}px.prototype=Object.assign(Object.create(dx.prototype),{constructor:px,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new Y([new B(c.inputOutput,"metadata",new Ri.SFNode),new B(c.inputOutput,"alphaMode",new Ri.SFString("AUTO")),new B(c.inputOutput,"alphaCutoff",new Ri.SFFloat(.5)),new B(c.inputOutput,"pointProperties",new Ri.SFNode),new B(c.inputOutput,"lineProperties",new Ri.SFNode),new B(c.inputOutput,"fillProperties",new Ri.SFNode),new B(c.inputOutput,"material",new Ri.SFNode),new B(c.inputOutput,"backMaterial",new Ri.SFNode),new B(c.inputOutput,"texture",new Ri.SFNode),new B(c.inputOutput,"textureTransform",new Ri.SFNode),new B(c.inputOutput,"shaders",new Ri.MFNode),new B(c.inputOutput,"blendMode",new Ri.SFNode),new B(c.inputOutput,"acousticProperties",new Ri.SFNode)]),getTypeName:function(){return"Appearance"},getComponentName:function(){return"Shape"},getContainerField:function(){return"appearance"},initialize:function(){dx.prototype.initialize.call(this),this._alphaMode.addInterest("set_alphaMode__",this),this._alphaCutoff.addInterest("set_alphaCutoff__",this),this._pointProperties.addInterest("set_pointProperties__",this),this._lineProperties.addInterest("set_lineProperties__",this),this._fillProperties.addInterest("set_fillProperties__",this),this._material.addInterest("set_material__",this),this._backMaterial.addInterest("set_backMaterial__",this),this._texture.addInterest("set_texture__",this),this._textureTransform.addInterest("set_textureTransform__",this),this._shaders.addInterest("set_shaders__",this),this._blendMode.addInterest("set_blendMode__",this),this._alphaMode.addInterest("set_transparent__",this),this._fillProperties.addInterest("set_transparent__",this),this._material.addInterest("set_transparent__",this),this._texture.addInterest("set_transparent__",this),this._blendMode.addInterest("set_transparent__",this),this.set_alphaMode__(),this.set_pointProperties__(),this.set_lineProperties__(),this.set_fillProperties__(),this.set_material__(),this.set_backMaterial__(),this.set_texture__(),this.set_textureTransform__(),this.set_shaders__(),this.set_blendMode__(),this.set_transparent__()},getAlphaMode:function(){return this.alphaMode},getAlphaCutoff:function(){return this.alphaCutoff},getStyleProperties:function(t){return this.stylePropertiesNode[t]},getPointProperties:function(){return this.stylePropertiesNode[0]},getLineProperties:function(){return this.stylePropertiesNode[1]},getFillProperties:function(){return this.stylePropertiesNode[2]},getMaterial:function(){return this.materialNode},getBackMaterial:function(){return this.backMaterialNode},getTexture:function(){return this.textureNode},getTextureBits:function(){return this.textureBits},updateTextureBits:function(){this.textureBits.clear(),this.textureNode.updateTextureBits(this.textureBits)},getTextureTransform:function(){return this.textureTransformNode},getTextureTransformMapping:function(){return this.textureTransformMapping},getShader:function(t,e){return this.materialNode.getShader(t,e)},getBackShader:function(t,e){return this.backMaterialNode.getShader(t,e)},getBlendMode:function(){return this.blendModeNode},set_alphaMode__:function(){this.alphaMode=this.getEnum(fd,this._alphaMode.getValue(),fd.AUTO),this.set_alphaCutoff__()},set_alphaCutoff__:function(){this.alphaCutoff=this.alphaMode===fd.MASK?this._alphaCutoff.getValue():0},set_pointProperties__:function(){this.stylePropertiesNode[0]=nu(c.PointProperties,this._pointProperties)},set_lineProperties__:function(){this.linePropertiesNode&&this.linePropertiesNode._applied.removeInterest("set_applied__",this),this.linePropertiesNode=nu(c.LineProperties,this._lineProperties),this.linePropertiesNode&&this.linePropertiesNode._applied.addInterest("set_applied__",this),this.set_applied__()},set_applied__:function(){this.linePropertiesNode&&this.linePropertiesNode._applied.getValue()?this.stylePropertiesNode[1]=this.linePropertiesNode:this.stylePropertiesNode[1]=null},set_fillProperties__:function(){this.stylePropertiesNode[2]&&this.stylePropertiesNode[2]._transparent.removeInterest("set_transparent__",this),this.stylePropertiesNode[2]=nu(c.FillProperties,this._fillProperties),this.stylePropertiesNode[2]&&this.stylePropertiesNode[2]._transparent.addInterest("set_transparent__",this),this.stylePropertiesNode[3]=this.stylePropertiesNode[2]},set_material__:function(){this.materialNode&&this.materialNode._transparent.removeInterest("set_transparent__",this),this.materialNode=nu(c.X3DMaterialNode,this._material),this.materialNode||(this.materialNode=this.getBrowser().getDefaultMaterial()),this.materialNode&&this.materialNode._transparent.addInterest("set_transparent__",this),"TwoSidedMaterial"===this.materialNode.getTypeName()&&this.set_backMaterial__()},set_backMaterial__:function(){this.backMaterialNode&&this.backMaterialNode._transparent.removeInterest("set_transparent__",this),this.backMaterialNode=nu(c.X3DOneSidedMaterialNode,this._backMaterial),this.backMaterialNode&&this.backMaterialNode._transparent.addInterest("set_transparent__",this),this.backMaterialNode||"TwoSidedMaterial"!==this.materialNode.getTypeName()||(this.backMaterialNode=this.materialNode)},set_texture__:function(){this.textureNode&&(this.textureNode.removeInterest("updateTextureBits",this),this.textureNode._transparent.removeInterest("set_transparent__",this)),this.textureNode=nu(c.X3DTextureNode,this._texture),this.textureNode?(this.textureNode.addInterest("updateTextureBits",this),this.textureNode._transparent.addInterest("set_transparent__",this),this.updateTextureBits()):this.textureBits.clear()},set_textureTransform__:function(){this.textureTransformNode&&this.textureTransformNode.removeInterest("updateTextureTransformMapping",this),this.textureTransformNode=nu(c.X3DTextureTransformNode,this._textureTransform),this.textureTransformNode||(this.textureTransformNode=this.getBrowser().getDefaultTextureTransform()),this.textureTransformNode.addInterest("updateTextureTransformMapping",this),this.updateTextureTransformMapping()},updateTextureTransformMapping:function(){this.textureTransformMapping.clear(),this.textureTransformNode.getTextureTransformMapping(this.textureTransformMapping)},set_shaders__:function(){const t=this.shaderNodes;for(const e of t)e._isValid.removeInterest("set_shader__",this);t.length=0;for(const e of this._shaders){const n=nu(c.X3DShaderNode,e);n&&t.push(n)}for(const e of t)e._isValid.addInterest("set_shader__",this);this.set_shader__()},set_shader__:function(){function t(){return this.shaderNode}return function(){const e=this.shaderNodes;this.shaderNode&&this.shaderNode.deselect(),this.shaderNode=null;for(const t of e)if(t._isValid.getValue()){this.shaderNode=t;break}this.shaderNode?(this.shaderNode.select(),this.getShader=t,this.getBackShader=t):(delete this.getShader,delete this.getBackShader)}}(),set_blendMode__:function(){this.blendModeNode=nu(c.BlendMode,this._blendMode)},set_transparent__:function(){switch(this.alphaMode){case fd.AUTO:this.setTransparent(Boolean(this.stylePropertiesNode[3]&&this.stylePropertiesNode[3].getTransparent()||this.materialNode&&this.materialNode.getTransparent()||this.backMaterialNode&&this.backMaterialNode.getTransparent()||this.textureNode&&this.textureNode.getTransparent()||this.blendModeNode));break;case fd.OPAQUE:case fd.MASK:this.setTransparent(!1);break;case fd.BLEND:this.setTransparent(!0)}},traverse:function(t,e){this.textureNode&&this.textureNode.traverse(t,e)}});const fx=px;n.set("x_ite/Components/Shape/Appearance",fx);const gx=fx;function mx(t){Za.call(this,t),this.addType(c.X3DMaterialNode),this.addChildObjects("transparent",new Ri.SFBool),this._transparent.setAccessType(c.outputOnly),this.textureBits=new Ga,this.shaderNodes=this.getBrowser().getShaders()}mx.prototype=Object.assign(Object.create(Za.prototype),{constructor:mx,initialize:function(){Za.prototype.initialize.call(this),this.getBrowser().getRenderingProperties()._LogarithmicDepthBuffer.addInterest("set_logarithmicDepthBuffer__",this),this.set_logarithmicDepthBuffer__()},set_logarithmicDepthBuffer__:function(){this.logarithmicDepthBuffer=this.getBrowser().getRenderingProperty("LogarithmicDepthBuffer")},setTransparent:function(t){t!==this._transparent.getValue()&&(this._transparent=t)},getTransparent:function(){return this._transparent.getValue()},setTexture:function(t,e){const n=e?e.getTextureType()-1:0;this.textureBits.set(2*t+0,1&n),this.textureBits.set(2*t+1,2&n)},getTextureBits:function(){return this.textureBits},getShader:function(t,e){let n="";if(n+=this.textureBits.toString(4),n+=".",n+=t.geometryKey,e){const{renderObject:i,shadows:o,fogNode:r,shapeNode:s,appearanceNode:a,textureNode:u,objectsCount:c}=e;n+=this.logarithmicDepthBuffer||i.getViewpoint().getLogarithmicDepthBuffer()?"1":"0",n+=o?"1":"0",n+=r?r.getFogKey():"0",n+=s.getShapeKey(),n+=a.getStyleProperties(t.geometryType)?"1":"0",n+=".",n+=c[0],n+=".",n+=c[1],n+=".",n+=c[2],n+=".",n+=u?"1":a.getTextureBits().toString(4),n+=".",n+=a.getTextureTransformMapping().size||"1",n+=t.textureCoordinateMapping.size||"1",n+=this.getMaterialKey(o)}else{const{textureNode:e,objectsCount:i}=t;n+=this.logarithmicDepthBuffer?"1":"0",n+="0000.",n+=i[0],n+=".",n+=i[1],n+=".",n+=i[2],n+=".",n+=e?"1":"0",n+=".11",n+=this.getMaterialKey(!1)}return this.shaderNodes.get(n)||this.createShader(n,t,e)},getShaderOptions:function(){const t=["X3D_GEOMETRY_0D","X3D_GEOMETRY_1D","X3D_GEOMETRY_2D","X3D_GEOMETRY_3D"];return function(e,n){const i=this.getBrowser(),o=[];if(o.push(t[e.geometryType]),e.hasFogCoords&&o.push("X3D_FOG_COORDS"),e.colorMaterial&&o.push("X3D_COLOR_MATERIAL"),e.hasNormals&&o.push("X3D_NORMALS"),n){const{renderObject:t,appearanceNode:r,objectsCount:s}=n;if((this.logarithmicDepthBuffer||t.getViewpoint().getLogarithmicDepthBuffer())&&o.push("X3D_LOGARITHMIC_DEPTH_BUFFER"),n.shadows&&o.push("X3D_SHADOWS","X3D_PCF_FILTERING"),n.fogNode)switch(o.push("X3D_FOG"),n.fogNode.getFogKey()){case"1":o.push("X3D_FOG_LINEAR");break;case"2":o.push("X3D_FOG_EXPONENTIAL")}if(s[0]&&(o.push("X3D_CLIP_PLANES"),o.push("X3D_NUM_CLIP_PLANES "+Math.min(s[0],i.getMaxClipPlanes()))),s[1]&&(o.push("X3D_LIGHTING"),o.push("X3D_NUM_LIGHTS "+Math.min(s[1],i.getMaxLights()))),s[2]&&(o.push("X3D_PROJECTIVE_TEXTURE_MAPPING"),o.push("X3D_NUM_TEXTURE_PROJECTORS "+Math.min(s[2],i.getMaxTextures()))),r.getStyleProperties(e.geometryType)&&o.push("X3D_STYLE_PROPERTIES"),+this.textureBits)o.push("X3D_MATERIAL_TEXTURES"),o.push("X3D_NUM_TEXTURE_TRANSFORMS "+(r.getTextureTransformMapping().size||"1")),o.push("X3D_NUM_TEXTURE_COORDINATES "+(e.getTextureCoordinateMapping().size||"1"));else if(n.textureNode)o.push("X3D_TEXTURE","X3D_NUM_TEXTURES 1","X3D_NUM_TEXTURE_TRANSFORMS 1","X3D_NUM_TEXTURE_COORDINATES 1","X3D_TEXTURE0_2D");else if(+r.getTextureBits()){const t=r.getTexture();o.push("X3D_TEXTURE"),o.push("X3D_NUM_TEXTURES "+t.getCount()),o.push("X3D_NUM_TEXTURE_TRANSFORMS "+t.getCount()),o.push("X3D_NUM_TEXTURE_COORDINATES "+t.getCount()),t.getShaderOptions(o),t.getType().includes(c.MultiTexture)&&o.push("X3D_MULTI_TEXTURING")}switch(n.shapeNode.getShapeKey()){case"1":o.push("X3D_PARTICLE_SYSTEM");break;case"2":o.push("X3D_PARTICLE_SYSTEM","X3D_TEX_COORD_RAMP")}}else{const{textureNode:t,objectsCount:n}=e;this.logarithmicDepthBuffer&&o.push("X3D_LOGARITHMIC_DEPTH_BUFFER"),n[0]&&(o.push("X3D_CLIP_PLANES"),o.push("X3D_NUM_CLIP_PLANES "+Math.min(n[0],i.getMaxClipPlanes()))),n[1]&&(o.push("X3D_LIGHTING"),o.push("X3D_NUM_LIGHTS "+Math.min(n[1],i.getMaxLights()))),n[2]&&(o.push("X3D_PROJECTIVE_TEXTURE_MAPPING"),o.push("X3D_NUM_TEXTURE_PROJECTORS "+Math.min(n[2],i.getMaxTextures()))),t&&o.push("X3D_TEXTURE","X3D_NUM_TEXTURES 1","X3D_NUM_TEXTURE_TRANSFORMS 1","X3D_NUM_TEXTURE_COORDINATES 1","X3D_TEXTURE0_2D")}return o}}()});const _x=mx;n.set("x_ite/Components/Shape/X3DMaterialNode",_x);const xx=_x;function yx(t){xx.call(this,t),this.addType(c.X3DOneSidedMaterialNode),this.addChildObjects("textures",new Ri.SFTime),this.emissiveColor=new Float32Array(3)}yx.prototype=Object.assign(Object.create(xx.prototype),{constructor:yx,initialize:function(){xx.prototype.initialize.call(this),this._emissiveColor.addInterest("set_emissiveColor__",this),this._emissiveTexture.addInterest("set_emissiveTexture__",this),this._normalTexture.addInterest("set_normalTexture__",this),this._transparency.addInterest("set_transparency__",this),this._transparency.addInterest("set_transparent__",this),this.set_emissiveColor__(),this.set_emissiveTexture__(),this.set_normalTexture__(),this.set_transparency__()},set_emissiveColor__:function(){const t=this.emissiveColor,e=this._emissiveColor.getValue();t[0]=e.r,t[1]=e.g,t[2]=e.b},set_emissiveTexture__:function(){this.emissiveTextureNode=nu(c.X3DSingleTextureNode,this._emissiveTexture),this.setTexture(this.getTextureIndices().EMISSIVE_TEXTURE,this.emissiveTextureNode)},set_normalTexture__:function(){this.normalTextureNode=nu(c.X3DSingleTextureNode,this._normalTexture),this.setTexture(this.getTextureIndices().NORMAL_TEXTURE,this.normalTextureNode)},set_transparency__:function(){this.transparency=gt.clamp(this._transparency.getValue(),0,1)},set_transparent__:function(){this.setTransparent(Boolean(this.transparency))},getEmissiveTexture:function(){return this.emissiveTextureNode},getNormalTexture:function(){return this.normalTextureNode},getTransparency:function(){return this.transparency},getTextureIndices:function(){let t=0;const e={EMISSIVE_TEXTURE:t++,NORMAL_TEXTURE:t++};return function(){return e}}(),getShaderOptions:function(t,e){const n=xx.prototype.getShaderOptions.call(this,t,e);return+this.getTextureBits()&&(this.getEmissiveTexture()&&n.push("X3D_EMISSIVE_TEXTURE","X3D_EMISSIVE_TEXTURE","X3D_EMISSIVE_TEXTURE_"+this.getEmissiveTexture().getTextureTypeString()),this.getNormalTexture()&&n.push("X3D_NORMAL_TEXTURE","X3D_NORMAL_TEXTURE_"+this.getNormalTexture().getTextureTypeString())),n},setShaderUniforms:function(t,e,n,i,o){if(t.uniform3fv(e.x3d_EmissiveColor,this.emissiveColor),t.uniform1f(e.x3d_Transparency,this.transparency),+this.getTextureBits()){if(this.emissiveTextureNode){const r=e.x3d_EmissiveTexture;this.emissiveTextureNode.setShaderUniforms(t,e,n,r),t.uniform1i(r.textureTransformMapping,i.get(this._emissiveTextureMapping.getValue())||0),t.uniform1i(r.textureCoordinateMapping,o.get(this._emissiveTextureMapping.getValue())||0)}if(this.normalTextureNode){const r=e.x3d_NormalTexture;this.normalTextureNode.setShaderUniforms(t,e,n,r),t.uniform1i(r.textureTransformMapping,i.get(this._normalTextureMapping.getValue())||0),t.uniform1i(r.textureCoordinateMapping,o.get(this._normalTextureMapping.getValue())||0),t.uniform1f(e.x3d_NormalScale,Math.max(this._normalScale.getValue(),0))}}}});const wx=yx;n.set("x_ite/Components/Shape/X3DOneSidedMaterialNode",wx);const Sx=wx;function Tx(t){Sx.call(this,t),this.addType(c.UnlitMaterial)}Tx.prototype=Object.assign(Object.create(Sx.prototype),{constructor:Tx,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new Y([new B(c.inputOutput,"metadata",new Ri.SFNode),new B(c.inputOutput,"emissiveColor",new Ri.SFColor(1,1,1)),new B(c.inputOutput,"emissiveTexture",new Ri.SFNode),new B(c.inputOutput,"emissiveTextureMapping",new Ri.SFString),new B(c.inputOutput,"normalScale",new Ri.SFFloat(1)),new B(c.inputOutput,"normalTexture",new Ri.SFNode),new B(c.inputOutput,"normalTextureMapping",new Ri.SFString),new B(c.inputOutput,"transparency",new Ri.SFFloat)]),getTypeName:function(){return"UnlitMaterial"},getComponentName:function(){return"Shape"},getContainerField:function(){return"material"},initialize:function(){Sx.prototype.initialize.call(this),this.set_transparent__()},set_emissiveTexture__:function(){this.getEmissiveTexture()&&this.getEmissiveTexture()._transparent.removeInterest("set_transparent__",this),Sx.prototype.set_emissiveTexture__.call(this),this.getEmissiveTexture()&&this.getEmissiveTexture()._transparent.addInterest("set_transparent__",this)},set_transparent__:function(){this.setTransparent(Boolean(this.getTransparency()||this.getEmissiveTexture()&&this.getEmissiveTexture().getTransparent()))},getMaterialKey:function(){return"0"},createShader:function(t,e,n){const i=this.getBrowser(),o=this.getShaderOptions(e,n);o.push("X3D_UNLIT_MATERIAL");const r=i.createShader("UnlitShader","Default","Unlit",o);return i.getShaders().set(t,r),r}});const bx=Tx;n.set("x_ite/Components/Shape/UnlitMaterial",bx);const vx=bx,Cx=Symbol(),Ex=Symbol(),Ox=Symbol(),Nx=Symbol(),Fx=Symbol(),Ix=Symbol(),Mx=Symbol(),Dx=Symbol();function Vx(){this[Ox]=[],this[Cx]=1/(32*this.getPixelPerPoint())}Vx.prototype={initialize:function(){},getDefaultAppearance:function(){return this[Nx]=new gx(this.getPrivateScene()),this[Nx].setPrivate(!0),this[Nx].setup(),this.getDefaultAppearance=function(){return this[Nx]},Object.defineProperty(this,"getDefaultAppearance",{enumerable:!1}),this[Nx]},getLineStippleScale:function(){return this[Cx]},getDefaultMaterial:function(){return this[Fx]=new vx(this.getPrivateScene()),this[Fx].setPrivate(!0),this[Fx].setup(),this.getDefaultMaterial=function(){return this[Fx]},Object.defineProperty(this,"getDefaultMaterial",{enumerable:!1}),this[Fx]},getLinetypeTexture:function(){return this[Ex]=new pu(this.getPrivateScene()),this[Ex]._url[0]=il.getLinetypeUrl(),this[Ex]._textureProperties=this.getLineFillTextureProperties(),this[Ex].setPrivate(!0),this[Ex].setup(),this.getLinetypeTexture=function(){return this[Ex]},Object.defineProperty(this,"getLinetypeTexture",{enumerable:!1}),this[Ex]},getHatchStyleTexture:function(t){let e=this[Ox][t];return e||(e=this[Ox][t]=new pu(this.getPrivateScene()),e._url[0]=il.getHatchingUrl(t),e._textureProperties=this.getLineFillTextureProperties(),e.setPrivate(!0),e.setup(),e)},getLineFillTextureProperties:function(){return this[Ix]=new Sh(this.getPrivateScene()),this[Ix]._minificationFilter="NEAREST_PIXEL",this[Ix]._magnificationFilter="NEAREST_PIXEL",this[Ix]._textureCompression="DEFAULT",this[Ix].setPrivate(!0),this[Ix].setup(),this.getLineFillTextureProperties=function(){return this[Ix]},Object.defineProperty(this,"getLineFillTextureProperties",{enumerable:!1}),this[Ix]},getLineTransformShader:function(){return this[Mx]=this.createShader("LineTransformShader","LineTransform","LineTransform",[],["viewport","modelViewProjectionMatrix","invModelViewProjectionMatrix","scale"],["lineStipple0","fogDepth0","color0","normal0","vertex0","lineStipple1","fogDepth1","color1","normal1","vertex1","lineStipple2","fogDepth2","color2","normal2","vertex2"]),this.getLineTransformShader=function(){return this[Mx]},Object.defineProperty(this,"getLineTransformShader",{enumerable:!1}),this[Mx]},getLineTransformFeedback:function(){const t=this.getContext();return this[Dx]=t.createTransformFeedback(),this.getLineTransformFeedback=function(){return this[Dx]},Object.defineProperty(this,"getLineTransformFeedback",{enumerable:!1}),this[Dx]}};const Rx=Vx;n.set("x_ite/Browser/Shape/X3DShapeContext",Rx);const Px=Rx;function Ax(){this.addChildObjects("volume",new Ri.SFFloat(1),"mute",new Ri.SFBool)}Ax.prototype={initialize:function(){}};const Lx=Ax;n.set("x_ite/Browser/Sound/X3DSoundContext",Lx);const Bx=Lx;function Xx(t){Za.call(this,t),this.addType(c.X3DTextureTransformNode)}Xx.prototype=Object.assign(Object.create(Za.prototype),{constructor:Xx});const Ux=Xx;n.set("x_ite/Components/Texturing/X3DTextureTransformNode",Ux);const kx=Ux;function zx(t){kx.call(this,t),this.addType(c.X3DSingleTextureTransformNode),this.matrixArray=new Float32Array(hn.Identity)}zx.prototype=Object.assign(Object.create(kx.prototype),{constructor:zx,getCount:function(){return 1},setMatrix:function(t){this.matrixArray.set(t)},getTextureTransformMapping:function(t,e=0){this._mapping.getValue()&&t.set(this._mapping.getValue(),e)},setShaderUniforms:function(t,e){for(let n=0,i=e.x3d_MaxTextures;n<i;++n)this.setShaderUniformsToChannel(t,e,n)},setShaderUniformsToChannel:function(t,e,n=0){t.uniformMatrix4fv(e.x3d_TextureMatrix[n],!1,this.matrixArray)}});const jx=zx;n.set("x_ite/Components/Texturing/X3DSingleTextureTransformNode",jx);const Gx=jx;function Hx(t){Gx.call(this,t),this.addType(c.TextureTransform),this._rotation.setUnit("angle"),this.matrix=new hn}Hx.prototype=Object.assign(Object.create(Gx.prototype),{constructor:Hx,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new Y([new B(c.inputOutput,"metadata",new Ri.SFNode),new B(c.inputOutput,"mapping",new Ri.SFString),new B(c.inputOutput,"translation",new Ri.SFVec2f),new B(c.inputOutput,"rotation",new Ri.SFFloat),new B(c.inputOutput,"scale",new Ri.SFVec2f(1,1)),new B(c.inputOutput,"center",new Ri.SFVec2f)]),getTypeName:function(){return"TextureTransform"},getComponentName:function(){return"Texturing"},getContainerField:function(){return"textureTransform"},initialize:function(){Gx.prototype.initialize.call(this),this.addInterest("eventsProcessed",this),this.eventsProcessed()},getMatrix:function(){return this.matrix},eventsProcessed:function(){const t=new de(0,0),e=new Ie;return function(){const n=this._translation.getValue(),i=this._rotation.getValue(),o=this._scale.getValue(),r=this._center.getValue(),s=this.matrix;e.identity(),r.equals(de.Zero)||e.translate(t.assign(r).negate()),o.equals(de.One)||e.scale(o),0!==i&&e.rotate(i),r.equals(de.Zero)||e.translate(r),n.equals(de.Zero)||e.translate(n),s[0]=e[0],s[1]=e[1],s[4]=e[3],s[5]=e[4],s[12]=e[6],s[13]=e[7],this.setMatrix(s)}}()});const qx=Hx;n.set("x_ite/Components/Texturing/TextureTransform",qx);const Yx=qx,Wx=Symbol(),Kx=Symbol(),Jx=Symbol(),Zx=Symbol(),Qx=Symbol(),$x=Symbol(),ty=Symbol(),ey=Symbol(),ny=Symbol(),iy=Symbol(),oy=Symbol(),ry=Symbol(),sy=Symbol(),ay=Symbol(),uy=Symbol(),cy=Symbol(),ly=Symbol();function hy(){const t=this.getContext(),e=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS);this[Wx]=e>8?2:1}hy.prototype={initialize:function(){const t=this.getContext();t.pixelStorei(t.UNPACK_ALIGNMENT,1),this[Kx]=t.getParameter(t.MAX_TEXTURE_SIZE),this[Jx]=t.getParameter(t.MAX_COMBINED_TEXTURE_IMAGE_UNITS),this[Zx]=NaN,this[Qx]=[...Array(this[Jx]).keys()],this[$x]=[this[Qx].pop()],this[ty]=[this[Qx].pop()],this[ey]=[this[Qx].pop()];const e=new Uint8Array([255,255,255,255]);this[ry]=t.createTexture(),t.activeTexture(t.TEXTURE0+this[$x][0]),t.bindTexture(t.TEXTURE_2D,this[ry]),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,e),t.getVersion()>=2&&(this[sy]=t.createTexture(),t.activeTexture(t.TEXTURE0+this[ty][0]),t.bindTexture(t.TEXTURE_3D,this[sy]),t.texImage3D(t.TEXTURE_3D,0,t.RGBA,1,1,1,0,t.RGBA,t.UNSIGNED_BYTE,e)),this[ay]=t.createTexture(),t.activeTexture(t.TEXTURE0+this[ey][0]),t.bindTexture(t.TEXTURE_CUBE_MAP,this[ay]),t.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_Z,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,e),t.texImage2D(t.TEXTURE_CUBE_MAP_NEGATIVE_Z,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,e),t.texImage2D(t.TEXTURE_CUBE_MAP_NEGATIVE_X,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,e),t.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,e),t.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_Y,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,e),t.texImage2D(t.TEXTURE_CUBE_MAP_NEGATIVE_Y,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,e),this.resetTextureUnits(),this.setTextureQuality(this.getBrowserOptions().getTextureQuality())},getMaxTextures:function(){return this[Wx]},getMinTextureSize:function(){return 16},getMaxTextureSize:function(){return this[Kx]},getMaxCombinedTextureUnits:function(){return this[Jx]},popTexture2DUnit:function(){return this[ny]>0?(--this[ny],this[$x].pop()):this[Qx].pop()},pushTexture2DUnit:function(t){void 0!==t&&(++this[ny],this[$x].push(t))},getTexture2DUnit:function(){if(this[ny]>0)return this[$x][--this[ny]];const t=this[Qx].pop();return void 0!==t&&this[$x].push(t),t},getTexture3DUnit:function(){if(this[iy]>0)return this[ty][--this[iy]];const t=this[Qx].pop();return void 0!==t&&this[ty].push(t),t},getTextureCubeUnit:function(){if(this[oy]>0)return this[ey][--this[oy]];const t=this[Qx].pop();return void 0!==t&&this[ey].push(t),t},getTextureUnit:function(t){switch(t){case 2:return this.getTexture2DUnit();case 3:return this.getTexture3DUnit();case 4:return this.getTextureCubeUnit()}},resetTextureUnits:function(){this[ny]=this[$x].length,this[iy]=this[ty].length,this[oy]=this[ey].length},getDefaultTexture2DUnit:function(){return this[$x][0]},getDefaultTexture3DUnit:function(){return this[ty][0]},getDefaultTextureCubeUnit:function(){return this[ey][0]},getTextureMemory:function(){return this[Zx]},getDefaultTextureProperties:function(){return this[uy]=new Sh(this.getPrivateScene()),this[uy]._magnificationFilter="NICEST",this[uy]._minificationFilter="NEAREST_PIXEL_AVG_MIPMAP",this[uy]._generateMipMaps=!0,this[uy]._textureCompression="NICEST",this[uy].setup(),this.getDefaultTextureProperties=function(){return this[uy]},Object.defineProperty(this,"getDefaultTextureProperties",{enumerable:!1}),this[uy]},getDefaultTextureTransform:function(){return this[cy]=new Yx(this.getPrivateScene()),this[cy].setPrivate(!0),this[cy].setup(),this.getDefaultTextureTransform=function(){return this[cy]},Object.defineProperty(this,"getDefaultTextureTransform",{enumerable:!1}),this[cy]},getDefaultTextureCoordinate:function(){return this[ly]=new Kh(this.getPrivateScene()),this[ly].setPrivate(!0),this[ly].setup(),this.getDefaultTextureCoordinate=function(){return this[ly]},Object.defineProperty(this,"getDefaultTextureCoordinate",{enumerable:!1}),this[ly]},setTextureQuality:function(t){const e=this.getDefaultTextureProperties();switch(t){case No.LOW:e._magnificationFilter="AVG_PIXEL",e._minificationFilter="AVG_PIXEL",e._textureCompression="FASTEST",e._generateMipMaps=!0;break;case No.MEDIUM:e._magnificationFilter="NICEST",e._minificationFilter="NEAREST_PIXEL_AVG_MIPMAP",e._textureCompression="NICEST",e._generateMipMaps=!0;break;case No.HIGH:e._magnificationFilter="NICEST",e._minificationFilter="NICEST",e._textureCompression="NICEST",e._generateMipMaps=!0}}};const dy=hy;n.set("x_ite/Browser/Texturing/X3DTexturingContext",dy);const py=dy,fy=Symbol(),gy=Symbol(),my=Symbol(),_y=Symbol();function xy(){this[fy]=0,this[gy]=60,this[my]=new xe(0,0,0),this[_y]=0}xy.prototype={initialize:function(){this.advanceTime()},getCurrentTime:function(){return this[fy]},getCurrentFrameRate:function(){return this[gy]},getCurrentSpeed:function(){return this[_y]},advanceTime:function(){const t=new xe(0,0,0);return function(){const e=Date.now()/1e3,n=e-this[fy];if(this[fy]=e,this[gy]=n?1/n:60,this.getWorld()&&this.getActiveLayer()){const e=this.getActiveLayer().getViewpoint().getCameraSpaceMatrix();t.assign(this[my]),this[my].set(e[12],e[13],e[14]),this[_y]=t.subtract(this[my]).magnitude()*this[gy]}else this[_y]=0}}()};const yy=xy;n.set("x_ite/Browser/Time/X3DTimeContext",yy);const wy=yy,Sy=Symbol(),Ty=Symbol(),by=Symbol(),vy=Symbol();function Cy(){this[Sy]=[],this[Ty]=[],this[by]=[],this[vy]=[]}Cy.prototype={constructor:Cy,initialize:function(){},addTaintedField:function(t,e){this[Sy].push(t,e)},addTaintedNode:function(t){this[by].push(t)},[Symbol.for("X_ITE.X3DRoutingContext.processEvents")]:function(){do{do{const t=this[Sy];this[Sy]=this[Ty],this[Sy].length=0;for(let e=0,n=t.length;e<n;e+=2)t[e].processEvent(t[e+1]);this[Ty]=t}while(this[Sy].length);do{const t=this[by];this[by]=this[vy],this[by].length=0;for(const e of t)e.processEvents();this[vy]=t}while(!this[Sy].length&&this[by].length)}while(this[Sy].length)}};const Ey=Cy;n.set("x_ite/Routing/X3DRoutingContext",Ey);const Oy=Ey;var Ny=i(603);const Fy=Symbol(),Iy=Symbol(),My=Symbol(),Dy=Symbol(),Vy=Symbol(),Ry=Symbol(),Py=Symbol(),Ay=Symbol(),Ly=Symbol(),By=Symbol(),Xy=Symbol(),Uy=Symbol(),ky=Symbol.for("X_ITE.X3DRoutingContext.processEvents"),zy=[];function jy(t){$i.call(this,this),Oy.call(this),xh.call(this,t),wg.call(this),Mf.call(this),py.call(this),cx.call(this),mg.call(this),Px.call(this),Hd.call(this),hd.call(this),ag.call(this),bf.call(this),np.call(this),Ch.call(this),ap.call(this),Xf.call(this),Bx.call(this),wy.call(this);for(const t of zy)t.call(this);this.addChildObjects("initialized",new Un,"shutdown",new Un,"prepareEvents",new Un,"timeEvents",new Un,"sensorEvents",new Un,"finished",new Un),this[Iy]=0,this[Ry]=0,this[Vy]=this[Dy].bind(this),this[Py]=0,this[Ay]=0,this[Ly]=0,this[By]=0,this[Xy]=0,this[Uy]=0}jy.prototype=Object.assign(Object.create($i.prototype),xh.prototype,Ch.prototype,hd.prototype,Hd.prototype,np.prototype,ap.prototype,bf.prototype,Mf.prototype,Xf.prototype,ag.prototype,mg.prototype,Oy.prototype,wg.prototype,cx.prototype,Px.prototype,Bx.prototype,py.prototype,wy.prototype,{constructor:jy,initialize:function(){$i.prototype.initialize.call(this),Oy.prototype.initialize.call(this),xh.prototype.initialize.call(this),wg.prototype.initialize.call(this),Mf.prototype.initialize.call(this),py.prototype.initialize.call(this),cx.prototype.initialize.call(this),mg.prototype.initialize.call(this),Px.prototype.initialize.call(this),Hd.prototype.initialize.call(this),hd.prototype.initialize.call(this),ag.prototype.initialize.call(this),bf.prototype.initialize.call(this),np.prototype.initialize.call(this),Ch.prototype.initialize.call(this),ap.prototype.initialize.call(this),Xf.prototype.initialize.call(this),Bx.prototype.initialize.call(this),wy.prototype.initialize.call(this);for(const t of zy)"function"==typeof t.prototype.initialize&&t.prototype.initialize.call(this);this[ky]()},initialized:function(){return this._initialized},shutdown:function(){return this._shutdown},prepareEvents:function(){return this._prepareEvents},timeEvents:function(){return this._timeEvents},sensorEvents:function(){return this._sensorEvents},finished:function(){return this._finished},getBrowser:function(){return this},getWorld:function(){return this[Fy]},setExecutionContext:function(t){this[Fy]=new fc(t),this[Fy].setup()},getExecutionContext:function(){return this[Fy].getExecutionContext()},addBrowserEvent:function(){this[Iy]!==this.getCurrentTime()&&(this[Iy]=this.getCurrentTime(),requestAnimationFrame(this[Vy]))},[My]:function(t){return t===this[Ry]?(requestAnimationFrame(this[Vy]),!0):(this[Ry]=t,!1)},[Dy]:function(t){if(this[My](t))return;const e=this.getContext(),n=Date.now();this[Py]=n-this[Ay],this.advanceTime(),this._prepareEvents.processInterests(),this[ky](),this._timeEvents.processInterests(),this[ky]();const i=Date.now();this[Fy].traverse(Us.CAMERA,null),this[By]=Date.now()-i;const o=Date.now();this.getCollisionCount()&&this[Fy].traverse(Us.COLLISION,null),this[Xy]=Date.now()-o,this._sensorEvents.processInterests(),this[ky]();const r=Date.now();e.clearColor(0,0,0,0),e.clear(e.COLOR_BUFFER_BIT),this[Fy].traverse(Us.DISPLAY,null),this[Uy]=Date.now()-r,this[Ly]=Date.now()-n,this[Ay]=Date.now(),this._finished.processInterests()},getSystemTime:function(){return this[Py]},getBrowserTime:function(){return this[Ly]},getCameraTime:function(){return this[By]},getCollisionTime:function(){return this[Xy]},getDisplayTime:function(){return this[Uy]}});for(const t of Reflect.ownKeys(jy.prototype))Object.defineProperty(jy.prototype,t,{enumerable:!1});Object.assign(jy,{addBrowserContext:function(t){zy.push(t);const e=Object.keys(t.prototype).filter((t=>!t.match(/^(initialize|dispose)$/))).concat(Object.getOwnPropertySymbols(t.prototype));for(const n of e)Object.defineProperty(jy.prototype,n,{value:t.prototype[n],enumerable:!1,writable:!0});Ny("x3d-canvas, X3DCanvas").each((function(e,n){const i=window[Symbol.for("X_ITE.X3D-8.4.4a")].getBrowser(n);i&&(t.call(i),"function"==typeof t.prototype.initialize&&t.prototype.initialize.call(i),i[ky]())}))}});const Gy=jy;n.set("x_ite/Browser/X3DBrowserContext",Gy);const Hy=Gy;function qy(t){this.addType(c.X3DMetadataObject)}qy.prototype={constructor:qy,initialize:function(){},dispose:function(){}};const Yy=qy;n.set("x_ite/Components/Core/X3DMetadataObject",Yy);const Wy=Yy;function Ky(t){or.call(this,t),Wy.call(this,t),this.addType(c.MetadataBoolean)}Ky.prototype=Object.assign(Object.create(or.prototype),Wy.prototype,{constructor:Ky,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new Y([new B(c.inputOutput,"metadata",new Ri.SFNode),new B(c.inputOutput,"name",new Ri.SFString),new B(c.inputOutput,"reference",new Ri.SFString),new B(c.inputOutput,"value",new Ri.MFBool)]),getTypeName:function(){return"MetadataBoolean"},getComponentName:function(){return"Core"},getContainerField:function(){return"metadata"},initialize:function(){or.prototype.initialize.call(),Wy.prototype.initialize.call()},dispose:function(){Wy.prototype.dispose.call(),or.prototype.dispose.call()}});const Jy=Ky;n.set("x_ite/Components/Core/MetadataBoolean",Jy);const Zy=Jy;function Qy(t){or.call(this,t),Wy.call(this,t),this.addType(c.MetadataDouble)}Qy.prototype=Object.assign(Object.create(or.prototype),Wy.prototype,{constructor:Qy,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new Y([new B(c.inputOutput,"metadata",new Ri.SFNode),new B(c.inputOutput,"name",new Ri.SFString),new B(c.inputOutput,"reference",new Ri.SFString),new B(c.inputOutput,"value",new Ri.MFDouble)]),getTypeName:function(){return"MetadataDouble"},getComponentName:function(){return"Core"},getContainerField:function(){return"metadata"},initialize:function(){or.prototype.initialize.call(),Wy.prototype.initialize.call()},dispose:function(){Wy.prototype.dispose.call(),or.prototype.dispose.call()}});const $y=Qy;n.set("x_ite/Components/Core/MetadataDouble",$y);const tw=$y;function ew(t){or.call(this,t),Wy.call(this,t),this.addType(c.MetadataFloat)}ew.prototype=Object.assign(Object.create(or.prototype),Wy.prototype,{constructor:ew,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new Y([new B(c.inputOutput,"metadata",new Ri.SFNode),new B(c.inputOutput,"name",new Ri.SFString),new B(c.inputOutput,"reference",new Ri.SFString),new B(c.inputOutput,"value",new Ri.MFFloat)]),getTypeName:function(){return"MetadataFloat"},getComponentName:function(){return"Core"},getContainerField:function(){return"metadata"},initialize:function(){or.prototype.initialize.call(),Wy.prototype.initialize.call()},dispose:function(){Wy.prototype.dispose.call(),or.prototype.dispose.call()}});const nw=ew;n.set("x_ite/Components/Core/MetadataFloat",nw);const iw=nw;function ow(t){or.call(this,t),Wy.call(this,t),this.addType(c.MetadataInteger)}ow.prototype=Object.assign(Object.create(or.prototype),Wy.prototype,{constructor:ow,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new Y([new B(c.inputOutput,"metadata",new Ri.SFNode),new B(c.inputOutput,"name",new Ri.SFString),new B(c.inputOutput,"reference",new Ri.SFString),new B(c.inputOutput,"value",new Ri.MFInt32)]),getTypeName:function(){return"MetadataInteger"},getComponentName:function(){return"Core"},getContainerField:function(){return"metadata"},initialize:function(){or.prototype.initialize.call(),Wy.prototype.initialize.call()},dispose:function(){Wy.prototype.dispose.call(),or.prototype.dispose.call()}});const rw=ow;n.set("x_ite/Components/Core/MetadataInteger",rw);const sw=rw;function aw(t){or.call(this,t),Wy.call(this,t),this.addType(c.MetadataSet)}aw.prototype=Object.assign(Object.create(or.prototype),Wy.prototype,{constructor:aw,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new Y([new B(c.inputOutput,"metadata",new Ri.SFNode),new B(c.inputOutput,"name",new Ri.SFString),new B(c.inputOutput,"reference",new Ri.SFString),new B(c.inputOutput,"value",new Ri.MFNode)]),getTypeName:function(){return"MetadataSet"},getComponentName:function(){return"Core"},getContainerField:function(){return"metadata"},initialize:function(){or.prototype.initialize.call(),Wy.prototype.initialize.call()},dispose:function(){Wy.prototype.dispose.call(),or.prototype.dispose.call()}});const uw=aw;n.set("x_ite/Components/Core/MetadataSet",uw);const cw=uw;function lw(t){or.call(this,t),Wy.call(this,t),this.addType(c.MetadataString)}lw.prototype=Object.assign(Object.create(or.prototype),Wy.prototype,{constructor:lw,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new Y([new B(c.inputOutput,"metadata",new Ri.SFNode),new B(c.inputOutput,"name",new Ri.SFString),new B(c.inputOutput,"reference",new Ri.SFString),new B(c.inputOutput,"value",new Ri.MFString)]),getTypeName:function(){return"MetadataString"},getComponentName:function(){return"Core"},getContainerField:function(){return"metadata"},initialize:function(){or.prototype.initialize.call(),Wy.prototype.initialize.call()},dispose:function(){Wy.prototype.dispose.call(),or.prototype.dispose.call()}});const hw=lw;n.set("x_ite/Components/Core/MetadataString",hw);const dw=hw;function pw(t){ha.call(this,t),this.addType(c.X3DInfoNode)}pw.prototype=Object.assign(Object.create(ha.prototype),{constructor:pw});const fw=pw;n.set("x_ite/Components/Core/X3DInfoNode",fw);const gw=fw;function mw(t){gw.call(this,t),this.addType(c.WorldInfo)}mw.prototype=Object.assign(Object.create(gw.prototype),{constructor:mw,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new Y([new B(c.inputOutput,"metadata",new Ri.SFNode),new B(c.inputOutput,"title",new Ri.SFString),new B(c.inputOutput,"info",new Ri.MFString)]),getTypeName:function(){return"WorldInfo"},getComponentName:function(){return"Core"},getContainerField:function(){return"children"},initialize:function(){gw.prototype.initialize.call(this),this.getExecutionContext().addWorldInfo(this)},dispose:function(){this.getExecutionContext().removeWorldInfo(this),gw.prototype.dispose.call(this)}});const _w=mw;n.set("x_ite/Components/Core/WorldInfo",_w);const xw={MetadataBoolean:Zy,MetadataDouble:tw,MetadataFloat:iw,MetadataInteger:sw,MetadataSet:cw,MetadataString:dw,WorldInfo:_w},yw={X3DBindableNode:fa,X3DChildNode:ha,X3DInfoNode:gw,X3DMetadataObject:Wy,X3DNode:or,X3DPrototypeInstance:Or,X3DSensorNode:Tu};for(const t in xw)Qo.addType(t,xw[t]);for(const t in yw)Qo.addAbstractType(t,yw[t]);const ww=void 0;n.set("x_ite/Components/Core",ww);function Sw(t){Rh.call(this,t),this.addType(c.FogCoordinate),this._depth.setUnit("length")}Sw.prototype=Object.assign(Object.create(Rh.prototype),{constructor:Sw,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new Y([new B(c.inputOutput,"metadata",new Ri.SFNode),new B(c.inputOutput,"depth",new Ri.MFFloat)]),getTypeName:function(){return"FogCoordinate"},getComponentName:function(){return"EnvironmentalEffects"},getContainerField:function(){return"fogCoord"},initialize:function(){Rh.prototype.initialize.call(this),this._depth.addInterest("set_depth__",this),this.set_depth__()},set_depth__:function(){this.depth=this._depth.getValue(),this.length=this._depth.length},isEmpty:function(){return 0===this.length},getSize:function(){return this.length},addDepth:function(t,e){t<this.length?e.push(this.depth[t]):this.length?e.push(this.depth[this.length-1]):e.push(0)},addDepths:function(t,e){const n=this.length;if(n){const i=this.depth;for(let e=0;e<n;++e)t.push(i[e]);const o=i[n-1];for(let i=n;i<e;++i)t.push(o)}else for(let n=0;n<e;++n)t.push(0)}});const Tw=Sw;n.set("x_ite/Components/EnvironmentalEffects/FogCoordinate",Tw);const bw=Tw;function vw(t){ha.call(this,t),Ca.call(this,t),this.addType(c.LocalFog)}vw.prototype=Object.assign(Object.create(ha.prototype),Ca.prototype,{constructor:vw,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new Y([new B(c.inputOutput,"metadata",new Ri.SFNode),new B(c.inputOutput,"enabled",new Ri.SFBool(!0)),new B(c.inputOutput,"fogType",new Ri.SFString("LINEAR")),new B(c.inputOutput,"color",new Ri.SFColor(1,1,1)),new B(c.inputOutput,"visibilityRange",new Ri.SFFloat)]),getTypeName:function(){return"LocalFog"},getComponentName:function(){return"EnvironmentalEffects"},getContainerField:function(){return"children"},initialize:function(){ha.prototype.initialize.call(this),Ca.prototype.initialize.call(this)},push:function(t){if(this._enabled.getValue()&&this.getFogType()){const e=this.getFogs().pop();e.set(this,t.getModelViewMatrix().get()),t.getLocalFogs().push(e)}},pop:function(t){this._enabled.getValue()&&this.getFogType()&&this.getBrowser().getLocalObjects().push(t.getLocalFogs().pop())},dispose:function(){Ca.prototype.dispose.call(this),ha.prototype.dispose.call(this)}});const Cw=vw;n.set("x_ite/Components/EnvironmentalEffects/LocalFog",Cw);const Ew=Cw;function Ow(t){Wa.call(this,t),this.addType(c.TextureBackground)}Ow.prototype=Object.assign(Object.create(Wa.prototype),{constructor:Ow,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new Y([new B(c.inputOutput,"metadata",new Ri.SFNode),new B(c.inputOnly,"set_bind",new Ri.SFBool),new B(c.inputOutput,"skyAngle",new Ri.MFFloat),new B(c.inputOutput,"skyColor",new Ri.MFColor(new Ri.SFColor)),new B(c.inputOutput,"groundAngle",new Ri.MFFloat),new B(c.inputOutput,"groundColor",new Ri.MFColor),new B(c.inputOutput,"transparency",new Ri.SFFloat),new B(c.outputOnly,"isBound",new Ri.SFBool),new B(c.outputOnly,"bindTime",new Ri.SFTime),new B(c.inputOutput,"frontTexture",new Ri.SFNode),new B(c.inputOutput,"backTexture",new Ri.SFNode),new B(c.inputOutput,"leftTexture",new Ri.SFNode),new B(c.inputOutput,"rightTexture",new Ri.SFNode),new B(c.inputOutput,"topTexture",new Ri.SFNode),new B(c.inputOutput,"bottomTexture",new Ri.SFNode)]),getTypeName:function(){return"TextureBackground"},getComponentName:function(){return"EnvironmentalEffects"},getContainerField:function(){return"children"},initialize:function(){Wa.prototype.initialize.call(this),this._frontTexture.addInterest("set_frontTexture__",this),this._backTexture.addInterest("set_backTexture__",this),this._leftTexture.addInterest("set_leftTexture__",this),this._rightTexture.addInterest("set_rightTexture__",this),this._topTexture.addInterest("set_topTexture__",this),this._bottomTexture.addInterest("set_bottomTexture__",this),this.set_frontTexture__(this._frontTexture),this.set_backTexture__(this._backTexture),this.set_leftTexture__(this._leftTexture),this.set_rightTexture__(this._rightTexture),this.set_topTexture__(this._topTexture),this.set_bottomTexture__(this._bottomTexture)},set_frontTexture__:function(){Wa.prototype.set_frontTexture__.call(this,nu(c.X3DTextureNode,this._frontTexture))},set_backTexture__:function(){Wa.prototype.set_backTexture__.call(this,nu(c.X3DTextureNode,this._backTexture))},set_leftTexture__:function(){Wa.prototype.set_leftTexture__.call(this,nu(c.X3DTextureNode,this._leftTexture))},set_rightTexture__:function(){Wa.prototype.set_rightTexture__.call(this,nu(c.X3DTextureNode,this._rightTexture))},set_topTexture__:function(){Wa.prototype.set_topTexture__.call(this,nu(c.X3DTextureNode,this._topTexture))},set_bottomTexture__:function(){Wa.prototype.set_bottomTexture__.call(this,nu(c.X3DTextureNode,this._bottomTexture))}});const Nw=Ow;n.set("x_ite/Components/EnvironmentalEffects/TextureBackground",Nw);const Fw={Background:mu,Fog:Na,FogCoordinate:bw,LocalFog:Ew,TextureBackground:Nw},Iw={X3DBackgroundNode:Wa,X3DFogObject:Ca};for(const t in Fw)Qo.addType(t,Fw[t]);for(const t in Iw)Qo.addAbstractType(t,Iw[t]);const Mw=void 0;n.set("x_ite/Components/EnvironmentalEffects",Mw);function Dw(t){Tu.call(this,t),this.addType(c.X3DEnvironmentalSensorNode),this.addChildObjects("traversed",new Ri.SFBool(!0)),this._size.setUnit("length"),this._center.setUnit("length"),this.zeroTest=!1,this.currentTraversed=!0}Dw.prototype=Object.assign(Object.create(Tu.prototype),{constructor:Dw,initialize:function(){Tu.prototype.initialize.call(this),this.isLive().addInterest("set_live__",this),this._enabled.addInterest("set_live__",this),this._size.addInterest("set_live__",this),this._traversed.addInterest("set_live__",this),this.set_live__()},set_live__:function(){!(this._traversed.getValue()&&this.isLive().getValue()&&this._enabled.getValue())||this.zeroTest&&this._size.getValue().equals(xe.Zero)?(this.getBrowser().sensorEvents().removeInterest("update",this),this._isActive.getValue()&&(this._isActive=!1,this._exitTime=this.getBrowser().getCurrentTime())):this.getBrowser().sensorEvents().addInterest("update",this)},setZeroTest:function(t){this.zeroTest=t},getZeroTest:function(){return this.zeroTest},setTraversed:function(t){t?!1===this._traversed.getValue()&&(this._traversed=!0):this.currentTraversed!==this._traversed.getValue()&&(this._traversed=this.currentTraversed),this.currentTraversed=t},getTraversed:function(){return this.currentTraversed},update:function(){}});const Vw=Dw;n.set("x_ite/Components/EnvironmentalSensor/X3DEnvironmentalSensorNode",Vw);const Rw=Vw;function Pw(t){Rw.call(this,t),this.addType(c.ProximitySensor),this.setCameraObject(!0),this._centerOfRotation_changed.setUnit("length"),this._position_changed.setUnit("length"),this.setZeroTest(!0),this.min=new xe(0,0,0),this.max=new xe(0,0,0),this.viewpointNode=null,this.modelMatrix=new hn,this.inside=!1}Pw.prototype=Object.assign(Object.create(Rw.prototype),{constructor:Pw,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new Y([new B(c.inputOutput,"metadata",new Ri.SFNode),new B(c.inputOutput,"enabled",new Ri.SFBool(!0)),new B(c.inputOutput,"size",new Ri.SFVec3f),new B(c.inputOutput,"center",new Ri.SFVec3f),new B(c.outputOnly,"enterTime",new Ri.SFTime),new B(c.outputOnly,"exitTime",new Ri.SFTime),new B(c.outputOnly,"isActive",new Ri.SFBool),new B(c.outputOnly,"position_changed",new Ri.SFVec3f),new B(c.outputOnly,"orientation_changed",new Ri.SFRotation),new B(c.outputOnly,"centerOfRotation_changed",new Ri.SFVec3f)]),getTypeName:function(){return"ProximitySensor"},getComponentName:function(){return"EnvironmentalSensor"},getContainerField:function(){return"children"},initialize:function(){Rw.prototype.initialize.call(this),this._enabled.addInterest("set_enabled__",this),this._size.addInterest("set_extents__",this),this._center.addInterest("set_extents__",this),this._traversed.addFieldInterest(this._isCameraObject),this.set_enabled__(),this.set_extents__()},set_enabled__:function(){this.setCameraObject(this._enabled.getValue()),this._enabled.getValue()?delete this.traverse:this.traverse=Function.prototype},set_extents__:function(){const t=this._size.getValue(),e=this._center.getValue(),n=t.x/2,i=t.y/2,o=t.z/2,r=e.x,s=e.y,a=e.z;this.min.set(r-n,s-i,a-o),this.max.set(r+n,s+i,a+o)},update:function(){const t=new hn,e=new hn,n=new xe(0,0,0),i=new an(0,0,1,0),o=new xe(0,0,0);return function(){if(this.inside&&this.getTraversed()){if(this.viewpointNode){const r=this.modelMatrix;e.assign(this.viewpointNode.getModelMatrix()),e.translate(this.viewpointNode.getUserCenterOfRotation()),e.multRight(t.assign(r).inverse()),r.multRight(this.viewpointNode.getViewMatrix()),r.get(null,i),r.inverse(),n.set(r[12],r[13],r[14]),i.inverse(),o.set(e[12],e[13],e[14]),this._isActive.getValue()?(this._position_changed.getValue().equals(n)||(this._position_changed=n),this._orientation_changed.getValue().equals(i)||(this._orientation_changed=i),this._centerOfRotation_changed.getValue().equals(o)||(this._centerOfRotation_changed=o)):(this._isActive=!0,this._enterTime=this.getBrowser().getCurrentTime(),this._position_changed=n,this._orientation_changed=i,this._centerOfRotation_changed=o)}}else this._isActive.getValue()&&(this._isActive=!1,this._exitTime=this.getBrowser().getCurrentTime());this.inside=!1,this.viewpointNode=null,this.setTraversed(!1)}}(),traverse:function(){const t=new hn,e=new xe(-1,-1,-1);return function(n,i){switch(n){case Us.CAMERA:return this.viewpointNode=i.getViewpoint(),void this.modelMatrix.assign(i.getModelViewMatrix().get());case Us.DISPLAY:if(this.setTraversed(!0),this.inside)return;return void(this._size.getValue().equals(e)?this.inside=!0:(t.assign(i.getModelViewMatrix().get()).inverse(),this.inside=this.containsPoint(t.origin)))}}}(),containsPoint:function(t){const e=this.min,n=this.max;return e.x<=t.x&&n.x>=t.x&&e.y<=t.y&&n.y>=t.y&&e.z<=t.z&&n.z>=t.z}});const Aw=Pw;n.set("x_ite/Components/EnvironmentalSensor/ProximitySensor",Aw);const Lw=Aw,Bw=wa(hn),Xw=wa(hn);function Uw(t){Rw.call(this,t),this.addType(c.TransformSensor),this._position_changed.setUnit("length"),this.setZeroTest(!0),this.min=new xe,this.max=new xe,this.targetObjectNode=null,this.modelMatrices=[],this.targetMatrices=[]}Uw.prototype=Object.assign(Object.create(Rw.prototype),{constructor:Uw,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new Y([new B(c.inputOutput,"metadata",new Ri.SFNode),new B(c.inputOutput,"enabled",new Ri.SFBool(!0)),new B(c.inputOutput,"size",new Ri.SFVec3f),new B(c.inputOutput,"center",new Ri.SFVec3f),new B(c.outputOnly,"enterTime",new Ri.SFTime),new B(c.outputOnly,"exitTime",new Ri.SFTime),new B(c.outputOnly,"isActive",new Ri.SFBool),new B(c.outputOnly,"position_changed",new Ri.SFVec3f),new B(c.outputOnly,"orientation_changed",new Ri.SFRotation),new B(c.inputOutput,"targetObject",new Ri.SFNode)]),getTypeName:function(){return"TransformSensor"},getComponentName:function(){return"EnvironmentalSensor"},getContainerField:function(){return"children"},initialize:function(){Rw.prototype.initialize.call(this),this.isLive().addInterest("set_enabled__",this),this._enabled.addInterest("set_enabled__",this),this._size.addInterest("set_enabled__",this),this._size.addInterest("set_extents__",this),this._center.addInterest("set_extents__",this),this._targetObject.addInterest("set_targetObject__",this),this.set_extents__(),this.set_targetObject__()},set_live__:function(){},set_enabled__:function(){this.isLive().getValue()&&this.targetObjectNode&&this._enabled.getValue()&&!this._size.getValue().equals(xe.Zero)?(this.setPickableObject(!0),this.getBrowser().addTransformSensor(this),this.targetObjectNode.addTransformSensor(this)):(this.setPickableObject(!1),this.getBrowser().removeTransformSensor(this),this.targetObjectNode&&this.targetObjectNode.removeTransformSensor(this),this._isActive.getValue()&&(this._isActive=!1,this._exitTime=this.getBrowser().getCurrentTime()))},set_extents__:function(){const t=this._size.getValue(),e=this._center.getValue(),n=t.x/2,i=t.y/2,o=t.z/2,r=e.x,s=e.y,a=e.z;this.min.set(r-n,s-i,a-o),this.max.set(r+n,s+i,a+o)},set_targetObject__:function(){this.targetObjectNode=null;try{const t=this._targetObject.getValue().getInnerNode(),e=t.getType();for(let n=e.length-1;n>=0;--n){switch(e[n]){case c.X3DGroupingNode:case c.X3DShapeNode:this.targetObjectNode=t;break;default:continue}break}}catch(t){}this.set_enabled__()},traverse:function(t,e){t===Us.PICKING&&this.getPickableObject()&&this.modelMatrices.push(Bw.pop().assign(e.getModelViewMatrix().get()))},collect:function(t){this.targetMatrices.push(Xw.pop().assign(t))},process:function(){const t=new xe(0,0,0),e=new an(0,0,1,0);return function(){const n=this.modelMatrices,i=this.targetMatrices,o=this.intersects();o?(o.get(t,e),this._isActive.getValue()?(this._position_changed.getValue().equals(t)||(this._position_changed=t),this._orientation_changed.getValue().equals(e)||(this._orientation_changed=e)):(this._isActive=!0,this._enterTime=this.getBrowser().getCurrentTime(),this._position_changed=t,this._orientation_changed=e)):this._isActive.getValue()&&(this._isActive=!1,this._exitTime=this.getBrowser().getCurrentTime());for(const t of n)Bw.push(t);for(const t of i)Xw.push(t);n.length=0,i.length=0}}(),intersects:function(){const t=new xe(-1,-1,-1);return function(){const e=this.modelMatrices,n=this.targetMatrices,i=this._size.getValue().equals(t);for(const t of e){const e=t.inverse();for(const t of n){const n=t.multRight(e);if(i||this.containsPoint(n.origin))return n}}return null}}(),containsPoint:function(t){const e=this.min,n=this.max;return e.x<=t.x&&n.x>=t.x&&e.y<=t.y&&n.y>=t.y&&e.z<=t.z&&n.z>=t.z}});const kw=Uw;n.set("x_ite/Components/EnvironmentalSensor/TransformSensor",kw);const zw=kw;function jw(t){Rw.call(this,t),this.addType(c.VisibilitySensor),this.setZeroTest(!1),this.visible=!1}jw.prototype=Object.assign(Object.create(Rw.prototype),{constructor:jw,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new Y([new B(c.inputOutput,"metadata",new Ri.SFNode),new B(c.inputOutput,"enabled",new Ri.SFBool(!0)),new B(c.inputOutput,"size",new Ri.SFVec3f),new B(c.inputOutput,"center",new Ri.SFVec3f),new B(c.outputOnly,"enterTime",new Ri.SFTime),new B(c.outputOnly,"exitTime",new Ri.SFTime),new B(c.outputOnly,"isActive",new Ri.SFBool)]),getTypeName:function(){return"VisibilitySensor"},getComponentName:function(){return"EnvironmentalSensor"},getContainerField:function(){return"children"},initialize:function(){Rw.prototype.initialize.call(this),this._enabled.addInterest("set_enabled__",this),this.set_enabled__()},set_enabled__:function(){this._enabled.getValue()?delete this.traverse:this.traverse=Function.prototype},update:function(){this.visible&&this.getTraversed()?(this._isActive.getValue()||(this._isActive=!0,this._enterTime=this.getBrowser().getCurrentTime()),this.visible=!1):this._isActive.getValue()&&(this._isActive=!1,this._exitTime=this.getBrowser().getCurrentTime()),this.setTraversed(!1)},traverse:function(){const t=new Ks,e=new xe(-1,-1,-1);return function(n,i){n===Us.DISPLAY&&(this.setTraversed(!0),this.visible||(this._size.getValue().equals(e)?this.visible=!0:(t.set(this._size.getValue(),this._center.getValue()).multRight(i.getModelViewMatrix().get()),this.visible=i.getViewVolume().intersectsBox(t))))}}()});const Gw=jw;n.set("x_ite/Components/EnvironmentalSensor/VisibilitySensor",Gw);const Hw={ProximitySensor:Lw,TransformSensor:zw,VisibilitySensor:Gw},qw={X3DEnvironmentalSensorNode:Rw};for(const t in Hw)Qo.addType(t,Hw[t]);for(const t in qw)Qo.addAbstractType(t,qw[t]);const Yw=void 0;n.set("x_ite/Components/EnvironmentalSensor",Yw);var Ww=new xe(0,0,0),Kw=new xe(0,0,0),Jw=new xe(0,0,0),Zw=new xe(0,0,0);function Qw(t){yp.call(this,t),this.addType(c.ColorChaser)}Qw.prototype=Object.assign(Object.create(yp.prototype),{constructor:Qw,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new Y([new B(c.inputOutput,"metadata",new Ri.SFNode),new B(c.inputOnly,"set_value",new Ri.SFColor),new B(c.inputOnly,"set_destination",new Ri.SFColor),new B(c.initializeOnly,"initialValue",new Ri.SFColor(.8,.8,.8)),new B(c.initializeOnly,"initialDestination",new Ri.SFColor(.8,.8,.8)),new B(c.initializeOnly,"duration",new Ri.SFTime(1)),new B(c.outputOnly,"isActive",new Ri.SFBool),new B(c.outputOnly,"value_changed",new Ri.SFColor)]),getTypeName:function(){return"ColorChaser"},getComponentName:function(){return"Followers"},getContainerField:function(){return"children"},getVector:function(){return new xe(0,0,0)},getValue:function(){return this._set_value.getValue().getHSV(Zw)},getDestination:function(){return this._set_destination.getValue().getHSV(Zw)},getInitialValue:function(){return this._initialValue.getValue().getHSV(Ww)},getInitialDestination:function(){return this._initialDestination.getValue().getHSV(Kw)},setValue:function(t){this._value_changed.setHSV(t.x,t.y,t.z)},interpolate:function(t,e,n){return Ct.lerp(t,e,n,Zw)},step:function(t,e,n){Jw.assign(this.output).add(t).subtract(e),Ct.lerp(this.output,Jw,n,this.output)}});const $w=Qw;n.set("x_ite/Components/Followers/ColorChaser",$w);const tS=$w;function eS(t){mp.call(this,t),this.addType(c.X3DDamperNode)}eS.prototype=Object.assign(Object.create(mp.prototype),{constructor:eS,initialize:function(){mp.prototype.initialize.call(this),this._order.addInterest("set_order__",this),this._set_value.addInterest("set_value__",this),this._set_destination.addInterest("set_destination__",this);var t=this.getBuffer(),e=this.getInitialValue(),n=this.getInitialDestination();t[0]=this.duplicate(n);for(var i=1,o=this.getOrder()+1;i<o;++i)t[i]=this.duplicate(e);this.equals(n,e,this.getTolerance())?this.setValue(n):this.set_active(!0)},getOrder:function(){return gt.clamp(this._order.getValue(),0,5)},getTolerance:function(){return this._tolerance.getValue()<0?1e-4:this._tolerance.getValue()},prepareEvents:function(){var t=this.getBuffer(),e=t.length-1;if(this._tau.getValue()){for(var n=1/this.getBrowser().currentFrameRate,i=Math.exp(-n/this._tau.getValue()),o=0;o<e;++o)this.assign(t,o+1,this.interpolate(t[o],t[o+1],i));if(this.setValue(t[e]),!this.equals(t[e],t[0],this.getTolerance()))return}else this.setValue(t[0]),e=0;o=1;for(var r=t.length;o<r;++o)this.assign(t,o,t[e]);this.set_active(!1)},set_value__:function(){for(var t=this.getBuffer(),e=this.getValue(),n=1,i=t.length;n<i;++n)this.assign(t,n,e);this.setValue(e),this.set_active(!0)},set_destination__:function(){this.assign(this.getBuffer(),0,this.getDestination()),this.set_active(!0)},set_order__:function(){for(var t=this.getBuffer(),e=t[t.length-1],n=t.length,i=this.getOrder()+1;n<i;++n)t[n]=this.duplicate(e);t.length=i}});const nS=eS;n.set("x_ite/Components/Followers/X3DDamperNode",nS);const iS=nS;var oS=new xe(0,0,0),rS=new xe(0,0,0),sS=new xe(0,0,0),aS=new xe(0,0,0);function uS(t){iS.call(this,t),this.addType(c.ColorDamper)}uS.prototype=Object.assign(Object.create(iS.prototype),{constructor:uS,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new Y([new B(c.inputOutput,"metadata",new Ri.SFNode),new B(c.inputOnly,"set_value",new Ri.SFColor),new B(c.inputOnly,"set_destination",new Ri.SFColor),new B(c.initializeOnly,"initialValue",new Ri.SFColor(.8,.8,.8)),new B(c.initializeOnly,"initialDestination",new Ri.SFColor(.8,.8,.8)),new B(c.initializeOnly,"order",new Ri.SFInt32(3)),new B(c.inputOutput,"tau",new Ri.SFTime(.3)),new B(c.inputOutput,"tolerance",new Ri.SFFloat(-1)),new B(c.outputOnly,"isActive",new Ri.SFBool),new B(c.outputOnly,"value_changed",new Ri.SFColor)]),getTypeName:function(){return"ColorDamper"},getComponentName:function(){return"Followers"},getContainerField:function(){return"children"},getVector:function(){return new xe(0,0,0)},getValue:function(){return this._set_value.getValue().getHSV(aS)},getDestination:function(){return this._set_destination.getValue().getHSV(aS)},getInitialValue:function(){return this._initialValue.getValue().getHSV(rS)},getInitialDestination:function(){return this._initialDestination.getValue().getHSV(sS)},setValue:function(t){this._value_changed.setHSV(t.x,t.y,t.z)},equals:function(t,e,n){return oS.assign(t).subtract(e).magnitude()<n},interpolate:function(t,e,n){return Ct.lerp(t,e,n,aS)}});const cS=uS;n.set("x_ite/Components/Followers/ColorDamper",cS);const lS=cS;const hS=function(t){function e(){this.array=this.getArray(),this.zero=this.getVector()}return e.prototype={getArray:function(){const t=[];return t.assign=function(t){if(Array.isArray(t)){for(var e=0,n=Math.min(this.length,t.length);e<n;++e)this[e].assign(t[e]);for(e=n,n=t.length;e<n;++e)this[e]=t[e].copy();this.length=n}else{for(e=0,n=Math.min(this.length,t.length);e<n;++e)this[e].assign(t[e].getValue());for(e=n,n=t.length;e<n;++e)this[e]=t[e].getValue().copy();this.length=n}},t},getValue:function(){return this._set_value},getDestination:function(){return this._set_destination},getInitialValue:function(){return this._initialValue},getInitialDestination:function(){return this._initialDestination},setValue:function(t){if(Array.isArray(t)){const i=this._value_changed;for(var e=0,n=t.length;e<n;++e)i[e]=t[e];i.length=n}else this._value_changed=t},duplicate:function(t){const e=this.getArray();return e.assign(t),e},equals:function(t,e,n){if(t.length!==e.length)return!1;const i=this.a;let o=0;for(let n=0,r=t.length;n<r;++n)o=Math.max(i.assign(t[n]).subtract(e[n]).magnitude());return o<n},interpolate:function(t,e,n){const i=this.array;i.assign(t);for(let t=0,o=i.length;t<o;++t)i[t].lerp(e[t]||this.zero,n);return i},set_destination__:function(){const e=this.getBuffer(),n=this._set_destination.length;for(let t=0,i=e.length;t<i;++t){const i=e[t];for(let t=i.length;t<n;++t)i[t]=this.getVector();i.length=n}t.prototype.set_destination__.call(this)}},e};n.set("x_ite/Browser/Followers/X3DArrayFollowerTemplate",hS);const dS=hS;const pS=function(t){const e=dS(t);function n(){e.call(this),this.array=this.getArray()}return Object.assign(n.prototype,e.prototype,{step:function(t,e,n){const i=this.output,o=this.deltaOut;for(let r=0,s=i.length;r<s;++r)i[r].add(o.assign(t[r]||this.zero).subtract(e[r]||this.zero).multiply(n))}}),n};n.set("x_ite/Browser/Followers/X3DArrayChaserTemplate",pS);const fS=pS;var gS=fS(yp);function mS(t){yp.call(this,t),gS.call(this,t),this.addType(c.CoordinateChaser)}mS.prototype=Object.assign(Object.create(yp.prototype),gS.prototype,{constructor:mS,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new Y([new B(c.inputOutput,"metadata",new Ri.SFNode),new B(c.inputOnly,"set_value",new Ri.MFVec3f),new B(c.inputOnly,"set_destination",new Ri.MFVec3f),new B(c.initializeOnly,"initialValue",new Ri.MFVec3f(new xe(0,0,0))),new B(c.initializeOnly,"initialDestination",new Ri.MFVec3f(new xe(0,0,0))),new B(c.initializeOnly,"duration",new Ri.SFTime(1)),new B(c.outputOnly,"isActive",new Ri.SFBool),new B(c.outputOnly,"value_changed",new Ri.MFVec3f)]),getTypeName:function(){return"CoordinateChaser"},getComponentName:function(){return"Followers"},getContainerField:function(){return"children"},getVector:function(){return new xe(0,0,0)}});const _S=mS;n.set("x_ite/Components/Followers/CoordinateChaser",_S);const xS=_S;var yS=dS(iS);function wS(t){iS.call(this,t),yS.call(this,t),this.addType(c.CoordinateDamper)}wS.prototype=Object.assign(Object.create(iS.prototype),yS.prototype,{constructor:wS,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new Y([new B(c.inputOutput,"metadata",new Ri.SFNode),new B(c.inputOnly,"set_value",new Ri.MFVec3f),new B(c.inputOnly,"set_destination",new Ri.MFVec3f),new B(c.initializeOnly,"initialValue",new Ri.MFVec3f(new xe(0,0,0))),new B(c.initializeOnly,"initialDestination",new Ri.MFVec3f(new xe(0,0,0))),new B(c.initializeOnly,"order",new Ri.SFInt32(3)),new B(c.inputOutput,"tau",new Ri.SFTime(.3)),new B(c.inputOutput,"tolerance",new Ri.SFFloat(-1)),new B(c.outputOnly,"isActive",new Ri.SFBool),new B(c.outputOnly,"value_changed",new Ri.MFVec3f)]),getTypeName:function(){return"CoordinateDamper"},getComponentName:function(){return"Followers"},getContainerField:function(){return"children"},getVector:function(){return new xe(0,0,0)}});const SS=wS;n.set("x_ite/Components/Followers/CoordinateDamper",SS);const TS=SS;var bS=new an(0,0,1,0),vS=new an(0,0,1,0);function CS(t){iS.call(this,t),this.addType(c.OrientationDamper),this._set_value.setUnit("angle"),this._set_destination.setUnit("angle"),this._initialValue.setUnit("angle"),this._initialDestination.setUnit("angle"),this._value_changed.setUnit("angle")}CS.prototype=Object.assign(Object.create(iS.prototype),{constructor:CS,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new Y([new B(c.inputOutput,"metadata",new Ri.SFNode),new B(c.inputOnly,"set_value",new Ri.SFRotation),new B(c.inputOnly,"set_destination",new Ri.SFRotation),new B(c.initializeOnly,"initialValue",new Ri.SFRotation),new B(c.initializeOnly,"initialDestination",new Ri.SFRotation),new B(c.initializeOnly,"order",new Ri.SFInt32(3)),new B(c.inputOutput,"tau",new Ri.SFTime(.3)),new B(c.inputOutput,"tolerance",new Ri.SFFloat(-1)),new B(c.outputOnly,"isActive",new Ri.SFBool),new B(c.outputOnly,"value_changed",new Ri.SFRotation)]),getTypeName:function(){return"OrientationDamper"},getComponentName:function(){return"Followers"},getContainerField:function(){return"children"},getVector:function(){return new an(0,0,1,0)},equals:function(t,e,n){return bS.assign(t).inverse().multRight(e),Math.abs(bS.angle)<n},interpolate:function(t,e,n){return vS.assign(t).slerp(e,n)}});const ES=CS;n.set("x_ite/Components/Followers/OrientationDamper",ES);const OS=ES;function NS(t){yp.call(this,t),this.addType(c.PositionChaser2D)}NS.prototype=Object.assign(Object.create(yp.prototype),{constructor:NS,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new Y([new B(c.inputOutput,"metadata",new Ri.SFNode),new B(c.inputOnly,"set_value",new Ri.SFVec2f),new B(c.inputOnly,"set_destination",new Ri.SFVec2f),new B(c.initializeOnly,"initialValue",new Ri.SFVec2f),new B(c.initializeOnly,"initialDestination",new Ri.SFVec2f),new B(c.initializeOnly,"duration",new Ri.SFTime(1)),new B(c.outputOnly,"isActive",new Ri.SFBool),new B(c.outputOnly,"value_changed",new Ri.SFVec2f)]),getTypeName:function(){return"PositionChaser2D"},getComponentName:function(){return"Followers"},getContainerField:function(){return"children"},getVector:function(){return new de(0,0)}});const FS=NS;n.set("x_ite/Components/Followers/PositionChaser2D",FS);const IS=FS;function MS(t){iS.call(this,t),this.addType(c.PositionDamper)}MS.prototype=Object.assign(Object.create(iS.prototype),{constructor:MS,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new Y([new B(c.inputOutput,"metadata",new Ri.SFNode),new B(c.inputOnly,"set_value",new Ri.SFVec3f),new B(c.inputOnly,"set_destination",new Ri.SFVec3f),new B(c.initializeOnly,"initialValue",new Ri.SFVec3f),new B(c.initializeOnly,"initialDestination",new Ri.SFVec3f),new B(c.initializeOnly,"order",new Ri.SFInt32(3)),new B(c.inputOutput,"tolerance",new Ri.SFFloat(-1)),new B(c.inputOutput,"tau",new Ri.SFTime(.3)),new B(c.outputOnly,"value_changed",new Ri.SFVec3f),new B(c.outputOnly,"isActive",new Ri.SFBool)]),getTypeName:function(){return"PositionDamper"},getComponentName:function(){return"Followers"},getContainerField:function(){return"children"},getVector:function(){return new xe(0,0,0)}});const DS=MS;n.set("x_ite/Components/Followers/PositionDamper",DS);const VS=DS;function RS(t){iS.call(this,t),this.addType(c.PositionDamper2D)}RS.prototype=Object.assign(Object.create(iS.prototype),{constructor:RS,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new Y([new B(c.inputOutput,"metadata",new Ri.SFNode),new B(c.inputOnly,"set_value",new Ri.SFVec2f),new B(c.inputOnly,"set_destination",new Ri.SFVec2f),new B(c.initializeOnly,"initialValue",new Ri.SFVec2f),new B(c.initializeOnly,"initialDestination",new Ri.SFVec2f),new B(c.initializeOnly,"order",new Ri.SFInt32(3)),new B(c.inputOutput,"tau",new Ri.SFTime(.3)),new B(c.inputOutput,"tolerance",new Ri.SFFloat(-1)),new B(c.outputOnly,"isActive",new Ri.SFBool),new B(c.outputOnly,"value_changed",new Ri.SFVec2f)]),getTypeName:function(){return"PositionDamper2D"},getComponentName:function(){return"Followers"},getContainerField:function(){return"children"},getVector:function(){return new de(0,0)}});const PS=RS;n.set("x_ite/Components/Followers/PositionDamper2D",PS);const AS=PS;function LS(t){yp.call(this,t),this.addType(c.ScalarChaser)}LS.prototype=Object.assign(Object.create(yp.prototype),{constructor:LS,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new Y([new B(c.inputOutput,"metadata",new Ri.SFNode),new B(c.inputOnly,"set_value",new Ri.SFFloat),new B(c.inputOnly,"set_destination",new Ri.SFFloat),new B(c.initializeOnly,"initialValue",new Ri.SFFloat),new B(c.initializeOnly,"initialDestination",new Ri.SFFloat),new B(c.initializeOnly,"duration",new Ri.SFTime(1)),new B(c.outputOnly,"isActive",new Ri.SFBool),new B(c.outputOnly,"value_changed",new Ri.SFFloat)]),getTypeName:function(){return"ScalarChaser"},getComponentName:function(){return"Followers"},getContainerField:function(){return"children"},getVector:function(){return 0},setPreviousValue:function(t){this.previousValue=t},setDestination:function(t){this.destination=t},duplicate:function(t){return t},assign:function(t,e,n){t[e]=n},equals:function(t,e,n){return Math.abs(t-e)<n},interpolate:function(t,e,n){return gt.lerp(t,e,n)},step:function(t,e,n){this.output+=(t-e)*n}});const BS=LS;n.set("x_ite/Components/Followers/ScalarChaser",BS);const XS=BS;function US(t){iS.call(this,t),this.addType(c.ScalarDamper)}US.prototype=Object.assign(Object.create(iS.prototype),{constructor:US,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new Y([new B(c.inputOutput,"metadata",new Ri.SFNode),new B(c.inputOnly,"set_value",new Ri.SFFloat),new B(c.inputOnly,"set_destination",new Ri.SFFloat),new B(c.initializeOnly,"initialValue",new Ri.SFFloat),new B(c.initializeOnly,"initialDestination",new Ri.SFFloat),new B(c.initializeOnly,"order",new Ri.SFInt32(3)),new B(c.inputOutput,"tau",new Ri.SFTime(.3)),new B(c.inputOutput,"tolerance",new Ri.SFFloat(-1)),new B(c.outputOnly,"isActive",new Ri.SFBool),new B(c.outputOnly,"value_changed",new Ri.SFFloat)]),getTypeName:function(){return"ScalarDamper"},getComponentName:function(){return"Followers"},getContainerField:function(){return"children"},getVector:function(){return 0},duplicate:function(t){return t},assign:function(t,e,n){t[e]=n},equals:function(t,e,n){return Math.abs(t-e)<n},interpolate:function(t,e,n){return gt.lerp(t,e,n)}});const kS=US;n.set("x_ite/Components/Followers/ScalarDamper",kS);const zS=kS;var jS=fS(yp);function GS(t){yp.call(this,t),jS.call(this,t),this.addType(c.TexCoordChaser2D)}GS.prototype=Object.assign(Object.create(yp.prototype),jS.prototype,{constructor:GS,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new Y([new B(c.inputOutput,"metadata",new Ri.SFNode),new B(c.inputOnly,"set_value",new Ri.MFVec2f),new B(c.inputOnly,"set_destination",new Ri.MFVec2f),new B(c.initializeOnly,"initialValue",new Ri.MFVec2f),new B(c.initializeOnly,"initialDestination",new Ri.MFVec2f),new B(c.initializeOnly,"duration",new Ri.SFTime(1)),new B(c.outputOnly,"isActive",new Ri.SFBool),new B(c.outputOnly,"value_changed",new Ri.MFVec2f)]),getTypeName:function(){return"TexCoordChaser2D"},getComponentName:function(){return"Followers"},getContainerField:function(){return"children"},getVector:function(){return new de(0,0)}});const HS=GS;n.set("x_ite/Components/Followers/TexCoordChaser2D",HS);const qS=HS;var YS=dS(iS);function WS(t){iS.call(this,t),YS.call(this,t),this.addType(c.TexCoordDamper2D)}WS.prototype=Object.assign(Object.create(iS.prototype),YS.prototype,{constructor:WS,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new Y([new B(c.inputOutput,"metadata",new Ri.SFNode),new B(c.inputOnly,"set_value",new Ri.MFVec2f),new B(c.inputOnly,"set_destination",new Ri.MFVec2f),new B(c.initializeOnly,"initialValue",new Ri.MFVec2f),new B(c.initializeOnly,"initialDestination",new Ri.MFVec2f),new B(c.initializeOnly,"order",new Ri.SFInt32(3)),new B(c.inputOutput,"tau",new Ri.SFTime(.3)),new B(c.inputOutput,"tolerance",new Ri.SFFloat(-1)),new B(c.outputOnly,"isActive",new Ri.SFBool),new B(c.outputOnly,"value_changed",new Ri.MFVec2f)]),getTypeName:function(){return"TexCoordDamper2D"},getComponentName:function(){return"Followers"},getContainerField:function(){return"children"},getVector:function(){return new de(0,0,0)}});const KS=WS;n.set("x_ite/Components/Followers/TexCoordDamper2D",KS);const JS={ColorChaser:tS,ColorDamper:lS,CoordinateChaser:xS,CoordinateDamper:TS,OrientationChaser:Op,OrientationDamper:OS,PositionChaser:Tp,PositionChaser2D:IS,PositionDamper:VS,PositionDamper2D:AS,ScalarChaser:XS,ScalarDamper:zS,TexCoordChaser2D:qS,TexCoordDamper2D:KS},ZS={X3DChaserNode:yp,X3DDamperNode:iS,X3DFollowerNode:mp};for(const t in JS)Qo.addType(t,JS[t]);for(const t in ZS)Qo.addAbstractType(t,ZS[t]);const QS=void 0;n.set("x_ite/Components/Followers",QS);function $S(t){Pa.call(this,t),this.addType(c.Box),this._size.setUnit("length")}$S.prototype=Object.assign(Object.create(Pa.prototype),{constructor:$S,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new Y([new B(c.inputOutput,"metadata",new Ri.SFNode),new B(c.initializeOnly,"size",new Ri.SFVec3f(2,2,2)),new B(c.initializeOnly,"solid",new Ri.SFBool(!0))]),getTypeName:function(){return"Box"},getComponentName:function(){return"Geometry3D"},getContainerField:function(){return"geometry"},build:function(){const t=new xe(2,2,2);return function(){const e=this.getBrowser().getBoxOptions().getGeometry(),n=this._size.getValue();if(this.setMultiTexCoords(e.getMultiTexCoords()),this.setNormals(e.getNormals()),n.equals(t))this.setVertices(e.getVertices()),this.getMin().assign(e.getMin()),this.getMax().assign(e.getMax());else{const t=xe.divide(n,2),i=e.getVertices().getValue(),o=this.getVertices();let r=t.x,s=t.y,a=t.z;for(let t=0,e=i.length;t<e;t+=4)o.push(r*i[t],s*i[t+1],a*i[t+2],1);r=Math.abs(r),s=Math.abs(s),a=Math.abs(a),this.getMin().set(-r,-s,-a),this.getMax().set(r,s,a)}this.setSolid(this._solid.getValue())}}()});const tT=$S;n.set("x_ite/Components/Geometry3D/Box",tT);const eT=tT;function nT(t){Pa.call(this,t),this.addType(c.Cone),this._height.setUnit("length"),this._bottomRadius.setUnit("length")}nT.prototype=Object.assign(Object.create(Pa.prototype),{constructor:nT,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new Y([new B(c.inputOutput,"metadata",new Ri.SFNode),new B(c.inputOutput,"side",new Ri.SFBool(!0)),new B(c.inputOutput,"bottom",new Ri.SFBool(!0)),new B(c.initializeOnly,"height",new Ri.SFFloat(2)),new B(c.initializeOnly,"bottomRadius",new Ri.SFFloat(1)),new B(c.initializeOnly,"solid",new Ri.SFBool(!0))]),getTypeName:function(){return"Cone"},getComponentName:function(){return"Geometry3D"},getContainerField:function(){return"geometry"},set_live__:function(){Pa.prototype.set_live__.call(this),this.isLive().getValue()?this.getBrowser().getConeOptions().addInterest("requestRebuild",this):this.getBrowser().getConeOptions().removeInterest("requestRebuild",this)},build:function(){const t=this.getBrowser().getConeOptions()._xDimension.getValue(),e=this._height.getValue(),n=this._bottomRadius.getValue(),i=this.getTexCoords(),o=this.getNormals(),r=this.getVertices();this.getMultiTexCoords().push(i);const s=e/2,a=-s,u=ka.Polar(1,-Math.PI/2+Math.atan(n/e));if(this._side.getValue())for(let e=0;e<t;++e){const c=(e+.5)/t,l=2*Math.PI*c,h=ka.Polar(u.imag,l),d=e/t,p=2*Math.PI*d,f=ka.Polar(-n,p),g=ka.Polar(u.imag,p),m=(e+1)/t,_=2*Math.PI*m,x=ka.Polar(-n,_),y=ka.Polar(u.imag,_);i.push(c,1,0,1),o.push(h.imag,u.real,h.real),r.push(0,s,0,1),i.push(d,0,0,1),o.push(g.imag,u.real,g.real),r.push(f.imag,a,f.real,1),i.push(m,0,0,1),o.push(y.imag,u.real,y.real),r.push(x.imag,a,x.real,1)}if(this._bottom.getValue()){const e=[],s=[];for(let i=t-1;i>-1;--i){const o=i/t,r=2*Math.PI*o,u=ka.Polar(-1,r),c=ka.multiply(u,n);e.push(new de((u.imag+1)/2,(u.real+1)/2)),s.push(new xe(c.imag,a,c.real))}const u=e[0],c=s[0];for(let t=1,n=s.length-1;t<n;++t){const n=e[t],a=e[t+1],l=s[t],h=s[t+1];i.push(u.x,u.y,0,1),o.push(0,-1,0),r.push(c.x,c.y,c.z,1),i.push(n.x,n.y,0,1),o.push(0,-1,0),r.push(l.x,l.y,l.z,1),i.push(a.x,a.y,0,1),o.push(0,-1,0),r.push(h.x,h.y,h.z,1)}}this.setSolid(this._solid.getValue()),this.setExtents()},setExtents:function(){const t=this._bottomRadius.getValue(),e=this._height.getValue()/2,n=-e;this._side.getValue()||this._bottom.getValue()?this._side.getValue()?(this.getMin().set(-t,n,-t),this.getMax().set(t,e,t)):(this.getMin().set(-t,n,-t),this.getMax().set(t,n,t)):(this.getMin().set(0,0,0),this.getMax().set(0,0,0))}});const iT=nT;n.set("x_ite/Components/Geometry3D/Cone",iT);const oT=iT;function rT(t){Pa.call(this,t),this.addType(c.Cylinder),this._height.setUnit("length"),this._radius.setUnit("length")}rT.prototype=Object.assign(Object.create(Pa.prototype),{constructor:rT,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new Y([new B(c.inputOutput,"metadata",new Ri.SFNode),new B(c.inputOutput,"top",new Ri.SFBool(!0)),new B(c.inputOutput,"side",new Ri.SFBool(!0)),new B(c.inputOutput,"bottom",new Ri.SFBool(!0)),new B(c.initializeOnly,"height",new Ri.SFFloat(2)),new B(c.initializeOnly,"radius",new Ri.SFFloat(1)),new B(c.initializeOnly,"solid",new Ri.SFBool(!0))]),getTypeName:function(){return"Cylinder"},getComponentName:function(){return"Geometry3D"},getContainerField:function(){return"geometry"},set_live__:function(){Pa.prototype.set_live__.call(this),this.isLive().getValue()?this.getBrowser().getCylinderOptions().addInterest("requestRebuild",this):this.getBrowser().getCylinderOptions().removeInterest("requestRebuild",this)},build:function(){const t=this.getBrowser().getCylinderOptions()._xDimension.getValue(),e=this.getTexCoords(),n=this.getNormals(),i=this.getVertices();this.getMultiTexCoords().push(e);const o=this._radius.getValue(),r=this._height.getValue()/2,s=-r;if(this._side.getValue())for(let a=0;a<t;++a){const u=a/t,c=2*Math.PI*u,l=ka.Polar(-1,c),h=ka.multiply(l,o),d=(a+1)/t,p=2*Math.PI*d,f=ka.Polar(-1,p),g=ka.multiply(f,o);e.push(u,1,0,1),n.push(l.imag,0,l.real),i.push(h.imag,r,h.real,1),e.push(u,0,0,1),n.push(l.imag,0,l.real),i.push(h.imag,s,h.real,1),e.push(d,0,0,1),n.push(f.imag,0,f.real),i.push(g.imag,s,g.real,1),e.push(u,1,0,1),n.push(l.imag,0,l.real),i.push(h.imag,r,h.real,1),e.push(d,0,0,1),n.push(f.imag,0,f.real),i.push(g.imag,s,g.real,1),e.push(d,1,0,1),n.push(f.imag,0,f.real),i.push(g.imag,r,g.real,1)}if(this._top.getValue()){const s=[],a=[];for(let e=0;e<t;++e){const n=e/t,i=2*Math.PI*n,u=ka.Polar(-1,i);s.push(new de((u.imag+1)/2,-(u.real-1)/2)),a.push(new xe(u.imag*o,r,u.real*o))}const u=s[0],c=a[0];for(let t=1,o=a.length-1;t<o;++t){const o=s[t],r=s[t+1],l=a[t],h=a[t+1];e.push(u.x,u.y,0,1),n.push(0,1,0),i.push(c.x,c.y,c.z,1),e.push(o.x,o.y,0,1),n.push(0,1,0),i.push(l.x,l.y,l.z,1),e.push(r.x,r.y,0,1),n.push(0,1,0),i.push(h.x,h.y,h.z,1)}}if(this._bottom.getValue()){const r=[],a=[];for(let e=t-1;e>-1;--e){const n=e/t,i=2*Math.PI*n,u=ka.Polar(-1,i);r.push(new de((u.imag+1)/2,(u.real+1)/2)),a.push(new xe(u.imag*o,s,u.real*o))}const u=r[0],c=a[0];for(let t=1,o=a.length-1;t<o;++t){const o=r[t],s=r[t+1],l=a[t],h=a[t+1];e.push(u.x,u.y,0,1),n.push(0,-1,0),i.push(c.x,c.y,c.z,1),e.push(o.x,o.y,0,1),n.push(0,-1,0),i.push(l.x,l.y,l.z,1),e.push(s.x,s.y,0,1),n.push(0,-1,0),i.push(h.x,h.y,h.z,1)}}this.setSolid(this._solid.getValue()),this.setExtents()},setExtents:function(){const t=this._radius.getValue(),e=this._height.getValue()/2,n=-e;this._top.getValue()||this._side.getValue()||this._bottom.getValue()?this._top.getValue()||this._side.getValue()?this._bottom.getValue()||this._side.getValue()?(this.getMin().set(-t,n,-t),this.getMax().set(t,e,t)):(this.getMin().set(-t,e,-t),this.getMax().set(t,e,t)):(this.getMin().set(-t,n,-t),this.getMax().set(t,n,t)):(this.getMin().set(0,0,0),this.getMax().set(0,0,0))}});const sT=rT;n.set("x_ite/Components/Geometry3D/Cylinder",sT);const aT=sT;function uT(t){Pa.call(this,t),this.addType(c.ElevationGrid),this._xSpacing.setUnit("length"),this._zSpacing.setUnit("length"),this._creaseAngle.setUnit("angle"),this._height.setUnit("length"),this.fogCoordNode=null,this.colorNode=null,this.texCoordNode=null,this.normalNode=null,this.coordNode=null}uT.prototype=Object.assign(Object.create(Pa.prototype),{constructor:uT,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new Y([new B(c.inputOutput,"metadata",new Ri.SFNode),new B(c.inputOnly,"set_height",new Ri.MFFloat),new B(c.initializeOnly,"xDimension",new Ri.SFInt32),new B(c.initializeOnly,"zDimension",new Ri.SFInt32),new B(c.initializeOnly,"xSpacing",new Ri.SFFloat(1)),new B(c.initializeOnly,"zSpacing",new Ri.SFFloat(1)),new B(c.initializeOnly,"solid",new Ri.SFBool(!0)),new B(c.initializeOnly,"ccw",new Ri.SFBool(!0)),new B(c.initializeOnly,"creaseAngle",new Ri.SFFloat),new B(c.initializeOnly,"colorPerVertex",new Ri.SFBool(!0)),new B(c.initializeOnly,"normalPerVertex",new Ri.SFBool(!0)),new B(c.inputOutput,"attrib",new Ri.MFNode),new B(c.inputOutput,"fogCoord",new Ri.SFNode),new B(c.inputOutput,"color",new Ri.SFNode),new B(c.inputOutput,"texCoord",new Ri.SFNode),new B(c.inputOutput,"normal",new Ri.SFNode),new B(c.initializeOnly,"height",new Ri.MFFloat)]),getTypeName:function(){return"ElevationGrid"},getComponentName:function(){return"Geometry3D"},getContainerField:function(){return"geometry"},initialize:function(){Pa.prototype.initialize.call(this),this._set_height.addFieldInterest(this._height),this._attrib.addInterest("set_attrib__",this),this._fogCoord.addInterest("set_fogCoord__",this),this._color.addInterest("set_color__",this),this._texCoord.addInterest("set_texCoord__",this),this._normal.addInterest("set_normal__",this),this.set_attrib__(),this.set_fogCoord__(),this.set_color__(),this.set_texCoord__(),this.set_normal__()},set_attrib__:function(){const t=this.getAttrib();for(const e of t)e.removeInterest("requestRebuild",this),e._attribute_changed.removeInterest("updateVertexArrays",this);t.length=0;for(const e of this._attrib){const n=nu(c.X3DVertexAttributeNode,e);n&&t.push(n)}for(const e of t)e.addInterest("requestRebuild",this),e._attribute_changed.addInterest("updateVertexArrays",this);this.updateVertexArrays()},set_fogCoord__:function(){this.fogCoordNode&&this.fogCoordNode.removeInterest("requestRebuild",this),this.fogCoordNode=nu(c.FogCoordinate,this._fogCoord),this.fogCoordNode&&this.fogCoordNode.addInterest("requestRebuild",this)},set_color__:function(){this.colorNode&&(this.colorNode.removeInterest("requestRebuild",this),this.colorNode._transparent.removeInterest("set_transparent__",this)),this.colorNode=nu(c.X3DColorNode,this._color),this.colorNode?(this.colorNode.addInterest("requestRebuild",this),this.colorNode._transparent.addInterest("set_transparent__",this),this.set_transparent__()):this.setTransparent(!1)},set_transparent__:function(){this.setTransparent(this.colorNode.getTransparent())},set_texCoord__:function(){this.texCoordNode&&this.texCoordNode.removeInterest("requestRebuild",this),this.texCoordNode=nu(c.X3DTextureCoordinateNode,this._texCoord),this.texCoordNode&&this.texCoordNode.addInterest("requestRebuild",this),this.setTextureCoordinate(this.texCoordNode)},set_normal__:function(){this.normalNode&&this.normalNode.removeInterest("requestRebuild",this),this.normalNode=nu(c.X3DNormalNode,this._normal),this.normalNode&&this.normalNode.addInterest("requestRebuild",this)},getColor:function(){return this.colorNode},getTexCoord:function(){return this.texCoordNode},getNormal:function(){return this.normalNode},getHeight:function(t){return t<this._height.length?this._height[t]:0},createTexCoords:function(){const t=[],e=this._xDimension.getValue(),n=this._zDimension.getValue(),i=e-1,o=n-1;for(let r=0;r<n;++r)for(let n=0;n<e;++n)t.push(new de(n/i,r/o));return t},createNormals:function(t,e,n){const i=!this._ccw.getValue(),o=[],r=[];for(let e=0,n=t.length;e<n;++e)o[e]=[];for(let n=0,s=e.length;n<s;n+=3){const s=e[n],a=e[n+1],u=e[n+2];o[s].push(r.length),o[a].push(r.length+1),o[u].push(r.length+2);const c=vs.normal(t[s],t[a],t[u],new xe(0,0,0));i&&c.negate(),r.push(c),r.push(c),r.push(c)}return this.refineNormals(o,r,this._creaseAngle.getValue())},createCoordIndex:function(){const t=[],e=this._xDimension.getValue(),n=e-1,i=this._zDimension.getValue()-1;for(let o=0;o<i;++o)for(let i=0;i<n;++i){const n=o*e+i,r=(o+1)*e+i,s=(o+1)*e+(i+1),a=o*e+(i+1);t.push(n),t.push(r),t.push(s),t.push(n),t.push(s),t.push(a)}return t},createPoints:function(){const t=[],e=this._xDimension.getValue(),n=this._zDimension.getValue(),i=this._xSpacing.getValue(),o=this._zSpacing.getValue();for(let r=0;r<n;++r)for(let n=0;n<e;++n)t.push(new xe(i*n,this.getHeight(n+r*e),o*r));return t},build:function(){if(this._xDimension.getValue()<2||this._zDimension.getValue()<2)return;const t=this._colorPerVertex.getValue(),e=this._normalPerVertex.getValue(),n=this.createCoordIndex(),i=this.getAttrib(),o=i.length,r=this.getAttribs(),s=this.fogCoordNode,a=this.getColor(),u=this.getTexCoord(),c=this.getNormal(),l=this.createPoints(),h=this.getFogDepths(),d=this.getColors(),p=this.getMultiTexCoords(),f=this.getNormals(),g=this.getVertices();let m=0;if(u)u.init(p);else{var _=this.createTexCoords(),x=this.getTexCoords();p.push(x)}for(let y=0,w=n.length;y<w;++m)for(let w=0;w<6;++w,++y){const w=n[y],S=l[w];for(let t=0;t<o;++t)i[t].addValue(w,r[t]);if(s&&s.addDepth(w,h),a&&(t?a.addColor(w,d):a.addColor(m,d)),u)u.addTexCoord(w,p);else{const t=_[w];x.push(t.x,t.y,0,1)}c&&(e?c.addVector(w,f):c.addVector(m,f)),g.push(S.x,S.y,S.z,1)}if(!c){const t=this.createNormals(l,n);for(const e of t)f.push(e.x,e.y,e.z)}this.setSolid(this._solid.getValue()),this.setCCW(this._ccw.getValue())}});const cT=uT;n.set("x_ite/Components/Geometry3D/ElevationGrid",cT);const lT=cT;function hT(t){Pa.call(this,t),this.addType(c.Extrusion),this._creaseAngle.setUnit("angle"),this._crossSection.setUnit("length"),this._spine.setUnit("length")}hT.prototype=Object.assign(Object.create(Pa.prototype),{constructor:hT,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new Y([new B(c.inputOutput,"metadata",new Ri.SFNode),new B(c.inputOnly,"set_crossSection",new Ri.MFVec2f),new B(c.inputOnly,"set_orientation",new Ri.MFRotation),new B(c.inputOnly,"set_scale",new Ri.MFVec2f),new B(c.inputOnly,"set_spine",new Ri.MFVec3f),new B(c.initializeOnly,"beginCap",new Ri.SFBool(!0)),new B(c.initializeOnly,"endCap",new Ri.SFBool(!0)),new B(c.initializeOnly,"solid",new Ri.SFBool(!0)),new B(c.initializeOnly,"ccw",new Ri.SFBool(!0)),new B(c.initializeOnly,"convex",new Ri.SFBool(!0)),new B(c.initializeOnly,"creaseAngle",new Ri.SFFloat),new B(c.initializeOnly,"crossSection",new Ri.MFVec2f(new de(1,1),new de(1,-1),new de(-1,-1),new de(-1,1),new de(1,1))),new B(c.initializeOnly,"orientation",new Ri.MFRotation(new an)),new B(c.initializeOnly,"scale",new Ri.MFVec2f(new de(1,1))),new B(c.initializeOnly,"spine",new Ri.MFVec3f(new xe(0,0,0),new xe(0,1,0)))]),getTypeName:function(){return"Extrusion"},getComponentName:function(){return"Geometry3D"},getContainerField:function(){return"geometry"},initialize:function(){Pa.prototype.initialize.call(this),this._set_crossSection.addFieldInterest(this._crossSection),this._set_orientation.addFieldInterest(this._orientation),this._set_scale.addFieldInterest(this._scale),this._set_spine.addFieldInterest(this._spine)},getClosedOrientation:function(){const t=this._orientation;if(t.length){const e=t[0].getValue(),n=t[t.length-1].getValue();return e.equals(n)}return!0},createPoints:function(){const t=new xe(1,1,1);return function(){const e=this._crossSection,n=this._orientation,i=this._scale,o=this._spine,r=[],s=this.createRotations();for(let a=0,u=o.length;a<u;++a){const o=s[a];if(n.length&&o.rotate(n[Math.min(a,n.length-1)].getValue()),i.length){const e=i[Math.min(a,i.length-1)].getValue();o.scale(t.set(e.x,1,e.y))}for(let t=0,n=e.length;t<n;++t){const n=e[t].getValue();r.push(o.multVecMatrix(new xe(n.x,0,n.y)))}}return r}}(),createRotations:function(){const t=[],e=new xe(0,0,0),n=new xe(0,0,0),i=new xe(0,0,0),o=new xe(0,0,0),r=new xe(0,0,0),s=new xe(0,0,0),a=new an(0,0,1,0);return function(){const u=this._spine,c=u.length,l=u[0].getValue(),h=u[u.length-1].getValue(),d=l.equals(h)&&this.getClosedOrientation();for(let e=t.length;e<c;++e)t[e]=new hn;if(t.length=c,e.set(0,0,0),n.set(0,0,0),i.set(0,0,0),d){const t=l;for(let e=1,i=c-2;e<i&&(n.assign(u[e].getValue()).subtract(t).normalize().subtract(s.assign(u[i].getValue()).subtract(t).normalize()).normalize(),n.equals(xe.Zero));++e);for(let t=0,e=c-2;t<e&&(i.assign(u[t+1].getValue()).subtract(u[t].getValue()).cross(s.assign(u[e].getValue()).subtract(u[t].getValue())).normalize(),i.equals(xe.Zero));++t);}else{for(let t=0,e=c-1;t<e&&(n.assign(u[t+1].getValue()).subtract(u[t].getValue()).normalize(),n.equals(xe.Zero));++t);for(let t=1,e=c-1;t<e&&(i.assign(u[t+1].getValue()).subtract(u[t].getValue()).cross(s.assign(u[t-1].getValue()).subtract(u[t].getValue())).normalize(),i.equals(xe.Zero));++t);}n.equals(xe.Zero)&&n.set(0,1,0),i.equals(xe.Zero)&&a.setFromToVec(xe.yAxis,n).multVecRot(i.assign(xe.zAxis)),e.assign(n).cross(i);const p=l;t[0].set(e.x,e.y,e.z,0,n.x,n.y,n.z,0,i.x,i.y,i.z,0,p.x,p.y,p.z,1),o.assign(n),r.assign(i);for(let a=1,l=c-1;a<l;++a){const c=u[a].getValue();n.assign(u[a+1].getValue()).subtract(c).normalize().subtract(s.assign(u[a-1].getValue()).subtract(c).normalize()).normalize(),i.assign(u[a+1].getValue()).subtract(c).cross(s.assign(u[a-1].getValue()).subtract(c)).normalize(),r.dot(i)<0&&i.negate(),n.equals(xe.Zero)?n.assign(o):o.assign(n),i.equals(xe.Zero)?i.assign(r):r.assign(i),e.assign(n).cross(i),t[a].set(e.x,e.y,e.z,0,n.x,n.y,n.z,0,i.x,i.y,i.z,0,c.x,c.y,c.z,1)}if(d)t[c-1].assign(t[0]);else{const a=h;n.assign(a).subtract(u[c-2].getValue()).normalize(),c>2&&i.assign(a).subtract(u[c-2].getValue()).cross(s.assign(u[c-3].getValue()).subtract(u[c-2].getValue())).normalize(),r.dot(i)<0&&i.negate(),n.equals(xe.Zero)&&n.assign(o),i.equals(xe.Zero)&&i.assign(r),e.assign(n).cross(i),t[c-1].set(e.x,e.y,e.z,0,n.x,n.y,n.z,0,i.x,i.y,i.z,0,a.x,a.y,a.z,1)}return t}}(),build:function(){const t=new de(0,0,0),e=new de(0,0,0),n=new de(0,0,0);return function(){const i=!this._ccw.getValue(),o=this._crossSection,r=this._spine,s=r.length,a=this.getTexCoords();if(s<2||o.length<2)return;this.getMultiTexCoords().push(a);const u=o.length;function c(t,e){return t*u+e}const l=r[0].getValue(),h=r[s-1].getValue(),d=l.equals(h)&&this.getClosedOrientation(),p=o[0].getValue(),f=o[o.length-1].getValue(),g=p.equals(f);t.assign(o[0].getValue()),e.assign(o[0].getValue());for(let n=1,i=o.length;n<i;++n)t.min(o[n].getValue()),e.max(o[n].getValue());const m=n.assign(e).subtract(t),_=Math.max(m.x,m.y),x=g?o.length-1:o.length,y=[],w=[],S=this.createPoints();for(let t=0,e=S.length;t<e;++t)y[t]=[];const T=this.getNormals(),b=this.getVertices(),v=o.length-1,C=s-1;let E=c(0,0),O=c(0,g?0:v);for(let t=0;t<C;++t)for(let e=0;e<v;++e){const n=d&&t===s-2?0:t+1,r=g&&e===o.length-2?0:e+1;let u=c(t,e),l=c(t,r),h=c(n,r),p=c(n,e),f=S[u],m=S[l],_=S[h],x=S[p],T=m.distance(_)>=1e-7,I=x.distance(f)>=1e-7;if(i)var N=vs.normal(_,m,f,new xe(0,0,0)),F=vs.normal(x,_,f,new xe(0,0,0));else N=vs.normal(f,m,_,new xe(0,0,0)),F=vs.normal(f,_,x,new xe(0,0,0));if(0==e&&(I?E=u:(u=E,f=S[u])),e==o.length-2&&(T?O=l:(h=O,_=S[h])),T){if(I)a.push(e/v,t/C,0,1);else{const n=(t/C+(t+1)/C)/2;a.push(e/v,n,0,1)}y[u].push(w.length),w.push(N),b.push(f.x,f.y,f.z,1),a.push((e+1)/v,t/C,0,1),y[l].push(w.length),w.push(N),b.push(m.x,m.y,m.z,1),a.push((e+1)/v,(t+1)/C,0,1),y[h].push(w.length),w.push(N),b.push(_.x,_.y,_.z,1)}if(I){if(a.push(e/v,t/C,0,1),y[u].push(w.length),w.push(F),b.push(f.x,f.y,f.z,1),T)a.push((e+1)/v,(t+1)/C,0,1);else{const n=((t+1)/C+t/C)/2;a.push((e+1)/v,n,0,1)}y[h].push(w.length),w.push(F),b.push(_.x,_.y,_.z,1),a.push(e/v,(t+1)/C,0,1),y[p].push(w.length),w.push(F),b.push(x.x,x.y,x.z,1)}}const I=this.refineNormals(y,w,this._creaseAngle.getValue());for(const t of I)T.push(t.x,t.y,t.z);if(_&&x>2){if(this._beginCap.getValue()){const e=0,n=[],r=[];for(let i=0;i<x;++i){const r=c(e,x-1-i),s=S[r].copy();s.index=r,s.texCoord=de.subtract(o[x-1-i].getValue(),t).divide(_),n.push(s)}if(this._convex.getValue()?vs.triangulateConvexPolygon(n,r):vs.triangulatePolygon(n,r),r.length>=3){const t=vs.normal(S[r[0].index],S[r[1].index],S[r[2].index],new xe(0,0,0));i&&t.negate(),this.addCap(a,t,S,r)}}if(this._endCap.getValue()){const e=s-1,n=[],r=[];for(let i=0;i<x;++i){const r=c(e,i),s=S[r].copy();s.index=r,s.texCoord=de.subtract(o[i].getValue(),t).divide(_),n.push(s)}if(this._convex.getValue()?vs.triangulateConvexPolygon(n,r):vs.triangulatePolygon(n,r),r.length>=3){const t=vs.normal(S[r[0].index],S[r[1].index],S[r[2].index],new xe(0,0,0));i&&t.negate(),this.addCap(a,t,S,r)}}}this.setSolid(this._solid.getValue()),this.setCCW(this._ccw.getValue())}}(),addCap:function(t,e,n,i){const o=this.getNormals(),r=this.getVertices();for(let s=0,a=i.length;s<a;s+=3){const a=n[i[s].index],u=n[i[s+1].index],c=n[i[s+2].index],l=i[s].texCoord,h=i[s+1].texCoord,d=i[s+2].texCoord;t.push(l.x,l.y,0,1),t.push(h.x,h.y,0,1),t.push(d.x,d.y,0,1),o.push(e.x,e.y,e.z,e.x,e.y,e.z,e.x,e.y,e.z),r.push(a.x,a.y,a.z,1,u.x,u.y,u.z,1,c.x,c.y,c.z,1)}}});const dT=hT;n.set("x_ite/Components/Geometry3D/Extrusion",dT);const pT=dT;function fT(t){Pa.call(this,t),this.addType(c.Sphere),this._radius.setUnit("length")}fT.prototype=Object.assign(Object.create(Pa.prototype),{constructor:fT,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new Y([new B(c.inputOutput,"metadata",new Ri.SFNode),new B(c.initializeOnly,"radius",new Ri.SFFloat(1)),new B(c.initializeOnly,"solid",new Ri.SFBool(!0))]),getTypeName:function(){return"Sphere"},getComponentName:function(){return"Geometry3D"},getContainerField:function(){return"geometry"},set_live__:function(){Pa.prototype.set_live__.call(this),this.isLive().getValue()?this.getBrowser().getSphereOptions().addInterest("requestRebuild",this):this.getBrowser().getSphereOptions().removeInterest("requestRebuild",this)},build:function(){const t=this.getBrowser().getSphereOptions().getGeometry(),e=Math.abs(this._radius.getValue());if(this.setMultiTexCoords(t.getMultiTexCoords()),this.setNormals(t.getNormals()),1===e)this.setVertices(t.getVertices()),this.getMin().assign(t.getMin()),this.getMax().assign(t.getMax());else{const n=t.getVertices().getValue(),i=this.getVertices();for(let t=0,o=n.length;t<o;t+=4)i.push(e*n[t],e*n[t+1],e*n[t+2],1);this.getMin().set(-e,-e,-e),this.getMax().set(e,e,e)}this.setSolid(this._solid.getValue())}});const gT=fT;n.set("x_ite/Components/Geometry3D/Sphere",gT);const mT={Box:eT,Cone:oT,Cylinder:aT,ElevationGrid:lT,Extrusion:pT,IndexedFaceSet:Mh,Sphere:gT},_T={};for(const t in mT)Qo.addType(t,mT[t]);for(const t in _T)Qo.addAbstractType(t,_T[t]);const xT=void 0;n.set("x_ite/Components/Geometry3D",xT);function yT(t){ha.call(this,t),Qu.call(this,t),this.addType(c.StaticGroup),this.group=new rc(this.getExecutionContext()),this.collisionShapes=null,this.shadowShapes=null,this.opaqueShapes=null,this.transparentShapes=null,this.bbox=new Ks,this.shadowBBox=new Ks}yT.prototype=Object.assign(Object.create(ha.prototype),Qu.prototype,{constructor:yT,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new Y([new B(c.inputOutput,"metadata",new Ri.SFNode),new B(c.inputOutput,"visible",new Ri.SFBool(!0)),new B(c.inputOutput,"bboxDisplay",new Ri.SFBool),new B(c.initializeOnly,"bboxSize",new Ri.SFVec3f(-1,-1,-1)),new B(c.initializeOnly,"bboxCenter",new Ri.SFVec3f),new B(c.initializeOnly,"children",new Ri.MFNode)]),getTypeName:function(){return"StaticGroup"},getComponentName:function(){return"Grouping"},getContainerField:function(){return"children"},initialize:function(){ha.prototype.initialize.call(this),Qu.prototype.initialize.call(this),this._bboxSize.addFieldInterest(this.group._bboxSize),this._bboxCenter.addFieldInterest(this.group._bboxCenter),this._children.addFieldInterest(this.group._children),this.group._bboxSize=this._bboxSize,this.group._bboxCenter=this._bboxCenter,this.group._children=this._children,this.group.setPrivate(!0),this.group.setup(),this.group._isCameraObject.addFieldInterest(this._isCameraObject),this.group._isPickableObject.addFieldInterest(this._isPickableObject),this.group._children.addInterest("set_children__",this),this.setCameraObject(this.group.getCameraObject()),this.setPickableObject(this.group.getPickableObject()),this.set_children__()},getBBox:function(t,e){return t.assign(e?this.shadowBBox:this.bbox)},set_children__:function(){this.group.getBBox(this.bbox),this.group.getBBox(this.shadowBBox,!0),this.collisionShapes=null,this.shadowShapes=null,this.opaqueShapes=null,this.transparentShapes=null},traverse:function(){const t=new Rs;return t.intersectsSphere=function(){return!0},function(e,n){switch(e){case Us.CAMERA:return;case Us.POINTER:case Us.COLLISION:{if(!this.collisionShapes){const i=n.getViewVolumes(),o=n.getViewport(),r=n.getProjectionMatrix(),s=n.getModelViewMatrix(),a=n.getNumCollisionShapes();i.push(t.set(r,o,o)),s.push(),s.identity(),this.group.traverse(e,n),s.pop(),i.pop();const u=n.getNumCollisionShapes();this.collisionShapes=n.getCollisionShapes().splice(a,u-a),n.setNumCollisionShapes(a)}const i=n.getModelViewMatrix();for(const t of this.collisionShapes)i.push(),i.multLeft(t.modelViewMatrix),t.shapeNode.traverse(e,n),i.pop();return}case Us.SHADOW:{if(!this.shadowShapes){const i=n.getViewVolumes(),o=n.getViewport(),r=n.getProjectionMatrix(),s=n.getModelViewMatrix(),a=n.getNumShadowShapes();i.push(t.set(r,o,o)),s.push(),s.identity(),this.group.traverse(e,n),s.pop(),i.pop();const u=n.getNumShadowShapes();this.shadowShapes=n.getShadowShapes().splice(a,u-a),n.setNumShadowShapes(a)}const i=n.getModelViewMatrix();for(const t of this.shadowShapes)i.push(),i.multLeft(t.modelViewMatrix),t.shapeNode.traverse(e,n),i.pop();return}case Us.DISPLAY:{if(!this.opaqueShapes){const i=n.getViewVolumes(),o=n.getViewport(),r=n.getProjectionMatrix(),s=n.getModelViewMatrix(),a=n.getNumOpaqueShapes(),u=n.getNumTransparentShapes();i.push(t.set(r,o,o)),s.push(),s.identity(),this.group.traverse(e,n),s.pop(),i.pop();const c=n.getNumOpaqueShapes(),l=n.getNumTransparentShapes();this.opaqueShapes=n.getOpaqueShapes().splice(a,c-a),this.transparentShapes=n.getTransparentShapes().splice(u,l-u),n.setNumOpaqueShapes(a),n.setNumTransparentShapes(u)}const i=n.getModelViewMatrix();for(const t of this.opaqueShapes)i.push(),i.multLeft(t.modelViewMatrix),t.shapeNode.traverse(e,n),i.pop();for(const t of this.transparentShapes)i.push(),i.multLeft(t.modelViewMatrix),t.shapeNode.traverse(e,n),i.pop();return}}}}(),dispose:function(){Qu.prototype.dispose.call(this),ha.prototype.dispose.call(this)}});const wT=yT;n.set("x_ite/Components/Grouping/StaticGroup",wT);const ST=wT;function TT(t){nc.call(this,t),this.addType(c.Switch),"2.0"===t.getSpecificationVersion()&&this.addAlias("choice",this._children),this.childNode=null,this.visibleNode=null,this.boundedObject=null}TT.prototype=Object.assign(Object.create(nc.prototype),{constructor:TT,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new Y([new B(c.inputOutput,"metadata",new Ri.SFNode),new B(c.inputOutput,"whichChoice",new Ri.SFInt32(-1)),new B(c.inputOutput,"visible",new Ri.SFBool(!0)),new B(c.inputOutput,"bboxDisplay",new Ri.SFBool),new B(c.initializeOnly,"bboxSize",new Ri.SFVec3f(-1,-1,-1)),new B(c.initializeOnly,"bboxCenter",new Ri.SFVec3f),new B(c.inputOnly,"addChildren",new Ri.MFNode),new B(c.inputOnly,"removeChildren",new Ri.MFNode),new B(c.inputOutput,"children",new Ri.MFNode)]),getTypeName:function(){return"Switch"},getComponentName:function(){return"Grouping"},getContainerField:function(){return"children"},initialize:function(){nc.prototype.initialize.call(this),this._whichChoice.addInterest("set_child__",this),this._children.addInterest("set_child__",this),this.set_child__()},getSubBBox:function(t,e){if(this._bboxSize.getValue().equals(this.getDefaultBBoxSize())){const n=nu(c.X3DBoundedObject,this.visibleNode);return n?n.getBBox(t,e):t.set()}return t.set(this._bboxSize.getValue(),this._bboxCenter.getValue())},clear:function(){},add:function(){},remove:function(){},set_child__:function(){this.childNode&&(this.childNode._isCameraObject.removeInterest("set_cameraObject__",this),this.childNode._isPickableObject.removeInterest("set_transformSensors__",this)),nu(c.X3DBoundedObject,this.childNode)&&(this.childNode._visible.removeInterest("set_visible__",this),this.childNode._bboxDisplay.removeInterest("set_bboxDisplay__",this));const t=this._whichChoice.getValue();t>=0&&t<this._children.length?(this.childNode=nu(c.X3DChildNode,this._children[t]),this.childNode&&(this.childNode._isCameraObject.addInterest("set_cameraObject__",this),this.childNode._isPickableObject.addInterest("set_transformSensors__",this),nu(c.X3DBoundedObject,this.childNode)&&(this.childNode._visible.addInterest("set_visible__",this),this.childNode._bboxDisplay.addInterest("set_bboxDisplay__",this)),delete this.traverse)):(this.childNode=null,this.traverse=Function.prototype),this.set_transformSensors__(),this.set_visible__(),this.set_bboxDisplay__()},set_cameraObject__:function(){this.childNode&&this.childNode.getCameraObject()?nu(c.X3DBoundedObject,this.childNode)?this.setCameraObject(this.childNode._visible.getValue()):this.setCameraObject(!0):this.setCameraObject(!1)},set_transformSensors__:function(){this.setPickableObject(Boolean(this.getTransformSensors().size||this.childNode&&this.childNode.getPickableObject()))},set_visible__:function(){nu(c.X3DBoundedObject,this.childNode)?this.visibleNode=this.childNode._visible.getValue()?this.childNode:null:this.visibleNode=this.childNode,this.set_cameraObject__()},set_bboxDisplay__:function(){nu(c.X3DBoundedObject,this.childNode)?this.boundedObject=this.childNode._bboxDisplay.getValue()?this.childNode:null:this.boundedObject=null},traverse:function(t,e){switch(t){case Us.POINTER:case Us.CAMERA:case Us.SHADOW:{const n=this.visibleNode;return void(n&&n.traverse(t,e))}case Us.PICKING:{if(this.getTransformSensors().size){const t=e.getModelViewMatrix().get();for(const e of this.getTransformSensors())e.collect(t)}const n=this.childNode;if(n){const i=this.getBrowser().getPickingHierarchy();i.push(this),n.traverse(t,e),i.pop()}return}case Us.COLLISION:{const n=this.childNode;return void(n&&n.traverse(t,e))}case Us.DISPLAY:{const n=this.visibleNode;n&&n.traverse(t,e);const i=this.boundedObject;return void(i&&i.displayBBox(t,e))}}}});const bT=TT;n.set("x_ite/Components/Grouping/Switch",bT);const vT=bT;function CT(t){nc.call(this,t),this.addType(c.X3DTransformMatrix3DNode),this.matrix=new hn}CT.prototype=Object.assign(Object.create(nc.prototype),{constructor:CT,setMatrix:function(t){t.equals(hn.Identity)?(this.matrix.identity(),this.getBBox=this.getSubBBox,this.traverse=this.groupTraverse):(this.matrix.assign(t),delete this.getBBox,delete this.traverse)},getMatrix:function(){return this.matrix},setTransform:function(t,e,n,i,o){t.equals(xe.Zero)&&e.equals(an.Identity)&&n.equals(xe.One)?(this.matrix.identity(),this.getBBox=this.getSubBBox,this.traverse=this.groupTraverse):(this.matrix.set(t,e,n,i,o),delete this.getBBox,delete this.traverse)},getBBox:function(t,e){return this.getSubBBox(t,e).multRight(this.matrix)},traverse:function(t,e){const n=e.getModelViewMatrix();n.push(),n.multLeft(this.matrix),nc.prototype.traverse.call(this,t,e),n.pop()},groupTraverse:nc.prototype.traverse});const ET=CT;n.set("x_ite/Components/Grouping/X3DTransformMatrix3DNode",ET);const OT=ET;function NT(t){OT.call(this,t),this.addType(c.X3DTransformNode),this._translation.setUnit("length"),this._center.setUnit("length")}NT.prototype=Object.assign(Object.create(OT.prototype),{constructor:NT,initialize:function(){OT.prototype.initialize.call(this),this.addInterest("eventsProcessed",this),this.eventsProcessed()},eventsProcessed:function(){this.setTransform(this._translation.getValue(),this._rotation.getValue(),this._scale.getValue(),this._scaleOrientation.getValue(),this._center.getValue())}});const FT=NT;n.set("x_ite/Components/Grouping/X3DTransformNode",FT);const IT=FT;function MT(t){IT.call(this,t),this.addType(c.Transform)}MT.prototype=Object.assign(Object.create(IT.prototype),{constructor:MT,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new Y([new B(c.inputOutput,"metadata",new Ri.SFNode),new B(c.inputOutput,"translation",new Ri.SFVec3f),new B(c.inputOutput,"rotation",new Ri.SFRotation),new B(c.inputOutput,"scale",new Ri.SFVec3f(1,1,1)),new B(c.inputOutput,"scaleOrientation",new Ri.SFRotation),new B(c.inputOutput,"center",new Ri.SFVec3f),new B(c.inputOutput,"visible",new Ri.SFBool(!0)),new B(c.inputOutput,"bboxDisplay",new Ri.SFBool),new B(c.initializeOnly,"bboxSize",new Ri.SFVec3f(-1,-1,-1)),new B(c.initializeOnly,"bboxCenter",new Ri.SFVec3f),new B(c.inputOnly,"addChildren",new Ri.MFNode),new B(c.inputOnly,"removeChildren",new Ri.MFNode),new B(c.inputOutput,"children",new Ri.MFNode)]),getTypeName:function(){return"Transform"},getComponentName:function(){return"Grouping"},getContainerField:function(){return"children"}});const DT=MT;n.set("x_ite/Components/Grouping/Transform",DT);const VT={Group:rc,StaticGroup:ST,Switch:vT,Transform:DT},RT={X3DBoundedObject:Qu,X3DGroupingNode:nc,X3DTransformMatrix3DNode:OT,X3DTransformNode:IT};for(const t in VT)Qo.addType(t,VT[t]);for(const t in RT)Qo.addAbstractType(t,RT[t]);const PT=void 0;n.set("x_ite/Components/Grouping",PT);function AT(t){Mu.call(this,t),this.addType(c.ColorInterpolator),this.hsv=[]}AT.prototype=Object.assign(Object.create(Mu.prototype),{constructor:AT,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new Y([new B(c.inputOutput,"metadata",new Ri.SFNode),new B(c.inputOnly,"set_fraction",new Ri.SFFloat),new B(c.inputOutput,"key",new Ri.MFFloat),new B(c.inputOutput,"keyValue",new Ri.MFColor),new B(c.outputOnly,"value_changed",new Ri.SFColor)]),getTypeName:function(){return"ColorInterpolator"},getComponentName:function(){return"Interpolation"},getContainerField:function(){return"children"},initialize:function(){Mu.prototype.initialize.call(this),this._keyValue.addInterest("set_keyValue__",this)},set_keyValue__:function(){const t=this._keyValue;t.length<this._key.length&&this._keyValue.resize(this._key.length,t.length?t[this._keyValue.length-1]:new Ri.SFColor),this.hsv.length=0;for(const e of t)this.hsv.push(e.getHSV())},interpolate:function(){const t=[];return function(e,n,i){Ct.lerp(this.hsv[e],this.hsv[n],i,t),this._value_changed.setHSV(t[0],t[1],t[2])}}()});const LT=AT;n.set("x_ite/Components/Interpolation/ColorInterpolator",LT);const BT=LT;function XT(t){Mu.call(this,t),this.addType(c.CoordinateInterpolator)}XT.prototype=Object.assign(Object.create(Mu.prototype),{constructor:XT,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new Y([new B(c.inputOutput,"metadata",new Ri.SFNode),new B(c.inputOnly,"set_fraction",new Ri.SFFloat),new B(c.inputOutput,"key",new Ri.MFFloat),new B(c.inputOutput,"keyValue",new Ri.MFVec3f),new B(c.outputOnly,"value_changed",new Ri.MFVec3f)]),getTypeName:function(){return"CoordinateInterpolator"},getComponentName:function(){return"Interpolation"},getContainerField:function(){return"children"},set_keyValue__:function(){},interpolate:function(t,e,n){const i=this._keyValue.getValue();let o=this._key.length?Math.floor(this._keyValue.length/this._key.length):0;this._value_changed.length=o;const r=this._value_changed.getValue();e=(t*=o)+(this._key.length>1?o:0),t*=3,e*=3,o*=3;for(let s=0;s<o;s+=3){const o=s+1,a=s+2;r[s]=gt.lerp(i[t+s],i[e+s],n),r[o]=gt.lerp(i[t+o],i[e+o],n),r[a]=gt.lerp(i[t+a],i[e+a],n)}this._value_changed.addEvent()}});const UT=XT;n.set("x_ite/Components/Interpolation/CoordinateInterpolator",UT);const kT=UT;function zT(t){Mu.call(this,t),this.addType(c.CoordinateInterpolator2D)}zT.prototype=Object.assign(Object.create(Mu.prototype),{constructor:zT,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new Y([new B(c.inputOutput,"metadata",new Ri.SFNode),new B(c.inputOnly,"set_fraction",new Ri.SFFloat),new B(c.inputOutput,"key",new Ri.MFFloat),new B(c.inputOutput,"keyValue",new Ri.MFVec2f),new B(c.outputOnly,"value_changed",new Ri.MFVec2f)]),getTypeName:function(){return"CoordinateInterpolator2D"},getComponentName:function(){return"Interpolation"},getContainerField:function(){return"children"},set_keyValue__:function(){},interpolate:function(t,e,n){const i=this._keyValue.getValue();let o=this._key.length?Math.floor(this._keyValue.length/this._key.length):0;this._value_changed.length=o;const r=this._value_changed.getValue();e=(t*=o)+(this._key.length>1?o:0),t*=2,e*=2,o*=2;for(let s=0;s<o;s+=2){const o=s+1;r[s]=gt.lerp(i[t+s],i[e+s],n),r[o]=gt.lerp(i[t+o],i[e+o],n)}this._value_changed.addEvent()}});const jT=zT;n.set("x_ite/Components/Interpolation/CoordinateInterpolator2D",jT);const GT=jT;function HT(t){Mu.call(this,t),this.addType(c.NormalInterpolator)}HT.prototype=Object.assign(Object.create(Mu.prototype),{constructor:HT,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new Y([new B(c.inputOutput,"metadata",new Ri.SFNode),new B(c.inputOnly,"set_fraction",new Ri.SFFloat),new B(c.inputOutput,"key",new Ri.MFFloat),new B(c.inputOutput,"keyValue",new Ri.MFVec3f),new B(c.outputOnly,"value_changed",new Ri.MFVec3f)]),getTypeName:function(){return"NormalInterpolator"},getComponentName:function(){return"Interpolation"},getContainerField:function(){return"children"},initialize:function(){Mu.prototype.initialize.call(this),this._keyValue.addInterest("set_keyValue__",this)},set_keyValue__:function(){},interpolate:function(){const t=new xe(0,0,0),e=new xe(0,0,0);return function(n,i,o){const r=this._keyValue.getValue();let s=this._key.length>1?Math.floor(this._keyValue.length/this._key.length):0;this._value_changed.length=s;const a=this._value_changed.getValue();i=(n*=s)+s,n*=3,i*=3,s*=3;for(let u=0;u<s;u+=3)try{const s=u+1,c=u+2;t.set(r[n+u],r[n+s],r[n+c]),e.set(r[i+u],r[i+s],r[i+c]);const l=gt.simpleSlerp(t,e,o);a[u]=l[0],a[s]=l[1],a[c]=l[2]}catch(t){}this._value_changed.addEvent()}}()});const qT=HT;n.set("x_ite/Components/Interpolation/NormalInterpolator",qT);const YT=qT;function WT(t){Mu.call(this,t),this.addType(c.PositionInterpolator2D)}WT.prototype=Object.assign(Object.create(Mu.prototype),{constructor:WT,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new Y([new B(c.inputOutput,"metadata",new Ri.SFNode),new B(c.inputOnly,"set_fraction",new Ri.SFFloat),new B(c.inputOutput,"key",new Ri.MFFloat),new B(c.inputOutput,"keyValue",new Ri.MFVec2f),new B(c.outputOnly,"value_changed",new Ri.SFVec2f)]),getTypeName:function(){return"PositionInterpolator2D"},getComponentName:function(){return"Interpolation"},getContainerField:function(){return"children"},initialize:function(){Mu.prototype.initialize.call(this),this._keyValue.addInterest("set_keyValue__",this)},set_keyValue__:function(){const t=this._key,e=this._keyValue;e.length<t.length&&e.resize(t.length,e.length?e[e.length-1]:new Ri.SFVec2f)},interpolate:function(){const t=new de(0,0);return function(e,n,i){this._value_changed=t.assign(this._keyValue[e].getValue()).lerp(this._keyValue[n].getValue(),i)}}()});const KT=WT;n.set("x_ite/Components/Interpolation/PositionInterpolator2D",KT);const JT=KT,ZT=[],QT=[],$T=[],tb=new Xe(0,0,0,0),eb=new hn(2,-2,1,1,-3,3,-2,-1,0,0,1,0,1,0,0,0);function nb(){this.T0=[],this.T1=[]}nb.prototype={constructor:nb,generate:function(t,e,n,i,o){const r=this.T0,s=this.T1;if(r.length=0,s.length=0,ZT.length=0,QT.length=0,$T.length=0,e.length>1){if(0===i.length){t?ZT.push(this.divide(this.subtract(n[1],n[n.length-2]),2)):ZT.push(this.create());for(let t=1,e=n.length-1;t<e;++t)ZT.push(this.divide(this.subtract(n[t+1],n[t-1]),2));ZT.push(this.copy(ZT[0]))}else{for(let t=0,e=i.length;t<e;++t)ZT.push(this.copy(i[t]));if(o){let t=0;for(let e=0,i=n.length-1;e<i;++e)t+=this.abs(this.subtract(n[e],n[e+1]));for(let e=0,n=ZT.length-1;e<n;++e){const n=this.abs(ZT[e]);n&&(ZT[e]=this.multiply(ZT[e],t/n))}}}if(t){const t=e.length-1,n=e.length-2,i=e[1]-e[0]+e[t]-e[n];$T.push(2*(e[1]-e[0])/i),QT.push(2*(e[t]-e[n])/i)}else $T.push(1),QT.push(1);for(let t=1,n=e.length-1;t<n;++t){const n=e[t+1]-e[t-1];$T.push(2*(e[t+1]-e[t])/n),QT.push(2*(e[t]-e[t-1])/n)}$T.push($T[0]),QT.push(QT[0]);for(let t=0,e=ZT.length;t<e;++t)r.push(this.multiply(ZT[t],QT[t])),s.push(this.multiply(ZT[t],$T[t]))}else r.push(this.create()),s.push(this.create())},interpolate:function(t,e,n,i){return tb.set(Math.pow(n,3),Math.pow(n,2),n,1),this.dot(eb.multVecMatrix(tb),i[t],i[e],this.T0[t],this.T1[e])}};const ib=nb;n.set("x_ite/Browser/Interpolation/CatmullRomSplineInterpolator",ib);const ob=ib;const rb=function(t){const e=new t(0,0,0,0),n=new t(0,0,0,0),i=new t(0,0,0,0),o=new t(0,0,0,0);function r(){this.T0=[],this.T1=[]}return r.prototype=Object.assign(Object.create(ob.prototype),{constructor:r,create:function(){return new t(0,0,0,0)},copy:function(t){return t.copy()},subtract:function(e,n){return t.subtract(e,n)},multiply:function(e,n){return t.multiply(e,n)},divide:function(e,n){return t.divide(e,n)},abs:function(t){return t.magnitude()},dot:function(t,r,s,a,u){return e.assign(r).multiply(t[0]),n.assign(s).multiply(t[1]),i.assign(a).multiply(t[2]),o.assign(u).multiply(t[3]),e.add(n).add(i).add(o)}}),r};n.set("x_ite/Browser/Interpolation/CatmullRomSplineInterpolatorTemplate",rb);const sb=rb,ab=sb(xe);n.set("x_ite/Browser/Interpolation/CatmullRomSplineInterpolator3",ab);const ub=ab;function cb(t){Mu.call(this,t),this.addType(c.SplinePositionInterpolator),this.spline=new ub}cb.prototype=Object.assign(Object.create(Mu.prototype),{constructor:cb,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new Y([new B(c.inputOutput,"metadata",new Ri.SFNode),new B(c.inputOnly,"set_fraction",new Ri.SFFloat),new B(c.inputOutput,"closed",new Ri.SFBool),new B(c.inputOutput,"key",new Ri.MFFloat),new B(c.inputOutput,"keyValue",new Ri.MFVec3f),new B(c.inputOutput,"keyVelocity",new Ri.MFVec3f),new B(c.inputOutput,"normalizeVelocity",new Ri.SFBool),new B(c.outputOnly,"value_changed",new Ri.SFVec3f)]),getTypeName:function(){return"SplinePositionInterpolator"},getComponentName:function(){return"Interpolation"},getContainerField:function(){return"children"},initialize:function(){Mu.prototype.initialize.call(this),this._keyValue.addInterest("set_keyValue__",this),this._keyVelocity.addInterest("set_keyVelocity__",this),this._normalizeVelocity.addInterest("set_normalizeVelocity__",this)},set_keyValue__:function(){const t=this._key,e=this._keyValue;e.length<t.length&&e.resize(t.length,e.length?e[e.length-1]:new Ri.SFVec3f),this.set_keyVelocity__()},set_keyVelocity__:function(){this._keyVelocity.length&&this._keyVelocity.length<this._key.length&&this._keyVelocity.resize(this._key.length,new Ri.SFVec3f),this.set_normalizeVelocity__()},set_normalizeVelocity__:function(){this.spline.generate(this._closed.getValue(),this._key,this._keyValue,this._keyVelocity,this._normalizeVelocity.getValue())},interpolate:function(t,e,n){this._value_changed=this.spline.interpolate(t,e,n,this._keyValue)}});const lb=cb;n.set("x_ite/Components/Interpolation/SplinePositionInterpolator",lb);const hb=lb,db=sb(de);n.set("x_ite/Browser/Interpolation/CatmullRomSplineInterpolator2",db);const pb=db;function fb(t){Mu.call(this,t),this.addType(c.SplinePositionInterpolator2D),this.spline=new pb}fb.prototype=Object.assign(Object.create(Mu.prototype),{constructor:fb,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new Y([new B(c.inputOutput,"metadata",new Ri.SFNode),new B(c.inputOnly,"set_fraction",new Ri.SFFloat),new B(c.inputOutput,"closed",new Ri.SFBool),new B(c.inputOutput,"key",new Ri.MFFloat),new B(c.inputOutput,"keyValue",new Ri.MFVec2f),new B(c.inputOutput,"keyVelocity",new Ri.MFVec2f),new B(c.inputOutput,"normalizeVelocity",new Ri.SFBool),new B(c.outputOnly,"value_changed",new Ri.SFVec2f)]),getTypeName:function(){return"SplinePositionInterpolator2D"},getComponentName:function(){return"Interpolation"},getContainerField:function(){return"children"},initialize:function(){Mu.prototype.initialize.call(this),this._keyValue.addInterest("set_keyValue__",this),this._keyVelocity.addInterest("set_keyVelocity__",this),this._normalizeVelocity.addInterest("set_normalizeVelocity__",this)},set_keyValue__:function(){const t=this._key,e=this._keyValue;e.length<t.length&&e.resize(t.length,e.length?e[e.length-1]:new Ri.SFVec2f),this.set_keyVelocity__()},set_keyVelocity__:function(){this._keyVelocity.length&&this._keyVelocity.length<this._key.length&&this._keyVelocity.resize(this._key.length,new Ri.SFVec2f),this.set_normalizeVelocity__()},set_normalizeVelocity__:function(){this.spline.generate(this._closed.getValue(),this._key,this._keyValue,this._keyVelocity,this._normalizeVelocity.getValue())},interpolate:function(t,e,n){this._value_changed=this.spline.interpolate(t,e,n,this._keyValue)}});const gb=fb;n.set("x_ite/Components/Interpolation/SplinePositionInterpolator2D",gb);const mb=gb;function _b(){this.T0=[],this.T1=[]}_b.prototype=Object.assign(Object.create(ob.prototype),{constructor:_b,create:function(){return 0},copy:function(t){return t},subtract:function(t,e){return t-e},multiply:function(t,e){return t*e},divide:function(t,e){return t/e},abs:function(t){return Math.abs(t)},dot:function(t,e,n,i,o){return e*t[0]+n*t[1]+i*t[2]+o*t[3]}});const xb=_b;n.set("x_ite/Browser/Interpolation/CatmullRomSplineInterpolator1",xb);const yb=xb;function wb(t){Mu.call(this,t),this.addType(c.SplineScalarInterpolator),this.spline=new yb}wb.prototype=Object.assign(Object.create(Mu.prototype),{constructor:wb,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new Y([new B(c.inputOutput,"metadata",new Ri.SFNode),new B(c.inputOnly,"set_fraction",new Ri.SFFloat),new B(c.inputOutput,"closed",new Ri.SFBool),new B(c.inputOutput,"key",new Ri.MFFloat),new B(c.inputOutput,"keyValue",new Ri.MFFloat),new B(c.inputOutput,"keyVelocity",new Ri.MFFloat),new B(c.inputOutput,"normalizeVelocity",new Ri.SFBool),new B(c.outputOnly,"value_changed",new Ri.SFFloat)]),getTypeName:function(){return"SplineScalarInterpolator"},getComponentName:function(){return"Interpolation"},getContainerField:function(){return"children"},initialize:function(){Mu.prototype.initialize.call(this),this._keyValue.addInterest("set_keyValue__",this),this._keyVelocity.addInterest("set_keyVelocity__",this),this._normalizeVelocity.addInterest("set_normalizeVelocity__",this)},set_keyValue__:function(){const t=this._key,e=this._keyValue;e.length<t.length&&e.resize(t.length,e.length?e[e.length-1]:new Ri.SFFloat),this.set_keyVelocity__()},set_keyVelocity__:function(){this._keyVelocity.length&&this._keyVelocity.length<this._key.length&&this._keyVelocity.resize(this._key.length,new Ri.SFFloat),this.set_normalizeVelocity__()},set_normalizeVelocity__:function(){this.spline.generate(this._closed.getValue(),this._key,this._keyValue,this._keyVelocity,this._normalizeVelocity.getValue())},interpolate:function(t,e,n){this._value_changed=this.spline.interpolate(t,e,n,this._keyValue)}});const Sb=wb;n.set("x_ite/Components/Interpolation/SplineScalarInterpolator",Sb);const Tb=Sb,bb=new an(0,0,1,0);function vb(){this.s=[]}vb.prototype={constructor:vb,generate:function(t,e,n){const i=this.s;if(i.length=0,e.length>1){t?i.push(an.spline(n[e.length-2].getValue(),n[0].getValue(),n[1].getValue())):i.push(n[0].getValue());for(let t=1,o=e.length-1;t<o;++t)i.push(an.spline(n[t-1].getValue(),n[t].getValue(),n[t+1].getValue()));t?i.push(an.spline(n[e.length-2].getValue(),n[e.length-1].getValue(),n[1].getValue())):i.push(n[e.length-1].getValue())}else e.length>0&&i.push(n[0].getValue().copy())},interpolate:function(t,e,n,i){return bb.assign(i[t].getValue()).squad(this.s[t],this.s[e],i[e].getValue(),n)}};const Cb=vb;n.set("x_ite/Browser/Interpolation/SquatInterpolator",Cb);const Eb=Cb;function Ob(t){Mu.call(this,t),this.addType(c.SquadOrientationInterpolator),this._keyValue.setUnit("angle"),this._value_changed.setUnit("angle"),this.squad=new Eb}Ob.prototype=Object.assign(Object.create(Mu.prototype),{constructor:Ob,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new Y([new B(c.inputOutput,"metadata",new Ri.SFNode),new B(c.inputOnly,"set_fraction",new Ri.SFFloat),new B(c.inputOutput,"closed",new Ri.SFBool),new B(c.inputOutput,"key",new Ri.MFFloat),new B(c.inputOutput,"keyValue",new Ri.MFRotation),new B(c.outputOnly,"value_changed",new Ri.SFRotation)]),getTypeName:function(){return"SquadOrientationInterpolator"},getComponentName:function(){return"Interpolation"},getContainerField:function(){return"children"},initialize:function(){Mu.prototype.initialize.call(this),this._keyValue.addInterest("set_keyValue__",this)},set_keyValue__:function(){const t=this._key,e=this._keyValue;e.length<t.length&&e.resize(t.length,e.length?e[e.length-1]:new Ri.SFRotation),this.squad.generate(this._closed.getValue(),this._key,this._keyValue)},interpolate:function(t,e,n){try{this._value_changed=this.squad.interpolate(t,e,n,this._keyValue)}catch(t){console.error(t)}}});const Nb=Ob;n.set("x_ite/Components/Interpolation/SquadOrientationInterpolator",Nb);const Fb={ColorInterpolator:BT,CoordinateInterpolator:kT,CoordinateInterpolator2D:GT,EaseInEaseOut:Ru,NormalInterpolator:YT,OrientationInterpolator:Uu,PositionInterpolator:Lu,PositionInterpolator2D:JT,ScalarInterpolator:ju,SplinePositionInterpolator:hb,SplinePositionInterpolator2D:mb,SplineScalarInterpolator:Tb,SquadOrientationInterpolator:Nb},Ib={X3DInterpolatorNode:Mu};for(const t in Fb)Qo.addType(t,Fb[t]);for(const t in Ib)Qo.addAbstractType(t,Ib[t]);const Mb=void 0;n.set("x_ite/Components/Interpolation",Mb);const Db={Layer:uc,LayerSet:hc,Viewport:Qd},Vb={X3DLayerNode:yu,X3DViewportNode:Wd};for(const t in Db)Qo.addType(t,Db[t]);for(const t in Vb)Qo.addAbstractType(t,Vb[t]);const Rb=void 0;n.set("x_ite/Components/Layering",Rb);const Pb=wa(Ab);function Ab(){this.modelViewMatrix=new Zs(hn)}function Lb(t){df.call(this,t),this.addType(c.EnvironmentLight)}Ab.prototype={constructor:Ab,set:function(t,e,n){},setGroup:function(t){this.groupNode=t},getModelViewMatrix:function(){return this.modelViewMatrix},renderShadowMap:function(t){},setGlobalVariables:function(t){},setShaderUniforms:function(t,e){},dispose:function(){Pb.push(this)}},Lb.prototype=Object.assign(Object.create(df.prototype),{constructor:Lb,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new Y([new B(c.inputOutput,"metadata",new Ri.SFNode),new B(c.inputOutput,"global",new Ri.SFBool(!1)),new B(c.inputOutput,"on",new Ri.SFBool(!0)),new B(c.inputOutput,"color",new Ri.SFColor(1,1,1)),new B(c.inputOutput,"intensity",new Ri.SFFloat(1)),new B(c.inputOutput,"ambientIntensity",new Ri.SFFloat),new B(c.inputOutput,"rotation",new Ri.SFRotation),new B(c.inputOutput,"diffuseCoefficients",new Ri.MFFloat),new B(c.inputOutput,"diffuse",new Ri.SFNode),new B(c.inputOutput,"diffuseTexture",new Ri.SFNode),new B(c.inputOutput,"specularTexture",new Ri.SFNode),new B(c.inputOutput,"shadows",new Ri.SFBool),new B(c.inputOutput,"shadowColor",new Ri.SFColor),new B(c.inputOutput,"shadowIntensity",new Ri.SFFloat(1)),new B(c.inputOutput,"shadowBias",new Ri.SFFloat(.005)),new B(c.initializeOnly,"shadowMapSize",new Ri.SFInt32(1024))]),getTypeName:function(){return"EnvironmentLight"},getComponentName:function(){return"Lighting"},getContainerField:function(){return"children"},getLights:function(){return Pb}});const Bb=Lb;n.set("x_ite/Components/Lighting/EnvironmentLight",Bb);const Xb=Bb,Ub=[(new hn).setRotation(new an(new xe(1,0,0),xe.zAxis)),(new hn).setRotation(new an(new xe(-1,0,0),xe.zAxis)),(new hn).setRotation(new an(new xe(0,0,-1),xe.zAxis)),(new hn).setRotation(new an(new xe(0,0,1),xe.zAxis)),(new hn).setRotation(new an(new xe(0,1,0),xe.zAxis)),(new hn).setRotation(new an(new xe(0,-1,0),xe.zAxis))],kb=[new Xe(0,.5,.25,.5),new Xe(.5,.5,.25,.5),new Xe(.75,.5,.25,.5),new Xe(.25,.5,.25,.5),new Xe(0,0,.5,.5),new Xe(.5,0,.5,.5)],zb=wa(jb);function jb(){this.location=new xe(0,0,0),this.matrixArray=new Float32Array(9),this.shadowBuffer=null,this.viewVolume=new Rs,this.viewport=new Xe(0,0,0,0),this.projectionMatrix=new hn,this.modelViewMatrix=new Zs(hn),this.modelMatrix=new hn,this.invLightSpaceMatrix=new hn,this.invLightSpaceProjectionMatrix=new hn,this.shadowMatrix=new hn,this.shadowMatrixArray=new Float32Array(16),this.rotation=new an,this.rotationMatrix=new hn,this.textureUnit=void 0}function Gb(t){df.call(this,t),this.addType(c.PointLight),this._location.setUnit("length"),this._radius.setUnit("length")}jb.prototype={constructor:jb,set:function(t,e,n){const i=t.getShadowMapSize();this.browser=t.getBrowser(),this.lightNode=t,this.groupNode=e,this.matrixArray.set(n.submatrix.inverse()),this.modelViewMatrix.pushMatrix(n),t.getShadowIntensity()>0&&i>0&&(this.shadowBuffer=this.browser.popShadowBuffer(i),this.shadowBuffer||console.warn("Couldn't create shadow buffer."))},setGroup:function(t){this.groupNode=t},getModelViewMatrix:function(){return this.modelViewMatrix},renderShadowMap:function(t){if(!this.shadowBuffer)return;const e=this.lightNode,n=t.getCameraSpaceMatrix().get(),i=this.modelMatrix.assign(this.modelViewMatrix.get()).multRight(n),o=this.invLightSpaceMatrix.assign(e.getGlobal()?i:hn.Identity);o.translate(e.getLocation()),o.inverse();const r=e.getShadowMapSize();this.shadowBuffer.bind();for(let e=0;e<6;++e){const n=kb[e],i=this.viewport.set(n[0]*r,n[1]*r,n[2]*r,n[3]*r),s=qs.perspective2(gt.radians(90),.125,1e4,i[2],i[3],this.projectionMatrix);t.getViewVolumes().push(this.viewVolume.set(s,i,i)),t.getProjectionMatrix().pushMatrix(this.projectionMatrix),t.getModelViewMatrix().pushMatrix(Ub[e]),t.getModelViewMatrix().multLeft(o),t.render(Us.SHADOW,nc.prototype.traverse,this.groupNode),t.getModelViewMatrix().pop(),t.getProjectionMatrix().pop(),t.getViewVolumes().pop()}this.shadowBuffer.unbind(),e.getGlobal()||o.multLeft(i.inverse()),this.invLightSpaceProjectionMatrix.assign(o)},setGlobalVariables:function(t){this.modelViewMatrix.get().multVecMatrix(this.location.assign(this.lightNode._location.getValue())),this.shadowBuffer&&(this.shadowMatrix.assign(t.getCameraSpaceMatrix().get()).multRight(this.invLightSpaceProjectionMatrix),this.shadowMatrixArray.set(this.shadowMatrix))},setShaderUniforms:function(t,e){const n=e.numLights++;if(this.shadowBuffer){const i=this.lightNode.getGlobal()?this.textureUnit=void 0!==this.textureUnit?this.textureUnit:this.browser.popTexture2DUnit():this.browser.getTexture2DUnit();void 0!==i?(t.activeTexture(t.TEXTURE0+i),t.HAS_FEATURE_DEPTH_TEXTURE?t.bindTexture(t.TEXTURE_2D,this.shadowBuffer.getDepthTexture()):t.bindTexture(t.TEXTURE_2D,this.shadowBuffer.getColorTexture()),t.uniform1i(e.x3d_ShadowMap[n],i)):console.warn("Not enough combined texture units for shadow map available.")}if(e.hasLight(n,this))return;const i=this.lightNode,o=i.getColor(),r=i.getAttenuation(),s=this.location;if(t.uniform1i(e.x3d_LightType[n],2),t.uniform3f(e.x3d_LightColor[n],o.r,o.g,o.b),t.uniform1f(e.x3d_LightIntensity[n],i.getIntensity()),t.uniform1f(e.x3d_LightAmbientIntensity[n],i.getAmbientIntensity()),t.uniform3f(e.x3d_LightAttenuation[n],Math.max(0,r.x),Math.max(0,r.y),Math.max(0,r.z)),t.uniform3f(e.x3d_LightLocation[n],s.x,s.y,s.z),t.uniform1f(e.x3d_LightRadius[n],i.getRadius()),t.uniformMatrix3fv(e.x3d_LightMatrix[n],!1,this.matrixArray),this.shadowBuffer){const o=i.getShadowColor();t.uniform3f(e.x3d_ShadowColor[n],o.r,o.g,o.b),t.uniform1f(e.x3d_ShadowIntensity[n],i.getShadowIntensity()),t.uniform1f(e.x3d_ShadowBias[n],i.getShadowBias()),t.uniformMatrix4fv(e.x3d_ShadowMatrix[n],!1,this.shadowMatrixArray),t.uniform1i(e.x3d_ShadowMapSize[n],i.getShadowMapSize())}},dispose:function(){this.browser.pushShadowBuffer(this.shadowBuffer),this.browser.pushTexture2DUnit(this.textureUnit),this.modelViewMatrix.clear(),this.shadowBuffer=null,this.textureUnit=void 0,zb.push(this)}},Gb.prototype=Object.assign(Object.create(df.prototype),{constructor:Gb,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new Y([new B(c.inputOutput,"metadata",new Ri.SFNode),new B(c.inputOutput,"global",new Ri.SFBool(!0)),new B(c.inputOutput,"on",new Ri.SFBool(!0)),new B(c.inputOutput,"color",new Ri.SFColor(1,1,1)),new B(c.inputOutput,"intensity",new Ri.SFFloat(1)),new B(c.inputOutput,"ambientIntensity",new Ri.SFFloat),new B(c.inputOutput,"attenuation",new Ri.SFVec3f(1,0,0)),new B(c.inputOutput,"location",new Ri.SFVec3f),new B(c.inputOutput,"radius",new Ri.SFFloat(100)),new B(c.inputOutput,"shadows",new Ri.SFBool),new B(c.inputOutput,"shadowColor",new Ri.SFColor),new B(c.inputOutput,"shadowIntensity",new Ri.SFFloat(1)),new B(c.inputOutput,"shadowBias",new Ri.SFFloat(.005)),new B(c.initializeOnly,"shadowMapSize",new Ri.SFInt32(1024))]),getTypeName:function(){return"PointLight"},getComponentName:function(){return"Lighting"},getContainerField:function(){return"children"},getAttenuation:function(){return this._attenuation.getValue()},getLocation:function(){return this._location.getValue()},getRadius:function(){return Math.max(0,this._radius.getValue())},getLights:function(){return zb}});const Hb=Gb;n.set("x_ite/Components/Lighting/PointLight",Hb);const qb=Hb,Yb=wa(Wb);function Wb(){this.location=new xe(0,0,0),this.direction=new xe(0,0,0),this.matrixArray=new Float32Array(9),this.renderShadow=!0,this.shadowBuffer=null,this.bbox=new Ks,this.viewVolume=new Rs,this.viewport=new Xe(0,0,0,0),this.projectionMatrix=new hn,this.modelViewMatrix=new Zs(hn),this.modelMatrix=new hn,this.invLightSpaceMatrix=new hn,this.invLightSpaceProjectionMatrix=new hn,this.shadowMatrix=new hn,this.shadowMatrixArray=new Float32Array(16),this.rotation=new an,this.lightBBoxMin=new xe(0,0,0),this.lightBBoxMax=new xe(0,0,0),this.textureUnit=void 0}function Kb(t){switch(df.call(this,t),this.addType(c.SpotLight),t.getSpecificationVersion()){case"2.0":case"3.0":case"3.1":case"3.2":this._beamWidth=1.5708,this._cutOffAngle=.785398}this._location.setUnit("length"),this._radius.setUnit("length"),this._beamWidth.setUnit("angle"),this._cutOffAngle.setUnit("angle")}Wb.prototype={constructor:Wb,set:function(t,e,n){const i=t.getShadowMapSize();this.browser=t.getBrowser(),this.lightNode=t,this.groupNode=e,this.matrixArray.set(n.submatrix.inverse()),this.modelViewMatrix.pushMatrix(n),t.getShadowIntensity()>0&&i>0&&(this.shadowBuffer=this.browser.popShadowBuffer(i),this.shadowBuffer||console.warn("Couldn't create shadow buffer."))},setGroup:function(t){this.groupNode=t},getModelViewMatrix:function(){return this.modelViewMatrix},renderShadowMap:function(t){if(!this.shadowBuffer)return;const e=this.lightNode,n=t.getCameraSpaceMatrix().get(),i=this.modelMatrix.assign(this.modelViewMatrix.get()).multRight(n),o=this.invLightSpaceMatrix.assign(e.getGlobal()?i:hn.Identity);o.translate(e.getLocation()),o.rotate(this.rotation.setFromToVec(xe.zAxis,this.direction.assign(e.getDirection()).negate())),o.inverse();this.groupNode.getSubBBox(this.bbox,!0).multRight(o).getExtents(this.lightBBoxMin,this.lightBBoxMax);const r=e.getShadowMapSize(),s=Math.min(e.getRadius(),-this.lightBBoxMin.z),a=this.viewport.set(0,0,r,r),u=qs.perspective(2*e.getCutOffAngle(),.125,Math.max(1e4,s),r,r,this.projectionMatrix);this.renderShadow=s>0,this.shadowBuffer.bind(),t.getViewVolumes().push(this.viewVolume.set(u,a,a)),t.getProjectionMatrix().pushMatrix(u),t.getModelViewMatrix().pushMatrix(o),t.render(Us.SHADOW,nc.prototype.traverse,this.groupNode),t.getModelViewMatrix().pop(),t.getProjectionMatrix().pop(),t.getViewVolumes().pop(),this.shadowBuffer.unbind(),e.getGlobal()||o.multLeft(i.inverse()),this.invLightSpaceProjectionMatrix.assign(o).multRight(u).multRight(e.getBiasMatrix())},setGlobalVariables:function(t){const e=this.lightNode,n=this.modelViewMatrix.get();n.multVecMatrix(this.location.assign(e._location.getValue())),n.multDirMatrix(this.direction.assign(e._direction.getValue())).normalize(),this.shadowBuffer&&(this.shadowMatrix.assign(t.getCameraSpaceMatrix().get()).multRight(this.invLightSpaceProjectionMatrix),this.shadowMatrixArray.set(this.shadowMatrix))},setShaderUniforms:function(t,e){const n=e.numLights++;if(this.shadowBuffer){const i=this.lightNode.getGlobal()?this.textureUnit=void 0!==this.textureUnit?this.textureUnit:this.browser.popTexture2DUnit():this.browser.getTexture2DUnit();void 0!==i?(t.activeTexture(t.TEXTURE0+i),t.HAS_FEATURE_DEPTH_TEXTURE?t.bindTexture(t.TEXTURE_2D,this.shadowBuffer.getDepthTexture()):t.bindTexture(t.TEXTURE_2D,this.shadowBuffer.getColorTexture()),t.uniform1i(e.x3d_ShadowMap[n],i)):console.warn("Not enough combined texture units for shadow map available.")}if(e.hasLight(n,this))return;const i=this.lightNode,o=i.getColor(),r=i.getAttenuation(),s=this.location,a=this.direction;if(t.uniform1i(e.x3d_LightType[n],3),t.uniform3f(e.x3d_LightColor[n],o.r,o.g,o.b),t.uniform1f(e.x3d_LightIntensity[n],i.getIntensity()),t.uniform1f(e.x3d_LightAmbientIntensity[n],i.getAmbientIntensity()),t.uniform3f(e.x3d_LightAttenuation[n],Math.max(0,r.x),Math.max(0,r.y),Math.max(0,r.z)),t.uniform3f(e.x3d_LightLocation[n],s.x,s.y,s.z),t.uniform3f(e.x3d_LightDirection[n],a.x,a.y,a.z),t.uniform1f(e.x3d_LightRadius[n],i.getRadius()),t.uniform1f(e.x3d_LightBeamWidth[n],i.getBeamWidth()),t.uniform1f(e.x3d_LightCutOffAngle[n],i.getCutOffAngle()),t.uniformMatrix3fv(e.x3d_LightMatrix[n],!1,this.matrixArray),this.renderShadow&&this.shadowBuffer){const o=i.getShadowColor();t.uniform3f(e.x3d_ShadowColor[n],o.r,o.g,o.b),t.uniform1f(e.x3d_ShadowIntensity[n],i.getShadowIntensity()),t.uniform1f(e.x3d_ShadowBias[n],i.getShadowBias()),t.uniformMatrix4fv(e.x3d_ShadowMatrix[n],!1,this.shadowMatrixArray),t.uniform1i(e.x3d_ShadowMapSize[n],i.getShadowMapSize())}},dispose:function(){this.browser.pushShadowBuffer(this.shadowBuffer),this.browser.pushTexture2DUnit(this.textureUnit),this.modelViewMatrix.clear(),this.shadowBuffer=null,this.textureUnit=void 0,Yb.push(this)}},Kb.prototype=Object.assign(Object.create(df.prototype),{constructor:Kb,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new Y([new B(c.inputOutput,"metadata",new Ri.SFNode),new B(c.inputOutput,"global",new Ri.SFBool(!0)),new B(c.inputOutput,"on",new Ri.SFBool(!0)),new B(c.inputOutput,"color",new Ri.SFColor(1,1,1)),new B(c.inputOutput,"intensity",new Ri.SFFloat(1)),new B(c.inputOutput,"ambientIntensity",new Ri.SFFloat),new B(c.inputOutput,"attenuation",new Ri.SFVec3f(1,0,0)),new B(c.inputOutput,"location",new Ri.SFVec3f),new B(c.inputOutput,"direction",new Ri.SFVec3f(0,0,-1)),new B(c.inputOutput,"radius",new Ri.SFFloat(100)),new B(c.inputOutput,"beamWidth",new Ri.SFFloat(.785398)),new B(c.inputOutput,"cutOffAngle",new Ri.SFFloat(1.5708)),new B(c.inputOutput,"shadows",new Ri.SFBool),new B(c.inputOutput,"shadowColor",new Ri.SFColor),new B(c.inputOutput,"shadowIntensity",new Ri.SFFloat(1)),new B(c.inputOutput,"shadowBias",new Ri.SFFloat(.005)),new B(c.initializeOnly,"shadowMapSize",new Ri.SFInt32(1024))]),getTypeName:function(){return"SpotLight"},getComponentName:function(){return"Lighting"},getContainerField:function(){return"children"},getAttenuation:function(){return this._attenuation.getValue()},getLocation:function(){return this._location.getValue()},getRadius:function(){return Math.max(0,this._radius.getValue())},getBeamWidth:function(){const t=this._beamWidth.getValue(),e=this.getCutOffAngle();return t>e?e:gt.clamp(t,0,Math.PI/2)},getCutOffAngle:function(){return gt.clamp(this._cutOffAngle.getValue(),0,Math.PI/2)},getLights:function(){return Yb}});const Jb=Kb;n.set("x_ite/Components/Lighting/SpotLight",Jb);const Zb={DirectionalLight:_f,EnvironmentLight:Xb,PointLight:qb,SpotLight:Jb},Qb={X3DLightNode:df};for(const t in Zb)Qo.addType(t,Zb[t]);for(const t in Qb)Qo.addAbstractType(t,Qb[t]);const $b=void 0;n.set("x_ite/Components/Lighting",$b);function tv(t){nc.call(this,t),this.addType(c.Billboard),this.matrix=new hn}tv.prototype=Object.assign(Object.create(nc.prototype),{constructor:tv,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new Y([new B(c.inputOutput,"metadata",new Ri.SFNode),new B(c.inputOutput,"axisOfRotation",new Ri.SFVec3f(0,1,0)),new B(c.inputOutput,"visible",new Ri.SFBool(!0)),new B(c.inputOutput,"bboxDisplay",new Ri.SFBool),new B(c.initializeOnly,"bboxSize",new Ri.SFVec3f(-1,-1,-1)),new B(c.initializeOnly,"bboxCenter",new Ri.SFVec3f),new B(c.inputOnly,"addChildren",new Ri.MFNode),new B(c.inputOnly,"removeChildren",new Ri.MFNode),new B(c.inputOutput,"children",new Ri.MFNode)]),getTypeName:function(){return"Billboard"},getComponentName:function(){return"Navigation"},getContainerField:function(){return"children"},getBBox:function(t,e){return nc.prototype.getBBox.call(this,t,e).multRight(this.matrix)},getMatrix:function(){return this.matrix},rotate:function(){const t=new hn,e=new xe(0,0,0),n=new xe(0,0,0),i=new xe(0,0,0),o=new xe(0,0,0),r=new an(0,0,1,0);return function(s){t.assign(s).inverse();const a=t.origin.normalize();if(this._axisOfRotation.getValue().equals(xe.Zero)){t.multDirMatrix(e.assign(xe.yAxis)).normalize();const i=e.cross(a);n.assign(a).cross(i);const o=a;i.normalize(),n.normalize(),this.matrix.set(i.x,i.y,i.z,0,n.x,n.y,n.z,0,o.x,o.y,o.z,0,0,0,0,1)}else i.assign(this._axisOfRotation.getValue()).cross(a),o.assign(this._axisOfRotation.getValue()).cross(xe.zAxis),this.matrix.setRotation(r.setFromToVec(o,i));return this.matrix}}(),traverse:function(t,e){const n=e.getModelViewMatrix();switch(n.push(),t){case Us.CAMERA:case Us.PICKING:case Us.SHADOW:n.multLeft(this.matrix);break;default:n.multLeft(this.rotate(n.get()))}nc.prototype.traverse.call(this,t,e),n.pop()}});const ev=tv;n.set("x_ite/Components/Navigation/Billboard",ev);const nv=ev;function iv(t){nc.call(this,t),Tu.call(this,t),this.addType(c.Collision),"2.0"===t.getSpecificationVersion()&&this.addAlias("collide",this._enabled)}iv.prototype=Object.assign(Object.create(nc.prototype),Tu.prototype,{constructor:iv,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new Y([new B(c.inputOutput,"metadata",new Ri.SFNode),new B(c.inputOutput,"enabled",new Ri.SFBool(!0)),new B(c.outputOnly,"isActive",new Ri.SFBool),new B(c.outputOnly,"collideTime",new Ri.SFTime),new B(c.inputOutput,"visible",new Ri.SFBool(!0)),new B(c.inputOutput,"bboxDisplay",new Ri.SFBool),new B(c.initializeOnly,"bboxSize",new Ri.SFVec3f(-1,-1,-1)),new B(c.initializeOnly,"bboxCenter",new Ri.SFVec3f),new B(c.initializeOnly,"proxy",new Ri.SFNode),new B(c.inputOnly,"addChildren",new Ri.MFNode),new B(c.inputOnly,"removeChildren",new Ri.MFNode),new B(c.inputOutput,"children",new Ri.MFNode)]),getTypeName:function(){return"Collision"},getComponentName:function(){return"Navigation"},getContainerField:function(){return"children"},initialize:function(){nc.prototype.initialize.call(this),this.isLive().addInterest("set_live__",this),this._enabled.addInterest("set_live__",this),this._proxy.addInterest("set_proxy__",this),this.set_live__(),this.set_proxy__()},set_live__:function(){this.isLive().getValue()&&this._enabled.getValue()?this.getBrowser().addCollision(this):this.getBrowser().removeCollision(this)},set_active:function(t){this._isActive.getValue()!==t&&(this._isActive=t,t&&(this._collideTime=this.getBrowser().getCurrentTime()))},set_proxy__:function(){this.proxyNode=nu(c.X3DChildNode,this._proxy)},traverse:function(t,e){if(t!==Us.COLLISION)nc.prototype.traverse.call(this,t,e);else if(this._enabled.getValue()){const n=e.getCollisions();n.push(this),this.proxyNode?this.proxyNode.traverse(t,e):nc.prototype.traverse.call(this,t,e),n.pop()}},dispose:function(){nc.prototype.dispose.call(this)}});const ov=iv;n.set("x_ite/Components/Navigation/Collision",ov);const rv=ov;function sv(t){nc.call(this,t),this.addType(c.LOD),"2.0"===t.getSpecificationVersion()&&this.addAlias("level",this._children),this._center.setUnit("length"),this._range.setUnit("length"),this.frameRate=60,this.keepCurrentLevel=!1,this.childNode=null,this.visibleNode=null,this.boundedObject=null}sv.prototype=Object.assign(Object.create(nc.prototype),{constructor:sv,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new Y([new B(c.inputOutput,"metadata",new Ri.SFNode),new B(c.initializeOnly,"forceTransitions",new Ri.SFBool),new B(c.initializeOnly,"center",new Ri.SFVec3f),new B(c.initializeOnly,"range",new Ri.MFFloat),new B(c.outputOnly,"level_changed",new Ri.SFInt32(-1)),new B(c.inputOutput,"visible",new Ri.SFBool(!0)),new B(c.inputOutput,"bboxDisplay",new Ri.SFBool),new B(c.initializeOnly,"bboxSize",new Ri.SFVec3f(-1,-1,-1)),new B(c.initializeOnly,"bboxCenter",new Ri.SFVec3f),new B(c.inputOnly,"addChildren",new Ri.MFNode),new B(c.inputOnly,"removeChildren",new Ri.MFNode),new B(c.inputOutput,"children",new Ri.MFNode)]),getTypeName:function(){return"LOD"},getComponentName:function(){return"Navigation"},getContainerField:function(){return"children"},initialize:function(){nc.prototype.initialize.call(this),this._children.addInterest("set_child__",this)},getSubBBox:function(t,e){if(this._bboxSize.getValue().equals(this.getDefaultBBoxSize())){const n=nu(c.X3DBoundedObject,this.visibleNode);return n?n.getBBox(t,e):t.set()}return t.set(this._bboxSize.getValue(),this._bboxCenter.getValue())},clear:function(){},add:function(){},remove:function(){},set_child__:function(){this.set_level__(Math.min(this._level_changed.getValue(),this._children.length-1))},set_level__:function(t){this.childNode&&(this.childNode._isCameraObject.removeInterest("set_cameraObject__",this),this.childNode._isPickableObject.removeInterest("set_transformSensors__",this)),nu(c.X3DBoundedObject,this.childNode)&&(this.childNode._visible.removeInterest("set_visible__",this),this.childNode._bboxDisplay.removeInterest("set_bboxDisplay__",this)),t>=0&&t<this._children.length?(this.childNode=nu(c.X3DChildNode,this._children[t]),this.childNode&&(this.childNode._isCameraObject.addInterest("set_cameraObject__",this),this.childNode._isPickableObject.addInterest("set_transformSensors__",this),nu(c.X3DBoundedObject,this.childNode)&&(this.childNode._visible.addInterest("set_visible__",this),this.childNode._bboxDisplay.addInterest("set_bboxDisplay__",this)))):this.childNode=null,this.set_transformSensors__(),this.set_visible__(),this.set_bboxDisplay__()},set_cameraObject__:function(){this.childNode&&this.childNode.getCameraObject()?nu(c.X3DBoundedObject,this.childNode)?this.setCameraObject(this.childNode._visible.getValue()):this.setCameraObject(!0):this.setCameraObject(!1)},set_transformSensors__:function(){this.setPickableObject(Boolean(this.getTransformSensors().size||this.childNode&&this.childNode.getPickableObject()))},set_visible__:function(){nu(c.X3DBoundedObject,this.childNode)?this.visibleNode=this.childNode._visible.getValue()?this.childNode:null:this.visibleNode=this.childNode,this.set_cameraObject__()},set_bboxDisplay__:function(){nu(c.X3DBoundedObject,this.childNode)?this.boundedObject=this.childNode._bboxDisplay.getValue()?this.childNode:null:this.boundedObject=null},getLevel:function(t,e){if(0===this._range.length){this.frameRate=(179*this.frameRate+t.currentFrameRate)/180;const e=this._children.length;switch(e){case 0:return-1;case 1:return 0;case 2:return+(this.frameRate>55);default:{const t=1-gt.clamp((this.frameRate-20)/35,0,1);return Math.min(Math.floor(t*e),e-1)}}}const n=e.translate(this._center.getValue()).origin.magnitude();return gt.upperBound(this._range,0,this._range.length,n)},traverse:function(){const t=new hn;return function(e,n){switch(e){case Us.POINTER:case Us.CAMERA:case Us.SHADOW:{const t=this.visibleNode;return void(t&&t.traverse(e,n))}case Us.PICKING:{if(this.getTransformSensors().size){const t=n.getModelViewMatrix().get();for(const e of this.getTransformSensors())e.collect(t)}const t=this.childNode;if(t){const i=this.getBrowser().getPickingHierarchy();i.push(this),t.traverse(e,n),i.pop()}return}case Us.COLLISION:{const t=this.childNode;return void(t&&t.traverse(e,n))}case Us.DISPLAY:{if(!this.keepCurrentLevel){let e=this.getLevel(this.getBrowser(),t.assign(n.getModelViewMatrix().get())),i=this._level_changed.getValue();this._forceTransitions.getValue()&&(e>i?e=i+1:e<i&&(e=i-1)),e!==i&&(this._level_changed=e,this.set_level__(Math.min(e,this._children.length-1)))}const i=this.visibleNode;i&&i.traverse(e,n);const o=this.boundedObject;return void(o&&o.displayBBox(e,n))}}}}()});const av=sv;n.set("x_ite/Components/Navigation/LOD",av);const uv=av;function cv(t){ha.call(this,t),this.addType(c.ViewpointGroup),this._size.setUnit("length"),this._center.setUnit("length"),this.proximitySensor=new Lw(t),this.cameraObjects=[],this.viewpointGroups=[]}function lv(t,e){switch(t){case Us.CAMERA:if(this.proximitySensor.traverse(t,e),this.proximitySensor._isActive.getValue())for(var n=0,i=this.cameraObjects.length;n<i;++n)this.cameraObjects[n].traverse(t,e);return;case Us.DISPLAY:if(this.proximitySensor.traverse(t,e),this.proximitySensor._isActive.getValue())for(n=0,i=this.viewpointGroups.length;n<i;++n)this.viewpointGroups[n].traverse(t,e);return}}function hv(t,e){switch(t){case Us.CAMERA:for(var n=0,i=this.cameraObjects.length;n<i;++n)this.cameraObjects[n].traverse(t,e);return;case Us.DISPLAY:for(n=0,i=this.viewpointGroups.length;n<i;++n)this.viewpointGroups[n].traverse(t,e);return}}cv.prototype=Object.assign(Object.create(ha.prototype),{constructor:cv,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new Y([new B(c.inputOutput,"metadata",new Ri.SFNode),new B(c.inputOutput,"description",new Ri.SFString),new B(c.inputOutput,"displayed",new Ri.SFBool(!0)),new B(c.inputOutput,"retainUserOffsets",new Ri.SFBool),new B(c.inputOutput,"size",new Ri.SFVec3f),new B(c.inputOutput,"center",new Ri.SFVec3f),new B(c.inputOutput,"children",new Ri.MFNode)]),getTypeName:function(){return"ViewpointGroup"},getComponentName:function(){return"Navigation"},getContainerField:function(){return"children"},initialize:function(){ha.prototype.initialize.call(this),this.proximitySensor.setup(),this._size.addFieldInterest(this.proximitySensor._size),this._center.addFieldInterest(this.proximitySensor._center),this.proximitySensor._size=this._size,this.proximitySensor._center=this._center,this._displayed.addInterest("set_displayed__",this),this._size.addInterest("set_displayed__",this),this._children.addInterest("set_children__",this),this.set_displayed__(),this.set_children__()},isActive:function(){return this.proximitySensor._isActive.getValue()},set_displayed__:function(){var t=!this._size.getValue().equals(xe.Zero),e=this._displayed.getValue();this.proximitySensor._enabled=e&&t,e&&t?(this.proximitySensor._isCameraObject.addFieldInterest(this._isCameraObject),this.proximitySensor._isPickableObject.addFieldInterest(this._isPickableObject),this.setCameraObject(this.proximitySensor.getCameraObject()),this.setPickableObject(this.proximitySensor.getPickableObject()),this.traverse=lv):(this.proximitySensor._isCameraObject.removeFieldInterest(this._isCameraObject),this.proximitySensor._isPickableObject.removeFieldInterest(this._isPickableObject),this.setCameraObject(e),this.setPickableObject(!1),e?this.traverse=hv:delete this.traverse)},set_children__:function(){this.cameraObjects.length=0,this.viewpointGroups.length=0;for(var t=this._children,e=0,n=t.length;e<n;++e)try{for(var i=t[e].getValue().getInnerNode(),o=i.getType(),r=o.length-1;r>=0;--r)switch(o[r]){case c.X3DViewpointNode:this.cameraObjects.push(i);break;case c.ViewpointGroup:this.cameraObjects.push(i),this.viewpointGroups.push(i)}}catch(t){}},traverse:function(){}});const dv=cv;n.set("x_ite/Components/Navigation/ViewpointGroup",dv);const pv={Billboard:nv,Collision:rv,LOD:uv,NavigationInfo:xa,OrthoViewpoint:lp,Viewpoint:Ku,ViewpointGroup:dv},fv={X3DViewpointNode:qu};for(const t in pv)Qo.addType(t,pv[t]);for(const t in fv)Qo.addAbstractType(t,fv[t]);const gv=void 0;n.set("x_ite/Components/Navigation",gv);function mv(t,e,n,i){this.node=null,this.modelViewMatrix=new hn,this.projectionMatrix=new hn,this.viewport=new Xe(0,0,0,0),this.set(t,e,n,i)}mv.prototype={set:function(t,e,n,i){this.node=t,this.modelViewMatrix.assign(e),this.projectionMatrix.assign(n),this.viewport.assign(i)},set_over__:function(t,e){this.node.set_over__(t,e,this.modelViewMatrix,this.projectionMatrix,this.viewport)},set_active__:function(t,e){this.node.set_active__(t,e,this.modelViewMatrix,this.projectionMatrix,this.viewport)},set_motion__:function(t){this.node.set_motion__(t,this.modelViewMatrix,this.projectionMatrix,this.viewport)}};const _v=mv;n.set("x_ite/Browser/PointingDeviceSensor/PointingDeviceSensorContainer",_v);const xv=_v;function yv(t){Tu.call(this,t),this.addType(c.X3DPointingDeviceSensorNode)}yv.prototype=Object.assign(Object.create(Tu.prototype),{constructor:yv,initialize:function(){Tu.prototype.initialize.call(this),this._enabled.addInterest("set_enabled__",this)},getMatrices:function(){return this.matrices},set_enabled__:function(){this._enabled.getValue()||(this._isActive.getValue()&&(this._isActive=!1),this._isOver.getValue()&&(this._isOver=!1))},set_over__:function(t,e){t!==this._isOver.getValue()&&(this._isOver=t,t&&(this.getBrowser().getNotification()._string=this._description))},set_active__:function(t,e){t!==this._isActive.getValue()&&(this._isActive=t)},set_motion__:function(t){},push:function(t,e){this._enabled.getValue()&&e.set(this,new xv(this,t.getModelViewMatrix().get(),t.getProjectionMatrix().get(),t.getViewVolume().getViewport()))}});const wv=yv;n.set("x_ite/Components/PointingDeviceSensor/X3DPointingDeviceSensorNode",wv);const Sv=wv;function Tv(t){Sv.call(this,t),this.addType(c.X3DTouchSensorNode)}Tv.prototype=Object.assign(Object.create(Sv.prototype),{constructor:Tv,set_active__:function(t,e){Sv.prototype.set_active__.call(this,t,e),this._enabled.getValue()&&this._isOver.getValue()&&!t&&(this._touchTime=this.getBrowser().getCurrentTime())}});const bv=Tv;n.set("x_ite/Components/PointingDeviceSensor/X3DTouchSensorNode",bv);const vv=bv;var Cv=new hn;function Ev(t){vv.call(this,t),this.addType(c.TouchSensor),this._hitPoint_changed.setUnit("length")}Ev.prototype=Object.assign(Object.create(vv.prototype),{constructor:Ev,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new Y([new B(c.inputOutput,"metadata",new Ri.SFNode),new B(c.inputOutput,"description",new Ri.SFString),new B(c.inputOutput,"enabled",new Ri.SFBool(!0)),new B(c.outputOnly,"hitTexCoord_changed",new Ri.SFVec2f),new B(c.outputOnly,"hitNormal_changed",new Ri.SFVec3f),new B(c.outputOnly,"hitPoint_changed",new Ri.SFVec3f),new B(c.outputOnly,"isOver",new Ri.SFBool),new B(c.outputOnly,"isActive",new Ri.SFBool),new B(c.outputOnly,"touchTime",new Ri.SFTime)]),getTypeName:function(){return"TouchSensor"},getComponentName:function(){return"PointingDeviceSensor"},getContainerField:function(){return"children"},set_over__:function(t,e,n,i,o){if(vv.prototype.set_over__.call(this,t,e,n,i,o),this._isOver.getValue()){var r=e.intersection;Cv.assign(n).inverse(),this._hitTexCoord_changed=r.texCoord,this._hitNormal_changed=n.multMatrixDir(r.normal.copy()).normalize(),this._hitPoint_changed=Cv.multVecMatrix(r.point.copy())}}});const Ov=Ev;n.set("x_ite/Components/PointingDeviceSensor/TouchSensor",Ov);const Nv=Ov;function Fv(t){nc.call(this,t),kr.call(this,t),this.addType(c.Anchor),this.touchSensorNode=new Nv(t),this.anchorSensors=new Map}Fv.prototype=Object.assign(Object.create(nc.prototype),kr.prototype,{constructor:Fv,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new Y([new B(c.inputOutput,"metadata",new Ri.SFNode),new B(c.inputOutput,"description",new Ri.SFString),new B(c.inputOutput,"load",new Ri.SFBool(!0)),new B(c.inputOutput,"url",new Ri.MFString),new B(c.inputOutput,"parameter",new Ri.MFString),new B(c.inputOutput,"autoRefresh",new Ri.SFTime),new B(c.inputOutput,"autoRefreshTimeLimit",new Ri.SFTime(3600)),new B(c.inputOutput,"visible",new Ri.SFBool(!0)),new B(c.inputOutput,"bboxDisplay",new Ri.SFBool),new B(c.initializeOnly,"bboxSize",new Ri.SFVec3f(-1,-1,-1)),new B(c.initializeOnly,"bboxCenter",new Ri.SFVec3f),new B(c.inputOnly,"addChildren",new Ri.MFNode),new B(c.inputOnly,"removeChildren",new Ri.MFNode),new B(c.inputOutput,"children",new Ri.MFNode)]),getTypeName:function(){return"Anchor"},getComponentName:function(){return"Networking"},getContainerField:function(){return"children"},initialize:function(){nc.prototype.initialize.call(this),kr.prototype.initialize.call(this),this._description.addFieldInterest(this.touchSensorNode._description),this._load.addFieldInterest(this.touchSensorNode._enabled),this.touchSensorNode._description=this._description,this.touchSensorNode._enabled=this._load,this.touchSensorNode.setup();const t=this,e=this.touchSensorNode.set_active__;this.touchSensorNode.set_active__=function(n,i){e.call(this,n,i),this._isOver.getValue()&&!n&&t.requestImmediateLoad()}},set_load__:function(){},set_url__:function(){},requestImmediateLoad:function(t=!0){this.setCache(t),this.setLoadState(c.IN_PROGRESS_STATE,!1),new Oc(this).createX3DFromURL(this._url,this._parameter,function(t){t?(this.getBrowser().replaceWorld(t),this.setLoadState(c.COMPLETE_STATE,!1)):this.setLoadState(c.FAILED_STATE,!1)}.bind(this),function(t){this.getBrowser().changeViewpoint(t),this.setLoadState(c.COMPLETE_STATE,!1)}.bind(this),function(t,e){e?window.open(t,e):location=t,this.setLoadState(c.COMPLETE_STATE,!1)}.bind(this))},requestUnload(){},traverse:function(t,e){if(t===Us.POINTER){const n=this.getBrowser().getSensors(),i=this.anchorSensors;i.clear(),this.touchSensorNode.push(e,i),i.size?(n.push(i),nc.prototype.traverse.call(this,t,e),n.pop()):nc.prototype.traverse.call(this,t,e)}else nc.prototype.traverse.call(this,t,e)},dispose:function(){kr.prototype.dispose.call(this),nc.prototype.dispose.call(this)}});const Iv=Fv;n.set("x_ite/Components/Networking/Anchor",Iv);const Mv=Iv;function Dv(t){ha.call(this,t),kr.call(this,t),Qu.call(this,t),this.addType(c.Inline),t.getSpecificationVersion()<4&&(this._global=!0),this.scene=this.getBrowser().getDefaultScene(),this.groupNode=new rc(t),this.groupNode.addParent(this)}Dv.prototype=Object.assign(Object.create(ha.prototype),kr.prototype,Qu.prototype,{constructor:Dv,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new Y([new B(c.inputOutput,"metadata",new Ri.SFNode),new B(c.inputOutput,"description",new Ri.SFString),new B(c.inputOutput,"global",new Ri.SFBool(!1)),new B(c.inputOutput,"load",new Ri.SFBool(!0)),new B(c.inputOutput,"url",new Ri.MFString),new B(c.inputOutput,"autoRefresh",new Ri.SFTime),new B(c.inputOutput,"autoRefreshTimeLimit",new Ri.SFTime(3600)),new B(c.inputOutput,"visible",new Ri.SFBool(!0)),new B(c.inputOutput,"bboxDisplay",new Ri.SFBool),new B(c.initializeOnly,"bboxSize",new Ri.SFVec3f(-1,-1,-1)),new B(c.initializeOnly,"bboxCenter",new Ri.SFVec3f)]),getTypeName:function(){return"Inline"},getComponentName:function(){return"Networking"},getContainerField:function(){return"children"},initialize:function(){ha.prototype.initialize.call(this),kr.prototype.initialize.call(this),Qu.prototype.initialize.call(this),this.groupNode.setPrivate(!0),this.groupNode.setup(),this.groupNode._isCameraObject.addFieldInterest(this._isCameraObject),this.groupNode._isPickableObject.addFieldInterest(this._isPickableObject),this.requestImmediateLoad()},getBBox:function(t,e){return this._bboxSize.getValue().equals(this.getDefaultBBoxSize())?this.groupNode.getBBox(t,e):t.set(this._bboxSize.getValue(),this._bboxCenter.getValue())},set_live__:function(){kr.prototype.set_live__.call(this),this.isPrivate()||this.scene.setLive(this.isLive().getValue())},unLoadNow:function(){this.abortLoading(),this.setInternalScene(this.getBrowser().getDefaultScene())},loadNow:function(){this.abortLoading(),this.fileLoader=new Oc(this).createX3DFromURL(this._url,null,this.setInternalSceneAsync.bind(this))},abortLoading:function(){this.scene._loadCount.removeInterest("checkLoadCount",this),this.fileLoader&&this.fileLoader.abort()},setInternalSceneAsync:function(t){t?(t._loadCount.addInterest("checkLoadCount",this),this.setInternalScene(t),this.checkLoadCount(t._loadCount)):(this.setInternalScene(this.getBrowser().getDefaultScene()),this.setLoadState(c.FAILED_STATE))},checkLoadCount:function(t){t.getValue()||(t.removeInterest("checkLoadCount",this),this.setLoadState(c.COMPLETE_STATE))},setInternalScene:function(t){this.scene.setLive(!1),this.scene.rootNodes.removeFieldInterest(this.groupNode._children),this.scene=t,this.scene.setExecutionContext(this.getExecutionContext()),this.scene.setPrivate(this.getExecutionContext().isPrivate()),this.scene.rootNodes.addFieldInterest(this.groupNode._children),this.groupNode._children=this.scene.rootNodes,this.set_live__(),this.getBrowser().addBrowserEvent()},getInternalScene:function(){return this.scene},traverse:function(t,e){switch(t){case Us.PICKING:{const n=this.getBrowser().getPickingHierarchy();return n.push(this),this.groupNode.traverse(t,e),void n.pop()}case Us.DISPLAY:if(this._global.getValue())this.groupNode.traverse(t,e);else{const n=e.getGlobalObjects().length,i=e.getGlobalShadows().length,o=e.getNumOpaqueShapes(),r=e.getNumTransparentShapes();this.groupNode.traverse(t,e);const s=e.getGlobalObjects().length;if(n===s)return;const a=this.getBrowser(),u=e.getGlobalObjects(),c=e.getGlobalShadows().at(-1),l=e.getNumOpaqueShapes(),h=e.getNumTransparentShapes(),d=e.getOpaqueShapes(),p=e.getTransparentShapes();let f=0,g=0;for(let t=n;t<s;++t){const e=u[t];e.setGroup(this.groupNode),f+=!!e.lightNode,g+=!!e.textureProjectorNode,a.getLocalObjects().push(e)}for(let t=o;t<l;++t){const e=d[t],i=e.localObjects;e.shadows=e.shadows||c,e.objectsCount[1]+=f,e.objectsCount[2]+=g;for(let t=n;t<s;++t)i.push(u[t])}for(let t=r;t<h;++t){const e=p[t],i=e.localObjects;e.shadows=e.shadows||c,e.objectsCount[1]+=f,e.objectsCount[2]+=g;for(let t=n;t<s;++t)i.push(u[t])}e.getGlobalObjects().length=n,e.getGlobalShadows().length=i}return;default:return void this.groupNode.traverse(t,e)}},dispose:function(){Qu.prototype.dispose.call(this),kr.prototype.dispose.call(this),ha.prototype.dispose.call(this)}});const Vv=Dv;n.set("x_ite/Components/Networking/Inline",Vv);const Rv={Anchor:Mv,Inline:Vv,LoadSensor:F_},Pv={X3DNetworkSensorNode:E_,X3DUrlObject:kr};for(const t in Rv)Qo.addType(t,Rv[t]);for(const t in Pv)Qo.addAbstractType(t,Pv[t]);const Av=void 0;n.set("x_ite/Components/Networking",Av);function Lv(t){Sv.call(this,t),this.addType(c.X3DDragSensorNode),this._trackPoint_changed.setUnit("length")}Lv.prototype=Object.assign(Object.create(Sv.prototype),{constructor:Lv});const Bv=Lv;n.set("x_ite/Components/PointingDeviceSensor/X3DDragSensorNode",Bv);const Xv=Bv;function Uv(t,e){this.axis=t.copy(),this.radius=e}Uv.prototype={constructor:Uv,intersectsLine:function(t,e,n){const i=new an(this.axis.direction,new xe(0,1,0)),o=hn.Rotation(i),r=1/this.radius,s=new hn;s.scale(new xe(r,r,r)),s.multLeft(o);const a=xe.subtract(t.point,this.axis.point),u=new wd(a,t.direction).multLineMatrix(s),c=this.unitCylinderIntersectsLine(u,e,n);if(c){const t=s.inverse();t.multVecMatrix(e),e.add(this.axis.point),t.multVecMatrix(n),n.add(this.axis.point)}return c},unitCylinderIntersectsLine:function(t,e,n){let i,o;const r=t.point,s=t.direction,a=s[0]*s[0]+s[2]*s[2],u=2*(r[0]*s[0]+r[2]*s[2]),c=r[0]*r[0]+r[2]*r[2]-1,l=u*u-4*a*c;if(l<0)return!1;const h=Math.sqrt(l);return u>0?(i=-2*c/(h+u),o=-(h+u)/(2*a)):(i=2*c/(h-u),o=(h-u)/(2*a)),e.assign(s).multiply(i).add(r),n.assign(s).multiply(o).add(r),!0},toString:function(){return this.axis.toString()+" "+this.radius}};const kv=Uv;n.set("standard/Math/Geometry/Cylinder3",kv);const zv=kv;function jv(t){Xv.call(this,t),this.addType(c.CylinderSensor),this._diskAngle.setUnit("angle"),this._minAngle.setUnit("angle"),this._maxAngle.setUnit("angle"),this._offset.setUnit("angle")}jv.prototype=Object.assign(Object.create(Xv.prototype),{constructor:jv,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new Y([new B(c.inputOutput,"metadata",new Ri.SFNode),new B(c.inputOutput,"description",new Ri.SFString),new B(c.inputOutput,"enabled",new Ri.SFBool(!0)),new B(c.inputOutput,"axisRotation",new Ri.SFRotation),new B(c.inputOutput,"diskAngle",new Ri.SFFloat(.261792)),new B(c.inputOutput,"minAngle",new Ri.SFFloat),new B(c.inputOutput,"maxAngle",new Ri.SFFloat(-1)),new B(c.inputOutput,"offset",new Ri.SFFloat),new B(c.inputOutput,"autoOffset",new Ri.SFBool(!0)),new B(c.outputOnly,"trackPoint_changed",new Ri.SFVec3f),new B(c.outputOnly,"rotation_changed",new Ri.SFRotation),new B(c.outputOnly,"isOver",new Ri.SFBool),new B(c.outputOnly,"isActive",new Ri.SFBool)]),getTypeName:function(){return"CylinderSensor"},getComponentName:function(){return"PointingDeviceSensor"},getContainerField:function(){return"children"},initialize:function(){Xv.prototype.initialize.call(this),this.modelViewMatrix=new hn,this.invModelViewMatrix=new hn,this.cylinder=new zv(new wd(new xe(0,0,0),new xe(0,0,0)),0),this.disk=!1,this.yPlane=null,this.zPlane=null,this.sxPlane=null,this.szNormal=null,this.behind=!1,this.fromVector=new xe(0,0,0),this.startOffset=new an(0,0,1,0)},isBehind:function(t,e){const n=new xe(0,0,0),i=new xe(0,0,0);return this.cylinder.intersectsLine(t,n,i),xe.subtract(e,n).magnitude()>xe.subtract(e,i).magnitude()},getTrackPoint:function(t,e){const n=new xe(0,0,0);this.zPlane.intersectsLine(t,n);const i=xe.add(n,this.cylinder.axis.getPerpendicularVectorToPoint(n,new xe(0,0,0))),o=this.sxPlane.getDistanceToPoint(n)/this.cylinder.radius,r=Math.floor((o+1)/2),s=gt.interval(o,-1,1),a=(0===r?Math.asin(s):s*Math.PI/2)+r*Math.PI;new an(this.cylinder.axis.direction,a).multVecRot(e.assign(this.szNormal).multiply(this.cylinder.radius)),e.add(i)},getAngle:function(t){return xe.dot(t.getAxis(),this.cylinder.axis.direction)>0?t.angle:-t.angle},set_active__:function(t,e,n,i,o){if(Xv.prototype.set_active__.call(this,t,e,n,i,o),this._isActive.getValue()){this.modelViewMatrix.assign(n),this.invModelViewMatrix.assign(n).inverse();const t=e.hitRay.copy().multLineMatrix(this.invModelViewMatrix),i=this.invModelViewMatrix.multVecMatrix(e.intersection.point.copy()),o=this._axisRotation.getValue().multVecRot(new xe(0,1,0)),r=this.invModelViewMatrix.multDirMatrix(new xe(0,0,1)).normalize(),s=new wd(new xe(0,0,0),o),a=s.getPerpendicularVectorToPoint(i,new xe(0,0,0)).magnitude();this.cylinder=new zv(s,a),this.disk=Math.abs(xe.dot(r,o))>Math.cos(this._diskAngle.getValue()),this.behind=this.isBehind(t,i),this.yPlane=new ws(i,o),this.zPlane=new ws(i,r);const u=this.invModelViewMatrix.origin,c=xe.cross(o,u).normalize();this.sxPlane=new ws(new xe(0,0,0),c),this.szNormal=xe.cross(c,o).normalize();const l=new xe(0,0,0);this.disk?this.yPlane.intersectsLine(t,l):this.getTrackPoint(t,l),this.fromVector=this.cylinder.axis.getPerpendicularVectorToPoint(l,new xe(0,0,0)).negate(),this.startOffset=new an(o,this._offset.getValue()),this._trackPoint_changed=l,this._rotation_changed=this.startOffset,this.angle=this._offset.getValue(),this.startVector=this._rotation_changed.getValue().multVecRot(this._axisRotation.getValue().multVecRot(new xe(0,0,1)))}else this._autoOffset.getValue()&&(this._offset=this.getAngle(this._rotation_changed.getValue()))},set_motion__:function(t){const e=t.hitRay.copy().multLineMatrix(this.invModelViewMatrix),n=new xe(0,0,0);this.disk?this.yPlane.intersectsLine(e,n):this.getTrackPoint(e,n),this._trackPoint_changed=n;const i=this.cylinder.axis.getPerpendicularVectorToPoint(n,new xe(0,0,0)).negate(),o=new an(this.fromVector,i);if(this.disk){this.modelViewMatrix.multVecMatrix(n.copy()).z>0&&o.multRight(new an(this.yPlane.normal,Math.PI))}else this.behind&&o.inverse();if(o.multLeft(this.startOffset),this._minAngle.getValue()>this._maxAngle.getValue())this._rotation_changed=o;else{const t=o.multVecRot(this._axisRotation.getValue().multVecRot(new xe(0,0,1))),e=new an(this.startVector,t),n=this._axisRotation.getValue().multVecRot(new xe(0,1,0)).dot(e.getAxis())>0?1:-1,i=this._minAngle.getValue(),r=this._maxAngle.getValue();this.angle+=n*e.angle,this.startVector.assign(t),this.angle<i?o.setAxisAngle(this.cylinder.axis.direction,i):this.angle>r?o.setAxisAngle(this.cylinder.axis.direction,r):o.setAxisAngle(this.cylinder.axis.direction,this.angle),this._rotation_changed.getValue().equals(o)||(this._rotation_changed=o)}}});const Gv=jv;n.set("x_ite/Components/PointingDeviceSensor/CylinderSensor",Gv);const Hv=Gv,qv=new Fd(de.Zero,de.Zero),Yv=new de(0,0,0),Wv=new wd(xe.Zero,xe.Zero);function Kv(t){Xv.call(this,t),this.addType(c.PlaneSensor),this._offset.setUnit("length"),this._minPosition.setUnit("length"),this._maxPosition.setUnit("length"),this._translation_changed.setUnit("length")}Kv.prototype=Object.assign(Object.create(Xv.prototype),{constructor:Kv,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new Y([new B(c.inputOutput,"metadata",new Ri.SFNode),new B(c.inputOutput,"description",new Ri.SFString),new B(c.inputOutput,"enabled",new Ri.SFBool(!0)),new B(c.inputOutput,"axisRotation",new Ri.SFRotation),new B(c.inputOutput,"autoOffset",new Ri.SFBool(!0)),new B(c.inputOutput,"offset",new Ri.SFVec3f),new B(c.inputOutput,"minPosition",new Ri.SFVec2f),new B(c.inputOutput,"maxPosition",new Ri.SFVec2f(-1,-1)),new B(c.outputOnly,"trackPoint_changed",new Ri.SFVec3f),new B(c.outputOnly,"translation_changed",new Ri.SFVec3f),new B(c.outputOnly,"isOver",new Ri.SFBool),new B(c.outputOnly,"isActive",new Ri.SFBool)]),getTypeName:function(){return"PlaneSensor"},getComponentName:function(){return"PointingDeviceSensor"},getContainerField:function(){return"children"},initialize:function(){Xv.prototype.initialize.call(this),this.modelViewMatrix=new hn,this.invModelViewMatrix=new hn,this.projectionMatrix=new hn,this.viewport=new Xe,this.planeSensor=!0,this.plane=null,this.line=null,this.startOffset=new xe(0,0,0),this.startPoint=new xe(0,0,0)},getLineTrackPoint:function(t,e,n){return Rs.projectLine(e,this.modelViewMatrix,this.projectionMatrix,this.viewport,qv),qv.getClosestPointToPoint(t.pointer,Yv),Rs.unProjectRay(Yv.x,Yv.y,this.modelViewMatrix,this.projectionMatrix,this.viewport,Wv),e.getClosestPointToLine(Wv,n)},set_active__:function(t,e,n,i,o){if(Xv.prototype.set_active__.call(this,t,e,n,i,o),this._isActive.getValue()){this.modelViewMatrix.assign(n),this.projectionMatrix.assign(i),this.viewport.assign(o),this.invModelViewMatrix.assign(n).inverse();var r=e.hitRay.copy().multLineMatrix(this.invModelViewMatrix),s=this.invModelViewMatrix.multVecMatrix(e.intersection.point.copy()),a=this._axisRotation.getValue();if(this._minPosition.x===this._maxPosition.x){this.planeSensor=!1;var u=a.multVecRot(new xe(0,Math.abs(this._maxPosition.y-this._minPosition.y),0));this.line=new wd(s,u.normalize())}else if(this._minPosition.y===this._maxPosition.y){this.planeSensor=!1;u=a.multVecRot(new xe(Math.abs(this._maxPosition.x-this._minPosition.x),0,0));this.line=new wd(s,u.normalize())}else this.planeSensor=!0,this.plane=new ws(s,a.multVecRot(new xe(0,0,1)));if(this.planeSensor)this.plane.intersectsLine(r,this.startPoint)&&this.trackStart(this.startPoint);else if(this.getLineTrackPoint(e,this.line,this.startPoint)){var c=new xe(0,0,0);try{this.getLineTrackPoint(e,new wd(this.line.direction,this.line.direction),c)}catch(t){c=this.startPoint}this.trackStart(c)}}else this._autoOffset.getValue()&&(this._offset=this._translation_changed)},trackStart:function(t){this.startOffset.assign(this._offset.getValue()),this._trackPoint_changed=t,this._translation_changed=this._offset.getValue()},set_motion__:function(t){try{if(this.planeSensor){var e=t.hitRay.copy().multLineMatrix(this.invModelViewMatrix),n=new xe(0,0,0);if(!this.plane.intersectsLine(e,n))throw new Error("Plane and line are parallel.");this.track(n,n.copy())}else{n=new xe(0,0,0);var i=new xe(0,0,0);if(!this.getLineTrackPoint(t,this.line,n))throw new Error("Lines are parallel.");try{this.getLineTrackPoint(t,new wd(xe.Zero,this.line.direction),i)}catch(t){i.assign(n)}this.track(n,i)}}catch(t){this._trackPoint_changed.addEvent(),this._translation_changed.addEvent()}},track:function(t,e){var n=this._axisRotation.getValue(),i=an.inverse(n).multVecRot(t.add(this.startOffset).subtract(this.startPoint));this._minPosition.x>this._maxPosition.x||(i.x=gt.clamp(i.x,this._minPosition.x,this._maxPosition.x)),this._minPosition.y>this._maxPosition.y||(i.y=gt.clamp(i.y,this._minPosition.y,this._maxPosition.y)),n.multVecRot(i),this._trackPoint_changed.getValue().equals(e)||(this._trackPoint_changed=e),this._translation_changed.getValue().equals(i)||(this._translation_changed=i)}});const Jv=Kv;n.set("x_ite/Components/PointingDeviceSensor/PlaneSensor",Jv);const Zv=Jv;function Qv(t,e){this.radius=t,this.center=e.copy()}Qv.prototype={constructor:Qv,set:function(t,e){this.radius=t,this.center.assign(e)},intersectsLine:function(t,e,n){const i=t.point,o=t.direction,r=this.center,s=this.radius,a=2*(i.dot(o)-r.dot(o)),u=a*a-4*(i.x*i.x+i.y*i.y+i.z*i.z+(r.x*r.x+r.y*r.y+r.z*r.z)-2*i.dot(r)-s*s);if(u>=0){let t=(-a+Math.sqrt(u))/2,r=(-a-Math.sqrt(u))/2;if(t>r){const e=t;t=r,r=e}return e.assign(o).multiply(t).add(i),n.assign(o).multiply(r).add(i),!0}return!1},intersectsTriangle:function(){const t=new xe(0,0,0),e=new xe(0,0,0),n=new xe(0,0,0),i=new xe(0,0,0),o=new xe(0,0,0),r=new xe(0,0,0),s=new xe(0,0,0);return function(a,u,c){const l=this.center,h=this.radius;a.subtract(l),u.subtract(l),c.subtract(l),t.assign(u).subtract(a),e.assign(c).subtract(a);const d=h*h,p=t.cross(e),f=xe.dot(a,p);if(f*f>d*xe.dot(p,p))return!1;const g=xe.dot(a,a),m=xe.dot(a,u),_=xe.dot(a,c),x=xe.dot(u,u),y=xe.dot(u,c),w=xe.dot(c,c);if(g>d&&m>g&&_>g||x>d&&m>x&&y>x||w>d&&_>w&&y>w)return!1;t.assign(u).subtract(a),n.assign(c).subtract(u),i.assign(a).subtract(c);const S=m-g,T=y-x,b=_-w,v=xe.dot(t,t),C=xe.dot(n,n),E=xe.dot(i,i);o.assign(a).multiply(v).subtract(t.multiply(S)),r.assign(u).multiply(C).subtract(n.multiply(T)),s.assign(c).multiply(E).subtract(i.multiply(b));const O=c.multiply(v).subtract(o),N=a.multiply(C).subtract(r),F=u.multiply(E).subtract(s),I=xe.dot(o,o)>d*v*v&&xe.dot(o,O)>0,M=xe.dot(r,r)>d*C*C&&xe.dot(r,N)>0,D=xe.dot(s,s)>d*E*E&&xe.dot(s,F)>0;return!(I||M||D)}}(),toString:function(){return this.radius+" "+this.center.toString()}};const $v=Qv;n.set("standard/Math/Geometry/Sphere3",$v);const tC=$v;function eC(t){Xv.call(this,t),this.addType(c.SphereSensor)}eC.prototype=Object.assign(Object.create(Xv.prototype),{constructor:eC,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new Y([new B(c.inputOutput,"metadata",new Ri.SFNode),new B(c.inputOutput,"description",new Ri.SFString),new B(c.inputOutput,"enabled",new Ri.SFBool(!0)),new B(c.inputOutput,"autoOffset",new Ri.SFBool(!0)),new B(c.inputOutput,"offset",new Ri.SFRotation),new B(c.outputOnly,"trackPoint_changed",new Ri.SFVec3f),new B(c.outputOnly,"rotation_changed",new Ri.SFRotation),new B(c.outputOnly,"isOver",new Ri.SFBool),new B(c.outputOnly,"isActive",new Ri.SFBool)]),getTypeName:function(){return"SphereSensor"},getComponentName:function(){return"PointingDeviceSensor"},getContainerField:function(){return"children"},initialize:function(){Xv.prototype.initialize.call(this),this.modelViewMatrix=new hn,this.invModelViewMatrix=new hn,this.sphere=null,this.zPlane=null,this.behind=!1,this.fromVector=new xe(0,0,0),this.startPoint=new xe(0,0,0),this.startOffset=new an(0,0,1,0)},getTrackPoint:function(t,e,n){var i=new xe(0,0,0);return!!this.sphere.intersectsLine(t,e,i)&&((xe.subtract(t.point,i).magnitude()<xe.subtract(t.point,e).magnitude())-n&&e.assign(i),!0)},set_active__:function(t,e,n,i,o){if(Xv.prototype.set_active__.call(this,t,e,n,i,o),this._isActive.getValue()){this.modelViewMatrix.assign(n),this.invModelViewMatrix.assign(n).inverse();var r=this.invModelViewMatrix.multVecMatrix(e.intersection.point.copy()),s=new xe(0,0,0);this.zPlane=new ws(s,this.invModelViewMatrix.multDirMatrix(new xe(0,0,1)).normalize()),this.sphere=new tC(r.magnitude(),s),this.behind=this.zPlane.getDistanceToPoint(r)<0,this.fromVector.assign(r),this.startPoint.assign(r),this.startOffset.assign(this._offset.getValue()),this._trackPoint_changed=r,this._rotation_changed=this._offset.getValue()}else this._autoOffset.getValue()&&(this._offset=this._rotation_changed)},set_motion__:function(t){var e=t.hitRay.copy().multLineMatrix(this.invModelViewMatrix),n=new xe(0,0,0);if(this.getTrackPoint(e,n,this.behind)){var i=this.invModelViewMatrix.multDirMatrix(new xe(0,0,1)).normalize();this.zPlane=new ws(n,i)}else{var o=new xe(0,0,0);this.zPlane.intersectsLine(e,o),e=new wd(o,xe.subtract(this.sphere.center,o).normalize()),this.getTrackPoint(e,n,!1);var r=vs.normal(this.sphere.center,n,this.startPoint,new xe(0,0,0)),s=xe.subtract(n,this.sphere.center).normalize(),a=xe.cross(r,s).normalize(),u=xe.subtract(n,a.multiply(xe.subtract(o,n).magnitude()));e=new wd(u,xe.subtract(this.sphere.center,u).normalize()),this.getTrackPoint(e,n,!1)}this._trackPoint_changed=n;var c=xe.subtract(n,this.sphere.center),l=new an(this.fromVector,c);this.behind&&l.inverse(),this._rotation_changed=an.multRight(this.startOffset,l)}});const nC=eC;n.set("x_ite/Components/PointingDeviceSensor/SphereSensor",nC);const iC={CylinderSensor:Hv,PlaneSensor:Zv,SphereSensor:nC,TouchSensor:Nv},oC={X3DDragSensorNode:Xv,X3DPointingDeviceSensorNode:Sv,X3DTouchSensorNode:vv};for(const t in iC)Qo.addType(t,iC[t]);for(const t in oC)Qo.addAbstractType(t,oC[t]);const rC=void 0;n.set("x_ite/Components/PointingDeviceSensor",rC);const sC=wa(aC);function aC(){this.plane=new ws(xe.Zero,xe.Zero)}function uC(t){ha.call(this,t),this.addType(c.ClipPlane),this.enabled=!1,this.plane=new Xe(0,0,0,0)}aC.prototype={constructor:aC,isClipped:function(t){return this.plane.getDistanceToPoint(t)<0},set:function(t,e){const n=this.plane,i=t.plane;n.normal.assign(i),n.distanceFromOrigin=-i.w,n.multRight(e)},setShaderUniforms:function(t,e){const n=this.plane,i=n.normal;t.uniform4f(e.x3d_ClipPlane[e.numClipPlanes++],i.x,i.y,i.z,n.distanceFromOrigin)},dispose:function(){sC.push(this)}},uC.prototype=Object.assign(Object.create(ha.prototype),{constructor:uC,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new Y([new B(c.inputOutput,"metadata",new Ri.SFNode),new B(c.inputOutput,"enabled",new Ri.SFBool(!0)),new B(c.inputOutput,"plane",new Ri.SFVec4f(0,1,0,0))]),getTypeName:function(){return"ClipPlane"},getComponentName:function(){return"Rendering"},getContainerField:function(){return"children"},initialize:function(){ha.prototype.initialize.call(this),this._enabled.addInterest("set_enabled__",this),this._plane.addInterest("set_enabled__",this),this.set_enabled__()},set_enabled__:function(){this.plane.assign(this._plane.getValue()),this.enabled=this._enabled.getValue()&&!this.plane.equals(Xe.Zero)},push:function(t){if(this.enabled){const e=sC.pop();e.set(this,t.getModelViewMatrix().get()),t.getLocalObjects().push(e),++t.getLocalObjectsCount()[0]}},pop:function(t){this.enabled&&(this.getBrowser().getLocalObjects().push(t.getLocalObjects().pop()),--t.getLocalObjectsCount()[0])}});const cC=uC;n.set("x_ite/Components/Rendering/ClipPlane",cC);const lC=cC;function hC(t){Bd.call(this,t),this.addType(c.ColorRGBA),this.setTransparent(!0)}hC.prototype=Object.assign(Object.create(Bd.prototype),{constructor:hC,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new Y([new B(c.inputOutput,"metadata",new Ri.SFNode),new B(c.inputOutput,"color",new Ri.MFColorRGBA)]),getTypeName:function(){return"ColorRGBA"},getComponentName:function(){return"Rendering"},getContainerField:function(){return"color"},initialize:function(){Bd.prototype.initialize.call(this),this._color.addInterest("set_color__",this),this.set_color__()},set_color__:function(){this.color=this._color.getValue(),this.length=this._color.length},addColor:function(t,e){if(t>=0&&t<this.length){const n=this.color;t*=4,e.push(n[t],n[t+1],n[t+2],n[t+3])}else if(this.length){const n=this.color;t=4*(this.length-1),e.push(n[t],n[t+1],n[t+2],n[t+3])}else e.push(1,1,1,1)},addColors:function(t,e){if(this.length){const o=this.color;for(var n=0,i=4*Math.min(e,this.length);n<i;n+=4)t.push(o[n],o[n+1],o[n+2],o[n+3]);if(this.length<e){const r=o[n=4*(this.length-1)],s=o[n+1],a=o[n+2],u=o[n+2];for(n=i,i=4*e;n<i;n+=4)t.push(r,s,a,u)}}else for(let n=0;n<e;++n)t.push(1,1,1,1);return t}});const dC=hC;n.set("x_ite/Components/Rendering/ColorRGBA",dC);const pC=dC;function fC(t){Nh.call(this,t),this.addType(c.IndexedTriangleFanSet),this.triangleIndex=[]}fC.prototype=Object.assign(Object.create(Nh.prototype),{constructor:fC,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new Y([new B(c.inputOutput,"metadata",new Ri.SFNode),new B(c.inputOnly,"set_index",new Ri.MFInt32),new B(c.initializeOnly,"solid",new Ri.SFBool(!0)),new B(c.initializeOnly,"ccw",new Ri.SFBool(!0)),new B(c.initializeOnly,"colorPerVertex",new Ri.SFBool(!0)),new B(c.initializeOnly,"normalPerVertex",new Ri.SFBool(!0)),new B(c.initializeOnly,"index",new Ri.MFInt32),new B(c.inputOutput,"attrib",new Ri.MFNode),new B(c.inputOutput,"fogCoord",new Ri.SFNode),new B(c.inputOutput,"color",new Ri.SFNode),new B(c.inputOutput,"texCoord",new Ri.SFNode),new B(c.inputOutput,"normal",new Ri.SFNode),new B(c.inputOutput,"coord",new Ri.SFNode)]),getTypeName:function(){return"IndexedTriangleFanSet"},getComponentName:function(){return"Rendering"},getContainerField:function(){return"geometry"},initialize:function(){Nh.prototype.initialize.call(this),this._set_index.addFieldInterest(this._index),this._index.addInterest("set_index__",this),this.set_index__()},set_index__:function(){const t=this._index,e=this.triangleIndex;e.length=0;for(let n=0,i=t.length;n<i;++n){const o=t[n];if(!(o<0)&&++n<i){let r=t[n];if(r<0)continue;for(++n;n<i;++n){const i=t[n];if(i<0)break;e.push(o,r,i),r=i}}}},getPolygonIndex:function(t){return this.triangleIndex[t]},build:function(){Nh.prototype.build.call(this,3,this.triangleIndex.length,3,this.triangleIndex.length)}});const gC=fC;n.set("x_ite/Components/Rendering/IndexedTriangleFanSet",gC);const mC=gC;function _C(t){Nh.call(this,t),this.addType(c.IndexedTriangleSet)}_C.prototype=Object.assign(Object.create(Nh.prototype),{constructor:_C,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new Y([new B(c.inputOutput,"metadata",new Ri.SFNode),new B(c.inputOnly,"set_index",new Ri.MFInt32),new B(c.initializeOnly,"solid",new Ri.SFBool(!0)),new B(c.initializeOnly,"ccw",new Ri.SFBool(!0)),new B(c.initializeOnly,"colorPerVertex",new Ri.SFBool(!0)),new B(c.initializeOnly,"normalPerVertex",new Ri.SFBool(!0)),new B(c.initializeOnly,"index",new Ri.MFInt32),new B(c.inputOutput,"attrib",new Ri.MFNode),new B(c.inputOutput,"fogCoord",new Ri.SFNode),new B(c.inputOutput,"color",new Ri.SFNode),new B(c.inputOutput,"texCoord",new Ri.SFNode),new B(c.inputOutput,"normal",new Ri.SFNode),new B(c.inputOutput,"coord",new Ri.SFNode)]),getTypeName:function(){return"IndexedTriangleSet"},getComponentName:function(){return"Rendering"},getContainerField:function(){return"geometry"},getPolygonIndex:function(t){return this._index[t]},initialize:function(){Nh.prototype.initialize.call(this),this._set_index.addFieldInterest(this._index)},build:function(){Nh.prototype.build.call(this,3,this._index.length,3,this._index.length)}});const xC=_C;n.set("x_ite/Components/Rendering/IndexedTriangleSet",xC);const yC=xC;function wC(t){Nh.call(this,t),this.addType(c.IndexedTriangleStripSet),this.triangleIndex=[]}wC.prototype=Object.assign(Object.create(Nh.prototype),{constructor:wC,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new Y([new B(c.inputOutput,"metadata",new Ri.SFNode),new B(c.inputOnly,"set_index",new Ri.MFInt32),new B(c.initializeOnly,"solid",new Ri.SFBool(!0)),new B(c.initializeOnly,"ccw",new Ri.SFBool(!0)),new B(c.initializeOnly,"colorPerVertex",new Ri.SFBool(!0)),new B(c.initializeOnly,"normalPerVertex",new Ri.SFBool(!0)),new B(c.initializeOnly,"index",new Ri.MFInt32),new B(c.inputOutput,"attrib",new Ri.MFNode),new B(c.inputOutput,"fogCoord",new Ri.SFNode),new B(c.inputOutput,"color",new Ri.SFNode),new B(c.inputOutput,"texCoord",new Ri.SFNode),new B(c.inputOutput,"normal",new Ri.SFNode),new B(c.inputOutput,"coord",new Ri.SFNode)]),getTypeName:function(){return"IndexedTriangleStripSet"},getComponentName:function(){return"Rendering"},getContainerField:function(){return"geometry"},initialize:function(){Nh.prototype.initialize.call(this),this._set_index.addFieldInterest(this._index),this._index.addInterest("set_index__",this),this.set_index__()},set_index__:function(){const t=this._index,e=this.triangleIndex;e.length=0;for(let n=0,i=t.length;n<i;++n){let o=t[n];if(!(o<0)&&++n<i){let r=t[n];if(r<0)continue;++n;for(let s=0;n<i;++n,++s){const i=t[n];if(i<0)break;e.push(o,r,i),1&s?r=i:o=i}}}},getPolygonIndex:function(t){return this.triangleIndex[t]},build:function(){Nh.prototype.build.call(this,3,this.triangleIndex.length,3,this.triangleIndex.length)}});const SC=wC;n.set("x_ite/Components/Rendering/IndexedTriangleStripSet",SC);const TC=SC;function bC(t){Dd.call(this,t),this.addType(c.LineSet),this.fogCoordNode=null,this.colorNode=null,this.normalNode=null,this.coordNode=null}bC.prototype=Object.assign(Object.create(Dd.prototype),{constructor:bC,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new Y([new B(c.inputOutput,"metadata",new Ri.SFNode),new B(c.inputOutput,"vertexCount",new Ri.MFInt32),new B(c.inputOutput,"attrib",new Ri.MFNode),new B(c.inputOutput,"fogCoord",new Ri.SFNode),new B(c.inputOutput,"color",new Ri.SFNode),new B(c.inputOutput,"normal",new Ri.SFNode),new B(c.inputOutput,"coord",new Ri.SFNode)]),getTypeName:function(){return"LineSet"},getComponentName:function(){return"Rendering"},getContainerField:function(){return"geometry"},initialize:function(){Dd.prototype.initialize.call(this),this._attrib.addInterest("set_attrib__",this),this._fogCoord.addInterest("set_fogCoord__",this),this._color.addInterest("set_color__",this),this._normal.addInterest("set_normal__",this),this._coord.addInterest("set_coord__",this),this.set_attrib__(),this.set_fogCoord__(),this.set_color__(),this.set_normal__(),this.set_coord__()},set_attrib__:function(){const t=this.getAttrib();for(const e of t)e.removeInterest("requestRebuild",this),e._attribute_changed.removeInterest("updateVertexArrays",this);t.length=0;for(const e of this._attrib){const n=nu(c.X3DVertexAttributeNode,e);n&&t.push(n)}for(const e of t)e.addInterest("requestRebuild",this),e._attribute_changed.addInterest("updateVertexArrays",this);this.updateVertexArrays()},set_fogCoord__:function(){this.fogCoordNode&&this.fogCoordNode.removeInterest("requestRebuild",this),this.fogCoordNode=nu(c.FogCoordinate,this._fogCoord),this.fogCoordNode&&this.fogCoordNode.addInterest("requestRebuild",this)},set_color__:function(){this.colorNode&&(this.colorNode.removeInterest("requestRebuild",this),this.colorNode._transparent.removeInterest("set_transparent__",this)),this.colorNode=nu(c.X3DColorNode,this._color),this.colorNode?(this.colorNode.addInterest("requestRebuild",this),this.colorNode._transparent.addInterest("set_transparent__",this),this.set_transparent__()):this.setTransparent(!1)},set_transparent__:function(){this.setTransparent(this.colorNode.getTransparent())},set_normal__:function(){this.normalNode&&this.normalNode.removeInterest("requestRebuild",this),this.normalNode=nu(c.X3DNormalNode,this._normal),this.normalNode&&this.normalNode.addInterest("requestRebuild",this)},set_coord__:function(){this.coordNode&&this.coordNode.removeInterest("requestRebuild",this),this.coordNode=nu(c.X3DCoordinateNode,this._coord),this.coordNode&&this.coordNode.addInterest("requestRebuild",this)},build:function(){if(!this.coordNode||this.coordNode.isEmpty())return;const t=this._vertexCount,e=this.getAttrib(),n=e.length,i=this.getAttribs(),o=this.fogCoordNode,r=this.colorNode,s=this.normalNode,a=this.coordNode,u=this.getFogDepths(),c=this.getColors(),l=this.getNormals(),h=this.getVertices(),d=a.getSize();let p=0;for(let f of t){if(p+f>d)break;if(f>1){f=2*f-2;for(let t=0;t<f;++t,p+=1&t){for(let t=0;t<n;++t)e[t].addValue(p,i[t]);o&&o.addDepth(p,u),r&&r.addColor(p,c),s&&s.addVector(p,l),a.addPoint(p,h)}++p}else p+=f}}});const vC=bC;n.set("x_ite/Components/Rendering/LineSet",vC);const CC=vC;function EC(t){Rh.call(this,t),this.addType(c.X3DNormalNode)}EC.prototype=Object.assign(Object.create(Rh.prototype),{constructor:EC});const OC=EC;n.set("x_ite/Components/Rendering/X3DNormalNode",OC);const NC=OC;function FC(t){NC.call(this,t),this.addType(c.Normal)}FC.prototype=Object.assign(Object.create(NC.prototype),{constructor:FC,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new Y([new B(c.inputOutput,"metadata",new Ri.SFNode),new B(c.inputOutput,"vector",new Ri.MFVec3f)]),getTypeName:function(){return"Normal"},getComponentName:function(){return"Rendering"},getContainerField:function(){return"normal"},initialize:function(){NC.prototype.initialize.call(this),this._vector.addInterest("set_vector__",this),this.set_vector__()},set_vector__:function(){this.vector=this._vector.getValue(),this.length=this._vector.length},set1Vector:function(t,e){this._vector[t]=e},get1Vector:function(t,e){if(t>=0&&t<this.length){const n=this.vector;return t*=3,e.set(n[t],n[t+1],n[t+2])}if(t>=0&&this.length){const n=this.vector;return t%=this.length,t*=3,e.set(n[t],n[t+1],n[t+2])}return e.set(0,0,0)},addVector:function(t,e){if(t>=0&&t<this.length){const n=this.vector;t*=3,e.push(n[t],n[t+1],n[t+2])}else{if(!(t>=0&&this.length))return e.push(0,0,0);{const n=this.vector;t%=this.length,t*=3,e.push(n[t],n[t+1],n[t+2])}}},addNormals:function(t,e){if(this.length){const o=this.vector;for(var n=0,i=3*Math.min(e,this.length);n<i;n+=3)t.push(o[n],o[n+1],o[n+2]);if(this.length<e){const r=o[n=3*(this.length-1)],s=o[n+1],a=o[n+2];for(n=i,i=3*e;n<i;n+=3)t.push(r,s,a)}}else for(let n=0;n<e;++n)t.push(0,0,0);return t}});const IC=FC;n.set("x_ite/Components/Rendering/Normal",IC);const MC=IC;function DC(t){Pa.call(this,t);const e=this.getBrowser();this.setGeometryType(0),this.setPrimitiveMode(e.getContext().POINTS),this.setSolid(!1),this.setTransparent(!0)}DC.prototype=Object.assign(Object.create(Pa.prototype),{constructor:DC,intersectsLine:function(){const t=new Ks,e=new xe(0,0,0),n=new xe(0,0,0),i=new xe(0,0,0),o=new xe(0,0,0),r=new xe(0,0,0),s=new xe(0,0,0),a=new hn,u=new de(0,0),c=new xe(0,0,0);return function(l,h,d,p,f){const g=h.getModelViewMatrix().get(),m=h.getViewVolume().getViewport(),_=(t.assign(this.getBBox()).multRight(g).getExtents(e,n),p.getPointProperties()),x=Math.max(1.5,_?_.getPointSize(e)/2:1),y=h.getViewpoint().getScreenScale(e,m,i),w=d.multDirMatrix(y.multiply(x)),S=Math.max(1.5,_?_.getPointSize(n)/2:1),T=h.getViewpoint().getScreenScale(n,m,o),b=d.multDirMatrix(T.multiply(S));if(this.intersectsBBox(l,w.abs().max(b.abs()))){const t=this.getBrowser().getPointer(),e=h.getProjectionMatrix().get(),n=h.getLocalObjects(),i=this.getVertices(),o=i.length;a.assign(g).multRight(e);for(let e=0;e<o;e+=4){r.set(i[e+0],i[e+1],i[e+2]),Rs.projectPointMatrix(r,a,m,u);const o=Math.max(1.5,_?_.getPointSize(g.multVecMatrix(s.assign(r)))/2:1);if(u.distance(t)<=o){if(n.length&&this.isClipped(g.multVecMatrix(c.assign(r)),n))continue;const e=t.copy().subtract(u).divide(o).add(de.One).divide(2),i=g.submatrix.transpose().z.copy().normalize();f.push({texCoord:e,normal:i,point:r.copy()})}}}return f.length}}(),intersectsLineWithGeometry:function(){return!1},intersectsBox:function(t,e,n){return!1},buildTexCoords:function(){},display:function(t,e){const n=e.appearanceNode,i=n.getShader(this,e),o=n.getBlendMode(),r=this.getAttrib(),s=this.getAttribBuffers();if(o&&o.enable(t),i.enable(t),i.setUniforms(t,this,e),this.vertexArrayObject.enable(t,i)){for(let e=0,n=r.length;e<n;++e)r[e].enable(t,i,s[e]);this.hasFogCoords&&i.enableFogDepthAttribute(t,this.fogDepthBuffer,0,0),this.colorMaterial&&i.enableColorAttribute(t,this.colorBuffer,0,0),this.hasNormals&&i.enableNormalAttribute(t,this.normalBuffer,0,0),i.enableVertexAttribute(t,this.vertexBuffer,0,0)}t.drawArrays(this.primitiveMode,0,this.vertexCount),o&&o.disable(t)},displayParticles:function(t,e,n){const i=e.appearanceNode,o=i.getShader(this,e),r=i.getBlendMode(),s=this.getAttrib(),a=this.getAttribBuffers();r&&r.enable(t),o.enable(t),o.setUniforms(t,this,e);const u=n.outputParticles;if(u.vertexArrayObject.update(this.updateParticles).enable(t,o)){const e=n.particleStride;o.enableParticleAttribute(t,u,e,n.particleOffset,1),o.enableParticleMatrixAttribute(t,u,e,n.matrixOffset,1);for(let e=0,n=s.length;e<n;++e)s[e].enable(t,o,a[e]);this.hasFogCoords&&o.enableFogDepthAttribute(t,this.fogDepthBuffer,0,0),this.colorMaterial&&o.enableColorAttribute(t,this.colorBuffer,0,0),this.hasNormals&&o.enableNormalAttribute(t,this.normalBuffer,0,0),o.enableVertexAttribute(t,this.vertexBuffer,0,0),this.updateParticles=!1}t.drawArraysInstanced(this.primitiveMode,0,this.vertexCount,n.numParticles),r&&r.disable(t)}});const VC=DC;n.set("x_ite/Components/Rendering/X3DPointGeometryNode",VC);const RC=VC;function PC(t){RC.call(this,t),this.addType(c.PointSet),this.fogCoordNode=null,this.colorNode=null,this.normalNode=null,this.coordNode=null}PC.prototype=Object.assign(Object.create(RC.prototype),{constructor:PC,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new Y([new B(c.inputOutput,"metadata",new Ri.SFNode),new B(c.inputOutput,"attrib",new Ri.MFNode),new B(c.inputOutput,"fogCoord",new Ri.SFNode),new B(c.inputOutput,"color",new Ri.SFNode),new B(c.inputOutput,"normal",new Ri.SFNode),new B(c.inputOutput,"coord",new Ri.SFNode)]),getTypeName:function(){return"PointSet"},getComponentName:function(){return"Rendering"},getContainerField:function(){return"geometry"},initialize:function(){RC.prototype.initialize.call(this),this._attrib.addInterest("set_attrib__",this),this._fogCoord.addInterest("set_fogCoord__",this),this._color.addInterest("set_color__",this),this._normal.addInterest("set_normal__",this),this._coord.addInterest("set_coord__",this),this.set_attrib__(),this.set_fogCoord__(),this.set_color__(),this.set_normal__(),this.set_coord__()},getCoord:function(){return this.coordNode},set_attrib__:function(){const t=this.getAttrib();for(const e of t)e.removeInterest("requestRebuild",this),e._attribute_changed.removeInterest("updateVertexArrays",this);t.length=0;for(const e of this._attrib){const n=nu(c.X3DVertexAttributeNode,e);n&&t.push(n)}for(const e of t)e.addInterest("requestRebuild",this),e._attribute_changed.addInterest("updateVertexArrays",this);this.updateVertexArrays()},set_fogCoord__:function(){this.fogCoordNode&&this.fogCoordNode.removeInterest("requestRebuild",this),this.fogCoordNode=nu(c.FogCoordinate,this._fogCoord),this.fogCoordNode&&this.fogCoordNode.addInterest("requestRebuild",this)},set_color__:function(){this.colorNode&&this.colorNode.removeInterest("requestRebuild",this),this.colorNode=nu(c.X3DColorNode,this._color),this.colorNode&&this.colorNode.addInterest("requestRebuild",this)},set_normal__:function(){this.normalNode&&this.normalNode.removeInterest("requestRebuild",this),this.normalNode=nu(c.X3DNormalNode,this._normal),this.normalNode&&this.normalNode.addInterest("requestRebuild",this)},set_coord__:function(){this.coordNode&&this.coordNode.removeInterest("requestRebuild",this),this.coordNode=nu(c.X3DCoordinateNode,this._coord),this.coordNode&&this.coordNode.addInterest("requestRebuild",this)},build:function(){if(!this.coordNode||this.coordNode.isEmpty())return;const t=this.getAttrib(),e=t.length,n=this.getAttribs(),i=this.fogCoordNode,o=this.getFogDepths(),r=this.colorNode,s=this.getColors(),a=this.coordNode,u=this.getNormals(),c=this.normalNode,l=this.getVertices(),h=a._point.length;for(let i=0;i<e;++i)for(let e=0;e<h;++e)t[i].addValue(e,n[i]);i&&i.addDepths(o,h),r&&r.addColors(s,h),c&&c.addNormals(u,h),a.addPoints(l,h)}});const AC=PC;n.set("x_ite/Components/Rendering/PointSet",AC);const LC=AC;function BC(t){Nh.call(this,t),this.addType(c.TriangleFanSet),this.triangleIndex=[]}BC.prototype=Object.assign(Object.create(Nh.prototype),{constructor:BC,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new Y([new B(c.inputOutput,"metadata",new Ri.SFNode),new B(c.initializeOnly,"solid",new Ri.SFBool(!0)),new B(c.initializeOnly,"ccw",new Ri.SFBool(!0)),new B(c.initializeOnly,"colorPerVertex",new Ri.SFBool(!0)),new B(c.initializeOnly,"normalPerVertex",new Ri.SFBool(!0)),new B(c.inputOutput,"fanCount",new Ri.MFInt32),new B(c.inputOutput,"attrib",new Ri.MFNode),new B(c.inputOutput,"fogCoord",new Ri.SFNode),new B(c.inputOutput,"color",new Ri.SFNode),new B(c.inputOutput,"texCoord",new Ri.SFNode),new B(c.inputOutput,"normal",new Ri.SFNode),new B(c.inputOutput,"coord",new Ri.SFNode)]),getTypeName:function(){return"TriangleFanSet"},getComponentName:function(){return"Rendering"},getContainerField:function(){return"geometry"},initialize:function(){Nh.prototype.initialize.call(this),this._fanCount.addInterest("set_fanCount__",this),this.set_fanCount__()},set_fanCount__:function(){const t=this._fanCount,e=this.triangleIndex;e.length=0;let n=0;for(const i of t){for(let t=1,o=i-1;t<o;++t)e.push(n,n+t,n+t+1);n+=i}},getPolygonIndex:function(t){return this.triangleIndex[t]},build:function(){Nh.prototype.build.call(this,3,this.triangleIndex.length,3,this.triangleIndex.length)}});const XC=BC;n.set("x_ite/Components/Rendering/TriangleFanSet",XC);const UC=XC;function kC(t){Nh.call(this,t),this.addType(c.TriangleSet)}kC.prototype=Object.assign(Object.create(Nh.prototype),{constructor:kC,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new Y([new B(c.inputOutput,"metadata",new Ri.SFNode),new B(c.initializeOnly,"solid",new Ri.SFBool(!0)),new B(c.initializeOnly,"ccw",new Ri.SFBool(!0)),new B(c.initializeOnly,"colorPerVertex",new Ri.SFBool(!0)),new B(c.initializeOnly,"normalPerVertex",new Ri.SFBool(!0)),new B(c.inputOutput,"attrib",new Ri.MFNode),new B(c.inputOutput,"fogCoord",new Ri.SFNode),new B(c.inputOutput,"color",new Ri.SFNode),new B(c.inputOutput,"texCoord",new Ri.SFNode),new B(c.inputOutput,"normal",new Ri.SFNode),new B(c.inputOutput,"coord",new Ri.SFNode)]),getTypeName:function(){return"TriangleSet"},getComponentName:function(){return"Rendering"},getContainerField:function(){return"geometry"},build:function(){this.getCoord()&&Nh.prototype.build.call(this,3,this.getCoord().getSize(),3,this.getCoord().getSize())},createNormals:function(t,e){return this.createFaceNormals(t,e)}});const zC=kC;n.set("x_ite/Components/Rendering/TriangleSet",zC);const jC=zC;function GC(t){Nh.call(this,t),this.addType(c.TriangleStripSet),this.triangleIndex=[]}GC.prototype=Object.assign(Object.create(Nh.prototype),{constructor:GC,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new Y([new B(c.inputOutput,"metadata",new Ri.SFNode),new B(c.initializeOnly,"solid",new Ri.SFBool(!0)),new B(c.initializeOnly,"ccw",new Ri.SFBool(!0)),new B(c.initializeOnly,"colorPerVertex",new Ri.SFBool(!0)),new B(c.initializeOnly,"normalPerVertex",new Ri.SFBool(!0)),new B(c.inputOutput,"stripCount",new Ri.MFInt32),new B(c.inputOutput,"attrib",new Ri.MFNode),new B(c.inputOutput,"fogCoord",new Ri.SFNode),new B(c.inputOutput,"color",new Ri.SFNode),new B(c.inputOutput,"texCoord",new Ri.SFNode),new B(c.inputOutput,"normal",new Ri.SFNode),new B(c.inputOutput,"coord",new Ri.SFNode)]),getTypeName:function(){return"TriangleStripSet"},getComponentName:function(){return"Rendering"},getContainerField:function(){return"geometry"},initialize:function(){Nh.prototype.initialize.call(this),this._stripCount.addInterest("set_stripCount__",this),this.set_stripCount__()},set_stripCount__:function(){const t=this._stripCount,e=this.triangleIndex;e.length=0;let n=0;for(const i of t){for(let t=0,o=i-2;t<o;++t){const i=1&t;e.push(n+(i?t+1:t),n+(i?t:t+1),n+(t+2))}n+=i}},getPolygonIndex:function(t){return this.triangleIndex[t]},build:function(){Nh.prototype.build.call(this,3,this.triangleIndex.length,3,this.triangleIndex.length)}});const HC=GC;n.set("x_ite/Components/Rendering/TriangleStripSet",HC);const qC={ClipPlane:lC,Color:kd,ColorRGBA:pC,Coordinate:Uh,IndexedLineSet:Pd,IndexedTriangleFanSet:mC,IndexedTriangleSet:yC,IndexedTriangleStripSet:TC,LineSet:CC,Normal:MC,PointSet:LC,TriangleFanSet:UC,TriangleSet:jC,TriangleStripSet:HC},YC={X3DColorNode:Bd,X3DComposedGeometryNode:Nh,X3DCoordinateNode:Lh,X3DGeometricPropertyNode:Rh,X3DGeometryNode:Pa,X3DLineGeometryNode:Dd,X3DNormalNode:NC};for(const t in qC)Qo.addType(t,qC[t]);for(const t in YC)Qo.addAbstractType(t,YC[t]);const WC=void 0;n.set("x_ite/Components/Rendering",WC);function KC(t){Rh.call(this,t),this.addType(c.X3DVertexAttributeNode),this.addChildObjects("attribute_changed",new Ri.SFTime)}KC.prototype=Object.assign(Object.create(Rh.prototype),{constructor:KC,initialize:function(){Rh.prototype.initialize.call(this),this._name.addInterest("set_attribute__",this)},set_attribute__:function(){this._attribute_changed=this.getBrowser().getCurrentTime()}});const JC=KC;n.set("x_ite/Components/Shaders/X3DVertexAttributeNode",JC);const ZC=JC;function QC(t){ZC.call(this,t),this.addType(c.FloatVertexAttribute)}QC.prototype=Object.assign(Object.create(ZC.prototype),{constructor:QC,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new Y([new B(c.inputOutput,"metadata",new Ri.SFNode),new B(c.initializeOnly,"name",new Ri.SFString),new B(c.initializeOnly,"numComponents",new Ri.SFInt32(4)),new B(c.inputOutput,"value",new Ri.MFFloat)]),getTypeName:function(){return"FloatVertexAttribute"},getComponentName:function(){return"Shaders"},getContainerField:function(){return"attrib"},initialize:function(){ZC.prototype.initialize.call(this),this._numComponents.addInterest("set_numComponents__",this),this._numComponents.addInterest("set_attribute__",this),this._value.addInterest("set_value__",this),this.set_numComponents__(),this.set_value__()},set_numComponents__:function(){this.numComponents=gt.clamp(this._numComponents.getValue(),1,4)},set_value__:function(){this.value=this._value.getValue(),this.length=this._value.length},addValue:function(t,e){const n=this.value;let i=t*this.numComponents,o=i+this.numComponents;if(o<=this.length)for(;i<o;++i)e.push(n[i]);else if(this.numComponents<=this.length)for(o=n.length,i=o-this.numComponents;i<o;++i)e.push(n[i]);else for(;i<o;++i)e.push(0)},enable:function(t,e,n){e.enableFloatAttrib(t,this._name.getValue(),n,this.numComponents,0,0)}});const $C=QC;n.set("x_ite/Components/Shaders/FloatVertexAttribute",$C);const tE=$C;function eE(t){ZC.call(this,t),this.addType(c.Matrix3VertexAttribute)}eE.prototype=Object.assign(Object.create(ZC.prototype),{constructor:eE,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new Y([new B(c.inputOutput,"metadata",new Ri.SFNode),new B(c.initializeOnly,"name",new Ri.SFString),new B(c.inputOutput,"value",new Ri.MFMatrix3f)]),getTypeName:function(){return"Matrix3VertexAttribute"},getComponentName:function(){return"Shaders"},getContainerField:function(){return"attrib"},initialize:function(){ZC.prototype.initialize.call(this),this._value.addInterest("set_value__",this),this.set_value__()},set_value__:function(){this.value=this._value.getValue(),this.length=this._value.length},addValue:function(t,e){if(t<this.length){const n=this.value;for(let i=9*t,o=i+9;i<o;++i)e.push(n[i])}else if(this.length){const n=this.value;for(let i=9*(t=this.length-1),o=i+9;i<o;++i)e.push(n[i])}else{const t=Ie.Identity;for(let n=0;n<9;++n)e.push(t[n])}},enable:function(t,e,n){e.enableMatrix3Attrib(t,this._name.getValue(),n,0,0)}});const nE=eE;n.set("x_ite/Components/Shaders/Matrix3VertexAttribute",nE);const iE=nE;function oE(t){ZC.call(this,t),this.addType(c.Matrix4VertexAttribute)}oE.prototype=Object.assign(Object.create(ZC.prototype),{constructor:oE,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new Y([new B(c.inputOutput,"metadata",new Ri.SFNode),new B(c.initializeOnly,"name",new Ri.SFString),new B(c.inputOutput,"value",new Ri.MFMatrix4f)]),getTypeName:function(){return"Matrix4VertexAttribute"},getComponentName:function(){return"Shaders"},getContainerField:function(){return"attrib"},initialize:function(){ZC.prototype.initialize.call(this),this._value.addInterest("set_value__",this),this.set_value__()},set_value__:function(){this.value=this._value.getValue(),this.length=this._value.length},addValue:function(t,e){if(t<this.length){const n=this.value;for(let i=16*t,o=i+16;i<o;++i)e.push(n[i])}else if(this.length){const n=this.value;for(let i=16*(t=this.length-1),o=i+16;i<o;++i)e.push(n[i])}else{const t=Matrix4.Identity;for(let n=0;n<16;++n)e.push(t[n])}},enable:function(t,e,n){e.enableMatrix4Attrib(t,this._name.getValue(),n,0,0)}});const rE=oE;n.set("x_ite/Components/Shaders/Matrix4VertexAttribute",rE);const sE=rE;function aE(t){x_.call(this,t),kr.call(this,t),b_.call(this,t),this.addType(c.PackagedShader)}aE.prototype=Object.assign(Object.create(x_.prototype),kr.prototype,b_.prototype,{constructor:aE,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new Y([new B(c.inputOutput,"metadata",new Ri.SFNode),new B(c.inputOutput,"description",new Ri.SFString),new B(c.inputOnly,"activate",new Ri.SFBool),new B(c.outputOnly,"isSelected",new Ri.SFBool),new B(c.outputOnly,"isValid",new Ri.SFBool),new B(c.initializeOnly,"language",new Ri.SFString),new B(c.inputOutput,"load",new Ri.SFBool(!0)),new B(c.inputOutput,"url",new Ri.MFString),new B(c.inputOutput,"autoRefresh",new Ri.SFTime),new B(c.inputOutput,"autoRefreshTimeLimit",new Ri.SFTime(3600))]),getTypeName:function(){return"PackagedShader"},getComponentName:function(){return"Shaders"},getContainerField:function(){return"shaders"},getSourceText:function(){return this._url},requestImmediateLoad:function(t=!0){},requestUnload:function(){},initialize:function(){x_.prototype.initialize.call(this),kr.prototype.initialize.call(this),b_.prototype.initialize.call(this)},dispose:function(){b_.prototype.dispose.call(this),kr.prototype.dispose.call(this),x_.prototype.dispose.call(this)}});const uE=aE;n.set("x_ite/Components/Shaders/PackagedShader",uE);const cE=uE;function lE(t){x_.call(this,t),this.addType(c.ProgramShader)}lE.prototype=Object.assign(Object.create(x_.prototype),{constructor:lE,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new Y([new B(c.inputOutput,"metadata",new Ri.SFNode),new B(c.inputOnly,"activate",new Ri.SFBool),new B(c.outputOnly,"isSelected",new Ri.SFBool),new B(c.outputOnly,"isValid",new Ri.SFBool),new B(c.initializeOnly,"language",new Ri.SFString),new B(c.inputOutput,"programs",new Ri.MFNode)]),getTypeName:function(){return"ProgramShader"},getComponentName:function(){return"Shaders"},getContainerField:function(){return"shaders"}});const hE=lE;n.set("x_ite/Components/Shaders/ProgramShader",hE);const dE=hE;function pE(t){or.call(this,t),kr.call(this,t),b_.call(this,t),this.addType(c.ShaderProgram)}pE.prototype=Object.assign(Object.create(or.prototype),kr.prototype,b_.prototype,{constructor:pE,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new Y([new B(c.inputOutput,"metadata",new Ri.SFNode),new B(c.inputOutput,"description",new Ri.SFString),new B(c.initializeOnly,"type",new Ri.SFString("VERTEX")),new B(c.inputOutput,"load",new Ri.SFBool(!0)),new B(c.inputOutput,"url",new Ri.MFString),new B(c.inputOutput,"autoRefresh",new Ri.SFTime),new B(c.inputOutput,"autoRefreshTimeLimit",new Ri.SFTime(3600))]),getTypeName:function(){return"ShaderProgram"},getComponentName:function(){return"Shaders"},getContainerField:function(){return"programs"},getSourceText:function(){return this._url},requestImmediateLoad:function(t=!0){},requestUnload:function(){},initialize:function(){or.prototype.initialize.call(this),kr.prototype.initialize.call(this),b_.prototype.initialize.call(this)},dispose:function(){b_.prototype.dispose.call(this),kr.prototype.dispose.call(this),or.prototype.dispose.call(this)}});const fE=pE;n.set("x_ite/Components/Shaders/ShaderProgram",fE);const gE={ComposedShader:D_,FloatVertexAttribute:tE,Matrix3VertexAttribute:iE,Matrix4VertexAttribute:sE,PackagedShader:cE,ProgramShader:dE,ShaderPart:ix,ShaderProgram:fE},mE={X3DProgrammableShaderObject:b_,X3DShaderNode:x_,X3DVertexAttributeNode:ZC};for(const t in gE)Qo.addType(t,gE[t]);for(const t in mE)Qo.addAbstractType(t,mE[t]);const _E=void 0;n.set("x_ite/Components/Shaders",_E);function xE(t){Za.call(this,t),this.addType(c.AcousticProperties)}xE.prototype=Object.assign(Object.create(Za.prototype),{constructor:xE,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new Y([new B(c.inputOutput,"metadata",new Ri.SFNode),new B(c.inputOutput,"description",new Ri.SFString),new B(c.inputOutput,"enabled",new Ri.SFBool(!0)),new B(c.inputOutput,"absorption",new Ri.SFFloat),new B(c.inputOutput,"refraction",new Ri.SFFloat),new B(c.inputOutput,"diffuse",new Ri.SFFloat),new B(c.inputOutput,"specular",new Ri.SFFloat)]),getTypeName:function(){return"AcousticProperties"},getComponentName:function(){return"Shape"},getContainerField:function(){return"AcousticProperties"}});const yE=xE;n.set("x_ite/Components/Shape/AcousticProperties",yE);const wE=yE;function SE(t){Za.call(this,t),this.addType(c.FillProperties),this.addChildObjects("transparent",new Ri.SFBool),this._transparent.setAccessType(c.outputOnly),this.hatchColor=new Float32Array(3)}SE.prototype=Object.assign(Object.create(Za.prototype),{constructor:SE,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new Y([new B(c.inputOutput,"metadata",new Ri.SFNode),new B(c.inputOutput,"filled",new Ri.SFBool(!0)),new B(c.inputOutput,"hatched",new Ri.SFBool(!0)),new B(c.inputOutput,"hatchColor",new Ri.SFColor(1,1,1)),new B(c.inputOutput,"hatchStyle",new Ri.SFInt32(1))]),getTypeName:function(){return"FillProperties"},getComponentName:function(){return"Shape"},getContainerField:function(){return"fillProperties"},initialize:function(){Za.prototype.initialize.call(this),this._filled.addInterest("set_filled__",this),this._hatched.addInterest("set_hatched__",this),this._hatchColor.addInterest("set_hatchColor__",this),this._hatchStyle.addInterest("set_hatchStyle__",this),this.set_filled__(),this.set_hatched__(),this.set_hatchColor__(),this.set_hatchStyle__(),this.getBrowser().getHatchStyleTexture(this.hatchStyle)},set_filled__:function(){this.filled=this._filled.getValue(),this.setTransparent(!this.filled)},set_hatched__:function(){this.hatched=this._hatched.getValue()},set_hatchColor__:function(){this.hatchColor[0]=this._hatchColor[0],this.hatchColor[1]=this._hatchColor[1],this.hatchColor[2]=this._hatchColor[2]},set_hatchStyle__:function(){let t=this._hatchStyle.getValue();(t<1||t>19)&&(t=1),this.hatchStyle=t},setTransparent:function(t){t!==this._transparent.getValue()&&(this._transparent=t)},getTransparent:function(){return this._transparent.getValue()},setShaderUniforms:function(t,e){const n=this.hatched;if(t.uniform1i(e.x3d_FillPropertiesFilled,this.filled),t.uniform1i(e.x3d_FillPropertiesHatched,n),n){const n=this.getBrowser(),i=n.getHatchStyleTexture(this.hatchStyle),o=n.getTexture2DUnit();t.uniform3fv(e.x3d_FillPropertiesHatchColor,this.hatchColor),t.activeTexture(t.TEXTURE0+o),t.bindTexture(t.TEXTURE_2D,i.getTexture()),t.uniform1i(e.x3d_FillPropertiesTexture,o)}}});const TE=SE;n.set("x_ite/Components/Shape/FillProperties",TE);const bE=TE;function vE(t){Za.call(this,t),this.addType(c.LineProperties)}vE.prototype=Object.assign(Object.create(Za.prototype),{constructor:vE,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new Y([new B(c.inputOutput,"metadata",new Ri.SFNode),new B(c.inputOutput,"applied",new Ri.SFBool(!0)),new B(c.inputOutput,"linetype",new Ri.SFInt32(1)),new B(c.inputOutput,"linewidthScaleFactor",new Ri.SFFloat)]),getTypeName:function(){return"LineProperties"},getComponentName:function(){return"Shape"},getContainerField:function(){return"lineProperties"},initialize:function(){Za.prototype.initialize.call(this),this._applied.addInterest("set_applied__",this),this._linetype.addInterest("set_linetype__",this),this._linewidthScaleFactor.addInterest("set_linewidthScaleFactor__",this),this.set_applied__(),this.set_linetype__(),this.set_linewidthScaleFactor__(),this.getBrowser().getLinetypeTexture()},getApplied:function(){return this.applied},getLinetype:function(){return this.linetype},getLinewidthScaleFactor:function(){return this.linewidthScaleFactor},getTransformLines:function(){return this.transformLines},set_applied__:function(){this.applied=this._applied.getValue()},set_linetype__:function(){let t=this._linetype.getValue();(t<1||t>16)&&(t=1),this.linetype=t},set_linewidthScaleFactor__:function(){const t=this.getBrowser().getContext();this.linewidthScaleFactor=Math.max(1,this._linewidthScaleFactor.getValue()),this.transformLines=t.HAS_FEATURE_TRANSFORMED_LINES&&this.linewidthScaleFactor>1},setShaderUniforms:function(t,e){if(this.applied){const n=this.getBrowser(),i=n.getTexture2DUnit();t.lineWidth(this.linewidthScaleFactor),t.uniform1i(e.x3d_LinePropertiesApplied,!0),t.uniform1i(e.x3d_LinePropertiesLinetype,this.linetype),t.activeTexture(t.TEXTURE0+i),t.bindTexture(t.TEXTURE_2D,n.getLinetypeTexture().getTexture()),t.uniform1i(e.x3d_LinePropertiesTexture,i)}else t.lineWidth(1),t.uniform1i(e.x3d_LinePropertiesApplied,!1)}});const CE=vE;n.set("x_ite/Components/Shape/LineProperties",CE);const EE=CE;function OE(t){Sx.call(this,t),this.addType(c.Material),t.getSpecificationVersion()<4&&(this.getMaterialKey=NE),this.diffuseColor=new Float32Array(3),this.specularColor=new Float32Array(3)}function NE(t){return t||+this.getTextureBits()||this.getBrowser().getBrowserOptions().getShading()===Co.PHONG?"2":"1"}OE.prototype=Object.assign(Object.create(Sx.prototype),{constructor:OE,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new Y([new B(c.inputOutput,"metadata",new Ri.SFNode),new B(c.inputOutput,"ambientIntensity",new Ri.SFFloat(.2)),new B(c.inputOutput,"ambientTexture",new Ri.SFNode),new B(c.inputOutput,"ambientTextureMapping",new Ri.SFString),new B(c.inputOutput,"diffuseColor",new Ri.SFColor(.8,.8,.8)),new B(c.inputOutput,"diffuseTexture",new Ri.SFNode),new B(c.inputOutput,"diffuseTextureMapping",new Ri.SFString),new B(c.inputOutput,"specularColor",new Ri.SFColor),new B(c.inputOutput,"specularTexture",new Ri.SFNode),new B(c.inputOutput,"specularTextureMapping",new Ri.SFString),new B(c.inputOutput,"emissiveColor",new Ri.SFColor),new B(c.inputOutput,"emissiveTexture",new Ri.SFNode),new B(c.inputOutput,"emissiveTextureMapping",new Ri.SFString),new B(c.inputOutput,"shininess",new Ri.SFFloat(.2)),new B(c.inputOutput,"shininessTexture",new Ri.SFNode),new B(c.inputOutput,"shininessTextureMapping",new Ri.SFString),new B(c.inputOutput,"occlusionStrength",new Ri.SFFloat(1)),new B(c.inputOutput,"occlusionTexture",new Ri.SFNode),new B(c.inputOutput,"occlusionTextureMapping",new Ri.SFString),new B(c.inputOutput,"normalScale",new Ri.SFFloat(1)),new B(c.inputOutput,"normalTexture",new Ri.SFNode),new B(c.inputOutput,"normalTextureMapping",new Ri.SFString),new B(c.inputOutput,"transparency",new Ri.SFFloat)]),getTypeName:function(){return"Material"},getComponentName:function(){return"Shape"},getContainerField:function(){return"material"},initialize:function(){Sx.prototype.initialize.call(this),this._ambientIntensity.addInterest("set_ambientIntensity__",this),this._ambientTexture.addInterest("set_ambientTexture__",this),this._diffuseColor.addInterest("set_diffuseColor__",this),this._diffuseTexture.addInterest("set_diffuseTexture__",this),this._specularColor.addInterest("set_specularColor__",this),this._specularTexture.addInterest("set_specularTexture__",this),this._shininess.addInterest("set_shininess__",this),this._shininessTexture.addInterest("set_shininessTexture__",this),this._occlusionStrength.addInterest("set_occlusionStrength__",this),this._occlusionTexture.addInterest("set_occlusionTexture__",this),this.set_ambientIntensity__(),this.set_ambientTexture__(),this.set_diffuseColor__(),this.set_diffuseTexture__(),this.set_specularColor__(),this.set_specularTexture__(),this.set_shininess__(),this.set_shininessTexture__(),this.set_occlusionStrength__(),this.set_occlusionTexture__(),this.set_transparent__()},set_ambientIntensity__:function(){this.ambientIntensity=gt.clamp(this._ambientIntensity.getValue(),0,1)},set_ambientTexture__:function(){this.ambientTextureNode=nu(c.X3DSingleTextureNode,this._ambientTexture),this.setTexture(this.getTextureIndices().AMBIENT_TEXTURE,this.ambientTextureNode)},set_diffuseColor__:function(){const t=this.diffuseColor,e=this._diffuseColor.getValue();t[0]=e.r,t[1]=e.g,t[2]=e.b},set_diffuseTexture__:function(){this.diffuseTextureNode&&this.diffuseTextureNode._transparent.removeInterest("set_transparent__",this),this.diffuseTextureNode=nu(c.X3DSingleTextureNode,this._diffuseTexture),this.diffuseTextureNode&&this.diffuseTextureNode._transparent.addInterest("set_transparent__",this),this.setTexture(this.getTextureIndices().DIFFUSE_TEXTURE,this.diffuseTextureNode)},set_specularColor__:function(){const t=this.specularColor,e=this._specularColor.getValue();t[0]=e.r,t[1]=e.g,t[2]=e.b},set_specularTexture__:function(){this.specularTextureNode=nu(c.X3DSingleTextureNode,this._specularTexture),this.setTexture(this.getTextureIndices().SPECULAR_TEXTURE,this.specularTextureNode)},set_shininess__:function(){this.shininess=gt.clamp(this._shininess.getValue(),0,1)},set_shininessTexture__:function(){this.shininessTextureNode=nu(c.X3DSingleTextureNode,this._shininessTexture),this.setTexture(this.getTextureIndices().SHININESS_TEXTURE,this.shininessTextureNode)},set_occlusionStrength__:function(){this.occlusionStrength=gt.clamp(this._occlusionStrength.getValue(),0,1)},set_occlusionTexture__:function(){this.occlusionTextureNode=nu(c.X3DSingleTextureNode,this._occlusionTexture),this.setTexture(this.getTextureIndices().OCCLUSION_TEXTURE,this.occlusionTextureNode)},set_transparent__:function(){this.setTransparent(Boolean(this.getTransparency()||this.diffuseTextureNode&&this.diffuseTextureNode.getTransparent()))},getTextureIndices:function(){let t=0;const e={EMISSIVE_TEXTURE:t++,NORMAL_TEXTURE:t++,AMBIENT_TEXTURE:t++,DIFFUSE_TEXTURE:t++,SPECULAR_TEXTURE:t++,SHININESS_TEXTURE:t++,OCCLUSION_TEXTURE:t++};return function(){return e}}(),getMaterialKey:function(){return"2"},createShader:function(t,e,n){const i=this.getBrowser(),o=this.getShaderOptions(e,n);if(e.hasNormals)switch(o.push("X3D_MATERIAL"),+this.getTextureBits()&&(this.ambientTextureNode&&o.push("X3D_AMBIENT_TEXTURE","X3D_AMBIENT_TEXTURE_"+this.ambientTextureNode.getTextureTypeString()),this.diffuseTextureNode&&o.push("X3D_DIFFUSE_TEXTURE","X3D_DIFFUSE_TEXTURE_"+this.diffuseTextureNode.getTextureTypeString()),this.specularTextureNode&&o.push("X3D_SPECULAR_TEXTURE","X3D_SPECULAR_TEXTURE_"+this.specularTextureNode.getTextureTypeString()),this.shininessTextureNode&&o.push("X3D_SHININESS_TEXTURE","X3D_SHININESS_TEXTURE_"+this.shininessTextureNode.getTextureTypeString()),this.occlusionTextureNode&&o.push("X3D_OCCLUSION_TEXTURE","X3D_OCCLUSION_TEXTURE_"+this.occlusionTextureNode.getTextureTypeString())),this.getMaterialKey(n&&n.shadows)){case"1":var r=i.createShader("GouraudShader","Gouraud","Gouraud",o);break;case"2":r=i.createShader("PhongShader","Default","Phong",o)}else{o.push("X3D_UNLIT_MATERIAL");r=i.createShader("UnlitShader","Default","Unlit",o);i.getShaders().set(t.replace(/^(\d{1,2})\d*/,"$1").replace(/\d$/,"0"),r)}return i.getShaders().set(t,r),r},setShaderUniforms:function(t,e,n,i,o){if(Sx.prototype.setShaderUniforms.call(this,t,e,n,i,o),t.uniform1f(e.x3d_AmbientIntensity,this.ambientIntensity),t.uniform3fv(e.x3d_DiffuseColor,this.diffuseColor),t.uniform3fv(e.x3d_SpecularColor,this.specularColor),t.uniform1f(e.x3d_Shininess,this.shininess),+this.getTextureBits()){if(this.ambientTextureNode){const r=e.x3d_AmbientTexture;this.ambientTextureNode.setShaderUniforms(t,e,n,r),t.uniform1i(r.textureTransformMapping,i.get(this._ambientTextureMapping.getValue())||0),t.uniform1i(r.textureCoordinateMapping,o.get(this._ambientTextureMapping.getValue())||0)}if(this.diffuseTextureNode){const r=e.x3d_DiffuseTexture;this.diffuseTextureNode.setShaderUniforms(t,e,n,r),t.uniform1i(r.textureTransformMapping,i.get(this._diffuseTextureMapping.getValue())||0),t.uniform1i(r.textureCoordinateMapping,o.get(this._diffuseTextureMapping.getValue())||0)}if(this.specularTextureNode){const r=e.x3d_SpecularTexture;this.specularTextureNode.setShaderUniforms(t,e,n,r),t.uniform1i(r.textureTransformMapping,i.get(this._specularTextureMapping.getValue())||0),t.uniform1i(r.textureCoordinateMapping,o.get(this._specularTextureMapping.getValue())||0)}if(this.shininessTextureNode){const r=e.x3d_ShininessTexture;this.shininessTextureNode.setShaderUniforms(t,e,n,r),t.uniform1i(r.textureTransformMapping,i.get(this._shininessTextureMapping.getValue())||0),t.uniform1i(r.textureCoordinateMapping,o.get(this._shininessTextureMapping.getValue())||0)}if(this.occlusionTextureNode){const r=e.x3d_OcclusionTexture;t.uniform1f(e.x3d_OcclusionStrength,this.occlusionStrength),this.occlusionTextureNode.setShaderUniforms(t,e,n,r),t.uniform1i(r.textureTransformMapping,i.get(this._occlusionTextureMapping.getValue())||0),t.uniform1i(r.textureCoordinateMapping,o.get(this._occlusionTextureMapping.getValue())||0)}}}});const FE=OE;n.set("x_ite/Components/Shape/Material",FE);const IE=FE;function ME(t){Sx.call(this,t),this.addType(c.PhysicalMaterial),this.baseColor=new Float32Array(3)}ME.prototype=Object.assign(Object.create(Sx.prototype),{constructor:ME,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new Y([new B(c.inputOutput,"metadata",new Ri.SFNode),new B(c.inputOutput,"baseColor",new Ri.SFColor(1,1,1)),new B(c.inputOutput,"baseTexture",new Ri.SFNode),new B(c.inputOutput,"baseTextureMapping",new Ri.SFString),new B(c.inputOutput,"emissiveColor",new Ri.SFColor(0,0,0)),new B(c.inputOutput,"emissiveTexture",new Ri.SFNode),new B(c.inputOutput,"emissiveTextureMapping",new Ri.SFString),new B(c.inputOutput,"metallic",new Ri.SFFloat(1)),new B(c.inputOutput,"roughness",new Ri.SFFloat(1)),new B(c.inputOutput,"metallicRoughnessTexture",new Ri.SFNode),new B(c.inputOutput,"metallicRoughnessTextureMapping",new Ri.SFString),new B(c.inputOutput,"occlusionStrength",new Ri.SFFloat(1)),new B(c.inputOutput,"occlusionTexture",new Ri.SFNode),new B(c.inputOutput,"occlusionTextureMapping",new Ri.SFString),new B(c.inputOutput,"normalScale",new Ri.SFFloat(1)),new B(c.inputOutput,"normalTexture",new Ri.SFNode),new B(c.inputOutput,"normalTextureMapping",new Ri.SFString),new B(c.inputOutput,"transparency",new Ri.SFFloat)]),getTypeName:function(){return"PhysicalMaterial"},getComponentName:function(){return"Shape"},getContainerField:function(){return"material"},initialize:function(){Sx.prototype.initialize.call(this),this._baseColor.addInterest("set_baseColor__",this),this._baseTexture.addInterest("set_baseTexture__",this),this._metallic.addInterest("set_metallic__",this),this._roughness.addInterest("set_roughness__",this),this._metallicRoughnessTexture.addInterest("set_metallicRoughnessTexture__",this),this._occlusionStrength.addInterest("set_occlusionStrength__",this),this._occlusionTexture.addInterest("set_occlusionTexture__",this),this.set_baseColor__(),this.set_baseTexture__(),this.set_metallic__(),this.set_roughness__(),this.set_metallicRoughnessTexture__(),this.set_occlusionStrength__(),this.set_occlusionTexture__(),this.set_transparent__()},set_baseColor__:function(){const t=this.baseColor,e=this._baseColor.getValue();t[0]=e.r,t[1]=e.g,t[2]=e.b},set_baseTexture__:function(){this.baseTextureNode&&this.baseTextureNode._transparent.removeInterest("set_transparent__",this),this.baseTextureNode=nu(c.X3DSingleTextureNode,this._baseTexture),this.setTexture(this.getTextureIndices().BASE_TEXTURE,this.baseTextureNode),this.baseTextureNode&&this.baseTextureNode._transparent.addInterest("set_transparent__",this)},set_metallic__:function(){this.metallic=gt.clamp(this._metallic.getValue(),0,1)},set_roughness__:function(){this.roughness=gt.clamp(this._roughness.getValue(),0,1)},set_metallicRoughnessTexture__:function(){this.metallicRoughnessTextureNode=nu(c.X3DSingleTextureNode,this._metallicRoughnessTexture),this.setTexture(this.getTextureIndices().METALLIC_ROUGHNESS_TEXTURE,this.metallicRoughnessTextureNode)},set_occlusionStrength__:function(){this.occlusionStrength=gt.clamp(this._occlusionStrength.getValue(),0,1)},set_occlusionTexture__:function(){this.occlusionTextureNode=nu(c.X3DSingleTextureNode,this._occlusionTexture),this.setTexture(this.getTextureIndices().OCCLUSION_TEXTURE,this.occlusionTextureNode)},set_transparent__:function(){this.setTransparent(Boolean(this.getTransparency()||this.baseTextureNode&&this.baseTextureNode.getTransparent()))},getTextureIndices:function(){let t=0;const e={EMISSIVE_TEXTURE:t++,NORMAL_TEXTURE:t++,BASE_TEXTURE:t++,METALLIC_ROUGHNESS_TEXTURE:t++,OCCLUSION_TEXTURE:t++};return function(){return e}}(),getMaterialKey:function(){return"3"},createShader:function(t,e,n){const i=this.getBrowser(),o=this.getShaderOptions(e,n);if(e.hasNormals){o.push("X3D_PHYSICAL_MATERIAL"),+this.getTextureBits()&&(this.baseTextureNode&&o.push("X3D_BASE_TEXTURE","X3D_BASE_TEXTURE_"+this.baseTextureNode.getTextureTypeString()),this.metallicRoughnessTextureNode&&o.push("X3D_METALLIC_ROUGHNESS_TEXTURE","X3D_METALLIC_ROUGHNESS_TEXTURE_"+this.metallicRoughnessTextureNode.getTextureTypeString()),this.occlusionTextureNode&&o.push("X3D_OCCLUSION_TEXTURE","X3D_OCCLUSION_TEXTURE_"+this.occlusionTextureNode.getTextureTypeString()));var r=i.createShader("PhysicalMaterialShader","Default","PBR",o)}else{o.push("X3D_UNLIT_MATERIAL");r=i.createShader("UnlitShader","Default","Unlit",o);i.getShaders().set(t.replace(/^(\d{1,2})\d*/,"$1").replace(/\d$/,"0"),r)}return i.getShaders().set(t,r),r},setShaderUniforms:function(t,e,n,i,o){if(Sx.prototype.setShaderUniforms.call(this,t,e,n,i,o),t.uniform3fv(e.x3d_BaseColor,this.baseColor),t.uniform1f(e.x3d_Metallic,this.metallic),t.uniform1f(e.x3d_Roughness,this.roughness),+this.getTextureBits()){if(this.baseTextureNode){const r=e.x3d_BaseTexture;this.baseTextureNode.setShaderUniforms(t,e,n,r),t.uniform1i(r.textureTransformMapping,i.get(this._baseTextureMapping.getValue())||0),t.uniform1i(r.textureCoordinateMapping,o.get(this._baseTextureMapping.getValue())||0)}if(this.metallicRoughnessTextureNode){const r=e.x3d_MetallicRoughnessTexture;this.metallicRoughnessTextureNode.setShaderUniforms(t,e,n,r),t.uniform1i(r.textureTransformMapping,i.get(this._metallicRoughnessTextureMapping.getValue())||0),t.uniform1i(r.textureCoordinateMapping,o.get(this._metallicRoughnessTextureMapping.getValue())||0)}if(this.occlusionTextureNode){const r=e.x3d_OcclusionTexture;t.uniform1f(e.x3d_OcclusionStrength,this.occlusionStrength),this.occlusionTextureNode.setShaderUniforms(t,e,n,r),t.uniform1i(r.textureTransformMapping,i.get(this._occlusionTextureMapping.getValue())||0),t.uniform1i(r.textureCoordinateMapping,o.get(this._occlusionTextureMapping.getValue())||0)}}}});const DE=ME;n.set("x_ite/Components/Shape/PhysicalMaterial",DE);const VE=DE;function RE(t){Za.call(this,t),this.addType(c.PointProperties),this.attenuation=new Float32Array(3)}RE.prototype=Object.assign(Object.create(Za.prototype),{constructor:RE,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new Y([new B(c.inputOutput,"metadata",new Ri.SFNode),new B(c.inputOutput,"pointSizeScaleFactor",new Ri.SFFloat(1)),new B(c.inputOutput,"pointSizeMinValue",new Ri.SFFloat(1)),new B(c.inputOutput,"pointSizeMaxValue",new Ri.SFFloat(1)),new B(c.inputOutput,"attenuation",new Ri.MFFloat(1,0,0))]),getTypeName:function(){return"PointProperties"},getComponentName:function(){return"Shape"},getContainerField:function(){return"pointProperties"},initialize:function(){Za.prototype.initialize.call(this);const t=this.getBrowser().getContext();this.pointSizeRange=t.getParameter(t.ALIASED_POINT_SIZE_RANGE),this._pointSizeScaleFactor.addInterest("set_pointSizeScaleFactor__",this),this._pointSizeMinValue.addInterest("set_pointSizeMinValue__",this),this._pointSizeMaxValue.addInterest("set_pointSizeMaxValue__",this),this._attenuation.addInterest("set_attenuation__",this),this.set_pointSizeScaleFactor__(),this.set_pointSizeMinValue__(),this.set_pointSizeMaxValue__(),this.set_attenuation__()},getPointSize:function(t){const e=this.attenuation,n=t.magnitude();let i=this.pointSizeScaleFactor;return i/=e[0]+e[1]*n+e[2]*(n*n),i=gt.clamp(i,this.pointSizeMinValue,this.pointSizeMaxValue),i},set_pointSizeScaleFactor__:function(){this.pointSizeScaleFactor=Math.max(this._pointSizeScaleFactor.getValue(),0)},set_pointSizeMinValue__:function(){this.pointSizeMinValue=gt.clamp(this._pointSizeMinValue.getValue(),0,this.pointSizeRange[1])},set_pointSizeMaxValue__:function(){this.pointSizeMaxValue=gt.clamp(this._pointSizeMaxValue.getValue(),0,this.pointSizeRange[1])},set_attenuation__:function(){const t=this._attenuation.length;this.attenuation[0]=t>0?Math.max(0,this._attenuation[0]):1,this.attenuation[1]=t>1?Math.max(0,this._attenuation[1]):0,this.attenuation[2]=t>2?Math.max(0,this._attenuation[2]):0},setShaderUniforms:function(t,e){t.uniform1f(e.x3d_PointPropertiesPointSizeScaleFactor,this.pointSizeScaleFactor),t.uniform1f(e.x3d_PointPropertiesPointSizeMinValue,this.pointSizeMinValue),t.uniform1f(e.x3d_PointPropertiesPointSizeMaxValue,this.pointSizeMaxValue),t.uniform3fv(e.x3d_PointPropertiesAttenuation,this.attenuation)}});const PE=RE;n.set("x_ite/Components/Shape/PointProperties",PE);const AE=PE;function LE(t){console.warn("TwoSidedMaterial is depreciated, please use Appearance backMaterial field."),xx.call(this,t),this.addType(c.TwoSidedMaterial),this.diffuseColor=new Float32Array(3),this.specularColor=new Float32Array(3),this.emissiveColor=new Float32Array(3),this.backDiffuseColor=new Float32Array(3),this.backSpecularColor=new Float32Array(3),this.backEmissiveColor=new Float32Array(3)}LE.prototype=Object.assign(Object.create(xx.prototype),{constructor:LE,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new Y([new B(c.inputOutput,"metadata",new Ri.SFNode),new B(c.inputOutput,"separateBackColor",new Ri.SFBool),new B(c.inputOutput,"ambientIntensity",new Ri.SFFloat(.2)),new B(c.inputOutput,"diffuseColor",new Ri.SFColor(.8,.8,.8)),new B(c.inputOutput,"specularColor",new Ri.SFColor),new B(c.inputOutput,"emissiveColor",new Ri.SFColor),new B(c.inputOutput,"shininess",new Ri.SFFloat(.2)),new B(c.inputOutput,"transparency",new Ri.SFFloat),new B(c.inputOutput,"backAmbientIntensity",new Ri.SFFloat(.2)),new B(c.inputOutput,"backDiffuseColor",new Ri.SFColor(.8,.8,.8)),new B(c.inputOutput,"backSpecularColor",new Ri.SFColor),new B(c.inputOutput,"backEmissiveColor",new Ri.SFColor),new B(c.inputOutput,"backShininess",new Ri.SFFloat(.2)),new B(c.inputOutput,"backTransparency",new Ri.SFFloat)]),getTypeName:function(){return"TwoSidedMaterial"},getComponentName:function(){return"Shape"},getContainerField:function(){return"material"},initialize:function(){xx.prototype.initialize.call(this),this._ambientIntensity.addInterest("set_ambientIntensity__",this),this._diffuseColor.addInterest("set_diffuseColor__",this),this._specularColor.addInterest("set_specularColor__",this),this._emissiveColor.addInterest("set_emissiveColor__",this),this._shininess.addInterest("set_shininess__",this),this._transparency.addInterest("set_transparency__",this),this._backAmbientIntensity.addInterest("set_backAmbientIntensity__",this),this._backDiffuseColor.addInterest("set_backDiffuseColor__",this),this._backSpecularColor.addInterest("set_backSpecularColor__",this),this._backEmissiveColor.addInterest("set_backEmissiveColor__",this),this._backShininess.addInterest("set_backShininess__",this),this._backTransparency.addInterest("set_backTransparency__",this),this._separateBackColor.addInterest("set_transparent__",this),this._transparency.addInterest("set_transparent__",this),this._backTransparency.addInterest("set_transparent__",this),this.set_ambientIntensity__(),this.set_diffuseColor__(),this.set_specularColor__(),this.set_emissiveColor__(),this.set_shininess__(),this.set_transparency__(),this.set_backAmbientIntensity__(),this.set_backDiffuseColor__(),this.set_backSpecularColor__(),this.set_backEmissiveColor__(),this.set_backShininess__(),this.set_backTransparency__(),this.set_transparent__()},set_ambientIntensity__:function(){this.ambientIntensity=Math.max(this._ambientIntensity.getValue(),0)},set_diffuseColor__:function(){const t=this.diffuseColor,e=this._diffuseColor.getValue();t[0]=e.r,t[1]=e.g,t[2]=e.b},set_specularColor__:function(){const t=this.specularColor,e=this._specularColor.getValue();t[0]=e.r,t[1]=e.g,t[2]=e.b},set_emissiveColor__:function(){const t=this.emissiveColor,e=this._emissiveColor.getValue();t[0]=e.r,t[1]=e.g,t[2]=e.b},set_shininess__:function(){this.shininess=gt.clamp(this._shininess.getValue(),0,1)},set_transparency__:function(){this.transparency=gt.clamp(this._transparency.getValue(),0,1)},set_backAmbientIntensity__:function(){this.backAmbientIntensity=Math.max(this._backAmbientIntensity.getValue(),0)},set_backDiffuseColor__:function(){const t=this.backDiffuseColor,e=this._backDiffuseColor.getValue();t[0]=e.r,t[1]=e.g,t[2]=e.b},set_backSpecularColor__:function(){const t=this.backSpecularColor,e=this._backSpecularColor.getValue();t[0]=e.r,t[1]=e.g,t[2]=e.b},set_backEmissiveColor__:function(){const t=this.backEmissiveColor,e=this._backEmissiveColor.getValue();t[0]=e.r,t[1]=e.g,t[2]=e.b},set_backShininess__:function(){this.backShininess=gt.clamp(this._backShininess.getValue(),0,1)},set_backTransparency__:function(){this.backTransparency=gt.clamp(this._backTransparency.getValue(),0,1)},set_transparent__:function(){this.setTransparent(Boolean(this._transparency.getValue()||this._separateBackColor.getValue()&&this._backTransparency.getValue()))},getMaterialKey:IE.prototype.getMaterialKey,createShader:IE.prototype.createShader,setShaderUniforms:function(t,e,n,i,o,r){!r&&this._separateBackColor.getValue()?(t.uniform1f(e.x3d_AmbientIntensity,this.backAmbientIntensity),t.uniform3fv(e.x3d_DiffuseColor,this.backDiffuseColor),t.uniform3fv(e.x3d_SpecularColor,this.backSpecularColor),t.uniform3fv(e.x3d_EmissiveColor,this.backEmissiveColor),t.uniform1f(e.x3d_Shininess,this.backShininess),t.uniform1f(e.x3d_Transparency,this.backTransparency)):(t.uniform1f(e.x3d_AmbientIntensity,this.ambientIntensity),t.uniform3fv(e.x3d_DiffuseColor,this.diffuseColor),t.uniform3fv(e.x3d_SpecularColor,this.specularColor),t.uniform3fv(e.x3d_EmissiveColor,this.emissiveColor),t.uniform1f(e.x3d_Shininess,this.shininess),t.uniform1f(e.x3d_Transparency,this.transparency))}});const BE=LE;n.set("x_ite/Components/Shape/TwoSidedMaterial",BE);const XE={AcousticProperties:wE,Appearance:gx,FillProperties:bE,LineProperties:EE,Material:IE,PhysicalMaterial:VE,PointProperties:AE,Shape:Ed,TwoSidedMaterial:BE,UnlitMaterial:vx},UE={X3DAppearanceChildNode:Za,X3DAppearanceNode:dx,X3DMaterialNode:xx,X3DOneSidedMaterialNode:Sx,X3DShapeNode:_d};for(const t in XE)Qo.addType(t,XE[t]);for(const t in UE)Qo.addAbstractType(t,UE[t]);const kE=void 0;n.set("x_ite/Components/Shape",kE);function zE(t){ha.call(this,t),Cu.call(this,t),this.addType(c.X3DSoundProcessingNode)}zE.prototype=Object.assign(Object.create(ha.prototype),Cu.prototype,{constructor:zE,initialize:function(){ha.prototype.initialize.call(this),Cu.prototype.initialize.call(this)},dispose:function(){Cu.prototype.dispose.call(this),ha.prototype.dispose.call(this)}});const jE=zE;n.set("x_ite/Components/Sound/X3DSoundProcessingNode",jE);const GE=jE;function HE(t){GE.call(this,t),this.addType(c.Analyser)}HE.prototype=Object.assign(Object.create(GE.prototype),{constructor:HE,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new Y([new B(c.inputOutput,"metadata",new Ri.SFNode),new B(c.inputOutput,"description",new Ri.SFString),new B(c.inputOutput,"enabled",new Ri.SFBool(!0)),new B(c.inputOutput,"gain",new Ri.SFFloat(1)),new B(c.inputOutput,"fftSize",new Ri.SFInt32(2048)),new B(c.inputOutput,"frequencyBinCount",new Ri.SFInt32(1024)),new B(c.inputOutput,"minDecibels",new Ri.SFFloat(-100)),new B(c.inputOutput,"maxDecibels",new Ri.SFFloat(-30)),new B(c.inputOutput,"smoothingTimeConstant",new Ri.SFFloat(.8)),new B(c.inputOutput,"tailTime",new Ri.SFTime),new B(c.outputOnly,"channelCount",new Ri.SFInt32),new B(c.inputOutput,"channelCountMode",new Ri.SFString("max")),new B(c.inputOutput,"channelInterpretation",new Ri.SFString("speakers")),new B(c.inputOutput,"startTime",new Ri.SFTime),new B(c.inputOutput,"resumeTime",new Ri.SFTime),new B(c.inputOutput,"pauseTime",new Ri.SFTime),new B(c.inputOutput,"stopTime",new Ri.SFTime),new B(c.outputOnly,"isPaused",new Ri.SFBool),new B(c.outputOnly,"isActive",new Ri.SFBool),new B(c.outputOnly,"elapsedTime",new Ri.SFTime),new B(c.inputOutput,"children",new Ri.MFNode)]),getTypeName:function(){return"Analyser"},getComponentName:function(){return"Sound"},getContainerField:function(){return"children"}});const qE=HE;n.set("x_ite/Components/Sound/Analyser",qE);const YE=qE;function WE(t){ha.call(this,t),Cu.call(this,t),this.addType(c.X3DSoundSourceNode),this.volume=0,this.media=null}WE.prototype=Object.assign(Object.create(ha.prototype),Cu.prototype,{constructor:WE,initialize:function(){ha.prototype.initialize.call(this),Cu.prototype.initialize.call(this)},set_live__:function(){Cu.prototype.set_live__.call(this),this.getDisabled()?(this.getBrowser()._volume.removeInterest("set_volume__",this),this.getBrowser()._mute.removeInterest("set_volume__",this)):(this.getBrowser()._volume.addInterest("set_volume__",this),this.getBrowser()._mute.addInterest("set_volume__",this),this.set_volume__())},setMedia:function(t){this.media&&(this.media.muted=!0,this.media.pause()),this.media=t,t&&(this.media.muted=!1,this.media.volume=0,this.media.loop=this._loop.getValue(),this.setVolume(0),this._duration_changed=this.media.duration,this.resetElapsedTime(),this._isActive.getValue()?this._isPaused.getValue()?this.set_pause():this.getLiveState()?this.set_start():this.set_pause():this.set_stop())},setVolume:function(t){this.volume=gt.clamp(t,0,1),this.set_volume__()},set_loop:function(){this.media&&(this.media.loop=this._loop.getValue())},set_volume__:function(){if(!this.media)return;const t=!this.getBrowser()._mute.getValue()*gt.clamp(this.getBrowser()._volume.getValue(),0,1)*this.volume;this.media.volume=t},set_speed:function(){},set_pitch:function(){},set_start:function(){this.media&&this._speed.getValue()&&(this.media.currentTime=0,this.media.play().catch(Function.prototype))},set_pause:function(){this.media&&this.media.pause()},set_resume:function(){this.media&&this._speed.getValue()&&this.media.play().catch(Function.prototype)},set_stop:function(){this.media&&this.media.pause()},set_ended:function(){if(this.media){if(this.media.currentTime<this.media.duration)return;this._loop.getValue()||this.stop()}},set_time:function(){this.media&&(this._elapsedTime=this.getElapsedTime()),this.set_ended()},dispose:function(){Cu.prototype.dispose.call(this),ha.prototype.dispose.call(this)}});const KE=WE;n.set("x_ite/Components/Sound/X3DSoundSourceNode",KE);const JE=KE;var ZE=i(603);function QE(t){JE.call(this,t),kr.call(this,t),this.addType(c.AudioClip),this.addChildObjects("speed",new Ri.SFFloat(1)),this.audio=ZE("<audio></audio>"),this.urlStack=new Ri.MFString}QE.prototype=Object.assign(Object.create(JE.prototype),kr.prototype,{constructor:QE,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new Y([new B(c.inputOutput,"metadata",new Ri.SFNode),new B(c.inputOutput,"description",new Ri.SFString),new B(c.inputOutput,"enabled",new Ri.SFBool(!0)),new B(c.inputOutput,"load",new Ri.SFBool(!0)),new B(c.inputOutput,"url",new Ri.MFString),new B(c.inputOutput,"autoRefresh",new Ri.SFTime),new B(c.inputOutput,"autoRefreshTimeLimit",new Ri.SFTime(3600)),new B(c.inputOutput,"gain",new Ri.SFFloat(1)),new B(c.inputOutput,"pitch",new Ri.SFFloat(1)),new B(c.inputOutput,"loop",new Ri.SFBool),new B(c.inputOutput,"startTime",new Ri.SFTime),new B(c.inputOutput,"resumeTime",new Ri.SFTime),new B(c.inputOutput,"pauseTime",new Ri.SFTime),new B(c.inputOutput,"stopTime",new Ri.SFTime),new B(c.outputOnly,"isPaused",new Ri.SFBool),new B(c.outputOnly,"isActive",new Ri.SFBool),new B(c.outputOnly,"elapsedTime",new Ri.SFTime),new B(c.outputOnly,"duration_changed",new Ri.SFTime(-1))]),getTypeName:function(){return"AudioClip"},getComponentName:function(){return"Sound"},getContainerField:function(){return"source"},initialize:function(){JE.prototype.initialize.call(this),kr.prototype.initialize.call(this),this.audio.on("abort error",this.setError.bind(this)),this.audio.on("suspend stalled",this.setTimeout.bind(this)),this.audio[0].crossOrigin="Anonymous",this.audio[0].preload="auto",this.audio[0].muted=!0,this.requestImmediateLoad()},getElement:function(){return this.audio[0]},set_live__:function(){JE.prototype.set_live__.call(this),kr.prototype.set_live__.call(this)},unLoadNow:function(){this.setMedia(null)},loadNow:function(){this.setMedia(null),this.urlStack.setValue(this._url),this.audio.on("canplaythrough",this.setAudio.bind(this)),this.loadNext()},loadNext:function(){if(0===this.urlStack.length)return this.audio.off("canplaythrough"),this._duration_changed=-1,void this.setLoadState(c.FAILED_STATE);this.URL=new URL(this.urlStack.shift(),this.getExecutionContext().getWorldURL()),"data:"!==this.URL.protocol&&(this.getBrowser().getBrowserOptions().getCache()&&this.getCache()||this.URL.searchParams.set("_",Date.now())),this.audio.attr("src",this.URL.href),this.audio.get(0).load()},setTimeout:function(t){setTimeout(function(){this.checkLoadState()===c.IN_PROGRESS_STATE&&this.setError(t)}.bind(this),3e3)},setError:function(t){"data:"!==this.URL.protocol&&console.warn("Error loading audio:",decodeURI(this.URL.href),t?t.type:void 0),this.loadNext()},setAudio:function(){this.audio.unbind("canplaythrough"),this.setMedia(this.audio[0]),this.setLoadState(c.COMPLETE_STATE)},dispose:function(){kr.prototype.dispose.call(this),JE.prototype.dispose.call(this)}});const $E=QE;n.set("x_ite/Components/Sound/AudioClip",$E);const tO=$E;function eO(t){ha.call(this,t),this.addType(c.X3DSoundNode)}eO.prototype=Object.assign(Object.create(ha.prototype),{constructor:eO});const nO=eO;n.set("x_ite/Components/Sound/X3DSoundNode",nO);const iO=nO;function oO(t){iO.call(this,t),this.addType(c.X3DSoundDestinationNode)}oO.prototype=Object.assign(Object.create(iO.prototype),{constructor:oO});const rO=oO;n.set("x_ite/Components/Sound/X3DSoundDestinationNode",rO);const sO=rO;function aO(t){sO.call(this,t),this.addType(c.AudioDestination)}aO.prototype=Object.assign(Object.create(sO.prototype),{constructor:aO,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new Y([new B(c.inputOutput,"metadata",new Ri.SFNode),new B(c.inputOutput,"description",new Ri.SFString),new B(c.inputOutput,"enabled",new Ri.SFBool(!0)),new B(c.inputOutput,"gain",new Ri.SFFloat(1)),new B(c.inputOutput,"maxChannelCount",new Ri.SFInt32(2)),new B(c.outputOnly,"channelCount",new Ri.SFInt32),new B(c.inputOutput,"channelCountMode",new Ri.SFString("max")),new B(c.inputOutput,"channelInterpretation",new Ri.SFString("speakers")),new B(c.outputOnly,"mediaDeviceID",new Ri.SFString),new B(c.outputOnly,"isActive",new Ri.SFBool),new B(c.inputOutput,"children",new Ri.MFNode)]),getTypeName:function(){return"AudioDestination"},getComponentName:function(){return"Sound"},getContainerField:function(){return"children"}});const uO=aO;n.set("x_ite/Components/Sound/AudioDestination",uO);const cO=uO;function lO(t){GE.call(this,t),this.addType(c.BiquadFilter)}lO.prototype=Object.assign(Object.create(GE.prototype),{constructor:lO,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new Y([new B(c.inputOutput,"metadata",new Ri.SFNode),new B(c.inputOutput,"description",new Ri.SFString),new B(c.inputOutput,"enabled",new Ri.SFBool(!0)),new B(c.inputOutput,"detune",new Ri.SFFloat(0)),new B(c.inputOutput,"frequency",new Ri.SFFloat(350)),new B(c.inputOutput,"gain",new Ri.SFFloat(1)),new B(c.inputOutput,"qualityFactor",new Ri.SFFloat(1)),new B(c.inputOutput,"tailTime",new Ri.SFTime),new B(c.inputOutput,"type",new Ri.SFString("lowpass")),new B(c.outputOnly,"channelCount",new Ri.SFInt32),new B(c.inputOutput,"channelCountMode",new Ri.SFString("max")),new B(c.inputOutput,"channelInterpretation",new Ri.SFString("speakers")),new B(c.inputOutput,"startTime",new Ri.SFTime),new B(c.inputOutput,"resumeTime",new Ri.SFTime),new B(c.inputOutput,"pauseTime",new Ri.SFTime),new B(c.inputOutput,"stopTime",new Ri.SFTime),new B(c.outputOnly,"isPaused",new Ri.SFBool),new B(c.outputOnly,"isActive",new Ri.SFBool),new B(c.outputOnly,"elapsedTime",new Ri.SFTime),new B(c.inputOutput,"children",new Ri.MFNode)]),getTypeName:function(){return"BiquadFilter"},getComponentName:function(){return"Sound"},getContainerField:function(){return"children"}});const hO=lO;n.set("x_ite/Components/Sound/BiquadFilter",hO);const dO=hO;function pO(t){JE.call(this,t),kr.call(this,t),this.addType(c.BufferAudioSource),this.addChildObjects("speed",new Ri.SFFloat(1))}pO.prototype=Object.assign(Object.create(JE.prototype),kr.prototype,{constructor:pO,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new Y([new B(c.inputOutput,"metadata",new Ri.SFNode),new B(c.inputOutput,"description",new Ri.SFString),new B(c.inputOutput,"enabled",new Ri.SFBool(!0)),new B(c.inputOutput,"load",new Ri.SFBool(!0)),new B(c.inputOutput,"url",new Ri.MFString),new B(c.inputOutput,"autoRefresh",new Ri.SFTime),new B(c.inputOutput,"autoRefreshTimeLimit",new Ri.SFTime(3600)),new B(c.inputOutput,"gain",new Ri.SFFloat(1)),new B(c.inputOutput,"buffer",new Ri.MFFloat),new B(c.inputOutput,"detune",new Ri.SFFloat(0)),new B(c.inputOutput,"bufferDuration",new Ri.SFTime),new B(c.inputOutput,"loopStart",new Ri.SFTime),new B(c.inputOutput,"loopEnd",new Ri.SFTime),new B(c.inputOutput,"numberOfChannels",new Ri.SFInt32),new B(c.inputOutput,"playbackRate",new Ri.SFFloat(1)),new B(c.inputOutput,"sampleRate",new Ri.SFFloat(0)),new B(c.outputOnly,"bufferLength",new Ri.SFInt32),new B(c.outputOnly,"channelCount",new Ri.SFInt32),new B(c.inputOutput,"channelCountMode",new Ri.SFString("max")),new B(c.inputOutput,"channelInterpretation",new Ri.SFString("speakers")),new B(c.inputOutput,"loop",new Ri.SFBool),new B(c.inputOutput,"startTime",new Ri.SFTime),new B(c.inputOutput,"resumeTime",new Ri.SFTime),new B(c.inputOutput,"pauseTime",new Ri.SFTime),new B(c.inputOutput,"stopTime",new Ri.SFTime),new B(c.outputOnly,"isPaused",new Ri.SFBool),new B(c.outputOnly,"isActive",new Ri.SFBool),new B(c.outputOnly,"elapsedTime",new Ri.SFTime)]),getTypeName:function(){return"BufferAudioSource"},getComponentName:function(){return"Sound"},getContainerField:function(){return"children"},initialize:function(){JE.prototype.initialize.call(this),kr.prototype.initialize.call(this)},dispose:function(){kr.prototype.dispose.call(this),JE.prototype.dispose.call(this)}});const fO=pO;n.set("x_ite/Components/Sound/BufferAudioSource",fO);const gO=fO;function mO(t){iO.call(this,t),this.addType(c.X3DSoundChannelNode)}mO.prototype=Object.assign(Object.create(iO.prototype),{constructor:mO});const _O=mO;n.set("x_ite/Components/Sound/X3DSoundChannelNode",_O);const xO=_O;function yO(t){xO.call(this,t),this.addType(c.ChannelMerger)}yO.prototype=Object.assign(Object.create(xO.prototype),{constructor:yO,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new Y([new B(c.inputOutput,"metadata",new Ri.SFNode),new B(c.inputOutput,"description",new Ri.SFString),new B(c.inputOutput,"enabled",new Ri.SFBool(!0)),new B(c.inputOutput,"gain",new Ri.SFFloat(1)),new B(c.outputOnly,"channelCount",new Ri.SFInt32),new B(c.inputOutput,"channelCountMode",new Ri.SFString("max")),new B(c.inputOutput,"channelInterpretation",new Ri.SFString("speakers")),new B(c.inputOutput,"children",new Ri.MFNode)]),getTypeName:function(){return"ChannelMerger"},getComponentName:function(){return"Sound"},getContainerField:function(){return"children"}});const wO=yO;n.set("x_ite/Components/Sound/ChannelMerger",wO);const SO=wO;function TO(t){xO.call(this,t),this.addType(c.ChannelSelector)}TO.prototype=Object.assign(Object.create(xO.prototype),{constructor:TO,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new Y([new B(c.inputOutput,"metadata",new Ri.SFNode),new B(c.inputOutput,"description",new Ri.SFString),new B(c.inputOutput,"enabled",new Ri.SFBool(!0)),new B(c.inputOutput,"gain",new Ri.SFFloat(1)),new B(c.inputOutput,"channelSelection",new Ri.SFInt32(0)),new B(c.outputOnly,"channelCount",new Ri.SFInt32),new B(c.inputOutput,"channelCountMode",new Ri.SFString("max")),new B(c.inputOutput,"channelInterpretation",new Ri.SFString("speakers")),new B(c.inputOutput,"children",new Ri.MFNode)]),getTypeName:function(){return"ChannelSelector"},getComponentName:function(){return"Sound"},getContainerField:function(){return"children"}});const bO=TO;n.set("x_ite/Components/Sound/ChannelSelector",bO);const vO=bO;function CO(t){xO.call(this,t),this.addType(c.ChannelSplitter)}CO.prototype=Object.assign(Object.create(xO.prototype),{constructor:CO,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new Y([new B(c.inputOutput,"metadata",new Ri.SFNode),new B(c.inputOutput,"description",new Ri.SFString),new B(c.inputOutput,"enabled",new Ri.SFBool(!0)),new B(c.inputOutput,"gain",new Ri.SFFloat(1)),new B(c.outputOnly,"channelCount",new Ri.SFInt32),new B(c.inputOutput,"channelCountMode",new Ri.SFString("max")),new B(c.inputOutput,"channelInterpretation",new Ri.SFString("speakers")),new B(c.inputOutput,"children",new Ri.MFNode),new B(c.inputOutput,"outputs",new Ri.MFNode)]),getTypeName:function(){return"ChannelSplitter"},getComponentName:function(){return"Sound"},getContainerField:function(){return"children"}});const EO=CO;n.set("x_ite/Components/Sound/ChannelSplitter",EO);const OO=EO;function NO(t){GE.call(this,t),this.addType(c.Convolver)}NO.prototype=Object.assign(Object.create(GE.prototype),{constructor:NO,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new Y([new B(c.inputOutput,"metadata",new Ri.SFNode),new B(c.inputOutput,"description",new Ri.SFString),new B(c.inputOutput,"enabled",new Ri.SFBool(!0)),new B(c.inputOutput,"gain",new Ri.SFFloat(1)),new B(c.inputOutput,"buffer",new Ri.MFFloat),new B(c.inputOutput,"normalize",new Ri.SFBool),new B(c.inputOutput,"tailTime",new Ri.SFTime),new B(c.outputOnly,"channelCount",new Ri.SFInt32),new B(c.inputOutput,"channelCountMode",new Ri.SFString("max")),new B(c.inputOutput,"channelInterpretation",new Ri.SFString("speakers")),new B(c.inputOutput,"startTime",new Ri.SFTime),new B(c.inputOutput,"resumeTime",new Ri.SFTime),new B(c.inputOutput,"pauseTime",new Ri.SFTime),new B(c.inputOutput,"stopTime",new Ri.SFTime),new B(c.outputOnly,"isPaused",new Ri.SFBool),new B(c.outputOnly,"isActive",new Ri.SFBool),new B(c.outputOnly,"elapsedTime",new Ri.SFTime),new B(c.inputOutput,"children",new Ri.MFNode)]),getTypeName:function(){return"Convolver"},getComponentName:function(){return"Sound"},getContainerField:function(){return"children"}});const FO=NO;n.set("x_ite/Components/Sound/Convolver",FO);const IO=FO;function MO(t){GE.call(this,t),this.addType(c.Delay)}MO.prototype=Object.assign(Object.create(GE.prototype),{constructor:MO,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new Y([new B(c.inputOutput,"metadata",new Ri.SFNode),new B(c.inputOutput,"description",new Ri.SFString),new B(c.inputOutput,"enabled",new Ri.SFBool(!0)),new B(c.inputOutput,"gain",new Ri.SFFloat(1)),new B(c.inputOutput,"delayTime",new Ri.SFTime),new B(c.inputOutput,"maxDelayTime",new Ri.SFTime(1)),new B(c.inputOutput,"tailTime",new Ri.SFTime),new B(c.outputOnly,"channelCount",new Ri.SFInt32),new B(c.inputOutput,"channelCountMode",new Ri.SFString("max")),new B(c.inputOutput,"channelInterpretation",new Ri.SFString("speakers")),new B(c.inputOutput,"startTime",new Ri.SFTime),new B(c.inputOutput,"resumeTime",new Ri.SFTime),new B(c.inputOutput,"pauseTime",new Ri.SFTime),new B(c.inputOutput,"stopTime",new Ri.SFTime),new B(c.outputOnly,"isPaused",new Ri.SFBool),new B(c.outputOnly,"isActive",new Ri.SFBool),new B(c.outputOnly,"elapsedTime",new Ri.SFTime),new B(c.inputOutput,"children",new Ri.MFNode)]),getTypeName:function(){return"Delay"},getComponentName:function(){return"Sound"},getContainerField:function(){return"children"}});const DO=MO;n.set("x_ite/Components/Sound/Delay",DO);const VO=DO;function RO(t){GE.call(this,t),this.addType(c.DynamicsCompressor)}RO.prototype=Object.assign(Object.create(GE.prototype),{constructor:RO,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new Y([new B(c.inputOutput,"metadata",new Ri.SFNode),new B(c.inputOutput,"description",new Ri.SFString),new B(c.inputOutput,"enabled",new Ri.SFBool(!0)),new B(c.inputOutput,"gain",new Ri.SFFloat(1)),new B(c.inputOutput,"attack",new Ri.SFFloat(.003)),new B(c.inputOutput,"knee",new Ri.SFFloat(30)),new B(c.inputOutput,"ratio",new Ri.SFFloat(12)),new B(c.inputOutput,"reduction",new Ri.SFFloat),new B(c.inputOutput,"release",new Ri.SFTime(.25)),new B(c.inputOutput,"threshold",new Ri.SFFloat(-24)),new B(c.inputOutput,"tailTime",new Ri.SFTime),new B(c.outputOnly,"channelCount",new Ri.SFInt32),new B(c.inputOutput,"channelCountMode",new Ri.SFString("max")),new B(c.inputOutput,"channelInterpretation",new Ri.SFString("speakers")),new B(c.inputOutput,"startTime",new Ri.SFTime),new B(c.inputOutput,"resumeTime",new Ri.SFTime),new B(c.inputOutput,"pauseTime",new Ri.SFTime),new B(c.inputOutput,"stopTime",new Ri.SFTime),new B(c.outputOnly,"isPaused",new Ri.SFBool),new B(c.outputOnly,"isActive",new Ri.SFBool),new B(c.outputOnly,"elapsedTime",new Ri.SFTime),new B(c.inputOutput,"children",new Ri.MFNode)]),getTypeName:function(){return"DynamicsCompressor"},getComponentName:function(){return"Sound"},getContainerField:function(){return"children"}});const PO=RO;n.set("x_ite/Components/Sound/DynamicsCompressor",PO);const AO=PO;function LO(t){GE.call(this,t),this.addType(c.Gain)}LO.prototype=Object.assign(Object.create(GE.prototype),{constructor:LO,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new Y([new B(c.inputOutput,"metadata",new Ri.SFNode),new B(c.inputOutput,"description",new Ri.SFString),new B(c.inputOutput,"enabled",new Ri.SFBool(!0)),new B(c.inputOutput,"gain",new Ri.SFFloat(1)),new B(c.inputOutput,"tailTime",new Ri.SFTime),new B(c.outputOnly,"channelCount",new Ri.SFInt32),new B(c.inputOutput,"channelCountMode",new Ri.SFString("max")),new B(c.inputOutput,"channelInterpretation",new Ri.SFString("speakers")),new B(c.inputOutput,"startTime",new Ri.SFTime),new B(c.inputOutput,"resumeTime",new Ri.SFTime),new B(c.inputOutput,"pauseTime",new Ri.SFTime),new B(c.inputOutput,"stopTime",new Ri.SFTime),new B(c.outputOnly,"isPaused",new Ri.SFBool),new B(c.outputOnly,"isActive",new Ri.SFBool),new B(c.outputOnly,"elapsedTime",new Ri.SFTime),new B(c.inputOutput,"children",new Ri.MFNode)]),getTypeName:function(){return"Gain"},getComponentName:function(){return"Sound"},getContainerField:function(){return"children"}});const BO=LO;n.set("x_ite/Components/Sound/Gain",BO);const XO=BO;function UO(t){JE.call(this,t),this.addType(c.ListenerPointSource),this.addChildObjects("speed",new Ri.SFFloat(1)),this._position.setUnit("length")}UO.prototype=Object.assign(Object.create(JE.prototype),{constructor:UO,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new Y([new B(c.inputOutput,"metadata",new Ri.SFNode),new B(c.inputOutput,"description",new Ri.SFString),new B(c.inputOutput,"enabled",new Ri.SFBool(!0)),new B(c.inputOutput,"position",new Ri.SFVec3f),new B(c.inputOutput,"orientation",new Ri.SFRotation),new B(c.inputOutput,"gain",new Ri.SFFloat(1)),new B(c.inputOutput,"dopplerEnabled",new Ri.SFBool),new B(c.inputOutput,"interauralDistance",new Ri.SFFloat),new B(c.inputOutput,"trackCurrentView",new Ri.SFBool),new B(c.inputOutput,"startTime",new Ri.SFTime),new B(c.inputOutput,"resumeTime",new Ri.SFTime),new B(c.inputOutput,"pauseTime",new Ri.SFTime),new B(c.inputOutput,"stopTime",new Ri.SFTime),new B(c.outputOnly,"isPaused",new Ri.SFBool),new B(c.outputOnly,"isActive",new Ri.SFBool),new B(c.outputOnly,"elapsedTime",new Ri.SFTime)]),getTypeName:function(){return"ListenerPointSource"},getComponentName:function(){return"Sound"},getContainerField:function(){return"children"}});const kO=UO;n.set("x_ite/Components/Sound/ListenerPointSource",kO);const zO=kO;function jO(t){JE.call(this,t),this.addType(c.MicrophoneSource),this.addChildObjects("speed",new Ri.SFFloat(1))}jO.prototype=Object.assign(Object.create(JE.prototype),{constructor:jO,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new Y([new B(c.inputOutput,"metadata",new Ri.SFNode),new B(c.inputOutput,"description",new Ri.SFString),new B(c.inputOutput,"enabled",new Ri.SFBool(!0)),new B(c.inputOutput,"gain",new Ri.SFFloat(1)),new B(c.inputOutput,"mediaDeviceID",new Ri.SFString),new B(c.inputOutput,"startTime",new Ri.SFTime),new B(c.inputOutput,"resumeTime",new Ri.SFTime),new B(c.inputOutput,"pauseTime",new Ri.SFTime),new B(c.inputOutput,"stopTime",new Ri.SFTime),new B(c.outputOnly,"isPaused",new Ri.SFBool),new B(c.outputOnly,"isActive",new Ri.SFBool),new B(c.outputOnly,"elapsedTime",new Ri.SFTime)]),getTypeName:function(){return"MicrophoneSource"},getComponentName:function(){return"Sound"},getContainerField:function(){return"children"}});const GO=jO;n.set("x_ite/Components/Sound/MicrophoneSource",GO);const HO=GO;function qO(t){JE.call(this,t),this.addType(c.OscillatorSource),this.addChildObjects("speed",new Ri.SFFloat(1))}qO.prototype=Object.assign(Object.create(JE.prototype),{constructor:qO,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new Y([new B(c.inputOutput,"metadata",new Ri.SFNode),new B(c.inputOutput,"description",new Ri.SFString),new B(c.inputOutput,"enabled",new Ri.SFBool(!0)),new B(c.inputOutput,"gain",new Ri.SFFloat(1)),new B(c.inputOutput,"detune",new Ri.SFFloat),new B(c.inputOutput,"frequency",new Ri.SFFloat),new B(c.inputOutput,"periodicWave",new Ri.SFNode),new B(c.inputOutput,"startTime",new Ri.SFTime),new B(c.inputOutput,"resumeTime",new Ri.SFTime),new B(c.inputOutput,"pauseTime",new Ri.SFTime),new B(c.inputOutput,"stopTime",new Ri.SFTime),new B(c.outputOnly,"isPaused",new Ri.SFBool),new B(c.outputOnly,"isActive",new Ri.SFBool),new B(c.outputOnly,"elapsedTime",new Ri.SFTime)]),getTypeName:function(){return"OscillatorSource"},getComponentName:function(){return"Sound"},getContainerField:function(){return"children"}});const YO=qO;n.set("x_ite/Components/Sound/OscillatorSource",YO);const WO=YO;function KO(t){iO.call(this,t),this.addType(c.PeriodicWave)}KO.prototype=Object.assign(Object.create(iO.prototype),{constructor:KO,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new Y([new B(c.inputOutput,"metadata",new Ri.SFNode),new B(c.inputOutput,"description",new Ri.SFString),new B(c.inputOutput,"enabled",new Ri.SFBool(!0)),new B(c.inputOutput,"optionsReal",new Ri.MFFloat),new B(c.inputOutput,"optionsImag",new Ri.MFFloat),new B(c.inputOutput,"type",new Ri.SFString("square"))]),getTypeName:function(){return"PeriodicWave"},getComponentName:function(){return"Sound"},getContainerField:function(){return"periodicWave"}});const JO=KO;n.set("x_ite/Components/Sound/PeriodicWave",JO);const ZO=JO;function QO(t){iO.call(this,t),this.addType(c.Sound),this.addChildObjects("traversed",new Ri.SFBool(!0)),this._location.setUnit("length"),this._minBack.setUnit("length"),this._minFront.setUnit("length"),this._maxBack.setUnit("length"),this._maxFront.setUnit("length"),this.currentTraversed=!0}QO.prototype=Object.assign(Object.create(iO.prototype),{constructor:QO,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new Y([new B(c.inputOutput,"metadata",new Ri.SFNode),new B(c.inputOutput,"description",new Ri.SFString),new B(c.inputOutput,"enabled",new Ri.SFBool(!0)),new B(c.initializeOnly,"spatialize",new Ri.SFBool(!0)),new B(c.inputOutput,"intensity",new Ri.SFFloat(1)),new B(c.inputOutput,"location",new Ri.SFVec3f),new B(c.inputOutput,"direction",new Ri.SFVec3f(0,0,1)),new B(c.inputOutput,"minBack",new Ri.SFFloat(1)),new B(c.inputOutput,"minFront",new Ri.SFFloat(1)),new B(c.inputOutput,"maxBack",new Ri.SFFloat(10)),new B(c.inputOutput,"maxFront",new Ri.SFFloat(10)),new B(c.inputOutput,"priority",new Ri.SFFloat),new B(c.inputOutput,"source",new Ri.SFNode),new B(c.inputOutput,"children",new Ri.MFNode)]),getTypeName:function(){return"Sound"},getComponentName:function(){return"Sound"},getContainerField:function(){return"children"},initialize:function(){iO.prototype.initialize.call(this),this.isLive().addInterest("set_live__",this),this._traversed.addInterest("set_live__",this),this._source.addInterest("set_source__",this),this.set_live__(),this.set_source__()},setTraversed:function(t){t?!1===this._traversed.getValue()&&(this._traversed=!0):this.currentTraversed!==this._traversed.getValue()&&(this._traversed=this.currentTraversed),this.currentTraversed=t},getTraversed:function(){return this.currentTraversed},set_live__:function(){this.isLive().getValue()&&this._traversed.getValue()?this.getBrowser().sensorEvents().addInterest("update",this):this.getBrowser().sensorEvents().removeInterest("update",this)},set_source__:function(){this.sourceNode&&this.sourceNode.setVolume(0),this.sourceNode=nu(c.X3DSoundSourceNode,this._source)},update:function(){this.getTraversed()||this.sourceNode&&this.sourceNode.setVolume(0),this.setTraversed(!1)},traverse:function(){const t={distance:0,intersection:new xe(0,0,0)},e={distance:0,intersection:new xe(0,0,0)};return function(n,i){if(n!==Us.DISPLAY)return;if(!this.sourceNode)return;if(!this.sourceNode._isActive.getValue()||this.sourceNode._isPaused.getValue())return;this.setTraversed(!0);const o=i.getModelViewMatrix().get();if(this.getEllipsoidParameter(o,Math.max(this._maxBack.getValue(),0),Math.max(this._maxFront.getValue(),0),e),e.distance<1)if(this.getEllipsoidParameter(o,Math.max(this._minBack.getValue(),0),Math.max(this._minFront.getValue(),0),t),t.distance<1)this.sourceNode.setVolume(this._intensity.getValue());else{const n=e.intersection.magnitude(),i=e.intersection.distance(t.intersection),o=Math.min(n/i,1),r=gt.clamp(this._intensity.getValue(),0,1)*o;this.sourceNode.setVolume(r)}else this.sourceNode.setVolume(0)}}(),getEllipsoidParameter:function(){const t=new xe(0,0,0),e=new hn,n=new hn,i=new an,o=new xe(1,1,1),r=new tC(1,xe.Zero),s=new xe(0,0,0),a=new wd(xe.Zero,xe.zAxis),u=new xe(0,0,0),c=new xe(0,0,0);return function(l,h,d,p){if(0==h||0==d)return e.multVecMatrix(p.intersection.assign(this._location.getValue())),void(p.distance=1);const f=(h+d)/2,g=f-h,m=Math.sqrt(f*f-g*g);t.set(0,0,g),o.set(m,m,f),i.setFromToVec(xe.zAxis,this._direction.getValue()),e.assign(l).translate(this._location.getValue()).rotate(i).translate(t).scale(o),n.assign(e).inverse();const _=n.origin;t.negate().divVec(o),s.assign(t).subtract(_).normalize(),a.set(_,s),r.intersectsLine(a,u,c),p.intersection.assign(e.multVecMatrix(u)),p.distance=_.magnitude()}}()});const $O=QO;n.set("x_ite/Components/Sound/Sound",$O);const tN=$O;function eN(t){iO.call(this,t),this.addType(c.SpatialSound),this._location.setUnit("length")}eN.prototype=Object.assign(Object.create(iO.prototype),{constructor:eN,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new Y([new B(c.inputOutput,"metadata",new Ri.SFNode),new B(c.inputOutput,"description",new Ri.SFString),new B(c.inputOutput,"enabled",new Ri.SFBool(!0)),new B(c.initializeOnly,"spatialize",new Ri.SFBool(!0)),new B(c.inputOutput,"coneInnerAngle",new Ri.SFFloat(6.2832)),new B(c.inputOutput,"coneOuterAngle",new Ri.SFFloat(6.2832)),new B(c.inputOutput,"coneOuterGain",new Ri.SFFloat(0)),new B(c.inputOutput,"direction",new Ri.SFVec3f(0,0,1)),new B(c.inputOutput,"distanceModel",new Ri.SFString("INVERSE")),new B(c.inputOutput,"dopplerEnabled",new Ri.SFBool),new B(c.inputOutput,"enableHRTF",new Ri.SFBool),new B(c.inputOutput,"gain",new Ri.SFFloat(1)),new B(c.inputOutput,"intensity",new Ri.SFFloat(1)),new B(c.inputOutput,"location",new Ri.SFVec3f),new B(c.inputOutput,"maxDistance",new Ri.SFFloat(1e4)),new B(c.inputOutput,"priority",new Ri.SFFloat),new B(c.inputOutput,"referenceDistance",new Ri.SFFloat(1)),new B(c.inputOutput,"rolloffFactor",new Ri.SFFloat(1)),new B(c.inputOutput,"children",new Ri.MFNode)]),getTypeName:function(){return"SpatialSound"},getComponentName:function(){return"Sound"},getContainerField:function(){return"children"}});const nN=eN;n.set("x_ite/Components/Sound/SpatialSound",nN);const iN=nN;function oN(t){sO.call(this,t),this.addType(c.StreamAudioDestination)}oN.prototype=Object.assign(Object.create(sO.prototype),{constructor:oN,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new Y([new B(c.inputOutput,"metadata",new Ri.SFNode),new B(c.inputOutput,"description",new Ri.SFString),new B(c.inputOutput,"enabled",new Ri.SFBool(!0)),new B(c.inputOutput,"gain",new Ri.SFFloat(1)),new B(c.inputOutput,"streamIdentifier",new Ri.MFString),new B(c.outputOnly,"channelCount",new Ri.SFInt32),new B(c.inputOutput,"channelCountMode",new Ri.SFString("max")),new B(c.inputOutput,"channelInterpretation",new Ri.SFString("speakers")),new B(c.outputOnly,"mediaDeviceID",new Ri.SFString),new B(c.outputOnly,"isActive",new Ri.SFBool),new B(c.inputOutput,"children",new Ri.MFNode)]),getTypeName:function(){return"StreamAudioDestination"},getComponentName:function(){return"Sound"},getContainerField:function(){return"children"}});const rN=oN;n.set("x_ite/Components/Sound/StreamAudioDestination",rN);const sN=rN;function aN(t){JE.call(this,t),this.addType(c.StreamAudioSource),this.addChildObjects("speed",new Ri.SFFloat(1))}aN.prototype=Object.assign(Object.create(JE.prototype),{constructor:aN,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new Y([new B(c.inputOutput,"metadata",new Ri.SFNode),new B(c.inputOutput,"description",new Ri.SFString),new B(c.inputOutput,"enabled",new Ri.SFBool(!0)),new B(c.inputOutput,"gain",new Ri.SFFloat(1)),new B(c.inputOutput,"streamIdentifier",new Ri.MFString),new B(c.inputOutput,"startTime",new Ri.SFTime),new B(c.inputOutput,"resumeTime",new Ri.SFTime),new B(c.inputOutput,"pauseTime",new Ri.SFTime),new B(c.inputOutput,"stopTime",new Ri.SFTime),new B(c.outputOnly,"isPaused",new Ri.SFBool),new B(c.outputOnly,"isActive",new Ri.SFBool),new B(c.outputOnly,"elapsedTime",new Ri.SFTime)]),getTypeName:function(){return"StreamAudioSource"},getComponentName:function(){return"Sound"},getContainerField:function(){return"children"}});const uN=aN;n.set("x_ite/Components/Sound/StreamAudioSource",uN);const cN=uN;function lN(t){GE.call(this,t),this.addType(c.WaveShaper)}lN.prototype=Object.assign(Object.create(GE.prototype),{constructor:lN,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new Y([new B(c.inputOutput,"metadata",new Ri.SFNode),new B(c.inputOutput,"description",new Ri.SFString),new B(c.inputOutput,"enabled",new Ri.SFBool(!0)),new B(c.inputOutput,"gain",new Ri.SFFloat(1)),new B(c.inputOutput,"curve",new Ri.MFFloat),new B(c.inputOutput,"oversample",new Ri.SFString("none")),new B(c.inputOutput,"tailTime",new Ri.SFTime),new B(c.outputOnly,"channelCount",new Ri.SFInt32),new B(c.inputOutput,"channelCountMode",new Ri.SFString("max")),new B(c.inputOutput,"channelInterpretation",new Ri.SFString("speakers")),new B(c.inputOutput,"startTime",new Ri.SFTime),new B(c.inputOutput,"resumeTime",new Ri.SFTime),new B(c.inputOutput,"pauseTime",new Ri.SFTime),new B(c.inputOutput,"stopTime",new Ri.SFTime),new B(c.outputOnly,"isPaused",new Ri.SFBool),new B(c.outputOnly,"isActive",new Ri.SFBool),new B(c.outputOnly,"elapsedTime",new Ri.SFTime),new B(c.inputOutput,"children",new Ri.MFNode)]),getTypeName:function(){return"WaveShaper"},getComponentName:function(){return"Sound"},getContainerField:function(){return"children"}});const hN=lN;n.set("x_ite/Components/Sound/WaveShaper",hN);const dN={Analyser:YE,AudioClip:tO,AudioDestination:cO,BiquadFilter:dO,BufferAudioSource:gO,ChannelMerger:SO,ChannelSelector:vO,ChannelSplitter:OO,Convolver:IO,Delay:VO,DynamicsCompressor:AO,Gain:XO,ListenerPointSource:zO,MicrophoneSource:HO,OscillatorSource:WO,PeriodicWave:ZO,Sound:tN,SpatialSound:iN,StreamAudioDestination:sN,StreamAudioSource:cN,WaveShaper:hN},pN={X3DSoundChannelNode:xO,X3DSoundDestinationNode:sO,X3DSoundNode:iO,X3DSoundProcessingNode:GE,X3DSoundSourceNode:JE};for(const t in dN)Qo.addType(t,dN[t]);for(const t in pN)Qo.addAbstractType(t,pN[t]);const fN=void 0;n.set("x_ite/Components/Sound",fN);var gN=i(603),mN=i(86);function _N(t){cu.call(this,t),JE.call(this,t),kr.call(this,t),this.addType(c.MovieTexture),this.canvas=gN("<canvas></canvas>"),this.video=gN("<video></video>"),this.urlStack=new Ri.MFString}_N.prototype=Object.assign(Object.create(cu.prototype),JE.prototype,kr.prototype,{constructor:_N,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new Y([new B(c.inputOutput,"metadata",new Ri.SFNode),new B(c.inputOutput,"description",new Ri.SFString),new B(c.inputOutput,"enabled",new Ri.SFBool(!0)),new B(c.inputOutput,"load",new Ri.SFBool(!0)),new B(c.inputOutput,"url",new Ri.MFString),new B(c.inputOutput,"autoRefresh",new Ri.SFTime),new B(c.inputOutput,"autoRefreshTimeLimit",new Ri.SFTime(3600)),new B(c.inputOutput,"gain",new Ri.SFFloat(1)),new B(c.inputOutput,"speed",new Ri.SFFloat(1)),new B(c.inputOutput,"pitch",new Ri.SFFloat(1)),new B(c.inputOutput,"loop",new Ri.SFBool),new B(c.inputOutput,"startTime",new Ri.SFTime),new B(c.inputOutput,"resumeTime",new Ri.SFTime),new B(c.inputOutput,"pauseTime",new Ri.SFTime),new B(c.inputOutput,"stopTime",new Ri.SFTime),new B(c.outputOnly,"isPaused",new Ri.SFBool),new B(c.outputOnly,"isActive",new Ri.SFBool),new B(c.outputOnly,"elapsedTime",new Ri.SFTime),new B(c.outputOnly,"duration_changed",new Ri.SFTime(-1)),new B(c.initializeOnly,"repeatS",new Ri.SFBool(!0)),new B(c.initializeOnly,"repeatT",new Ri.SFBool(!0)),new B(c.initializeOnly,"textureProperties",new Ri.SFNode)]),getTypeName:function(){return"MovieTexture"},getComponentName:function(){return"Texturing"},getContainerField:function(){return"texture"},initialize:function(){cu.prototype.initialize.call(this),JE.prototype.initialize.call(this),kr.prototype.initialize.call(this),this.video.on("abort error",this.setError.bind(this)),this.video.on("suspend stalled",this.setTimeout.bind(this)),this.video[0].crossOrigin="Anonymous",this.video[0].preload="auto",this.video[0].muted=!0,this.requestImmediateLoad()},getElement:function(){return this.video[0]},set_live__:function(){JE.prototype.set_live__.call(this),kr.prototype.set_live__.call(this)},unLoadNow:function(){this.clearTexture()},loadNow:function(){delete this.gif,this.setMedia(null),this.urlStack.setValue(this._url),this.video.on("canplaythrough",this.setVideo.bind(this)),this.loadNext()},loadNext:function(){if(0===this.urlStack.length)return this.video.off("canplaythrough"),this._duration_changed=-1,this.clearTexture(),void this.setLoadState(c.FAILED_STATE);if(this.URL=new URL(this.urlStack.shift(),this.getExecutionContext().getWorldURL()),"data:"!==this.URL.protocol&&(this.getBrowser().getBrowserOptions().getCache()&&this.getCache()||this.URL.searchParams.set("_",Date.now())),this.URL.pathname.endsWith(".gif")){const t=gN("<div></div>"),e=gN("<img></img>").attr("rel:animated_src",this.URL).appendTo(t),n=new mN({gif:e[0]});n.load(this.setGif.bind(this,n))}else this.video.attr("src",this.URL.href),this.video.get(0).load()},setTimeout:function(t){setTimeout(function(){this.checkLoadState()===c.IN_PROGRESS_STATE&&this.setError(t)}.bind(this),3e3)},setError:function(t){"data:"!==this.URL.protocol&&console.warn("Error loading movie:",decodeURI(this.URL.href),t?t.type:void 0),this.loadNext()},setVideo:function(){try{this.video.unbind("canplaythrough");const t=this.video[0],e=t.videoWidth,n=t.videoHeight,i=this.canvas[0],o=i.getContext("2d",{willReadFrequently:!0});if(!gt.isPowerOfTwo(e)||!gt.isPowerOfTwo(n))throw new Error("The movie texture is a non power-of-two texture.");i.width=e,i.height=n,o.drawImage(t,0,0);const r=o.getImageData(0,0,e,n).data;this.setMedia(this.video[0]),this.setTexture(e,n,!1,new Uint8Array(r.buffer),!0),this.setLoadState(c.COMPLETE_STATE)}catch(t){console.log(t.message),this.setError()}},setGif:function(t){try{this.gif=t,t.pause(),t.move_to(0),Object.defineProperty(t,"currentTime",{get:function(){return this.duration*this.get_current_frame()/(this.get_length()-1)},set:function(t){return this.move_to(Math.floor(t/this.duration*(this.get_length()-1)))}}),Object.defineProperty(t,"duration",{get:function(){return this.get_duration_ms()/1e3}});const e=t.play;t.play=function(){return e.call(t),Promise.resolve()},this.setMedia(t),this.setTexture(t.get_canvas().width,t.get_canvas().height,!1,t.get_canvas(),!0),this.setLoadState(c.COMPLETE_STATE)}catch(t){console.log(t.message),this.setError()}},set_time:function(){JE.prototype.set_time.call(this),this.checkLoadState()===c.COMPLETE_STATE&&(this.gif?this.updateTexture(this.gif.get_canvas(),!0):this.updateTexture(this.video[0],!0))},traverse:cu.prototype.traverse,dispose:function(){kr.prototype.dispose.call(this),JE.prototype.dispose.call(this),cu.prototype.dispose.call(this)}});const xN=_N;n.set("x_ite/Components/Texturing/MovieTexture",xN);const yN=xN;function wN(t){tu.call(this,t),this.addType(c.MultiTexture),this.addChildObjects("loadState",new Ri.SFInt32(c.NOT_STARTED_STATE)),this.color=new Float32Array(4),this.modes=[],this.alphaModes=[],this.sources=[],this.functions=[],this.textureNodes=[]}wN.prototype=Object.assign(Object.create(tu.prototype),{constructor:wN,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new Y([new B(c.inputOutput,"metadata",new Ri.SFNode),new B(c.inputOutput,"description",new Ri.SFString),new B(c.inputOutput,"color",new Ri.SFColor(1,1,1)),new B(c.inputOutput,"alpha",new Ri.SFFloat(1)),new B(c.inputOutput,"mode",new Ri.MFString),new B(c.inputOutput,"source",new Ri.MFString),new B(c.inputOutput,"function",new Ri.MFString),new B(c.inputOutput,"texture",new Ri.MFNode)]),getTypeName:function(){return"MultiTexture"},getComponentName:function(){return"Texturing"},getContainerField:function(){return"texture"},initialize:function(){tu.prototype.initialize.call(this),this._color.addInterest("set_color__",this),this._alpha.addInterest("set_alpha__",this),this._mode.addInterest("set_mode__",this),this._source.addInterest("set_source__",this),this._function.addInterest("set_function__",this),this._texture.addInterest("set_texture__",this),this.set_color__(),this.set_alpha__(),this.set_mode__(),this.set_source__(),this.set_function__(),this.set_texture__(),this._loadState=c.COMPLETE_STATE},getCount:function(){return Math.min(this.getBrowser().getMaxTextures(),this.textureNodes.length)},getMode:function(t){return t<this.modes.length?this.modes[t]:L_.MODULATE},getAlphaMode:function(t){return t<this.alphaModes.length?this.alphaModes[t]:L_.MODULATE},getSource:function(t){return t<this.sources.length?this.sources[t]:U_.DEFAULT},getFunction:function(t){return t<this.functions.length?this.functions[t]:j_.DEFAULT},set_color__:function(){this.color[0]=this._color.r,this.color[1]=this._color.g,this.color[2]=this._color.b},set_alpha__:function(){this.color[3]=this._alpha},set_mode__:function(){const t=new Map([["REPLACE",L_.REPLACE],["MODULATE",L_.MODULATE],["MODULATE2X",L_.MODULATE2X],["MODULATE4X",L_.MODULATE4X],["ADD",L_.ADD],["ADDSIGNED",L_.ADDSIGNED],["ADDSIGNED2X",L_.ADDSIGNED2X],["ADDSMOOTH",L_.ADDSMOOTH],["SUBTRACT",L_.SUBTRACT],["BLENDDIFFUSEALPHA",L_.BLENDDIFFUSEALPHA],["BLENDTEXTUREALPHA",L_.BLENDTEXTUREALPHA],["BLENDFACTORALPHA",L_.BLENDFACTORALPHA],["BLENDCURRENTALPHA",L_.BLENDCURRENTALPHA],["MODULATEALPHA_ADDCOLOR",L_.MODULATEALPHA_ADDCOLOR],["MODULATEINVALPHA_ADDCOLOR",L_.MODULATEINVALPHA_ADDCOLOR],["MODULATEINVCOLOR_ADDALPHA",L_.MODULATEINVCOLOR_ADDALPHA],["DOTPRODUCT3",L_.DOTPRODUCT3],["SELECTARG1",L_.SELECTARG1],["SELECTARG2",L_.SELECTARG2],["OFF",L_.OFF]]);return function(){this.modes.length=0,this.alphaModes.length=0;for(const e of this._mode){const n=e.split(",");for(let t=0,e=n.length;t<e;++t)n[t]=n[t].trim();0===n.length&&n.push("MODULATE"),n.length<2&&n.push(n[0]);const i=t.get(n[0]);void 0!==i?this.modes.push(i):this.modes.push(L_.MODULATE);const o=t.get(n[1]);void 0!==o?this.alphaModes.push(o):this.alphaModes.push(L_.MODULATE)}}}(),set_source__:function(){const t=new Map([["DIFFUSE",U_.DIFFUSE],["SPECULAR",U_.SPECULAR],["FACTOR",U_.FACTOR]]);return function(){this.sources.length=0;for(const e of this._source){const n=t.get(e);void 0!==n?this.sources.push(n):this.sources.push(U_.DEFAULT)}}}(),set_function__:function(){const t=new Map([["COMPLEMENT",j_.COMPLEMENT],["ALPHAREPLICATE",j_.ALPHAREPLICATE]]);return function(){this.functions.length=0;for(const e of this._function){const n=t.get(e);void 0!==n?this.functions.push(n):this.functions.push(j_.DEFAULT)}}}(),set_texture__:function(){this.textureNodes.length=0;for(const t of this._texture){const e=nu(c.X3DSingleTextureNode,t);e&&this.textureNodes.push(e)}},updateTextureBits:function(t){const e=this.getBrowser().getMaxTextures(),n=this.textureNodes,i=Math.min(e,n.length);for(let e=0;e<i;++e)n[e].updateTextureBits(t,e);t.set(2*e,1)},getShaderOptions:function(t){const e=this.textureNodes,n=Math.min(this.getBrowser().getMaxTextures(),e.length);for(let i=0;i<n;++i)e[i].getShaderOptions(t,i)},traverse:function(t,e){for(const n of this.textureNodes)n.traverse(t,e)},setShaderUniforms:function(t,e,n){const i=this.textureNodes,o=Math.min(this.getBrowser().getMaxTextures(),i.length);t.uniform4fv(e.x3d_MultiTextureColor,this.color);for(let r=0;r<o;++r)i[r].setShaderUniforms(t,e,n,e.x3d_Texture[r]),t.uniform1i(e.x3d_MultiTextureMode[r],this.getMode(r)),t.uniform1i(e.x3d_MultiTextureAlphaMode[r],this.getAlphaMode(r)),t.uniform1i(e.x3d_MultiTextureSource[r],this.getSource(r)),t.uniform1i(e.x3d_MultiTextureFunction[r],this.getFunction(r))}});const SN=wN;n.set("x_ite/Components/Texturing/MultiTexture",SN);const TN=SN;function bN(t){jh.call(this,t),this.addType(c.MultiTextureCoordinate),this.textureCoordinateNodes=[]}bN.prototype=Object.assign(Object.create(jh.prototype),{constructor:bN,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new Y([new B(c.inputOutput,"metadata",new Ri.SFNode),new B(c.inputOutput,"texCoord",new Ri.MFNode)]),getTypeName:function(){return"MultiTextureCoordinate"},getComponentName:function(){return"Texturing"},getContainerField:function(){return"texCoord"},initialize:function(){jh.prototype.initialize.call(this),this._texCoord.addInterest("set_texCoord__",this),this.set_texCoord__()},set_texCoord__:function(){const t=this.textureCoordinateNodes;for(const e of t)e.removeInterest("addNodeEvent",this);t.length=0;for(const e of this._texCoord){const n=nu(c.X3DSingleTextureCoordinateNode,e);n&&t.push(n)}for(const e of t)e.addInterest("addNodeEvent",this)},getCount:function(){return Math.min(this.getBrowser().getMaxTextures(),this.textureCoordinateNodes.length)},isEmpty:function(){return!0},getSize:function(){return 0},get1Point:function(t,e){for(const n of this.textureCoordinateNodes)return n.get1Point(t,e);return e.set(0,0,0,1)},init:function(t){for(const e of this.textureCoordinateNodes)e.init(t)},addTexCoord:function(t,e){const n=this.textureCoordinateNodes;for(let i=0,o=n.length;i<o;++i)n[i].addTexCoordToChannel(t,e[i])},addTexCoordToChannel:function(t,e){},getTexCoord:function(t){for(const e of this.textureCoordinateNodes)return e.getTexCoord(t);return t},getTextureCoordinateMapping:function(t){const e=this.textureCoordinateNodes,n=Math.min(this.getBrowser().getMaxTextures(),e.length);for(let i=0;i<n;++i)e[i].getTextureCoordinateMapping(t,i)},setShaderUniforms:function(t,e){const n=this.textureCoordinateNodes,i=Math.min(e.x3d_MaxTextures,n.length);for(let o=0;o<i;++o)n[o].setShaderUniformsToChannel(t,e,o);if(i){const o=n.at(-1);for(let n=i,r=e.x3d_MaxTextures;n<r;++n)o.setShaderUniformsToChannel(t,e,n)}else for(let n=i,o=e.x3d_MaxTextures;n<o;++n)t.uniform1i(e.x3d_TextureCoordinateGeneratorMode[n],0)}});const vN=bN;n.set("x_ite/Components/Texturing/MultiTextureCoordinate",vN);const CN=vN;function EN(t){kx.call(this,t),this.addType(c.MultiTextureTransform),this.textureTransformNodes=[]}EN.prototype=Object.assign(Object.create(kx.prototype),{constructor:EN,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new Y([new B(c.inputOutput,"metadata",new Ri.SFNode),new B(c.inputOutput,"textureTransform",new Ri.MFNode)]),getTypeName:function(){return"MultiTextureTransform"},getComponentName:function(){return"Texturing"},getContainerField:function(){return"textureTransform"},initialize:function(){kx.prototype.initialize.call(this),this._textureTransform.addInterest("set_textureTransform__",this),this.set_textureTransform__()},set_textureTransform__:function(){const t=this.textureTransformNodes;t.length=0;for(const e of this._textureTransform){const n=nu(c.X3DSingleTextureTransformNode,e);n&&t.push(n)}},getCount:function(){return Math.min(this.getBrowser().getMaxTextures(),this.textureTransformNodes.length)},getTextureTransformMapping:function(t){const e=this.textureTransformNodes,n=Math.min(this.getBrowser().getMaxTextures(),e.length);for(let i=0;i<n;++i)e[i].getTextureTransformMapping(t,i)},setShaderUniforms:function(){const t=new Float32Array(hn.Identity);return function(e,n){const i=this.textureTransformNodes,o=Math.min(n.x3d_MaxTextures,i.length);for(let t=0;t<o;++t)i[t].setShaderUniformsToChannel(e,n,t);if(o){const t=i.at(-1);for(let i=o,r=n.x3d_MaxTextures;i<r;++i)t.setShaderUniformsToChannel(e,n,i)}else for(let i=o,r=n.x3d_MaxTextures;i<r;++i)e.uniformMatrix4fv(n.x3d_TextureMatrix[i],!1,t)}}()});const ON=EN;n.set("x_ite/Components/Texturing/MultiTextureTransform",ON);const NN=ON;var FN=i(603);function IN(t){cu.call(this,t),this.addType(c.PixelTexture),this.addChildObjects("loadState",new Ri.SFInt32(c.NOT_STARTED_STATE))}IN.prototype=Object.assign(Object.create(cu.prototype),{constructor:IN,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new Y([new B(c.inputOutput,"metadata",new Ri.SFNode),new B(c.inputOutput,"description",new Ri.SFString),new B(c.inputOutput,"image",new Ri.SFImage(0,0,0,new Ri.MFInt32)),new B(c.initializeOnly,"repeatS",new Ri.SFBool(!0)),new B(c.initializeOnly,"repeatT",new Ri.SFBool(!0)),new B(c.initializeOnly,"textureProperties",new Ri.SFNode)]),getTypeName:function(){return"PixelTexture"},getComponentName:function(){return"Texturing"},getContainerField:function(){return"texture"},initialize:function(){cu.prototype.initialize.call(this),this._image.addInterest("set_image__",this),this.canvas1=FN("<canvas></canvas>"),this.canvas2=FN("<canvas></canvas>"),this.set_image__()},checkLoadState:function(){return this._loadState.getValue()},convert:function(t,e,n,i){switch(e){case 1:for(let e=0,o=0;e<i;++e,o+=4){const i=n[e];t[o]=t[o+1]=t[o+2]=255&i,t[o+3]=255}break;case 2:for(let e=0,o=0;e<i;++e,o+=4){const i=n[e];t[o]=t[o+1]=t[o+2]=i>>>8&255,t[o+3]=255&i}break;case 3:for(let e=0,o=0;e<i;++e,o+=4){const i=n[e];t[o]=i>>>16&255,t[o+1]=i>>>8&255,t[o+2]=255&i,t[o+3]=255}break;case 4:for(let e=0,o=0;e<i;++e,o+=4){const i=n[e];t[o]=i>>>24,t[o+1]=i>>>16&255,t[o+2]=i>>>8&255,t[o+3]=255&i}}},resize:function(t,e,n,i,o){const r=new Uint8Array(i*o*4),s=i/e,a=o/n;for(let n=0;n<o;++n){const o=Math.floor(n/a)*e,u=n*i;for(let e=0;e<i;++e){const n=4*(o+Math.floor(e/s)),i=4*(u+e);r[i]=t[n],r[i+1]=t[n+1],r[i+2]=t[n+2],r[i+3]=t[n+3]}}return r},set_image__:function(){const t=this.getBrowser().getContext(),e=this._image.comp,n=this._image.array,i=!(e%2);let o=this._image.width,r=this._image.height,s=null;if(o>0&&r>0&&e>0&&e<5){if(t.getVersion()>=2||gt.isPowerOfTwo(o)&&gt.isPowerOfTwo(r))s=new Uint8Array(o*r*4),this.convert(s,e,n.getValue(),n.length);else if(Math.max(o,r)<this.getBrowser().getMinTextureSize()&&!this._textureProperties.getValue()){s=new Uint8Array(o*r*4),this.convert(s,e,n.getValue(),n.length);const t=o,i=r;o=8*gt.nextPowerOfTwo(t),r=8*gt.nextPowerOfTwo(i),s=this.resize(s,t,i,o,r)}else{const t=this.canvas1[0],i=this.canvas2[0],a=t.getContext("2d",{willReadFrequently:!0}),u=i.getContext("2d",{willReadFrequently:!0}),c=a.createImageData(o,r);t.width=o,t.height=r,this.convert(c.data,e,n,n.length),a.putImageData(c,0,0),o=gt.nextPowerOfTwo(o),r=gt.nextPowerOfTwo(r),i.width=o,i.height=r,u.clearRect(0,0,o,r),u.drawImage(t,0,0,t.width,t.height,0,0,o,r),s=u.getImageData(0,0,o,r).data}this.setTexture(o,r,i,new Uint8Array(s.buffer),!1),this._loadState=c.COMPLETE_STATE}else this.clearTexture(),this._loadState=c.FAILED_STATE}});const MN=IN;n.set("x_ite/Components/Texturing/PixelTexture",MN);const DN=MN;function VN(t){qh.call(this,t),this.addType(c.TextureCoordinateGenerator),this.mode=q_.SPHERE,this.parameter=new Float32Array(6)}VN.prototype=Object.assign(Object.create(qh.prototype),{constructor:VN,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new Y([new B(c.inputOutput,"metadata",new Ri.SFNode),new B(c.inputOutput,"mapping",new Ri.SFString),new B(c.inputOutput,"mode",new Ri.SFString("SPHERE")),new B(c.inputOutput,"parameter",new Ri.MFFloat)]),getTypeName:function(){return"TextureCoordinateGenerator"},getComponentName:function(){return"Texturing"},getContainerField:function(){return"texCoord"},initialize:function(){qh.prototype.initialize.call(this),this._mode.addInterest("set_mode__",this),this._parameter.addInterest("set_parameter__",this),this.set_mode__(),this.set_parameter__()},set_mode__:function(){const t=new Map([["SPHERE",q_.SPHERE],["CAMERASPACENORMAL",q_.CAMERASPACENORMAL],["CAMERASPACEPOSITION",q_.CAMERASPACEPOSITION],["CAMERASPACEREFLECTIONVECTOR",q_.CAMERASPACEREFLECTIONVECTOR],["SPHERE-LOCAL",q_.SPHERE_LOCAL],["COORD",q_.COORD],["COORD-EYE",q_.COORD_EYE],["NOISE",q_.NOISE],["NOISE-EYE",q_.NOISE_EYE],["SPHERE-REFLECT",q_.SPHERE_REFLECT],["SPHERE-REFLECT-LOCAL",q_.SPHERE_REFLECT_LOCAL]]);return function(){this.mode=t.get(this._mode.getValue()),void 0===this.mode&&(this.mode=q_.SPHERE)}}(),set_parameter__:function(){const t=Math.min(this.parameter.length,this._parameter.length);for(let e=0;e<t;++e)this.parameter[e]=this._parameter[e];this.parameter.fill(0,t)},get1Point:function(t,e){return e},addTexCoordToChannel:function(t,e){e.push(0,0,0,1)},getTexCoord:function(t){return t},setShaderUniformsToChannel:function(t,e,n=0){t.uniform1i(e.x3d_TextureCoordinateGeneratorMode[n],this.mode),t.uniform1fv(e.x3d_TextureCoordinateGeneratorParameter[n],this.parameter)}});const RN=VN;n.set("x_ite/Components/Texturing/TextureCoordinateGenerator",RN);const PN={ImageTexture:pu,MovieTexture:yN,MultiTexture:TN,MultiTextureCoordinate:CN,MultiTextureTransform:NN,PixelTexture:DN,TextureCoordinate:Kh,TextureCoordinateGenerator:RN,TextureProperties:Sh,TextureTransform:Yx},AN={X3DSingleTextureCoordinateNode:qh,X3DSingleTextureNode:ru,X3DSingleTextureTransformNode:Gx,X3DTexture2DNode:cu,X3DTextureCoordinateNode:jh,X3DTextureNode:tu,X3DTextureTransformNode:kx};for(const t in PN)Qo.addType(t,PN[t]);for(const t in AN)Qo.addAbstractType(t,AN[t]);const LN=void 0;n.set("x_ite/Components/Texturing",LN);const BN={TimeSensor:Nu},XN={X3DTimeDependentNode:Cu};for(const t in BN)Qo.addType(t,BN[t]);for(const t in XN)Qo.addAbstractType(t,XN[t]);const UN=void 0;n.set("x_ite/Components/Time",UN);const kN=class{static addComponent({name:t,types:e,abstractTypes:n,browserContext:i}){if(e)for(const[t,n]of Object.entries(e))Qo.addType(t,n);if(n)for(const[t,e]of Object.entries(n))Qo.addAbstractType(t,e);i&&Hy.addBrowserContext(i)}};n.set("x_ite/Components",kN);var zN=i(603);const jN=class{constructor(t){this.browser=t,this.rootElement=void 0,this.canvasObserver=new MutationObserver((()=>this.processCanvasMutation(t))),this.canvasObserver.observe(t.getElement()[0],{childList:!0}),this.processCanvasMutation(t)}processCanvasMutation(t){this.processRootElement(t,t.getElement().children("X3D").get(-1))}async processRootElement(t,e){try{if(e===this.rootElement)return;if(this.rootElement=e,e){t.setBrowserLoading(!0),t.addLoadingObject(this);const n=t.createScene();this.parser=new us(n),this.parser.setInput(e),await new Promise(this.parser.parseIntoScene.bind(this.parser)),t.replaceWorld(n),this.observer=new MutationObserver((t=>{for(const e of t)this.processMutation(e)})),this.observer.observe(e,{attributes:!0,childList:!0,characterData:!1,subtree:!0,attributeOldValue:!0}),this.processInlineElements(e),this.addEventDispatchersAll(e),t.removeLoadingObject(this)}else t.replaceWorld(null)}catch(t){console.error("Error importing document:",t)}}processMutation(t){switch(t.type){case"attributes":this.processAttribute(t,t.target);break;case"childList":for(const e of t.addedNodes)this.processAddedNode(e);for(const e of t.removedNodes)this.processRemovedNode(e)}}processAttribute(t,e){const n=this.parser;if(zN.data(e,"node")){const i=t.attributeName,o=e.attributes.getNamedItem(i);n.nodeAttribute(o,zN.data(e,"node"))}else{const t=e.parentNode,i=zN.data(t,"node");n.pushExecutionContext(i.getExecutionContext()),n.pushParent(i),n.childElement(e),n.popParent(),n.popExecutionContext()}}processAddedNode(t){if(t.nodeType!==Node.ELEMENT_NODE)return;if("X3D"===t.nodeName)return;if(zN.data(t,"node"))return;const e=t.parentNode,n=this.parser;if(e.nodeName.match(/^(?:Scene|SCENE)$/)){const i=zN.data(e,"node");n.pushExecutionContext(i),n.childElement(t),n.popExecutionContext()}else if(zN.data(e,"node")){const i=zN.data(e,"node"),o=i.getExecutionContext();n.pushExecutionContext(o),n.pushParent(i),n.childElement(t),n.popParent(),n.popExecutionContext()}else{const e=this.browser.currentScene;n.pushExecutionContext(e),n.childElement(t),n.popExecutionContext()}this.processInlineElements(t),this.addEventDispatchers(t),this.addEventDispatchersAll(t)}processRemovedNode(t){const e=zN.data(t,"node");e&&(e.dispose(),zN.data(t,"node",null))}processInlineElements(t){t.nodeName.match(/^(?:Inline|INLINE)$/)&&this.processInlineElement(t);for(const e of t.querySelectorAll("Inline"))this.processInlineElement(e)}processInlineElement(t){const e=zN.data(t,"node");e&&(e._loadState.addInterest("appendInlineChildElement",this,t),this.appendInlineChildElement(t))}appendInlineChildElement(t){const e=zN.data(t,"node");switch(e.checkLoadState()){case c.NOT_STARTED_STATE:case c.FAILED_STATE:for(;t.firstChild;)t.removeChild(t.lastChild);break;case c.COMPLETE_STATE:{for(;t.firstChild;)t.removeChild(t.lastChild);const n=zN.data(e.getInternalScene(),"X3D");n&&t.appendChild(n),this.processInlineElements(n),this.addEventDispatchersAll(n);break}}switch(e.checkLoadState()){case c.COMPLETE_STATE:{const n=new CustomEvent("load",{detail:{node:mn.get(e)}});t.dispatchEvent(n);break}case c.FAILED_STATE:{const n=new CustomEvent("error",{detail:{node:mn.get(e)}});t.dispatchEvent(n);break}}}addEventDispatchersAll(t){const e=t.querySelectorAll("*");for(const t of e)this.addEventDispatchers(t)}addEventDispatchers(t){if("ROUTE"===t.nodeName)return;const e=zN.data(t,"node");if(e)for(const n of e.getFields())this.bindFieldCallback(n,t)}bindFieldCallback(t,e){t.isOutput()&&(t.addInterest("fieldCallback",this,e),this.trace&&t.addInterest("fieldTraceCallback",this,e))}fieldCallback(t,e){const n=zN.data(t,"node");if(!n)return;const i=new CustomEvent(e.getName(),{detail:{node:mn.get(n),value:e.valueOf()}});t.dispatchEvent(i)}fieldTraceCallback(t,e){const n=Date.now(),i=r.getBrowser().getCurrentTime(),o=n-1e3*i,r=zN.data(t,"node");console.log("%f: at %f dt of %s ms %s '%s' %s: %s",n,i,o.toFixed(3),r.getTypeName(),r.getName(),e.getName(),e.valueOf())}};n.set("x_ite/Browser/DOMIntegration",jN);const GN=jN;const HN=function(){const t=this.getElement();"X3DCANVAS"===t.prop("nodeName").toUpperCase()&&(t.attr("src")?this.attributeChangedCallback("src",void 0,t.attr("src")):t.attr("url")&&this.attributeChangedCallback("url",void 0,t.attr("url")),t.attr("tabindex",t.attr("tabindex")||0))};n.set("x_ite/Browser/Legacy",HN);const qN=HN;function YN(t,e,n,i){this.name=t,this.title=e,this.providerUrl=n,this.components=i}YN.prototype=Object.assign(Object.create(S.prototype),{constructor:YN,getTypeName:function(){return"ProfileInfo"},toVRMLStream:function(t){t.string+="PROFILE",t.string+=t.Space(),t.string+=this.name},toXMLStream:function(t){t.string+=this.name},toJSONStream:function(t){t.string+=this.name}});for(const t of Reflect.ownKeys(YN.prototype))Object.defineProperty(YN.prototype,t,{enumerable:!1});const WN=YN;n.set("x_ite/Configuration/ProfileInfo",WN);const KN=WN;function JN(t){return G.call(this,t)}JN.prototype=Object.assign(Object.create(G.prototype),{constructor:JN,getTypeName:function(){return"ProfileInfoArray"},addProfile:function(t){this.add(t.name,new KN(t.name,t.title,t.providerUrl,new ll(t.components)))}});for(const t of Reflect.ownKeys(JN.prototype))Object.defineProperty(JN.prototype,t,{enumerable:!1});const ZN=JN;n.set("x_ite/Configuration/ProfileInfoArray",ZN);const QN=ZN,$N=new ll([]);$N.addComponent({title:"Annotation",name:"Annotation",level:2,external:!0}),$N.addComponent({title:"CAD geometry",name:"CADGeometry",level:2,external:!0}),$N.addComponent({title:"Core",name:"Core",level:2}),$N.addComponent({title:"Cube map environmental texturing",name:"CubeMapTexturing",level:3,external:!0}),$N.addComponent({title:"Distributed interactive simulation",name:"DIS",level:2,external:!0}),$N.addComponent({title:"Environmental effects",name:"EnvironmentalEffects",level:4}),$N.addComponent({title:"Environmental sensor",name:"EnvironmentalSensor",level:3}),$N.addComponent({title:"Event utilities",name:"EventUtilities",level:1,external:!0}),$N.addComponent({title:"Followers",name:"Followers",level:1}),$N.addComponent({title:"Geometry2D",name:"Geometry2D",level:2,external:!0}),$N.addComponent({title:"Geometry3D",name:"Geometry3D",level:4}),$N.addComponent({title:"Geospatial",name:"Geospatial",level:2,external:!0}),$N.addComponent({title:"Grouping",name:"Grouping",level:3}),$N.addComponent({title:"Humanoid animation (HAnim)",name:"HAnim",level:3,external:!0}),$N.addAlias("H-Anim","HAnim"),$N.addComponent({title:"Interpolation",name:"Interpolation",level:5}),$N.addComponent({title:"Key device sensor",name:"KeyDeviceSensor",level:2,external:!0}),$N.addComponent({title:"Layering",name:"Layering",level:1}),$N.addComponent({title:"Layout",name:"Layout",level:2,external:!0,dependencies:["Text"]}),$N.addComponent({title:"Lighting",name:"Lighting",level:3}),$N.addComponent({title:"Navigation",name:"Navigation",level:3}),$N.addComponent({title:"Networking",name:"Networking",level:4}),$N.addComponent({title:"NURBS",name:"NURBS",level:4,external:!0}),$N.addComponent({title:"Particle systems",name:"ParticleSystems",level:3,external:!0}),$N.addComponent({title:"Picking",name:"Picking",level:3,external:!0,dependencies:["RigidBodyPhysics"]}),$N.addComponent({title:"Pointing device sensor",name:"PointingDeviceSensor",level:1}),$N.addComponent({title:"Programmable shaders",name:"Shaders",level:1}),$N.addComponent({title:"Texture Projector",name:"TextureProjector",level:2,external:!0}),$N.addAlias("ProjectiveTextureMapping","TextureProjector"),$N.addComponent({title:"Rendering",name:"Rendering",level:5}),$N.addComponent({title:"Rigid body physics",name:"RigidBodyPhysics",level:2,external:!0}),$N.addComponent({title:"Scripting",name:"Scripting",level:1,external:!0}),$N.addComponent({title:"Shape",name:"Shape",level:4}),$N.addComponent({title:"Sound",name:"Sound",level:3}),$N.addComponent({title:"Text",name:"Text",level:1,external:!0}),$N.addComponent({title:"Texturing",name:"Texturing",level:4}),$N.addComponent({title:"Texturing3D",name:"Texturing3D",level:2,external:!0}),$N.addComponent({title:"Time",name:"Time",level:2}),$N.addComponent({title:"Volume rendering",name:"VolumeRendering",level:4,external:!0,dependencies:["CADGeometry","Texturing3D"]}),$N.addComponent({title:"X_ITE",name:"X_ITE",level:1,external:!0});const tF=$N;n.set("x_ite/Configuration/SupportedComponents",tF);const eF=tF,nF=new QN;nF.addProfile({title:"Computer-Aided Design (CAD) interchange",name:"CADInterchange",providerUrl:il.getProviderUrl(),components:[eF.get("CADGeometry"),eF.get("Core"),eF.get("Grouping"),eF.get("Lighting"),eF.get("Navigation"),eF.get("Networking"),eF.get("Rendering"),eF.get("Shaders"),eF.get("Shape"),eF.get("Texturing")]}),nF.addProfile({title:"Core",name:"Core",providerUrl:il.getProviderUrl(),components:[eF.get("Core")]}),nF.addProfile({title:"Full",name:"Full",providerUrl:il.getProviderUrl(),components:[eF.get("CADGeometry"),eF.get("Core"),eF.get("CubeMapTexturing"),eF.get("DIS"),eF.get("EnvironmentalEffects"),eF.get("EnvironmentalSensor"),eF.get("EventUtilities"),eF.get("Followers"),eF.get("Geometry2D"),eF.get("Geometry3D"),eF.get("Geospatial"),eF.get("Grouping"),eF.get("HAnim"),eF.get("Interpolation"),eF.get("KeyDeviceSensor"),eF.get("Layering"),eF.get("Layout"),eF.get("Lighting"),eF.get("Navigation"),eF.get("Networking"),eF.get("NURBS"),eF.get("ParticleSystems"),eF.get("Picking"),eF.get("PointingDeviceSensor"),eF.get("TextureProjector"),eF.get("Rendering"),eF.get("RigidBodyPhysics"),eF.get("Scripting"),eF.get("Shaders"),eF.get("Shape"),eF.get("Sound"),eF.get("Text"),eF.get("Texturing"),eF.get("Texturing3D"),eF.get("Time"),eF.get("VolumeRendering")]}),nF.addProfile({title:"Immersive",name:"Immersive",providerUrl:il.getProviderUrl(),components:[eF.get("Core"),eF.get("EnvironmentalEffects"),eF.get("EnvironmentalSensor"),eF.get("EventUtilities"),eF.get("Geometry2D"),eF.get("Geometry3D"),eF.get("Grouping"),eF.get("Interpolation"),eF.get("KeyDeviceSensor"),eF.get("Lighting"),eF.get("Navigation"),eF.get("Networking"),eF.get("PointingDeviceSensor"),eF.get("Rendering"),eF.get("Scripting"),eF.get("Shape"),eF.get("Sound"),eF.get("Text"),eF.get("Texturing"),eF.get("Time")]}),nF.addProfile({title:"Interactive",name:"Interactive",providerUrl:il.getProviderUrl(),components:[eF.get("Core"),eF.get("EnvironmentalEffects"),eF.get("EnvironmentalSensor"),eF.get("EventUtilities"),eF.get("Geometry3D"),eF.get("Grouping"),eF.get("Interpolation"),eF.get("KeyDeviceSensor"),eF.get("Lighting"),eF.get("Navigation"),eF.get("Networking"),eF.get("PointingDeviceSensor"),eF.get("Rendering"),eF.get("Shape"),eF.get("Texturing"),eF.get("Time")]}),nF.addProfile({title:"Interchange",name:"Interchange",providerUrl:il.getProviderUrl(),components:[eF.get("Core"),eF.get("EnvironmentalEffects"),eF.get("Geometry3D"),eF.get("Grouping"),eF.get("Interpolation"),eF.get("Lighting"),eF.get("Navigation"),eF.get("Networking"),eF.get("Rendering"),eF.get("Shape"),eF.get("Texturing"),eF.get("Time")]}),nF.addProfile({title:"Medical interchange",name:"MedicalInterchange",providerUrl:il.getProviderUrl(),components:[eF.get("Core"),eF.get("EnvironmentalEffects"),eF.get("EventUtilities"),eF.get("Geometry2D"),eF.get("Geometry3D"),eF.get("Grouping"),eF.get("Interpolation"),eF.get("Lighting"),eF.get("Navigation"),eF.get("Networking"),eF.get("Rendering"),eF.get("Shape"),eF.get("Text"),eF.get("Texturing"),eF.get("Texturing3D"),eF.get("Time"),eF.get("VolumeRendering")]}),nF.addProfile({title:"MPEG-4 interactive",name:"MPEG-4",providerUrl:il.getProviderUrl(),components:[eF.get("Core"),eF.get("EnvironmentalEffects"),eF.get("EnvironmentalSensor"),eF.get("Geometry3D"),eF.get("Grouping"),eF.get("Interpolation"),eF.get("Lighting"),eF.get("Navigation"),eF.get("Networking"),eF.get("PointingDeviceSensor"),eF.get("Rendering"),eF.get("Shape"),eF.get("Texturing"),eF.get("Time")]});const iF=nF;n.set("x_ite/Configuration/SupportedProfiles",iF);const oF=iF;var rF=i(603);const sF=Symbol(),aF=Symbol(),uF=Symbol(),cF=Symbol();function lF(t){if((t=rF(t)).data("browser"))throw new Error("Couldn't create browser, element has already a browser.");t.data("browser",this),Hy.call(this,t),this[uF]=new Map,this[cF]=document.getElementsByClassName("x_ite-console"),this.setup()}lF.prototype=Object.assign(Object.create(Hy.prototype),{constructor:lF,getTypeName:function(){return"X3DBrowser"},getComponentName:function(){return"X_ITE"},getContainerField:function(){return"browser"},initialize:function(){Hy.prototype.initialize.call(this),this.replaceWorld(this.createScene()),this[sF]=new GN(this),qN.call(this),this.getInstanceId()>1||rF((()=>{this.print("Welcome to "+this.name+" X3D Browser v"+this.version+":\n   Current Graphics Renderer\n      Name: "+this.getVendor()+" "+this.getRenderer()+"\n      WebGL version: "+this.getWebGLVersion()+"\n      Shading language: "+this.getShadingLanguageVersion()+"\n   Rendering Properties\n      Antialiased: "+this.getAntialiased()+"\n      Depth size: "+this.getDepthSize()+" bits\n      Color depth: "+this.getColorDepth()+" bits\n      Max clip planes per shape: "+this.getMaxClipPlanes()+"\n      Max lights per shape: "+this.getMaxLights()+"\n      Max multi textures per shape: "+this.getMaxTextures()+"\n      Texture units: "+this.getMaxCombinedTextureUnits()+"\n      Max texture size: "+this.getMaxTextureSize()+" Ã "+this.getMaxTextureSize()+" pixels\n      Texture memory: "+this.getTextureMemory()+"\n      Max vertex uniform vectors: "+this.getMaxVertexUniformVectors()+"\n      Max fragment uniform vectors: "+this.getMaxFragmentUniformVectors()+"\n      Max vertex attribs: "+this.getMaxVertexAttribs()+"\n      Max varying vectors: "+this.getMaxVaryingVectors()+"\n")}))},getName:function(){return"X_ITE"},getVersion:function(){return eo},getDescription:function(){return this.getNotification()._string.getValue()},setDescription:function(t){this.getNotification()._string=t},getWorldURL:function(){return this.currentScene.worldURL},getProfile:function(t){t=String(t);const e=oF.get(t);if(e)return e;throw Error("Profile '"+t+"' is not supported.")},getSupportedProfiles:function(){return oF},getComponent:function(t,e){t=String(t),e=~~e;const n=eF.get(t);if(n)return new al({name:t,level:gt.clamp(e,1,n.level),title:n.title,providerUrl:n.providerUrl,external:rF.data(n,"external"),dependencies:rF.data(n,"dependencies")});throw Error("Component '"+t+"' at level '"+e+"' is not supported.")},getSupportedComponents:function(){return eF},loadComponents:function(){function t(e,n,o){return Promise.all(n.map((n=>async function(e,n,o){if(o.has(n))return;o.add(n);const r=e.getSupportedComponents().get(n);if(await t(e,rF.data(r,"dependencies"),o),!rF.data(r,"external"))return;el.NODE_ENV?i.g.require(i.g.require("url").fileURLToPath(r.providerUrl)):await import(r.providerUrl)}(e,n,o))))}return function(e){return e instanceof KN?this.loadComponents(e.components):e instanceof ll?this.loadComponents(e.map((({name:t})=>t))):e instanceof al?this.loadComponents([e.name]):t(this,[...e],new Set)}}(),getSupportedNode:function(t){return Qo.getType(String(t))},getSupportedNodes:function(){return Qo.getTypes()},createScene:function(t,e){const n=new kl(this);if(arguments.length){if(!(t instanceof KN))throw new Error("Couldn't create scene: profile must be of type ProfileInfo.");n.setProfile(t);for(let t=1,e=arguments.length;t<e;++t){const e=arguments[t];if(!(e instanceof al))throw new Error("Couldn't create scene: component must be of type ComponentInfo.");n.addComponent(e)}}return n.setup(),n},replaceWorld:function(t){if(this[aF]&&this[aF].abort(),this.initialized().getValue()&&(this.getExecutionContext().setLive(!1),this.shutdown().processInterests(),this.callBrowserCallbacks(c.SHUTDOWN_EVENT),this.callBrowserEventHandler("shutdown")),t instanceof Ri.MFNode){const e=t;t=this.createScene();for(const n of e)t.isLive().addInterest(n.getValue().getExecutionContext().isLive());t.setRootNodes(e)}t instanceof Al||(t=this.createScene()),t.getExecutionContext().isLive().removeInterest("setLive",t),t.setExecutionContext(t),this.setDescription(""),this.getBrowserOptions().configure(),this.setBrowserLoading(!0),this._loadCount.addInterest("checkLoadCount",this);for(const e of t.getLoadingObjects())this.addLoadingObject(e);this.setExecutionContext(t),this.getWorld().bindBindables(),t.setLive(this.isLive().getValue())},checkLoadCount:function(t){t.getValue()||(t.removeInterest("checkLoadCount",this),this.initialized().set(this.getCurrentTime()),this.initialized().processInterests(),this.callBrowserCallbacks(c.INITIALIZED_EVENT),this.callBrowserEventHandler("initialized load"),this.setBrowserLoading(!1))},createVrmlFromString:function(t){return this.createX3DFromString(t).rootNodes},createX3DFromString:function(t){t=String(t);const e=this.currentScene,n=this.isExternal(),i=new Oc(this.getWorld()).createX3DFromString(e.getWorldURL(),t);return n||(e.isLive().addInterest("setLive",i),i.setExecutionContext(e),i.setLive(e.getLive())),i},createVrmlFromURL:function(t,e,n){if(e=nu(c.X3DNode,e,!1),n=String(n),!(t instanceof Ri.MFString))throw new Error("Browser.createVrmlFromURL: url must be of type MFString.");if(!e)throw new Error("Browser.createVrmlFromURL: node must be of type X3DNode.");const i=e.getField(n);if(!i.isInput())throw new Error("Browser.createVrmlFromURL: event named '"+n+"' must be a input field.");if(i.getType()!==c.MFNode)throw new Error("Browser.createVrmlFromURL: event named '"+n+"' must be of type MFNode.");const o=this.currentScene,r=this.isExternal(),s=new Oc(this.getWorld());this.addLoadingObject(s),s.createX3DFromURL(t,null,(t=>{this.removeLoadingObject(s),t&&(r||(o.isLive().addInterest("setLive",t),t.setExecutionContext(o),t.setLive(o.getLive())),i.setValue(t.rootNodes))}))},createX3DFromURL:function(t,e,n){if(3===arguments.length)return this.createVrmlFromURL(t,e,n);if(!(t instanceof Ri.MFString))throw new Error("Browser.createX3DFromURL: url must be of type MFString.");const i=this.currentScene,o=this.isExternal(),r=new Oc(this.getWorld()),s=r.createX3DFromURL(t,null);return o||(i.isLive().addInterest("setLive",s),s.setExecutionContext(i),s.setLive(i.getLive())),s},loadURL:function(t,e=new Ri.MFString){return new Promise(((n,i)=>{if(!(t instanceof Ri.MFString))throw new Error("Browser.loadURL: url must be of type MFString.");if(!(e instanceof Ri.MFString))throw new Error("Browser.loadURL: parameter must be of type MFString.");this._loadCount.removeInterest("checkLoadCount",this),this.prepareEvents().removeInterest("updateInitialized",this),this[aF]&&this[aF].abort(),this.setBrowserLoading(!0),this.addLoadingObject(this);const o=this[aF]=new Oc(this.getWorld());o.createX3DFromURL(t,e,(t=>{o===this[aF]?(this.getBrowserOptions().getSplashScreen()||this.getCanvas().show(),t?(this.replaceWorld(t),this.removeLoadingObject(this),n()):(this.callBrowserCallbacks(c.CONNECTION_ERROR),this.callBrowserEventHandler("error"),setTimeout((()=>{this.getSplashScreen().find(".x_ite-private-spinner-text").text(fo("Failed loading world."))})),i("Couldn't load X3D file."))):i("Loading of X3D file aborted.")}),(t=>{o===this[aF]?(this.changeViewpoint(t),this.removeLoadingObject(this),this.setBrowserLoading(!1),n()):i("Change viewpoint aborted.")}),((t,e)=>{o===this[aF]?(e?window.open(t,e):location=t,this.removeLoadingObject(this),this.setBrowserLoading(!1),n()):i("Loading of file aborted.")}))}))},addBrowserListener:function(t,e){},removeBrowserListener:function(t){},addBrowserCallback:function(t,e){this[uF].set(t,e)},removeBrowserCallback:function(t){this[uF].delete(t)},getBrowserCallbacks:function(){return this[uF]},callBrowserCallbacks:function(){const t=[];return function(e){if(this[uF].size)for(const n of g.values(t,this[uF]))n(e)}}(),importDocument:function(t,e=!1){const n=this.currentScene,i=this.createScene();this.isExternal()||(n.isLive().addInterest("setLive",i),i.setExecutionContext(n),i.setLive(n.getLive()));const o=new us(i);return o.setInput(t),e?new Promise(o.parseIntoScene.bind(o)):(o.parseIntoScene(),i)},importJS:function(t,e=!1){const n=this.currentScene,i=this.createScene();this.isExternal()||(n.isLive().addInterest("setLive",i),i.setExecutionContext(n),i.setLive(n.getLive()));const o=new hs(i);return o.setInput(t),e?new Promise(o.parseIntoScene.bind(o)):(o.parseIntoScene(),i)},getBrowserProperty:function(t){return this.getBrowserProperties().getField(t).getValue()},setBrowserOption:function(t,e){this.getBrowserOptions().getField(t).setValue(e)},getBrowserOption:function(t){return this.getBrowserOptions().getField(t).getValue()},getRenderingProperty:function(t){return this.getRenderingProperties().getField(t).getValue()},firstViewpoint:function(t){(t=nu(c.X3DLayerNode,t,!1))||(t=this.getActiveLayer());const e=t.getUserViewpoints();e.length&&this.bindViewpoint(t,e[0])},previousViewpoint:function(t){(t=nu(c.X3DLayerNode,t,!1))||(t=this.getActiveLayer());const e=t.getUserViewpoints();if(0!==e.length){for(var n=0,i=e.length;n<i&&!e[n]._isBound.getValue();++n);n<e.length?0===n?this.bindViewpoint(t,e.at(-1)):this.bindViewpoint(t,e[n-1]):this.bindViewpoint(t,e.at(-1))}},nextViewpoint:function(t){(t=nu(c.X3DLayerNode,t,!1))||(t=this.getActiveLayer());const e=t.getUserViewpoints();if(0!==e.length){for(var n=0,i=e.length;n<i&&!e[n]._isBound.getValue();++n);n<e.length?n===e.length-1?this.bindViewpoint(t,e[0]):this.bindViewpoint(t,e[n+1]):this.bindViewpoint(t,e[0])}},lastViewpoint:function(t){(t=nu(c.X3DLayerNode,t,!1))||(t=this.getActiveLayer());const e=t.getUserViewpoints();e.length&&this.bindViewpoint(t,e.at(-1))},changeViewpoint:function(t,e){if(1===arguments.length&&(e=String(t),t=this.getActiveLayer()),(t=nu(c.X3DLayerNode,t,!1))||(t=this.getActiveLayer()),t instanceof yu)for(const n of t.getViewpoints().get())if(n.getName()===e){this.bindViewpoint(t,n);break}},bindViewpoint:function(t,e){if(t=nu(c.X3DLayerNode,t,!1),e=nu(c.X3DViewpointNode,e,!1),!t)throw new Error("Browser.bindViewpoint: layerNode must be of type X3DLayerNode.");if(!e)throw new Error("Browser.bindViewpoint: viewpointNode must be of type X3DViewpointNode.");e.setVRMLTransition(!0),e._set_bind=!0},addRoute:function(t,e,n,i){this.currentScene.addRoute(t,e,n,i)},deleteRoute:function(t,e,n,i){try{const o=this.currentScene.getRoute(t,e,n,i);o&&this.currentScene.deleteRoute(o)}catch(t){console.error(t)}},beginUpdate:function(){this.setLive(!0),this.getExecutionContext().setLive(!0),this.advanceTime(),this.addBrowserEvent()},endUpdate:function(){this.setLive(!1),this.getExecutionContext().setLive(!1)},print:function(){const t=Array.prototype.join.call(arguments,"");console.log(t);for(const e of this[cF])e.append(document.createTextNode(t))},println:function(){const t=Array.prototype.join.call(arguments,"");console.log(t);for(const e of this[cF])e.append(document.createTextNode(t+"\n"))},toVRMLStream:function(t){this.currentScene.toVRMLStream(t)},toXMLStream:function(t){this.currentScene.toXMLStream(t)},toJSONStream:function(t){this.currentScene.toJSONStream(t)}});for(const t of Reflect.ownKeys(lF.prototype))Object.defineProperty(lF.prototype,t,{enumerable:!1});Object.defineProperty(lF.prototype,"name",{get:function(){return this.getName()},enumerable:!0,configurable:!1}),Object.defineProperty(lF.prototype,"version",{get:function(){return this.getVersion()},enumerable:!0,configurable:!1}),Object.defineProperty(lF.prototype,"currentFrameRate",{get:function(){return this.getCurrentFrameRate()},enumerable:!0,configurable:!1}),Object.defineProperty(lF.prototype,"currentSpeed",{get:function(){return this.getCurrentSpeed()},enumerable:!0,configurable:!1}),Object.defineProperty(lF.prototype,"description",{get:function(){return this.getDescription()},set:function(t){this.setDescription(t)},enumerable:!0,configurable:!1}),Object.defineProperty(lF.prototype,"currentScene",{get:function(){return this.getScriptStack().at(-1).getExecutionContext()},enumerable:!0,configurable:!1}),Object.defineProperty(lF.prototype,"supportedProfiles",{get:function(){return oF},enumerable:!0,configurable:!1}),Object.defineProperty(lF.prototype,"supportedComponents",{get:function(){return eF},enumerable:!0,configurable:!1});const hF=lF;n.set("x_ite/Browser/X3DBrowser",hF);const dF=hF;var pF=i(603);const fF={error:function(t,e){pF(function(){const n=pF("x3d-canvas, X3DCanvas");this.show(n,t);for(const i of e)"function"==typeof i&&i(n,t)}.bind(this))},show:function(t,e){console.error(e),t.children(".x_ite-private-browser").hide(),t.children(":not(.x_ite-private-browser)").show(),t.each((function(t,e){e.shadowRoot&&e.shadowRoot.appendChild(document.createElement("slot"))}))}},gF=fF;n.set("x_ite/Fallback",gF);const mF=gF;function _F(t){let e=0,n=0;return function(){const i=t.call(this);return i>n?(e=0,n=i,i):n=i+ ++e/1e3}}for(const t of[performance,Date])Object.defineProperty(t,"now",{value:_F(t.now),configurable:!0,writable:!0});const xF=void 0;n.set("standard/Time/MicroTime",xF);const yF=i(603);n.set("lib/jquery",yF);var wF=i(603);const SF=wF.Deferred(),TF=wF.Deferred();let bF=!1;function vF(t,e){return new Promise((function(n,i){"function"==typeof t&&SF.done(t),"function"==typeof e&&TF.done(e),SF.done(n),TF.done(i),bF||(bF=!0,wF((function(){try{const t=wF("X3DCanvas");t.length&&(console.warn("Use of <X3DCanvas> element is depreciated, please use <x3d-canvas> element instead. See https://create3000.github.io/x_ite/#embedding-x_ite-within-a-web-page."),wF.map(t,(t=>new dF(t)))),SF.resolve()}catch(t){mF.show(wF("x3d-canvas, X3DCanvas"),t),TF.resolve(t)}})))}))}Object.assign(vF,{require:function(t){if(!n.has(t))throw new Error("Unknown module '"+t+"'.");return n.get(t)},noConflict:function(){const t=window.hasOwnProperty("X3D"),e=window.X3D;return function(){return window.X3D===vF&&(t?window.X3D=e:delete window.X3D),vF}}(),getBrowser:function(t){return wF(t||"x3d-canvas, X3DCanvas").data("browser")},createBrowser:function(t,e){const n=document.createElement("x3d-canvas");return arguments.length&&n.browser.loadURL(t,e),n}}),Object.assign(vF,{X3DConstants:c,X3DBrowser:dF,X3DExecutionContext:$c,X3DScene:Al,ComponentInfo:al,ComponentInfoArray:ll,ProfileInfo:KN,ProfileInfoArray:QN,UnitInfo:pl,UnitInfoArray:ml,ExternProtoDeclarationArray:_r,ProtoDeclarationArray:wr,X3DExternProtoDeclaration:Dc,X3DProtoDeclaration:Rr,RouteArray:Pc,X3DRoute:jc,X3DBaseNode:$i,X3DExportedNode:Sl,X3DImportedNode:hr,X3DProtoDeclarationNode:Ir,X3DFieldDefinition:B,FieldDefinitionArray:Y,X3DField:lt,X3DArrayField:qn,SFColor:Ri.SFColor,SFColorRGBA:Ri.SFColorRGBA,SFImage:Ri.SFImage,SFMatrix3d:Ri.SFMatrix3d,SFMatrix3f:Ri.SFMatrix3f,SFMatrix4d:Ri.SFMatrix4d,SFMatrix4f:Ri.SFMatrix4f,SFNode:Ri.SFNode,SFRotation:Ri.SFRotation,SFVec2d:Ri.SFVec2d,SFVec2f:Ri.SFVec2f,SFVec3d:Ri.SFVec3d,SFVec3f:Ri.SFVec3f,SFVec4d:Ri.SFVec4d,SFVec4f:Ri.SFVec4f,VrmlMatrix:Ri.VrmlMatrix,MFBool:Ri.MFBool,MFColor:Ri.MFColor,MFColorRGBA:Ri.MFColorRGBA,MFDouble:Ri.MFDouble,MFFloat:Ri.MFFloat,MFImage:Ri.MFImage,MFInt32:Ri.MFInt32,MFMatrix3d:Ri.MFMatrix3d,MFMatrix3f:Ri.MFMatrix3f,MFMatrix4d:Ri.MFMatrix4d,MFMatrix4f:Ri.MFMatrix4f,MFNode:Ri.MFNode,MFRotation:Ri.MFRotation,MFString:Ri.MFString,MFTime:Ri.MFTime,MFVec2d:Ri.MFVec2d,MFVec2f:Ri.MFVec2f,MFVec3d:Ri.MFVec3d,MFVec3f:Ri.MFVec3f,MFVec4d:Ri.MFVec4d,MFVec4f:Ri.MFVec4f});const CF=vF;n.set("x_ite/X3D",CF);const EF=CF;var OF=i(603);class NF extends HTMLElement{static define(){customElements.define("x3d-canvas",NF)}constructor(){super();const t=this.attachShadow({mode:"open",delegatesFocus:!0}),e=document.createElement("link");OF(this).data("shadow",OF(t)),OF(this).data("loaded",new Promise((function(t,n){e.onload=t,e.onerror=n}))),e.setAttribute("rel","stylesheet"),e.setAttribute("type","text/css"),e.setAttribute("href",new URL("x_ite.css",il.getScriptUrl()).href),t.appendChild(e),this.browser=new dF(this)}connectedCallback(){this.browser.connectedCallback()}static get observedAttributes(){return["splashscreen","src","url"]}attributeChangedCallback(t,e,n){this.browser.attributeChangedCallback(t,e,n)}}document.createElement("X3DCanvas");const FF=NF;n.set("x_ite/X3DCanvas",FF);const IF=FF;!function(){function t(t){if((t=Math.trunc(t)||0)<0&&(t+=this.length),!(t<0||t>=this.length))return this[t]}const e=Reflect.getPrototypeOf(Int8Array);for(const n of[Array,String,e])void 0===n.prototype.at&&Object.defineProperty(n.prototype,"at",{value:t,writable:!0,enumerable:!1,configurable:!0})}();const MF=void 0;n.set("shim",MF);window[Symbol.for("X_ITE.X3D-8.4.4a")]=EF,IF.define(),EF();const DF=EF;n.set("x_ite",DF);const VF=DF})(),o=o.default})()));