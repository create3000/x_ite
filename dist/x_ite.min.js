/* X_ITE v8.0.0a */!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.X3D=t():e.X3D=t()}(self,(()=>(()=>{var t={87:function(e,t,n){"use strict";var i,o,r=n(755);"undefined"!=typeof window&&window,void 0===(o="function"==typeof(i=function(){if("undefined"==typeof window)return null;var e="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")(),t=e.requestAnimationFrame||e.mozRequestAnimationFrame||e.webkitRequestAnimationFrame||function(t){return e.setTimeout(t,20)},n=e.cancelAnimationFrame||e.mozCancelAnimationFrame||e.webkitCancelAnimationFrame||function(t){e.clearTimeout(t)};function i(e,t){var n=Object.prototype.toString.call(e),i="[object Array]"===n||"[object NodeList]"===n||"[object HTMLCollection]"===n||"[object Object]"===n||void 0!==r&&e instanceof r||"undefined"!=typeof Elements&&e instanceof Elements,o=0,s=e.length;if(i)for(;o<s;o++)t(e[o]);else t(e)}function o(e){if(!e.getBoundingClientRect)return{width:e.offsetWidth,height:e.offsetHeight};var t=e.getBoundingClientRect();return{width:Math.round(t.width),height:Math.round(t.height)}}function s(e,t){Object.keys(t).forEach((function(n){e.style[n]=t[n]}))}var a=function(e,r){var u=0;function l(){var e,t,n=[];this.add=function(e){n.push(e)},this.call=function(i){for(e=0,t=n.length;e<t;e++)n[e].call(this,i)},this.remove=function(i){var o=[];for(e=0,t=n.length;e<t;e++)n[e]!==i&&o.push(n[e]);n=o},this.length=function(){return n.length}}function c(e,n){if(e)if(e.resizedAttached)e.resizedAttached.add(n);else{e.resizedAttached=new l,e.resizedAttached.add(n),e.resizeSensor=document.createElement("div"),e.resizeSensor.dir="ltr",e.resizeSensor.className="resize-sensor";var i={pointerEvents:"none",position:"absolute",left:"0px",top:"0px",right:"0px",bottom:"0px",overflow:"hidden",zIndex:"-1",visibility:"hidden",maxWidth:"100%"},r={position:"absolute",left:"0px",top:"0px",transition:"0s"};s(e.resizeSensor,i);var a=document.createElement("div");a.className="resize-sensor-expand",s(a,i);var c=document.createElement("div");s(c,r),a.appendChild(c);var h=document.createElement("div");h.className="resize-sensor-shrink",s(h,i);var d=document.createElement("div");s(d,r),s(d,{width:"200%",height:"200%"}),h.appendChild(d),e.resizeSensor.appendChild(a),e.resizeSensor.appendChild(h),e.appendChild(e.resizeSensor);var p=window.getComputedStyle(e),f=p?p.getPropertyValue("position"):null;"absolute"!==f&&"relative"!==f&&"fixed"!==f&&"sticky"!==f&&(e.style.position="relative");var g=!1,m=0,_=o(e),y=0,x=0,w=!0;u=0;var v=function(){var t=e.offsetWidth,n=e.offsetHeight;c.style.width=t+10+"px",c.style.height=n+10+"px",a.scrollLeft=t+10,a.scrollTop=n+10,h.scrollLeft=t+10,h.scrollTop=n+10},b=function(){if(w){if(0===e.offsetWidth&&0===e.offsetHeight)return void(u||(u=t((function(){u=0,b()}))));w=!1}v()};e.resizeSensor.resetSensor=b;var S=function(){m=0,g&&(y=_.width,x=_.height,e.resizedAttached&&e.resizedAttached.call(_))},T=function(){_=o(e),(g=_.width!==y||_.height!==x)&&!m&&(m=t(S)),b()},E=function(e,t,n){e.attachEvent?e.attachEvent("on"+t,n):e.addEventListener(t,n)};E(a,"scroll",T),E(h,"scroll",T),u=t((function(){u=0,b()}))}}i(e,(function(e){c(e,r)})),this.detach=function(t){u||(n(u),u=0),a.detach(e,t)},this.reset=function(){e.resizeSensor.resetSensor()}};if(a.reset=function(e){i(e,(function(e){e.resizeSensor.resetSensor()}))},a.detach=function(e,t){i(e,(function(e){e&&(e.resizedAttached&&"function"==typeof t&&(e.resizedAttached.remove(t),e.resizedAttached.length())||e.resizeSensor&&(e.contains(e.resizeSensor)&&e.removeChild(e.resizeSensor),delete e.resizeSensor,delete e.resizedAttached))}))},"undefined"!=typeof MutationObserver){var u=new MutationObserver((function(e){for(var t in e)if(e.hasOwnProperty(t))for(var n=e[t].addedNodes,i=0;i<n.length;i++)n[i].resizeSensor&&a.reset(n[i])}));document.addEventListener("DOMContentLoaded",(function(e){u.observe(document.body,{childList:!0,subtree:!0})}))}return a})?i.call(t,n,t,e):i)||(e.exports=o)},40:(e,t,n)=>{!function(e){function t(e){var t,i,o;return this.length?((t=this[0]).ownerDocument?o=t.ownerDocument:t=(o=t).documentElement,null==e?o.exitFullscreen||o.webkitExitFullscreen||o.webkitCancelFullScreen||o.msExitFullscreen||o.mozCancelFullScreen?(e=n(o))&&(o.fullscreenElement||o.webkitFullscreenElement||o.webkitCurrentFullScreenElement||o.msFullscreenElement||o.mozFullScreenElement)||e:null:e?((i=t.requestFullscreen||t.webkitRequestFullscreen||t.webkitRequestFullScreen||t.msRequestFullscreen||t.mozRequestFullScreen)&&i.call(t),this):((i=o.exitFullscreen||o.webkitExitFullscreen||o.webkitCancelFullScreen||o.msExitFullscreen||o.mozCancelFullScreen)&&n(o)&&i.call(o),this)):this}function n(e){return!!(e.fullscreenElement||e.msFullscreenElement||e.webkitIsFullScreen||e.mozFullScreen)}function i(t){e(document).trigger(new e.Event("fullscreenchange"))}function o(t){e(document).trigger(new e.Event("fullscreenerror"))}e.fn.fullScreen=t,e.fn.toggleFullScreen=function(){return t.call(this,!t.call(this))},function(){var t,n,r;(t=document).webkitCancelFullScreen?(n="webkitfullscreenchange",r="webkitfullscreenerror"):t.msExitFullscreen?(n="MSFullscreenChange",r="MSFullscreenError"):t.mozCancelFullScreen?(n="mozfullscreenchange",r="mozfullscreenerror"):(n="fullscreenchange",r="fullscreenerror"),e(document).bind(n,i),e(document).bind(r,o)}()}(n(755))},450:(e,t,n)=>{var i,o,r;o=[n(755)],i=function(e){var t,n,i=["wheel","mousewheel","DOMMouseScroll","MozMousePixelScroll"],o="onwheel"in document||document.documentMode>=9?["wheel"]:["mousewheel","DomMouseScroll","MozMousePixelScroll"],r=Array.prototype.slice;if(e.event.fixHooks)for(var s=i.length;s;)e.event.fixHooks[i[--s]]=e.event.mouseHooks;var a=e.event.special.mousewheel={version:"3.1.12",setup:function(){if(this.addEventListener)for(var t=o.length;t;)this.addEventListener(o[--t],u,!1);else this.onmousewheel=u;e.data(this,"mousewheel-line-height",a.getLineHeight(this)),e.data(this,"mousewheel-page-height",a.getPageHeight(this))},teardown:function(){if(this.removeEventListener)for(var t=o.length;t;)this.removeEventListener(o[--t],u,!1);else this.onmousewheel=null;e.removeData(this,"mousewheel-line-height"),e.removeData(this,"mousewheel-page-height")},getLineHeight:function(t){var n=e(t),i=n["offsetParent"in e.fn?"offsetParent":"parent"]();return i.length||(i=e("body")),parseInt(i.css("fontSize"),10)||parseInt(n.css("fontSize"),10)||16},getPageHeight:function(t){return e(t).height()},settings:{adjustOldDeltas:!0,normalizeOffset:!0}};function u(i){var o=i||window.event,s=r.call(arguments,1),u=0,h=0,d=0,p=0,f=0,g=0;if((i=e.event.fix(o)).type="mousewheel","detail"in o&&(d=-1*o.detail),"wheelDelta"in o&&(d=o.wheelDelta),"wheelDeltaY"in o&&(d=o.wheelDeltaY),"wheelDeltaX"in o&&(h=-1*o.wheelDeltaX),"axis"in o&&o.axis===o.HORIZONTAL_AXIS&&(h=-1*d,d=0),u=0===d?h:d,"deltaY"in o&&(u=d=-1*o.deltaY),"deltaX"in o&&(h=o.deltaX,0===d&&(u=-1*h)),0!==d||0!==h){if(1===o.deltaMode){var m=e.data(this,"mousewheel-line-height");u*=m,d*=m,h*=m}else if(2===o.deltaMode){var _=e.data(this,"mousewheel-page-height");u*=_,d*=_,h*=_}if(p=Math.max(Math.abs(d),Math.abs(h)),(!n||p<n)&&(n=p,c(o,p)&&(n/=40)),c(o,p)&&(u/=40,h/=40,d/=40),u=Math[u>=1?"floor":"ceil"](u/n),h=Math[h>=1?"floor":"ceil"](h/n),d=Math[d>=1?"floor":"ceil"](d/n),a.settings.normalizeOffset&&this.getBoundingClientRect){var y=this.getBoundingClientRect();f=i.clientX-y.left,g=i.clientY-y.top}return i.deltaX=h,i.deltaY=d,i.deltaFactor=n,i.offsetX=f,i.offsetY=g,i.deltaMode=0,s.unshift(i,u,h,d),t&&clearTimeout(t),t=setTimeout(l,200),(e.event.dispatch||e.event.handle).apply(this,s)}}function l(){n=null}function c(e,t){return a.settings.adjustOldDeltas&&"mousewheel"===e.type&&t%120==0}e.fn.extend({mousewheel:function(e){return e?this.bind("mousewheel",e):this.trigger("mousewheel")},unmousewheel:function(e){return this.unbind("mousewheel",e)}})},void 0===(r="function"==typeof i?i.apply(t,o):i)||(e.exports=r)},755:function(e,t){var n;!function(t,n){"use strict";"object"==typeof e.exports?e.exports=t.document?n(t,!0):function(e){if(!e.document)throw new Error("jQuery requires a window with a document");return n(e)}:n(t)}("undefined"!=typeof window?window:this,(function(i,o){"use strict";var r=[],s=Object.getPrototypeOf,a=r.slice,u=r.flat?function(e){return r.flat.call(e)}:function(e){return r.concat.apply([],e)},l=r.push,c=r.indexOf,h={},d=h.toString,p=h.hasOwnProperty,f=p.toString,g=f.call(Object),m={},_=function(e){return"function"==typeof e&&"number"!=typeof e.nodeType&&"function"!=typeof e.item},y=function(e){return null!=e&&e===e.window},x=i.document,w={type:!0,src:!0,nonce:!0,noModule:!0};function v(e,t,n){var i,o,r=(n=n||x).createElement("script");if(r.text=e,t)for(i in w)(o=t[i]||t.getAttribute&&t.getAttribute(i))&&r.setAttribute(i,o);n.head.appendChild(r).parentNode.removeChild(r)}function b(e){return null==e?e+"":"object"==typeof e||"function"==typeof e?h[d.call(e)]||"object":typeof e}var S="3.6.1",T=function(e,t){return new T.fn.init(e,t)};function E(e){var t=!!e&&"length"in e&&e.length,n=b(e);return!_(e)&&!y(e)&&("array"===n||0===t||"number"==typeof t&&t>0&&t-1 in e)}T.fn=T.prototype={jquery:S,constructor:T,length:0,toArray:function(){return a.call(this)},get:function(e){return null==e?a.call(this):e<0?this[e+this.length]:this[e]},pushStack:function(e){var t=T.merge(this.constructor(),e);return t.prevObject=this,t},each:function(e){return T.each(this,e)},map:function(e){return this.pushStack(T.map(this,(function(t,n){return e.call(t,n,t)})))},slice:function(){return this.pushStack(a.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},even:function(){return this.pushStack(T.grep(this,(function(e,t){return(t+1)%2})))},odd:function(){return this.pushStack(T.grep(this,(function(e,t){return t%2})))},eq:function(e){var t=this.length,n=+e+(e<0?t:0);return this.pushStack(n>=0&&n<t?[this[n]]:[])},end:function(){return this.prevObject||this.constructor()},push:l,sort:r.sort,splice:r.splice},T.extend=T.fn.extend=function(){var e,t,n,i,o,r,s=arguments[0]||{},a=1,u=arguments.length,l=!1;for("boolean"==typeof s&&(l=s,s=arguments[a]||{},a++),"object"==typeof s||_(s)||(s={}),a===u&&(s=this,a--);a<u;a++)if(null!=(e=arguments[a]))for(t in e)i=e[t],"__proto__"!==t&&s!==i&&(l&&i&&(T.isPlainObject(i)||(o=Array.isArray(i)))?(n=s[t],r=o&&!Array.isArray(n)?[]:o||T.isPlainObject(n)?n:{},o=!1,s[t]=T.extend(l,r,i)):void 0!==i&&(s[t]=i));return s},T.extend({expando:"jQuery"+(S+Math.random()).replace(/\D/g,""),isReady:!0,error:function(e){throw new Error(e)},noop:function(){},isPlainObject:function(e){var t,n;return!(!e||"[object Object]"!==d.call(e))&&(!(t=s(e))||"function"==typeof(n=p.call(t,"constructor")&&t.constructor)&&f.call(n)===g)},isEmptyObject:function(e){var t;for(t in e)return!1;return!0},globalEval:function(e,t,n){v(e,{nonce:t&&t.nonce},n)},each:function(e,t){var n,i=0;if(E(e))for(n=e.length;i<n&&!1!==t.call(e[i],i,e[i]);i++);else for(i in e)if(!1===t.call(e[i],i,e[i]))break;return e},makeArray:function(e,t){var n=t||[];return null!=e&&(E(Object(e))?T.merge(n,"string"==typeof e?[e]:e):l.call(n,e)),n},inArray:function(e,t,n){return null==t?-1:c.call(t,e,n)},merge:function(e,t){for(var n=+t.length,i=0,o=e.length;i<n;i++)e[o++]=t[i];return e.length=o,e},grep:function(e,t,n){for(var i=[],o=0,r=e.length,s=!n;o<r;o++)!t(e[o],o)!==s&&i.push(e[o]);return i},map:function(e,t,n){var i,o,r=0,s=[];if(E(e))for(i=e.length;r<i;r++)null!=(o=t(e[r],r,n))&&s.push(o);else for(r in e)null!=(o=t(e[r],r,n))&&s.push(o);return u(s)},guid:1,support:m}),"function"==typeof Symbol&&(T.fn[Symbol.iterator]=r[Symbol.iterator]),T.each("Boolean Number String Function Array Date RegExp Object Error Symbol".split(" "),(function(e,t){h["[object "+t+"]"]=t.toLowerCase()}));var C=function(e){var t,n,i,o,r,s,a,u,l,c,h,d,p,f,g,m,_,y,x,w="sizzle"+1*new Date,v=e.document,b=0,S=0,T=ue(),E=ue(),C=ue(),O=ue(),N=function(e,t){return e===t&&(h=!0),0},F={}.hasOwnProperty,M=[],D=M.pop,I=M.push,R=M.push,V=M.slice,P=function(e,t){for(var n=0,i=e.length;n<i;n++)if(e[n]===t)return n;return-1},A="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",L="[\\x20\\t\\r\\n\\f]",U="(?:\\\\[\\da-fA-F]{1,6}[\\x20\\t\\r\\n\\f]?|\\\\[^\\r\\n\\f]|[\\w-]|[^\0-\\x7f])+",B="\\[[\\x20\\t\\r\\n\\f]*("+U+")(?:"+L+"*([*^$|!~]?=)"+L+"*(?:'((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\"|("+U+"))|)"+L+"*\\]",X=":("+U+")(?:\\((('((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\")|((?:\\\\.|[^\\\\()[\\]]|"+B+")*)|.*)\\)|)",k=new RegExp(L+"+","g"),z=new RegExp("^[\\x20\\t\\r\\n\\f]+|((?:^|[^\\\\])(?:\\\\.)*)[\\x20\\t\\r\\n\\f]+$","g"),j=new RegExp("^[\\x20\\t\\r\\n\\f]*,[\\x20\\t\\r\\n\\f]*"),G=new RegExp("^[\\x20\\t\\r\\n\\f]*([>+~]|[\\x20\\t\\r\\n\\f])[\\x20\\t\\r\\n\\f]*"),H=new RegExp(L+"|>"),q=new RegExp(X),W=new RegExp("^"+U+"$"),Y={ID:new RegExp("^#("+U+")"),CLASS:new RegExp("^\\.("+U+")"),TAG:new RegExp("^("+U+"|[*])"),ATTR:new RegExp("^"+B),PSEUDO:new RegExp("^"+X),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\([\\x20\\t\\r\\n\\f]*(even|odd|(([+-]|)(\\d*)n|)[\\x20\\t\\r\\n\\f]*(?:([+-]|)[\\x20\\t\\r\\n\\f]*(\\d+)|))[\\x20\\t\\r\\n\\f]*\\)|)","i"),bool:new RegExp("^(?:"+A+")$","i"),needsContext:new RegExp("^[\\x20\\t\\r\\n\\f]*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\([\\x20\\t\\r\\n\\f]*((?:-\\d)?\\d*)[\\x20\\t\\r\\n\\f]*\\)|)(?=[^-]|$)","i")},K=/HTML$/i,Z=/^(?:input|select|textarea|button)$/i,Q=/^h\d$/i,$=/^[^{]+\{\s*\[native \w/,J=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,ee=/[+~]/,te=new RegExp("\\\\[\\da-fA-F]{1,6}[\\x20\\t\\r\\n\\f]?|\\\\([^\\r\\n\\f])","g"),ne=function(e,t){var n="0x"+e.slice(1)-65536;return t||(n<0?String.fromCharCode(n+65536):String.fromCharCode(n>>10|55296,1023&n|56320))},ie=/([\0-\x1f\x7f]|^-?\d)|^-$|[^\0-\x1f\x7f-\uFFFF\w-]/g,oe=function(e,t){return t?"\0"===e?"ï¿½":e.slice(0,-1)+"\\"+e.charCodeAt(e.length-1).toString(16)+" ":"\\"+e},re=function(){d()},se=we((function(e){return!0===e.disabled&&"fieldset"===e.nodeName.toLowerCase()}),{dir:"parentNode",next:"legend"});try{R.apply(M=V.call(v.childNodes),v.childNodes),M[v.childNodes.length].nodeType}catch(e){R={apply:M.length?function(e,t){I.apply(e,V.call(t))}:function(e,t){for(var n=e.length,i=0;e[n++]=t[i++];);e.length=n-1}}}function ae(e,t,i,o){var r,a,l,c,h,f,_,y=t&&t.ownerDocument,v=t?t.nodeType:9;if(i=i||[],"string"!=typeof e||!e||1!==v&&9!==v&&11!==v)return i;if(!o&&(d(t),t=t||p,g)){if(11!==v&&(h=J.exec(e)))if(r=h[1]){if(9===v){if(!(l=t.getElementById(r)))return i;if(l.id===r)return i.push(l),i}else if(y&&(l=y.getElementById(r))&&x(t,l)&&l.id===r)return i.push(l),i}else{if(h[2])return R.apply(i,t.getElementsByTagName(e)),i;if((r=h[3])&&n.getElementsByClassName&&t.getElementsByClassName)return R.apply(i,t.getElementsByClassName(r)),i}if(n.qsa&&!O[e+" "]&&(!m||!m.test(e))&&(1!==v||"object"!==t.nodeName.toLowerCase())){if(_=e,y=t,1===v&&(H.test(e)||G.test(e))){for((y=ee.test(e)&&_e(t.parentNode)||t)===t&&n.scope||((c=t.getAttribute("id"))?c=c.replace(ie,oe):t.setAttribute("id",c=w)),a=(f=s(e)).length;a--;)f[a]=(c?"#"+c:":scope")+" "+xe(f[a]);_=f.join(",")}try{return R.apply(i,y.querySelectorAll(_)),i}catch(t){O(e,!0)}finally{c===w&&t.removeAttribute("id")}}}return u(e.replace(z,"$1"),t,i,o)}function ue(){var e=[];return function t(n,o){return e.push(n+" ")>i.cacheLength&&delete t[e.shift()],t[n+" "]=o}}function le(e){return e[w]=!0,e}function ce(e){var t=p.createElement("fieldset");try{return!!e(t)}catch(e){return!1}finally{t.parentNode&&t.parentNode.removeChild(t),t=null}}function he(e,t){for(var n=e.split("|"),o=n.length;o--;)i.attrHandle[n[o]]=t}function de(e,t){var n=t&&e,i=n&&1===e.nodeType&&1===t.nodeType&&e.sourceIndex-t.sourceIndex;if(i)return i;if(n)for(;n=n.nextSibling;)if(n===t)return-1;return e?1:-1}function pe(e){return function(t){return"input"===t.nodeName.toLowerCase()&&t.type===e}}function fe(e){return function(t){var n=t.nodeName.toLowerCase();return("input"===n||"button"===n)&&t.type===e}}function ge(e){return function(t){return"form"in t?t.parentNode&&!1===t.disabled?"label"in t?"label"in t.parentNode?t.parentNode.disabled===e:t.disabled===e:t.isDisabled===e||t.isDisabled!==!e&&se(t)===e:t.disabled===e:"label"in t&&t.disabled===e}}function me(e){return le((function(t){return t=+t,le((function(n,i){for(var o,r=e([],n.length,t),s=r.length;s--;)n[o=r[s]]&&(n[o]=!(i[o]=n[o]))}))}))}function _e(e){return e&&void 0!==e.getElementsByTagName&&e}for(t in n=ae.support={},r=ae.isXML=function(e){var t=e&&e.namespaceURI,n=e&&(e.ownerDocument||e).documentElement;return!K.test(t||n&&n.nodeName||"HTML")},d=ae.setDocument=function(e){var t,o,s=e?e.ownerDocument||e:v;return s!=p&&9===s.nodeType&&s.documentElement?(f=(p=s).documentElement,g=!r(p),v!=p&&(o=p.defaultView)&&o.top!==o&&(o.addEventListener?o.addEventListener("unload",re,!1):o.attachEvent&&o.attachEvent("onunload",re)),n.scope=ce((function(e){return f.appendChild(e).appendChild(p.createElement("div")),void 0!==e.querySelectorAll&&!e.querySelectorAll(":scope fieldset div").length})),n.attributes=ce((function(e){return e.className="i",!e.getAttribute("className")})),n.getElementsByTagName=ce((function(e){return e.appendChild(p.createComment("")),!e.getElementsByTagName("*").length})),n.getElementsByClassName=$.test(p.getElementsByClassName),n.getById=ce((function(e){return f.appendChild(e).id=w,!p.getElementsByName||!p.getElementsByName(w).length})),n.getById?(i.filter.ID=function(e){var t=e.replace(te,ne);return function(e){return e.getAttribute("id")===t}},i.find.ID=function(e,t){if(void 0!==t.getElementById&&g){var n=t.getElementById(e);return n?[n]:[]}}):(i.filter.ID=function(e){var t=e.replace(te,ne);return function(e){var n=void 0!==e.getAttributeNode&&e.getAttributeNode("id");return n&&n.value===t}},i.find.ID=function(e,t){if(void 0!==t.getElementById&&g){var n,i,o,r=t.getElementById(e);if(r){if((n=r.getAttributeNode("id"))&&n.value===e)return[r];for(o=t.getElementsByName(e),i=0;r=o[i++];)if((n=r.getAttributeNode("id"))&&n.value===e)return[r]}return[]}}),i.find.TAG=n.getElementsByTagName?function(e,t){return void 0!==t.getElementsByTagName?t.getElementsByTagName(e):n.qsa?t.querySelectorAll(e):void 0}:function(e,t){var n,i=[],o=0,r=t.getElementsByTagName(e);if("*"===e){for(;n=r[o++];)1===n.nodeType&&i.push(n);return i}return r},i.find.CLASS=n.getElementsByClassName&&function(e,t){if(void 0!==t.getElementsByClassName&&g)return t.getElementsByClassName(e)},_=[],m=[],(n.qsa=$.test(p.querySelectorAll))&&(ce((function(e){var t;f.appendChild(e).innerHTML="<a id='"+w+"'></a><select id='"+w+"-\r\\' msallowcapture=''><option selected=''></option></select>",e.querySelectorAll("[msallowcapture^='']").length&&m.push("[*^$]=[\\x20\\t\\r\\n\\f]*(?:''|\"\")"),e.querySelectorAll("[selected]").length||m.push("\\[[\\x20\\t\\r\\n\\f]*(?:value|"+A+")"),e.querySelectorAll("[id~="+w+"-]").length||m.push("~="),(t=p.createElement("input")).setAttribute("name",""),e.appendChild(t),e.querySelectorAll("[name='']").length||m.push("\\[[\\x20\\t\\r\\n\\f]*name[\\x20\\t\\r\\n\\f]*=[\\x20\\t\\r\\n\\f]*(?:''|\"\")"),e.querySelectorAll(":checked").length||m.push(":checked"),e.querySelectorAll("a#"+w+"+*").length||m.push(".#.+[+~]"),e.querySelectorAll("\\\f"),m.push("[\\r\\n\\f]")})),ce((function(e){e.innerHTML="<a href='' disabled='disabled'></a><select disabled='disabled'><option/></select>";var t=p.createElement("input");t.setAttribute("type","hidden"),e.appendChild(t).setAttribute("name","D"),e.querySelectorAll("[name=d]").length&&m.push("name[\\x20\\t\\r\\n\\f]*[*^$|!~]?="),2!==e.querySelectorAll(":enabled").length&&m.push(":enabled",":disabled"),f.appendChild(e).disabled=!0,2!==e.querySelectorAll(":disabled").length&&m.push(":enabled",":disabled"),e.querySelectorAll("*,:x"),m.push(",.*:")}))),(n.matchesSelector=$.test(y=f.matches||f.webkitMatchesSelector||f.mozMatchesSelector||f.oMatchesSelector||f.msMatchesSelector))&&ce((function(e){n.disconnectedMatch=y.call(e,"*"),y.call(e,"[s!='']:x"),_.push("!=",X)})),m=m.length&&new RegExp(m.join("|")),_=_.length&&new RegExp(_.join("|")),t=$.test(f.compareDocumentPosition),x=t||$.test(f.contains)?function(e,t){var n=9===e.nodeType?e.documentElement:e,i=t&&t.parentNode;return e===i||!(!i||1!==i.nodeType||!(n.contains?n.contains(i):e.compareDocumentPosition&&16&e.compareDocumentPosition(i)))}:function(e,t){if(t)for(;t=t.parentNode;)if(t===e)return!0;return!1},N=t?function(e,t){if(e===t)return h=!0,0;var i=!e.compareDocumentPosition-!t.compareDocumentPosition;return i||(1&(i=(e.ownerDocument||e)==(t.ownerDocument||t)?e.compareDocumentPosition(t):1)||!n.sortDetached&&t.compareDocumentPosition(e)===i?e==p||e.ownerDocument==v&&x(v,e)?-1:t==p||t.ownerDocument==v&&x(v,t)?1:c?P(c,e)-P(c,t):0:4&i?-1:1)}:function(e,t){if(e===t)return h=!0,0;var n,i=0,o=e.parentNode,r=t.parentNode,s=[e],a=[t];if(!o||!r)return e==p?-1:t==p?1:o?-1:r?1:c?P(c,e)-P(c,t):0;if(o===r)return de(e,t);for(n=e;n=n.parentNode;)s.unshift(n);for(n=t;n=n.parentNode;)a.unshift(n);for(;s[i]===a[i];)i++;return i?de(s[i],a[i]):s[i]==v?-1:a[i]==v?1:0},p):p},ae.matches=function(e,t){return ae(e,null,null,t)},ae.matchesSelector=function(e,t){if(d(e),n.matchesSelector&&g&&!O[t+" "]&&(!_||!_.test(t))&&(!m||!m.test(t)))try{var i=y.call(e,t);if(i||n.disconnectedMatch||e.document&&11!==e.document.nodeType)return i}catch(e){O(t,!0)}return ae(t,p,null,[e]).length>0},ae.contains=function(e,t){return(e.ownerDocument||e)!=p&&d(e),x(e,t)},ae.attr=function(e,t){(e.ownerDocument||e)!=p&&d(e);var o=i.attrHandle[t.toLowerCase()],r=o&&F.call(i.attrHandle,t.toLowerCase())?o(e,t,!g):void 0;return void 0!==r?r:n.attributes||!g?e.getAttribute(t):(r=e.getAttributeNode(t))&&r.specified?r.value:null},ae.escape=function(e){return(e+"").replace(ie,oe)},ae.error=function(e){throw new Error("Syntax error, unrecognized expression: "+e)},ae.uniqueSort=function(e){var t,i=[],o=0,r=0;if(h=!n.detectDuplicates,c=!n.sortStable&&e.slice(0),e.sort(N),h){for(;t=e[r++];)t===e[r]&&(o=i.push(r));for(;o--;)e.splice(i[o],1)}return c=null,e},o=ae.getText=function(e){var t,n="",i=0,r=e.nodeType;if(r){if(1===r||9===r||11===r){if("string"==typeof e.textContent)return e.textContent;for(e=e.firstChild;e;e=e.nextSibling)n+=o(e)}else if(3===r||4===r)return e.nodeValue}else for(;t=e[i++];)n+=o(t);return n},i=ae.selectors={cacheLength:50,createPseudo:le,match:Y,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(e){return e[1]=e[1].replace(te,ne),e[3]=(e[3]||e[4]||e[5]||"").replace(te,ne),"~="===e[2]&&(e[3]=" "+e[3]+" "),e.slice(0,4)},CHILD:function(e){return e[1]=e[1].toLowerCase(),"nth"===e[1].slice(0,3)?(e[3]||ae.error(e[0]),e[4]=+(e[4]?e[5]+(e[6]||1):2*("even"===e[3]||"odd"===e[3])),e[5]=+(e[7]+e[8]||"odd"===e[3])):e[3]&&ae.error(e[0]),e},PSEUDO:function(e){var t,n=!e[6]&&e[2];return Y.CHILD.test(e[0])?null:(e[3]?e[2]=e[4]||e[5]||"":n&&q.test(n)&&(t=s(n,!0))&&(t=n.indexOf(")",n.length-t)-n.length)&&(e[0]=e[0].slice(0,t),e[2]=n.slice(0,t)),e.slice(0,3))}},filter:{TAG:function(e){var t=e.replace(te,ne).toLowerCase();return"*"===e?function(){return!0}:function(e){return e.nodeName&&e.nodeName.toLowerCase()===t}},CLASS:function(e){var t=T[e+" "];return t||(t=new RegExp("(^|[\\x20\\t\\r\\n\\f])"+e+"("+L+"|$)"))&&T(e,(function(e){return t.test("string"==typeof e.className&&e.className||void 0!==e.getAttribute&&e.getAttribute("class")||"")}))},ATTR:function(e,t,n){return function(i){var o=ae.attr(i,e);return null==o?"!="===t:!t||(o+="","="===t?o===n:"!="===t?o!==n:"^="===t?n&&0===o.indexOf(n):"*="===t?n&&o.indexOf(n)>-1:"$="===t?n&&o.slice(-n.length)===n:"~="===t?(" "+o.replace(k," ")+" ").indexOf(n)>-1:"|="===t&&(o===n||o.slice(0,n.length+1)===n+"-"))}},CHILD:function(e,t,n,i,o){var r="nth"!==e.slice(0,3),s="last"!==e.slice(-4),a="of-type"===t;return 1===i&&0===o?function(e){return!!e.parentNode}:function(t,n,u){var l,c,h,d,p,f,g=r!==s?"nextSibling":"previousSibling",m=t.parentNode,_=a&&t.nodeName.toLowerCase(),y=!u&&!a,x=!1;if(m){if(r){for(;g;){for(d=t;d=d[g];)if(a?d.nodeName.toLowerCase()===_:1===d.nodeType)return!1;f=g="only"===e&&!f&&"nextSibling"}return!0}if(f=[s?m.firstChild:m.lastChild],s&&y){for(x=(p=(l=(c=(h=(d=m)[w]||(d[w]={}))[d.uniqueID]||(h[d.uniqueID]={}))[e]||[])[0]===b&&l[1])&&l[2],d=p&&m.childNodes[p];d=++p&&d&&d[g]||(x=p=0)||f.pop();)if(1===d.nodeType&&++x&&d===t){c[e]=[b,p,x];break}}else if(y&&(x=p=(l=(c=(h=(d=t)[w]||(d[w]={}))[d.uniqueID]||(h[d.uniqueID]={}))[e]||[])[0]===b&&l[1]),!1===x)for(;(d=++p&&d&&d[g]||(x=p=0)||f.pop())&&((a?d.nodeName.toLowerCase()!==_:1!==d.nodeType)||!++x||(y&&((c=(h=d[w]||(d[w]={}))[d.uniqueID]||(h[d.uniqueID]={}))[e]=[b,x]),d!==t)););return(x-=o)===i||x%i==0&&x/i>=0}}},PSEUDO:function(e,t){var n,o=i.pseudos[e]||i.setFilters[e.toLowerCase()]||ae.error("unsupported pseudo: "+e);return o[w]?o(t):o.length>1?(n=[e,e,"",t],i.setFilters.hasOwnProperty(e.toLowerCase())?le((function(e,n){for(var i,r=o(e,t),s=r.length;s--;)e[i=P(e,r[s])]=!(n[i]=r[s])})):function(e){return o(e,0,n)}):o}},pseudos:{not:le((function(e){var t=[],n=[],i=a(e.replace(z,"$1"));return i[w]?le((function(e,t,n,o){for(var r,s=i(e,null,o,[]),a=e.length;a--;)(r=s[a])&&(e[a]=!(t[a]=r))})):function(e,o,r){return t[0]=e,i(t,null,r,n),t[0]=null,!n.pop()}})),has:le((function(e){return function(t){return ae(e,t).length>0}})),contains:le((function(e){return e=e.replace(te,ne),function(t){return(t.textContent||o(t)).indexOf(e)>-1}})),lang:le((function(e){return W.test(e||"")||ae.error("unsupported lang: "+e),e=e.replace(te,ne).toLowerCase(),function(t){var n;do{if(n=g?t.lang:t.getAttribute("xml:lang")||t.getAttribute("lang"))return(n=n.toLowerCase())===e||0===n.indexOf(e+"-")}while((t=t.parentNode)&&1===t.nodeType);return!1}})),target:function(t){var n=e.location&&e.location.hash;return n&&n.slice(1)===t.id},root:function(e){return e===f},focus:function(e){return e===p.activeElement&&(!p.hasFocus||p.hasFocus())&&!!(e.type||e.href||~e.tabIndex)},enabled:ge(!1),disabled:ge(!0),checked:function(e){var t=e.nodeName.toLowerCase();return"input"===t&&!!e.checked||"option"===t&&!!e.selected},selected:function(e){return e.parentNode&&e.parentNode.selectedIndex,!0===e.selected},empty:function(e){for(e=e.firstChild;e;e=e.nextSibling)if(e.nodeType<6)return!1;return!0},parent:function(e){return!i.pseudos.empty(e)},header:function(e){return Q.test(e.nodeName)},input:function(e){return Z.test(e.nodeName)},button:function(e){var t=e.nodeName.toLowerCase();return"input"===t&&"button"===e.type||"button"===t},text:function(e){var t;return"input"===e.nodeName.toLowerCase()&&"text"===e.type&&(null==(t=e.getAttribute("type"))||"text"===t.toLowerCase())},first:me((function(){return[0]})),last:me((function(e,t){return[t-1]})),eq:me((function(e,t,n){return[n<0?n+t:n]})),even:me((function(e,t){for(var n=0;n<t;n+=2)e.push(n);return e})),odd:me((function(e,t){for(var n=1;n<t;n+=2)e.push(n);return e})),lt:me((function(e,t,n){for(var i=n<0?n+t:n>t?t:n;--i>=0;)e.push(i);return e})),gt:me((function(e,t,n){for(var i=n<0?n+t:n;++i<t;)e.push(i);return e}))}},i.pseudos.nth=i.pseudos.eq,{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})i.pseudos[t]=pe(t);for(t in{submit:!0,reset:!0})i.pseudos[t]=fe(t);function ye(){}function xe(e){for(var t=0,n=e.length,i="";t<n;t++)i+=e[t].value;return i}function we(e,t,n){var i=t.dir,o=t.next,r=o||i,s=n&&"parentNode"===r,a=S++;return t.first?function(t,n,o){for(;t=t[i];)if(1===t.nodeType||s)return e(t,n,o);return!1}:function(t,n,u){var l,c,h,d=[b,a];if(u){for(;t=t[i];)if((1===t.nodeType||s)&&e(t,n,u))return!0}else for(;t=t[i];)if(1===t.nodeType||s)if(c=(h=t[w]||(t[w]={}))[t.uniqueID]||(h[t.uniqueID]={}),o&&o===t.nodeName.toLowerCase())t=t[i]||t;else{if((l=c[r])&&l[0]===b&&l[1]===a)return d[2]=l[2];if(c[r]=d,d[2]=e(t,n,u))return!0}return!1}}function ve(e){return e.length>1?function(t,n,i){for(var o=e.length;o--;)if(!e[o](t,n,i))return!1;return!0}:e[0]}function be(e,t,n,i,o){for(var r,s=[],a=0,u=e.length,l=null!=t;a<u;a++)(r=e[a])&&(n&&!n(r,i,o)||(s.push(r),l&&t.push(a)));return s}function Se(e,t,n,i,o,r){return i&&!i[w]&&(i=Se(i)),o&&!o[w]&&(o=Se(o,r)),le((function(r,s,a,u){var l,c,h,d=[],p=[],f=s.length,g=r||function(e,t,n){for(var i=0,o=t.length;i<o;i++)ae(e,t[i],n);return n}(t||"*",a.nodeType?[a]:a,[]),m=!e||!r&&t?g:be(g,d,e,a,u),_=n?o||(r?e:f||i)?[]:s:m;if(n&&n(m,_,a,u),i)for(l=be(_,p),i(l,[],a,u),c=l.length;c--;)(h=l[c])&&(_[p[c]]=!(m[p[c]]=h));if(r){if(o||e){if(o){for(l=[],c=_.length;c--;)(h=_[c])&&l.push(m[c]=h);o(null,_=[],l,u)}for(c=_.length;c--;)(h=_[c])&&(l=o?P(r,h):d[c])>-1&&(r[l]=!(s[l]=h))}}else _=be(_===s?_.splice(f,_.length):_),o?o(null,s,_,u):R.apply(s,_)}))}function Te(e){for(var t,n,o,r=e.length,s=i.relative[e[0].type],a=s||i.relative[" "],u=s?1:0,c=we((function(e){return e===t}),a,!0),h=we((function(e){return P(t,e)>-1}),a,!0),d=[function(e,n,i){var o=!s&&(i||n!==l)||((t=n).nodeType?c(e,n,i):h(e,n,i));return t=null,o}];u<r;u++)if(n=i.relative[e[u].type])d=[we(ve(d),n)];else{if((n=i.filter[e[u].type].apply(null,e[u].matches))[w]){for(o=++u;o<r&&!i.relative[e[o].type];o++);return Se(u>1&&ve(d),u>1&&xe(e.slice(0,u-1).concat({value:" "===e[u-2].type?"*":""})).replace(z,"$1"),n,u<o&&Te(e.slice(u,o)),o<r&&Te(e=e.slice(o)),o<r&&xe(e))}d.push(n)}return ve(d)}return ye.prototype=i.filters=i.pseudos,i.setFilters=new ye,s=ae.tokenize=function(e,t){var n,o,r,s,a,u,l,c=E[e+" "];if(c)return t?0:c.slice(0);for(a=e,u=[],l=i.preFilter;a;){for(s in n&&!(o=j.exec(a))||(o&&(a=a.slice(o[0].length)||a),u.push(r=[])),n=!1,(o=G.exec(a))&&(n=o.shift(),r.push({value:n,type:o[0].replace(z," ")}),a=a.slice(n.length)),i.filter)!(o=Y[s].exec(a))||l[s]&&!(o=l[s](o))||(n=o.shift(),r.push({value:n,type:s,matches:o}),a=a.slice(n.length));if(!n)break}return t?a.length:a?ae.error(e):E(e,u).slice(0)},a=ae.compile=function(e,t){var n,o=[],r=[],a=C[e+" "];if(!a){for(t||(t=s(e)),n=t.length;n--;)(a=Te(t[n]))[w]?o.push(a):r.push(a);a=C(e,function(e,t){var n=t.length>0,o=e.length>0,r=function(r,s,a,u,c){var h,f,m,_=0,y="0",x=r&&[],w=[],v=l,S=r||o&&i.find.TAG("*",c),T=b+=null==v?1:Math.random()||.1,E=S.length;for(c&&(l=s==p||s||c);y!==E&&null!=(h=S[y]);y++){if(o&&h){for(f=0,s||h.ownerDocument==p||(d(h),a=!g);m=e[f++];)if(m(h,s||p,a)){u.push(h);break}c&&(b=T)}n&&((h=!m&&h)&&_--,r&&x.push(h))}if(_+=y,n&&y!==_){for(f=0;m=t[f++];)m(x,w,s,a);if(r){if(_>0)for(;y--;)x[y]||w[y]||(w[y]=D.call(u));w=be(w)}R.apply(u,w),c&&!r&&w.length>0&&_+t.length>1&&ae.uniqueSort(u)}return c&&(b=T,l=v),x};return n?le(r):r}(r,o)),a.selector=e}return a},u=ae.select=function(e,t,n,o){var r,u,l,c,h,d="function"==typeof e&&e,p=!o&&s(e=d.selector||e);if(n=n||[],1===p.length){if((u=p[0]=p[0].slice(0)).length>2&&"ID"===(l=u[0]).type&&9===t.nodeType&&g&&i.relative[u[1].type]){if(!(t=(i.find.ID(l.matches[0].replace(te,ne),t)||[])[0]))return n;d&&(t=t.parentNode),e=e.slice(u.shift().value.length)}for(r=Y.needsContext.test(e)?0:u.length;r--&&(l=u[r],!i.relative[c=l.type]);)if((h=i.find[c])&&(o=h(l.matches[0].replace(te,ne),ee.test(u[0].type)&&_e(t.parentNode)||t))){if(u.splice(r,1),!(e=o.length&&xe(u)))return R.apply(n,o),n;break}}return(d||a(e,p))(o,t,!g,n,!t||ee.test(e)&&_e(t.parentNode)||t),n},n.sortStable=w.split("").sort(N).join("")===w,n.detectDuplicates=!!h,d(),n.sortDetached=ce((function(e){return 1&e.compareDocumentPosition(p.createElement("fieldset"))})),ce((function(e){return e.innerHTML="<a href='#'></a>","#"===e.firstChild.getAttribute("href")}))||he("type|href|height|width",(function(e,t,n){if(!n)return e.getAttribute(t,"type"===t.toLowerCase()?1:2)})),n.attributes&&ce((function(e){return e.innerHTML="<input/>",e.firstChild.setAttribute("value",""),""===e.firstChild.getAttribute("value")}))||he("value",(function(e,t,n){if(!n&&"input"===e.nodeName.toLowerCase())return e.defaultValue})),ce((function(e){return null==e.getAttribute("disabled")}))||he(A,(function(e,t,n){var i;if(!n)return!0===e[t]?t.toLowerCase():(i=e.getAttributeNode(t))&&i.specified?i.value:null})),ae}(i);T.find=C,T.expr=C.selectors,T.expr[":"]=T.expr.pseudos,T.uniqueSort=T.unique=C.uniqueSort,T.text=C.getText,T.isXMLDoc=C.isXML,T.contains=C.contains,T.escapeSelector=C.escape;var O=function(e,t,n){for(var i=[],o=void 0!==n;(e=e[t])&&9!==e.nodeType;)if(1===e.nodeType){if(o&&T(e).is(n))break;i.push(e)}return i},N=function(e,t){for(var n=[];e;e=e.nextSibling)1===e.nodeType&&e!==t&&n.push(e);return n},F=T.expr.match.needsContext;function M(e,t){return e.nodeName&&e.nodeName.toLowerCase()===t.toLowerCase()}var D=/^<([a-z][^\/\0>:\x20\t\r\n\f]*)[\x20\t\r\n\f]*\/?>(?:<\/\1>|)$/i;function I(e,t,n){return _(t)?T.grep(e,(function(e,i){return!!t.call(e,i,e)!==n})):t.nodeType?T.grep(e,(function(e){return e===t!==n})):"string"!=typeof t?T.grep(e,(function(e){return c.call(t,e)>-1!==n})):T.filter(t,e,n)}T.filter=function(e,t,n){var i=t[0];return n&&(e=":not("+e+")"),1===t.length&&1===i.nodeType?T.find.matchesSelector(i,e)?[i]:[]:T.find.matches(e,T.grep(t,(function(e){return 1===e.nodeType})))},T.fn.extend({find:function(e){var t,n,i=this.length,o=this;if("string"!=typeof e)return this.pushStack(T(e).filter((function(){for(t=0;t<i;t++)if(T.contains(o[t],this))return!0})));for(n=this.pushStack([]),t=0;t<i;t++)T.find(e,o[t],n);return i>1?T.uniqueSort(n):n},filter:function(e){return this.pushStack(I(this,e||[],!1))},not:function(e){return this.pushStack(I(this,e||[],!0))},is:function(e){return!!I(this,"string"==typeof e&&F.test(e)?T(e):e||[],!1).length}});var R,V=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]+))$/;(T.fn.init=function(e,t,n){var i,o;if(!e)return this;if(n=n||R,"string"==typeof e){if(!(i="<"===e[0]&&">"===e[e.length-1]&&e.length>=3?[null,e,null]:V.exec(e))||!i[1]&&t)return!t||t.jquery?(t||n).find(e):this.constructor(t).find(e);if(i[1]){if(t=t instanceof T?t[0]:t,T.merge(this,T.parseHTML(i[1],t&&t.nodeType?t.ownerDocument||t:x,!0)),D.test(i[1])&&T.isPlainObject(t))for(i in t)_(this[i])?this[i](t[i]):this.attr(i,t[i]);return this}return(o=x.getElementById(i[2]))&&(this[0]=o,this.length=1),this}return e.nodeType?(this[0]=e,this.length=1,this):_(e)?void 0!==n.ready?n.ready(e):e(T):T.makeArray(e,this)}).prototype=T.fn,R=T(x);var P=/^(?:parents|prev(?:Until|All))/,A={children:!0,contents:!0,next:!0,prev:!0};function L(e,t){for(;(e=e[t])&&1!==e.nodeType;);return e}T.fn.extend({has:function(e){var t=T(e,this),n=t.length;return this.filter((function(){for(var e=0;e<n;e++)if(T.contains(this,t[e]))return!0}))},closest:function(e,t){var n,i=0,o=this.length,r=[],s="string"!=typeof e&&T(e);if(!F.test(e))for(;i<o;i++)for(n=this[i];n&&n!==t;n=n.parentNode)if(n.nodeType<11&&(s?s.index(n)>-1:1===n.nodeType&&T.find.matchesSelector(n,e))){r.push(n);break}return this.pushStack(r.length>1?T.uniqueSort(r):r)},index:function(e){return e?"string"==typeof e?c.call(T(e),this[0]):c.call(this,e.jquery?e[0]:e):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(e,t){return this.pushStack(T.uniqueSort(T.merge(this.get(),T(e,t))))},addBack:function(e){return this.add(null==e?this.prevObject:this.prevObject.filter(e))}}),T.each({parent:function(e){var t=e.parentNode;return t&&11!==t.nodeType?t:null},parents:function(e){return O(e,"parentNode")},parentsUntil:function(e,t,n){return O(e,"parentNode",n)},next:function(e){return L(e,"nextSibling")},prev:function(e){return L(e,"previousSibling")},nextAll:function(e){return O(e,"nextSibling")},prevAll:function(e){return O(e,"previousSibling")},nextUntil:function(e,t,n){return O(e,"nextSibling",n)},prevUntil:function(e,t,n){return O(e,"previousSibling",n)},siblings:function(e){return N((e.parentNode||{}).firstChild,e)},children:function(e){return N(e.firstChild)},contents:function(e){return null!=e.contentDocument&&s(e.contentDocument)?e.contentDocument:(M(e,"template")&&(e=e.content||e),T.merge([],e.childNodes))}},(function(e,t){T.fn[e]=function(n,i){var o=T.map(this,t,n);return"Until"!==e.slice(-5)&&(i=n),i&&"string"==typeof i&&(o=T.filter(i,o)),this.length>1&&(A[e]||T.uniqueSort(o),P.test(e)&&o.reverse()),this.pushStack(o)}}));var U=/[^\x20\t\r\n\f]+/g;function B(e){return e}function X(e){throw e}function k(e,t,n,i){var o;try{e&&_(o=e.promise)?o.call(e).done(t).fail(n):e&&_(o=e.then)?o.call(e,t,n):t.apply(void 0,[e].slice(i))}catch(e){n.apply(void 0,[e])}}T.Callbacks=function(e){e="string"==typeof e?function(e){var t={};return T.each(e.match(U)||[],(function(e,n){t[n]=!0})),t}(e):T.extend({},e);var t,n,i,o,r=[],s=[],a=-1,u=function(){for(o=o||e.once,i=t=!0;s.length;a=-1)for(n=s.shift();++a<r.length;)!1===r[a].apply(n[0],n[1])&&e.stopOnFalse&&(a=r.length,n=!1);e.memory||(n=!1),t=!1,o&&(r=n?[]:"")},l={add:function(){return r&&(n&&!t&&(a=r.length-1,s.push(n)),function t(n){T.each(n,(function(n,i){_(i)?e.unique&&l.has(i)||r.push(i):i&&i.length&&"string"!==b(i)&&t(i)}))}(arguments),n&&!t&&u()),this},remove:function(){return T.each(arguments,(function(e,t){for(var n;(n=T.inArray(t,r,n))>-1;)r.splice(n,1),n<=a&&a--})),this},has:function(e){return e?T.inArray(e,r)>-1:r.length>0},empty:function(){return r&&(r=[]),this},disable:function(){return o=s=[],r=n="",this},disabled:function(){return!r},lock:function(){return o=s=[],n||t||(r=n=""),this},locked:function(){return!!o},fireWith:function(e,n){return o||(n=[e,(n=n||[]).slice?n.slice():n],s.push(n),t||u()),this},fire:function(){return l.fireWith(this,arguments),this},fired:function(){return!!i}};return l},T.extend({Deferred:function(e){var t=[["notify","progress",T.Callbacks("memory"),T.Callbacks("memory"),2],["resolve","done",T.Callbacks("once memory"),T.Callbacks("once memory"),0,"resolved"],["reject","fail",T.Callbacks("once memory"),T.Callbacks("once memory"),1,"rejected"]],n="pending",o={state:function(){return n},always:function(){return r.done(arguments).fail(arguments),this},catch:function(e){return o.then(null,e)},pipe:function(){var e=arguments;return T.Deferred((function(n){T.each(t,(function(t,i){var o=_(e[i[4]])&&e[i[4]];r[i[1]]((function(){var e=o&&o.apply(this,arguments);e&&_(e.promise)?e.promise().progress(n.notify).done(n.resolve).fail(n.reject):n[i[0]+"With"](this,o?[e]:arguments)}))})),e=null})).promise()},then:function(e,n,o){var r=0;function s(e,t,n,o){return function(){var a=this,u=arguments,l=function(){var i,l;if(!(e<r)){if((i=n.apply(a,u))===t.promise())throw new TypeError("Thenable self-resolution");l=i&&("object"==typeof i||"function"==typeof i)&&i.then,_(l)?o?l.call(i,s(r,t,B,o),s(r,t,X,o)):(r++,l.call(i,s(r,t,B,o),s(r,t,X,o),s(r,t,B,t.notifyWith))):(n!==B&&(a=void 0,u=[i]),(o||t.resolveWith)(a,u))}},c=o?l:function(){try{l()}catch(i){T.Deferred.exceptionHook&&T.Deferred.exceptionHook(i,c.stackTrace),e+1>=r&&(n!==X&&(a=void 0,u=[i]),t.rejectWith(a,u))}};e?c():(T.Deferred.getStackHook&&(c.stackTrace=T.Deferred.getStackHook()),i.setTimeout(c))}}return T.Deferred((function(i){t[0][3].add(s(0,i,_(o)?o:B,i.notifyWith)),t[1][3].add(s(0,i,_(e)?e:B)),t[2][3].add(s(0,i,_(n)?n:X))})).promise()},promise:function(e){return null!=e?T.extend(e,o):o}},r={};return T.each(t,(function(e,i){var s=i[2],a=i[5];o[i[1]]=s.add,a&&s.add((function(){n=a}),t[3-e][2].disable,t[3-e][3].disable,t[0][2].lock,t[0][3].lock),s.add(i[3].fire),r[i[0]]=function(){return r[i[0]+"With"](this===r?void 0:this,arguments),this},r[i[0]+"With"]=s.fireWith})),o.promise(r),e&&e.call(r,r),r},when:function(e){var t=arguments.length,n=t,i=Array(n),o=a.call(arguments),r=T.Deferred(),s=function(e){return function(n){i[e]=this,o[e]=arguments.length>1?a.call(arguments):n,--t||r.resolveWith(i,o)}};if(t<=1&&(k(e,r.done(s(n)).resolve,r.reject,!t),"pending"===r.state()||_(o[n]&&o[n].then)))return r.then();for(;n--;)k(o[n],s(n),r.reject);return r.promise()}});var z=/^(Eval|Internal|Range|Reference|Syntax|Type|URI)Error$/;T.Deferred.exceptionHook=function(e,t){i.console&&i.console.warn&&e&&z.test(e.name)&&i.console.warn("jQuery.Deferred exception: "+e.message,e.stack,t)},T.readyException=function(e){i.setTimeout((function(){throw e}))};var j=T.Deferred();function G(){x.removeEventListener("DOMContentLoaded",G),i.removeEventListener("load",G),T.ready()}T.fn.ready=function(e){return j.then(e).catch((function(e){T.readyException(e)})),this},T.extend({isReady:!1,readyWait:1,ready:function(e){(!0===e?--T.readyWait:T.isReady)||(T.isReady=!0,!0!==e&&--T.readyWait>0||j.resolveWith(x,[T]))}}),T.ready.then=j.then,"complete"===x.readyState||"loading"!==x.readyState&&!x.documentElement.doScroll?i.setTimeout(T.ready):(x.addEventListener("DOMContentLoaded",G),i.addEventListener("load",G));var H=function(e,t,n,i,o,r,s){var a=0,u=e.length,l=null==n;if("object"===b(n))for(a in o=!0,n)H(e,t,a,n[a],!0,r,s);else if(void 0!==i&&(o=!0,_(i)||(s=!0),l&&(s?(t.call(e,i),t=null):(l=t,t=function(e,t,n){return l.call(T(e),n)})),t))for(;a<u;a++)t(e[a],n,s?i:i.call(e[a],a,t(e[a],n)));return o?e:l?t.call(e):u?t(e[0],n):r},q=/^-ms-/,W=/-([a-z])/g;function Y(e,t){return t.toUpperCase()}function K(e){return e.replace(q,"ms-").replace(W,Y)}var Z=function(e){return 1===e.nodeType||9===e.nodeType||!+e.nodeType};function Q(){this.expando=T.expando+Q.uid++}Q.uid=1,Q.prototype={cache:function(e){var t=e[this.expando];return t||(t={},Z(e)&&(e.nodeType?e[this.expando]=t:Object.defineProperty(e,this.expando,{value:t,configurable:!0}))),t},set:function(e,t,n){var i,o=this.cache(e);if("string"==typeof t)o[K(t)]=n;else for(i in t)o[K(i)]=t[i];return o},get:function(e,t){return void 0===t?this.cache(e):e[this.expando]&&e[this.expando][K(t)]},access:function(e,t,n){return void 0===t||t&&"string"==typeof t&&void 0===n?this.get(e,t):(this.set(e,t,n),void 0!==n?n:t)},remove:function(e,t){var n,i=e[this.expando];if(void 0!==i){if(void 0!==t){n=(t=Array.isArray(t)?t.map(K):(t=K(t))in i?[t]:t.match(U)||[]).length;for(;n--;)delete i[t[n]]}(void 0===t||T.isEmptyObject(i))&&(e.nodeType?e[this.expando]=void 0:delete e[this.expando])}},hasData:function(e){var t=e[this.expando];return void 0!==t&&!T.isEmptyObject(t)}};var $=new Q,J=new Q,ee=/^(?:\{[\w\W]*\}|\[[\w\W]*\])$/,te=/[A-Z]/g;function ne(e,t,n){var i;if(void 0===n&&1===e.nodeType)if(i="data-"+t.replace(te,"-$&").toLowerCase(),"string"==typeof(n=e.getAttribute(i))){try{n=function(e){return"true"===e||"false"!==e&&("null"===e?null:e===+e+""?+e:ee.test(e)?JSON.parse(e):e)}(n)}catch(e){}J.set(e,t,n)}else n=void 0;return n}T.extend({hasData:function(e){return J.hasData(e)||$.hasData(e)},data:function(e,t,n){return J.access(e,t,n)},removeData:function(e,t){J.remove(e,t)},_data:function(e,t,n){return $.access(e,t,n)},_removeData:function(e,t){$.remove(e,t)}}),T.fn.extend({data:function(e,t){var n,i,o,r=this[0],s=r&&r.attributes;if(void 0===e){if(this.length&&(o=J.get(r),1===r.nodeType&&!$.get(r,"hasDataAttrs"))){for(n=s.length;n--;)s[n]&&0===(i=s[n].name).indexOf("data-")&&(i=K(i.slice(5)),ne(r,i,o[i]));$.set(r,"hasDataAttrs",!0)}return o}return"object"==typeof e?this.each((function(){J.set(this,e)})):H(this,(function(t){var n;if(r&&void 0===t)return void 0!==(n=J.get(r,e))||void 0!==(n=ne(r,e))?n:void 0;this.each((function(){J.set(this,e,t)}))}),null,t,arguments.length>1,null,!0)},removeData:function(e){return this.each((function(){J.remove(this,e)}))}}),T.extend({queue:function(e,t,n){var i;if(e)return t=(t||"fx")+"queue",i=$.get(e,t),n&&(!i||Array.isArray(n)?i=$.access(e,t,T.makeArray(n)):i.push(n)),i||[]},dequeue:function(e,t){t=t||"fx";var n=T.queue(e,t),i=n.length,o=n.shift(),r=T._queueHooks(e,t);"inprogress"===o&&(o=n.shift(),i--),o&&("fx"===t&&n.unshift("inprogress"),delete r.stop,o.call(e,(function(){T.dequeue(e,t)}),r)),!i&&r&&r.empty.fire()},_queueHooks:function(e,t){var n=t+"queueHooks";return $.get(e,n)||$.access(e,n,{empty:T.Callbacks("once memory").add((function(){$.remove(e,[t+"queue",n])}))})}}),T.fn.extend({queue:function(e,t){var n=2;return"string"!=typeof e&&(t=e,e="fx",n--),arguments.length<n?T.queue(this[0],e):void 0===t?this:this.each((function(){var n=T.queue(this,e,t);T._queueHooks(this,e),"fx"===e&&"inprogress"!==n[0]&&T.dequeue(this,e)}))},dequeue:function(e){return this.each((function(){T.dequeue(this,e)}))},clearQueue:function(e){return this.queue(e||"fx",[])},promise:function(e,t){var n,i=1,o=T.Deferred(),r=this,s=this.length,a=function(){--i||o.resolveWith(r,[r])};for("string"!=typeof e&&(t=e,e=void 0),e=e||"fx";s--;)(n=$.get(r[s],e+"queueHooks"))&&n.empty&&(i++,n.empty.add(a));return a(),o.promise(t)}});var ie=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,oe=new RegExp("^(?:([+-])=|)("+ie+")([a-z%]*)$","i"),re=["Top","Right","Bottom","Left"],se=x.documentElement,ae=function(e){return T.contains(e.ownerDocument,e)},ue={composed:!0};se.getRootNode&&(ae=function(e){return T.contains(e.ownerDocument,e)||e.getRootNode(ue)===e.ownerDocument});var le=function(e,t){return"none"===(e=t||e).style.display||""===e.style.display&&ae(e)&&"none"===T.css(e,"display")};function ce(e,t,n,i){var o,r,s=20,a=i?function(){return i.cur()}:function(){return T.css(e,t,"")},u=a(),l=n&&n[3]||(T.cssNumber[t]?"":"px"),c=e.nodeType&&(T.cssNumber[t]||"px"!==l&&+u)&&oe.exec(T.css(e,t));if(c&&c[3]!==l){for(u/=2,l=l||c[3],c=+u||1;s--;)T.style(e,t,c+l),(1-r)*(1-(r=a()/u||.5))<=0&&(s=0),c/=r;c*=2,T.style(e,t,c+l),n=n||[]}return n&&(c=+c||+u||0,o=n[1]?c+(n[1]+1)*n[2]:+n[2],i&&(i.unit=l,i.start=c,i.end=o)),o}var he={};function de(e){var t,n=e.ownerDocument,i=e.nodeName,o=he[i];return o||(t=n.body.appendChild(n.createElement(i)),o=T.css(t,"display"),t.parentNode.removeChild(t),"none"===o&&(o="block"),he[i]=o,o)}function pe(e,t){for(var n,i,o=[],r=0,s=e.length;r<s;r++)(i=e[r]).style&&(n=i.style.display,t?("none"===n&&(o[r]=$.get(i,"display")||null,o[r]||(i.style.display="")),""===i.style.display&&le(i)&&(o[r]=de(i))):"none"!==n&&(o[r]="none",$.set(i,"display",n)));for(r=0;r<s;r++)null!=o[r]&&(e[r].style.display=o[r]);return e}T.fn.extend({show:function(){return pe(this,!0)},hide:function(){return pe(this)},toggle:function(e){return"boolean"==typeof e?e?this.show():this.hide():this.each((function(){le(this)?T(this).show():T(this).hide()}))}});var fe,ge,me=/^(?:checkbox|radio)$/i,_e=/<([a-z][^\/\0>\x20\t\r\n\f]*)/i,ye=/^$|^module$|\/(?:java|ecma)script/i;fe=x.createDocumentFragment().appendChild(x.createElement("div")),(ge=x.createElement("input")).setAttribute("type","radio"),ge.setAttribute("checked","checked"),ge.setAttribute("name","t"),fe.appendChild(ge),m.checkClone=fe.cloneNode(!0).cloneNode(!0).lastChild.checked,fe.innerHTML="<textarea>x</textarea>",m.noCloneChecked=!!fe.cloneNode(!0).lastChild.defaultValue,fe.innerHTML="<option></option>",m.option=!!fe.lastChild;var xe={thead:[1,"<table>","</table>"],col:[2,"<table><colgroup>","</colgroup></table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:[0,"",""]};function we(e,t){var n;return n=void 0!==e.getElementsByTagName?e.getElementsByTagName(t||"*"):void 0!==e.querySelectorAll?e.querySelectorAll(t||"*"):[],void 0===t||t&&M(e,t)?T.merge([e],n):n}function ve(e,t){for(var n=0,i=e.length;n<i;n++)$.set(e[n],"globalEval",!t||$.get(t[n],"globalEval"))}xe.tbody=xe.tfoot=xe.colgroup=xe.caption=xe.thead,xe.th=xe.td,m.option||(xe.optgroup=xe.option=[1,"<select multiple='multiple'>","</select>"]);var be=/<|&#?\w+;/;function Se(e,t,n,i,o){for(var r,s,a,u,l,c,h=t.createDocumentFragment(),d=[],p=0,f=e.length;p<f;p++)if((r=e[p])||0===r)if("object"===b(r))T.merge(d,r.nodeType?[r]:r);else if(be.test(r)){for(s=s||h.appendChild(t.createElement("div")),a=(_e.exec(r)||["",""])[1].toLowerCase(),u=xe[a]||xe._default,s.innerHTML=u[1]+T.htmlPrefilter(r)+u[2],c=u[0];c--;)s=s.lastChild;T.merge(d,s.childNodes),(s=h.firstChild).textContent=""}else d.push(t.createTextNode(r));for(h.textContent="",p=0;r=d[p++];)if(i&&T.inArray(r,i)>-1)o&&o.push(r);else if(l=ae(r),s=we(h.appendChild(r),"script"),l&&ve(s),n)for(c=0;r=s[c++];)ye.test(r.type||"")&&n.push(r);return h}var Te=/^([^.]*)(?:\.(.+)|)/;function Ee(){return!0}function Ce(){return!1}function Oe(e,t){return e===function(){try{return x.activeElement}catch(e){}}()==("focus"===t)}function Ne(e,t,n,i,o,r){var s,a;if("object"==typeof t){for(a in"string"!=typeof n&&(i=i||n,n=void 0),t)Ne(e,a,n,i,t[a],r);return e}if(null==i&&null==o?(o=n,i=n=void 0):null==o&&("string"==typeof n?(o=i,i=void 0):(o=i,i=n,n=void 0)),!1===o)o=Ce;else if(!o)return e;return 1===r&&(s=o,o=function(e){return T().off(e),s.apply(this,arguments)},o.guid=s.guid||(s.guid=T.guid++)),e.each((function(){T.event.add(this,t,o,i,n)}))}function Fe(e,t,n){n?($.set(e,t,!1),T.event.add(e,t,{namespace:!1,handler:function(e){var i,o,r=$.get(this,t);if(1&e.isTrigger&&this[t]){if(r.length)(T.event.special[t]||{}).delegateType&&e.stopPropagation();else if(r=a.call(arguments),$.set(this,t,r),i=n(this,t),this[t](),r!==(o=$.get(this,t))||i?$.set(this,t,!1):o={},r!==o)return e.stopImmediatePropagation(),e.preventDefault(),o&&o.value}else r.length&&($.set(this,t,{value:T.event.trigger(T.extend(r[0],T.Event.prototype),r.slice(1),this)}),e.stopImmediatePropagation())}})):void 0===$.get(e,t)&&T.event.add(e,t,Ee)}T.event={global:{},add:function(e,t,n,i,o){var r,s,a,u,l,c,h,d,p,f,g,m=$.get(e);if(Z(e))for(n.handler&&(n=(r=n).handler,o=r.selector),o&&T.find.matchesSelector(se,o),n.guid||(n.guid=T.guid++),(u=m.events)||(u=m.events=Object.create(null)),(s=m.handle)||(s=m.handle=function(t){return void 0!==T&&T.event.triggered!==t.type?T.event.dispatch.apply(e,arguments):void 0}),l=(t=(t||"").match(U)||[""]).length;l--;)p=g=(a=Te.exec(t[l])||[])[1],f=(a[2]||"").split(".").sort(),p&&(h=T.event.special[p]||{},p=(o?h.delegateType:h.bindType)||p,h=T.event.special[p]||{},c=T.extend({type:p,origType:g,data:i,handler:n,guid:n.guid,selector:o,needsContext:o&&T.expr.match.needsContext.test(o),namespace:f.join(".")},r),(d=u[p])||((d=u[p]=[]).delegateCount=0,h.setup&&!1!==h.setup.call(e,i,f,s)||e.addEventListener&&e.addEventListener(p,s)),h.add&&(h.add.call(e,c),c.handler.guid||(c.handler.guid=n.guid)),o?d.splice(d.delegateCount++,0,c):d.push(c),T.event.global[p]=!0)},remove:function(e,t,n,i,o){var r,s,a,u,l,c,h,d,p,f,g,m=$.hasData(e)&&$.get(e);if(m&&(u=m.events)){for(l=(t=(t||"").match(U)||[""]).length;l--;)if(p=g=(a=Te.exec(t[l])||[])[1],f=(a[2]||"").split(".").sort(),p){for(h=T.event.special[p]||{},d=u[p=(i?h.delegateType:h.bindType)||p]||[],a=a[2]&&new RegExp("(^|\\.)"+f.join("\\.(?:.*\\.|)")+"(\\.|$)"),s=r=d.length;r--;)c=d[r],!o&&g!==c.origType||n&&n.guid!==c.guid||a&&!a.test(c.namespace)||i&&i!==c.selector&&("**"!==i||!c.selector)||(d.splice(r,1),c.selector&&d.delegateCount--,h.remove&&h.remove.call(e,c));s&&!d.length&&(h.teardown&&!1!==h.teardown.call(e,f,m.handle)||T.removeEvent(e,p,m.handle),delete u[p])}else for(p in u)T.event.remove(e,p+t[l],n,i,!0);T.isEmptyObject(u)&&$.remove(e,"handle events")}},dispatch:function(e){var t,n,i,o,r,s,a=new Array(arguments.length),u=T.event.fix(e),l=($.get(this,"events")||Object.create(null))[u.type]||[],c=T.event.special[u.type]||{};for(a[0]=u,t=1;t<arguments.length;t++)a[t]=arguments[t];if(u.delegateTarget=this,!c.preDispatch||!1!==c.preDispatch.call(this,u)){for(s=T.event.handlers.call(this,u,l),t=0;(o=s[t++])&&!u.isPropagationStopped();)for(u.currentTarget=o.elem,n=0;(r=o.handlers[n++])&&!u.isImmediatePropagationStopped();)u.rnamespace&&!1!==r.namespace&&!u.rnamespace.test(r.namespace)||(u.handleObj=r,u.data=r.data,void 0!==(i=((T.event.special[r.origType]||{}).handle||r.handler).apply(o.elem,a))&&!1===(u.result=i)&&(u.preventDefault(),u.stopPropagation()));return c.postDispatch&&c.postDispatch.call(this,u),u.result}},handlers:function(e,t){var n,i,o,r,s,a=[],u=t.delegateCount,l=e.target;if(u&&l.nodeType&&!("click"===e.type&&e.button>=1))for(;l!==this;l=l.parentNode||this)if(1===l.nodeType&&("click"!==e.type||!0!==l.disabled)){for(r=[],s={},n=0;n<u;n++)void 0===s[o=(i=t[n]).selector+" "]&&(s[o]=i.needsContext?T(o,this).index(l)>-1:T.find(o,this,null,[l]).length),s[o]&&r.push(i);r.length&&a.push({elem:l,handlers:r})}return l=this,u<t.length&&a.push({elem:l,handlers:t.slice(u)}),a},addProp:function(e,t){Object.defineProperty(T.Event.prototype,e,{enumerable:!0,configurable:!0,get:_(t)?function(){if(this.originalEvent)return t(this.originalEvent)}:function(){if(this.originalEvent)return this.originalEvent[e]},set:function(t){Object.defineProperty(this,e,{enumerable:!0,configurable:!0,writable:!0,value:t})}})},fix:function(e){return e[T.expando]?e:new T.Event(e)},special:{load:{noBubble:!0},click:{setup:function(e){var t=this||e;return me.test(t.type)&&t.click&&M(t,"input")&&Fe(t,"click",Ee),!1},trigger:function(e){var t=this||e;return me.test(t.type)&&t.click&&M(t,"input")&&Fe(t,"click"),!0},_default:function(e){var t=e.target;return me.test(t.type)&&t.click&&M(t,"input")&&$.get(t,"click")||M(t,"a")}},beforeunload:{postDispatch:function(e){void 0!==e.result&&e.originalEvent&&(e.originalEvent.returnValue=e.result)}}}},T.removeEvent=function(e,t,n){e.removeEventListener&&e.removeEventListener(t,n)},T.Event=function(e,t){if(!(this instanceof T.Event))return new T.Event(e,t);e&&e.type?(this.originalEvent=e,this.type=e.type,this.isDefaultPrevented=e.defaultPrevented||void 0===e.defaultPrevented&&!1===e.returnValue?Ee:Ce,this.target=e.target&&3===e.target.nodeType?e.target.parentNode:e.target,this.currentTarget=e.currentTarget,this.relatedTarget=e.relatedTarget):this.type=e,t&&T.extend(this,t),this.timeStamp=e&&e.timeStamp||Date.now(),this[T.expando]=!0},T.Event.prototype={constructor:T.Event,isDefaultPrevented:Ce,isPropagationStopped:Ce,isImmediatePropagationStopped:Ce,isSimulated:!1,preventDefault:function(){var e=this.originalEvent;this.isDefaultPrevented=Ee,e&&!this.isSimulated&&e.preventDefault()},stopPropagation:function(){var e=this.originalEvent;this.isPropagationStopped=Ee,e&&!this.isSimulated&&e.stopPropagation()},stopImmediatePropagation:function(){var e=this.originalEvent;this.isImmediatePropagationStopped=Ee,e&&!this.isSimulated&&e.stopImmediatePropagation(),this.stopPropagation()}},T.each({altKey:!0,bubbles:!0,cancelable:!0,changedTouches:!0,ctrlKey:!0,detail:!0,eventPhase:!0,metaKey:!0,pageX:!0,pageY:!0,shiftKey:!0,view:!0,char:!0,code:!0,charCode:!0,key:!0,keyCode:!0,button:!0,buttons:!0,clientX:!0,clientY:!0,offsetX:!0,offsetY:!0,pointerId:!0,pointerType:!0,screenX:!0,screenY:!0,targetTouches:!0,toElement:!0,touches:!0,which:!0},T.event.addProp),T.each({focus:"focusin",blur:"focusout"},(function(e,t){T.event.special[e]={setup:function(){return Fe(this,e,Oe),!1},trigger:function(){return Fe(this,e),!0},_default:function(t){return $.get(t.target,e)},delegateType:t}})),T.each({mouseenter:"mouseover",mouseleave:"mouseout",pointerenter:"pointerover",pointerleave:"pointerout"},(function(e,t){T.event.special[e]={delegateType:t,bindType:t,handle:function(e){var n,i=this,o=e.relatedTarget,r=e.handleObj;return o&&(o===i||T.contains(i,o))||(e.type=r.origType,n=r.handler.apply(this,arguments),e.type=t),n}}})),T.fn.extend({on:function(e,t,n,i){return Ne(this,e,t,n,i)},one:function(e,t,n,i){return Ne(this,e,t,n,i,1)},off:function(e,t,n){var i,o;if(e&&e.preventDefault&&e.handleObj)return i=e.handleObj,T(e.delegateTarget).off(i.namespace?i.origType+"."+i.namespace:i.origType,i.selector,i.handler),this;if("object"==typeof e){for(o in e)this.off(o,t,e[o]);return this}return!1!==t&&"function"!=typeof t||(n=t,t=void 0),!1===n&&(n=Ce),this.each((function(){T.event.remove(this,e,n,t)}))}});var Me=/<script|<style|<link/i,De=/checked\s*(?:[^=]|=\s*.checked.)/i,Ie=/^\s*<!\[CDATA\[|\]\]>\s*$/g;function Re(e,t){return M(e,"table")&&M(11!==t.nodeType?t:t.firstChild,"tr")&&T(e).children("tbody")[0]||e}function Ve(e){return e.type=(null!==e.getAttribute("type"))+"/"+e.type,e}function Pe(e){return"true/"===(e.type||"").slice(0,5)?e.type=e.type.slice(5):e.removeAttribute("type"),e}function Ae(e,t){var n,i,o,r,s,a;if(1===t.nodeType){if($.hasData(e)&&(a=$.get(e).events))for(o in $.remove(t,"handle events"),a)for(n=0,i=a[o].length;n<i;n++)T.event.add(t,o,a[o][n]);J.hasData(e)&&(r=J.access(e),s=T.extend({},r),J.set(t,s))}}function Le(e,t){var n=t.nodeName.toLowerCase();"input"===n&&me.test(e.type)?t.checked=e.checked:"input"!==n&&"textarea"!==n||(t.defaultValue=e.defaultValue)}function Ue(e,t,n,i){t=u(t);var o,r,s,a,l,c,h=0,d=e.length,p=d-1,f=t[0],g=_(f);if(g||d>1&&"string"==typeof f&&!m.checkClone&&De.test(f))return e.each((function(o){var r=e.eq(o);g&&(t[0]=f.call(this,o,r.html())),Ue(r,t,n,i)}));if(d&&(r=(o=Se(t,e[0].ownerDocument,!1,e,i)).firstChild,1===o.childNodes.length&&(o=r),r||i)){for(a=(s=T.map(we(o,"script"),Ve)).length;h<d;h++)l=o,h!==p&&(l=T.clone(l,!0,!0),a&&T.merge(s,we(l,"script"))),n.call(e[h],l,h);if(a)for(c=s[s.length-1].ownerDocument,T.map(s,Pe),h=0;h<a;h++)l=s[h],ye.test(l.type||"")&&!$.access(l,"globalEval")&&T.contains(c,l)&&(l.src&&"module"!==(l.type||"").toLowerCase()?T._evalUrl&&!l.noModule&&T._evalUrl(l.src,{nonce:l.nonce||l.getAttribute("nonce")},c):v(l.textContent.replace(Ie,""),l,c))}return e}function Be(e,t,n){for(var i,o=t?T.filter(t,e):e,r=0;null!=(i=o[r]);r++)n||1!==i.nodeType||T.cleanData(we(i)),i.parentNode&&(n&&ae(i)&&ve(we(i,"script")),i.parentNode.removeChild(i));return e}T.extend({htmlPrefilter:function(e){return e},clone:function(e,t,n){var i,o,r,s,a=e.cloneNode(!0),u=ae(e);if(!(m.noCloneChecked||1!==e.nodeType&&11!==e.nodeType||T.isXMLDoc(e)))for(s=we(a),i=0,o=(r=we(e)).length;i<o;i++)Le(r[i],s[i]);if(t)if(n)for(r=r||we(e),s=s||we(a),i=0,o=r.length;i<o;i++)Ae(r[i],s[i]);else Ae(e,a);return(s=we(a,"script")).length>0&&ve(s,!u&&we(e,"script")),a},cleanData:function(e){for(var t,n,i,o=T.event.special,r=0;void 0!==(n=e[r]);r++)if(Z(n)){if(t=n[$.expando]){if(t.events)for(i in t.events)o[i]?T.event.remove(n,i):T.removeEvent(n,i,t.handle);n[$.expando]=void 0}n[J.expando]&&(n[J.expando]=void 0)}}}),T.fn.extend({detach:function(e){return Be(this,e,!0)},remove:function(e){return Be(this,e)},text:function(e){return H(this,(function(e){return void 0===e?T.text(this):this.empty().each((function(){1!==this.nodeType&&11!==this.nodeType&&9!==this.nodeType||(this.textContent=e)}))}),null,e,arguments.length)},append:function(){return Ue(this,arguments,(function(e){1!==this.nodeType&&11!==this.nodeType&&9!==this.nodeType||Re(this,e).appendChild(e)}))},prepend:function(){return Ue(this,arguments,(function(e){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var t=Re(this,e);t.insertBefore(e,t.firstChild)}}))},before:function(){return Ue(this,arguments,(function(e){this.parentNode&&this.parentNode.insertBefore(e,this)}))},after:function(){return Ue(this,arguments,(function(e){this.parentNode&&this.parentNode.insertBefore(e,this.nextSibling)}))},empty:function(){for(var e,t=0;null!=(e=this[t]);t++)1===e.nodeType&&(T.cleanData(we(e,!1)),e.textContent="");return this},clone:function(e,t){return e=null!=e&&e,t=null==t?e:t,this.map((function(){return T.clone(this,e,t)}))},html:function(e){return H(this,(function(e){var t=this[0]||{},n=0,i=this.length;if(void 0===e&&1===t.nodeType)return t.innerHTML;if("string"==typeof e&&!Me.test(e)&&!xe[(_e.exec(e)||["",""])[1].toLowerCase()]){e=T.htmlPrefilter(e);try{for(;n<i;n++)1===(t=this[n]||{}).nodeType&&(T.cleanData(we(t,!1)),t.innerHTML=e);t=0}catch(e){}}t&&this.empty().append(e)}),null,e,arguments.length)},replaceWith:function(){var e=[];return Ue(this,arguments,(function(t){var n=this.parentNode;T.inArray(this,e)<0&&(T.cleanData(we(this)),n&&n.replaceChild(t,this))}),e)}}),T.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},(function(e,t){T.fn[e]=function(e){for(var n,i=[],o=T(e),r=o.length-1,s=0;s<=r;s++)n=s===r?this:this.clone(!0),T(o[s])[t](n),l.apply(i,n.get());return this.pushStack(i)}}));var Xe=new RegExp("^("+ie+")(?!px)[a-z%]+$","i"),ke=/^--/,ze=function(e){var t=e.ownerDocument.defaultView;return t&&t.opener||(t=i),t.getComputedStyle(e)},je=function(e,t,n){var i,o,r={};for(o in t)r[o]=e.style[o],e.style[o]=t[o];for(o in i=n.call(e),t)e.style[o]=r[o];return i},Ge=new RegExp(re.join("|"),"i"),He=new RegExp("^[\\x20\\t\\r\\n\\f]+|((?:^|[^\\\\])(?:\\\\.)*)[\\x20\\t\\r\\n\\f]+$","g");function qe(e,t,n){var i,o,r,s,a=ke.test(t),u=e.style;return(n=n||ze(e))&&(s=n.getPropertyValue(t)||n[t],a&&(s=s.replace(He,"$1")),""!==s||ae(e)||(s=T.style(e,t)),!m.pixelBoxStyles()&&Xe.test(s)&&Ge.test(t)&&(i=u.width,o=u.minWidth,r=u.maxWidth,u.minWidth=u.maxWidth=u.width=s,s=n.width,u.width=i,u.minWidth=o,u.maxWidth=r)),void 0!==s?s+"":s}function We(e,t){return{get:function(){if(!e())return(this.get=t).apply(this,arguments);delete this.get}}}!function(){function e(){if(c){l.style.cssText="position:absolute;left:-11111px;width:60px;margin-top:1px;padding:0;border:0",c.style.cssText="position:relative;display:block;box-sizing:border-box;overflow:scroll;margin:auto;border:1px;padding:1px;width:60%;top:1%",se.appendChild(l).appendChild(c);var e=i.getComputedStyle(c);n="1%"!==e.top,u=12===t(e.marginLeft),c.style.right="60%",s=36===t(e.right),o=36===t(e.width),c.style.position="absolute",r=12===t(c.offsetWidth/3),se.removeChild(l),c=null}}function t(e){return Math.round(parseFloat(e))}var n,o,r,s,a,u,l=x.createElement("div"),c=x.createElement("div");c.style&&(c.style.backgroundClip="content-box",c.cloneNode(!0).style.backgroundClip="",m.clearCloneStyle="content-box"===c.style.backgroundClip,T.extend(m,{boxSizingReliable:function(){return e(),o},pixelBoxStyles:function(){return e(),s},pixelPosition:function(){return e(),n},reliableMarginLeft:function(){return e(),u},scrollboxSize:function(){return e(),r},reliableTrDimensions:function(){var e,t,n,o;return null==a&&(e=x.createElement("table"),t=x.createElement("tr"),n=x.createElement("div"),e.style.cssText="position:absolute;left:-11111px;border-collapse:separate",t.style.cssText="border:1px solid",t.style.height="1px",n.style.height="9px",n.style.display="block",se.appendChild(e).appendChild(t).appendChild(n),o=i.getComputedStyle(t),a=parseInt(o.height,10)+parseInt(o.borderTopWidth,10)+parseInt(o.borderBottomWidth,10)===t.offsetHeight,se.removeChild(e)),a}}))}();var Ye=["Webkit","Moz","ms"],Ke=x.createElement("div").style,Ze={};function Qe(e){var t=T.cssProps[e]||Ze[e];return t||(e in Ke?e:Ze[e]=function(e){for(var t=e[0].toUpperCase()+e.slice(1),n=Ye.length;n--;)if((e=Ye[n]+t)in Ke)return e}(e)||e)}var $e=/^(none|table(?!-c[ea]).+)/,Je={position:"absolute",visibility:"hidden",display:"block"},et={letterSpacing:"0",fontWeight:"400"};function tt(e,t,n){var i=oe.exec(t);return i?Math.max(0,i[2]-(n||0))+(i[3]||"px"):t}function nt(e,t,n,i,o,r){var s="width"===t?1:0,a=0,u=0;if(n===(i?"border":"content"))return 0;for(;s<4;s+=2)"margin"===n&&(u+=T.css(e,n+re[s],!0,o)),i?("content"===n&&(u-=T.css(e,"padding"+re[s],!0,o)),"margin"!==n&&(u-=T.css(e,"border"+re[s]+"Width",!0,o))):(u+=T.css(e,"padding"+re[s],!0,o),"padding"!==n?u+=T.css(e,"border"+re[s]+"Width",!0,o):a+=T.css(e,"border"+re[s]+"Width",!0,o));return!i&&r>=0&&(u+=Math.max(0,Math.ceil(e["offset"+t[0].toUpperCase()+t.slice(1)]-r-u-a-.5))||0),u}function it(e,t,n){var i=ze(e),o=(!m.boxSizingReliable()||n)&&"border-box"===T.css(e,"boxSizing",!1,i),r=o,s=qe(e,t,i),a="offset"+t[0].toUpperCase()+t.slice(1);if(Xe.test(s)){if(!n)return s;s="auto"}return(!m.boxSizingReliable()&&o||!m.reliableTrDimensions()&&M(e,"tr")||"auto"===s||!parseFloat(s)&&"inline"===T.css(e,"display",!1,i))&&e.getClientRects().length&&(o="border-box"===T.css(e,"boxSizing",!1,i),(r=a in e)&&(s=e[a])),(s=parseFloat(s)||0)+nt(e,t,n||(o?"border":"content"),r,i,s)+"px"}function ot(e,t,n,i,o){return new ot.prototype.init(e,t,n,i,o)}T.extend({cssHooks:{opacity:{get:function(e,t){if(t){var n=qe(e,"opacity");return""===n?"1":n}}}},cssNumber:{animationIterationCount:!0,columnCount:!0,fillOpacity:!0,flexGrow:!0,flexShrink:!0,fontWeight:!0,gridArea:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnStart:!0,gridRow:!0,gridRowEnd:!0,gridRowStart:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{},style:function(e,t,n,i){if(e&&3!==e.nodeType&&8!==e.nodeType&&e.style){var o,r,s,a=K(t),u=ke.test(t),l=e.style;if(u||(t=Qe(a)),s=T.cssHooks[t]||T.cssHooks[a],void 0===n)return s&&"get"in s&&void 0!==(o=s.get(e,!1,i))?o:l[t];"string"===(r=typeof n)&&(o=oe.exec(n))&&o[1]&&(n=ce(e,t,o),r="number"),null!=n&&n==n&&("number"!==r||u||(n+=o&&o[3]||(T.cssNumber[a]?"":"px")),m.clearCloneStyle||""!==n||0!==t.indexOf("background")||(l[t]="inherit"),s&&"set"in s&&void 0===(n=s.set(e,n,i))||(u?l.setProperty(t,n):l[t]=n))}},css:function(e,t,n,i){var o,r,s,a=K(t);return ke.test(t)||(t=Qe(a)),(s=T.cssHooks[t]||T.cssHooks[a])&&"get"in s&&(o=s.get(e,!0,n)),void 0===o&&(o=qe(e,t,i)),"normal"===o&&t in et&&(o=et[t]),""===n||n?(r=parseFloat(o),!0===n||isFinite(r)?r||0:o):o}}),T.each(["height","width"],(function(e,t){T.cssHooks[t]={get:function(e,n,i){if(n)return!$e.test(T.css(e,"display"))||e.getClientRects().length&&e.getBoundingClientRect().width?it(e,t,i):je(e,Je,(function(){return it(e,t,i)}))},set:function(e,n,i){var o,r=ze(e),s=!m.scrollboxSize()&&"absolute"===r.position,a=(s||i)&&"border-box"===T.css(e,"boxSizing",!1,r),u=i?nt(e,t,i,a,r):0;return a&&s&&(u-=Math.ceil(e["offset"+t[0].toUpperCase()+t.slice(1)]-parseFloat(r[t])-nt(e,t,"border",!1,r)-.5)),u&&(o=oe.exec(n))&&"px"!==(o[3]||"px")&&(e.style[t]=n,n=T.css(e,t)),tt(0,n,u)}}})),T.cssHooks.marginLeft=We(m.reliableMarginLeft,(function(e,t){if(t)return(parseFloat(qe(e,"marginLeft"))||e.getBoundingClientRect().left-je(e,{marginLeft:0},(function(){return e.getBoundingClientRect().left})))+"px"})),T.each({margin:"",padding:"",border:"Width"},(function(e,t){T.cssHooks[e+t]={expand:function(n){for(var i=0,o={},r="string"==typeof n?n.split(" "):[n];i<4;i++)o[e+re[i]+t]=r[i]||r[i-2]||r[0];return o}},"margin"!==e&&(T.cssHooks[e+t].set=tt)})),T.fn.extend({css:function(e,t){return H(this,(function(e,t,n){var i,o,r={},s=0;if(Array.isArray(t)){for(i=ze(e),o=t.length;s<o;s++)r[t[s]]=T.css(e,t[s],!1,i);return r}return void 0!==n?T.style(e,t,n):T.css(e,t)}),e,t,arguments.length>1)}}),T.Tween=ot,ot.prototype={constructor:ot,init:function(e,t,n,i,o,r){this.elem=e,this.prop=n,this.easing=o||T.easing._default,this.options=t,this.start=this.now=this.cur(),this.end=i,this.unit=r||(T.cssNumber[n]?"":"px")},cur:function(){var e=ot.propHooks[this.prop];return e&&e.get?e.get(this):ot.propHooks._default.get(this)},run:function(e){var t,n=ot.propHooks[this.prop];return this.options.duration?this.pos=t=T.easing[this.easing](e,this.options.duration*e,0,1,this.options.duration):this.pos=t=e,this.now=(this.end-this.start)*t+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),n&&n.set?n.set(this):ot.propHooks._default.set(this),this}},ot.prototype.init.prototype=ot.prototype,ot.propHooks={_default:{get:function(e){var t;return 1!==e.elem.nodeType||null!=e.elem[e.prop]&&null==e.elem.style[e.prop]?e.elem[e.prop]:(t=T.css(e.elem,e.prop,""))&&"auto"!==t?t:0},set:function(e){T.fx.step[e.prop]?T.fx.step[e.prop](e):1!==e.elem.nodeType||!T.cssHooks[e.prop]&&null==e.elem.style[Qe(e.prop)]?e.elem[e.prop]=e.now:T.style(e.elem,e.prop,e.now+e.unit)}}},ot.propHooks.scrollTop=ot.propHooks.scrollLeft={set:function(e){e.elem.nodeType&&e.elem.parentNode&&(e.elem[e.prop]=e.now)}},T.easing={linear:function(e){return e},swing:function(e){return.5-Math.cos(e*Math.PI)/2},_default:"swing"},T.fx=ot.prototype.init,T.fx.step={};var rt,st,at=/^(?:toggle|show|hide)$/,ut=/queueHooks$/;function lt(){st&&(!1===x.hidden&&i.requestAnimationFrame?i.requestAnimationFrame(lt):i.setTimeout(lt,T.fx.interval),T.fx.tick())}function ct(){return i.setTimeout((function(){rt=void 0})),rt=Date.now()}function ht(e,t){var n,i=0,o={height:e};for(t=t?1:0;i<4;i+=2-t)o["margin"+(n=re[i])]=o["padding"+n]=e;return t&&(o.opacity=o.width=e),o}function dt(e,t,n){for(var i,o=(pt.tweeners[t]||[]).concat(pt.tweeners["*"]),r=0,s=o.length;r<s;r++)if(i=o[r].call(n,t,e))return i}function pt(e,t,n){var i,o,r=0,s=pt.prefilters.length,a=T.Deferred().always((function(){delete u.elem})),u=function(){if(o)return!1;for(var t=rt||ct(),n=Math.max(0,l.startTime+l.duration-t),i=1-(n/l.duration||0),r=0,s=l.tweens.length;r<s;r++)l.tweens[r].run(i);return a.notifyWith(e,[l,i,n]),i<1&&s?n:(s||a.notifyWith(e,[l,1,0]),a.resolveWith(e,[l]),!1)},l=a.promise({elem:e,props:T.extend({},t),opts:T.extend(!0,{specialEasing:{},easing:T.easing._default},n),originalProperties:t,originalOptions:n,startTime:rt||ct(),duration:n.duration,tweens:[],createTween:function(t,n){var i=T.Tween(e,l.opts,t,n,l.opts.specialEasing[t]||l.opts.easing);return l.tweens.push(i),i},stop:function(t){var n=0,i=t?l.tweens.length:0;if(o)return this;for(o=!0;n<i;n++)l.tweens[n].run(1);return t?(a.notifyWith(e,[l,1,0]),a.resolveWith(e,[l,t])):a.rejectWith(e,[l,t]),this}}),c=l.props;for(!function(e,t){var n,i,o,r,s;for(n in e)if(o=t[i=K(n)],r=e[n],Array.isArray(r)&&(o=r[1],r=e[n]=r[0]),n!==i&&(e[i]=r,delete e[n]),(s=T.cssHooks[i])&&"expand"in s)for(n in r=s.expand(r),delete e[i],r)n in e||(e[n]=r[n],t[n]=o);else t[i]=o}(c,l.opts.specialEasing);r<s;r++)if(i=pt.prefilters[r].call(l,e,c,l.opts))return _(i.stop)&&(T._queueHooks(l.elem,l.opts.queue).stop=i.stop.bind(i)),i;return T.map(c,dt,l),_(l.opts.start)&&l.opts.start.call(e,l),l.progress(l.opts.progress).done(l.opts.done,l.opts.complete).fail(l.opts.fail).always(l.opts.always),T.fx.timer(T.extend(u,{elem:e,anim:l,queue:l.opts.queue})),l}T.Animation=T.extend(pt,{tweeners:{"*":[function(e,t){var n=this.createTween(e,t);return ce(n.elem,e,oe.exec(t),n),n}]},tweener:function(e,t){_(e)?(t=e,e=["*"]):e=e.match(U);for(var n,i=0,o=e.length;i<o;i++)n=e[i],pt.tweeners[n]=pt.tweeners[n]||[],pt.tweeners[n].unshift(t)},prefilters:[function(e,t,n){var i,o,r,s,a,u,l,c,h="width"in t||"height"in t,d=this,p={},f=e.style,g=e.nodeType&&le(e),m=$.get(e,"fxshow");for(i in n.queue||(null==(s=T._queueHooks(e,"fx")).unqueued&&(s.unqueued=0,a=s.empty.fire,s.empty.fire=function(){s.unqueued||a()}),s.unqueued++,d.always((function(){d.always((function(){s.unqueued--,T.queue(e,"fx").length||s.empty.fire()}))}))),t)if(o=t[i],at.test(o)){if(delete t[i],r=r||"toggle"===o,o===(g?"hide":"show")){if("show"!==o||!m||void 0===m[i])continue;g=!0}p[i]=m&&m[i]||T.style(e,i)}if((u=!T.isEmptyObject(t))||!T.isEmptyObject(p))for(i in h&&1===e.nodeType&&(n.overflow=[f.overflow,f.overflowX,f.overflowY],null==(l=m&&m.display)&&(l=$.get(e,"display")),"none"===(c=T.css(e,"display"))&&(l?c=l:(pe([e],!0),l=e.style.display||l,c=T.css(e,"display"),pe([e]))),("inline"===c||"inline-block"===c&&null!=l)&&"none"===T.css(e,"float")&&(u||(d.done((function(){f.display=l})),null==l&&(c=f.display,l="none"===c?"":c)),f.display="inline-block")),n.overflow&&(f.overflow="hidden",d.always((function(){f.overflow=n.overflow[0],f.overflowX=n.overflow[1],f.overflowY=n.overflow[2]}))),u=!1,p)u||(m?"hidden"in m&&(g=m.hidden):m=$.access(e,"fxshow",{display:l}),r&&(m.hidden=!g),g&&pe([e],!0),d.done((function(){for(i in g||pe([e]),$.remove(e,"fxshow"),p)T.style(e,i,p[i])}))),u=dt(g?m[i]:0,i,d),i in m||(m[i]=u.start,g&&(u.end=u.start,u.start=0))}],prefilter:function(e,t){t?pt.prefilters.unshift(e):pt.prefilters.push(e)}}),T.speed=function(e,t,n){var i=e&&"object"==typeof e?T.extend({},e):{complete:n||!n&&t||_(e)&&e,duration:e,easing:n&&t||t&&!_(t)&&t};return T.fx.off?i.duration=0:"number"!=typeof i.duration&&(i.duration in T.fx.speeds?i.duration=T.fx.speeds[i.duration]:i.duration=T.fx.speeds._default),null!=i.queue&&!0!==i.queue||(i.queue="fx"),i.old=i.complete,i.complete=function(){_(i.old)&&i.old.call(this),i.queue&&T.dequeue(this,i.queue)},i},T.fn.extend({fadeTo:function(e,t,n,i){return this.filter(le).css("opacity",0).show().end().animate({opacity:t},e,n,i)},animate:function(e,t,n,i){var o=T.isEmptyObject(e),r=T.speed(t,n,i),s=function(){var t=pt(this,T.extend({},e),r);(o||$.get(this,"finish"))&&t.stop(!0)};return s.finish=s,o||!1===r.queue?this.each(s):this.queue(r.queue,s)},stop:function(e,t,n){var i=function(e){var t=e.stop;delete e.stop,t(n)};return"string"!=typeof e&&(n=t,t=e,e=void 0),t&&this.queue(e||"fx",[]),this.each((function(){var t=!0,o=null!=e&&e+"queueHooks",r=T.timers,s=$.get(this);if(o)s[o]&&s[o].stop&&i(s[o]);else for(o in s)s[o]&&s[o].stop&&ut.test(o)&&i(s[o]);for(o=r.length;o--;)r[o].elem!==this||null!=e&&r[o].queue!==e||(r[o].anim.stop(n),t=!1,r.splice(o,1));!t&&n||T.dequeue(this,e)}))},finish:function(e){return!1!==e&&(e=e||"fx"),this.each((function(){var t,n=$.get(this),i=n[e+"queue"],o=n[e+"queueHooks"],r=T.timers,s=i?i.length:0;for(n.finish=!0,T.queue(this,e,[]),o&&o.stop&&o.stop.call(this,!0),t=r.length;t--;)r[t].elem===this&&r[t].queue===e&&(r[t].anim.stop(!0),r.splice(t,1));for(t=0;t<s;t++)i[t]&&i[t].finish&&i[t].finish.call(this);delete n.finish}))}}),T.each(["toggle","show","hide"],(function(e,t){var n=T.fn[t];T.fn[t]=function(e,i,o){return null==e||"boolean"==typeof e?n.apply(this,arguments):this.animate(ht(t,!0),e,i,o)}})),T.each({slideDown:ht("show"),slideUp:ht("hide"),slideToggle:ht("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},(function(e,t){T.fn[e]=function(e,n,i){return this.animate(t,e,n,i)}})),T.timers=[],T.fx.tick=function(){var e,t=0,n=T.timers;for(rt=Date.now();t<n.length;t++)(e=n[t])()||n[t]!==e||n.splice(t--,1);n.length||T.fx.stop(),rt=void 0},T.fx.timer=function(e){T.timers.push(e),T.fx.start()},T.fx.interval=13,T.fx.start=function(){st||(st=!0,lt())},T.fx.stop=function(){st=null},T.fx.speeds={slow:600,fast:200,_default:400},T.fn.delay=function(e,t){return e=T.fx&&T.fx.speeds[e]||e,t=t||"fx",this.queue(t,(function(t,n){var o=i.setTimeout(t,e);n.stop=function(){i.clearTimeout(o)}}))},function(){var e=x.createElement("input"),t=x.createElement("select").appendChild(x.createElement("option"));e.type="checkbox",m.checkOn=""!==e.value,m.optSelected=t.selected,(e=x.createElement("input")).value="t",e.type="radio",m.radioValue="t"===e.value}();var ft,gt=T.expr.attrHandle;T.fn.extend({attr:function(e,t){return H(this,T.attr,e,t,arguments.length>1)},removeAttr:function(e){return this.each((function(){T.removeAttr(this,e)}))}}),T.extend({attr:function(e,t,n){var i,o,r=e.nodeType;if(3!==r&&8!==r&&2!==r)return void 0===e.getAttribute?T.prop(e,t,n):(1===r&&T.isXMLDoc(e)||(o=T.attrHooks[t.toLowerCase()]||(T.expr.match.bool.test(t)?ft:void 0)),void 0!==n?null===n?void T.removeAttr(e,t):o&&"set"in o&&void 0!==(i=o.set(e,n,t))?i:(e.setAttribute(t,n+""),n):o&&"get"in o&&null!==(i=o.get(e,t))?i:null==(i=T.find.attr(e,t))?void 0:i)},attrHooks:{type:{set:function(e,t){if(!m.radioValue&&"radio"===t&&M(e,"input")){var n=e.value;return e.setAttribute("type",t),n&&(e.value=n),t}}}},removeAttr:function(e,t){var n,i=0,o=t&&t.match(U);if(o&&1===e.nodeType)for(;n=o[i++];)e.removeAttribute(n)}}),ft={set:function(e,t,n){return!1===t?T.removeAttr(e,n):e.setAttribute(n,n),n}},T.each(T.expr.match.bool.source.match(/\w+/g),(function(e,t){var n=gt[t]||T.find.attr;gt[t]=function(e,t,i){var o,r,s=t.toLowerCase();return i||(r=gt[s],gt[s]=o,o=null!=n(e,t,i)?s:null,gt[s]=r),o}}));var mt=/^(?:input|select|textarea|button)$/i,_t=/^(?:a|area)$/i;function yt(e){return(e.match(U)||[]).join(" ")}function xt(e){return e.getAttribute&&e.getAttribute("class")||""}function wt(e){return Array.isArray(e)?e:"string"==typeof e&&e.match(U)||[]}T.fn.extend({prop:function(e,t){return H(this,T.prop,e,t,arguments.length>1)},removeProp:function(e){return this.each((function(){delete this[T.propFix[e]||e]}))}}),T.extend({prop:function(e,t,n){var i,o,r=e.nodeType;if(3!==r&&8!==r&&2!==r)return 1===r&&T.isXMLDoc(e)||(t=T.propFix[t]||t,o=T.propHooks[t]),void 0!==n?o&&"set"in o&&void 0!==(i=o.set(e,n,t))?i:e[t]=n:o&&"get"in o&&null!==(i=o.get(e,t))?i:e[t]},propHooks:{tabIndex:{get:function(e){var t=T.find.attr(e,"tabindex");return t?parseInt(t,10):mt.test(e.nodeName)||_t.test(e.nodeName)&&e.href?0:-1}}},propFix:{for:"htmlFor",class:"className"}}),m.optSelected||(T.propHooks.selected={get:function(e){var t=e.parentNode;return t&&t.parentNode&&t.parentNode.selectedIndex,null},set:function(e){var t=e.parentNode;t&&(t.selectedIndex,t.parentNode&&t.parentNode.selectedIndex)}}),T.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],(function(){T.propFix[this.toLowerCase()]=this})),T.fn.extend({addClass:function(e){var t,n,i,o,r,s;return _(e)?this.each((function(t){T(this).addClass(e.call(this,t,xt(this)))})):(t=wt(e)).length?this.each((function(){if(i=xt(this),n=1===this.nodeType&&" "+yt(i)+" "){for(r=0;r<t.length;r++)o=t[r],n.indexOf(" "+o+" ")<0&&(n+=o+" ");s=yt(n),i!==s&&this.setAttribute("class",s)}})):this},removeClass:function(e){var t,n,i,o,r,s;return _(e)?this.each((function(t){T(this).removeClass(e.call(this,t,xt(this)))})):arguments.length?(t=wt(e)).length?this.each((function(){if(i=xt(this),n=1===this.nodeType&&" "+yt(i)+" "){for(r=0;r<t.length;r++)for(o=t[r];n.indexOf(" "+o+" ")>-1;)n=n.replace(" "+o+" "," ");s=yt(n),i!==s&&this.setAttribute("class",s)}})):this:this.attr("class","")},toggleClass:function(e,t){var n,i,o,r,s=typeof e,a="string"===s||Array.isArray(e);return _(e)?this.each((function(n){T(this).toggleClass(e.call(this,n,xt(this),t),t)})):"boolean"==typeof t&&a?t?this.addClass(e):this.removeClass(e):(n=wt(e),this.each((function(){if(a)for(r=T(this),o=0;o<n.length;o++)i=n[o],r.hasClass(i)?r.removeClass(i):r.addClass(i);else void 0!==e&&"boolean"!==s||((i=xt(this))&&$.set(this,"__className__",i),this.setAttribute&&this.setAttribute("class",i||!1===e?"":$.get(this,"__className__")||""))})))},hasClass:function(e){var t,n,i=0;for(t=" "+e+" ";n=this[i++];)if(1===n.nodeType&&(" "+yt(xt(n))+" ").indexOf(t)>-1)return!0;return!1}});var vt=/\r/g;T.fn.extend({val:function(e){var t,n,i,o=this[0];return arguments.length?(i=_(e),this.each((function(n){var o;1===this.nodeType&&(null==(o=i?e.call(this,n,T(this).val()):e)?o="":"number"==typeof o?o+="":Array.isArray(o)&&(o=T.map(o,(function(e){return null==e?"":e+""}))),(t=T.valHooks[this.type]||T.valHooks[this.nodeName.toLowerCase()])&&"set"in t&&void 0!==t.set(this,o,"value")||(this.value=o))}))):o?(t=T.valHooks[o.type]||T.valHooks[o.nodeName.toLowerCase()])&&"get"in t&&void 0!==(n=t.get(o,"value"))?n:"string"==typeof(n=o.value)?n.replace(vt,""):null==n?"":n:void 0}}),T.extend({valHooks:{option:{get:function(e){var t=T.find.attr(e,"value");return null!=t?t:yt(T.text(e))}},select:{get:function(e){var t,n,i,o=e.options,r=e.selectedIndex,s="select-one"===e.type,a=s?null:[],u=s?r+1:o.length;for(i=r<0?u:s?r:0;i<u;i++)if(((n=o[i]).selected||i===r)&&!n.disabled&&(!n.parentNode.disabled||!M(n.parentNode,"optgroup"))){if(t=T(n).val(),s)return t;a.push(t)}return a},set:function(e,t){for(var n,i,o=e.options,r=T.makeArray(t),s=o.length;s--;)((i=o[s]).selected=T.inArray(T.valHooks.option.get(i),r)>-1)&&(n=!0);return n||(e.selectedIndex=-1),r}}}}),T.each(["radio","checkbox"],(function(){T.valHooks[this]={set:function(e,t){if(Array.isArray(t))return e.checked=T.inArray(T(e).val(),t)>-1}},m.checkOn||(T.valHooks[this].get=function(e){return null===e.getAttribute("value")?"on":e.value})})),m.focusin="onfocusin"in i;var bt=/^(?:focusinfocus|focusoutblur)$/,St=function(e){e.stopPropagation()};T.extend(T.event,{trigger:function(e,t,n,o){var r,s,a,u,l,c,h,d,f=[n||x],g=p.call(e,"type")?e.type:e,m=p.call(e,"namespace")?e.namespace.split("."):[];if(s=d=a=n=n||x,3!==n.nodeType&&8!==n.nodeType&&!bt.test(g+T.event.triggered)&&(g.indexOf(".")>-1&&(m=g.split("."),g=m.shift(),m.sort()),l=g.indexOf(":")<0&&"on"+g,(e=e[T.expando]?e:new T.Event(g,"object"==typeof e&&e)).isTrigger=o?2:3,e.namespace=m.join("."),e.rnamespace=e.namespace?new RegExp("(^|\\.)"+m.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,e.result=void 0,e.target||(e.target=n),t=null==t?[e]:T.makeArray(t,[e]),h=T.event.special[g]||{},o||!h.trigger||!1!==h.trigger.apply(n,t))){if(!o&&!h.noBubble&&!y(n)){for(u=h.delegateType||g,bt.test(u+g)||(s=s.parentNode);s;s=s.parentNode)f.push(s),a=s;a===(n.ownerDocument||x)&&f.push(a.defaultView||a.parentWindow||i)}for(r=0;(s=f[r++])&&!e.isPropagationStopped();)d=s,e.type=r>1?u:h.bindType||g,(c=($.get(s,"events")||Object.create(null))[e.type]&&$.get(s,"handle"))&&c.apply(s,t),(c=l&&s[l])&&c.apply&&Z(s)&&(e.result=c.apply(s,t),!1===e.result&&e.preventDefault());return e.type=g,o||e.isDefaultPrevented()||h._default&&!1!==h._default.apply(f.pop(),t)||!Z(n)||l&&_(n[g])&&!y(n)&&((a=n[l])&&(n[l]=null),T.event.triggered=g,e.isPropagationStopped()&&d.addEventListener(g,St),n[g](),e.isPropagationStopped()&&d.removeEventListener(g,St),T.event.triggered=void 0,a&&(n[l]=a)),e.result}},simulate:function(e,t,n){var i=T.extend(new T.Event,n,{type:e,isSimulated:!0});T.event.trigger(i,null,t)}}),T.fn.extend({trigger:function(e,t){return this.each((function(){T.event.trigger(e,t,this)}))},triggerHandler:function(e,t){var n=this[0];if(n)return T.event.trigger(e,t,n,!0)}}),m.focusin||T.each({focus:"focusin",blur:"focusout"},(function(e,t){var n=function(e){T.event.simulate(t,e.target,T.event.fix(e))};T.event.special[t]={setup:function(){var i=this.ownerDocument||this.document||this,o=$.access(i,t);o||i.addEventListener(e,n,!0),$.access(i,t,(o||0)+1)},teardown:function(){var i=this.ownerDocument||this.document||this,o=$.access(i,t)-1;o?$.access(i,t,o):(i.removeEventListener(e,n,!0),$.remove(i,t))}}}));var Tt=i.location,Et={guid:Date.now()},Ct=/\?/;T.parseXML=function(e){var t,n;if(!e||"string"!=typeof e)return null;try{t=(new i.DOMParser).parseFromString(e,"text/xml")}catch(e){}return n=t&&t.getElementsByTagName("parsererror")[0],t&&!n||T.error("Invalid XML: "+(n?T.map(n.childNodes,(function(e){return e.textContent})).join("\n"):e)),t};var Ot=/\[\]$/,Nt=/\r?\n/g,Ft=/^(?:submit|button|image|reset|file)$/i,Mt=/^(?:input|select|textarea|keygen)/i;function Dt(e,t,n,i){var o;if(Array.isArray(t))T.each(t,(function(t,o){n||Ot.test(e)?i(e,o):Dt(e+"["+("object"==typeof o&&null!=o?t:"")+"]",o,n,i)}));else if(n||"object"!==b(t))i(e,t);else for(o in t)Dt(e+"["+o+"]",t[o],n,i)}T.param=function(e,t){var n,i=[],o=function(e,t){var n=_(t)?t():t;i[i.length]=encodeURIComponent(e)+"="+encodeURIComponent(null==n?"":n)};if(null==e)return"";if(Array.isArray(e)||e.jquery&&!T.isPlainObject(e))T.each(e,(function(){o(this.name,this.value)}));else for(n in e)Dt(n,e[n],t,o);return i.join("&")},T.fn.extend({serialize:function(){return T.param(this.serializeArray())},serializeArray:function(){return this.map((function(){var e=T.prop(this,"elements");return e?T.makeArray(e):this})).filter((function(){var e=this.type;return this.name&&!T(this).is(":disabled")&&Mt.test(this.nodeName)&&!Ft.test(e)&&(this.checked||!me.test(e))})).map((function(e,t){var n=T(this).val();return null==n?null:Array.isArray(n)?T.map(n,(function(e){return{name:t.name,value:e.replace(Nt,"\r\n")}})):{name:t.name,value:n.replace(Nt,"\r\n")}})).get()}});var It=/%20/g,Rt=/#.*$/,Vt=/([?&])_=[^&]*/,Pt=/^(.*?):[ \t]*([^\r\n]*)$/gm,At=/^(?:GET|HEAD)$/,Lt=/^\/\//,Ut={},Bt={},Xt="*/".concat("*"),kt=x.createElement("a");function zt(e){return function(t,n){"string"!=typeof t&&(n=t,t="*");var i,o=0,r=t.toLowerCase().match(U)||[];if(_(n))for(;i=r[o++];)"+"===i[0]?(i=i.slice(1)||"*",(e[i]=e[i]||[]).unshift(n)):(e[i]=e[i]||[]).push(n)}}function jt(e,t,n,i){var o={},r=e===Bt;function s(a){var u;return o[a]=!0,T.each(e[a]||[],(function(e,a){var l=a(t,n,i);return"string"!=typeof l||r||o[l]?r?!(u=l):void 0:(t.dataTypes.unshift(l),s(l),!1)})),u}return s(t.dataTypes[0])||!o["*"]&&s("*")}function Gt(e,t){var n,i,o=T.ajaxSettings.flatOptions||{};for(n in t)void 0!==t[n]&&((o[n]?e:i||(i={}))[n]=t[n]);return i&&T.extend(!0,e,i),e}kt.href=Tt.href,T.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:Tt.href,type:"GET",isLocal:/^(?:about|app|app-storage|.+-extension|file|res|widget):$/.test(Tt.protocol),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":Xt,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/\bxml\b/,html:/\bhtml/,json:/\bjson\b/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":!0,"text json":JSON.parse,"text xml":T.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(e,t){return t?Gt(Gt(e,T.ajaxSettings),t):Gt(T.ajaxSettings,e)},ajaxPrefilter:zt(Ut),ajaxTransport:zt(Bt),ajax:function(e,t){"object"==typeof e&&(t=e,e=void 0),t=t||{};var n,o,r,s,a,u,l,c,h,d,p=T.ajaxSetup({},t),f=p.context||p,g=p.context&&(f.nodeType||f.jquery)?T(f):T.event,m=T.Deferred(),_=T.Callbacks("once memory"),y=p.statusCode||{},w={},v={},b="canceled",S={readyState:0,getResponseHeader:function(e){var t;if(l){if(!s)for(s={};t=Pt.exec(r);)s[t[1].toLowerCase()+" "]=(s[t[1].toLowerCase()+" "]||[]).concat(t[2]);t=s[e.toLowerCase()+" "]}return null==t?null:t.join(", ")},getAllResponseHeaders:function(){return l?r:null},setRequestHeader:function(e,t){return null==l&&(e=v[e.toLowerCase()]=v[e.toLowerCase()]||e,w[e]=t),this},overrideMimeType:function(e){return null==l&&(p.mimeType=e),this},statusCode:function(e){var t;if(e)if(l)S.always(e[S.status]);else for(t in e)y[t]=[y[t],e[t]];return this},abort:function(e){var t=e||b;return n&&n.abort(t),E(0,t),this}};if(m.promise(S),p.url=((e||p.url||Tt.href)+"").replace(Lt,Tt.protocol+"//"),p.type=t.method||t.type||p.method||p.type,p.dataTypes=(p.dataType||"*").toLowerCase().match(U)||[""],null==p.crossDomain){u=x.createElement("a");try{u.href=p.url,u.href=u.href,p.crossDomain=kt.protocol+"//"+kt.host!=u.protocol+"//"+u.host}catch(e){p.crossDomain=!0}}if(p.data&&p.processData&&"string"!=typeof p.data&&(p.data=T.param(p.data,p.traditional)),jt(Ut,p,t,S),l)return S;for(h in(c=T.event&&p.global)&&0==T.active++&&T.event.trigger("ajaxStart"),p.type=p.type.toUpperCase(),p.hasContent=!At.test(p.type),o=p.url.replace(Rt,""),p.hasContent?p.data&&p.processData&&0===(p.contentType||"").indexOf("application/x-www-form-urlencoded")&&(p.data=p.data.replace(It,"+")):(d=p.url.slice(o.length),p.data&&(p.processData||"string"==typeof p.data)&&(o+=(Ct.test(o)?"&":"?")+p.data,delete p.data),!1===p.cache&&(o=o.replace(Vt,"$1"),d=(Ct.test(o)?"&":"?")+"_="+Et.guid+++d),p.url=o+d),p.ifModified&&(T.lastModified[o]&&S.setRequestHeader("If-Modified-Since",T.lastModified[o]),T.etag[o]&&S.setRequestHeader("If-None-Match",T.etag[o])),(p.data&&p.hasContent&&!1!==p.contentType||t.contentType)&&S.setRequestHeader("Content-Type",p.contentType),S.setRequestHeader("Accept",p.dataTypes[0]&&p.accepts[p.dataTypes[0]]?p.accepts[p.dataTypes[0]]+("*"!==p.dataTypes[0]?", "+Xt+"; q=0.01":""):p.accepts["*"]),p.headers)S.setRequestHeader(h,p.headers[h]);if(p.beforeSend&&(!1===p.beforeSend.call(f,S,p)||l))return S.abort();if(b="abort",_.add(p.complete),S.done(p.success),S.fail(p.error),n=jt(Bt,p,t,S)){if(S.readyState=1,c&&g.trigger("ajaxSend",[S,p]),l)return S;p.async&&p.timeout>0&&(a=i.setTimeout((function(){S.abort("timeout")}),p.timeout));try{l=!1,n.send(w,E)}catch(e){if(l)throw e;E(-1,e)}}else E(-1,"No Transport");function E(e,t,s,u){var h,d,x,w,v,b=t;l||(l=!0,a&&i.clearTimeout(a),n=void 0,r=u||"",S.readyState=e>0?4:0,h=e>=200&&e<300||304===e,s&&(w=function(e,t,n){for(var i,o,r,s,a=e.contents,u=e.dataTypes;"*"===u[0];)u.shift(),void 0===i&&(i=e.mimeType||t.getResponseHeader("Content-Type"));if(i)for(o in a)if(a[o]&&a[o].test(i)){u.unshift(o);break}if(u[0]in n)r=u[0];else{for(o in n){if(!u[0]||e.converters[o+" "+u[0]]){r=o;break}s||(s=o)}r=r||s}if(r)return r!==u[0]&&u.unshift(r),n[r]}(p,S,s)),!h&&T.inArray("script",p.dataTypes)>-1&&T.inArray("json",p.dataTypes)<0&&(p.converters["text script"]=function(){}),w=function(e,t,n,i){var o,r,s,a,u,l={},c=e.dataTypes.slice();if(c[1])for(s in e.converters)l[s.toLowerCase()]=e.converters[s];for(r=c.shift();r;)if(e.responseFields[r]&&(n[e.responseFields[r]]=t),!u&&i&&e.dataFilter&&(t=e.dataFilter(t,e.dataType)),u=r,r=c.shift())if("*"===r)r=u;else if("*"!==u&&u!==r){if(!(s=l[u+" "+r]||l["* "+r]))for(o in l)if((a=o.split(" "))[1]===r&&(s=l[u+" "+a[0]]||l["* "+a[0]])){!0===s?s=l[o]:!0!==l[o]&&(r=a[0],c.unshift(a[1]));break}if(!0!==s)if(s&&e.throws)t=s(t);else try{t=s(t)}catch(e){return{state:"parsererror",error:s?e:"No conversion from "+u+" to "+r}}}return{state:"success",data:t}}(p,w,S,h),h?(p.ifModified&&((v=S.getResponseHeader("Last-Modified"))&&(T.lastModified[o]=v),(v=S.getResponseHeader("etag"))&&(T.etag[o]=v)),204===e||"HEAD"===p.type?b="nocontent":304===e?b="notmodified":(b=w.state,d=w.data,h=!(x=w.error))):(x=b,!e&&b||(b="error",e<0&&(e=0))),S.status=e,S.statusText=(t||b)+"",h?m.resolveWith(f,[d,b,S]):m.rejectWith(f,[S,b,x]),S.statusCode(y),y=void 0,c&&g.trigger(h?"ajaxSuccess":"ajaxError",[S,p,h?d:x]),_.fireWith(f,[S,b]),c&&(g.trigger("ajaxComplete",[S,p]),--T.active||T.event.trigger("ajaxStop")))}return S},getJSON:function(e,t,n){return T.get(e,t,n,"json")},getScript:function(e,t){return T.get(e,void 0,t,"script")}}),T.each(["get","post"],(function(e,t){T[t]=function(e,n,i,o){return _(n)&&(o=o||i,i=n,n=void 0),T.ajax(T.extend({url:e,type:t,dataType:o,data:n,success:i},T.isPlainObject(e)&&e))}})),T.ajaxPrefilter((function(e){var t;for(t in e.headers)"content-type"===t.toLowerCase()&&(e.contentType=e.headers[t]||"")})),T._evalUrl=function(e,t,n){return T.ajax({url:e,type:"GET",dataType:"script",cache:!0,async:!1,global:!1,converters:{"text script":function(){}},dataFilter:function(e){T.globalEval(e,t,n)}})},T.fn.extend({wrapAll:function(e){var t;return this[0]&&(_(e)&&(e=e.call(this[0])),t=T(e,this[0].ownerDocument).eq(0).clone(!0),this[0].parentNode&&t.insertBefore(this[0]),t.map((function(){for(var e=this;e.firstElementChild;)e=e.firstElementChild;return e})).append(this)),this},wrapInner:function(e){return _(e)?this.each((function(t){T(this).wrapInner(e.call(this,t))})):this.each((function(){var t=T(this),n=t.contents();n.length?n.wrapAll(e):t.append(e)}))},wrap:function(e){var t=_(e);return this.each((function(n){T(this).wrapAll(t?e.call(this,n):e)}))},unwrap:function(e){return this.parent(e).not("body").each((function(){T(this).replaceWith(this.childNodes)})),this}}),T.expr.pseudos.hidden=function(e){return!T.expr.pseudos.visible(e)},T.expr.pseudos.visible=function(e){return!!(e.offsetWidth||e.offsetHeight||e.getClientRects().length)},T.ajaxSettings.xhr=function(){try{return new i.XMLHttpRequest}catch(e){}};var Ht={0:200,1223:204},qt=T.ajaxSettings.xhr();m.cors=!!qt&&"withCredentials"in qt,m.ajax=qt=!!qt,T.ajaxTransport((function(e){var t,n;if(m.cors||qt&&!e.crossDomain)return{send:function(o,r){var s,a=e.xhr();if(a.open(e.type,e.url,e.async,e.username,e.password),e.xhrFields)for(s in e.xhrFields)a[s]=e.xhrFields[s];for(s in e.mimeType&&a.overrideMimeType&&a.overrideMimeType(e.mimeType),e.crossDomain||o["X-Requested-With"]||(o["X-Requested-With"]="XMLHttpRequest"),o)a.setRequestHeader(s,o[s]);t=function(e){return function(){t&&(t=n=a.onload=a.onerror=a.onabort=a.ontimeout=a.onreadystatechange=null,"abort"===e?a.abort():"error"===e?"number"!=typeof a.status?r(0,"error"):r(a.status,a.statusText):r(Ht[a.status]||a.status,a.statusText,"text"!==(a.responseType||"text")||"string"!=typeof a.responseText?{binary:a.response}:{text:a.responseText},a.getAllResponseHeaders()))}},a.onload=t(),n=a.onerror=a.ontimeout=t("error"),void 0!==a.onabort?a.onabort=n:a.onreadystatechange=function(){4===a.readyState&&i.setTimeout((function(){t&&n()}))},t=t("abort");try{a.send(e.hasContent&&e.data||null)}catch(e){if(t)throw e}},abort:function(){t&&t()}}})),T.ajaxPrefilter((function(e){e.crossDomain&&(e.contents.script=!1)})),T.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/\b(?:java|ecma)script\b/},converters:{"text script":function(e){return T.globalEval(e),e}}}),T.ajaxPrefilter("script",(function(e){void 0===e.cache&&(e.cache=!1),e.crossDomain&&(e.type="GET")})),T.ajaxTransport("script",(function(e){var t,n;if(e.crossDomain||e.scriptAttrs)return{send:function(i,o){t=T("<script>").attr(e.scriptAttrs||{}).prop({charset:e.scriptCharset,src:e.url}).on("load error",n=function(e){t.remove(),n=null,e&&o("error"===e.type?404:200,e.type)}),x.head.appendChild(t[0])},abort:function(){n&&n()}}}));var Wt,Yt=[],Kt=/(=)\?(?=&|$)|\?\?/;T.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var e=Yt.pop()||T.expando+"_"+Et.guid++;return this[e]=!0,e}}),T.ajaxPrefilter("json jsonp",(function(e,t,n){var o,r,s,a=!1!==e.jsonp&&(Kt.test(e.url)?"url":"string"==typeof e.data&&0===(e.contentType||"").indexOf("application/x-www-form-urlencoded")&&Kt.test(e.data)&&"data");if(a||"jsonp"===e.dataTypes[0])return o=e.jsonpCallback=_(e.jsonpCallback)?e.jsonpCallback():e.jsonpCallback,a?e[a]=e[a].replace(Kt,"$1"+o):!1!==e.jsonp&&(e.url+=(Ct.test(e.url)?"&":"?")+e.jsonp+"="+o),e.converters["script json"]=function(){return s||T.error(o+" was not called"),s[0]},e.dataTypes[0]="json",r=i[o],i[o]=function(){s=arguments},n.always((function(){void 0===r?T(i).removeProp(o):i[o]=r,e[o]&&(e.jsonpCallback=t.jsonpCallback,Yt.push(o)),s&&_(r)&&r(s[0]),s=r=void 0})),"script"})),m.createHTMLDocument=((Wt=x.implementation.createHTMLDocument("").body).innerHTML="<form></form><form></form>",2===Wt.childNodes.length),T.parseHTML=function(e,t,n){return"string"!=typeof e?[]:("boolean"==typeof t&&(n=t,t=!1),t||(m.createHTMLDocument?((i=(t=x.implementation.createHTMLDocument("")).createElement("base")).href=x.location.href,t.head.appendChild(i)):t=x),r=!n&&[],(o=D.exec(e))?[t.createElement(o[1])]:(o=Se([e],t,r),r&&r.length&&T(r).remove(),T.merge([],o.childNodes)));var i,o,r},T.fn.load=function(e,t,n){var i,o,r,s=this,a=e.indexOf(" ");return a>-1&&(i=yt(e.slice(a)),e=e.slice(0,a)),_(t)?(n=t,t=void 0):t&&"object"==typeof t&&(o="POST"),s.length>0&&T.ajax({url:e,type:o||"GET",dataType:"html",data:t}).done((function(e){r=arguments,s.html(i?T("<div>").append(T.parseHTML(e)).find(i):e)})).always(n&&function(e,t){s.each((function(){n.apply(this,r||[e.responseText,t,e])}))}),this},T.expr.pseudos.animated=function(e){return T.grep(T.timers,(function(t){return e===t.elem})).length},T.offset={setOffset:function(e,t,n){var i,o,r,s,a,u,l=T.css(e,"position"),c=T(e),h={};"static"===l&&(e.style.position="relative"),a=c.offset(),r=T.css(e,"top"),u=T.css(e,"left"),("absolute"===l||"fixed"===l)&&(r+u).indexOf("auto")>-1?(s=(i=c.position()).top,o=i.left):(s=parseFloat(r)||0,o=parseFloat(u)||0),_(t)&&(t=t.call(e,n,T.extend({},a))),null!=t.top&&(h.top=t.top-a.top+s),null!=t.left&&(h.left=t.left-a.left+o),"using"in t?t.using.call(e,h):c.css(h)}},T.fn.extend({offset:function(e){if(arguments.length)return void 0===e?this:this.each((function(t){T.offset.setOffset(this,e,t)}));var t,n,i=this[0];return i?i.getClientRects().length?(t=i.getBoundingClientRect(),n=i.ownerDocument.defaultView,{top:t.top+n.pageYOffset,left:t.left+n.pageXOffset}):{top:0,left:0}:void 0},position:function(){if(this[0]){var e,t,n,i=this[0],o={top:0,left:0};if("fixed"===T.css(i,"position"))t=i.getBoundingClientRect();else{for(t=this.offset(),n=i.ownerDocument,e=i.offsetParent||n.documentElement;e&&(e===n.body||e===n.documentElement)&&"static"===T.css(e,"position");)e=e.parentNode;e&&e!==i&&1===e.nodeType&&((o=T(e).offset()).top+=T.css(e,"borderTopWidth",!0),o.left+=T.css(e,"borderLeftWidth",!0))}return{top:t.top-o.top-T.css(i,"marginTop",!0),left:t.left-o.left-T.css(i,"marginLeft",!0)}}},offsetParent:function(){return this.map((function(){for(var e=this.offsetParent;e&&"static"===T.css(e,"position");)e=e.offsetParent;return e||se}))}}),T.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},(function(e,t){var n="pageYOffset"===t;T.fn[e]=function(i){return H(this,(function(e,i,o){var r;if(y(e)?r=e:9===e.nodeType&&(r=e.defaultView),void 0===o)return r?r[t]:e[i];r?r.scrollTo(n?r.pageXOffset:o,n?o:r.pageYOffset):e[i]=o}),e,i,arguments.length)}})),T.each(["top","left"],(function(e,t){T.cssHooks[t]=We(m.pixelPosition,(function(e,n){if(n)return n=qe(e,t),Xe.test(n)?T(e).position()[t]+"px":n}))})),T.each({Height:"height",Width:"width"},(function(e,t){T.each({padding:"inner"+e,content:t,"":"outer"+e},(function(n,i){T.fn[i]=function(o,r){var s=arguments.length&&(n||"boolean"!=typeof o),a=n||(!0===o||!0===r?"margin":"border");return H(this,(function(t,n,o){var r;return y(t)?0===i.indexOf("outer")?t["inner"+e]:t.document.documentElement["client"+e]:9===t.nodeType?(r=t.documentElement,Math.max(t.body["scroll"+e],r["scroll"+e],t.body["offset"+e],r["offset"+e],r["client"+e])):void 0===o?T.css(t,n,a):T.style(t,n,o,a)}),t,s?o:void 0,s)}}))})),T.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],(function(e,t){T.fn[t]=function(e){return this.on(t,e)}})),T.fn.extend({bind:function(e,t,n){return this.on(e,null,t,n)},unbind:function(e,t){return this.off(e,null,t)},delegate:function(e,t,n,i){return this.on(t,e,n,i)},undelegate:function(e,t,n){return 1===arguments.length?this.off(e,"**"):this.off(t,e||"**",n)},hover:function(e,t){return this.mouseenter(e).mouseleave(t||e)}}),T.each("blur focus focusin focusout resize scroll click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup contextmenu".split(" "),(function(e,t){T.fn[t]=function(e,n){return arguments.length>0?this.on(t,null,e,n):this.trigger(t)}}));var Zt=/^[\s\uFEFF\xA0]+|([^\s\uFEFF\xA0])[\s\uFEFF\xA0]+$/g;T.proxy=function(e,t){var n,i,o;if("string"==typeof t&&(n=e[t],t=e,e=n),_(e))return i=a.call(arguments,2),o=function(){return e.apply(t||this,i.concat(a.call(arguments)))},o.guid=e.guid=e.guid||T.guid++,o},T.holdReady=function(e){e?T.readyWait++:T.ready(!0)},T.isArray=Array.isArray,T.parseJSON=JSON.parse,T.nodeName=M,T.isFunction=_,T.isWindow=y,T.camelCase=K,T.type=b,T.now=Date.now,T.isNumeric=function(e){var t=T.type(e);return("number"===t||"string"===t)&&!isNaN(e-parseFloat(e))},T.trim=function(e){return null==e?"":(e+"").replace(Zt,"$1")},void 0===(n=function(){return T}.apply(t,[]))||(e.exports=n);var Qt=i.jQuery,$t=i.$;return T.noConflict=function(e){return i.$===T&&(i.$=$t),e&&i.jQuery===T&&(i.jQuery=Qt),T},void 0===o&&(i.jQuery=i.$=T),T}))},238:e=>{var t={DEBUG:!1,assert:function(e,n){if(t.DEBUG&&!e)throw new Error("Assertion failed"+(n?": "+n:""))},GLU_TESS_MAX_COORD:1e150,TRUE_PROJECT:!1,GLU_TESS_DEFAULT_TOLERANCE:0,windingRule:{GLU_TESS_WINDING_ODD:100130,GLU_TESS_WINDING_NONZERO:100131,GLU_TESS_WINDING_POSITIVE:100132,GLU_TESS_WINDING_NEGATIVE:100133,GLU_TESS_WINDING_ABS_GEQ_TWO:100134},primitiveType:{GL_LINE_LOOP:2,GL_TRIANGLES:4,GL_TRIANGLE_STRIP:5,GL_TRIANGLE_FAN:6},errorType:{GLU_TESS_MISSING_BEGIN_POLYGON:100151,GLU_TESS_MISSING_END_POLYGON:100153,GLU_TESS_MISSING_BEGIN_CONTOUR:100152,GLU_TESS_MISSING_END_CONTOUR:100154,GLU_TESS_COORD_TOO_LARGE:100155,GLU_TESS_NEED_COMBINE_CALLBACK:100156},gluEnum:{GLU_TESS_BEGIN:100100,GLU_TESS_VERTEX:100101,GLU_TESS_END:100102,GLU_TESS_ERROR:100103,GLU_TESS_EDGE_FLAG:100104,GLU_TESS_COMBINE:100105,GLU_TESS_BEGIN_DATA:100106,GLU_TESS_VERTEX_DATA:100107,GLU_TESS_END_DATA:100108,GLU_TESS_ERROR_DATA:100109,GLU_TESS_EDGE_FLAG_DATA:100110,GLU_TESS_COMBINE_DATA:100111,GLU_TESS_MESH:100112,GLU_TESS_TOLERANCE:100142,GLU_TESS_WINDING_RULE:100140,GLU_TESS_BOUNDARY_ONLY:100141,GLU_INVALID_ENUM:100900,GLU_INVALID_VALUE:100901}};t.PQHandle,t.geom={},t.geom.vertEq=function(e,t){return e.s===t.s&&e.t===t.t},t.geom.vertLeq=function(e,t){return e.s<t.s||e.s===t.s&&e.t<=t.t},t.geom.edgeEval=function(e,t,n){var i=t.s-e.s,o=n.s-t.s;return i+o>0?i<o?t.t-e.t+(e.t-n.t)*(i/(i+o)):t.t-n.t+(n.t-e.t)*(o/(i+o)):0},t.geom.edgeSign=function(e,t,n){var i=t.s-e.s,o=n.s-t.s;return i+o>0?(t.t-n.t)*i+(t.t-e.t)*o:0},t.geom.transLeq=function(e,t){return e.t<t.t||e.t===t.t&&e.s<=t.s},t.geom.transEval=function(e,t,n){var i=t.t-e.t,o=n.t-t.t;return i+o>0?i<o?t.s-e.s+(e.s-n.s)*(i/(i+o)):t.s-n.s+(n.s-e.s)*(o/(i+o)):0},t.geom.transSign=function(e,t,n){var i=t.t-e.t,o=n.t-t.t;return i+o>0?(t.s-n.s)*i+(t.s-e.s)*o:0},t.geom.edgeGoesLeft=function(e){return t.geom.vertLeq(e.dst(),e.org)},t.geom.edgeGoesRight=function(e){return t.geom.vertLeq(e.org,e.dst())},t.geom.vertL1dist=function(e,t){return Math.abs(e.s-t.s)+Math.abs(e.t-t.t)},t.geom.vertCCW=function(e,t,n){return e.s*(t.t-n.t)+t.s*(n.t-e.t)+n.s*(e.t-t.t)>=0},t.geom.interpolate_=function(e,t,n,i){return(e=e<0?0:e)<=(n=n<0?0:n)?0===n?(t+i)/2:t+e/(e+n)*(i-t):i+n/(e+n)*(t-i)},t.geom.edgeIntersect=function(e,n,i,o,r){var s,a,u;t.geom.vertLeq(e,n)||(u=e,e=n,n=u),t.geom.vertLeq(i,o)||(u=i,i=o,o=u),t.geom.vertLeq(e,i)||(u=e,e=i,i=u,u=n,n=o,o=u),t.geom.vertLeq(i,n)?t.geom.vertLeq(n,o)?((s=t.geom.edgeEval(e,i,n))+(a=t.geom.edgeEval(i,n,o))<0&&(s=-s,a=-a),r.s=t.geom.interpolate_(s,i.s,a,n.s)):((s=t.geom.edgeSign(e,i,n))+(a=-t.geom.edgeSign(e,o,n))<0&&(s=-s,a=-a),r.s=t.geom.interpolate_(s,i.s,a,o.s)):r.s=(i.s+n.s)/2,t.geom.transLeq(e,n)||(u=e,e=n,n=u),t.geom.transLeq(i,o)||(u=i,i=o,o=u),t.geom.transLeq(e,i)||(u=e,e=i,i=u,u=n,n=o,o=u),t.geom.transLeq(i,n)?t.geom.transLeq(n,o)?((s=t.geom.transEval(e,i,n))+(a=t.geom.transEval(i,n,o))<0&&(s=-s,a=-a),r.t=t.geom.interpolate_(s,i.t,a,n.t)):((s=t.geom.transSign(e,i,n))+(a=-t.geom.transSign(e,o,n))<0&&(s=-s,a=-a),r.t=t.geom.interpolate_(s,i.t,a,o.t)):r.t=(i.t+n.t)/2},t.mesh={},t.mesh.makeEdge=function(e){var n=t.mesh.makeEdgePair_(e.eHead);return t.mesh.makeVertex_(n,e.vHead),t.mesh.makeVertex_(n.sym,e.vHead),t.mesh.makeFace_(n,e.fHead),n},t.mesh.meshSplice=function(e,n){var i=!1,o=!1;e!==n&&(n.org!==e.org&&(o=!0,t.mesh.killVertex_(n.org,e.org)),n.lFace!==e.lFace&&(i=!0,t.mesh.killFace_(n.lFace,e.lFace)),t.mesh.splice_(n,e),o||(t.mesh.makeVertex_(n,e.org),e.org.anEdge=e),i||(t.mesh.makeFace_(n,e.lFace),e.lFace.anEdge=e))},t.mesh.deleteEdge=function(e){var n=e.sym,i=!1;e.lFace!==e.rFace()&&(i=!0,t.mesh.killFace_(e.lFace,e.rFace())),e.oNext===e?t.mesh.killVertex_(e.org,null):(e.rFace().anEdge=e.oPrev(),e.org.anEdge=e.oNext,t.mesh.splice_(e,e.oPrev()),i||t.mesh.makeFace_(e,e.lFace)),n.oNext===n?(t.mesh.killVertex_(n.org,null),t.mesh.killFace_(n.lFace,null)):(e.lFace.anEdge=n.oPrev(),n.org.anEdge=n.oNext,t.mesh.splice_(n,n.oPrev())),t.mesh.killEdge_(e)},t.mesh.addEdgeVertex=function(e){var n=t.mesh.makeEdgePair_(e),i=n.sym;return t.mesh.splice_(n,e.lNext),n.org=e.dst(),t.mesh.makeVertex_(i,n.org),n.lFace=i.lFace=e.lFace,n},t.mesh.splitEdge=function(e){var n=t.mesh.addEdgeVertex(e).sym;return t.mesh.splice_(e.sym,e.sym.oPrev()),t.mesh.splice_(e.sym,n),e.sym.org=n.org,n.dst().anEdge=n.sym,n.sym.lFace=e.rFace(),n.winding=e.winding,n.sym.winding=e.sym.winding,n},t.mesh.connect=function(e,n){var i=!1,o=t.mesh.makeEdgePair_(e),r=o.sym;return n.lFace!==e.lFace&&(i=!0,t.mesh.killFace_(n.lFace,e.lFace)),t.mesh.splice_(o,e.lNext),t.mesh.splice_(r,n),o.org=e.dst(),r.org=n.org,o.lFace=r.lFace=e.lFace,e.lFace.anEdge=r,i||t.mesh.makeFace_(o,e.lFace),o},t.mesh.zapFace=function(e){var n,i=e.anEdge,o=i.lNext;do{if(o=(n=o).lNext,n.lFace=null,null===n.rFace()){n.oNext===n?t.mesh.killVertex_(n.org,null):(n.org.anEdge=n.oNext,t.mesh.splice_(n,n.oPrev()));var r=n.sym;r.oNext===r?t.mesh.killVertex_(r.org,null):(r.org.anEdge=r.oNext,t.mesh.splice_(r,r.oPrev())),t.mesh.killEdge_(n)}}while(n!==i);var s=e.prev,a=e.next;a.prev=s,s.next=a},t.mesh.meshUnion=function(e,t){var n=e.fHead,i=e.vHead,o=e.eHead,r=t.fHead,s=t.vHead,a=t.eHead;return r.next!==r&&(n.prev.next=r.next,r.next.prev=n.prev,r.prev.next=n,n.prev=r.prev),s.next!==s&&(i.prev.next=s.next,s.next.prev=i.prev,s.prev.next=i,i.prev=s.prev),a.next!==a&&(o.sym.next.sym.next=a.next,a.next.sym.next=o.sym.next,a.sym.next.sym.next=o,o.sym.next=a.sym.next),e},t.mesh.deleteMesh=function(e){},t.mesh.makeEdgePair_=function(e){var n=new t.GluHalfEdge,i=new t.GluHalfEdge,o=e.sym.next;return i.next=o,o.sym.next=n,n.next=e,e.sym.next=i,n.sym=i,n.oNext=n,n.lNext=i,i.sym=n,i.oNext=i,i.lNext=n,n},t.mesh.splice_=function(e,t){var n=e.oNext,i=t.oNext;n.sym.lNext=t,i.sym.lNext=e,e.oNext=i,t.oNext=n},t.mesh.makeVertex_=function(e,n){var i=n.prev,o=new t.GluVertex(n,i);i.next=o,n.prev=o,o.anEdge=e;var r=e;do{r.org=o,r=r.oNext}while(r!==e)},t.mesh.makeFace_=function(e,n){var i=n.prev,o=new t.GluFace(n,i);i.next=o,n.prev=o,o.anEdge=e,o.inside=n.inside;var r=e;do{r.lFace=o,r=r.lNext}while(r!==e)},t.mesh.killEdge_=function(e){var t=e.next,n=e.sym.next;t.sym.next=n,n.sym.next=t},t.mesh.killVertex_=function(e,t){var n=e.anEdge,i=n;do{i.org=t,i=i.oNext}while(i!==n);var o=e.prev,r=e.next;r.prev=o,o.next=r},t.mesh.killFace_=function(e,t){var n=e.anEdge,i=n;do{i.lFace=t,i=i.lNext}while(i!==n);var o=e.prev,r=e.next;r.prev=o,o.next=r},t.normal={},t.normal.S_UNIT_X_=1,t.normal.S_UNIT_Y_=0,t.normal.projectPolygon=function(e,n,i,o){var r=!1,s=[n,i,o];0===n&&0===i&&0===o&&(t.normal.computeNormal_(e,s),r=!0);var a,u=t.normal.longAxis_(s),l=e.mesh.vHead;if(t.TRUE_PROJECT){t.normal.normalize_(s);var c=[0,0,0],h=[0,0,0];c[u]=0,c[(u+1)%3]=t.normal.S_UNIT_X_,c[(u+2)%3]=t.normal.S_UNIT_Y_;var d=t.normal.dot_(c,s);for(c[0]-=d*s[0],c[1]-=d*s[1],c[2]-=d*s[2],t.normal.normalize_(c),h[0]=s[1]*c[2]-s[2]*c[1],h[1]=s[2]*c[0]-s[0]*c[2],h[2]=s[0]*c[1]-s[1]*c[0],t.normal.normalize_(h),a=l.next;a!==l;a=a.next)a.s=t.normal.dot_(a.coords,c),a.t=t.normal.dot_(a.coords,h)}else{var p=(u+1)%3,f=(u+2)%3,g=s[u]>0?1:-1;for(a=l.next;a!==l;a=a.next)a.s=a.coords[p],a.t=g*a.coords[f]}r&&t.normal.checkOrientation_(e)},t.normal.dot_=function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]},t.normal.normalize_=function(e){var t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2];t=Math.sqrt(t),e[0]/=t,e[1]/=t,e[2]/=t},t.normal.longAxis_=function(e){var t=0;return Math.abs(e[1])>Math.abs(e[0])&&(t=1),Math.abs(e[2])>Math.abs(e[t])&&(t=2),t},t.normal.computeNormal_=function(e,n){var i,o=[-2*t.GLU_TESS_MAX_COORD,-2*t.GLU_TESS_MAX_COORD,-2*t.GLU_TESS_MAX_COORD],r=[2*t.GLU_TESS_MAX_COORD,2*t.GLU_TESS_MAX_COORD,2*t.GLU_TESS_MAX_COORD],s=[],a=[],u=e.mesh.vHead;for(i=u.next;i!==u;i=i.next)for(var l=0;l<3;++l){var c=i.coords[l];c<r[l]&&(r[l]=c,a[l]=i),c>o[l]&&(o[l]=c,s[l]=i)}var h=0;if(o[1]-r[1]>o[0]-r[0]&&(h=1),o[2]-r[2]>o[h]-r[h]&&(h=2),r[h]>=o[h])return n[0]=0,n[1]=0,void(n[2]=1);var d=0,p=a[h],f=s[h],g=[0,0,0],m=[p.coords[0]-f.coords[0],p.coords[1]-f.coords[1],p.coords[2]-f.coords[2]],_=[0,0,0];for(i=u.next;i!==u;i=i.next){_[0]=i.coords[0]-f.coords[0],_[1]=i.coords[1]-f.coords[1],_[2]=i.coords[2]-f.coords[2],g[0]=m[1]*_[2]-m[2]*_[1],g[1]=m[2]*_[0]-m[0]*_[2],g[2]=m[0]*_[1]-m[1]*_[0];var y=g[0]*g[0]+g[1]*g[1]+g[2]*g[2];y>d&&(d=y,n[0]=g[0],n[1]=g[1],n[2]=g[2])}d<=0&&(n[0]=n[1]=n[2]=0,n[t.normal.longAxis_(m)]=1)},t.normal.checkOrientation_=function(e){for(var t=0,n=e.mesh.fHead,i=n.next;i!==n;i=i.next){var o=i.anEdge;if(!(o.winding<=0))do{t+=(o.org.s-o.dst().s)*(o.org.t+o.dst().t),o=o.lNext}while(o!==i.anEdge)}if(t<0)for(var r=e.mesh.vHead,s=r.next;s!==r;s=s.next)s.t=-s.t},t.render={},t.render.renderMesh=function(e,n,i){for(var o=!1,r=-1,s=n.fHead.prev;s!==n.fHead;s=s.prev)if(s.inside){o||(e.callBeginCallback(t.primitiveType.GL_TRIANGLES),o=!0);var a=s.anEdge;do{if(i){var u=a.rFace().inside?0:1;r!==u&&(r=u,e.callEdgeFlagCallback(!!r))}e.callVertexCallback(a.org.data),a=a.lNext}while(a!==s.anEdge)}o&&e.callEndCallback()},t.render.renderBoundary=function(e,n){for(var i=n.fHead.next;i!==n.fHead;i=i.next)if(i.inside){e.callBeginCallback(t.primitiveType.GL_LINE_LOOP);var o=i.anEdge;do{e.callVertexCallback(o.org.data),o=o.lNext}while(o!==i.anEdge);e.callEndCallback()}},t.sweep={},t.sweep.SENTINEL_COORD_=4*t.GLU_TESS_MAX_COORD,t.sweep.TOLERANCE_NONZERO_=!1,t.sweep.computeInterior=function(e){var n;for(e.fatalError=!1,t.sweep.removeDegenerateEdges_(e),t.sweep.initPriorityQ_(e),t.sweep.initEdgeDict_(e);null!==(n=e.pq.extractMin());){for(;;){var i=e.pq.minimum();if(null===i||!t.geom.vertEq(i,n))break;i=e.pq.extractMin(),t.sweep.spliceMergeVertices_(e,n.anEdge,i.anEdge)}t.sweep.sweepEvent_(e,n)}var o=e.dict.getMin().getKey();e.event=o.eUp.org,t.sweep.doneEdgeDict_(e),t.sweep.donePriorityQ_(e),t.sweep.removeDegenerateFaces_(e.mesh),e.mesh.checkMesh()},t.sweep.addWinding_=function(e,t){e.winding+=t.winding,e.sym.winding+=t.sym.winding},t.sweep.edgeLeq_=function(e,n,i){var o=e.event,r=n.eUp,s=i.eUp;return r.dst()===o?s.dst()===o?t.geom.vertLeq(r.org,s.org)?t.geom.edgeSign(s.dst(),r.org,s.org)<=0:t.geom.edgeSign(r.dst(),s.org,r.org)>=0:t.geom.edgeSign(s.dst(),o,s.org)<=0:s.dst()===o?t.geom.edgeSign(r.dst(),o,r.org)>=0:t.geom.edgeEval(r.dst(),o,r.org)>=t.geom.edgeEval(s.dst(),o,s.org)},t.sweep.deleteRegion_=function(e,t){t.fixUpperEdge,t.eUp.activeRegion=null,e.dict.deleteNode(t.nodeUp),t.nodeUp=null},t.sweep.fixUpperEdge_=function(e,n){t.mesh.deleteEdge(e.eUp),e.fixUpperEdge=!1,e.eUp=n,n.activeRegion=e},t.sweep.topLeftRegion_=function(e){var n=e.eUp.org;do{e=e.regionAbove()}while(e.eUp.org===n);if(e.fixUpperEdge){var i=t.mesh.connect(e.regionBelow().eUp.sym,e.eUp.lNext);t.sweep.fixUpperEdge_(e,i),e=e.regionAbove()}return e},t.sweep.topRightRegion_=function(e){var t=e.eUp.dst();do{e=e.regionAbove()}while(e.eUp.dst()===t);return e},t.sweep.addRegionBelow_=function(e,n,i){var o=new t.ActiveRegion;return o.eUp=i,o.nodeUp=e.dict.insertBefore(n.nodeUp,o),i.activeRegion=o,o},t.sweep.isWindingInside_=function(e,n){switch(e.windingRule){case t.windingRule.GLU_TESS_WINDING_ODD:return 0!=(1&n);case t.windingRule.GLU_TESS_WINDING_NONZERO:return 0!==n;case t.windingRule.GLU_TESS_WINDING_POSITIVE:return n>0;case t.windingRule.GLU_TESS_WINDING_NEGATIVE:return n<0;case t.windingRule.GLU_TESS_WINDING_ABS_GEQ_TWO:return n>=2||n<=-2}return!1},t.sweep.computeWinding_=function(e,n){n.windingNumber=n.regionAbove().windingNumber+n.eUp.winding,n.inside=t.sweep.isWindingInside_(e,n.windingNumber)},t.sweep.finishRegion_=function(e,n){var i=n.eUp,o=i.lFace;o.inside=n.inside,o.anEdge=i,t.sweep.deleteRegion_(e,n)},t.sweep.finishLeftRegions_=function(e,n,i){for(var o=n,r=n.eUp;o!==i;){o.fixUpperEdge=!1;var s=o.regionBelow(),a=s.eUp;if(a.org!==r.org){if(!s.fixUpperEdge){t.sweep.finishRegion_(e,o);break}a=t.mesh.connect(r.lPrev(),a.sym),t.sweep.fixUpperEdge_(s,a)}r.oNext!==a&&(t.mesh.meshSplice(a.oPrev(),a),t.mesh.meshSplice(r,a)),t.sweep.finishRegion_(e,o),r=s.eUp,o=s}return r},t.sweep.addRightEdges_=function(e,n,i,o,r,s){var a=!0,u=i;do{t.sweep.addRegionBelow_(e,n,u.sym),u=u.oNext}while(u!==o);null===r&&(r=n.regionBelow().eUp.rPrev());for(var l,c=n,h=r;(u=(l=c.regionBelow()).eUp.sym).org===h.org;)u.oNext!==h&&(t.mesh.meshSplice(u.oPrev(),u),t.mesh.meshSplice(h.oPrev(),u)),l.windingNumber=c.windingNumber-u.winding,l.inside=t.sweep.isWindingInside_(e,l.windingNumber),c.dirty=!0,!a&&t.sweep.checkForRightSplice_(e,c)&&(t.sweep.addWinding_(u,h),t.sweep.deleteRegion_(e,c),t.mesh.deleteEdge(h)),a=!1,c=l,h=u;c.dirty=!0,s&&t.sweep.walkDirtyRegions_(e,c)},t.sweep.callCombine_=function(e,n,i,o,r){var s=[n.coords[0],n.coords[1],n.coords[2]];n.data=null,n.data=e.callCombineCallback(s,i,o),null===n.data&&(r?e.fatalError||(e.callErrorCallback(t.errorType.GLU_TESS_NEED_COMBINE_CALLBACK),e.fatalError=!0):n.data=i[0])},t.sweep.spliceMergeVertices_=function(e,n,i){var o=[null,null,null,null];o[0]=n.org.data,o[1]=i.org.data,t.sweep.callCombine_(e,n.org,o,[.5,.5,0,0],!1),t.mesh.meshSplice(n,i)},t.sweep.vertexWeights_=function(e,n,i,o,r){var s=t.geom.vertL1dist(n,e),a=t.geom.vertL1dist(i,e),u=r,l=r+1;o[u]=.5*a/(s+a),o[l]=.5*s/(s+a),e.coords[0]+=o[u]*n.coords[0]+o[l]*i.coords[0],e.coords[1]+=o[u]*n.coords[1]+o[l]*i.coords[1],e.coords[2]+=o[u]*n.coords[2]+o[l]*i.coords[2]},t.sweep.getIntersectData_=function(e,n,i,o,r,s){var a=[0,0,0,0],u=[i.data,o.data,r.data,s.data];n.coords[0]=n.coords[1]=n.coords[2]=0,t.sweep.vertexWeights_(n,i,o,a,0),t.sweep.vertexWeights_(n,r,s,a,2),t.sweep.callCombine_(e,n,u,a,!0)},t.sweep.checkForRightSplice_=function(e,n){var i=n.regionBelow(),o=n.eUp,r=i.eUp;if(t.geom.vertLeq(o.org,r.org)){if(t.geom.edgeSign(r.dst(),o.org,r.org)>0)return!1;t.geom.vertEq(o.org,r.org)?o.org!==r.org&&(e.pq.remove(o.org.pqHandle),t.sweep.spliceMergeVertices_(e,r.oPrev(),o)):(t.mesh.splitEdge(r.sym),t.mesh.meshSplice(o,r.oPrev()),n.dirty=i.dirty=!0)}else{if(t.geom.edgeSign(o.dst(),r.org,o.org)<0)return!1;n.regionAbove().dirty=n.dirty=!0,t.mesh.splitEdge(o.sym),t.mesh.meshSplice(r.oPrev(),o)}return!0},t.sweep.checkForLeftSplice_=function(e,n){var i,o=n.regionBelow(),r=n.eUp,s=o.eUp;if(t.geom.vertLeq(r.dst(),s.dst())){if(t.geom.edgeSign(r.dst(),s.dst(),r.org)<0)return!1;n.regionAbove().dirty=n.dirty=!0,i=t.mesh.splitEdge(r),t.mesh.meshSplice(s.sym,i),i.lFace.inside=n.inside}else{if(t.geom.edgeSign(s.dst(),r.dst(),s.org)>0)return!1;n.dirty=o.dirty=!0,i=t.mesh.splitEdge(s),t.mesh.meshSplice(r.lNext,s.sym),i.rFace().inside=n.inside}return!0},t.sweep.checkForIntersect_=function(e,n){var i=n.regionBelow(),o=n.eUp,r=i.eUp,s=o.org,a=r.org,u=o.dst(),l=r.dst(),c=new t.GluVertex;if(s===a)return!1;if(Math.min(s.t,u.t)>Math.max(a.t,l.t))return!1;if(t.geom.vertLeq(s,a)){if(t.geom.edgeSign(l,s,a)>0)return!1}else if(t.geom.edgeSign(u,a,s)<0)return!1;t.geom.edgeIntersect(u,s,l,a,c),t.geom.vertLeq(c,e.event)&&(c.s=e.event.s,c.t=e.event.t);var h=t.geom.vertLeq(s,a)?s:a;if(t.geom.vertLeq(h,c)&&(c.s=h.s,c.t=h.t),t.geom.vertEq(c,s)||t.geom.vertEq(c,a))return t.sweep.checkForRightSplice_(e,n),!1;if(!t.geom.vertEq(u,e.event)&&t.geom.edgeSign(u,e.event,c)>=0||!t.geom.vertEq(l,e.event)&&t.geom.edgeSign(l,e.event,c)<=0){if(l===e.event)return t.mesh.splitEdge(o.sym),t.mesh.meshSplice(r.sym,o),o=(n=t.sweep.topLeftRegion_(n)).regionBelow().eUp,t.sweep.finishLeftRegions_(e,n.regionBelow(),i),t.sweep.addRightEdges_(e,n,o.oPrev(),o,o,!0),!0;if(u===e.event){t.mesh.splitEdge(r.sym),t.mesh.meshSplice(o.lNext,r.oPrev()),i=n;var d=(n=t.sweep.topRightRegion_(n)).regionBelow().eUp.rPrev();return i.eUp=r.oPrev(),r=t.sweep.finishLeftRegions_(e,i,null),t.sweep.addRightEdges_(e,n,r.oNext,o.rPrev(),d,!0),!0}return t.geom.edgeSign(u,e.event,c)>=0&&(n.regionAbove().dirty=n.dirty=!0,t.mesh.splitEdge(o.sym),o.org.s=e.event.s,o.org.t=e.event.t),t.geom.edgeSign(l,e.event,c)<=0&&(n.dirty=i.dirty=!0,t.mesh.splitEdge(r.sym),r.org.s=e.event.s,r.org.t=e.event.t),!1}return t.mesh.splitEdge(o.sym),t.mesh.splitEdge(r.sym),t.mesh.meshSplice(r.oPrev(),o),o.org.s=c.s,o.org.t=c.t,o.org.pqHandle=e.pq.insert(o.org),t.sweep.getIntersectData_(e,o.org,s,u,a,l),n.regionAbove().dirty=n.dirty=i.dirty=!0,!1},t.sweep.walkDirtyRegions_=function(e,n){for(var i=n.regionBelow();;){for(;i.dirty;)n=i,i=i.regionBelow();if(!n.dirty&&(i=n,null===(n=n.regionAbove())||!n.dirty))return;n.dirty=!1;var o=n.eUp,r=i.eUp;if(o.dst()!==r.dst()&&t.sweep.checkForLeftSplice_(e,n)&&(i.fixUpperEdge?(t.sweep.deleteRegion_(e,i),t.mesh.deleteEdge(r),r=(i=n.regionBelow()).eUp):n.fixUpperEdge&&(t.sweep.deleteRegion_(e,n),t.mesh.deleteEdge(o),o=(n=i.regionAbove()).eUp)),o.org!==r.org)if(o.dst()===r.dst()||n.fixUpperEdge||i.fixUpperEdge||o.dst()!==e.event&&r.dst()!==e.event)t.sweep.checkForRightSplice_(e,n);else if(t.sweep.checkForIntersect_(e,n))return;o.org===r.org&&o.dst()===r.dst()&&(t.sweep.addWinding_(r,o),t.sweep.deleteRegion_(e,n),t.mesh.deleteEdge(o),n=i.regionAbove())}},t.sweep.connectRightVertex_=function(e,n,i){var o,r=i.oNext,s=n.regionBelow(),a=n.eUp,u=s.eUp,l=!1;(a.dst()!==u.dst()&&t.sweep.checkForIntersect_(e,n),t.geom.vertEq(a.org,e.event)&&(t.mesh.meshSplice(r.oPrev(),a),r=(n=t.sweep.topLeftRegion_(n)).regionBelow().eUp,t.sweep.finishLeftRegions_(e,n.regionBelow(),s),l=!0),t.geom.vertEq(u.org,e.event)&&(t.mesh.meshSplice(i,u.oPrev()),i=t.sweep.finishLeftRegions_(e,s,null),l=!0),l)?t.sweep.addRightEdges_(e,n,i.oNext,r,r,!0):(o=t.geom.vertLeq(u.org,a.org)?u.oPrev():a,o=t.mesh.connect(i.lPrev(),o),t.sweep.addRightEdges_(e,n,o,o.oNext,o.oNext,!1),o.sym.activeRegion.fixUpperEdge=!0,t.sweep.walkDirtyRegions_(e,n))},t.sweep.connectLeftDegenerate_=function(e,n,i){var o=n.eUp;if(t.geom.vertEq(o.org,i))t.sweep.TOLERANCE_NONZERO_&&t.sweep.spliceMergeVertices_(e,o,i.anEdge);else{if(!t.geom.vertEq(o.dst(),i))return t.mesh.splitEdge(o.sym),n.fixUpperEdge&&(t.mesh.deleteEdge(o.oNext),n.fixUpperEdge=!1),t.mesh.meshSplice(i.anEdge,o),void t.sweep.sweepEvent_(e,i);if(t.sweep.TOLERANCE_NONZERO_){var r=(n=t.sweep.topRightRegion_(n)).regionBelow(),s=r.eUp.sym,a=s.oNext,u=a;r.fixUpperEdge&&(t.sweep.deleteRegion_(e,r),t.mesh.deleteEdge(s),s=a.oPrev()),t.mesh.meshSplice(i.anEdge,s),t.geom.edgeGoesLeft(a)||(a=null),t.sweep.addRightEdges_(e,n,s.oNext,u,a,!0)}}},t.sweep.connectLeftVertex_=function(e,n){var i=new t.ActiveRegion;i.eUp=n.anEdge.sym;var o=e.dict.search(i).getKey(),r=o.regionBelow(),s=o.eUp,a=r.eUp;if(0!==t.geom.edgeSign(s.dst(),n,s.org)){var u,l=t.geom.vertLeq(a.dst(),s.dst())?o:r;if(o.inside||l.fixUpperEdge){if(l===o)u=t.mesh.connect(n.anEdge.sym,s.lNext);else u=t.mesh.connect(a.dNext(),n.anEdge).sym;l.fixUpperEdge?t.sweep.fixUpperEdge_(l,u):t.sweep.computeWinding_(e,t.sweep.addRegionBelow_(e,o,u)),t.sweep.sweepEvent_(e,n)}else t.sweep.addRightEdges_(e,o,n.anEdge,n.anEdge,null,!0)}else t.sweep.connectLeftDegenerate_(e,o,n)},t.sweep.sweepEvent_=function(e,n){e.event=n;for(var i=n.anEdge;null===i.activeRegion;)if((i=i.oNext)===n.anEdge)return void t.sweep.connectLeftVertex_(e,n);var o=t.sweep.topLeftRegion_(i.activeRegion),r=o.regionBelow(),s=r.eUp,a=t.sweep.finishLeftRegions_(e,r,null);a.oNext===s?t.sweep.connectRightVertex_(e,o,a):t.sweep.addRightEdges_(e,o,a.oNext,s,s,!0)},t.sweep.addSentinel_=function(e,n){var i=new t.ActiveRegion,o=t.mesh.makeEdge(e.mesh);o.org.s=t.sweep.SENTINEL_COORD_,o.org.t=n,o.dst().s=-t.sweep.SENTINEL_COORD_,o.dst().t=n,e.event=o.dst(),i.eUp=o,i.windingNumber=0,i.inside=!1,i.fixUpperEdge=!1,i.sentinel=!0,i.dirty=!1,i.nodeUp=e.dict.insert(i)},t.sweep.initEdgeDict_=function(e){e.dict=new t.Dict(e,t.sweep.edgeLeq_),t.sweep.addSentinel_(e,-t.sweep.SENTINEL_COORD_),t.sweep.addSentinel_(e,t.sweep.SENTINEL_COORD_)},t.sweep.doneEdgeDict_=function(e){for(var n;null!==(n=e.dict.getMin().getKey());)n.sentinel,t.sweep.deleteRegion_(e,n);e.dict=null},t.sweep.removeDegenerateEdges_=function(e){for(var n,i=e.mesh.eHead,o=i.next;o!==i;o=n){n=o.next;var r=o.lNext;t.geom.vertEq(o.org,o.dst())&&o.lNext.lNext!==o&&(t.sweep.spliceMergeVertices_(e,r,o),t.mesh.deleteEdge(o),r=(o=r).lNext),r.lNext===o&&(r!==o&&(r!==n&&r!==n.sym||(n=n.next),t.mesh.deleteEdge(r)),o!==n&&o!==n.sym||(n=n.next),t.mesh.deleteEdge(o))}},t.sweep.initPriorityQ_=function(e){var n=new t.PriorityQ;e.pq=n;var i,o=e.mesh.vHead;for(i=o.next;i!==o;i=i.next)i.pqHandle=n.insert(i);n.init()},t.sweep.donePriorityQ_=function(e){e.pq.deleteQ(),e.pq=null},t.sweep.removeDegenerateFaces_=function(e){for(var n,i=e.fHead.next;i!==e.fHead;i=n){n=i.next;var o=i.anEdge;o.lNext.lNext===o&&(t.sweep.addWinding_(o.oNext,o),t.mesh.deleteEdge(o))}},t.tessmono={},t.tessmono.tessellateMonoRegion_=function(e){for(var n=e.anEdge;t.geom.vertLeq(n.dst(),n.org);n=n.lPrev());for(;t.geom.vertLeq(n.org,n.dst());n=n.lNext);for(var i,o=n.lPrev();n.lNext!==o;)if(t.geom.vertLeq(n.dst(),o.org)){for(;o.lNext!==n&&(t.geom.edgeGoesLeft(o.lNext)||t.geom.edgeSign(o.org,o.dst(),o.lNext.dst())<=0);)o=(i=t.mesh.connect(o.lNext,o)).sym;o=o.lPrev()}else{for(;o.lNext!==n&&(t.geom.edgeGoesRight(n.lPrev())||t.geom.edgeSign(n.dst(),n.org,n.lPrev().org)>=0);)i=t.mesh.connect(n,n.lPrev()),n=i.sym;n=n.lNext}for(;o.lNext.lNext!==n;)o=(i=t.mesh.connect(o.lNext,o)).sym},t.tessmono.tessellateInterior=function(e){for(var n,i=e.fHead.next;i!==e.fHead;i=n)n=i.next,i.inside&&t.tessmono.tessellateMonoRegion_(i)},t.tessmono.discardExterior=function(e){for(var n,i=e.fHead.next;i!==e.fHead;i=n)n=i.next,i.inside||t.mesh.zapFace(i)},t.tessmono.setWindingNumber=function(e,n,i){for(var o,r=e.eHead.next;r!==e.eHead;r=o)o=r.next,r.rFace().inside!==r.lFace.inside?r.winding=r.lFace.inside?n:-n:i?t.mesh.deleteEdge(r):r.winding=0},t.Dict=function(e,n){this.head_=new t.DictNode,this.frame_=e,this.leq_=n},t.Dict.prototype.deleteDict_=function(){},t.Dict.prototype.insertBefore=function(e,n){do{e=e.prev}while(null!==e.key&&!this.leq_(this.frame_,e.key,n));var i=new t.DictNode(n,e.next,e);return e.next.prev=i,e.next=i,i},t.Dict.prototype.insert=function(e){return this.insertBefore(this.head_,e)},t.Dict.prototype.deleteNode=function(e){e.next.prev=e.prev,e.prev.next=e.next},t.Dict.prototype.search=function(e){var t=this.head_;do{t=t.next}while(null!==t.key&&!this.leq_(this.frame_,e,t.key));return t},t.Dict.prototype.getMin=function(){return this.head_.next},t.Dict.prototype.getMax=function(){return this.head_.prev},t.DictNode=function(e,t,n){this.key=e||null,this.next=t||this,this.prev=n||this},t.DictNode.prototype.getKey=function(){return this.key},t.DictNode.prototype.getSuccessor=function(){return this.next},t.DictNode.prototype.getPredecessor=function(){return this.prev},t.GluTesselator=function(){this.state_=t.GluTesselator.tessState_.T_DORMANT,this.lastEdge_=null,this.mesh=null,this.errorCallback_=null,this.normal_=[0,0,0],this.windingRule=t.windingRule.GLU_TESS_WINDING_ODD,this.fatalError=!1,this.dict=null,this.pq=null,this.event=null,this.combineCallback_=null,this.boundaryOnly_=!1,this.beginCallback_=null,this.edgeFlagCallback_=null,this.vertexCallback_=null,this.endCallback_=null,this.meshCallback_=null,this.polygonData_=null},t.GluTesselator.tessState_={T_DORMANT:0,T_IN_POLYGON:1,T_IN_CONTOUR:2},t.GluTesselator.prototype.gluDeleteTess=function(){this.requireState_(t.GluTesselator.tessState_.T_DORMANT)},t.GluTesselator.prototype.gluTessProperty=function(e,n){switch(e){case t.gluEnum.GLU_TESS_TOLERANCE:return;case t.gluEnum.GLU_TESS_WINDING_RULE:var i=n;switch(i){case t.windingRule.GLU_TESS_WINDING_ODD:case t.windingRule.GLU_TESS_WINDING_NONZERO:case t.windingRule.GLU_TESS_WINDING_POSITIVE:case t.windingRule.GLU_TESS_WINDING_NEGATIVE:case t.windingRule.GLU_TESS_WINDING_ABS_GEQ_TWO:return void(this.windingRule=i)}break;case t.gluEnum.GLU_TESS_BOUNDARY_ONLY:return void(this.boundaryOnly_=!!n);default:return void this.callErrorCallback(t.gluEnum.GLU_INVALID_ENUM)}this.callErrorCallback(t.gluEnum.GLU_INVALID_VALUE)},t.GluTesselator.prototype.gluGetTessProperty=function(e){switch(e){case t.gluEnum.GLU_TESS_TOLERANCE:return 0;case t.gluEnum.GLU_TESS_WINDING_RULE:return this.windingRule;case t.gluEnum.GLU_TESS_BOUNDARY_ONLY:return this.boundaryOnly_;default:this.callErrorCallback(t.gluEnum.GLU_INVALID_ENUM)}return!1},t.GluTesselator.prototype.gluTessNormal=function(e,t,n){this.normal_[0]=e,this.normal_[1]=t,this.normal_[2]=n},t.GluTesselator.prototype.gluTessCallback=function(e,n){var i=n||null;switch(e){case t.gluEnum.GLU_TESS_BEGIN:case t.gluEnum.GLU_TESS_BEGIN_DATA:return void(this.beginCallback_=i);case t.gluEnum.GLU_TESS_EDGE_FLAG:case t.gluEnum.GLU_TESS_EDGE_FLAG_DATA:return void(this.edgeFlagCallback_=i);case t.gluEnum.GLU_TESS_VERTEX:case t.gluEnum.GLU_TESS_VERTEX_DATA:return void(this.vertexCallback_=i);case t.gluEnum.GLU_TESS_END:case t.gluEnum.GLU_TESS_END_DATA:return void(this.endCallback_=i);case t.gluEnum.GLU_TESS_ERROR:case t.gluEnum.GLU_TESS_ERROR_DATA:return void(this.errorCallback_=i);case t.gluEnum.GLU_TESS_COMBINE:case t.gluEnum.GLU_TESS_COMBINE_DATA:return void(this.combineCallback_=i);case t.gluEnum.GLU_TESS_MESH:return void(this.meshCallback_=i);default:return void this.callErrorCallback(t.gluEnum.GLU_INVALID_ENUM)}},t.GluTesselator.prototype.gluTessVertex=function(e,n){var i=!1,o=[0,0,0];this.requireState_(t.GluTesselator.tessState_.T_IN_CONTOUR);for(var r=0;r<3;++r){var s=e[r];s<-t.GLU_TESS_MAX_COORD&&(s=-t.GLU_TESS_MAX_COORD,i=!0),s>t.GLU_TESS_MAX_COORD&&(s=t.GLU_TESS_MAX_COORD,i=!0),o[r]=s}i&&this.callErrorCallback(t.errorType.GLU_TESS_COORD_TOO_LARGE),this.addVertex_(o,n)},t.GluTesselator.prototype.gluTessBeginPolygon=function(e){this.requireState_(t.GluTesselator.tessState_.T_DORMANT),this.state_=t.GluTesselator.tessState_.T_IN_POLYGON,this.mesh=new t.GluMesh,this.polygonData_=e},t.GluTesselator.prototype.gluTessBeginContour=function(){this.requireState_(t.GluTesselator.tessState_.T_IN_POLYGON),this.state_=t.GluTesselator.tessState_.T_IN_CONTOUR,this.lastEdge_=null},t.GluTesselator.prototype.gluTessEndContour=function(){this.requireState_(t.GluTesselator.tessState_.T_IN_CONTOUR),this.state_=t.GluTesselator.tessState_.T_IN_POLYGON},t.GluTesselator.prototype.gluTessEndPolygon=function(){if(this.requireState_(t.GluTesselator.tessState_.T_IN_POLYGON),this.state_=t.GluTesselator.tessState_.T_DORMANT,t.normal.projectPolygon(this,this.normal_[0],this.normal_[1],this.normal_[2]),t.sweep.computeInterior(this),!this.fatalError){var e=this.mesh;if(this.boundaryOnly_?t.tessmono.setWindingNumber(e,1,!0):t.tessmono.tessellateInterior(e),this.mesh.checkMesh(),this.beginCallback_||this.endCallback_||this.vertexCallback_||this.edgeFlagCallback_)if(this.boundaryOnly_)t.render.renderBoundary(this,this.mesh);else{var n=!!this.edgeFlagCallback_;t.render.renderMesh(this,this.mesh,n)}if(this.meshCallback_)return t.tessmono.discardExterior(this.mesh),this.meshCallback_(this.mesh),this.mesh=null,void(this.polygonData_=null)}t.mesh.deleteMesh(this.mesh),this.polygonData_=null,this.mesh=null},t.GluTesselator.prototype.requireState_=function(e){this.state_!==e&&this.gotoState_(e)},t.GluTesselator.prototype.gotoState_=function(e){for(;this.state_!==e;)if(this.state_<e)switch(this.state_){case t.GluTesselator.tessState_.T_DORMANT:this.callErrorCallback(t.errorType.GLU_TESS_MISSING_BEGIN_POLYGON),this.gluTessBeginPolygon(null);break;case t.GluTesselator.tessState_.T_IN_POLYGON:this.callErrorCallback(t.errorType.GLU_TESS_MISSING_BEGIN_CONTOUR),this.gluTessBeginContour()}else switch(this.state_){case t.GluTesselator.tessState_.T_IN_CONTOUR:this.callErrorCallback(t.errorType.GLU_TESS_MISSING_END_CONTOUR),this.gluTessEndContour();break;case t.GluTesselator.tessState_.T_IN_POLYGON:this.callErrorCallback(t.errorType.GLU_TESS_MISSING_END_POLYGON),this.gluTessEndPolygon()}},t.GluTesselator.prototype.addVertex_=function(e,n){var i=this.lastEdge_;null===i?(i=t.mesh.makeEdge(this.mesh),t.mesh.meshSplice(i,i.sym)):(t.mesh.splitEdge(i),i=i.lNext),i.org.data=n,i.org.coords[0]=e[0],i.org.coords[1]=e[1],i.org.coords[2]=e[2],i.winding=1,i.sym.winding=-1,this.lastEdge_=i},t.GluTesselator.prototype.callBeginCallback=function(e){this.beginCallback_&&this.beginCallback_(e,this.polygonData_)},t.GluTesselator.prototype.callVertexCallback=function(e){this.vertexCallback_&&this.vertexCallback_(e,this.polygonData_)},t.GluTesselator.prototype.callEdgeFlagCallback=function(e){this.edgeFlagCallback_&&this.edgeFlagCallback_(e,this.polygonData_)},t.GluTesselator.prototype.callEndCallback=function(){this.endCallback_&&this.endCallback_(this.polygonData_)},t.GluTesselator.prototype.callCombineCallback=function(e,t,n){return this.combineCallback_&&this.combineCallback_(e,t,n,this.polygonData_)||null},t.GluTesselator.prototype.callErrorCallback=function(e){this.errorCallback_&&this.errorCallback_(e,this.polygonData_)},t.GluFace=function(e,t){this.next=e||this,this.prev=t||this,this.anEdge=null,this.data=null,this.inside=!1},t.GluHalfEdge=function(e){this.next=e||this,this.sym=null,this.oNext=null,this.lNext=null,this.org=null,this.lFace=null,this.activeRegion=null,this.winding=0},t.GluHalfEdge.prototype.rFace=function(){return this.sym.lFace},t.GluHalfEdge.prototype.dst=function(){return this.sym.org},t.GluHalfEdge.prototype.oPrev=function(){return this.sym.lNext},t.GluHalfEdge.prototype.lPrev=function(){return this.oNext.sym},t.GluHalfEdge.prototype.dPrev=function(){return this.lNext.sym},t.GluHalfEdge.prototype.rPrev=function(){return this.sym.oNext},t.GluHalfEdge.prototype.dNext=function(){return this.rPrev().sym},t.GluHalfEdge.prototype.rNext=function(){return this.oPrev().sym},t.GluMesh=function(){this.vHead=new t.GluVertex,this.fHead=new t.GluFace,this.eHead=new t.GluHalfEdge,this.eHeadSym=new t.GluHalfEdge,this.eHead.sym=this.eHeadSym,this.eHeadSym.sym=this.eHead},t.GluMesh.prototype.checkMesh=function(){if(t.DEBUG){var e,n,i,o=this.fHead,r=this.vHead,s=this.eHead,a=o;for(a=o;(n=a.next)!==o;a=n){e=n.anEdge;do{e=e.lNext}while(e!==n.anEdge)}var u=r;for(u=r;(i=u.next)!==r;u=i){e=i.anEdge;do{e=e.oNext}while(e!==i.anEdge)}var l=s;for(l=s;(e=l.next)!==s;l=e);}},t.GluVertex=function(e,t){this.next=e||this,this.prev=t||this,this.anEdge=null,this.data=null,this.coords=[0,0,0],this.s=0,this.t=0,this.pqHandle=0},t.PriorityQ=function(){this.verts_=[],this.order_=null,this.size_=0,this.initialized_=!1,this.heap_=new t.PriorityQHeap},t.PriorityQ.prototype.deleteQ=function(){this.heap_=null,this.order_=null,this.verts_=null},t.PriorityQ.prototype.init=function(){this.order_=[];for(var e=0;e<this.size_;e++)this.order_[e]=e;var n,i=(n=this.verts_,function(e,i){return t.geom.vertLeq(n[e],n[i])?1:-1});if(this.order_.sort(i),this.initialized_=!0,this.heap_.init(),t.DEBUG){var o=0+this.size_-1;for(e=0;e<o;++e);}},t.PriorityQ.prototype.insert=function(e){if(this.initialized_)return this.heap_.insert(e);var t=this.size_++;return this.verts_[t]=e,-(t+1)},t.PriorityQ.prototype.extractMin=function(){if(0===this.size_)return this.heap_.extractMin();var e=this.verts_[this.order_[this.size_-1]];if(!this.heap_.isEmpty()){var n=this.heap_.minimum();if(t.geom.vertLeq(n,e))return this.heap_.extractMin()}do{--this.size_}while(this.size_>0&&null===this.verts_[this.order_[this.size_-1]]);return e},t.PriorityQ.prototype.minimum=function(){if(0===this.size_)return this.heap_.minimum();var e=this.verts_[this.order_[this.size_-1]];if(!this.heap_.isEmpty()){var n=this.heap_.minimum();if(t.geom.vertLeq(n,e))return n}return e},t.PriorityQ.prototype.remove=function(e){if(e>=0)this.heap_.remove(e);else for(e=-(e+1),this.verts_[e]=null;this.size_>0&&null===this.verts_[this.order_[this.size_-1]];)--this.size_},t.PriorityQHeap=function(){this.heap_=t.PriorityQHeap.reallocNumeric_([0],t.PriorityQHeap.INIT_SIZE_+1),this.verts_=[null,null],this.handles_=[0,0],this.size_=0,this.max_=t.PriorityQHeap.INIT_SIZE_,this.freeList_=0,this.initialized_=!1,this.heap_[1]=1},t.PriorityQHeap.INIT_SIZE_=32,t.PriorityQHeap.reallocNumeric_=function(e,t){for(var n=new Array(t),i=0;i<e.length;i++)n[i]=e[i];for(;i<t;i++)n[i]=0;return n},t.PriorityQHeap.prototype.init=function(){for(var e=this.size_;e>=1;--e)this.floatDown_(e);this.initialized_=!0},t.PriorityQHeap.prototype.insert=function(e){var n,i=++this.size_;return 2*i>this.max_&&(this.max_*=2,this.handles_=t.PriorityQHeap.reallocNumeric_(this.handles_,this.max_+1)),0===this.freeList_?n=i:(n=this.freeList_,this.freeList_=this.handles_[this.freeList_]),this.verts_[n]=e,this.handles_[n]=i,this.heap_[i]=n,this.initialized_&&this.floatUp_(i),n},t.PriorityQHeap.prototype.isEmpty=function(){return 0===this.size_},t.PriorityQHeap.prototype.minimum=function(){return this.verts_[this.heap_[1]]},t.PriorityQHeap.prototype.extractMin=function(){var e=this.heap_,t=this.verts_,n=this.handles_,i=e[1],o=t[i];return this.size_>0&&(e[1]=e[this.size_],n[e[1]]=1,t[i]=null,n[i]=this.freeList_,this.freeList_=i,--this.size_>0&&this.floatDown_(1)),o},t.PriorityQHeap.prototype.remove=function(e){var n=this.heap_,i=this.verts_,o=this.handles_,r=o[e];if(n[r]=n[this.size_],o[n[r]]=r,r<=--this.size_)if(r<=1)this.floatDown_(r);else{var s=i[n[r]],a=i[n[r>>1]];t.geom.vertLeq(a,s)?this.floatDown_(r):this.floatUp_(r)}i[e]=null,o[e]=this.freeList_,this.freeList_=e},t.PriorityQHeap.prototype.floatDown_=function(e){for(var n=this.heap_,i=this.verts_,o=this.handles_,r=e,s=n[r];;){var a=r<<1;a<this.size_&&t.geom.vertLeq(i[n[a+1]],i[n[a]])&&(a+=1);var u=n[a];if(a>this.size_||t.geom.vertLeq(i[s],i[u]))return n[r]=s,void(o[s]=r);n[r]=u,o[u]=r,r=a}},t.PriorityQHeap.prototype.floatUp_=function(e){for(var n=this.heap_,i=this.verts_,o=this.handles_,r=e,s=n[r];;){var a=r>>1,u=n[a];if(0===a||t.geom.vertLeq(i[u],i[s]))return n[r]=s,void(o[s]=r);n[r]=u,o[u]=r,r=a}},t.ActiveRegion=function(){this.eUp=null,this.nodeUp=null,this.windingNumber=0,this.inside=!1,this.sentinel=!1,this.dirty=!1,this.fixUpperEdge=!1},t.ActiveRegion.prototype.regionBelow=function(){return this.nodeUp.getPredecessor().getKey()},t.ActiveRegion.prototype.regionAbove=function(){return this.nodeUp.getSuccessor().getKey()},e.exports=t},440:function(e,t,n){!function(e){"use strict";var t,i;String.prototype.codePointAt||(t=function(){try{var e={},t=Object.defineProperty,n=t(e,e,e)&&t}catch(e){}return n}(),i=function(e){if(null==this)throw TypeError();var t=String(this),n=t.length,i=e?Number(e):0;if(i!=i&&(i=0),!(i<0||i>=n)){var o,r=t.charCodeAt(i);return r>=55296&&r<=56319&&n>i+1&&(o=t.charCodeAt(i+1))>=56320&&o<=57343?1024*(r-55296)+o-56320+65536:r}},t?t(String.prototype,"codePointAt",{value:i,configurable:!0,writable:!0}):String.prototype.codePointAt=i);var o=0,r=-3;function s(){this.table=new Uint16Array(16),this.trans=new Uint16Array(288)}function a(e,t){this.source=e,this.sourceIndex=0,this.tag=0,this.bitcount=0,this.dest=t,this.destLen=0,this.ltree=new s,this.dtree=new s}var u=new s,l=new s,c=new Uint8Array(30),h=new Uint16Array(30),d=new Uint8Array(30),p=new Uint16Array(30),f=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),g=new s,m=new Uint8Array(320);function _(e,t,n,i){var o,r;for(o=0;o<n;++o)e[o]=0;for(o=0;o<30-n;++o)e[o+n]=o/n|0;for(r=i,o=0;o<30;++o)t[o]=r,r+=1<<e[o]}function y(e,t){var n;for(n=0;n<7;++n)e.table[n]=0;for(e.table[7]=24,e.table[8]=152,e.table[9]=112,n=0;n<24;++n)e.trans[n]=256+n;for(n=0;n<144;++n)e.trans[24+n]=n;for(n=0;n<8;++n)e.trans[168+n]=280+n;for(n=0;n<112;++n)e.trans[176+n]=144+n;for(n=0;n<5;++n)t.table[n]=0;for(t.table[5]=32,n=0;n<32;++n)t.trans[n]=n}var x=new Uint16Array(16);function w(e,t,n,i){var o,r;for(o=0;o<16;++o)e.table[o]=0;for(o=0;o<i;++o)e.table[t[n+o]]++;for(e.table[0]=0,r=0,o=0;o<16;++o)x[o]=r,r+=e.table[o];for(o=0;o<i;++o)t[n+o]&&(e.trans[x[t[n+o]]++]=o)}function v(e){e.bitcount--||(e.tag=e.source[e.sourceIndex++],e.bitcount=7);var t=1&e.tag;return e.tag>>>=1,t}function b(e,t,n){if(!t)return n;for(;e.bitcount<24;)e.tag|=e.source[e.sourceIndex++]<<e.bitcount,e.bitcount+=8;var i=e.tag&65535>>>16-t;return e.tag>>>=t,e.bitcount-=t,i+n}function S(e,t){for(;e.bitcount<24;)e.tag|=e.source[e.sourceIndex++]<<e.bitcount,e.bitcount+=8;var n=0,i=0,o=0,r=e.tag;do{i=2*i+(1&r),r>>>=1,++o,n+=t.table[o],i-=t.table[o]}while(i>=0);return e.tag=r,e.bitcount-=o,t.trans[n+i]}function T(e,t,n){var i,o,r,s,a,u;for(i=b(e,5,257),o=b(e,5,1),r=b(e,4,4),s=0;s<19;++s)m[s]=0;for(s=0;s<r;++s){var l=b(e,3,0);m[f[s]]=l}for(w(g,m,0,19),a=0;a<i+o;){var c=S(e,g);switch(c){case 16:var h=m[a-1];for(u=b(e,2,3);u;--u)m[a++]=h;break;case 17:for(u=b(e,3,3);u;--u)m[a++]=0;break;case 18:for(u=b(e,7,11);u;--u)m[a++]=0;break;default:m[a++]=c}}w(t,m,0,i),w(n,m,i,o)}function E(e,t,n){for(;;){var i,r,s,a,u=S(e,t);if(256===u)return o;if(u<256)e.dest[e.destLen++]=u;else for(i=b(e,c[u-=257],h[u]),r=S(e,n),a=s=e.destLen-b(e,d[r],p[r]);a<s+i;++a)e.dest[e.destLen++]=e.dest[a]}}function C(e){for(var t,n;e.bitcount>8;)e.sourceIndex--,e.bitcount-=8;if((t=256*(t=e.source[e.sourceIndex+1])+e.source[e.sourceIndex])!==(65535&~(256*e.source[e.sourceIndex+3]+e.source[e.sourceIndex+2])))return r;for(e.sourceIndex+=4,n=t;n;--n)e.dest[e.destLen++]=e.source[e.sourceIndex++];return e.bitcount=0,o}function O(e,t){var n,i,s=new a(e,t);do{switch(n=v(s),b(s,2,0)){case 0:i=C(s);break;case 1:i=E(s,u,l);break;case 2:T(s,s.ltree,s.dtree),i=E(s,s.ltree,s.dtree);break;default:i=r}if(i!==o)throw new Error("Data error")}while(!n);return s.destLen<s.dest.length?"function"==typeof s.dest.slice?s.dest.slice(0,s.destLen):s.dest.subarray(0,s.destLen):s.dest}y(u,l),_(c,h,4,3),_(d,p,2,1),c[28]=0,h[28]=258;var N=O;function F(e,t,n,i,o){return Math.pow(1-o,3)*e+3*Math.pow(1-o,2)*o*t+3*(1-o)*Math.pow(o,2)*n+Math.pow(o,3)*i}function M(){this.x1=Number.NaN,this.y1=Number.NaN,this.x2=Number.NaN,this.y2=Number.NaN}function D(){this.commands=[],this.fill="black",this.stroke=null,this.strokeWidth=1}function I(e){throw new Error(e)}function R(e,t){e||I(t)}M.prototype.isEmpty=function(){return isNaN(this.x1)||isNaN(this.y1)||isNaN(this.x2)||isNaN(this.y2)},M.prototype.addPoint=function(e,t){"number"==typeof e&&((isNaN(this.x1)||isNaN(this.x2))&&(this.x1=e,this.x2=e),e<this.x1&&(this.x1=e),e>this.x2&&(this.x2=e)),"number"==typeof t&&((isNaN(this.y1)||isNaN(this.y2))&&(this.y1=t,this.y2=t),t<this.y1&&(this.y1=t),t>this.y2&&(this.y2=t))},M.prototype.addX=function(e){this.addPoint(e,null)},M.prototype.addY=function(e){this.addPoint(null,e)},M.prototype.addBezier=function(e,t,n,i,o,r,s,a){var u=[e,t],l=[n,i],c=[o,r],h=[s,a];this.addPoint(e,t),this.addPoint(s,a);for(var d=0;d<=1;d++){var p=6*u[d]-12*l[d]+6*c[d],f=-3*u[d]+9*l[d]-9*c[d]+3*h[d],g=3*l[d]-3*u[d];if(0!==f){var m=Math.pow(p,2)-4*g*f;if(!(m<0)){var _=(-p+Math.sqrt(m))/(2*f);0<_&&_<1&&(0===d&&this.addX(F(u[d],l[d],c[d],h[d],_)),1===d&&this.addY(F(u[d],l[d],c[d],h[d],_)));var y=(-p-Math.sqrt(m))/(2*f);0<y&&y<1&&(0===d&&this.addX(F(u[d],l[d],c[d],h[d],y)),1===d&&this.addY(F(u[d],l[d],c[d],h[d],y)))}}else{if(0===p)continue;var x=-g/p;0<x&&x<1&&(0===d&&this.addX(F(u[d],l[d],c[d],h[d],x)),1===d&&this.addY(F(u[d],l[d],c[d],h[d],x)))}}},M.prototype.addQuad=function(e,t,n,i,o,r){var s=e+2/3*(n-e),a=t+2/3*(i-t),u=s+1/3*(o-e),l=a+1/3*(r-t);this.addBezier(e,t,s,a,u,l,o,r)},D.prototype.moveTo=function(e,t){this.commands.push({type:"M",x:e,y:t})},D.prototype.lineTo=function(e,t){this.commands.push({type:"L",x:e,y:t})},D.prototype.curveTo=D.prototype.bezierCurveTo=function(e,t,n,i,o,r){this.commands.push({type:"C",x1:e,y1:t,x2:n,y2:i,x:o,y:r})},D.prototype.quadTo=D.prototype.quadraticCurveTo=function(e,t,n,i){this.commands.push({type:"Q",x1:e,y1:t,x:n,y:i})},D.prototype.close=D.prototype.closePath=function(){this.commands.push({type:"Z"})},D.prototype.extend=function(e){if(e.commands)e=e.commands;else if(e instanceof M){var t=e;return this.moveTo(t.x1,t.y1),this.lineTo(t.x2,t.y1),this.lineTo(t.x2,t.y2),this.lineTo(t.x1,t.y2),void this.close()}Array.prototype.push.apply(this.commands,e)},D.prototype.getBoundingBox=function(){for(var e=new M,t=0,n=0,i=0,o=0,r=0;r<this.commands.length;r++){var s=this.commands[r];switch(s.type){case"M":e.addPoint(s.x,s.y),t=i=s.x,n=o=s.y;break;case"L":e.addPoint(s.x,s.y),i=s.x,o=s.y;break;case"Q":e.addQuad(i,o,s.x1,s.y1,s.x,s.y),i=s.x,o=s.y;break;case"C":e.addBezier(i,o,s.x1,s.y1,s.x2,s.y2,s.x,s.y),i=s.x,o=s.y;break;case"Z":i=t,o=n;break;default:throw new Error("Unexpected path command "+s.type)}}return e.isEmpty()&&e.addPoint(0,0),e},D.prototype.draw=function(e){e.beginPath();for(var t=0;t<this.commands.length;t+=1){var n=this.commands[t];"M"===n.type?e.moveTo(n.x,n.y):"L"===n.type?e.lineTo(n.x,n.y):"C"===n.type?e.bezierCurveTo(n.x1,n.y1,n.x2,n.y2,n.x,n.y):"Q"===n.type?e.quadraticCurveTo(n.x1,n.y1,n.x,n.y):"Z"===n.type&&e.closePath()}this.fill&&(e.fillStyle=this.fill,e.fill()),this.stroke&&(e.strokeStyle=this.stroke,e.lineWidth=this.strokeWidth,e.stroke())},D.prototype.toPathData=function(e){function t(t){return Math.round(t)===t?""+Math.round(t):t.toFixed(e)}function n(){for(var e=arguments,n="",i=0;i<arguments.length;i+=1){var o=e[i];o>=0&&i>0&&(n+=" "),n+=t(o)}return n}e=void 0!==e?e:2;for(var i="",o=0;o<this.commands.length;o+=1){var r=this.commands[o];"M"===r.type?i+="M"+n(r.x,r.y):"L"===r.type?i+="L"+n(r.x,r.y):"C"===r.type?i+="C"+n(r.x1,r.y1,r.x2,r.y2,r.x,r.y):"Q"===r.type?i+="Q"+n(r.x1,r.y1,r.x,r.y):"Z"===r.type&&(i+="Z")}return i},D.prototype.toSVG=function(e){var t='<path d="';return t+=this.toPathData(e),t+='"',this.fill&&"black"!==this.fill&&(null===this.fill?t+=' fill="none"':t+=' fill="'+this.fill+'"'),this.stroke&&(t+=' stroke="'+this.stroke+'" stroke-width="'+this.strokeWidth+'"'),t+="/>"},D.prototype.toDOMElement=function(e){var t=this.toPathData(e),n=document.createElementNS("http://www.w3.org/2000/svg","path");return n.setAttribute("d",t),n};var V={fail:I,argument:R,assert:R},P=32768,A=2147483648,L={},U={},B={};function X(e){return function(){return e}}U.BYTE=function(e){return V.argument(e>=0&&e<=255,"Byte value should be between 0 and 255."),[e]},B.BYTE=X(1),U.CHAR=function(e){return[e.charCodeAt(0)]},B.CHAR=X(1),U.CHARARRAY=function(e){void 0===e&&(e="",console.warn("Undefined CHARARRAY encountered and treated as an empty string. This is probably caused by a missing glyph name."));for(var t=[],n=0;n<e.length;n+=1)t[n]=e.charCodeAt(n);return t},B.CHARARRAY=function(e){return void 0===e?0:e.length},U.USHORT=function(e){return[e>>8&255,255&e]},B.USHORT=X(2),U.SHORT=function(e){return e>=P&&(e=-(2*P-e)),[e>>8&255,255&e]},B.SHORT=X(2),U.UINT24=function(e){return[e>>16&255,e>>8&255,255&e]},B.UINT24=X(3),U.ULONG=function(e){return[e>>24&255,e>>16&255,e>>8&255,255&e]},B.ULONG=X(4),U.LONG=function(e){return e>=A&&(e=-(2*A-e)),[e>>24&255,e>>16&255,e>>8&255,255&e]},B.LONG=X(4),U.FIXED=U.ULONG,B.FIXED=B.ULONG,U.FWORD=U.SHORT,B.FWORD=B.SHORT,U.UFWORD=U.USHORT,B.UFWORD=B.USHORT,U.LONGDATETIME=function(e){return[0,0,0,0,e>>24&255,e>>16&255,e>>8&255,255&e]},B.LONGDATETIME=X(8),U.TAG=function(e){return V.argument(4===e.length,"Tag should be exactly 4 ASCII characters."),[e.charCodeAt(0),e.charCodeAt(1),e.charCodeAt(2),e.charCodeAt(3)]},B.TAG=X(4),U.Card8=U.BYTE,B.Card8=B.BYTE,U.Card16=U.USHORT,B.Card16=B.USHORT,U.OffSize=U.BYTE,B.OffSize=B.BYTE,U.SID=U.USHORT,B.SID=B.USHORT,U.NUMBER=function(e){return e>=-107&&e<=107?[e+139]:e>=108&&e<=1131?[247+((e-=108)>>8),255&e]:e>=-1131&&e<=-108?[251+((e=-e-108)>>8),255&e]:e>=-32768&&e<=32767?U.NUMBER16(e):U.NUMBER32(e)},B.NUMBER=function(e){return U.NUMBER(e).length},U.NUMBER16=function(e){return[28,e>>8&255,255&e]},B.NUMBER16=X(3),U.NUMBER32=function(e){return[29,e>>24&255,e>>16&255,e>>8&255,255&e]},B.NUMBER32=X(5),U.REAL=function(e){var t=e.toString(),n=/\.(\d*?)(?:9{5,20}|0{5,20})\d{0,2}(?:e(.+)|$)/.exec(t);if(n){var i=parseFloat("1e"+((n[2]?+n[2]:0)+n[1].length));t=(Math.round(e*i)/i).toString()}for(var o="",r=0,s=t.length;r<s;r+=1){var a=t[r];o+="e"===a?"-"===t[++r]?"c":"b":"."===a?"a":"-"===a?"e":a}for(var u=[30],l=0,c=(o+=1&o.length?"f":"ff").length;l<c;l+=2)u.push(parseInt(o.substr(l,2),16));return u},B.REAL=function(e){return U.REAL(e).length},U.NAME=U.CHARARRAY,B.NAME=B.CHARARRAY,U.STRING=U.CHARARRAY,B.STRING=B.CHARARRAY,L.UTF8=function(e,t,n){for(var i=[],o=n,r=0;r<o;r++,t+=1)i[r]=e.getUint8(t);return String.fromCharCode.apply(null,i)},L.UTF16=function(e,t,n){for(var i=[],o=n/2,r=0;r<o;r++,t+=2)i[r]=e.getUint16(t);return String.fromCharCode.apply(null,i)},U.UTF16=function(e){for(var t=[],n=0;n<e.length;n+=1){var i=e.charCodeAt(n);t[t.length]=i>>8&255,t[t.length]=255&i}return t},B.UTF16=function(e){return 2*e.length};var k={"x-mac-croatian":"ÃÃÃÃÃÃÃÃ¡Ã Ã¢Ã¤Ã£Ã¥Ã§Ã©Ã¨ÃªÃ«Ã­Ã¬Ã®Ã¯Ã±Ã³Ã²Ã´Ã¶ÃµÃºÃ¹Ã»Ã¼â Â°Â¢Â£Â§â¢Â¶ÃÂ®Å â¢Â´Â¨â Å½ÃâÂ±â¤â¥âÂµâââÅ¡â«ÂªÂºÎ©Å¾Ã¸Â¿Â¡Â¬âÆâÄÂ«Äâ¦Â ÃÃÃÅÅÄâââââÃ·âï£¿Â©ââ¬â¹âºÃÂ»âÂ·âââ°ÃÄÃÄÃÃÃÃÃÃÃÄÃÃÃÃÄ±ËËÂ¯ÏÃËÂ¸ÃÃ¦Ë","x-mac-cyrillic":"ÐÐÐÐÐÐÐÐÐÐÐÐÐÐÐÐÐ Ð¡Ð¢Ð£Ð¤Ð¥Ð¦Ð§Ð¨Ð©ÐªÐ«Ð¬Ð­Ð®Ð¯â Â°ÒÂ£Â§â¢Â¶ÐÂ®Â©â¢ÐÑâ ÐÑâÂ±â¤â¥ÑÂµÒÐÐÑÐÑÐÑÐÑÑÐÂ¬âÆââÂ«Â»â¦Â ÐÑÐÑÑââââââÃ·âÐÑÐÑâÐÑÑÐ°Ð±Ð²Ð³Ð´ÐµÐ¶Ð·Ð¸Ð¹ÐºÐ»Ð¼Ð½Ð¾Ð¿ÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑ","x-mac-gaelic":"ÃÃÃÃÃÃÃÃ¡Ã Ã¢Ã¤Ã£Ã¥Ã§Ã©Ã¨ÃªÃ«Ã­Ã¬Ã®Ã¯Ã±Ã³Ã²Ã´Ã¶ÃµÃºÃ¹Ã»Ã¼â Â°Â¢Â£Â§â¢Â¶ÃÂ®Â©â¢Â´Â¨â ÃÃá¸Â±â¤â¥á¸ÄÄá¸á¸á¸á¸Ä Ä¡á¹Ã¦Ã¸á¹á¹á¹É¼ÆÅ¿á¹ Â«Â»â¦Â ÃÃÃÅÅââââââá¹¡áºÃ¿Å¸á¹ªâ¬â¹âºÅ¶Å·á¹«Â·á»²á»³âÃÃÃÃÃÃÃÃÃÃÃâ£ÃÃÃÃÄ±ÃÃ½Å´Åµáºáºáºáºáºáº","x-mac-greek":"ÃÂ¹Â²ÃÂ³ÃÃÎÃ Ã¢Ã¤ÎÂ¨Ã§Ã©Ã¨ÃªÃ«Â£â¢Ã®Ã¯â¢Â½â°Ã´Ã¶Â¦â¬Ã¹Ã»Ã¼â ÎÎÎÎÎÎ ÃÂ®Â©Î£ÎªÂ§â Â°Â·ÎÂ±â¤â¥Â¥ÎÎÎÎÎÎÎÎ¦Î«Î¨Î©Î¬ÎÂ¬ÎÎ¡âÎ¤Â«Â»â¦Â Î¥Î§ÎÎÅââââââÃ·ÎÎÎÎÎ­Î®Î¯ÏÎÏÎ±Î²ÏÎ´ÎµÏÎ³Î·Î¹Î¾ÎºÎ»Î¼Î½Î¿ÏÏÏÏÏÎ¸ÏÏÏÏÎ¶ÏÏÎÎ°Â­","x-mac-icelandic":"ÃÃÃÃÃÃÃÃ¡Ã Ã¢Ã¤Ã£Ã¥Ã§Ã©Ã¨ÃªÃ«Ã­Ã¬Ã®Ã¯Ã±Ã³Ã²Ã´Ã¶ÃµÃºÃ¹Ã»Ã¼ÃÂ°Â¢Â£Â§â¢Â¶ÃÂ®Â©â¢Â´Â¨â ÃÃâÂ±â¤â¥Â¥ÂµâââÏâ«ÂªÂºÎ©Ã¦Ã¸Â¿Â¡Â¬âÆââÂ«Â»â¦Â ÃÃÃÅÅââââââÃ·âÃ¿Å¸ââ¬ÃÃ°ÃÃ¾Ã½Â·âââ°ÃÃÃÃÃÃÃÃÃÃÃï£¿ÃÃÃÃÄ±ËËÂ¯ËËËÂ¸ËËË","x-mac-inuit":"ááááááá±á²á³á´á¸á¹áááááááá¦á­á®á¯á°á²á³áááááááÂ°á¡á¥á¦â¢Â¶á§Â®Â©â¢á¨áªá«á»áááááááá¯á°á±á²á´áµááááááááªá¨á©áªá«á­â¦Â á®á¾áááââââââáááááááááááá¿áááááááááááááá±á²á³á´áµá¶áá á¡á¢á£á¤á¥á¦á¼ÅÅ","x-mac-ce":"ÃÄÄÃÄÃÃÃ¡ÄÄÃ¤ÄÄÄÃ©Å¹ÅºÄÃ­ÄÄÄÄÃ³ÄÃ´Ã¶ÃµÃºÄÄÃ¼â Â°ÄÂ£Â§â¢Â¶ÃÂ®Â©â¢ÄÂ¨â Ä£Ä®Ä¯Äªâ¤â¥Ä«Ä¶ââÅÄ»Ä¼Ä½Ä¾Ä¹ÄºÅÅÅÂ¬âÅÅâÂ«Â»â¦Â ÅÅÃÅÅââââââÃ·âÅÅÅÅâ¹âºÅÅÅÅ ââÅ¡ÅÅÃÅ¤Å¥ÃÅ½Å¾ÅªÃÃÅ«Å®ÃÅ¯Å°Å±Å²Å³ÃÃ½Ä·Å»ÅÅ¼Ä¢Ë",macintosh:"ÃÃÃÃÃÃÃÃ¡Ã Ã¢Ã¤Ã£Ã¥Ã§Ã©Ã¨ÃªÃ«Ã­Ã¬Ã®Ã¯Ã±Ã³Ã²Ã´Ã¶ÃµÃºÃ¹Ã»Ã¼â Â°Â¢Â£Â§â¢Â¶ÃÂ®Â©â¢Â´Â¨â ÃÃâÂ±â¤â¥Â¥ÂµâââÏâ«ÂªÂºÎ©Ã¦Ã¸Â¿Â¡Â¬âÆââÂ«Â»â¦Â ÃÃÃÅÅââââââÃ·âÃ¿Å¸ââ¬â¹âºï¬ï¬â¡Â·âââ°ÃÃÃÃÃÃÃÃÃÃÃï£¿ÃÃÃÃÄ±ËËÂ¯ËËËÂ¸ËËË","x-mac-romanian":"ÃÃÃÃÃÃÃÃ¡Ã Ã¢Ã¤Ã£Ã¥Ã§Ã©Ã¨ÃªÃ«Ã­Ã¬Ã®Ã¯Ã±Ã³Ã²Ã´Ã¶ÃµÃºÃ¹Ã»Ã¼â Â°Â¢Â£Â§â¢Â¶ÃÂ®Â©â¢Â´Â¨â ÄÈâÂ±â¤â¥Â¥ÂµâââÏâ«ÂªÂºÎ©ÄÈÂ¿Â¡Â¬âÆââÂ«Â»â¦Â ÃÃÃÅÅââââââÃ·âÃ¿Å¸ââ¬â¹âºÈÈâ¡Â·âââ°ÃÃÃÃÃÃÃÃÃÃÃï£¿ÃÃÃÃÄ±ËËÂ¯ËËËÂ¸ËËË","x-mac-turkish":"ÃÃÃÃÃÃÃÃ¡Ã Ã¢Ã¤Ã£Ã¥Ã§Ã©Ã¨ÃªÃ«Ã­Ã¬Ã®Ã¯Ã±Ã³Ã²Ã´Ã¶ÃµÃºÃ¹Ã»Ã¼â Â°Â¢Â£Â§â¢Â¶ÃÂ®Â©â¢Â´Â¨â ÃÃâÂ±â¤â¥Â¥ÂµâââÏâ«ÂªÂºÎ©Ã¦Ã¸Â¿Â¡Â¬âÆââÂ«Â»â¦Â ÃÃÃÅÅââââââÃ·âÃ¿Å¸ÄÄÄ°Ä±ÅÅâ¡Â·âââ°ÃÃÃÃÃÃÃÃÃÃÃï£¿ÃÃÃÃï¢ ËËÂ¯ËËËÂ¸ËËË"};L.MACSTRING=function(e,t,n,i){var o=k[i];if(void 0!==o){for(var r="",s=0;s<n;s++){var a=e.getUint8(t+s);r+=a<=127?String.fromCharCode(a):o[127&a]}return r}};var z,j="function"==typeof WeakMap&&new WeakMap,G=function(e){if(!z)for(var t in z={},k)z[t]=new String(t);var n=z[e];if(void 0!==n){if(j){var i=j.get(n);if(void 0!==i)return i}var o=k[e];if(void 0!==o){for(var r={},s=0;s<o.length;s++)r[o.charCodeAt(s)]=s+128;return j&&j.set(n,r),r}}};function H(e){return e>=-128&&e<=127}function q(e,t,n){for(var i=0,o=e.length;t<o&&i<64&&0===e[t];)++t,++i;return n.push(128|i-1),t}function W(e,t,n){for(var i=0,o=e.length,r=t;r<o&&i<64;){var s=e[r];if(!H(s))break;if(0===s&&r+1<o&&0===e[r+1])break;++r,++i}n.push(i-1);for(var a=t;a<r;++a)n.push(e[a]+256&255);return r}function Y(e,t,n){for(var i=0,o=e.length,r=t;r<o&&i<64;){var s=e[r];if(0===s)break;if(H(s)&&r+1<o&&H(e[r+1]))break;++r,++i}n.push(64|i-1);for(var a=t;a<r;++a){var u=e[a];n.push(u+65536>>8&255,u+256&255)}return r}U.MACSTRING=function(e,t){var n=G(t);if(void 0!==n){for(var i=[],o=0;o<e.length;o++){var r=e.charCodeAt(o);if(r>=128&&void 0===(r=n[r]))return;i[o]=r}return i}},B.MACSTRING=function(e,t){var n=U.MACSTRING(e,t);return void 0!==n?n.length:0},U.VARDELTAS=function(e){for(var t=0,n=[];t<e.length;){var i=e[t];t=0===i?q(e,t,n):i>=-128&&i<=127?W(e,t,n):Y(e,t,n)}return n},U.INDEX=function(e){for(var t=1,n=[t],i=[],o=0;o<e.length;o+=1){var r=U.OBJECT(e[o]);Array.prototype.push.apply(i,r),t+=r.length,n.push(t)}if(0===i.length)return[0,0];for(var s=[],a=1+Math.floor(Math.log(t)/Math.log(2))/8|0,u=[void 0,U.BYTE,U.USHORT,U.UINT24,U.ULONG][a],l=0;l<n.length;l+=1){var c=u(n[l]);Array.prototype.push.apply(s,c)}return Array.prototype.concat(U.Card16(e.length),U.OffSize(a),s,i)},B.INDEX=function(e){return U.INDEX(e).length},U.DICT=function(e){for(var t=[],n=Object.keys(e),i=n.length,o=0;o<i;o+=1){var r=parseInt(n[o],0),s=e[r];t=(t=t.concat(U.OPERAND(s.value,s.type))).concat(U.OPERATOR(r))}return t},B.DICT=function(e){return U.DICT(e).length},U.OPERATOR=function(e){return e<1200?[e]:[12,e-1200]},U.OPERAND=function(e,t){var n=[];if(Array.isArray(t))for(var i=0;i<t.length;i+=1)V.argument(e.length===t.length,"Not enough arguments given for type"+t),n=n.concat(U.OPERAND(e[i],t[i]));else if("SID"===t)n=n.concat(U.NUMBER(e));else if("offset"===t)n=n.concat(U.NUMBER32(e));else if("number"===t)n=n.concat(U.NUMBER(e));else{if("real"!==t)throw new Error("Unknown operand type "+t);n=n.concat(U.REAL(e))}return n},U.OP=U.BYTE,B.OP=B.BYTE;var K="function"==typeof WeakMap&&new WeakMap;function Z(e,t,n){if(t.length&&("coverageFormat"!==t[0].name||1===t[0].value))for(var i=0;i<t.length;i+=1){var o=t[i];this[o.name]=o.value}if(this.tableName=e,this.fields=t,n)for(var r=Object.keys(n),s=0;s<r.length;s+=1){var a=r[s],u=n[a];void 0!==this[a]&&(this[a]=u)}}function Q(e,t,n){void 0===n&&(n=t.length);var i=new Array(t.length+1);i[0]={name:e+"Count",type:"USHORT",value:n};for(var o=0;o<t.length;o++)i[o+1]={name:e+o,type:"USHORT",value:t[o]};return i}function $(e,t,n){var i=t.length,o=new Array(i+1);o[0]={name:e+"Count",type:"USHORT",value:i};for(var r=0;r<i;r++)o[r+1]={name:e+r,type:"TABLE",value:n(t[r],r)};return o}function J(e,t,n){var i=t.length,o=[];o[0]={name:e+"Count",type:"USHORT",value:i};for(var r=0;r<i;r++)o=o.concat(n(t[r],r));return o}function ee(e){1===e.format?Z.call(this,"coverageTable",[{name:"coverageFormat",type:"USHORT",value:1}].concat(Q("glyph",e.glyphs))):2===e.format?Z.call(this,"coverageTable",[{name:"coverageFormat",type:"USHORT",value:2}].concat(J("rangeRecord",e.ranges,(function(e){return[{name:"startGlyphID",type:"USHORT",value:e.start},{name:"endGlyphID",type:"USHORT",value:e.end},{name:"startCoverageIndex",type:"USHORT",value:e.index}]})))):V.assert(!1,"Coverage format must be 1 or 2.")}function te(e){Z.call(this,"scriptListTable",J("scriptRecord",e,(function(e,t){var n=e.script,i=n.defaultLangSys;return V.assert(!!i,"Unable to write GSUB: script "+e.tag+" has no default language system."),[{name:"scriptTag"+t,type:"TAG",value:e.tag},{name:"script"+t,type:"TABLE",value:new Z("scriptTable",[{name:"defaultLangSys",type:"TABLE",value:new Z("defaultLangSys",[{name:"lookupOrder",type:"USHORT",value:0},{name:"reqFeatureIndex",type:"USHORT",value:i.reqFeatureIndex}].concat(Q("featureIndex",i.featureIndexes)))}].concat(J("langSys",n.langSysRecords,(function(e,t){var n=e.langSys;return[{name:"langSysTag"+t,type:"TAG",value:e.tag},{name:"langSys"+t,type:"TABLE",value:new Z("langSys",[{name:"lookupOrder",type:"USHORT",value:0},{name:"reqFeatureIndex",type:"USHORT",value:n.reqFeatureIndex}].concat(Q("featureIndex",n.featureIndexes)))}]}))))}]})))}function ne(e){Z.call(this,"featureListTable",J("featureRecord",e,(function(e,t){var n=e.feature;return[{name:"featureTag"+t,type:"TAG",value:e.tag},{name:"feature"+t,type:"TABLE",value:new Z("featureTable",[{name:"featureParams",type:"USHORT",value:n.featureParams}].concat(Q("lookupListIndex",n.lookupListIndexes)))}]})))}function ie(e,t){Z.call(this,"lookupListTable",$("lookup",e,(function(e){var n=t[e.lookupType];return V.assert(!!n,"Unable to write GSUB lookup type "+e.lookupType+" tables."),new Z("lookupTable",[{name:"lookupType",type:"USHORT",value:e.lookupType},{name:"lookupFlag",type:"USHORT",value:e.lookupFlag}].concat($("subtable",e.subtables,n)))})))}U.CHARSTRING=function(e){if(K){var t=K.get(e);if(void 0!==t)return t}for(var n=[],i=e.length,o=0;o<i;o+=1){var r=e[o];n=n.concat(U[r.type](r.value))}return K&&K.set(e,n),n},B.CHARSTRING=function(e){return U.CHARSTRING(e).length},U.OBJECT=function(e){var t=U[e.type];return V.argument(void 0!==t,"No encoding function for type "+e.type),t(e.value)},B.OBJECT=function(e){var t=B[e.type];return V.argument(void 0!==t,"No sizeOf function for type "+e.type),t(e.value)},U.TABLE=function(e){for(var t=[],n=e.fields.length,i=[],o=[],r=0;r<n;r+=1){var s=e.fields[r],a=U[s.type];V.argument(void 0!==a,"No encoding function for field type "+s.type+" ("+s.name+")");var u=e[s.name];void 0===u&&(u=s.value);var l=a(u);"TABLE"===s.type?(o.push(t.length),t=t.concat([0,0]),i.push(l)):t=t.concat(l)}for(var c=0;c<i.length;c+=1){var h=o[c],d=t.length;V.argument(d<65536,"Table "+e.tableName+" too big."),t[h]=d>>8,t[h+1]=255&d,t=t.concat(i[c])}return t},B.TABLE=function(e){for(var t=0,n=e.fields.length,i=0;i<n;i+=1){var o=e.fields[i],r=B[o.type];V.argument(void 0!==r,"No sizeOf function for field type "+o.type+" ("+o.name+")");var s=e[o.name];void 0===s&&(s=o.value),t+=r(s),"TABLE"===o.type&&(t+=2)}return t},U.RECORD=U.TABLE,B.RECORD=B.TABLE,U.LITERAL=function(e){return e},B.LITERAL=function(e){return e.length},Z.prototype.encode=function(){return U.TABLE(this)},Z.prototype.sizeOf=function(){return B.TABLE(this)},ee.prototype=Object.create(Z.prototype),ee.prototype.constructor=ee,te.prototype=Object.create(Z.prototype),te.prototype.constructor=te,ne.prototype=Object.create(Z.prototype),ne.prototype.constructor=ne,ie.prototype=Object.create(Z.prototype),ie.prototype.constructor=ie;var oe={Table:Z,Record:Z,Coverage:ee,ScriptList:te,FeatureList:ne,LookupList:ie,ushortList:Q,tableList:$,recordList:J};function re(e,t){return e.getUint8(t)}function se(e,t){return e.getUint16(t,!1)}function ae(e,t){return e.getInt16(t,!1)}function ue(e,t){return e.getUint32(t,!1)}function le(e,t){return e.getInt16(t,!1)+e.getUint16(t+2,!1)/65535}function ce(e,t){for(var n="",i=t;i<t+4;i+=1)n+=String.fromCharCode(e.getInt8(i));return n}function he(e,t,n){for(var i=0,o=0;o<n;o+=1)i<<=8,i+=e.getUint8(t+o);return i}function de(e,t,n){for(var i=[],o=t;o<n;o+=1)i.push(e.getUint8(o));return i}function pe(e){for(var t="",n=0;n<e.length;n+=1)t+=String.fromCharCode(e[n]);return t}var fe={byte:1,uShort:2,short:2,uLong:4,fixed:4,longDateTime:8,tag:4};function ge(e,t){this.data=e,this.offset=t,this.relativeOffset=0}ge.prototype.parseByte=function(){var e=this.data.getUint8(this.offset+this.relativeOffset);return this.relativeOffset+=1,e},ge.prototype.parseChar=function(){var e=this.data.getInt8(this.offset+this.relativeOffset);return this.relativeOffset+=1,e},ge.prototype.parseCard8=ge.prototype.parseByte,ge.prototype.parseUShort=function(){var e=this.data.getUint16(this.offset+this.relativeOffset);return this.relativeOffset+=2,e},ge.prototype.parseCard16=ge.prototype.parseUShort,ge.prototype.parseSID=ge.prototype.parseUShort,ge.prototype.parseOffset16=ge.prototype.parseUShort,ge.prototype.parseShort=function(){var e=this.data.getInt16(this.offset+this.relativeOffset);return this.relativeOffset+=2,e},ge.prototype.parseF2Dot14=function(){var e=this.data.getInt16(this.offset+this.relativeOffset)/16384;return this.relativeOffset+=2,e},ge.prototype.parseULong=function(){var e=ue(this.data,this.offset+this.relativeOffset);return this.relativeOffset+=4,e},ge.prototype.parseOffset32=ge.prototype.parseULong,ge.prototype.parseFixed=function(){var e=le(this.data,this.offset+this.relativeOffset);return this.relativeOffset+=4,e},ge.prototype.parseString=function(e){var t=this.data,n=this.offset+this.relativeOffset,i="";this.relativeOffset+=e;for(var o=0;o<e;o++)i+=String.fromCharCode(t.getUint8(n+o));return i},ge.prototype.parseTag=function(){return this.parseString(4)},ge.prototype.parseLongDateTime=function(){var e=ue(this.data,this.offset+this.relativeOffset+4);return e-=2082844800,this.relativeOffset+=8,e},ge.prototype.parseVersion=function(e){var t=se(this.data,this.offset+this.relativeOffset),n=se(this.data,this.offset+this.relativeOffset+2);return this.relativeOffset+=4,void 0===e&&(e=4096),t+n/e/10},ge.prototype.skip=function(e,t){void 0===t&&(t=1),this.relativeOffset+=fe[e]*t},ge.prototype.parseULongList=function(e){void 0===e&&(e=this.parseULong());for(var t=new Array(e),n=this.data,i=this.offset+this.relativeOffset,o=0;o<e;o++)t[o]=n.getUint32(i),i+=4;return this.relativeOffset+=4*e,t},ge.prototype.parseOffset16List=ge.prototype.parseUShortList=function(e){void 0===e&&(e=this.parseUShort());for(var t=new Array(e),n=this.data,i=this.offset+this.relativeOffset,o=0;o<e;o++)t[o]=n.getUint16(i),i+=2;return this.relativeOffset+=2*e,t},ge.prototype.parseShortList=function(e){for(var t=new Array(e),n=this.data,i=this.offset+this.relativeOffset,o=0;o<e;o++)t[o]=n.getInt16(i),i+=2;return this.relativeOffset+=2*e,t},ge.prototype.parseByteList=function(e){for(var t=new Array(e),n=this.data,i=this.offset+this.relativeOffset,o=0;o<e;o++)t[o]=n.getUint8(i++);return this.relativeOffset+=e,t},ge.prototype.parseList=function(e,t){t||(t=e,e=this.parseUShort());for(var n=new Array(e),i=0;i<e;i++)n[i]=t.call(this);return n},ge.prototype.parseList32=function(e,t){t||(t=e,e=this.parseULong());for(var n=new Array(e),i=0;i<e;i++)n[i]=t.call(this);return n},ge.prototype.parseRecordList=function(e,t){t||(t=e,e=this.parseUShort());for(var n=new Array(e),i=Object.keys(t),o=0;o<e;o++){for(var r={},s=0;s<i.length;s++){var a=i[s],u=t[a];r[a]=u.call(this)}n[o]=r}return n},ge.prototype.parseRecordList32=function(e,t){t||(t=e,e=this.parseULong());for(var n=new Array(e),i=Object.keys(t),o=0;o<e;o++){for(var r={},s=0;s<i.length;s++){var a=i[s],u=t[a];r[a]=u.call(this)}n[o]=r}return n},ge.prototype.parseStruct=function(e){if("function"==typeof e)return e.call(this);for(var t=Object.keys(e),n={},i=0;i<t.length;i++){var o=t[i],r=e[o];n[o]=r.call(this)}return n},ge.prototype.parseValueRecord=function(e){if(void 0===e&&(e=this.parseUShort()),0!==e){var t={};return 1&e&&(t.xPlacement=this.parseShort()),2&e&&(t.yPlacement=this.parseShort()),4&e&&(t.xAdvance=this.parseShort()),8&e&&(t.yAdvance=this.parseShort()),16&e&&(t.xPlaDevice=void 0,this.parseShort()),32&e&&(t.yPlaDevice=void 0,this.parseShort()),64&e&&(t.xAdvDevice=void 0,this.parseShort()),128&e&&(t.yAdvDevice=void 0,this.parseShort()),t}},ge.prototype.parseValueRecordList=function(){for(var e=this.parseUShort(),t=this.parseUShort(),n=new Array(t),i=0;i<t;i++)n[i]=this.parseValueRecord(e);return n},ge.prototype.parsePointer=function(e){var t=this.parseOffset16();if(t>0)return new ge(this.data,this.offset+t).parseStruct(e)},ge.prototype.parsePointer32=function(e){var t=this.parseOffset32();if(t>0)return new ge(this.data,this.offset+t).parseStruct(e)},ge.prototype.parseListOfLists=function(e){for(var t=this.parseOffset16List(),n=t.length,i=this.relativeOffset,o=new Array(n),r=0;r<n;r++){var s=t[r];if(0!==s)if(this.relativeOffset=s,e){for(var a=this.parseOffset16List(),u=new Array(a.length),l=0;l<a.length;l++)this.relativeOffset=s+a[l],u[l]=e.call(this);o[r]=u}else o[r]=this.parseUShortList();else o[r]=void 0}return this.relativeOffset=i,o},ge.prototype.parseCoverage=function(){var e=this.offset+this.relativeOffset,t=this.parseUShort(),n=this.parseUShort();if(1===t)return{format:1,glyphs:this.parseUShortList(n)};if(2===t){for(var i=new Array(n),o=0;o<n;o++)i[o]={start:this.parseUShort(),end:this.parseUShort(),index:this.parseUShort()};return{format:2,ranges:i}}throw new Error("0x"+e.toString(16)+": Coverage format must be 1 or 2.")},ge.prototype.parseClassDef=function(){var e=this.offset+this.relativeOffset,t=this.parseUShort();if(1===t)return{format:1,startGlyph:this.parseUShort(),classes:this.parseUShortList()};if(2===t)return{format:2,ranges:this.parseRecordList({start:ge.uShort,end:ge.uShort,classId:ge.uShort})};throw new Error("0x"+e.toString(16)+": ClassDef format must be 1 or 2.")},ge.list=function(e,t){return function(){return this.parseList(e,t)}},ge.list32=function(e,t){return function(){return this.parseList32(e,t)}},ge.recordList=function(e,t){return function(){return this.parseRecordList(e,t)}},ge.recordList32=function(e,t){return function(){return this.parseRecordList32(e,t)}},ge.pointer=function(e){return function(){return this.parsePointer(e)}},ge.pointer32=function(e){return function(){return this.parsePointer32(e)}},ge.tag=ge.prototype.parseTag,ge.byte=ge.prototype.parseByte,ge.uShort=ge.offset16=ge.prototype.parseUShort,ge.uShortList=ge.prototype.parseUShortList,ge.uLong=ge.offset32=ge.prototype.parseULong,ge.uLongList=ge.prototype.parseULongList,ge.struct=ge.prototype.parseStruct,ge.coverage=ge.prototype.parseCoverage,ge.classDef=ge.prototype.parseClassDef;var me={reserved:ge.uShort,reqFeatureIndex:ge.uShort,featureIndexes:ge.uShortList};ge.prototype.parseScriptList=function(){return this.parsePointer(ge.recordList({tag:ge.tag,script:ge.pointer({defaultLangSys:ge.pointer(me),langSysRecords:ge.recordList({tag:ge.tag,langSys:ge.pointer(me)})})}))||[]},ge.prototype.parseFeatureList=function(){return this.parsePointer(ge.recordList({tag:ge.tag,feature:ge.pointer({featureParams:ge.offset16,lookupListIndexes:ge.uShortList})}))||[]},ge.prototype.parseLookupList=function(e){return this.parsePointer(ge.list(ge.pointer((function(){var t=this.parseUShort();V.argument(1<=t&&t<=9,"GPOS/GSUB lookup type "+t+" unknown.");var n=this.parseUShort(),i=16&n;return{lookupType:t,lookupFlag:n,subtables:this.parseList(ge.pointer(e[t])),markFilteringSet:i?this.parseUShort():void 0}}))))||[]},ge.prototype.parseFeatureVariationsList=function(){return this.parsePointer32((function(){var e=this.parseUShort(),t=this.parseUShort();return V.argument(1===e&&t<1,"GPOS/GSUB feature variations table unknown."),this.parseRecordList32({conditionSetOffset:ge.offset32,featureTableSubstitutionOffset:ge.offset32})}))||[]};var _e={getByte:re,getCard8:re,getUShort:se,getCard16:se,getShort:ae,getULong:ue,getFixed:le,getTag:ce,getOffset:he,getBytes:de,bytesToString:pe,Parser:ge};function ye(e,t){var n;t.parseUShort(),e.length=t.parseULong(),e.language=t.parseULong(),e.groupCount=n=t.parseULong(),e.glyphIndexMap={};for(var i=0;i<n;i+=1)for(var o=t.parseULong(),r=t.parseULong(),s=t.parseULong(),a=o;a<=r;a+=1)e.glyphIndexMap[a]=s,s++}function xe(e,t,n,i,o){var r;e.length=t.parseUShort(),e.language=t.parseUShort(),e.segCount=r=t.parseUShort()>>1,t.skip("uShort",3),e.glyphIndexMap={};for(var s=new _e.Parser(n,i+o+14),a=new _e.Parser(n,i+o+16+2*r),u=new _e.Parser(n,i+o+16+4*r),l=new _e.Parser(n,i+o+16+6*r),c=i+o+16+8*r,h=0;h<r-1;h+=1)for(var d=void 0,p=s.parseUShort(),f=a.parseUShort(),g=u.parseShort(),m=l.parseUShort(),_=f;_<=p;_+=1)0!==m?(c=l.offset+l.relativeOffset-2,c+=m,c+=2*(_-f),0!==(d=_e.getUShort(n,c))&&(d=d+g&65535)):d=_+g&65535,e.glyphIndexMap[_]=d}function we(e,t){var n={};n.version=_e.getUShort(e,t),V.argument(0===n.version,"cmap table version should be 0."),n.numTables=_e.getUShort(e,t+2);for(var i=-1,o=n.numTables-1;o>=0;o-=1){var r=_e.getUShort(e,t+4+8*o),s=_e.getUShort(e,t+4+8*o+2);if(3===r&&(0===s||1===s||10===s)||0===r&&(0===s||1===s||2===s||3===s||4===s)){i=_e.getULong(e,t+4+8*o+4);break}}if(-1===i)throw new Error("No valid cmap sub-tables found.");var a=new _e.Parser(e,t+i);if(n.format=a.parseUShort(),12===n.format)ye(n,a);else{if(4!==n.format)throw new Error("Only format 4 and 12 cmap tables are supported (found format "+n.format+").");xe(n,a,e,t,i)}return n}function ve(e,t,n){e.segments.push({end:t,start:t,delta:-(t-n),offset:0,glyphIndex:n})}function be(e){e.segments.push({end:65535,start:65535,delta:1,offset:0})}function Se(e){var t,n=!0;for(t=e.length-1;t>0;t-=1)if(e.get(t).unicode>65535){console.log("Adding CMAP format 12 (needed!)"),n=!1;break}var i=[{name:"version",type:"USHORT",value:0},{name:"numTables",type:"USHORT",value:n?1:2},{name:"platformID",type:"USHORT",value:3},{name:"encodingID",type:"USHORT",value:1},{name:"offset",type:"ULONG",value:n?12:20}];n||(i=i.concat([{name:"cmap12PlatformID",type:"USHORT",value:3},{name:"cmap12EncodingID",type:"USHORT",value:10},{name:"cmap12Offset",type:"ULONG",value:0}])),i=i.concat([{name:"format",type:"USHORT",value:4},{name:"cmap4Length",type:"USHORT",value:0},{name:"language",type:"USHORT",value:0},{name:"segCountX2",type:"USHORT",value:0},{name:"searchRange",type:"USHORT",value:0},{name:"entrySelector",type:"USHORT",value:0},{name:"rangeShift",type:"USHORT",value:0}]);var o=new oe.Table("cmap",i);for(o.segments=[],t=0;t<e.length;t+=1){for(var r=e.get(t),s=0;s<r.unicodes.length;s+=1)ve(o,r.unicodes[s],t);o.segments=o.segments.sort((function(e,t){return e.start-t.start}))}be(o);var a=o.segments.length,u=0,l=[],c=[],h=[],d=[],p=[],f=[];for(t=0;t<a;t+=1){var g=o.segments[t];g.end<=65535&&g.start<=65535?(l=l.concat({name:"end_"+t,type:"USHORT",value:g.end}),c=c.concat({name:"start_"+t,type:"USHORT",value:g.start}),h=h.concat({name:"idDelta_"+t,type:"SHORT",value:g.delta}),d=d.concat({name:"idRangeOffset_"+t,type:"USHORT",value:g.offset}),void 0!==g.glyphId&&(p=p.concat({name:"glyph_"+t,type:"USHORT",value:g.glyphId}))):u+=1,n||void 0===g.glyphIndex||(f=(f=(f=f.concat({name:"cmap12Start_"+t,type:"ULONG",value:g.start})).concat({name:"cmap12End_"+t,type:"ULONG",value:g.end})).concat({name:"cmap12Glyph_"+t,type:"ULONG",value:g.glyphIndex}))}if(o.segCountX2=2*(a-u),o.searchRange=2*Math.pow(2,Math.floor(Math.log(a-u)/Math.log(2))),o.entrySelector=Math.log(o.searchRange/2)/Math.log(2),o.rangeShift=o.segCountX2-o.searchRange,o.fields=o.fields.concat(l),o.fields.push({name:"reservedPad",type:"USHORT",value:0}),o.fields=o.fields.concat(c),o.fields=o.fields.concat(h),o.fields=o.fields.concat(d),o.fields=o.fields.concat(p),o.cmap4Length=14+2*l.length+2+2*c.length+2*h.length+2*d.length+2*p.length,!n){var m=16+4*f.length;o.cmap12Offset=20+o.cmap4Length,o.fields=o.fields.concat([{name:"cmap12Format",type:"USHORT",value:12},{name:"cmap12Reserved",type:"USHORT",value:0},{name:"cmap12Length",type:"ULONG",value:m},{name:"cmap12Language",type:"ULONG",value:0},{name:"cmap12nGroups",type:"ULONG",value:f.length/3}]),o.fields=o.fields.concat(f)}return o}var Te={parse:we,make:Se},Ee=[".notdef","space","exclam","quotedbl","numbersign","dollar","percent","ampersand","quoteright","parenleft","parenright","asterisk","plus","comma","hyphen","period","slash","zero","one","two","three","four","five","six","seven","eight","nine","colon","semicolon","less","equal","greater","question","at","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","bracketleft","backslash","bracketright","asciicircum","underscore","quoteleft","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","braceleft","bar","braceright","asciitilde","exclamdown","cent","sterling","fraction","yen","florin","section","currency","quotesingle","quotedblleft","guillemotleft","guilsinglleft","guilsinglright","fi","fl","endash","dagger","daggerdbl","periodcentered","paragraph","bullet","quotesinglbase","quotedblbase","quotedblright","guillemotright","ellipsis","perthousand","questiondown","grave","acute","circumflex","tilde","macron","breve","dotaccent","dieresis","ring","cedilla","hungarumlaut","ogonek","caron","emdash","AE","ordfeminine","Lslash","Oslash","OE","ordmasculine","ae","dotlessi","lslash","oslash","oe","germandbls","onesuperior","logicalnot","mu","trademark","Eth","onehalf","plusminus","Thorn","onequarter","divide","brokenbar","degree","thorn","threequarters","twosuperior","registered","minus","eth","multiply","threesuperior","copyright","Aacute","Acircumflex","Adieresis","Agrave","Aring","Atilde","Ccedilla","Eacute","Ecircumflex","Edieresis","Egrave","Iacute","Icircumflex","Idieresis","Igrave","Ntilde","Oacute","Ocircumflex","Odieresis","Ograve","Otilde","Scaron","Uacute","Ucircumflex","Udieresis","Ugrave","Yacute","Ydieresis","Zcaron","aacute","acircumflex","adieresis","agrave","aring","atilde","ccedilla","eacute","ecircumflex","edieresis","egrave","iacute","icircumflex","idieresis","igrave","ntilde","oacute","ocircumflex","odieresis","ograve","otilde","scaron","uacute","ucircumflex","udieresis","ugrave","yacute","ydieresis","zcaron","exclamsmall","Hungarumlautsmall","dollaroldstyle","dollarsuperior","ampersandsmall","Acutesmall","parenleftsuperior","parenrightsuperior","266 ff","onedotenleader","zerooldstyle","oneoldstyle","twooldstyle","threeoldstyle","fouroldstyle","fiveoldstyle","sixoldstyle","sevenoldstyle","eightoldstyle","nineoldstyle","commasuperior","threequartersemdash","periodsuperior","questionsmall","asuperior","bsuperior","centsuperior","dsuperior","esuperior","isuperior","lsuperior","msuperior","nsuperior","osuperior","rsuperior","ssuperior","tsuperior","ff","ffi","ffl","parenleftinferior","parenrightinferior","Circumflexsmall","hyphensuperior","Gravesmall","Asmall","Bsmall","Csmall","Dsmall","Esmall","Fsmall","Gsmall","Hsmall","Ismall","Jsmall","Ksmall","Lsmall","Msmall","Nsmall","Osmall","Psmall","Qsmall","Rsmall","Ssmall","Tsmall","Usmall","Vsmall","Wsmall","Xsmall","Ysmall","Zsmall","colonmonetary","onefitted","rupiah","Tildesmall","exclamdownsmall","centoldstyle","Lslashsmall","Scaronsmall","Zcaronsmall","Dieresissmall","Brevesmall","Caronsmall","Dotaccentsmall","Macronsmall","figuredash","hypheninferior","Ogoneksmall","Ringsmall","Cedillasmall","questiondownsmall","oneeighth","threeeighths","fiveeighths","seveneighths","onethird","twothirds","zerosuperior","foursuperior","fivesuperior","sixsuperior","sevensuperior","eightsuperior","ninesuperior","zeroinferior","oneinferior","twoinferior","threeinferior","fourinferior","fiveinferior","sixinferior","seveninferior","eightinferior","nineinferior","centinferior","dollarinferior","periodinferior","commainferior","Agravesmall","Aacutesmall","Acircumflexsmall","Atildesmall","Adieresissmall","Aringsmall","AEsmall","Ccedillasmall","Egravesmall","Eacutesmall","Ecircumflexsmall","Edieresissmall","Igravesmall","Iacutesmall","Icircumflexsmall","Idieresissmall","Ethsmall","Ntildesmall","Ogravesmall","Oacutesmall","Ocircumflexsmall","Otildesmall","Odieresissmall","OEsmall","Oslashsmall","Ugravesmall","Uacutesmall","Ucircumflexsmall","Udieresissmall","Yacutesmall","Thornsmall","Ydieresissmall","001.000","001.001","001.002","001.003","Black","Bold","Book","Light","Medium","Regular","Roman","Semibold"],Ce=["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","space","exclam","quotedbl","numbersign","dollar","percent","ampersand","quoteright","parenleft","parenright","asterisk","plus","comma","hyphen","period","slash","zero","one","two","three","four","five","six","seven","eight","nine","colon","semicolon","less","equal","greater","question","at","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","bracketleft","backslash","bracketright","asciicircum","underscore","quoteleft","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","braceleft","bar","braceright","asciitilde","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","exclamdown","cent","sterling","fraction","yen","florin","section","currency","quotesingle","quotedblleft","guillemotleft","guilsinglleft","guilsinglright","fi","fl","","endash","dagger","daggerdbl","periodcentered","","paragraph","bullet","quotesinglbase","quotedblbase","quotedblright","guillemotright","ellipsis","perthousand","","questiondown","","grave","acute","circumflex","tilde","macron","breve","dotaccent","dieresis","","ring","cedilla","","hungarumlaut","ogonek","caron","emdash","","","","","","","","","","","","","","","","","AE","","ordfeminine","","","","","Lslash","Oslash","OE","ordmasculine","","","","","","ae","","","","dotlessi","","","lslash","oslash","oe","germandbls"],Oe=["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","space","exclamsmall","Hungarumlautsmall","","dollaroldstyle","dollarsuperior","ampersandsmall","Acutesmall","parenleftsuperior","parenrightsuperior","twodotenleader","onedotenleader","comma","hyphen","period","fraction","zerooldstyle","oneoldstyle","twooldstyle","threeoldstyle","fouroldstyle","fiveoldstyle","sixoldstyle","sevenoldstyle","eightoldstyle","nineoldstyle","colon","semicolon","commasuperior","threequartersemdash","periodsuperior","questionsmall","","asuperior","bsuperior","centsuperior","dsuperior","esuperior","","","isuperior","","","lsuperior","msuperior","nsuperior","osuperior","","","rsuperior","ssuperior","tsuperior","","ff","fi","fl","ffi","ffl","parenleftinferior","","parenrightinferior","Circumflexsmall","hyphensuperior","Gravesmall","Asmall","Bsmall","Csmall","Dsmall","Esmall","Fsmall","Gsmall","Hsmall","Ismall","Jsmall","Ksmall","Lsmall","Msmall","Nsmall","Osmall","Psmall","Qsmall","Rsmall","Ssmall","Tsmall","Usmall","Vsmall","Wsmall","Xsmall","Ysmall","Zsmall","colonmonetary","onefitted","rupiah","Tildesmall","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","exclamdownsmall","centoldstyle","Lslashsmall","","","Scaronsmall","Zcaronsmall","Dieresissmall","Brevesmall","Caronsmall","","Dotaccentsmall","","","Macronsmall","","","figuredash","hypheninferior","","","Ogoneksmall","Ringsmall","Cedillasmall","","","","onequarter","onehalf","threequarters","questiondownsmall","oneeighth","threeeighths","fiveeighths","seveneighths","onethird","twothirds","","","zerosuperior","onesuperior","twosuperior","threesuperior","foursuperior","fivesuperior","sixsuperior","sevensuperior","eightsuperior","ninesuperior","zeroinferior","oneinferior","twoinferior","threeinferior","fourinferior","fiveinferior","sixinferior","seveninferior","eightinferior","nineinferior","centinferior","dollarinferior","periodinferior","commainferior","Agravesmall","Aacutesmall","Acircumflexsmall","Atildesmall","Adieresissmall","Aringsmall","AEsmall","Ccedillasmall","Egravesmall","Eacutesmall","Ecircumflexsmall","Edieresissmall","Igravesmall","Iacutesmall","Icircumflexsmall","Idieresissmall","Ethsmall","Ntildesmall","Ogravesmall","Oacutesmall","Ocircumflexsmall","Otildesmall","Odieresissmall","OEsmall","Oslashsmall","Ugravesmall","Uacutesmall","Ucircumflexsmall","Udieresissmall","Yacutesmall","Thornsmall","Ydieresissmall"],Ne=[".notdef",".null","nonmarkingreturn","space","exclam","quotedbl","numbersign","dollar","percent","ampersand","quotesingle","parenleft","parenright","asterisk","plus","comma","hyphen","period","slash","zero","one","two","three","four","five","six","seven","eight","nine","colon","semicolon","less","equal","greater","question","at","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","bracketleft","backslash","bracketright","asciicircum","underscore","grave","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","braceleft","bar","braceright","asciitilde","Adieresis","Aring","Ccedilla","Eacute","Ntilde","Odieresis","Udieresis","aacute","agrave","acircumflex","adieresis","atilde","aring","ccedilla","eacute","egrave","ecircumflex","edieresis","iacute","igrave","icircumflex","idieresis","ntilde","oacute","ograve","ocircumflex","odieresis","otilde","uacute","ugrave","ucircumflex","udieresis","dagger","degree","cent","sterling","section","bullet","paragraph","germandbls","registered","copyright","trademark","acute","dieresis","notequal","AE","Oslash","infinity","plusminus","lessequal","greaterequal","yen","mu","partialdiff","summation","product","pi","integral","ordfeminine","ordmasculine","Omega","ae","oslash","questiondown","exclamdown","logicalnot","radical","florin","approxequal","Delta","guillemotleft","guillemotright","ellipsis","nonbreakingspace","Agrave","Atilde","Otilde","OE","oe","endash","emdash","quotedblleft","quotedblright","quoteleft","quoteright","divide","lozenge","ydieresis","Ydieresis","fraction","currency","guilsinglleft","guilsinglright","fi","fl","daggerdbl","periodcentered","quotesinglbase","quotedblbase","perthousand","Acircumflex","Ecircumflex","Aacute","Edieresis","Egrave","Iacute","Icircumflex","Idieresis","Igrave","Oacute","Ocircumflex","apple","Ograve","Uacute","Ucircumflex","Ugrave","dotlessi","circumflex","tilde","macron","breve","dotaccent","ring","cedilla","hungarumlaut","ogonek","caron","Lslash","lslash","Scaron","scaron","Zcaron","zcaron","brokenbar","Eth","eth","Yacute","yacute","Thorn","thorn","minus","multiply","onesuperior","twosuperior","threesuperior","onehalf","onequarter","threequarters","franc","Gbreve","gbreve","Idotaccent","Scedilla","scedilla","Cacute","cacute","Ccaron","ccaron","dcroat"];function Fe(e){this.font=e}function Me(e){this.cmap=e}function De(e,t){this.encoding=e,this.charset=t}function Ie(e){switch(e.version){case 1:this.names=Ne.slice();break;case 2:this.names=new Array(e.numberOfGlyphs);for(var t=0;t<e.numberOfGlyphs;t++)e.glyphNameIndex[t]<Ne.length?this.names[t]=Ne[e.glyphNameIndex[t]]:this.names[t]=e.names[e.glyphNameIndex[t]-Ne.length];break;case 2.5:this.names=new Array(e.numberOfGlyphs);for(var n=0;n<e.numberOfGlyphs;n++)this.names[n]=Ne[n+e.glyphNameIndex[n]];break;default:this.names=[]}}function Re(e){for(var t,n=e.tables.cmap.glyphIndexMap,i=Object.keys(n),o=0;o<i.length;o+=1){var r=i[o],s=n[r];(t=e.glyphs.get(s)).addUnicode(parseInt(r))}for(var a=0;a<e.glyphs.length;a+=1)t=e.glyphs.get(a),e.cffEncoding?e.isCIDFont?t.name="gid"+a:t.name=e.cffEncoding.charset[a]:e.glyphNames.names&&(t.name=e.glyphNames.glyphIndexToName(a))}function Ve(e){e._IndexToUnicodeMap={};for(var t=e.tables.cmap.glyphIndexMap,n=Object.keys(t),i=0;i<n.length;i+=1){var o=n[i],r=t[o];void 0===e._IndexToUnicodeMap[r]?e._IndexToUnicodeMap[r]={unicodes:[parseInt(o)]}:e._IndexToUnicodeMap[r].unicodes.push(parseInt(o))}}function Pe(e,t){t.lowMemory?Ve(e):Re(e)}function Ae(e,t,n,i,o){e.beginPath(),e.moveTo(t,n),e.lineTo(i,o),e.stroke()}Fe.prototype.charToGlyphIndex=function(e){var t=e.codePointAt(0),n=this.font.glyphs;if(n)for(var i=0;i<n.length;i+=1)for(var o=n.get(i),r=0;r<o.unicodes.length;r+=1)if(o.unicodes[r]===t)return i;return null},Me.prototype.charToGlyphIndex=function(e){return this.cmap.glyphIndexMap[e.codePointAt(0)]||0},De.prototype.charToGlyphIndex=function(e){var t=e.codePointAt(0),n=this.encoding[t];return this.charset.indexOf(n)},Ie.prototype.nameToGlyphIndex=function(e){return this.names.indexOf(e)},Ie.prototype.glyphIndexToName=function(e){return this.names[e]};var Le={line:Ae};function Ue(e,t){var n=t||new D;return{configurable:!0,get:function(){return"function"==typeof n&&(n=n()),n},set:function(e){n=e}}}function Be(e){this.bindConstructorValues(e)}function Xe(e,t,n){Object.defineProperty(e,t,{get:function(){return e.path,e[n]},set:function(t){e[n]=t},enumerable:!0,configurable:!0})}function ke(e,t){if(this.font=e,this.glyphs={},Array.isArray(t))for(var n=0;n<t.length;n++){var i=t[n];i.path.unitsPerEm=e.unitsPerEm,this.glyphs[n]=i}this.length=t&&t.length||0}function ze(e,t){return new Be({index:t,font:e})}function je(e,t,n,i,o,r){return function(){var s=new Be({index:t,font:e});return s.path=function(){n(s,i,o);var t=r(e.glyphs,s);return t.unitsPerEm=e.unitsPerEm,t},Xe(s,"xMin","_xMin"),Xe(s,"xMax","_xMax"),Xe(s,"yMin","_yMin"),Xe(s,"yMax","_yMax"),s}}function Ge(e,t,n,i){return function(){var o=new Be({index:t,font:e});return o.path=function(){var t=n(e,o,i);return t.unitsPerEm=e.unitsPerEm,t},o}}Be.prototype.bindConstructorValues=function(e){this.index=e.index||0,this.name=e.name||null,this.unicode=e.unicode||void 0,this.unicodes=e.unicodes||void 0!==e.unicode?[e.unicode]:[],"xMin"in e&&(this.xMin=e.xMin),"yMin"in e&&(this.yMin=e.yMin),"xMax"in e&&(this.xMax=e.xMax),"yMax"in e&&(this.yMax=e.yMax),"advanceWidth"in e&&(this.advanceWidth=e.advanceWidth),Object.defineProperty(this,"path",Ue(this,e.path))},Be.prototype.addUnicode=function(e){0===this.unicodes.length&&(this.unicode=e),this.unicodes.push(e)},Be.prototype.getBoundingBox=function(){return this.path.getBoundingBox()},Be.prototype.getPath=function(e,t,n,i,o){var r,s;e=void 0!==e?e:0,t=void 0!==t?t:0,n=void 0!==n?n:72,i||(i={});var a=i.xScale,u=i.yScale;if(i.hinting&&o&&o.hinting&&(s=this.path&&o.hinting.exec(this,n)),s)r=o.hinting.getCommands(s),e=Math.round(e),t=Math.round(t),a=u=1;else{r=this.path.commands;var l=1/(this.path.unitsPerEm||1e3)*n;void 0===a&&(a=l),void 0===u&&(u=l)}for(var c=new D,h=0;h<r.length;h+=1){var d=r[h];"M"===d.type?c.moveTo(e+d.x*a,t+-d.y*u):"L"===d.type?c.lineTo(e+d.x*a,t+-d.y*u):"Q"===d.type?c.quadraticCurveTo(e+d.x1*a,t+-d.y1*u,e+d.x*a,t+-d.y*u):"C"===d.type?c.curveTo(e+d.x1*a,t+-d.y1*u,e+d.x2*a,t+-d.y2*u,e+d.x*a,t+-d.y*u):"Z"===d.type&&c.closePath()}return c},Be.prototype.getContours=function(){if(void 0===this.points)return[];for(var e=[],t=[],n=0;n<this.points.length;n+=1){var i=this.points[n];t.push(i),i.lastPointOfContour&&(e.push(t),t=[])}return V.argument(0===t.length,"There are still points left in the current contour."),e},Be.prototype.getMetrics=function(){for(var e=this.path.commands,t=[],n=[],i=0;i<e.length;i+=1){var o=e[i];"Z"!==o.type&&(t.push(o.x),n.push(o.y)),"Q"!==o.type&&"C"!==o.type||(t.push(o.x1),n.push(o.y1)),"C"===o.type&&(t.push(o.x2),n.push(o.y2))}var r={xMin:Math.min.apply(null,t),yMin:Math.min.apply(null,n),xMax:Math.max.apply(null,t),yMax:Math.max.apply(null,n),leftSideBearing:this.leftSideBearing};return isFinite(r.xMin)||(r.xMin=0),isFinite(r.xMax)||(r.xMax=this.advanceWidth),isFinite(r.yMin)||(r.yMin=0),isFinite(r.yMax)||(r.yMax=0),r.rightSideBearing=this.advanceWidth-r.leftSideBearing-(r.xMax-r.xMin),r},Be.prototype.draw=function(e,t,n,i,o){this.getPath(t,n,i,o).draw(e)},Be.prototype.drawPoints=function(e,t,n,i){function o(t,n,i,o){e.beginPath();for(var r=0;r<t.length;r+=1)e.moveTo(n+t[r].x*o,i+t[r].y*o),e.arc(n+t[r].x*o,i+t[r].y*o,2,0,2*Math.PI,!1);e.closePath(),e.fill()}t=void 0!==t?t:0,n=void 0!==n?n:0,i=void 0!==i?i:24;for(var r=1/this.path.unitsPerEm*i,s=[],a=[],u=this.path,l=0;l<u.commands.length;l+=1){var c=u.commands[l];void 0!==c.x&&s.push({x:c.x,y:-c.y}),void 0!==c.x1&&a.push({x:c.x1,y:-c.y1}),void 0!==c.x2&&a.push({x:c.x2,y:-c.y2})}e.fillStyle="blue",o(s,t,n,r),e.fillStyle="red",o(a,t,n,r)},Be.prototype.drawMetrics=function(e,t,n,i){var o;t=void 0!==t?t:0,n=void 0!==n?n:0,i=void 0!==i?i:24,o=1/this.path.unitsPerEm*i,e.lineWidth=1,e.strokeStyle="black",Le.line(e,t,-1e4,t,1e4),Le.line(e,-1e4,n,1e4,n);var r=this.xMin||0,s=this.yMin||0,a=this.xMax||0,u=this.yMax||0,l=this.advanceWidth||0;e.strokeStyle="blue",Le.line(e,t+r*o,-1e4,t+r*o,1e4),Le.line(e,t+a*o,-1e4,t+a*o,1e4),Le.line(e,-1e4,n+-s*o,1e4,n+-s*o),Le.line(e,-1e4,n+-u*o,1e4,n+-u*o),e.strokeStyle="green",Le.line(e,t+l*o,-1e4,t+l*o,1e4)},ke.prototype.get=function(e){if(void 0===this.glyphs[e]){this.font._push(e),"function"==typeof this.glyphs[e]&&(this.glyphs[e]=this.glyphs[e]());var t=this.glyphs[e],n=this.font._IndexToUnicodeMap[e];if(n)for(var i=0;i<n.unicodes.length;i++)t.addUnicode(n.unicodes[i]);this.font.cffEncoding?this.font.isCIDFont?t.name="gid"+e:t.name=this.font.cffEncoding.charset[e]:this.font.glyphNames.names&&(t.name=this.font.glyphNames.glyphIndexToName(e)),this.glyphs[e].advanceWidth=this.font._hmtxTableData[e].advanceWidth,this.glyphs[e].leftSideBearing=this.font._hmtxTableData[e].leftSideBearing}else"function"==typeof this.glyphs[e]&&(this.glyphs[e]=this.glyphs[e]());return this.glyphs[e]},ke.prototype.push=function(e,t){this.glyphs[e]=t,this.length++};var He={GlyphSet:ke,glyphLoader:ze,ttfGlyphLoader:je,cffGlyphLoader:Ge};function qe(e,t){if(e===t)return!0;if(Array.isArray(e)&&Array.isArray(t)){if(e.length!==t.length)return!1;for(var n=0;n<e.length;n+=1)if(!qe(e[n],t[n]))return!1;return!0}return!1}function We(e){return e.length<1240?107:e.length<33900?1131:32768}function Ye(e,t,n){var i,o,r=[],s=[],a=_e.getCard16(e,t);if(0!==a){var u=_e.getByte(e,t+2);i=t+(a+1)*u+2;for(var l=t+3,c=0;c<a+1;c+=1)r.push(_e.getOffset(e,l,u)),l+=u;o=i+r[a]}else o=t+2;for(var h=0;h<r.length-1;h+=1){var d=_e.getBytes(e,i+r[h],i+r[h+1]);n&&(d=n(d)),s.push(d)}return{objects:s,startOffset:t,endOffset:o}}function Ke(e,t){var n,i,o=[],r=_e.getCard16(e,t);if(0!==r){var s=_e.getByte(e,t+2);n=t+(r+1)*s+2;for(var a=t+3,u=0;u<r+1;u+=1)o.push(_e.getOffset(e,a,s)),a+=s;i=n+o[r]}else i=t+2;return{offsets:o,startOffset:t,endOffset:i}}function Ze(e,t,n,i,o){var r=_e.getCard16(n,i),s=0;0!==r&&(s=i+(r+1)*_e.getByte(n,i+2)+2);var a=_e.getBytes(n,s+t[e],s+t[e+1]);return o&&(a=o(a)),a}function Qe(e){for(var t="",n=15,i=["0","1","2","3","4","5","6","7","8","9",".","E","E-",null,"-"];;){var o=e.parseByte(),r=o>>4,s=15&o;if(r===n)break;if(t+=i[r],s===n)break;t+=i[s]}return parseFloat(t)}function $e(e,t){if(28===t)return e.parseByte()<<8|e.parseByte();if(29===t)return e.parseByte()<<24|e.parseByte()<<16|e.parseByte()<<8|e.parseByte();if(30===t)return Qe(e);if(t>=32&&t<=246)return t-139;if(t>=247&&t<=250)return 256*(t-247)+e.parseByte()+108;if(t>=251&&t<=254)return 256*-(t-251)-e.parseByte()-108;throw new Error("Invalid b0 "+t)}function Je(e){for(var t={},n=0;n<e.length;n+=1){var i=e[n][0],o=e[n][1],r=void 0;if(r=1===o.length?o[0]:o,t.hasOwnProperty(i)&&!isNaN(t[i]))throw new Error("Object "+t+" already has key "+i);t[i]=r}return t}function et(e,t,n){t=void 0!==t?t:0;var i=new _e.Parser(e,t),o=[],r=[];for(n=void 0!==n?n:e.length;i.relativeOffset<n;){var s=i.parseByte();s<=21?(12===s&&(s=1200+i.parseByte()),o.push([s,r]),r=[]):r.push($e(i,s))}return Je(o)}function tt(e,t){return t=t<=390?Ee[t]:e[t-391]}function nt(e,t,n){for(var i,o={},r=0;r<t.length;r+=1){var s=t[r];if(Array.isArray(s.type)){var a=[];a.length=s.type.length;for(var u=0;u<s.type.length;u++)void 0===(i=void 0!==e[s.op]?e[s.op][u]:void 0)&&(i=void 0!==s.value&&void 0!==s.value[u]?s.value[u]:null),"SID"===s.type[u]&&(i=tt(n,i)),a[u]=i;o[s.name]=a}else void 0===(i=e[s.op])&&(i=void 0!==s.value?s.value:null),"SID"===s.type&&(i=tt(n,i)),o[s.name]=i}return o}function it(e,t){var n={};return n.formatMajor=_e.getCard8(e,t),n.formatMinor=_e.getCard8(e,t+1),n.size=_e.getCard8(e,t+2),n.offsetSize=_e.getCard8(e,t+3),n.startOffset=t,n.endOffset=t+4,n}var ot=[{name:"version",op:0,type:"SID"},{name:"notice",op:1,type:"SID"},{name:"copyright",op:1200,type:"SID"},{name:"fullName",op:2,type:"SID"},{name:"familyName",op:3,type:"SID"},{name:"weight",op:4,type:"SID"},{name:"isFixedPitch",op:1201,type:"number",value:0},{name:"italicAngle",op:1202,type:"number",value:0},{name:"underlinePosition",op:1203,type:"number",value:-100},{name:"underlineThickness",op:1204,type:"number",value:50},{name:"paintType",op:1205,type:"number",value:0},{name:"charstringType",op:1206,type:"number",value:2},{name:"fontMatrix",op:1207,type:["real","real","real","real","real","real"],value:[.001,0,0,.001,0,0]},{name:"uniqueId",op:13,type:"number"},{name:"fontBBox",op:5,type:["number","number","number","number"],value:[0,0,0,0]},{name:"strokeWidth",op:1208,type:"number",value:0},{name:"xuid",op:14,type:[],value:null},{name:"charset",op:15,type:"offset",value:0},{name:"encoding",op:16,type:"offset",value:0},{name:"charStrings",op:17,type:"offset",value:0},{name:"private",op:18,type:["number","offset"],value:[0,0]},{name:"ros",op:1230,type:["SID","SID","number"]},{name:"cidFontVersion",op:1231,type:"number",value:0},{name:"cidFontRevision",op:1232,type:"number",value:0},{name:"cidFontType",op:1233,type:"number",value:0},{name:"cidCount",op:1234,type:"number",value:8720},{name:"uidBase",op:1235,type:"number"},{name:"fdArray",op:1236,type:"offset"},{name:"fdSelect",op:1237,type:"offset"},{name:"fontName",op:1238,type:"SID"}],rt=[{name:"subrs",op:19,type:"offset",value:0},{name:"defaultWidthX",op:20,type:"number",value:0},{name:"nominalWidthX",op:21,type:"number",value:0}];function st(e,t){return nt(et(e,0,e.byteLength),ot,t)}function at(e,t,n,i){return nt(et(e,t,n),rt,i)}function ut(e,t,n,i){for(var o=[],r=0;r<n.length;r+=1){var s=st(new DataView(new Uint8Array(n[r]).buffer),i);s._subrs=[],s._subrsBias=0,s._defaultWidthX=0,s._nominalWidthX=0;var a=s.private[0],u=s.private[1];if(0!==a&&0!==u){var l=at(e,u+t,a,i);if(s._defaultWidthX=l.defaultWidthX,s._nominalWidthX=l.nominalWidthX,0!==l.subrs){var c=Ye(e,u+l.subrs+t);s._subrs=c.objects,s._subrsBias=We(s._subrs)}s._privateDict=l}o.push(s)}return o}function lt(e,t,n,i){var o,r,s=new _e.Parser(e,t);n-=1;var a=[".notdef"],u=s.parseCard8();if(0===u)for(var l=0;l<n;l+=1)o=s.parseSID(),a.push(tt(i,o));else if(1===u)for(;a.length<=n;){o=s.parseSID(),r=s.parseCard8();for(var c=0;c<=r;c+=1)a.push(tt(i,o)),o+=1}else{if(2!==u)throw new Error("Unknown charset format "+u);for(;a.length<=n;){o=s.parseSID(),r=s.parseCard16();for(var h=0;h<=r;h+=1)a.push(tt(i,o)),o+=1}}return a}function ct(e,t,n){var i,o={},r=new _e.Parser(e,t),s=r.parseCard8();if(0===s)for(var a=r.parseCard8(),u=0;u<a;u+=1)o[i=r.parseCard8()]=u;else{if(1!==s)throw new Error("Unknown encoding format "+s);var l=r.parseCard8();i=1;for(var c=0;c<l;c+=1)for(var h=r.parseCard8(),d=r.parseCard8(),p=h;p<=h+d;p+=1)o[p]=i,i+=1}return new De(o,n)}function ht(e,t,n){var i,o,r,s,a,u,l,c,h=new D,d=[],p=0,f=!1,g=!1,m=0,_=0;if(e.isCIDFont){var y=e.tables.cff.topDict._fdSelect[t.index],x=e.tables.cff.topDict._fdArray[y];a=x._subrs,u=x._subrsBias,l=x._defaultWidthX,c=x._nominalWidthX}else a=e.tables.cff.topDict._subrs,u=e.tables.cff.topDict._subrsBias,l=e.tables.cff.topDict._defaultWidthX,c=e.tables.cff.topDict._nominalWidthX;var w=l;function v(e,t){g&&h.closePath(),h.moveTo(e,t),g=!0}function b(){d.length%2!=0&&!f&&(w=d.shift()+c),p+=d.length>>1,d.length=0,f=!0}function S(n){for(var l,y,x,T,E,C,O,N,F,M,D,I,R=0;R<n.length;){var V=n[R];switch(R+=1,V){case 1:case 3:case 18:case 23:b();break;case 4:d.length>1&&!f&&(w=d.shift()+c,f=!0),_+=d.pop(),v(m,_);break;case 5:for(;d.length>0;)m+=d.shift(),_+=d.shift(),h.lineTo(m,_);break;case 6:for(;d.length>0&&(m+=d.shift(),h.lineTo(m,_),0!==d.length);)_+=d.shift(),h.lineTo(m,_);break;case 7:for(;d.length>0&&(_+=d.shift(),h.lineTo(m,_),0!==d.length);)m+=d.shift(),h.lineTo(m,_);break;case 8:for(;d.length>0;)i=m+d.shift(),o=_+d.shift(),r=i+d.shift(),s=o+d.shift(),m=r+d.shift(),_=s+d.shift(),h.curveTo(i,o,r,s,m,_);break;case 10:E=d.pop()+u,(C=a[E])&&S(C);break;case 11:return;case 12:switch(V=n[R],R+=1,V){case 35:i=m+d.shift(),o=_+d.shift(),r=i+d.shift(),s=o+d.shift(),O=r+d.shift(),N=s+d.shift(),F=O+d.shift(),M=N+d.shift(),D=F+d.shift(),I=M+d.shift(),m=D+d.shift(),_=I+d.shift(),d.shift(),h.curveTo(i,o,r,s,O,N),h.curveTo(F,M,D,I,m,_);break;case 34:i=m+d.shift(),o=_,r=i+d.shift(),s=o+d.shift(),O=r+d.shift(),N=s,F=O+d.shift(),M=s,D=F+d.shift(),I=_,m=D+d.shift(),h.curveTo(i,o,r,s,O,N),h.curveTo(F,M,D,I,m,_);break;case 36:i=m+d.shift(),o=_+d.shift(),r=i+d.shift(),s=o+d.shift(),O=r+d.shift(),N=s,F=O+d.shift(),M=s,D=F+d.shift(),I=M+d.shift(),m=D+d.shift(),h.curveTo(i,o,r,s,O,N),h.curveTo(F,M,D,I,m,_);break;case 37:i=m+d.shift(),o=_+d.shift(),r=i+d.shift(),s=o+d.shift(),O=r+d.shift(),N=s+d.shift(),F=O+d.shift(),M=N+d.shift(),D=F+d.shift(),I=M+d.shift(),Math.abs(D-m)>Math.abs(I-_)?m=D+d.shift():_=I+d.shift(),h.curveTo(i,o,r,s,O,N),h.curveTo(F,M,D,I,m,_);break;default:console.log("Glyph "+t.index+": unknown operator 1200"+V),d.length=0}break;case 14:d.length>0&&!f&&(w=d.shift()+c,f=!0),g&&(h.closePath(),g=!1);break;case 19:case 20:b(),R+=p+7>>3;break;case 21:d.length>2&&!f&&(w=d.shift()+c,f=!0),_+=d.pop(),v(m+=d.pop(),_);break;case 22:d.length>1&&!f&&(w=d.shift()+c,f=!0),v(m+=d.pop(),_);break;case 24:for(;d.length>2;)i=m+d.shift(),o=_+d.shift(),r=i+d.shift(),s=o+d.shift(),m=r+d.shift(),_=s+d.shift(),h.curveTo(i,o,r,s,m,_);m+=d.shift(),_+=d.shift(),h.lineTo(m,_);break;case 25:for(;d.length>6;)m+=d.shift(),_+=d.shift(),h.lineTo(m,_);i=m+d.shift(),o=_+d.shift(),r=i+d.shift(),s=o+d.shift(),m=r+d.shift(),_=s+d.shift(),h.curveTo(i,o,r,s,m,_);break;case 26:for(d.length%2&&(m+=d.shift());d.length>0;)i=m,o=_+d.shift(),r=i+d.shift(),s=o+d.shift(),m=r,_=s+d.shift(),h.curveTo(i,o,r,s,m,_);break;case 27:for(d.length%2&&(_+=d.shift());d.length>0;)i=m+d.shift(),o=_,r=i+d.shift(),s=o+d.shift(),m=r+d.shift(),_=s,h.curveTo(i,o,r,s,m,_);break;case 28:l=n[R],y=n[R+1],d.push((l<<24|y<<16)>>16),R+=2;break;case 29:E=d.pop()+e.gsubrsBias,(C=e.gsubrs[E])&&S(C);break;case 30:for(;d.length>0&&(i=m,o=_+d.shift(),r=i+d.shift(),s=o+d.shift(),m=r+d.shift(),_=s+(1===d.length?d.shift():0),h.curveTo(i,o,r,s,m,_),0!==d.length);)i=m+d.shift(),o=_,r=i+d.shift(),s=o+d.shift(),_=s+d.shift(),m=r+(1===d.length?d.shift():0),h.curveTo(i,o,r,s,m,_);break;case 31:for(;d.length>0&&(i=m+d.shift(),o=_,r=i+d.shift(),s=o+d.shift(),_=s+d.shift(),m=r+(1===d.length?d.shift():0),h.curveTo(i,o,r,s,m,_),0!==d.length);)i=m,o=_+d.shift(),r=i+d.shift(),s=o+d.shift(),m=r+d.shift(),_=s+(1===d.length?d.shift():0),h.curveTo(i,o,r,s,m,_);break;default:V<32?console.log("Glyph "+t.index+": unknown operator "+V):V<247?d.push(V-139):V<251?(l=n[R],R+=1,d.push(256*(V-247)+l+108)):V<255?(l=n[R],R+=1,d.push(256*-(V-251)-l-108)):(l=n[R],y=n[R+1],x=n[R+2],T=n[R+3],R+=4,d.push((l<<24|y<<16|x<<8|T)/65536))}}}return S(n),t.advanceWidth=w,h}function dt(e,t,n,i){var o,r=[],s=new _e.Parser(e,t),a=s.parseCard8();if(0===a)for(var u=0;u<n;u++){if((o=s.parseCard8())>=i)throw new Error("CFF table CID Font FDSelect has bad FD index value "+o+" (FD count "+i+")");r.push(o)}else{if(3!==a)throw new Error("CFF Table CID Font FDSelect table has unsupported format "+a);var l,c=s.parseCard16(),h=s.parseCard16();if(0!==h)throw new Error("CFF Table CID Font FDSelect format 3 range has bad initial GID "+h);for(var d=0;d<c;d++){if(o=s.parseCard8(),l=s.parseCard16(),o>=i)throw new Error("CFF table CID Font FDSelect has bad FD index value "+o+" (FD count "+i+")");if(l>n)throw new Error("CFF Table CID Font FDSelect format 3 range has bad GID "+l);for(;h<l;h++)r.push(o);h=l}if(l!==n)throw new Error("CFF Table CID Font FDSelect format 3 range has bad final GID "+l)}return r}function pt(e,t,n,i){n.tables.cff={};var o=it(e,t),r=Ye(e,o.endOffset,_e.bytesToString),s=Ye(e,r.endOffset),a=Ye(e,s.endOffset,_e.bytesToString),u=Ye(e,a.endOffset);n.gsubrs=u.objects,n.gsubrsBias=We(n.gsubrs);var l=ut(e,t,s.objects,a.objects);if(1!==l.length)throw new Error("CFF table has too many fonts in 'FontSet' - count of fonts NameIndex.length = "+l.length);var c=l[0];if(n.tables.cff.topDict=c,c._privateDict&&(n.defaultWidthX=c._privateDict.defaultWidthX,n.nominalWidthX=c._privateDict.nominalWidthX),void 0!==c.ros[0]&&void 0!==c.ros[1]&&(n.isCIDFont=!0),n.isCIDFont){var h=c.fdArray,d=c.fdSelect;if(0===h||0===d)throw new Error("Font is marked as a CID font, but FDArray and/or FDSelect information is missing");var p=Ye(e,h+=t),f=ut(e,t,p.objects,a.objects);c._fdArray=f,d+=t,c._fdSelect=dt(e,d,n.numGlyphs,f.length)}var g,m=t+c.private[1],_=at(e,m,c.private[0],a.objects);if(n.defaultWidthX=_.defaultWidthX,n.nominalWidthX=_.nominalWidthX,0!==_.subrs){var y=m+_.subrs,x=Ye(e,y);n.subrs=x.objects,n.subrsBias=We(n.subrs)}else n.subrs=[],n.subrsBias=0;i.lowMemory?(g=Ke(e,t+c.charStrings),n.nGlyphs=g.offsets.length):(g=Ye(e,t+c.charStrings),n.nGlyphs=g.objects.length);var w=lt(e,t+c.charset,n.nGlyphs,a.objects);if(0===c.encoding?n.cffEncoding=new De(Ce,w):1===c.encoding?n.cffEncoding=new De(Oe,w):n.cffEncoding=ct(e,t+c.encoding,w),n.encoding=n.encoding||n.cffEncoding,n.glyphs=new He.GlyphSet(n),i.lowMemory)n._push=function(i){var o=Ze(i,g.offsets,e,t+c.charStrings);n.glyphs.push(i,He.cffGlyphLoader(n,i,ht,o))};else for(var v=0;v<n.nGlyphs;v+=1){var b=g.objects[v];n.glyphs.push(v,He.cffGlyphLoader(n,v,ht,b))}}function ft(e,t){var n,i=Ee.indexOf(e);return i>=0&&(n=i),(i=t.indexOf(e))>=0?n=i+Ee.length:(n=Ee.length+t.length,t.push(e)),n}function gt(){return new oe.Record("Header",[{name:"major",type:"Card8",value:1},{name:"minor",type:"Card8",value:0},{name:"hdrSize",type:"Card8",value:4},{name:"major",type:"Card8",value:1}])}function mt(e){var t=new oe.Record("Name INDEX",[{name:"names",type:"INDEX",value:[]}]);t.names=[];for(var n=0;n<e.length;n+=1)t.names.push({name:"name_"+n,type:"NAME",value:e[n]});return t}function _t(e,t,n){for(var i={},o=0;o<e.length;o+=1){var r=e[o],s=t[r.name];void 0===s||qe(s,r.value)||("SID"===r.type&&(s=ft(s,n)),i[r.op]={name:r.name,type:r.type,value:s})}return i}function yt(e,t){var n=new oe.Record("Top DICT",[{name:"dict",type:"DICT",value:{}}]);return n.dict=_t(ot,e,t),n}function xt(e){var t=new oe.Record("Top DICT INDEX",[{name:"topDicts",type:"INDEX",value:[]}]);return t.topDicts=[{name:"topDict_0",type:"TABLE",value:e}],t}function wt(e){var t=new oe.Record("String INDEX",[{name:"strings",type:"INDEX",value:[]}]);t.strings=[];for(var n=0;n<e.length;n+=1)t.strings.push({name:"string_"+n,type:"STRING",value:e[n]});return t}function vt(){return new oe.Record("Global Subr INDEX",[{name:"subrs",type:"INDEX",value:[]}])}function bt(e,t){for(var n=new oe.Record("Charsets",[{name:"format",type:"Card8",value:0}]),i=0;i<e.length;i+=1){var o=ft(e[i],t);n.fields.push({name:"glyph_"+i,type:"SID",value:o})}return n}function St(e){var t=[],n=e.path;t.push({name:"width",type:"NUMBER",value:e.advanceWidth});for(var i=0,o=0,r=0;r<n.commands.length;r+=1){var s=void 0,a=void 0,u=n.commands[r];if("Q"===u.type){var l=1/3,c=2/3;u={type:"C",x:u.x,y:u.y,x1:Math.round(l*i+c*u.x1),y1:Math.round(l*o+c*u.y1),x2:Math.round(l*u.x+c*u.x1),y2:Math.round(l*u.y+c*u.y1)}}if("M"===u.type)s=Math.round(u.x-i),a=Math.round(u.y-o),t.push({name:"dx",type:"NUMBER",value:s}),t.push({name:"dy",type:"NUMBER",value:a}),t.push({name:"rmoveto",type:"OP",value:21}),i=Math.round(u.x),o=Math.round(u.y);else if("L"===u.type)s=Math.round(u.x-i),a=Math.round(u.y-o),t.push({name:"dx",type:"NUMBER",value:s}),t.push({name:"dy",type:"NUMBER",value:a}),t.push({name:"rlineto",type:"OP",value:5}),i=Math.round(u.x),o=Math.round(u.y);else if("C"===u.type){var h=Math.round(u.x1-i),d=Math.round(u.y1-o),p=Math.round(u.x2-u.x1),f=Math.round(u.y2-u.y1);s=Math.round(u.x-u.x2),a=Math.round(u.y-u.y2),t.push({name:"dx1",type:"NUMBER",value:h}),t.push({name:"dy1",type:"NUMBER",value:d}),t.push({name:"dx2",type:"NUMBER",value:p}),t.push({name:"dy2",type:"NUMBER",value:f}),t.push({name:"dx",type:"NUMBER",value:s}),t.push({name:"dy",type:"NUMBER",value:a}),t.push({name:"rrcurveto",type:"OP",value:8}),i=Math.round(u.x),o=Math.round(u.y)}}return t.push({name:"endchar",type:"OP",value:14}),t}function Tt(e){for(var t=new oe.Record("CharStrings INDEX",[{name:"charStrings",type:"INDEX",value:[]}]),n=0;n<e.length;n+=1){var i=e.get(n),o=St(i);t.charStrings.push({name:i.name,type:"CHARSTRING",value:o})}return t}function Et(e,t){var n=new oe.Record("Private DICT",[{name:"dict",type:"DICT",value:{}}]);return n.dict=_t(rt,e,t),n}function Ct(e,t){for(var n,i=new oe.Table("CFF ",[{name:"header",type:"RECORD"},{name:"nameIndex",type:"RECORD"},{name:"topDictIndex",type:"RECORD"},{name:"stringIndex",type:"RECORD"},{name:"globalSubrIndex",type:"RECORD"},{name:"charsets",type:"RECORD"},{name:"charStringsIndex",type:"RECORD"},{name:"privateDict",type:"RECORD"}]),o=1/t.unitsPerEm,r={version:t.version,fullName:t.fullName,familyName:t.familyName,weight:t.weightName,fontBBox:t.fontBBox||[0,0,0,0],fontMatrix:[o,0,0,o,0,0],charset:999,encoding:0,charStrings:999,private:[0,999]},s={},a=[],u=1;u<e.length;u+=1)n=e.get(u),a.push(n.name);var l=[];i.header=gt(),i.nameIndex=mt([t.postScriptName]);var c=yt(r,l);i.topDictIndex=xt(c),i.globalSubrIndex=vt(),i.charsets=bt(a,l),i.charStringsIndex=Tt(e),i.privateDict=Et(s,l),i.stringIndex=wt(l);var h=i.header.sizeOf()+i.nameIndex.sizeOf()+i.topDictIndex.sizeOf()+i.stringIndex.sizeOf()+i.globalSubrIndex.sizeOf();return r.charset=h,r.encoding=0,r.charStrings=r.charset+i.charsets.sizeOf(),r.private[1]=r.charStrings+i.charStringsIndex.sizeOf(),c=yt(r,l),i.topDictIndex=xt(c),i}var Ot={parse:pt,make:Ct};function Nt(e,t){var n={},i=new _e.Parser(e,t);return n.version=i.parseVersion(),n.fontRevision=Math.round(1e3*i.parseFixed())/1e3,n.checkSumAdjustment=i.parseULong(),n.magicNumber=i.parseULong(),V.argument(1594834165===n.magicNumber,"Font header has wrong magic number."),n.flags=i.parseUShort(),n.unitsPerEm=i.parseUShort(),n.created=i.parseLongDateTime(),n.modified=i.parseLongDateTime(),n.xMin=i.parseShort(),n.yMin=i.parseShort(),n.xMax=i.parseShort(),n.yMax=i.parseShort(),n.macStyle=i.parseUShort(),n.lowestRecPPEM=i.parseUShort(),n.fontDirectionHint=i.parseShort(),n.indexToLocFormat=i.parseShort(),n.glyphDataFormat=i.parseShort(),n}function Ft(e){var t=Math.round((new Date).getTime()/1e3)+2082844800,n=t;return e.createdTimestamp&&(n=e.createdTimestamp+2082844800),new oe.Table("head",[{name:"version",type:"FIXED",value:65536},{name:"fontRevision",type:"FIXED",value:65536},{name:"checkSumAdjustment",type:"ULONG",value:0},{name:"magicNumber",type:"ULONG",value:1594834165},{name:"flags",type:"USHORT",value:0},{name:"unitsPerEm",type:"USHORT",value:1e3},{name:"created",type:"LONGDATETIME",value:n},{name:"modified",type:"LONGDATETIME",value:t},{name:"xMin",type:"SHORT",value:0},{name:"yMin",type:"SHORT",value:0},{name:"xMax",type:"SHORT",value:0},{name:"yMax",type:"SHORT",value:0},{name:"macStyle",type:"USHORT",value:0},{name:"lowestRecPPEM",type:"USHORT",value:0},{name:"fontDirectionHint",type:"SHORT",value:2},{name:"indexToLocFormat",type:"SHORT",value:0},{name:"glyphDataFormat",type:"SHORT",value:0}],e)}var Mt={parse:Nt,make:Ft};function Dt(e,t){var n={},i=new _e.Parser(e,t);return n.version=i.parseVersion(),n.ascender=i.parseShort(),n.descender=i.parseShort(),n.lineGap=i.parseShort(),n.advanceWidthMax=i.parseUShort(),n.minLeftSideBearing=i.parseShort(),n.minRightSideBearing=i.parseShort(),n.xMaxExtent=i.parseShort(),n.caretSlopeRise=i.parseShort(),n.caretSlopeRun=i.parseShort(),n.caretOffset=i.parseShort(),i.relativeOffset+=8,n.metricDataFormat=i.parseShort(),n.numberOfHMetrics=i.parseUShort(),n}function It(e){return new oe.Table("hhea",[{name:"version",type:"FIXED",value:65536},{name:"ascender",type:"FWORD",value:0},{name:"descender",type:"FWORD",value:0},{name:"lineGap",type:"FWORD",value:0},{name:"advanceWidthMax",type:"UFWORD",value:0},{name:"minLeftSideBearing",type:"FWORD",value:0},{name:"minRightSideBearing",type:"FWORD",value:0},{name:"xMaxExtent",type:"FWORD",value:0},{name:"caretSlopeRise",type:"SHORT",value:1},{name:"caretSlopeRun",type:"SHORT",value:0},{name:"caretOffset",type:"SHORT",value:0},{name:"reserved1",type:"SHORT",value:0},{name:"reserved2",type:"SHORT",value:0},{name:"reserved3",type:"SHORT",value:0},{name:"reserved4",type:"SHORT",value:0},{name:"metricDataFormat",type:"SHORT",value:0},{name:"numberOfHMetrics",type:"USHORT",value:0}],e)}var Rt={parse:Dt,make:It};function Vt(e,t,n,i,o){for(var r,s,a=new _e.Parser(e,t),u=0;u<i;u+=1){u<n&&(r=a.parseUShort(),s=a.parseShort());var l=o.get(u);l.advanceWidth=r,l.leftSideBearing=s}}function Pt(e,t,n,i,o){var r,s;e._hmtxTableData={};for(var a=new _e.Parser(t,n),u=0;u<o;u+=1)u<i&&(r=a.parseUShort(),s=a.parseShort()),e._hmtxTableData[u]={advanceWidth:r,leftSideBearing:s}}function At(e,t,n,i,o,r,s){s.lowMemory?Pt(e,t,n,i,o):Vt(t,n,i,o,r)}function Lt(e){for(var t=new oe.Table("hmtx",[]),n=0;n<e.length;n+=1){var i=e.get(n),o=i.advanceWidth||0,r=i.leftSideBearing||0;t.fields.push({name:"advanceWidth_"+n,type:"USHORT",value:o}),t.fields.push({name:"leftSideBearing_"+n,type:"SHORT",value:r})}return t}var Ut={parse:At,make:Lt};function Bt(e){for(var t=new oe.Table("ltag",[{name:"version",type:"ULONG",value:1},{name:"flags",type:"ULONG",value:0},{name:"numTags",type:"ULONG",value:e.length}]),n="",i=12+4*e.length,o=0;o<e.length;++o){var r=n.indexOf(e[o]);r<0&&(r=n.length,n+=e[o]),t.fields.push({name:"offset "+o,type:"USHORT",value:i+r}),t.fields.push({name:"length "+o,type:"USHORT",value:e[o].length})}return t.fields.push({name:"stringPool",type:"CHARARRAY",value:n}),t}function Xt(e,t){var n=new _e.Parser(e,t),i=n.parseULong();V.argument(1===i,"Unsupported ltag table version."),n.skip("uLong",1);for(var o=n.parseULong(),r=[],s=0;s<o;s++){for(var a="",u=t+n.parseUShort(),l=n.parseUShort(),c=u;c<u+l;++c)a+=String.fromCharCode(e.getInt8(c));r.push(a)}return r}var kt={make:Bt,parse:Xt};function zt(e,t){var n={},i=new _e.Parser(e,t);return n.version=i.parseVersion(),n.numGlyphs=i.parseUShort(),1===n.version&&(n.maxPoints=i.parseUShort(),n.maxContours=i.parseUShort(),n.maxCompositePoints=i.parseUShort(),n.maxCompositeContours=i.parseUShort(),n.maxZones=i.parseUShort(),n.maxTwilightPoints=i.parseUShort(),n.maxStorage=i.parseUShort(),n.maxFunctionDefs=i.parseUShort(),n.maxInstructionDefs=i.parseUShort(),n.maxStackElements=i.parseUShort(),n.maxSizeOfInstructions=i.parseUShort(),n.maxComponentElements=i.parseUShort(),n.maxComponentDepth=i.parseUShort()),n}function jt(e){return new oe.Table("maxp",[{name:"version",type:"FIXED",value:20480},{name:"numGlyphs",type:"USHORT",value:e}])}var Gt={parse:zt,make:jt},Ht=["copyright","fontFamily","fontSubfamily","uniqueID","fullName","version","postScriptName","trademark","manufacturer","designer","description","manufacturerURL","designerURL","license","licenseURL","reserved","preferredFamily","preferredSubfamily","compatibleFullName","sampleText","postScriptFindFontName","wwsFamily","wwsSubfamily"],qt={0:"en",1:"fr",2:"de",3:"it",4:"nl",5:"sv",6:"es",7:"da",8:"pt",9:"no",10:"he",11:"ja",12:"ar",13:"fi",14:"el",15:"is",16:"mt",17:"tr",18:"hr",19:"zh-Hant",20:"ur",21:"hi",22:"th",23:"ko",24:"lt",25:"pl",26:"hu",27:"es",28:"lv",29:"se",30:"fo",31:"fa",32:"ru",33:"zh",34:"nl-BE",35:"ga",36:"sq",37:"ro",38:"cz",39:"sk",40:"si",41:"yi",42:"sr",43:"mk",44:"bg",45:"uk",46:"be",47:"uz",48:"kk",49:"az-Cyrl",50:"az-Arab",51:"hy",52:"ka",53:"mo",54:"ky",55:"tg",56:"tk",57:"mn-CN",58:"mn",59:"ps",60:"ks",61:"ku",62:"sd",63:"bo",64:"ne",65:"sa",66:"mr",67:"bn",68:"as",69:"gu",70:"pa",71:"or",72:"ml",73:"kn",74:"ta",75:"te",76:"si",77:"my",78:"km",79:"lo",80:"vi",81:"id",82:"tl",83:"ms",84:"ms-Arab",85:"am",86:"ti",87:"om",88:"so",89:"sw",90:"rw",91:"rn",92:"ny",93:"mg",94:"eo",128:"cy",129:"eu",130:"ca",131:"la",132:"qu",133:"gn",134:"ay",135:"tt",136:"ug",137:"dz",138:"jv",139:"su",140:"gl",141:"af",142:"br",143:"iu",144:"gd",145:"gv",146:"ga",147:"to",148:"el-polyton",149:"kl",150:"az",151:"nn"},Wt={0:0,1:0,2:0,3:0,4:0,5:0,6:0,7:0,8:0,9:0,10:5,11:1,12:4,13:0,14:6,15:0,16:0,17:0,18:0,19:2,20:4,21:9,22:21,23:3,24:29,25:29,26:29,27:29,28:29,29:0,30:0,31:4,32:7,33:25,34:0,35:0,36:0,37:0,38:29,39:29,40:0,41:5,42:7,43:7,44:7,45:7,46:7,47:7,48:7,49:7,50:4,51:24,52:23,53:7,54:7,55:7,56:7,57:27,58:7,59:4,60:4,61:4,62:4,63:26,64:9,65:9,66:9,67:13,68:13,69:11,70:10,71:12,72:17,73:16,74:14,75:15,76:18,77:19,78:20,79:22,80:30,81:0,82:0,83:0,84:4,85:28,86:28,87:28,88:0,89:0,90:0,91:0,92:0,93:0,94:0,128:0,129:0,130:0,131:0,132:0,133:0,134:0,135:7,136:4,137:26,138:0,139:0,140:0,141:0,142:0,143:28,144:0,145:0,146:0,147:0,148:6,149:0,150:0,151:0},Yt={1078:"af",1052:"sq",1156:"gsw",1118:"am",5121:"ar-DZ",15361:"ar-BH",3073:"ar",2049:"ar-IQ",11265:"ar-JO",13313:"ar-KW",12289:"ar-LB",4097:"ar-LY",6145:"ary",8193:"ar-OM",16385:"ar-QA",1025:"ar-SA",10241:"ar-SY",7169:"aeb",14337:"ar-AE",9217:"ar-YE",1067:"hy",1101:"as",2092:"az-Cyrl",1068:"az",1133:"ba",1069:"eu",1059:"be",2117:"bn",1093:"bn-IN",8218:"bs-Cyrl",5146:"bs",1150:"br",1026:"bg",1027:"ca",3076:"zh-HK",5124:"zh-MO",2052:"zh",4100:"zh-SG",1028:"zh-TW",1155:"co",1050:"hr",4122:"hr-BA",1029:"cs",1030:"da",1164:"prs",1125:"dv",2067:"nl-BE",1043:"nl",3081:"en-AU",10249:"en-BZ",4105:"en-CA",9225:"en-029",16393:"en-IN",6153:"en-IE",8201:"en-JM",17417:"en-MY",5129:"en-NZ",13321:"en-PH",18441:"en-SG",7177:"en-ZA",11273:"en-TT",2057:"en-GB",1033:"en",12297:"en-ZW",1061:"et",1080:"fo",1124:"fil",1035:"fi",2060:"fr-BE",3084:"fr-CA",1036:"fr",5132:"fr-LU",6156:"fr-MC",4108:"fr-CH",1122:"fy",1110:"gl",1079:"ka",3079:"de-AT",1031:"de",5127:"de-LI",4103:"de-LU",2055:"de-CH",1032:"el",1135:"kl",1095:"gu",1128:"ha",1037:"he",1081:"hi",1038:"hu",1039:"is",1136:"ig",1057:"id",1117:"iu",2141:"iu-Latn",2108:"ga",1076:"xh",1077:"zu",1040:"it",2064:"it-CH",1041:"ja",1099:"kn",1087:"kk",1107:"km",1158:"quc",1159:"rw",1089:"sw",1111:"kok",1042:"ko",1088:"ky",1108:"lo",1062:"lv",1063:"lt",2094:"dsb",1134:"lb",1071:"mk",2110:"ms-BN",1086:"ms",1100:"ml",1082:"mt",1153:"mi",1146:"arn",1102:"mr",1148:"moh",1104:"mn",2128:"mn-CN",1121:"ne",1044:"nb",2068:"nn",1154:"oc",1096:"or",1123:"ps",1045:"pl",1046:"pt",2070:"pt-PT",1094:"pa",1131:"qu-BO",2155:"qu-EC",3179:"qu",1048:"ro",1047:"rm",1049:"ru",9275:"smn",4155:"smj-NO",5179:"smj",3131:"se-FI",1083:"se",2107:"se-SE",8251:"sms",6203:"sma-NO",7227:"sms",1103:"sa",7194:"sr-Cyrl-BA",3098:"sr",6170:"sr-Latn-BA",2074:"sr-Latn",1132:"nso",1074:"tn",1115:"si",1051:"sk",1060:"sl",11274:"es-AR",16394:"es-BO",13322:"es-CL",9226:"es-CO",5130:"es-CR",7178:"es-DO",12298:"es-EC",17418:"es-SV",4106:"es-GT",18442:"es-HN",2058:"es-MX",19466:"es-NI",6154:"es-PA",15370:"es-PY",10250:"es-PE",20490:"es-PR",3082:"es",1034:"es",21514:"es-US",14346:"es-UY",8202:"es-VE",2077:"sv-FI",1053:"sv",1114:"syr",1064:"tg",2143:"tzm",1097:"ta",1092:"tt",1098:"te",1054:"th",1105:"bo",1055:"tr",1090:"tk",1152:"ug",1058:"uk",1070:"hsb",1056:"ur",2115:"uz-Cyrl",1091:"uz",1066:"vi",1106:"cy",1160:"wo",1157:"sah",1144:"ii",1130:"yo"};function Kt(e,t,n){switch(e){case 0:if(65535===t)return"und";if(n)return n[t];break;case 1:return qt[t];case 3:return Yt[t]}}var Zt="utf-16",Qt={0:"macintosh",1:"x-mac-japanese",2:"x-mac-chinesetrad",3:"x-mac-korean",6:"x-mac-greek",7:"x-mac-cyrillic",9:"x-mac-devanagai",10:"x-mac-gurmukhi",11:"x-mac-gujarati",12:"x-mac-oriya",13:"x-mac-bengali",14:"x-mac-tamil",15:"x-mac-telugu",16:"x-mac-kannada",17:"x-mac-malayalam",18:"x-mac-sinhalese",19:"x-mac-burmese",20:"x-mac-khmer",21:"x-mac-thai",22:"x-mac-lao",23:"x-mac-georgian",24:"x-mac-armenian",25:"x-mac-chinesesimp",26:"x-mac-tibetan",27:"x-mac-mongolian",28:"x-mac-ethiopic",29:"x-mac-ce",30:"x-mac-vietnamese",31:"x-mac-extarabic"},$t={15:"x-mac-icelandic",17:"x-mac-turkish",18:"x-mac-croatian",24:"x-mac-ce",25:"x-mac-ce",26:"x-mac-ce",27:"x-mac-ce",28:"x-mac-ce",30:"x-mac-icelandic",37:"x-mac-romanian",38:"x-mac-ce",39:"x-mac-ce",40:"x-mac-ce",143:"x-mac-inuit",146:"x-mac-gaelic"};function Jt(e,t,n){switch(e){case 0:return Zt;case 1:return $t[n]||Qt[t];case 3:if(1===t||10===t)return Zt}}function en(e,t,n){for(var i={},o=new _e.Parser(e,t),r=o.parseUShort(),s=o.parseUShort(),a=o.offset+o.parseUShort(),u=0;u<s;u++){var l=o.parseUShort(),c=o.parseUShort(),h=o.parseUShort(),d=o.parseUShort(),p=Ht[d]||d,f=o.parseUShort(),g=o.parseUShort(),m=Kt(l,h,n),_=Jt(l,c,h);if(void 0!==_&&void 0!==m){var y=void 0;if(y=_===Zt?L.UTF16(e,a+g,f):L.MACSTRING(e,a+g,f,_)){var x=i[p];void 0===x&&(x=i[p]={}),x[m]=y}}}return 1===r&&o.parseUShort(),i}function tn(e){var t={};for(var n in e)t[e[n]]=parseInt(n);return t}function nn(e,t,n,i,o,r){return new oe.Record("NameRecord",[{name:"platformID",type:"USHORT",value:e},{name:"encodingID",type:"USHORT",value:t},{name:"languageID",type:"USHORT",value:n},{name:"nameID",type:"USHORT",value:i},{name:"length",type:"USHORT",value:o},{name:"offset",type:"USHORT",value:r}])}function on(e,t){var n=e.length,i=t.length-n+1;e:for(var o=0;o<i;o++)for(;o<i;o++){for(var r=0;r<n;r++)if(t[o+r]!==e[r])continue e;return o}return-1}function rn(e,t){var n=on(e,t);if(n<0){n=t.length;for(var i=0,o=e.length;i<o;++i)t.push(e[i])}return n}function sn(e,t){var n,i=[],o={},r=tn(Ht);for(var s in e){var a=r[s];if(void 0===a&&(a=s),n=parseInt(a),isNaN(n))throw new Error('Name table entry "'+s+'" does not exist, see nameTableNames for complete list.');o[n]=e[s],i.push(n)}for(var u=tn(qt),l=tn(Yt),c=[],h=[],d=0;d<i.length;d++){var p=o[n=i[d]];for(var f in p){var g=p[f],m=1,_=u[f],y=Wt[_],x=Jt(m,y,_),w=U.MACSTRING(g,x);void 0===w&&(m=0,(_=t.indexOf(f))<0&&(_=t.length,t.push(f)),y=4,w=U.UTF16(g));var v=rn(w,h);c.push(nn(m,y,_,n,w.length,v));var b=l[f];if(void 0!==b){var S=U.UTF16(g),T=rn(S,h);c.push(nn(3,1,b,n,S.length,T))}}}c.sort((function(e,t){return e.platformID-t.platformID||e.encodingID-t.encodingID||e.languageID-t.languageID||e.nameID-t.nameID}));for(var E=new oe.Table("name",[{name:"format",type:"USHORT",value:0},{name:"count",type:"USHORT",value:c.length},{name:"stringOffset",type:"USHORT",value:6+12*c.length}]),C=0;C<c.length;C++)E.fields.push({name:"record_"+C,type:"RECORD",value:c[C]});return E.fields.push({name:"strings",type:"LITERAL",value:h}),E}var an={parse:en,make:sn},un=[{begin:0,end:127},{begin:128,end:255},{begin:256,end:383},{begin:384,end:591},{begin:592,end:687},{begin:688,end:767},{begin:768,end:879},{begin:880,end:1023},{begin:11392,end:11519},{begin:1024,end:1279},{begin:1328,end:1423},{begin:1424,end:1535},{begin:42240,end:42559},{begin:1536,end:1791},{begin:1984,end:2047},{begin:2304,end:2431},{begin:2432,end:2559},{begin:2560,end:2687},{begin:2688,end:2815},{begin:2816,end:2943},{begin:2944,end:3071},{begin:3072,end:3199},{begin:3200,end:3327},{begin:3328,end:3455},{begin:3584,end:3711},{begin:3712,end:3839},{begin:4256,end:4351},{begin:6912,end:7039},{begin:4352,end:4607},{begin:7680,end:7935},{begin:7936,end:8191},{begin:8192,end:8303},{begin:8304,end:8351},{begin:8352,end:8399},{begin:8400,end:8447},{begin:8448,end:8527},{begin:8528,end:8591},{begin:8592,end:8703},{begin:8704,end:8959},{begin:8960,end:9215},{begin:9216,end:9279},{begin:9280,end:9311},{begin:9312,end:9471},{begin:9472,end:9599},{begin:9600,end:9631},{begin:9632,end:9727},{begin:9728,end:9983},{begin:9984,end:10175},{begin:12288,end:12351},{begin:12352,end:12447},{begin:12448,end:12543},{begin:12544,end:12591},{begin:12592,end:12687},{begin:43072,end:43135},{begin:12800,end:13055},{begin:13056,end:13311},{begin:44032,end:55215},{begin:55296,end:57343},{begin:67840,end:67871},{begin:19968,end:40959},{begin:57344,end:63743},{begin:12736,end:12783},{begin:64256,end:64335},{begin:64336,end:65023},{begin:65056,end:65071},{begin:65040,end:65055},{begin:65104,end:65135},{begin:65136,end:65279},{begin:65280,end:65519},{begin:65520,end:65535},{begin:3840,end:4095},{begin:1792,end:1871},{begin:1920,end:1983},{begin:3456,end:3583},{begin:4096,end:4255},{begin:4608,end:4991},{begin:5024,end:5119},{begin:5120,end:5759},{begin:5760,end:5791},{begin:5792,end:5887},{begin:6016,end:6143},{begin:6144,end:6319},{begin:10240,end:10495},{begin:40960,end:42127},{begin:5888,end:5919},{begin:66304,end:66351},{begin:66352,end:66383},{begin:66560,end:66639},{begin:118784,end:119039},{begin:119808,end:120831},{begin:1044480,end:1048573},{begin:65024,end:65039},{begin:917504,end:917631},{begin:6400,end:6479},{begin:6480,end:6527},{begin:6528,end:6623},{begin:6656,end:6687},{begin:11264,end:11359},{begin:11568,end:11647},{begin:19904,end:19967},{begin:43008,end:43055},{begin:65536,end:65663},{begin:65856,end:65935},{begin:66432,end:66463},{begin:66464,end:66527},{begin:66640,end:66687},{begin:66688,end:66735},{begin:67584,end:67647},{begin:68096,end:68191},{begin:119552,end:119647},{begin:73728,end:74751},{begin:119648,end:119679},{begin:7040,end:7103},{begin:7168,end:7247},{begin:7248,end:7295},{begin:43136,end:43231},{begin:43264,end:43311},{begin:43312,end:43359},{begin:43520,end:43615},{begin:65936,end:65999},{begin:66e3,end:66047},{begin:66208,end:66271},{begin:127024,end:127135}];function ln(e){for(var t=0;t<un.length;t+=1){var n=un[t];if(e>=n.begin&&e<n.end)return t}return-1}function cn(e,t){var n={},i=new _e.Parser(e,t);n.version=i.parseUShort(),n.xAvgCharWidth=i.parseShort(),n.usWeightClass=i.parseUShort(),n.usWidthClass=i.parseUShort(),n.fsType=i.parseUShort(),n.ySubscriptXSize=i.parseShort(),n.ySubscriptYSize=i.parseShort(),n.ySubscriptXOffset=i.parseShort(),n.ySubscriptYOffset=i.parseShort(),n.ySuperscriptXSize=i.parseShort(),n.ySuperscriptYSize=i.parseShort(),n.ySuperscriptXOffset=i.parseShort(),n.ySuperscriptYOffset=i.parseShort(),n.yStrikeoutSize=i.parseShort(),n.yStrikeoutPosition=i.parseShort(),n.sFamilyClass=i.parseShort(),n.panose=[];for(var o=0;o<10;o++)n.panose[o]=i.parseByte();return n.ulUnicodeRange1=i.parseULong(),n.ulUnicodeRange2=i.parseULong(),n.ulUnicodeRange3=i.parseULong(),n.ulUnicodeRange4=i.parseULong(),n.achVendID=String.fromCharCode(i.parseByte(),i.parseByte(),i.parseByte(),i.parseByte()),n.fsSelection=i.parseUShort(),n.usFirstCharIndex=i.parseUShort(),n.usLastCharIndex=i.parseUShort(),n.sTypoAscender=i.parseShort(),n.sTypoDescender=i.parseShort(),n.sTypoLineGap=i.parseShort(),n.usWinAscent=i.parseUShort(),n.usWinDescent=i.parseUShort(),n.version>=1&&(n.ulCodePageRange1=i.parseULong(),n.ulCodePageRange2=i.parseULong()),n.version>=2&&(n.sxHeight=i.parseShort(),n.sCapHeight=i.parseShort(),n.usDefaultChar=i.parseUShort(),n.usBreakChar=i.parseUShort(),n.usMaxContent=i.parseUShort()),n}function hn(e){return new oe.Table("OS/2",[{name:"version",type:"USHORT",value:3},{name:"xAvgCharWidth",type:"SHORT",value:0},{name:"usWeightClass",type:"USHORT",value:0},{name:"usWidthClass",type:"USHORT",value:0},{name:"fsType",type:"USHORT",value:0},{name:"ySubscriptXSize",type:"SHORT",value:650},{name:"ySubscriptYSize",type:"SHORT",value:699},{name:"ySubscriptXOffset",type:"SHORT",value:0},{name:"ySubscriptYOffset",type:"SHORT",value:140},{name:"ySuperscriptXSize",type:"SHORT",value:650},{name:"ySuperscriptYSize",type:"SHORT",value:699},{name:"ySuperscriptXOffset",type:"SHORT",value:0},{name:"ySuperscriptYOffset",type:"SHORT",value:479},{name:"yStrikeoutSize",type:"SHORT",value:49},{name:"yStrikeoutPosition",type:"SHORT",value:258},{name:"sFamilyClass",type:"SHORT",value:0},{name:"bFamilyType",type:"BYTE",value:0},{name:"bSerifStyle",type:"BYTE",value:0},{name:"bWeight",type:"BYTE",value:0},{name:"bProportion",type:"BYTE",value:0},{name:"bContrast",type:"BYTE",value:0},{name:"bStrokeVariation",type:"BYTE",value:0},{name:"bArmStyle",type:"BYTE",value:0},{name:"bLetterform",type:"BYTE",value:0},{name:"bMidline",type:"BYTE",value:0},{name:"bXHeight",type:"BYTE",value:0},{name:"ulUnicodeRange1",type:"ULONG",value:0},{name:"ulUnicodeRange2",type:"ULONG",value:0},{name:"ulUnicodeRange3",type:"ULONG",value:0},{name:"ulUnicodeRange4",type:"ULONG",value:0},{name:"achVendID",type:"CHARARRAY",value:"XXXX"},{name:"fsSelection",type:"USHORT",value:0},{name:"usFirstCharIndex",type:"USHORT",value:0},{name:"usLastCharIndex",type:"USHORT",value:0},{name:"sTypoAscender",type:"SHORT",value:0},{name:"sTypoDescender",type:"SHORT",value:0},{name:"sTypoLineGap",type:"SHORT",value:0},{name:"usWinAscent",type:"USHORT",value:0},{name:"usWinDescent",type:"USHORT",value:0},{name:"ulCodePageRange1",type:"ULONG",value:0},{name:"ulCodePageRange2",type:"ULONG",value:0},{name:"sxHeight",type:"SHORT",value:0},{name:"sCapHeight",type:"SHORT",value:0},{name:"usDefaultChar",type:"USHORT",value:0},{name:"usBreakChar",type:"USHORT",value:0},{name:"usMaxContext",type:"USHORT",value:0}],e)}var dn={parse:cn,make:hn,unicodeRanges:un,getUnicodeRange:ln};function pn(e,t){var n={},i=new _e.Parser(e,t);switch(n.version=i.parseVersion(),n.italicAngle=i.parseFixed(),n.underlinePosition=i.parseShort(),n.underlineThickness=i.parseShort(),n.isFixedPitch=i.parseULong(),n.minMemType42=i.parseULong(),n.maxMemType42=i.parseULong(),n.minMemType1=i.parseULong(),n.maxMemType1=i.parseULong(),n.version){case 1:n.names=Ne.slice();break;case 2:n.numberOfGlyphs=i.parseUShort(),n.glyphNameIndex=new Array(n.numberOfGlyphs);for(var o=0;o<n.numberOfGlyphs;o++)n.glyphNameIndex[o]=i.parseUShort();n.names=[];for(var r=0;r<n.numberOfGlyphs;r++)if(n.glyphNameIndex[r]>=Ne.length){var s=i.parseChar();n.names.push(i.parseString(s))}break;case 2.5:n.numberOfGlyphs=i.parseUShort(),n.offset=new Array(n.numberOfGlyphs);for(var a=0;a<n.numberOfGlyphs;a++)n.offset[a]=i.parseChar()}return n}function fn(){return new oe.Table("post",[{name:"version",type:"FIXED",value:196608},{name:"italicAngle",type:"FIXED",value:0},{name:"underlinePosition",type:"FWORD",value:0},{name:"underlineThickness",type:"FWORD",value:0},{name:"isFixedPitch",type:"ULONG",value:0},{name:"minMemType42",type:"ULONG",value:0},{name:"maxMemType42",type:"ULONG",value:0},{name:"minMemType1",type:"ULONG",value:0},{name:"maxMemType1",type:"ULONG",value:0}])}var gn={parse:pn,make:fn},mn=new Array(9);mn[1]=function(){var e=this.offset+this.relativeOffset,t=this.parseUShort();return 1===t?{substFormat:1,coverage:this.parsePointer(ge.coverage),deltaGlyphId:this.parseUShort()}:2===t?{substFormat:2,coverage:this.parsePointer(ge.coverage),substitute:this.parseOffset16List()}:void V.assert(!1,"0x"+e.toString(16)+": lookup type 1 format must be 1 or 2.")},mn[2]=function(){var e=this.parseUShort();return V.argument(1===e,"GSUB Multiple Substitution Subtable identifier-format must be 1"),{substFormat:e,coverage:this.parsePointer(ge.coverage),sequences:this.parseListOfLists()}},mn[3]=function(){var e=this.parseUShort();return V.argument(1===e,"GSUB Alternate Substitution Subtable identifier-format must be 1"),{substFormat:e,coverage:this.parsePointer(ge.coverage),alternateSets:this.parseListOfLists()}},mn[4]=function(){var e=this.parseUShort();return V.argument(1===e,"GSUB ligature table identifier-format must be 1"),{substFormat:e,coverage:this.parsePointer(ge.coverage),ligatureSets:this.parseListOfLists((function(){return{ligGlyph:this.parseUShort(),components:this.parseUShortList(this.parseUShort()-1)}}))}};var _n={sequenceIndex:ge.uShort,lookupListIndex:ge.uShort};function yn(e,t){var n=new ge(e,t=t||0),i=n.parseVersion(1);return V.argument(1===i||1.1===i,"Unsupported GSUB table version."),1===i?{version:i,scripts:n.parseScriptList(),features:n.parseFeatureList(),lookups:n.parseLookupList(mn)}:{version:i,scripts:n.parseScriptList(),features:n.parseFeatureList(),lookups:n.parseLookupList(mn),variations:n.parseFeatureVariationsList()}}mn[5]=function(){var e=this.offset+this.relativeOffset,t=this.parseUShort();if(1===t)return{substFormat:t,coverage:this.parsePointer(ge.coverage),ruleSets:this.parseListOfLists((function(){var e=this.parseUShort(),t=this.parseUShort();return{input:this.parseUShortList(e-1),lookupRecords:this.parseRecordList(t,_n)}}))};if(2===t)return{substFormat:t,coverage:this.parsePointer(ge.coverage),classDef:this.parsePointer(ge.classDef),classSets:this.parseListOfLists((function(){var e=this.parseUShort(),t=this.parseUShort();return{classes:this.parseUShortList(e-1),lookupRecords:this.parseRecordList(t,_n)}}))};if(3===t){var n=this.parseUShort(),i=this.parseUShort();return{substFormat:t,coverages:this.parseList(n,ge.pointer(ge.coverage)),lookupRecords:this.parseRecordList(i,_n)}}V.assert(!1,"0x"+e.toString(16)+": lookup type 5 format must be 1, 2 or 3.")},mn[6]=function(){var e=this.offset+this.relativeOffset,t=this.parseUShort();return 1===t?{substFormat:1,coverage:this.parsePointer(ge.coverage),chainRuleSets:this.parseListOfLists((function(){return{backtrack:this.parseUShortList(),input:this.parseUShortList(this.parseShort()-1),lookahead:this.parseUShortList(),lookupRecords:this.parseRecordList(_n)}}))}:2===t?{substFormat:2,coverage:this.parsePointer(ge.coverage),backtrackClassDef:this.parsePointer(ge.classDef),inputClassDef:this.parsePointer(ge.classDef),lookaheadClassDef:this.parsePointer(ge.classDef),chainClassSet:this.parseListOfLists((function(){return{backtrack:this.parseUShortList(),input:this.parseUShortList(this.parseShort()-1),lookahead:this.parseUShortList(),lookupRecords:this.parseRecordList(_n)}}))}:3===t?{substFormat:3,backtrackCoverage:this.parseList(ge.pointer(ge.coverage)),inputCoverage:this.parseList(ge.pointer(ge.coverage)),lookaheadCoverage:this.parseList(ge.pointer(ge.coverage)),lookupRecords:this.parseRecordList(_n)}:void V.assert(!1,"0x"+e.toString(16)+": lookup type 6 format must be 1, 2 or 3.")},mn[7]=function(){var e=this.parseUShort();V.argument(1===e,"GSUB Extension Substitution subtable identifier-format must be 1");var t=this.parseUShort(),n=new ge(this.data,this.offset+this.parseULong());return{substFormat:1,lookupType:t,extension:mn[t].call(n)}},mn[8]=function(){var e=this.parseUShort();return V.argument(1===e,"GSUB Reverse Chaining Contextual Single Substitution Subtable identifier-format must be 1"),{substFormat:e,coverage:this.parsePointer(ge.coverage),backtrackCoverage:this.parseList(ge.pointer(ge.coverage)),lookaheadCoverage:this.parseList(ge.pointer(ge.coverage)),substitutes:this.parseUShortList()}};var xn=new Array(9);function wn(e){return new oe.Table("GSUB",[{name:"version",type:"ULONG",value:65536},{name:"scripts",type:"TABLE",value:new oe.ScriptList(e.scripts)},{name:"features",type:"TABLE",value:new oe.FeatureList(e.features)},{name:"lookups",type:"TABLE",value:new oe.LookupList(e.lookups,xn)}])}xn[1]=function(e){return 1===e.substFormat?new oe.Table("substitutionTable",[{name:"substFormat",type:"USHORT",value:1},{name:"coverage",type:"TABLE",value:new oe.Coverage(e.coverage)},{name:"deltaGlyphID",type:"USHORT",value:e.deltaGlyphId}]):new oe.Table("substitutionTable",[{name:"substFormat",type:"USHORT",value:2},{name:"coverage",type:"TABLE",value:new oe.Coverage(e.coverage)}].concat(oe.ushortList("substitute",e.substitute)))},xn[2]=function(e){return V.assert(1===e.substFormat,"Lookup type 2 substFormat must be 1."),new oe.Table("substitutionTable",[{name:"substFormat",type:"USHORT",value:1},{name:"coverage",type:"TABLE",value:new oe.Coverage(e.coverage)}].concat(oe.tableList("seqSet",e.sequences,(function(e){return new oe.Table("sequenceSetTable",oe.ushortList("sequence",e))}))))},xn[3]=function(e){return V.assert(1===e.substFormat,"Lookup type 3 substFormat must be 1."),new oe.Table("substitutionTable",[{name:"substFormat",type:"USHORT",value:1},{name:"coverage",type:"TABLE",value:new oe.Coverage(e.coverage)}].concat(oe.tableList("altSet",e.alternateSets,(function(e){return new oe.Table("alternateSetTable",oe.ushortList("alternate",e))}))))},xn[4]=function(e){return V.assert(1===e.substFormat,"Lookup type 4 substFormat must be 1."),new oe.Table("substitutionTable",[{name:"substFormat",type:"USHORT",value:1},{name:"coverage",type:"TABLE",value:new oe.Coverage(e.coverage)}].concat(oe.tableList("ligSet",e.ligatureSets,(function(e){return new oe.Table("ligatureSetTable",oe.tableList("ligature",e,(function(e){return new oe.Table("ligatureTable",[{name:"ligGlyph",type:"USHORT",value:e.ligGlyph}].concat(oe.ushortList("component",e.components,e.components.length+1)))})))}))))},xn[6]=function(e){if(1===e.substFormat){var t=new oe.Table("chainContextTable",[{name:"substFormat",type:"USHORT",value:e.substFormat},{name:"coverage",type:"TABLE",value:new oe.Coverage(e.coverage)}].concat(oe.tableList("chainRuleSet",e.chainRuleSets,(function(e){return new oe.Table("chainRuleSetTable",oe.tableList("chainRule",e,(function(e){var t=oe.ushortList("backtrackGlyph",e.backtrack,e.backtrack.length).concat(oe.ushortList("inputGlyph",e.input,e.input.length+1)).concat(oe.ushortList("lookaheadGlyph",e.lookahead,e.lookahead.length)).concat(oe.ushortList("substitution",[],e.lookupRecords.length));return e.lookupRecords.forEach((function(e,n){t=t.concat({name:"sequenceIndex"+n,type:"USHORT",value:e.sequenceIndex}).concat({name:"lookupListIndex"+n,type:"USHORT",value:e.lookupListIndex})})),new oe.Table("chainRuleTable",t)})))}))));return t}if(2===e.substFormat)V.assert(!1,"lookup type 6 format 2 is not yet supported.");else if(3===e.substFormat){var n=[{name:"substFormat",type:"USHORT",value:e.substFormat}];return n.push({name:"backtrackGlyphCount",type:"USHORT",value:e.backtrackCoverage.length}),e.backtrackCoverage.forEach((function(e,t){n.push({name:"backtrackCoverage"+t,type:"TABLE",value:new oe.Coverage(e)})})),n.push({name:"inputGlyphCount",type:"USHORT",value:e.inputCoverage.length}),e.inputCoverage.forEach((function(e,t){n.push({name:"inputCoverage"+t,type:"TABLE",value:new oe.Coverage(e)})})),n.push({name:"lookaheadGlyphCount",type:"USHORT",value:e.lookaheadCoverage.length}),e.lookaheadCoverage.forEach((function(e,t){n.push({name:"lookaheadCoverage"+t,type:"TABLE",value:new oe.Coverage(e)})})),n.push({name:"substitutionCount",type:"USHORT",value:e.lookupRecords.length}),e.lookupRecords.forEach((function(e,t){n=n.concat({name:"sequenceIndex"+t,type:"USHORT",value:e.sequenceIndex}).concat({name:"lookupListIndex"+t,type:"USHORT",value:e.lookupListIndex})})),new oe.Table("chainContextTable",n)}V.assert(!1,"lookup type 6 format must be 1, 2 or 3.")};var vn={parse:yn,make:wn};function bn(e,t){var n=new _e.Parser(e,t),i=n.parseULong();V.argument(1===i,"Unsupported META table version."),n.parseULong(),n.parseULong();for(var o=n.parseULong(),r={},s=0;s<o;s++){var a=n.parseTag(),u=n.parseULong(),l=n.parseULong(),c=L.UTF8(e,t+u,l);r[a]=c}return r}function Sn(e){var t=Object.keys(e).length,n="",i=16+12*t,o=new oe.Table("meta",[{name:"version",type:"ULONG",value:1},{name:"flags",type:"ULONG",value:0},{name:"offset",type:"ULONG",value:i},{name:"numTags",type:"ULONG",value:t}]);for(var r in e){var s=n.length;n+=e[r],o.fields.push({name:"tag "+r,type:"TAG",value:r}),o.fields.push({name:"offset "+r,type:"ULONG",value:i+s}),o.fields.push({name:"length "+r,type:"ULONG",value:e[r].length})}return o.fields.push({name:"stringPool",type:"CHARARRAY",value:n}),o}var Tn={parse:bn,make:Sn};function En(e){return Math.log(e)/Math.log(2)|0}function Cn(e){for(;e.length%4!=0;)e.push(0);for(var t=0,n=0;n<e.length;n+=4)t+=(e[n]<<24)+(e[n+1]<<16)+(e[n+2]<<8)+e[n+3];return t%=Math.pow(2,32)}function On(e,t,n,i){return new oe.Record("Table Record",[{name:"tag",type:"TAG",value:void 0!==e?e:""},{name:"checkSum",type:"ULONG",value:void 0!==t?t:0},{name:"offset",type:"ULONG",value:void 0!==n?n:0},{name:"length",type:"ULONG",value:void 0!==i?i:0}])}function Nn(e){var t=new oe.Table("sfnt",[{name:"version",type:"TAG",value:"OTTO"},{name:"numTables",type:"USHORT",value:0},{name:"searchRange",type:"USHORT",value:0},{name:"entrySelector",type:"USHORT",value:0},{name:"rangeShift",type:"USHORT",value:0}]);t.tables=e,t.numTables=e.length;var n=Math.pow(2,En(t.numTables));t.searchRange=16*n,t.entrySelector=En(n),t.rangeShift=16*t.numTables-t.searchRange;for(var i=[],o=[],r=t.sizeOf()+On().sizeOf()*t.numTables;r%4!=0;)r+=1,o.push({name:"padding",type:"BYTE",value:0});for(var s=0;s<e.length;s+=1){var a=e[s];V.argument(4===a.tableName.length,"Table name"+a.tableName+" is invalid.");var u=a.sizeOf(),l=On(a.tableName,Cn(a.encode()),r,u);for(i.push({name:l.tag+" Table Record",type:"RECORD",value:l}),o.push({name:a.tableName+" table",type:"RECORD",value:a}),r+=u,V.argument(!isNaN(r),"Something went wrong calculating the offset.");r%4!=0;)r+=1,o.push({name:"padding",type:"BYTE",value:0})}return i.sort((function(e,t){return e.value.tag>t.value.tag?1:-1})),t.fields=t.fields.concat(i),t.fields=t.fields.concat(o),t}function Fn(e,t,n){for(var i=0;i<t.length;i+=1){var o=e.charToGlyphIndex(t[i]);if(o>0)return e.glyphs.get(o).getMetrics()}return n}function Mn(e){for(var t=0,n=0;n<e.length;n+=1)t+=e[n];return t/e.length}function Dn(e){for(var t,n=[],i=[],o=[],r=[],s=[],a=[],u=[],l=0,c=0,h=0,d=0,p=0,f=0;f<e.glyphs.length;f+=1){var g=e.glyphs.get(f),m=0|g.unicode;if(isNaN(g.advanceWidth))throw new Error("Glyph "+g.name+" ("+f+"): advanceWidth is not a number.");(t>m||void 0===t)&&m>0&&(t=m),l<m&&(l=m);var _=dn.getUnicodeRange(m);if(_<32)c|=1<<_;else if(_<64)h|=1<<_-32;else if(_<96)d|=1<<_-64;else{if(!(_<123))throw new Error("Unicode ranges bits > 123 are reserved for internal usage");p|=1<<_-96}if(".notdef"!==g.name){var y=g.getMetrics();n.push(y.xMin),i.push(y.yMin),o.push(y.xMax),r.push(y.yMax),a.push(y.leftSideBearing),u.push(y.rightSideBearing),s.push(g.advanceWidth)}}var x={xMin:Math.min.apply(null,n),yMin:Math.min.apply(null,i),xMax:Math.max.apply(null,o),yMax:Math.max.apply(null,r),advanceWidthMax:Math.max.apply(null,s),advanceWidthAvg:Mn(s),minLeftSideBearing:Math.min.apply(null,a),maxLeftSideBearing:Math.max.apply(null,a),minRightSideBearing:Math.min.apply(null,u)};x.ascender=e.ascender,x.descender=e.descender;var w=Mt.make({flags:3,unitsPerEm:e.unitsPerEm,xMin:x.xMin,yMin:x.yMin,xMax:x.xMax,yMax:x.yMax,lowestRecPPEM:3,createdTimestamp:e.createdTimestamp}),v=Rt.make({ascender:x.ascender,descender:x.descender,advanceWidthMax:x.advanceWidthMax,minLeftSideBearing:x.minLeftSideBearing,minRightSideBearing:x.minRightSideBearing,xMaxExtent:x.maxLeftSideBearing+(x.xMax-x.xMin),numberOfHMetrics:e.glyphs.length}),b=Gt.make(e.glyphs.length),S=dn.make(Object.assign({xAvgCharWidth:Math.round(x.advanceWidthAvg),usFirstCharIndex:t,usLastCharIndex:l,ulUnicodeRange1:c,ulUnicodeRange2:h,ulUnicodeRange3:d,ulUnicodeRange4:p,sTypoAscender:x.ascender,sTypoDescender:x.descender,sTypoLineGap:0,usWinAscent:x.yMax,usWinDescent:Math.abs(x.yMin),ulCodePageRange1:1,sxHeight:Fn(e,"xyvw",{yMax:Math.round(x.ascender/2)}).yMax,sCapHeight:Fn(e,"HIKLEFJMNTZBDPRAGOQSUVWXY",x).yMax,usDefaultChar:e.hasChar(" ")?32:0,usBreakChar:e.hasChar(" ")?32:0},e.tables.os2)),T=Ut.make(e.glyphs),E=Te.make(e.glyphs),C=e.getEnglishName("fontFamily"),O=e.getEnglishName("fontSubfamily"),N=C+" "+O,F=e.getEnglishName("postScriptName");F||(F=C.replace(/\s/g,"")+"-"+O);var M={};for(var D in e.names)M[D]=e.names[D];M.uniqueID||(M.uniqueID={en:e.getEnglishName("manufacturer")+":"+N}),M.postScriptName||(M.postScriptName={en:F}),M.preferredFamily||(M.preferredFamily=e.names.fontFamily),M.preferredSubfamily||(M.preferredSubfamily=e.names.fontSubfamily);var I=[],R=an.make(M,I),V=I.length>0?kt.make(I):void 0,P=gn.make(),A=Ot.make(e.glyphs,{version:e.getEnglishName("version"),fullName:N,familyName:C,weightName:O,postScriptName:F,unitsPerEm:e.unitsPerEm,fontBBox:[0,x.yMin,x.ascender,x.advanceWidthMax]}),L=e.metas&&Object.keys(e.metas).length>0?Tn.make(e.metas):void 0,U=[w,v,b,S,R,E,P,A,T];V&&U.push(V),e.tables.gsub&&U.push(vn.make(e.tables.gsub)),L&&U.push(L);for(var B=Nn(U),X=Cn(B.encode()),k=B.fields,z=!1,j=0;j<k.length;j+=1)if("head table"===k[j].name){k[j].value.checkSumAdjustment=2981146554-X,z=!0;break}if(!z)throw new Error("Could not find head table with checkSum to adjust.");return B}var In={make:Nn,fontToTable:Dn,computeCheckSum:Cn};function Rn(e,t){for(var n=0,i=e.length-1;n<=i;){var o=n+i>>>1,r=e[o].tag;if(r===t)return o;r<t?n=o+1:i=o-1}return-n-1}function Vn(e,t){for(var n=0,i=e.length-1;n<=i;){var o=n+i>>>1,r=e[o];if(r===t)return o;r<t?n=o+1:i=o-1}return-n-1}function Pn(e,t){for(var n,i=0,o=e.length-1;i<=o;){var r=i+o>>>1,s=(n=e[r]).start;if(s===t)return n;s<t?i=r+1:o=r-1}if(i>0)return t>(n=e[i-1]).end?0:n}function An(e,t){this.font=e,this.tableName=t}function Ln(e){An.call(this,e,"gpos")}function Un(e){An.call(this,e,"gsub")}function Bn(e,t){var n=e.length;if(n!==t.length)return!1;for(var i=0;i<n;i++)if(e[i]!==t[i])return!1;return!0}function Xn(e,t,n){for(var i=e.subtables,o=0;o<i.length;o++){var r=i[o];if(r.substFormat===t)return r}if(n)return i.push(n),n}function kn(){return"undefined"!=typeof window}function zn(e){for(var t=new ArrayBuffer(e.length),n=new Uint8Array(t),i=0;i<e.length;++i)n[i]=e[i];return t}function jn(e){for(var t=new Buffer(e.byteLength),n=new Uint8Array(e),i=0;i<t.length;++i)t[i]=n[i];return t}function Gn(e,t){if(!e)throw t}function Hn(e,t,n,i,o){var r;return(t&i)>0?(r=e.parseByte(),0==(t&o)&&(r=-r),r=n+r):r=(t&o)>0?n:n+e.parseShort(),r}function qn(e,t,n){var i,o,r=new _e.Parser(t,n);if(e.numberOfContours=r.parseShort(),e._xMin=r.parseShort(),e._yMin=r.parseShort(),e._xMax=r.parseShort(),e._yMax=r.parseShort(),e.numberOfContours>0){for(var s=e.endPointIndices=[],a=0;a<e.numberOfContours;a+=1)s.push(r.parseUShort());e.instructionLength=r.parseUShort(),e.instructions=[];for(var u=0;u<e.instructionLength;u+=1)e.instructions.push(r.parseByte());var l=s[s.length-1]+1;i=[];for(var c=0;c<l;c+=1)if(o=r.parseByte(),i.push(o),(8&o)>0)for(var h=r.parseByte(),d=0;d<h;d+=1)i.push(o),c+=1;if(V.argument(i.length===l,"Bad flags."),s.length>0){var p,f=[];if(l>0){for(var g=0;g<l;g+=1)o=i[g],(p={}).onCurve=!!(1&o),p.lastPointOfContour=s.indexOf(g)>=0,f.push(p);for(var m=0,_=0;_<l;_+=1)o=i[_],(p=f[_]).x=Hn(r,o,m,2,16),m=p.x;for(var y=0,x=0;x<l;x+=1)o=i[x],(p=f[x]).y=Hn(r,o,y,4,32),y=p.y}e.points=f}else e.points=[]}else if(0===e.numberOfContours)e.points=[];else{e.isComposite=!0,e.points=[],e.components=[];for(var w=!0;w;){i=r.parseUShort();var v={glyphIndex:r.parseUShort(),xScale:1,scale01:0,scale10:0,yScale:1,dx:0,dy:0};(1&i)>0?(2&i)>0?(v.dx=r.parseShort(),v.dy=r.parseShort()):v.matchedPoints=[r.parseUShort(),r.parseUShort()]:(2&i)>0?(v.dx=r.parseChar(),v.dy=r.parseChar()):v.matchedPoints=[r.parseByte(),r.parseByte()],(8&i)>0?v.xScale=v.yScale=r.parseF2Dot14():(64&i)>0?(v.xScale=r.parseF2Dot14(),v.yScale=r.parseF2Dot14()):(128&i)>0&&(v.xScale=r.parseF2Dot14(),v.scale01=r.parseF2Dot14(),v.scale10=r.parseF2Dot14(),v.yScale=r.parseF2Dot14()),e.components.push(v),w=!!(32&i)}if(256&i){e.instructionLength=r.parseUShort(),e.instructions=[];for(var b=0;b<e.instructionLength;b+=1)e.instructions.push(r.parseByte())}}}function Wn(e,t){for(var n=[],i=0;i<e.length;i+=1){var o=e[i],r={x:t.xScale*o.x+t.scale01*o.y+t.dx,y:t.scale10*o.x+t.yScale*o.y+t.dy,onCurve:o.onCurve,lastPointOfContour:o.lastPointOfContour};n.push(r)}return n}function Yn(e){for(var t=[],n=[],i=0;i<e.length;i+=1){var o=e[i];n.push(o),o.lastPointOfContour&&(t.push(n),n=[])}return V.argument(0===n.length,"There are still points left in the current contour."),t}function Kn(e){var t=new D;if(!e)return t;for(var n=Yn(e),i=0;i<n.length;++i){var o=n[i],r=null,s=o[o.length-1],a=o[0];if(s.onCurve)t.moveTo(s.x,s.y);else if(a.onCurve)t.moveTo(a.x,a.y);else{var u={x:.5*(s.x+a.x),y:.5*(s.y+a.y)};t.moveTo(u.x,u.y)}for(var l=0;l<o.length;++l)if(r=s,s=a,a=o[(l+1)%o.length],s.onCurve)t.lineTo(s.x,s.y);else{var c=a;r.onCurve||(s.x,r.x,s.y,r.y),a.onCurve||(c={x:.5*(s.x+a.x),y:.5*(s.y+a.y)}),t.quadraticCurveTo(s.x,s.y,c.x,c.y)}t.closePath()}return t}function Zn(e,t){if(t.isComposite)for(var n=0;n<t.components.length;n+=1){var i=t.components[n],o=e.get(i.glyphIndex);if(o.getPath(),o.points){var r=void 0;if(void 0===i.matchedPoints)r=Wn(o.points,i);else{if(i.matchedPoints[0]>t.points.length-1||i.matchedPoints[1]>o.points.length-1)throw Error("Matched points out of range in "+t.name);var s=t.points[i.matchedPoints[0]],a=o.points[i.matchedPoints[1]],u={xScale:i.xScale,scale01:i.scale01,scale10:i.scale10,yScale:i.yScale,dx:0,dy:0};a=Wn([a],u)[0],u.dx=s.x-a.x,u.dy=s.y-a.y,r=Wn(o.points,u)}t.points=t.points.concat(r)}}return Kn(t.points)}function Qn(e,t,n,i){for(var o=new He.GlyphSet(i),r=0;r<n.length-1;r+=1){var s=n[r];s!==n[r+1]?o.push(r,He.ttfGlyphLoader(i,r,qn,e,t+s,Zn)):o.push(r,He.glyphLoader(i,r))}return o}function $n(e,t,n,i){var o=new He.GlyphSet(i);return i._push=function(r){var s=n[r];s!==n[r+1]?o.push(r,He.ttfGlyphLoader(i,r,qn,e,t+s,Zn)):o.push(r,He.glyphLoader(i,r))},o}function Jn(e,t,n,i,o){return o.lowMemory?$n(e,t,n,i):Qn(e,t,n,i)}An.prototype={searchTag:Rn,binSearch:Vn,getTable:function(e){var t=this.font.tables[this.tableName];return!t&&e&&(t=this.font.tables[this.tableName]=this.createDefaultTable()),t},getScriptNames:function(){var e=this.getTable();return e?e.scripts.map((function(e){return e.tag})):[]},getDefaultScriptName:function(){var e=this.getTable();if(e){for(var t=!1,n=0;n<e.scripts.length;n++){var i=e.scripts[n].tag;if("DFLT"===i)return i;"latn"===i&&(t=!0)}return t?"latn":void 0}},getScriptTable:function(e,t){var n=this.getTable(t);if(n){e=e||"DFLT";var i=n.scripts,o=Rn(n.scripts,e);if(o>=0)return i[o].script;if(t){var r={tag:e,script:{defaultLangSys:{reserved:0,reqFeatureIndex:65535,featureIndexes:[]},langSysRecords:[]}};return i.splice(-1-o,0,r),r.script}}},getLangSysTable:function(e,t,n){var i=this.getScriptTable(e,n);if(i){if(!t||"dflt"===t||"DFLT"===t)return i.defaultLangSys;var o=Rn(i.langSysRecords,t);if(o>=0)return i.langSysRecords[o].langSys;if(n){var r={tag:t,langSys:{reserved:0,reqFeatureIndex:65535,featureIndexes:[]}};return i.langSysRecords.splice(-1-o,0,r),r.langSys}}},getFeatureTable:function(e,t,n,i){var o=this.getLangSysTable(e,t,i);if(o){for(var r,s=o.featureIndexes,a=this.font.tables[this.tableName].features,u=0;u<s.length;u++)if((r=a[s[u]]).tag===n)return r.feature;if(i){var l=a.length;return V.assert(0===l||n>=a[l-1].tag,"Features must be added in alphabetical order."),r={tag:n,feature:{params:0,lookupListIndexes:[]}},a.push(r),s.push(l),r.feature}}},getLookupTables:function(e,t,n,i,o){var r=this.getFeatureTable(e,t,n,o),s=[];if(r){for(var a,u=r.lookupListIndexes,l=this.font.tables[this.tableName].lookups,c=0;c<u.length;c++)(a=l[u[c]]).lookupType===i&&s.push(a);if(0===s.length&&o){a={lookupType:i,lookupFlag:0,subtables:[],markFilteringSet:void 0};var h=l.length;return l.push(a),u.push(h),[a]}}return s},getGlyphClass:function(e,t){switch(e.format){case 1:return e.startGlyph<=t&&t<e.startGlyph+e.classes.length?e.classes[t-e.startGlyph]:0;case 2:var n=Pn(e.ranges,t);return n?n.classId:0}},getCoverageIndex:function(e,t){switch(e.format){case 1:var n=Vn(e.glyphs,t);return n>=0?n:-1;case 2:var i=Pn(e.ranges,t);return i?i.index+t-i.start:-1}},expandCoverage:function(e){if(1===e.format)return e.glyphs;for(var t=[],n=e.ranges,i=0;i<n.length;i++)for(var o=n[i],r=o.start,s=o.end,a=r;a<=s;a++)t.push(a);return t}},Ln.prototype=An.prototype,Ln.prototype.init=function(){var e=this.getDefaultScriptName();this.defaultKerningTables=this.getKerningTables(e)},Ln.prototype.getKerningValue=function(e,t,n){for(var i=0;i<e.length;i++)for(var o=e[i].subtables,r=0;r<o.length;r++){var s=o[r],a=this.getCoverageIndex(s.coverage,t);if(!(a<0))switch(s.posFormat){case 1:for(var u=s.pairSets[a],l=0;l<u.length;l++){var c=u[l];if(c.secondGlyph===n)return c.value1&&c.value1.xAdvance||0}break;case 2:var h=this.getGlyphClass(s.classDef1,t),d=this.getGlyphClass(s.classDef2,n),p=s.classRecords[h][d];return p.value1&&p.value1.xAdvance||0}}return 0},Ln.prototype.getKerningTables=function(e,t){if(this.font.tables.gpos)return this.getLookupTables(e,t,"kern",2)},Un.prototype=An.prototype,Un.prototype.createDefaultTable=function(){return{version:1,scripts:[{tag:"DFLT",script:{defaultLangSys:{reserved:0,reqFeatureIndex:65535,featureIndexes:[]},langSysRecords:[]}}],features:[],lookups:[]}},Un.prototype.getSingle=function(e,t,n){for(var i=[],o=this.getLookupTables(t,n,e,1),r=0;r<o.length;r++)for(var s=o[r].subtables,a=0;a<s.length;a++){var u=s[a],l=this.expandCoverage(u.coverage),c=void 0;if(1===u.substFormat){var h=u.deltaGlyphId;for(c=0;c<l.length;c++){var d=l[c];i.push({sub:d,by:d+h})}}else{var p=u.substitute;for(c=0;c<l.length;c++)i.push({sub:l[c],by:p[c]})}}return i},Un.prototype.getMultiple=function(e,t,n){for(var i=[],o=this.getLookupTables(t,n,e,2),r=0;r<o.length;r++)for(var s=o[r].subtables,a=0;a<s.length;a++){var u=s[a],l=this.expandCoverage(u.coverage),c=void 0;for(c=0;c<l.length;c++){var h=l[c],d=u.sequences[c];i.push({sub:h,by:d})}}return i},Un.prototype.getAlternates=function(e,t,n){for(var i=[],o=this.getLookupTables(t,n,e,3),r=0;r<o.length;r++)for(var s=o[r].subtables,a=0;a<s.length;a++)for(var u=s[a],l=this.expandCoverage(u.coverage),c=u.alternateSets,h=0;h<l.length;h++)i.push({sub:l[h],by:c[h]});return i},Un.prototype.getLigatures=function(e,t,n){for(var i=[],o=this.getLookupTables(t,n,e,4),r=0;r<o.length;r++)for(var s=o[r].subtables,a=0;a<s.length;a++)for(var u=s[a],l=this.expandCoverage(u.coverage),c=u.ligatureSets,h=0;h<l.length;h++)for(var d=l[h],p=c[h],f=0;f<p.length;f++){var g=p[f];i.push({sub:[d].concat(g.components),by:g.ligGlyph})}return i},Un.prototype.addSingle=function(e,t,n,i){var o=Xn(this.getLookupTables(n,i,e,1,!0)[0],2,{substFormat:2,coverage:{format:1,glyphs:[]},substitute:[]});V.assert(1===o.coverage.format,"Single: unable to modify coverage table format "+o.coverage.format);var r=t.sub,s=this.binSearch(o.coverage.glyphs,r);s<0&&(s=-1-s,o.coverage.glyphs.splice(s,0,r),o.substitute.splice(s,0,0)),o.substitute[s]=t.by},Un.prototype.addMultiple=function(e,t,n,i){V.assert(t.by instanceof Array&&t.by.length>1,'Multiple: "by" must be an array of two or more ids');var o=Xn(this.getLookupTables(n,i,e,2,!0)[0],1,{substFormat:1,coverage:{format:1,glyphs:[]},sequences:[]});V.assert(1===o.coverage.format,"Multiple: unable to modify coverage table format "+o.coverage.format);var r=t.sub,s=this.binSearch(o.coverage.glyphs,r);s<0&&(s=-1-s,o.coverage.glyphs.splice(s,0,r),o.sequences.splice(s,0,0)),o.sequences[s]=t.by},Un.prototype.addAlternate=function(e,t,n,i){var o=Xn(this.getLookupTables(n,i,e,3,!0)[0],1,{substFormat:1,coverage:{format:1,glyphs:[]},alternateSets:[]});V.assert(1===o.coverage.format,"Alternate: unable to modify coverage table format "+o.coverage.format);var r=t.sub,s=this.binSearch(o.coverage.glyphs,r);s<0&&(s=-1-s,o.coverage.glyphs.splice(s,0,r),o.alternateSets.splice(s,0,0)),o.alternateSets[s]=t.by},Un.prototype.addLigature=function(e,t,n,i){var o=this.getLookupTables(n,i,e,4,!0)[0],r=o.subtables[0];r||(r={substFormat:1,coverage:{format:1,glyphs:[]},ligatureSets:[]},o.subtables[0]=r),V.assert(1===r.coverage.format,"Ligature: unable to modify coverage table format "+r.coverage.format);var s=t.sub[0],a=t.sub.slice(1),u={ligGlyph:t.by,components:a},l=this.binSearch(r.coverage.glyphs,s);if(l>=0){for(var c=r.ligatureSets[l],h=0;h<c.length;h++)if(Bn(c[h].components,a))return;c.push(u)}else l=-1-l,r.coverage.glyphs.splice(l,0,s),r.ligatureSets.splice(l,0,[u])},Un.prototype.getFeature=function(e,t,n){if(/ss\d\d/.test(e))return this.getSingle(e,t,n);switch(e){case"aalt":case"salt":return this.getSingle(e,t,n).concat(this.getAlternates(e,t,n));case"dlig":case"liga":case"rlig":return this.getLigatures(e,t,n);case"ccmp":return this.getMultiple(e,t,n).concat(this.getLigatures(e,t,n));case"stch":return this.getMultiple(e,t,n)}},Un.prototype.add=function(e,t,n,i){if(/ss\d\d/.test(e))return this.addSingle(e,t,n,i);switch(e){case"aalt":case"salt":return"number"==typeof t.by?this.addSingle(e,t,n,i):this.addAlternate(e,t,n,i);case"dlig":case"liga":case"rlig":return this.addLigature(e,t,n,i);case"ccmp":return t.by instanceof Array?this.addMultiple(e,t,n,i):this.addLigature(e,t,n,i)}};var ei,ti,ni,ii,oi={getPath:Kn,parse:Jn};function ri(e){this.font=e,this.getCommands=function(e){return oi.getPath(e).commands},this._fpgmState=this._prepState=void 0,this._errorState=0}function si(e){return e}function ai(e){return Math.sign(e)*Math.round(Math.abs(e))}function ui(e){return Math.sign(e)*Math.round(Math.abs(2*e))/2}function li(e){return Math.sign(e)*(Math.round(Math.abs(e)+.5)-.5)}function ci(e){return Math.sign(e)*Math.ceil(Math.abs(e))}function hi(e){return Math.sign(e)*Math.floor(Math.abs(e))}var di=function(e){var t=this.srPeriod,n=this.srPhase,i=1;return e<0&&(e=-e,i=-1),e+=this.srThreshold-n,e=Math.trunc(e/t)*t,(e+=n)<0?n*i:e*i},pi={x:1,y:0,axis:"x",distance:function(e,t,n,i){return(n?e.xo:e.x)-(i?t.xo:t.x)},interpolate:function(e,t,n,i){var o,r,s,a,u,l,c;if(!i||i===this)return o=e.xo-t.xo,r=e.xo-n.xo,u=t.x-t.xo,l=n.x-n.xo,0===(c=(s=Math.abs(o))+(a=Math.abs(r)))?void(e.x=e.xo+(u+l)/2):void(e.x=e.xo+(u*a+l*s)/c);o=i.distance(e,t,!0,!0),r=i.distance(e,n,!0,!0),u=i.distance(t,t,!1,!0),l=i.distance(n,n,!1,!0),0!==(c=(s=Math.abs(o))+(a=Math.abs(r)))?pi.setRelative(e,e,(u*a+l*s)/c,i,!0):pi.setRelative(e,e,(u+l)/2,i,!0)},normalSlope:Number.NEGATIVE_INFINITY,setRelative:function(e,t,n,i,o){if(i&&i!==this){var r=o?t.xo:t.x,s=o?t.yo:t.y,a=r+n*i.x,u=s+n*i.y;e.x=a+(e.y-u)/i.normalSlope}else e.x=(o?t.xo:t.x)+n},slope:0,touch:function(e){e.xTouched=!0},touched:function(e){return e.xTouched},untouch:function(e){e.xTouched=!1}},fi={x:0,y:1,axis:"y",distance:function(e,t,n,i){return(n?e.yo:e.y)-(i?t.yo:t.y)},interpolate:function(e,t,n,i){var o,r,s,a,u,l,c;if(!i||i===this)return o=e.yo-t.yo,r=e.yo-n.yo,u=t.y-t.yo,l=n.y-n.yo,0===(c=(s=Math.abs(o))+(a=Math.abs(r)))?void(e.y=e.yo+(u+l)/2):void(e.y=e.yo+(u*a+l*s)/c);o=i.distance(e,t,!0,!0),r=i.distance(e,n,!0,!0),u=i.distance(t,t,!1,!0),l=i.distance(n,n,!1,!0),0!==(c=(s=Math.abs(o))+(a=Math.abs(r)))?fi.setRelative(e,e,(u*a+l*s)/c,i,!0):fi.setRelative(e,e,(u+l)/2,i,!0)},normalSlope:0,setRelative:function(e,t,n,i,o){if(i&&i!==this){var r=o?t.xo:t.x,s=o?t.yo:t.y,a=r+n*i.x,u=s+n*i.y;e.y=u+i.normalSlope*(e.x-a)}else e.y=(o?t.yo:t.y)+n},slope:Number.POSITIVE_INFINITY,touch:function(e){e.yTouched=!0},touched:function(e){return e.yTouched},untouch:function(e){e.yTouched=!1}};function gi(e,t){this.x=e,this.y=t,this.axis=void 0,this.slope=t/e,this.normalSlope=-e/t,Object.freeze(this)}function mi(e,t){var n=Math.sqrt(e*e+t*t);return t/=n,1==(e/=n)&&0===t?pi:0===e&&1===t?fi:new gi(e,t)}function _i(e,t,n,i){this.x=this.xo=Math.round(64*e)/64,this.y=this.yo=Math.round(64*t)/64,this.lastPointOfContour=n,this.onCurve=i,this.prevPointOnContour=void 0,this.nextPointOnContour=void 0,this.xTouched=!1,this.yTouched=!1,Object.preventExtensions(this)}Object.freeze(pi),Object.freeze(fi),gi.prototype.distance=function(e,t,n,i){return this.x*pi.distance(e,t,n,i)+this.y*fi.distance(e,t,n,i)},gi.prototype.interpolate=function(e,t,n,i){var o,r,s,a,u,l,c;s=i.distance(e,t,!0,!0),a=i.distance(e,n,!0,!0),o=i.distance(t,t,!1,!0),r=i.distance(n,n,!1,!0),0!==(c=(u=Math.abs(s))+(l=Math.abs(a)))?this.setRelative(e,e,(o*l+r*u)/c,i,!0):this.setRelative(e,e,(o+r)/2,i,!0)},gi.prototype.setRelative=function(e,t,n,i,o){i=i||this;var r=o?t.xo:t.x,s=o?t.yo:t.y,a=r+n*i.x,u=s+n*i.y,l=i.normalSlope,c=this.slope,h=e.x,d=e.y;e.x=(c*h-l*a+u-d)/(c-l),e.y=c*(e.x-h)+d},gi.prototype.touch=function(e){e.xTouched=!0,e.yTouched=!0},_i.prototype.nextTouched=function(e){for(var t=this.nextPointOnContour;!e.touched(t)&&t!==this;)t=t.nextPointOnContour;return t},_i.prototype.prevTouched=function(e){for(var t=this.prevPointOnContour;!e.touched(t)&&t!==this;)t=t.prevPointOnContour;return t};var yi=Object.freeze(new _i(0,0)),xi={cvCutIn:17/16,deltaBase:9,deltaShift:.125,loop:1,minDis:1,autoFlip:!0};function wi(e,t){switch(this.env=e,this.stack=[],this.prog=t,e){case"glyf":this.zp0=this.zp1=this.zp2=1,this.rp0=this.rp1=this.rp2=0;case"prep":this.fv=this.pv=this.dpv=pi,this.round=ai}}function vi(e){for(var t=e.tZone=new Array(e.gZone.length),n=0;n<t.length;n++)t[n]=new _i(0,0)}function bi(e,t){var n,i=e.prog,o=e.ip,r=1;do{if(88===(n=i[++o]))r++;else if(89===n)r--;else if(64===n)o+=i[o+1]+1;else if(65===n)o+=2*i[o+1]+1;else if(n>=176&&n<=183)o+=n-176+1;else if(n>=184&&n<=191)o+=2*(n-184+1);else if(t&&1===r&&27===n)break}while(r>0);e.ip=o}function Si(t,n){e.DEBUG&&console.log(n.step,"SVTCA["+t.axis+"]"),n.fv=n.pv=n.dpv=t}function Ti(t,n){e.DEBUG&&console.log(n.step,"SPVTCA["+t.axis+"]"),n.pv=n.dpv=t}function Ei(t,n){e.DEBUG&&console.log(n.step,"SFVTCA["+t.axis+"]"),n.fv=t}function Ci(t,n){var i,o,r=n.stack,s=r.pop(),a=r.pop(),u=n.z2[s],l=n.z1[a];e.DEBUG&&console.log("SPVTL["+t+"]",s,a),t?(i=u.y-l.y,o=l.x-u.x):(i=l.x-u.x,o=l.y-u.y),n.pv=n.dpv=mi(i,o)}function Oi(t,n){var i,o,r=n.stack,s=r.pop(),a=r.pop(),u=n.z2[s],l=n.z1[a];e.DEBUG&&console.log("SFVTL["+t+"]",s,a),t?(i=u.y-l.y,o=l.x-u.x):(i=l.x-u.x,o=l.y-u.y),n.fv=mi(i,o)}function Ni(t){var n=t.stack,i=n.pop(),o=n.pop();e.DEBUG&&console.log(t.step,"SPVFS[]",i,o),t.pv=t.dpv=mi(o,i)}function Fi(t){var n=t.stack,i=n.pop(),o=n.pop();e.DEBUG&&console.log(t.step,"SPVFS[]",i,o),t.fv=mi(o,i)}function Mi(t){var n=t.stack,i=t.pv;e.DEBUG&&console.log(t.step,"GPV[]"),n.push(16384*i.x),n.push(16384*i.y)}function Di(t){var n=t.stack,i=t.fv;e.DEBUG&&console.log(t.step,"GFV[]"),n.push(16384*i.x),n.push(16384*i.y)}function Ii(t){t.fv=t.pv,e.DEBUG&&console.log(t.step,"SFVTPV[]")}function Ri(t){var n=t.stack,i=n.pop(),o=n.pop(),r=n.pop(),s=n.pop(),a=n.pop(),u=t.z0,l=t.z1,c=u[i],h=u[o],d=l[r],p=l[s],f=t.z2[a];e.DEBUG&&console.log("ISECT[], ",i,o,r,s,a);var g=c.x,m=c.y,_=h.x,y=h.y,x=d.x,w=d.y,v=p.x,b=p.y,S=(g-_)*(w-b)-(m-y)*(x-v),T=g*y-m*_,E=x*b-w*v;f.x=(T*(x-v)-E*(g-_))/S,f.y=(T*(w-b)-E*(m-y))/S}function Vi(t){t.rp0=t.stack.pop(),e.DEBUG&&console.log(t.step,"SRP0[]",t.rp0)}function Pi(t){t.rp1=t.stack.pop(),e.DEBUG&&console.log(t.step,"SRP1[]",t.rp1)}function Ai(t){t.rp2=t.stack.pop(),e.DEBUG&&console.log(t.step,"SRP2[]",t.rp2)}function Li(t){var n=t.stack.pop();switch(e.DEBUG&&console.log(t.step,"SZP0[]",n),t.zp0=n,n){case 0:t.tZone||vi(t),t.z0=t.tZone;break;case 1:t.z0=t.gZone;break;default:throw new Error("Invalid zone pointer")}}function Ui(t){var n=t.stack.pop();switch(e.DEBUG&&console.log(t.step,"SZP1[]",n),t.zp1=n,n){case 0:t.tZone||vi(t),t.z1=t.tZone;break;case 1:t.z1=t.gZone;break;default:throw new Error("Invalid zone pointer")}}function Bi(t){var n=t.stack.pop();switch(e.DEBUG&&console.log(t.step,"SZP2[]",n),t.zp2=n,n){case 0:t.tZone||vi(t),t.z2=t.tZone;break;case 1:t.z2=t.gZone;break;default:throw new Error("Invalid zone pointer")}}function Xi(t){var n=t.stack.pop();switch(e.DEBUG&&console.log(t.step,"SZPS[]",n),t.zp0=t.zp1=t.zp2=n,n){case 0:t.tZone||vi(t),t.z0=t.z1=t.z2=t.tZone;break;case 1:t.z0=t.z1=t.z2=t.gZone;break;default:throw new Error("Invalid zone pointer")}}function ki(t){t.loop=t.stack.pop(),e.DEBUG&&console.log(t.step,"SLOOP[]",t.loop)}function zi(t){e.DEBUG&&console.log(t.step,"RTG[]"),t.round=ai}function ji(t){e.DEBUG&&console.log(t.step,"RTHG[]"),t.round=li}function Gi(t){var n=t.stack.pop();e.DEBUG&&console.log(t.step,"SMD[]",n),t.minDis=n/64}function Hi(t){e.DEBUG&&console.log(t.step,"ELSE[]"),bi(t,!1)}function qi(t){var n=t.stack.pop();e.DEBUG&&console.log(t.step,"JMPR[]",n),t.ip+=n-1}function Wi(t){var n=t.stack.pop();e.DEBUG&&console.log(t.step,"SCVTCI[]",n),t.cvCutIn=n/64}function Yi(t){var n=t.stack;e.DEBUG&&console.log(t.step,"DUP[]"),n.push(n[n.length-1])}function Ki(t){e.DEBUG&&console.log(t.step,"POP[]"),t.stack.pop()}function Zi(t){e.DEBUG&&console.log(t.step,"CLEAR[]"),t.stack.length=0}function Qi(t){var n=t.stack,i=n.pop(),o=n.pop();e.DEBUG&&console.log(t.step,"SWAP[]"),n.push(i),n.push(o)}function $i(t){var n=t.stack;e.DEBUG&&console.log(t.step,"DEPTH[]"),n.push(n.length)}function Ji(t){var n=t.stack,i=n.pop(),o=n.pop();e.DEBUG&&console.log(t.step,"LOOPCALL[]",i,o);var r=t.ip,s=t.prog;t.prog=t.funcs[i];for(var a=0;a<o;a++)ti(t),e.DEBUG&&console.log(++t.step,a+1<o?"next loopcall":"done loopcall",a);t.ip=r,t.prog=s}function eo(t){var n=t.stack.pop();e.DEBUG&&console.log(t.step,"CALL[]",n);var i=t.ip,o=t.prog;t.prog=t.funcs[n],ti(t),t.ip=i,t.prog=o,e.DEBUG&&console.log(++t.step,"returning from",n)}function to(t){var n=t.stack,i=n.pop();e.DEBUG&&console.log(t.step,"CINDEX[]",i),n.push(n[n.length-i])}function no(t){var n=t.stack,i=n.pop();e.DEBUG&&console.log(t.step,"MINDEX[]",i),n.push(n.splice(n.length-i,1)[0])}function io(t){if("fpgm"!==t.env)throw new Error("FDEF not allowed here");var n=t.stack,i=t.prog,o=t.ip,r=n.pop(),s=o;for(e.DEBUG&&console.log(t.step,"FDEF[]",r);45!==i[++o];);t.ip=o,t.funcs[r]=i.slice(s+1,o)}function oo(t,n){var i=n.stack.pop(),o=n.z0[i],r=n.fv,s=n.pv;e.DEBUG&&console.log(n.step,"MDAP["+t+"]",i);var a=s.distance(o,yi);t&&(a=n.round(a)),r.setRelative(o,yi,a,s),r.touch(o),n.rp0=n.rp1=i}function ro(t,n){var i,o,r,s=n.z2,a=s.length-2;e.DEBUG&&console.log(n.step,"IUP["+t.axis+"]");for(var u=0;u<a;u++)i=s[u],t.touched(i)||(o=i.prevTouched(t))!==i&&(o===(r=i.nextTouched(t))&&t.setRelative(i,i,t.distance(o,o,!1,!0),t,!0),t.interpolate(i,o,r,t))}function so(t,n){for(var i=n.stack,o=t?n.rp1:n.rp2,r=(t?n.z0:n.z1)[o],s=n.fv,a=n.pv,u=n.loop,l=n.z2;u--;){var c=i.pop(),h=l[c],d=a.distance(r,r,!1,!0);s.setRelative(h,h,d,a),s.touch(h),e.DEBUG&&console.log(n.step,(n.loop>1?"loop "+(n.loop-u)+": ":"")+"SHP["+(t?"rp1":"rp2")+"]",c)}n.loop=1}function ao(t,n){var i=n.stack,o=t?n.rp1:n.rp2,r=(t?n.z0:n.z1)[o],s=n.fv,a=n.pv,u=i.pop(),l=n.z2[n.contours[u]],c=l;e.DEBUG&&console.log(n.step,"SHC["+t+"]",u);var h=a.distance(r,r,!1,!0);do{c!==r&&s.setRelative(c,c,h,a),c=c.nextPointOnContour}while(c!==l)}function uo(t,n){var i,o,r=n.stack,s=t?n.rp1:n.rp2,a=(t?n.z0:n.z1)[s],u=n.fv,l=n.pv,c=r.pop();switch(e.DEBUG&&console.log(n.step,"SHZ["+t+"]",c),c){case 0:i=n.tZone;break;case 1:i=n.gZone;break;default:throw new Error("Invalid zone")}for(var h=l.distance(a,a,!1,!0),d=i.length-2,p=0;p<d;p++)o=i[p],u.setRelative(o,o,h,l)}function lo(t){for(var n=t.stack,i=t.loop,o=t.fv,r=n.pop()/64,s=t.z2;i--;){var a=n.pop(),u=s[a];e.DEBUG&&console.log(t.step,(t.loop>1?"loop "+(t.loop-i)+": ":"")+"SHPIX[]",a,r),o.setRelative(u,u,r),o.touch(u)}t.loop=1}function co(t){for(var n=t.stack,i=t.rp1,o=t.rp2,r=t.loop,s=t.z0[i],a=t.z1[o],u=t.fv,l=t.dpv,c=t.z2;r--;){var h=n.pop(),d=c[h];e.DEBUG&&console.log(t.step,(t.loop>1?"loop "+(t.loop-r)+": ":"")+"IP[]",h,i,"<->",o),u.interpolate(d,s,a,l),u.touch(d)}t.loop=1}function ho(t,n){var i=n.stack,o=i.pop()/64,r=i.pop(),s=n.z1[r],a=n.z0[n.rp0],u=n.fv,l=n.pv;u.setRelative(s,a,o,l),u.touch(s),e.DEBUG&&console.log(n.step,"MSIRP["+t+"]",o,r),n.rp1=n.rp0,n.rp2=r,t&&(n.rp0=r)}function po(t){for(var n=t.stack,i=t.rp0,o=t.z0[i],r=t.loop,s=t.fv,a=t.pv,u=t.z1;r--;){var l=n.pop(),c=u[l];e.DEBUG&&console.log(t.step,(t.loop>1?"loop "+(t.loop-r)+": ":"")+"ALIGNRP[]",l),s.setRelative(c,o,0,a),s.touch(c)}t.loop=1}function fo(t){e.DEBUG&&console.log(t.step,"RTDG[]"),t.round=ui}function go(t,n){var i=n.stack,o=i.pop(),r=i.pop(),s=n.z0[r],a=n.fv,u=n.pv,l=n.cvt[o];e.DEBUG&&console.log(n.step,"MIAP["+t+"]",o,"(",l,")",r);var c=u.distance(s,yi);t&&(Math.abs(c-l)<n.cvCutIn&&(c=l),c=n.round(c)),a.setRelative(s,yi,c,u),0===n.zp0&&(s.xo=s.x,s.yo=s.y),a.touch(s),n.rp0=n.rp1=r}function mo(t){var n=t.prog,i=t.ip,o=t.stack,r=n[++i];e.DEBUG&&console.log(t.step,"NPUSHB[]",r);for(var s=0;s<r;s++)o.push(n[++i]);t.ip=i}function _o(t){var n=t.ip,i=t.prog,o=t.stack,r=i[++n];e.DEBUG&&console.log(t.step,"NPUSHW[]",r);for(var s=0;s<r;s++){var a=i[++n]<<8|i[++n];32768&a&&(a=-(1+(65535^a))),o.push(a)}t.ip=n}function yo(t){var n=t.stack,i=t.store;i||(i=t.store=[]);var o=n.pop(),r=n.pop();e.DEBUG&&console.log(t.step,"WS",o,r),i[r]=o}function xo(t){var n=t.stack,i=t.store,o=n.pop();e.DEBUG&&console.log(t.step,"RS",o);var r=i&&i[o]||0;n.push(r)}function wo(t){var n=t.stack,i=n.pop(),o=n.pop();e.DEBUG&&console.log(t.step,"WCVTP",i,o),t.cvt[o]=i/64}function vo(t){var n=t.stack,i=n.pop();e.DEBUG&&console.log(t.step,"RCVT",i),n.push(64*t.cvt[i])}function bo(t,n){var i=n.stack,o=i.pop(),r=n.z2[o];e.DEBUG&&console.log(n.step,"GC["+t+"]",o),i.push(64*n.dpv.distance(r,yi,t,!1))}function So(t,n){var i=n.stack,o=i.pop(),r=i.pop(),s=n.z1[o],a=n.z0[r],u=n.dpv.distance(a,s,t,t);e.DEBUG&&console.log(n.step,"MD["+t+"]",o,r,"->",u),n.stack.push(Math.round(64*u))}function To(t){e.DEBUG&&console.log(t.step,"MPPEM[]"),t.stack.push(t.ppem)}function Eo(t){e.DEBUG&&console.log(t.step,"FLIPON[]"),t.autoFlip=!0}function Co(t){var n=t.stack,i=n.pop(),o=n.pop();e.DEBUG&&console.log(t.step,"LT[]",i,o),n.push(o<i?1:0)}function Oo(t){var n=t.stack,i=n.pop(),o=n.pop();e.DEBUG&&console.log(t.step,"LTEQ[]",i,o),n.push(o<=i?1:0)}function No(t){var n=t.stack,i=n.pop(),o=n.pop();e.DEBUG&&console.log(t.step,"GT[]",i,o),n.push(o>i?1:0)}function Fo(t){var n=t.stack,i=n.pop(),o=n.pop();e.DEBUG&&console.log(t.step,"GTEQ[]",i,o),n.push(o>=i?1:0)}function Mo(t){var n=t.stack,i=n.pop(),o=n.pop();e.DEBUG&&console.log(t.step,"EQ[]",i,o),n.push(i===o?1:0)}function Do(t){var n=t.stack,i=n.pop(),o=n.pop();e.DEBUG&&console.log(t.step,"NEQ[]",i,o),n.push(i!==o?1:0)}function Io(t){var n=t.stack,i=n.pop();e.DEBUG&&console.log(t.step,"ODD[]",i),n.push(Math.trunc(i)%2?1:0)}function Ro(t){var n=t.stack,i=n.pop();e.DEBUG&&console.log(t.step,"EVEN[]",i),n.push(Math.trunc(i)%2?0:1)}function Vo(t){var n=t.stack.pop();e.DEBUG&&console.log(t.step,"IF[]",n),n||(bi(t,!0),e.DEBUG&&console.log(t.step,"EIF[]"))}function Po(t){e.DEBUG&&console.log(t.step,"EIF[]")}function Ao(t){var n=t.stack,i=n.pop(),o=n.pop();e.DEBUG&&console.log(t.step,"AND[]",i,o),n.push(i&&o?1:0)}function Lo(t){var n=t.stack,i=n.pop(),o=n.pop();e.DEBUG&&console.log(t.step,"OR[]",i,o),n.push(i||o?1:0)}function Uo(t){var n=t.stack,i=n.pop();e.DEBUG&&console.log(t.step,"NOT[]",i),n.push(i?0:1)}function Bo(t,n){var i=n.stack,o=i.pop(),r=n.fv,s=n.pv,a=n.ppem,u=n.deltaBase+16*(t-1),l=n.deltaShift,c=n.z0;e.DEBUG&&console.log(n.step,"DELTAP["+t+"]",o,i);for(var h=0;h<o;h++){var d=i.pop(),p=i.pop();if(u+((240&p)>>4)===a){var f=(15&p)-8;f>=0&&f++,e.DEBUG&&console.log(n.step,"DELTAPFIX",d,"by",f*l);var g=c[d];r.setRelative(g,g,f*l,s)}}}function Xo(t){var n=t.stack.pop();e.DEBUG&&console.log(t.step,"SDB[]",n),t.deltaBase=n}function ko(t){var n=t.stack.pop();e.DEBUG&&console.log(t.step,"SDS[]",n),t.deltaShift=Math.pow(.5,n)}function zo(t){var n=t.stack,i=n.pop(),o=n.pop();e.DEBUG&&console.log(t.step,"ADD[]",i,o),n.push(o+i)}function jo(t){var n=t.stack,i=n.pop(),o=n.pop();e.DEBUG&&console.log(t.step,"SUB[]",i,o),n.push(o-i)}function Go(t){var n=t.stack,i=n.pop(),o=n.pop();e.DEBUG&&console.log(t.step,"DIV[]",i,o),n.push(64*o/i)}function Ho(t){var n=t.stack,i=n.pop(),o=n.pop();e.DEBUG&&console.log(t.step,"MUL[]",i,o),n.push(o*i/64)}function qo(t){var n=t.stack,i=n.pop();e.DEBUG&&console.log(t.step,"ABS[]",i),n.push(Math.abs(i))}function Wo(t){var n=t.stack,i=n.pop();e.DEBUG&&console.log(t.step,"NEG[]",i),n.push(-i)}function Yo(t){var n=t.stack,i=n.pop();e.DEBUG&&console.log(t.step,"FLOOR[]",i),n.push(64*Math.floor(i/64))}function Ko(t){var n=t.stack,i=n.pop();e.DEBUG&&console.log(t.step,"CEILING[]",i),n.push(64*Math.ceil(i/64))}function Zo(t,n){var i=n.stack,o=i.pop();e.DEBUG&&console.log(n.step,"ROUND[]"),i.push(64*n.round(o/64))}function Qo(t){var n=t.stack,i=n.pop(),o=n.pop();e.DEBUG&&console.log(t.step,"WCVTF[]",i,o),t.cvt[o]=i*t.ppem/t.font.unitsPerEm}function $o(t,n){var i=n.stack,o=i.pop(),r=n.ppem,s=n.deltaBase+16*(t-1),a=n.deltaShift;e.DEBUG&&console.log(n.step,"DELTAC["+t+"]",o,i);for(var u=0;u<o;u++){var l=i.pop(),c=i.pop();if(s+((240&c)>>4)===r){var h=(15&c)-8;h>=0&&h++;var d=h*a;e.DEBUG&&console.log(n.step,"DELTACFIX",l,"by",d),n.cvt[l]+=d}}}function Jo(t){var n,i=t.stack.pop();switch(e.DEBUG&&console.log(t.step,"SROUND[]",i),t.round=di,192&i){case 0:n=.5;break;case 64:n=1;break;case 128:n=2;break;default:throw new Error("invalid SROUND value")}switch(t.srPeriod=n,48&i){case 0:t.srPhase=0;break;case 16:t.srPhase=.25*n;break;case 32:t.srPhase=.5*n;break;case 48:t.srPhase=.75*n;break;default:throw new Error("invalid SROUND value")}i&=15,t.srThreshold=0===i?0:(i/8-.5)*n}function er(t){var n,i=t.stack.pop();switch(e.DEBUG&&console.log(t.step,"S45ROUND[]",i),t.round=di,192&i){case 0:n=Math.sqrt(2)/2;break;case 64:n=Math.sqrt(2);break;case 128:n=2*Math.sqrt(2);break;default:throw new Error("invalid S45ROUND value")}switch(t.srPeriod=n,48&i){case 0:t.srPhase=0;break;case 16:t.srPhase=.25*n;break;case 32:t.srPhase=.5*n;break;case 48:t.srPhase=.75*n;break;default:throw new Error("invalid S45ROUND value")}i&=15,t.srThreshold=0===i?0:(i/8-.5)*n}function tr(t){e.DEBUG&&console.log(t.step,"ROFF[]"),t.round=si}function nr(t){e.DEBUG&&console.log(t.step,"RUTG[]"),t.round=ci}function ir(t){e.DEBUG&&console.log(t.step,"RDTG[]"),t.round=hi}function or(t){var n=t.stack.pop();e.DEBUG&&console.log(t.step,"SCANCTRL[]",n)}function rr(t,n){var i,o,r=n.stack,s=r.pop(),a=r.pop(),u=n.z2[s],l=n.z1[a];e.DEBUG&&console.log(n.step,"SDPVTL["+t+"]",s,a),t?(i=u.y-l.y,o=l.x-u.x):(i=l.x-u.x,o=l.y-u.y),n.dpv=mi(i,o)}function sr(t){var n=t.stack,i=n.pop(),o=0;e.DEBUG&&console.log(t.step,"GETINFO[]",i),1&i&&(o=35),32&i&&(o|=4096),n.push(o)}function ar(t){var n=t.stack,i=n.pop(),o=n.pop(),r=n.pop();e.DEBUG&&console.log(t.step,"ROLL[]"),n.push(o),n.push(i),n.push(r)}function ur(t){var n=t.stack,i=n.pop(),o=n.pop();e.DEBUG&&console.log(t.step,"MAX[]",i,o),n.push(Math.max(o,i))}function lr(t){var n=t.stack,i=n.pop(),o=n.pop();e.DEBUG&&console.log(t.step,"MIN[]",i,o),n.push(Math.min(o,i))}function cr(t){var n=t.stack.pop();e.DEBUG&&console.log(t.step,"SCANTYPE[]",n)}function hr(t){var n=t.stack.pop(),i=t.stack.pop();switch(e.DEBUG&&console.log(t.step,"INSTCTRL[]",n,i),n){case 1:return void(t.inhibitGridFit=!!i);case 2:return void(t.ignoreCvt=!!i);default:throw new Error("invalid INSTCTRL[] selector")}}function dr(t,n){var i=n.stack,o=n.prog,r=n.ip;e.DEBUG&&console.log(n.step,"PUSHB["+t+"]");for(var s=0;s<t;s++)i.push(o[++r]);n.ip=r}function pr(t,n){var i=n.ip,o=n.prog,r=n.stack;e.DEBUG&&console.log(n.ip,"PUSHW["+t+"]");for(var s=0;s<t;s++){var a=o[++i]<<8|o[++i];32768&a&&(a=-(1+(65535^a))),r.push(a)}n.ip=i}function fr(t,n,i,o,r,s){var a,u,l,c,h=s.stack,d=t&&h.pop(),p=h.pop(),f=s.rp0,g=s.z0[f],m=s.z1[p],_=s.minDis,y=s.fv,x=s.dpv;l=(u=a=x.distance(m,g,!0,!0))>=0?1:-1,u=Math.abs(u),t&&(c=s.cvt[d],o&&Math.abs(u-c)<s.cvCutIn&&(u=c)),i&&u<_&&(u=_),o&&(u=s.round(u)),y.setRelative(m,g,l*u,x),y.touch(m),e.DEBUG&&console.log(s.step,(t?"MIRP[":"MDRP[")+(n?"M":"m")+(i?">":"_")+(o?"R":"_")+(0===r?"Gr":1===r?"Bl":2===r?"Wh":"")+"]",t?d+"("+s.cvt[d]+","+c+")":"",p,"(d =",a,"->",l*u,")"),s.rp1=s.rp0,s.rp2=p,n&&(s.rp0=p)}function gr(e){this.char=e,this.state={},this.activeState=null}function mr(e,t,n){this.contextName=n,this.startIndex=e,this.endOffset=t}function _r(e,t,n){this.contextName=e,this.openRange=null,this.ranges=[],this.checkStart=t,this.checkEnd=n}function yr(e,t){this.context=e,this.index=t,this.length=e.length,this.current=e[t],this.backtrack=e.slice(0,t),this.lookahead=e.slice(t+1)}function xr(e){this.eventId=e,this.subscribers=[]}function wr(e){var t=this,n=["start","end","next","newToken","contextStart","contextEnd","insertToken","removeToken","removeRange","replaceToken","replaceRange","composeRUD","updateContextsRanges"];n.forEach((function(e){Object.defineProperty(t.events,e,{value:new xr(e)})})),e&&n.forEach((function(n){var i=e[n];"function"==typeof i&&t.events[n].subscribe(i)})),["insertToken","removeToken","removeRange","replaceToken","replaceRange","composeRUD"].forEach((function(e){t.events[e].subscribe(t.updateContextsRanges)}))}function vr(e){this.tokens=[],this.registeredContexts={},this.contextCheckers=[],this.events={},this.registeredModifiers=[],wr.call(this,e)}function br(e){return/[\u0600-\u065F\u066A-\u06D2\u06FA-\u06FF]/.test(e)}function Sr(e){return/[\u0630\u0690\u0621\u0631\u0661\u0671\u0622\u0632\u0672\u0692\u06C2\u0623\u0673\u0693\u06C3\u0624\u0694\u06C4\u0625\u0675\u0695\u06C5\u06E5\u0676\u0696\u06C6\u0627\u0677\u0697\u06C7\u0648\u0688\u0698\u06C8\u0689\u0699\u06C9\u068A\u06CA\u066B\u068B\u06CB\u068C\u068D\u06CD\u06FD\u068E\u06EE\u06FE\u062F\u068F\u06CF\u06EF]/.test(e)}function Tr(e){return/[\u0600-\u0605\u060C-\u060E\u0610-\u061B\u061E\u064B-\u065F\u0670\u06D6-\u06DC\u06DF-\u06E4\u06E7\u06E8\u06EA-\u06ED]/.test(e)}function Er(e){return/[A-z]/.test(e)}function Cr(e){return/\s/.test(e)}function Or(e){this.font=e,this.features={}}function Nr(e){this.id=e.id,this.tag=e.tag,this.substitution=e.substitution}function Fr(e,t){if(!e)return-1;switch(t.format){case 1:return t.glyphs.indexOf(e);case 2:for(var n=t.ranges,i=0;i<n.length;i++){var o=n[i];if(e>=o.start&&e<=o.end){var r=e-o.start;return o.index+r}}break;default:return-1}return-1}function Mr(e,t){return-1===Fr(e,t.coverage)?null:e+t.deltaGlyphId}function Dr(e,t){var n=Fr(e,t.coverage);return-1===n?null:t.substitute[n]}function Ir(e,t){for(var n=[],i=0;i<e.length;i++){var o=e[i],r=t.current,s=Fr(r=Array.isArray(r)?r[0]:r,o);-1!==s&&n.push(s)}return n.length!==e.length?-1:n}function Rr(e,t){var n=t.inputCoverage.length+t.lookaheadCoverage.length+t.backtrackCoverage.length;if(e.context.length<n)return[];var i=Ir(t.inputCoverage,e);if(-1===i)return[];var o=t.inputCoverage.length-1;if(e.lookahead.length<t.lookaheadCoverage.length)return[];for(var r=e.lookahead.slice(o);r.length&&Tr(r[0].char);)r.shift();var s=new yr(r,0),a=Ir(t.lookaheadCoverage,s),u=[].concat(e.backtrack);for(u.reverse();u.length&&Tr(u[0].char);)u.shift();if(u.length<t.backtrackCoverage.length)return[];var l=new yr(u,0),c=Ir(t.backtrackCoverage,l),h=[];if(i.length===t.inputCoverage.length&&a.length===t.lookaheadCoverage.length&&c.length===t.backtrackCoverage.length)for(var d=0;d<t.lookupRecords.length;d++)for(var p=t.lookupRecords[d].lookupListIndex,f=this.getLookupByIndex(p),g=0;g<f.subtables.length;g++){var m=f.subtables[g],_=this.getLookupMethod(f,m);if("12"===this.getSubstitutionType(f,m))for(var y=0;y<i.length;y++){var x=_(e.get(y));x&&h.push(x)}}return h}function Vr(e,t){var n,i=Fr(e.current,t.coverage);if(-1===i)return null;for(var o=t.ligatureSets[i],r=0;r<o.length;r++){n=o[r];for(var s=0;s<n.components.length&&e.lookahead[s]===n.components[s];s++)if(s===n.components.length-1)return n}return null}function Pr(e,t){var n=Fr(e,t.coverage);return-1===n?null:t.sequences[n]}function Ar(e){var t=e.current,n=e.get(-1);return null===n&&br(t)||!br(n)&&br(t)}function Lr(e){var t=e.get(1);return null===t||!br(t)}ri.prototype.exec=function(t,n){if("number"!=typeof n)throw new Error("Point size is not a number!");if(!(this._errorState>2)){var i=this.font,o=this._prepState;if(!o||o.ppem!==n){var r=this._fpgmState;if(!r){wi.prototype=xi,(r=this._fpgmState=new wi("fpgm",i.tables.fpgm)).funcs=[],r.font=i,e.DEBUG&&(console.log("---EXEC FPGM---"),r.step=-1);try{ti(r)}catch(e){return console.log("Hinting error in FPGM:"+e),void(this._errorState=3)}}wi.prototype=r,(o=this._prepState=new wi("prep",i.tables.prep)).ppem=n;var s=i.tables.cvt;if(s)for(var a=o.cvt=new Array(s.length),u=n/i.unitsPerEm,l=0;l<s.length;l++)a[l]=s[l]*u;else o.cvt=[];e.DEBUG&&(console.log("---EXEC PREP---"),o.step=-1);try{ti(o)}catch(e){this._errorState<2&&console.log("Hinting error in PREP:"+e),this._errorState=2}}if(!(this._errorState>1))try{return ni(t,o)}catch(e){return this._errorState<1&&(console.log("Hinting error:"+e),console.log("Note: further hinting errors are silenced")),void(this._errorState=1)}}},ni=function(t,n){var i,o,r,s=n.ppem/n.font.unitsPerEm,a=s,u=t.components;if(wi.prototype=n,u){var l=n.font;o=[],i=[];for(var c=0;c<u.length;c++){var h=u[c],d=l.glyphs.get(h.glyphIndex);r=new wi("glyf",d.instructions),e.DEBUG&&(console.log("---EXEC COMP "+c+"---"),r.step=-1),ii(d,r,s,a);for(var p=Math.round(h.dx*s),f=Math.round(h.dy*a),g=r.gZone,m=r.contours,_=0;_<g.length;_++){var y=g[_];y.xTouched=y.yTouched=!1,y.xo=y.x=y.x+p,y.yo=y.y=y.y+f}var x=o.length;o.push.apply(o,g);for(var w=0;w<m.length;w++)i.push(m[w]+x)}t.instructions&&!r.inhibitGridFit&&((r=new wi("glyf",t.instructions)).gZone=r.z0=r.z1=r.z2=o,r.contours=i,o.push(new _i(0,0),new _i(Math.round(t.advanceWidth*s),0)),e.DEBUG&&(console.log("---EXEC COMPOSITE---"),r.step=-1),ti(r),o.length-=2)}else r=new wi("glyf",t.instructions),e.DEBUG&&(console.log("---EXEC GLYPH---"),r.step=-1),ii(t,r,s,a),o=r.gZone;return o},ii=function(t,n,i,o){for(var r,s,a,u=t.points||[],l=u.length,c=n.gZone=n.z0=n.z1=n.z2=[],h=n.contours=[],d=0;d<l;d++)r=u[d],c[d]=new _i(r.x*i,r.y*o,r.lastPointOfContour,r.onCurve);for(var p=0;p<l;p++)r=c[p],s||(s=r,h.push(p)),r.lastPointOfContour?(r.nextPointOnContour=s,s.prevPointOnContour=r,s=void 0):(a=c[p+1],r.nextPointOnContour=a,a.prevPointOnContour=r);if(!n.inhibitGridFit){if(e.DEBUG){console.log("PROCESSING GLYPH",n.stack);for(var f=0;f<l;f++)console.log(f,c[f].x,c[f].y)}if(c.push(new _i(0,0),new _i(Math.round(t.advanceWidth*i),0)),ti(n),c.length-=2,e.DEBUG){console.log("FINISHED GLYPH",n.stack);for(var g=0;g<l;g++)console.log(g,c[g].x,c[g].y)}}},ti=function(t){var n=t.prog;if(n){var i,o=n.length;for(t.ip=0;t.ip<o;t.ip++){if(e.DEBUG&&t.step++,!(i=ei[n[t.ip]]))throw new Error("unknown instruction: 0x"+Number(n[t.ip]).toString(16));i(t)}}},ei=[Si.bind(void 0,fi),Si.bind(void 0,pi),Ti.bind(void 0,fi),Ti.bind(void 0,pi),Ei.bind(void 0,fi),Ei.bind(void 0,pi),Ci.bind(void 0,0),Ci.bind(void 0,1),Oi.bind(void 0,0),Oi.bind(void 0,1),Ni,Fi,Mi,Di,Ii,Ri,Vi,Pi,Ai,Li,Ui,Bi,Xi,ki,zi,ji,Gi,Hi,qi,Wi,void 0,void 0,Yi,Ki,Zi,Qi,$i,to,no,void 0,void 0,void 0,Ji,eo,io,void 0,oo.bind(void 0,0),oo.bind(void 0,1),ro.bind(void 0,fi),ro.bind(void 0,pi),so.bind(void 0,0),so.bind(void 0,1),ao.bind(void 0,0),ao.bind(void 0,1),uo.bind(void 0,0),uo.bind(void 0,1),lo,co,ho.bind(void 0,0),ho.bind(void 0,1),po,fo,go.bind(void 0,0),go.bind(void 0,1),mo,_o,yo,xo,wo,vo,bo.bind(void 0,0),bo.bind(void 0,1),void 0,So.bind(void 0,0),So.bind(void 0,1),To,void 0,Eo,void 0,void 0,Co,Oo,No,Fo,Mo,Do,Io,Ro,Vo,Po,Ao,Lo,Uo,Bo.bind(void 0,1),Xo,ko,zo,jo,Go,Ho,qo,Wo,Yo,Ko,Zo.bind(void 0,0),Zo.bind(void 0,1),Zo.bind(void 0,2),Zo.bind(void 0,3),void 0,void 0,void 0,void 0,Qo,Bo.bind(void 0,2),Bo.bind(void 0,3),$o.bind(void 0,1),$o.bind(void 0,2),$o.bind(void 0,3),Jo,er,void 0,void 0,tr,void 0,nr,ir,Ki,Ki,void 0,void 0,void 0,void 0,void 0,or,rr.bind(void 0,0),rr.bind(void 0,1),sr,void 0,ar,ur,lr,cr,hr,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,dr.bind(void 0,1),dr.bind(void 0,2),dr.bind(void 0,3),dr.bind(void 0,4),dr.bind(void 0,5),dr.bind(void 0,6),dr.bind(void 0,7),dr.bind(void 0,8),pr.bind(void 0,1),pr.bind(void 0,2),pr.bind(void 0,3),pr.bind(void 0,4),pr.bind(void 0,5),pr.bind(void 0,6),pr.bind(void 0,7),pr.bind(void 0,8),fr.bind(void 0,0,0,0,0,0),fr.bind(void 0,0,0,0,0,1),fr.bind(void 0,0,0,0,0,2),fr.bind(void 0,0,0,0,0,3),fr.bind(void 0,0,0,0,1,0),fr.bind(void 0,0,0,0,1,1),fr.bind(void 0,0,0,0,1,2),fr.bind(void 0,0,0,0,1,3),fr.bind(void 0,0,0,1,0,0),fr.bind(void 0,0,0,1,0,1),fr.bind(void 0,0,0,1,0,2),fr.bind(void 0,0,0,1,0,3),fr.bind(void 0,0,0,1,1,0),fr.bind(void 0,0,0,1,1,1),fr.bind(void 0,0,0,1,1,2),fr.bind(void 0,0,0,1,1,3),fr.bind(void 0,0,1,0,0,0),fr.bind(void 0,0,1,0,0,1),fr.bind(void 0,0,1,0,0,2),fr.bind(void 0,0,1,0,0,3),fr.bind(void 0,0,1,0,1,0),fr.bind(void 0,0,1,0,1,1),fr.bind(void 0,0,1,0,1,2),fr.bind(void 0,0,1,0,1,3),fr.bind(void 0,0,1,1,0,0),fr.bind(void 0,0,1,1,0,1),fr.bind(void 0,0,1,1,0,2),fr.bind(void 0,0,1,1,0,3),fr.bind(void 0,0,1,1,1,0),fr.bind(void 0,0,1,1,1,1),fr.bind(void 0,0,1,1,1,2),fr.bind(void 0,0,1,1,1,3),fr.bind(void 0,1,0,0,0,0),fr.bind(void 0,1,0,0,0,1),fr.bind(void 0,1,0,0,0,2),fr.bind(void 0,1,0,0,0,3),fr.bind(void 0,1,0,0,1,0),fr.bind(void 0,1,0,0,1,1),fr.bind(void 0,1,0,0,1,2),fr.bind(void 0,1,0,0,1,3),fr.bind(void 0,1,0,1,0,0),fr.bind(void 0,1,0,1,0,1),fr.bind(void 0,1,0,1,0,2),fr.bind(void 0,1,0,1,0,3),fr.bind(void 0,1,0,1,1,0),fr.bind(void 0,1,0,1,1,1),fr.bind(void 0,1,0,1,1,2),fr.bind(void 0,1,0,1,1,3),fr.bind(void 0,1,1,0,0,0),fr.bind(void 0,1,1,0,0,1),fr.bind(void 0,1,1,0,0,2),fr.bind(void 0,1,1,0,0,3),fr.bind(void 0,1,1,0,1,0),fr.bind(void 0,1,1,0,1,1),fr.bind(void 0,1,1,0,1,2),fr.bind(void 0,1,1,0,1,3),fr.bind(void 0,1,1,1,0,0),fr.bind(void 0,1,1,1,0,1),fr.bind(void 0,1,1,1,0,2),fr.bind(void 0,1,1,1,0,3),fr.bind(void 0,1,1,1,1,0),fr.bind(void 0,1,1,1,1,1),fr.bind(void 0,1,1,1,1,2),fr.bind(void 0,1,1,1,1,3)],gr.prototype.setState=function(e,t){return this.state[e]=t,this.activeState={key:e,value:this.state[e]},this.activeState},gr.prototype.getState=function(e){return this.state[e]||null},vr.prototype.inboundIndex=function(e){return e>=0&&e<this.tokens.length},vr.prototype.composeRUD=function(e){var t=this,n=!0,i=e.map((function(e){return t[e[0]].apply(t,e.slice(1).concat(n))})),o=function(e){return"object"==typeof e&&e.hasOwnProperty("FAIL")};if(i.every(o))return{FAIL:"composeRUD: one or more operations hasn't completed successfully",report:i.filter(o)};this.dispatch("composeRUD",[i.filter((function(e){return!o(e)}))])},vr.prototype.replaceRange=function(e,t,n,i){t=null!==t?t:this.tokens.length;var o=n.every((function(e){return e instanceof gr}));if(!isNaN(e)&&this.inboundIndex(e)&&o){var r=this.tokens.splice.apply(this.tokens,[e,t].concat(n));return i||this.dispatch("replaceToken",[e,t,n]),[r,n]}return{FAIL:"replaceRange: invalid tokens or startIndex."}},vr.prototype.replaceToken=function(e,t,n){if(!isNaN(e)&&this.inboundIndex(e)&&t instanceof gr){var i=this.tokens.splice(e,1,t);return n||this.dispatch("replaceToken",[e,t]),[i[0],t]}return{FAIL:"replaceToken: invalid token or index."}},vr.prototype.removeRange=function(e,t,n){t=isNaN(t)?this.tokens.length:t;var i=this.tokens.splice(e,t);return n||this.dispatch("removeRange",[i,e,t]),i},vr.prototype.removeToken=function(e,t){if(!isNaN(e)&&this.inboundIndex(e)){var n=this.tokens.splice(e,1);return t||this.dispatch("removeToken",[n,e]),n}return{FAIL:"removeToken: invalid token index."}},vr.prototype.insertToken=function(e,t,n){return e.every((function(e){return e instanceof gr}))?(this.tokens.splice.apply(this.tokens,[t,0].concat(e)),n||this.dispatch("insertToken",[e,t]),e):{FAIL:"insertToken: invalid token(s)."}},vr.prototype.registerModifier=function(e,t,n){this.events.newToken.subscribe((function(i,o){var r=[i,o],s=[i,o];if(null===t||!0===t.apply(this,r)){var a=n.apply(this,s);i.setState(e,a)}})),this.registeredModifiers.push(e)},xr.prototype.subscribe=function(e){return"function"==typeof e?this.subscribers.push(e)-1:{FAIL:"invalid '"+this.eventId+"' event handler"}},xr.prototype.unsubscribe=function(e){this.subscribers.splice(e,1)},yr.prototype.setCurrentIndex=function(e){this.index=e,this.current=this.context[e],this.backtrack=this.context.slice(0,e),this.lookahead=this.context.slice(e+1)},yr.prototype.get=function(e){switch(!0){case 0===e:return this.current;case e<0&&Math.abs(e)<=this.backtrack.length:return this.backtrack.slice(e)[0];case e>0&&e<=this.lookahead.length:return this.lookahead[e-1];default:return null}},vr.prototype.rangeToText=function(e){if(e instanceof mr)return this.getRangeTokens(e).map((function(e){return e.char})).join("")},vr.prototype.getText=function(){return this.tokens.map((function(e){return e.char})).join("")},vr.prototype.getContext=function(e){var t=this.registeredContexts[e];return t||null},vr.prototype.on=function(e,t){var n=this.events[e];return n?n.subscribe(t):null},vr.prototype.dispatch=function(e,t){var n=this,i=this.events[e];i instanceof xr&&i.subscribers.forEach((function(e){e.apply(n,t||[])}))},vr.prototype.registerContextChecker=function(e,t,n){if(this.getContext(e))return{FAIL:"context name '"+e+"' is already registered."};if("function"!=typeof t)return{FAIL:"missing context start check."};if("function"!=typeof n)return{FAIL:"missing context end check."};var i=new _r(e,t,n);return this.registeredContexts[e]=i,this.contextCheckers.push(i),i},vr.prototype.getRangeTokens=function(e){var t=e.startIndex+e.endOffset;return[].concat(this.tokens.slice(e.startIndex,t))},vr.prototype.getContextRanges=function(e){var t=this.getContext(e);return t?t.ranges:{FAIL:"context checker '"+e+"' is not registered."}},vr.prototype.resetContextsRanges=function(){var e=this.registeredContexts;for(var t in e)e.hasOwnProperty(t)&&(e[t].ranges=[])},vr.prototype.updateContextsRanges=function(){this.resetContextsRanges();for(var e=this.tokens.map((function(e){return e.char})),t=0;t<e.length;t++){var n=new yr(e,t);this.runContextCheck(n)}this.dispatch("updateContextsRanges",[this.registeredContexts])},vr.prototype.setEndOffset=function(e,t){var n=new mr(this.getContext(t).openRange.startIndex,e,t),i=this.getContext(t).ranges;return n.rangeId=t+"."+i.length,i.push(n),this.getContext(t).openRange=null,n},vr.prototype.runContextCheck=function(e){var t=this,n=e.index;this.contextCheckers.forEach((function(i){var o=i.contextName,r=t.getContext(o).openRange;if(!r&&i.checkStart(e)&&(r=new mr(n,null,o),t.getContext(o).openRange=r,t.dispatch("contextStart",[o,n])),r&&i.checkEnd(e)){var s=n-r.startIndex+1,a=t.setEndOffset(s,o);t.dispatch("contextEnd",[o,a])}}))},vr.prototype.tokenize=function(e){this.tokens=[],this.resetContextsRanges();var t=Array.from(e);this.dispatch("start");for(var n=0;n<t.length;n++){var i=t[n],o=new yr(t,n);this.dispatch("next",[o]),this.runContextCheck(o);var r=new gr(i);this.tokens.push(r),this.dispatch("newToken",[r,o])}return this.dispatch("end",[this.tokens]),this.tokens},Or.prototype.getDefaultScriptFeaturesIndexes=function(){for(var e=this.font.tables.gsub.scripts,t=0;t<e.length;t++){var n=e[t];if("DFLT"===n.tag)return n.script.defaultLangSys.featureIndexes}return[]},Or.prototype.getScriptFeaturesIndexes=function(e){if(!this.font.tables.gsub)return[];if(!e)return this.getDefaultScriptFeaturesIndexes();for(var t=this.font.tables.gsub.scripts,n=0;n<t.length;n++){var i=t[n];if(i.tag===e&&i.script.defaultLangSys)return i.script.defaultLangSys.featureIndexes;var o=i.langSysRecords;if(o)for(var r=0;r<o.length;r++){var s=o[r];if(s.tag===e)return s.langSys.featureIndexes}}return this.getDefaultScriptFeaturesIndexes()},Or.prototype.mapTagsToFeatures=function(e,t){for(var n={},i=0;i<e.length;i++){var o=e[i].tag,r=e[i].feature;n[o]=r}this.features[t].tags=n},Or.prototype.getScriptFeatures=function(e){var t=this.features[e];if(this.features.hasOwnProperty(e))return t;var n=this.getScriptFeaturesIndexes(e);if(!n)return null;var i=this.font.tables.gsub;return t=n.map((function(e){return i.features[e]})),this.features[e]=t,this.mapTagsToFeatures(t,e),t},Or.prototype.getSubstitutionType=function(e,t){return e.lookupType.toString()+t.substFormat.toString()},Or.prototype.getLookupMethod=function(e,t){var n=this;switch(this.getSubstitutionType(e,t)){case"11":return function(e){return Mr.apply(n,[e,t])};case"12":return function(e){return Dr.apply(n,[e,t])};case"63":return function(e){return Rr.apply(n,[e,t])};case"41":return function(e){return Vr.apply(n,[e,t])};case"21":return function(e){return Pr.apply(n,[e,t])};default:throw new Error("lookupType: "+e.lookupType+" - substFormat: "+t.substFormat+" is not yet supported")}},Or.prototype.lookupFeature=function(e){var t=e.contextParams,n=t.index,i=this.getFeature({tag:e.tag,script:e.script});if(!i)return new Error("font '"+this.font.names.fullName.en+"' doesn't support feature '"+e.tag+"' for script '"+e.script+"'.");for(var o=this.getFeatureLookups(i),r=[].concat(t.context),s=0;s<o.length;s++)for(var a=o[s],u=this.getLookupSubtables(a),l=0;l<u.length;l++){var c=u[l],h=this.getSubstitutionType(a,c),d=this.getLookupMethod(a,c),p=void 0;switch(h){case"11":(p=d(t.current))&&r.splice(n,1,new Nr({id:11,tag:e.tag,substitution:p}));break;case"12":(p=d(t.current))&&r.splice(n,1,new Nr({id:12,tag:e.tag,substitution:p}));break;case"63":p=d(t),Array.isArray(p)&&p.length&&r.splice(n,1,new Nr({id:63,tag:e.tag,substitution:p}));break;case"41":(p=d(t))&&r.splice(n,1,new Nr({id:41,tag:e.tag,substitution:p}));break;case"21":(p=d(t.current))&&r.splice(n,1,new Nr({id:21,tag:e.tag,substitution:p}))}t=new yr(r,n),Array.isArray(p)&&!p.length||(p=null)}return r.length?r:null},Or.prototype.supports=function(e){if(!e.script)return!1;this.getScriptFeatures(e.script);var t=this.features.hasOwnProperty(e.script);if(!e.tag)return t;var n=this.features[e.script].some((function(t){return t.tag===e.tag}));return t&&n},Or.prototype.getLookupSubtables=function(e){return e.subtables||null},Or.prototype.getLookupByIndex=function(e){return this.font.tables.gsub.lookups[e]||null},Or.prototype.getFeatureLookups=function(e){return e.lookupListIndexes.map(this.getLookupByIndex.bind(this))},Or.prototype.getFeature=function(e){if(!this.font)return{FAIL:"No font was found"};this.features.hasOwnProperty(e.script)||this.getScriptFeatures(e.script);var t=this.features[e.script];return t?t.tags[e.tag]?this.features[e.script].tags[e.tag]:null:{FAIL:"No feature for script "+e.script}};var Ur={startCheck:Ar,endCheck:Lr};function Br(e){var t=e.current,n=e.get(-1);return(br(t)||Tr(t))&&!br(n)}function Xr(e){var t=e.get(1);switch(!0){case null===t:return!0;case!br(t)&&!Tr(t):var n=Cr(t);if(!n)return!0;if(n&&!e.lookahead.some((function(e){return br(e)||Tr(e)})))return!0;break;default:return!1}}var kr={startCheck:Br,endCheck:Xr};function zr(e,t,n){t[n].setState(e.tag,e.substitution)}function jr(e,t,n){t[n].setState(e.tag,e.substitution)}function Gr(e,t,n){e.substitution.forEach((function(i,o){t[n+o].setState(e.tag,i)}))}function Hr(e,t,n){var i=t[n];i.setState(e.tag,e.substitution.ligGlyph);for(var o=e.substitution.components.length,r=0;r<o;r++)(i=t[n+r+1]).setState("deleted",!0)}var qr={11:zr,12:jr,63:Gr,41:Hr};function Wr(e,t,n){e instanceof Nr&&qr[e.id]&&qr[e.id](e,t,n)}function Yr(e){for(var t=[].concat(e.backtrack),n=t.length-1;n>=0;n--){var i=t[n],o=Sr(i),r=Tr(i);if(!o&&!r)return!0;if(o)return!1}return!1}function Kr(e){if(Sr(e.current))return!1;for(var t=0;t<e.lookahead.length;t++)if(!Tr(e.lookahead[t]))return!0;return!1}function Zr(e){var t=this,n="arab",i=this.featuresTags[n],o=this.tokenizer.getRangeTokens(e);if(1!==o.length){var r=new yr(o.map((function(e){return e.getState("glyphIndex")})),0),s=new yr(o.map((function(e){return e.char})),0);o.forEach((function(e,a){if(!Tr(e.char)){r.setCurrentIndex(a),s.setCurrentIndex(a);var u,l=0;switch(Yr(s)&&(l|=1),Kr(s)&&(l|=2),l){case 1:u="fina";break;case 2:u="init";break;case 3:u="medi"}if(-1!==i.indexOf(u)){var c=t.query.lookupFeature({tag:u,script:n,contextParams:r});if(c instanceof Error)return console.info(c.message);c.forEach((function(e,t){e instanceof Nr&&(Wr(e,o,t),r.context[t]=e.substitution)}))}}}))}}function Qr(e,t){return new yr(e.map((function(e){return e.activeState.value})),t||0)}function $r(e){var t=this,n="arab",i=this.tokenizer.getRangeTokens(e),o=Qr(i);o.context.forEach((function(e,r){o.setCurrentIndex(r);var s=t.query.lookupFeature({tag:"rlig",script:n,contextParams:o});s.length&&(s.forEach((function(e){return Wr(e,i,r)})),o=Qr(i))}))}function Jr(e){var t=e.current,n=e.get(-1);return null===n&&Er(t)||!Er(n)&&Er(t)}function es(e){var t=e.get(1);return null===t||!Er(t)}var ts={startCheck:Jr,endCheck:es};function ns(e,t){return new yr(e.map((function(e){return e.activeState.value})),t||0)}function is(e){var t=this,n="latn",i=this.tokenizer.getRangeTokens(e),o=ns(i);o.context.forEach((function(e,r){o.setCurrentIndex(r);var s=t.query.lookupFeature({tag:"liga",script:n,contextParams:o});s.length&&(s.forEach((function(e){return Wr(e,i,r)})),o=ns(i))}))}function os(e){this.baseDir=e||"ltr",this.tokenizer=new vr,this.featuresTags={}}function rs(e){var t=this.contextChecks[e+"Check"];return this.tokenizer.registerContextChecker(e,t.startCheck,t.endCheck)}function ss(){return rs.call(this,"latinWord"),rs.call(this,"arabicWord"),rs.call(this,"arabicSentence"),this.tokenizer.tokenize(this.text)}function as(){var e=this;this.tokenizer.getContextRanges("arabicSentence").forEach((function(t){var n=e.tokenizer.getRangeTokens(t);e.tokenizer.replaceRange(t.startIndex,t.endOffset,n.reverse())}))}function us(){if(-1===this.tokenizer.registeredModifiers.indexOf("glyphIndex"))throw new Error("glyphIndex modifier is required to apply arabic presentation features.")}function ls(){var e=this,t="arab";this.featuresTags.hasOwnProperty(t)&&(us.call(this),this.tokenizer.getContextRanges("arabicWord").forEach((function(t){Zr.call(e,t)})))}function cs(){var e=this,t="arab";this.featuresTags.hasOwnProperty(t)&&-1!==this.featuresTags[t].indexOf("rlig")&&(us.call(this),this.tokenizer.getContextRanges("arabicWord").forEach((function(t){$r.call(e,t)})))}function hs(){var e=this,t="latn";this.featuresTags.hasOwnProperty(t)&&-1!==this.featuresTags[t].indexOf("liga")&&(us.call(this),this.tokenizer.getContextRanges("latinWord").forEach((function(t){is.call(e,t)})))}function ds(e){(e=e||{}).tables=e.tables||{},e.empty||(Gn(e.familyName,"When creating a new Font object, familyName is required."),Gn(e.styleName,"When creating a new Font object, styleName is required."),Gn(e.unitsPerEm,"When creating a new Font object, unitsPerEm is required."),Gn(e.ascender,"When creating a new Font object, ascender is required."),Gn(e.descender<=0,"When creating a new Font object, negative descender value is required."),this.names={fontFamily:{en:e.familyName||" "},fontSubfamily:{en:e.styleName||" "},fullName:{en:e.fullName||e.familyName+" "+e.styleName},postScriptName:{en:e.postScriptName||(e.familyName+e.styleName).replace(/\s/g,"")},designer:{en:e.designer||" "},designerURL:{en:e.designerURL||" "},manufacturer:{en:e.manufacturer||" "},manufacturerURL:{en:e.manufacturerURL||" "},license:{en:e.license||" "},licenseURL:{en:e.licenseURL||" "},version:{en:e.version||"Version 0.1"},description:{en:e.description||" "},copyright:{en:e.copyright||" "},trademark:{en:e.trademark||" "}},this.unitsPerEm=e.unitsPerEm||1e3,this.ascender=e.ascender,this.descender=e.descender,this.createdTimestamp=e.createdTimestamp,this.tables=Object.assign(e.tables,{os2:Object.assign({usWeightClass:e.weightClass||this.usWeightClasses.MEDIUM,usWidthClass:e.widthClass||this.usWidthClasses.MEDIUM,fsSelection:e.fsSelection||this.fsSelectionValues.REGULAR},e.tables.os2)})),this.supported=!0,this.glyphs=new He.GlyphSet(this,e.glyphs||[]),this.encoding=new Fe(this),this.position=new Ln(this),this.substitution=new Un(this),this.tables=this.tables||{},this._push=null,this._hmtxTableData={},Object.defineProperty(this,"hinting",{get:function(){return this._hinting?this._hinting:"truetype"===this.outlinesFormat?this._hinting=new ri(this):void 0}})}function ps(e,t){var n=JSON.stringify(e),i=256;for(var o in t){var r=parseInt(o);if(r&&!(r<256)){if(JSON.stringify(t[o])===n)return r;i<=r&&(i=r+1)}}return t[i]=e,i}function fs(e,t,n){var i=ps(t.name,n);return[{name:"tag_"+e,type:"TAG",value:t.tag},{name:"minValue_"+e,type:"FIXED",value:t.minValue<<16},{name:"defaultValue_"+e,type:"FIXED",value:t.defaultValue<<16},{name:"maxValue_"+e,type:"FIXED",value:t.maxValue<<16},{name:"flags_"+e,type:"USHORT",value:0},{name:"nameID_"+e,type:"USHORT",value:i}]}function gs(e,t,n){var i={},o=new _e.Parser(e,t);return i.tag=o.parseTag(),i.minValue=o.parseFixed(),i.defaultValue=o.parseFixed(),i.maxValue=o.parseFixed(),o.skip("uShort",1),i.name=n[o.parseUShort()]||{},i}function ms(e,t,n,i){for(var o=[{name:"nameID_"+e,type:"USHORT",value:ps(t.name,i)},{name:"flags_"+e,type:"USHORT",value:0}],r=0;r<n.length;++r){var s=n[r].tag;o.push({name:"axis_"+e+" "+s,type:"FIXED",value:t.coordinates[s]<<16})}return o}function _s(e,t,n,i){var o={},r=new _e.Parser(e,t);o.name=i[r.parseUShort()]||{},r.skip("uShort",1),o.coordinates={};for(var s=0;s<n.length;++s)o.coordinates[n[s].tag]=r.parseFixed();return o}function ys(e,t){var n=new oe.Table("fvar",[{name:"version",type:"ULONG",value:65536},{name:"offsetToData",type:"USHORT",value:0},{name:"countSizePairs",type:"USHORT",value:2},{name:"axisCount",type:"USHORT",value:e.axes.length},{name:"axisSize",type:"USHORT",value:20},{name:"instanceCount",type:"USHORT",value:e.instances.length},{name:"instanceSize",type:"USHORT",value:4+4*e.axes.length}]);n.offsetToData=n.sizeOf();for(var i=0;i<e.axes.length;i++)n.fields=n.fields.concat(fs(i,e.axes[i],t));for(var o=0;o<e.instances.length;o++)n.fields=n.fields.concat(ms(o,e.instances[o],e.axes,t));return n}function xs(e,t,n){var i=new _e.Parser(e,t),o=i.parseULong();V.argument(65536===o,"Unsupported fvar table version.");var r=i.parseOffset16();i.skip("uShort",1);for(var s=i.parseUShort(),a=i.parseUShort(),u=i.parseUShort(),l=i.parseUShort(),c=[],h=0;h<s;h++)c.push(gs(e,t+r+h*a,n));for(var d=[],p=t+r+s*a,f=0;f<u;f++)d.push(_s(e,p+f*l,c,n));return{axes:c,instances:d}}os.prototype.setText=function(e){this.text=e},os.prototype.contextChecks={latinWordCheck:ts,arabicWordCheck:Ur,arabicSentenceCheck:kr},os.prototype.registerFeatures=function(e,t){var n=this,i=t.filter((function(t){return n.query.supports({script:e,tag:t})}));this.featuresTags.hasOwnProperty(e)?this.featuresTags[e]=this.featuresTags[e].concat(i):this.featuresTags[e]=i},os.prototype.applyFeatures=function(e,t){if(!e)throw new Error("No valid font was provided to apply features");this.query||(this.query=new Or(e));for(var n=0;n<t.length;n++){var i=t[n];this.query.supports({script:i.script})&&this.registerFeatures(i.script,i.tags)}},os.prototype.registerModifier=function(e,t,n){this.tokenizer.registerModifier(e,t,n)},os.prototype.checkContextReady=function(e){return!!this.tokenizer.getContext(e)},os.prototype.applyFeaturesToContexts=function(){this.checkContextReady("arabicWord")&&(ls.call(this),cs.call(this)),this.checkContextReady("latinWord")&&hs.call(this),this.checkContextReady("arabicSentence")&&as.call(this)},os.prototype.processText=function(e){this.text&&this.text===e||(this.setText(e),ss.call(this),this.applyFeaturesToContexts())},os.prototype.getBidiText=function(e){return this.processText(e),this.tokenizer.getText()},os.prototype.getTextGlyphs=function(e){this.processText(e);for(var t=[],n=0;n<this.tokenizer.tokens.length;n++){var i=this.tokenizer.tokens[n];if(!i.state.deleted){var o=i.activeState.value;t.push(Array.isArray(o)?o[0]:o)}}return t},ds.prototype.hasChar=function(e){return null!==this.encoding.charToGlyphIndex(e)},ds.prototype.charToGlyphIndex=function(e){return this.encoding.charToGlyphIndex(e)},ds.prototype.charToGlyph=function(e){var t=this.charToGlyphIndex(e),n=this.glyphs.get(t);return n||(n=this.glyphs.get(0)),n},ds.prototype.updateFeatures=function(e){return this.defaultRenderOptions.features.map((function(t){return"latn"===t.script?{script:"latn",tags:t.tags.filter((function(t){return e[t]}))}:t}))},ds.prototype.stringToGlyphs=function(e,t){var n=this,i=new os,o=function(e){return n.charToGlyphIndex(e.char)};i.registerModifier("glyphIndex",null,o);var r=t?this.updateFeatures(t.features):this.defaultRenderOptions.features;i.applyFeatures(this,r);for(var s=i.getTextGlyphs(e),a=s.length,u=new Array(a),l=this.glyphs.get(0),c=0;c<a;c+=1)u[c]=this.glyphs.get(s[c])||l;return u},ds.prototype.nameToGlyphIndex=function(e){return this.glyphNames.nameToGlyphIndex(e)},ds.prototype.nameToGlyph=function(e){var t=this.nameToGlyphIndex(e),n=this.glyphs.get(t);return n||(n=this.glyphs.get(0)),n},ds.prototype.glyphIndexToName=function(e){return this.glyphNames.glyphIndexToName?this.glyphNames.glyphIndexToName(e):""},ds.prototype.getKerningValue=function(e,t){e=e.index||e,t=t.index||t;var n=this.position.defaultKerningTables;return n?this.position.getKerningValue(n,e,t):this.kerningPairs[e+","+t]||0},ds.prototype.defaultRenderOptions={kerning:!0,features:[{script:"arab",tags:["init","medi","fina","rlig"]},{script:"latn",tags:["liga","rlig"]}]},ds.prototype.forEachGlyph=function(e,t,n,i,o,r){t=void 0!==t?t:0,n=void 0!==n?n:0,i=void 0!==i?i:72,o=Object.assign({},this.defaultRenderOptions,o);var s,a=1/this.unitsPerEm*i,u=this.stringToGlyphs(e,o);if(o.kerning){var l=o.script||this.position.getDefaultScriptName();s=this.position.getKerningTables(l,o.language)}for(var c=0;c<u.length;c+=1){var h=u[c];r.call(this,h,t,n,i,o),h.advanceWidth&&(t+=h.advanceWidth*a),o.kerning&&c<u.length-1&&(t+=(s?this.position.getKerningValue(s,h.index,u[c+1].index):this.getKerningValue(h,u[c+1]))*a),o.letterSpacing?t+=o.letterSpacing*i:o.tracking&&(t+=o.tracking/1e3*i)}return t},ds.prototype.getPath=function(e,t,n,i,o){var r=new D;return this.forEachGlyph(e,t,n,i,o,(function(e,t,n,i){var s=e.getPath(t,n,i,o,this);r.extend(s)})),r},ds.prototype.getPaths=function(e,t,n,i,o){var r=[];return this.forEachGlyph(e,t,n,i,o,(function(e,t,n,i){var s=e.getPath(t,n,i,o,this);r.push(s)})),r},ds.prototype.getAdvanceWidth=function(e,t,n){return this.forEachGlyph(e,0,0,t,n,(function(){}))},ds.prototype.draw=function(e,t,n,i,o,r){this.getPath(t,n,i,o,r).draw(e)},ds.prototype.drawPoints=function(e,t,n,i,o,r){this.forEachGlyph(t,n,i,o,r,(function(t,n,i,o){t.drawPoints(e,n,i,o)}))},ds.prototype.drawMetrics=function(e,t,n,i,o,r){this.forEachGlyph(t,n,i,o,r,(function(t,n,i,o){t.drawMetrics(e,n,i,o)}))},ds.prototype.getEnglishName=function(e){var t=this.names[e];if(t)return t.en},ds.prototype.validate=function(){var e=this;function t(e,t){}function n(n){var i=e.getEnglishName(n);t(i&&i.trim().length>0)}n("fontFamily"),n("weightName"),n("manufacturer"),n("copyright"),n("version"),t(this.unitsPerEm>0)},ds.prototype.toTables=function(){return In.fontToTable(this)},ds.prototype.toBuffer=function(){return console.warn("Font.toBuffer is deprecated. Use Font.toArrayBuffer instead."),this.toArrayBuffer()},ds.prototype.toArrayBuffer=function(){for(var e=this.toTables().encode(),t=new ArrayBuffer(e.length),n=new Uint8Array(t),i=0;i<e.length;i++)n[i]=e[i];return t},ds.prototype.download=function(e){var t=this.getEnglishName("fontFamily"),i=this.getEnglishName("fontSubfamily");e=e||t.replace(/\s/g,"")+"-"+i+".otf";var o=this.toArrayBuffer();if(kn())if(window.URL=window.URL||window.webkitURL,window.URL){var r=new DataView(o),s=new Blob([r],{type:"font/opentype"}),a=document.createElement("a");a.href=window.URL.createObjectURL(s),a.download=e;var u=document.createEvent("MouseEvents");u.initEvent("click",!0,!1),a.dispatchEvent(u)}else console.warn("Font file could not be downloaded. Try using a different browser.");else{var l=n(102),c=jn(o);l.writeFileSync(e,c)}},ds.prototype.fsSelectionValues={ITALIC:1,UNDERSCORE:2,NEGATIVE:4,OUTLINED:8,STRIKEOUT:16,BOLD:32,REGULAR:64,USER_TYPO_METRICS:128,WWS:256,OBLIQUE:512},ds.prototype.usWidthClasses={ULTRA_CONDENSED:1,EXTRA_CONDENSED:2,CONDENSED:3,SEMI_CONDENSED:4,MEDIUM:5,SEMI_EXPANDED:6,EXPANDED:7,EXTRA_EXPANDED:8,ULTRA_EXPANDED:9},ds.prototype.usWeightClasses={THIN:100,EXTRA_LIGHT:200,LIGHT:300,NORMAL:400,MEDIUM:500,SEMI_BOLD:600,BOLD:700,EXTRA_BOLD:800,BLACK:900};var ws={make:ys,parse:xs},vs=function(){return{coverage:this.parsePointer(ge.coverage),attachPoints:this.parseList(ge.pointer(ge.uShortList))}},bs=function(){var e=this.parseUShort();return V.argument(1===e||2===e||3===e,"Unsupported CaretValue table version."),1===e?{coordinate:this.parseShort()}:2===e?{pointindex:this.parseShort()}:3===e?{coordinate:this.parseShort()}:void 0},Ss=function(){return this.parseList(ge.pointer(bs))},Ts=function(){return{coverage:this.parsePointer(ge.coverage),ligGlyphs:this.parseList(ge.pointer(Ss))}},Es=function(){return this.parseUShort(),this.parseList(ge.pointer(ge.coverage))};function Cs(e,t){var n=new ge(e,t=t||0),i=n.parseVersion(1);V.argument(1===i||1.2===i||1.3===i,"Unsupported GDEF table version.");var o={version:i,classDef:n.parsePointer(ge.classDef),attachList:n.parsePointer(vs),ligCaretList:n.parsePointer(Ts),markAttachClassDef:n.parsePointer(ge.classDef)};return i>=1.2&&(o.markGlyphSets=n.parsePointer(Es)),o}var Os={parse:Cs},Ns=new Array(10);function Fs(e,t){var n=new ge(e,t=t||0),i=n.parseVersion(1);return V.argument(1===i||1.1===i,"Unsupported GPOS table version "+i),1===i?{version:i,scripts:n.parseScriptList(),features:n.parseFeatureList(),lookups:n.parseLookupList(Ns)}:{version:i,scripts:n.parseScriptList(),features:n.parseFeatureList(),lookups:n.parseLookupList(Ns),variations:n.parseFeatureVariationsList()}}Ns[1]=function(){var e=this.offset+this.relativeOffset,t=this.parseUShort();return 1===t?{posFormat:1,coverage:this.parsePointer(ge.coverage),value:this.parseValueRecord()}:2===t?{posFormat:2,coverage:this.parsePointer(ge.coverage),values:this.parseValueRecordList()}:void V.assert(!1,"0x"+e.toString(16)+": GPOS lookup type 1 format must be 1 or 2.")},Ns[2]=function(){var e=this.offset+this.relativeOffset,t=this.parseUShort();V.assert(1===t||2===t,"0x"+e.toString(16)+": GPOS lookup type 2 format must be 1 or 2.");var n=this.parsePointer(ge.coverage),i=this.parseUShort(),o=this.parseUShort();if(1===t)return{posFormat:t,coverage:n,valueFormat1:i,valueFormat2:o,pairSets:this.parseList(ge.pointer(ge.list((function(){return{secondGlyph:this.parseUShort(),value1:this.parseValueRecord(i),value2:this.parseValueRecord(o)}}))))};if(2===t){var r=this.parsePointer(ge.classDef),s=this.parsePointer(ge.classDef),a=this.parseUShort(),u=this.parseUShort();return{posFormat:t,coverage:n,valueFormat1:i,valueFormat2:o,classDef1:r,classDef2:s,class1Count:a,class2Count:u,classRecords:this.parseList(a,ge.list(u,(function(){return{value1:this.parseValueRecord(i),value2:this.parseValueRecord(o)}})))}}},Ns[3]=function(){return{error:"GPOS Lookup 3 not supported"}},Ns[4]=function(){return{error:"GPOS Lookup 4 not supported"}},Ns[5]=function(){return{error:"GPOS Lookup 5 not supported"}},Ns[6]=function(){return{error:"GPOS Lookup 6 not supported"}},Ns[7]=function(){return{error:"GPOS Lookup 7 not supported"}},Ns[8]=function(){return{error:"GPOS Lookup 8 not supported"}},Ns[9]=function(){return{error:"GPOS Lookup 9 not supported"}};var Ms=new Array(10);function Ds(e){return new oe.Table("GPOS",[{name:"version",type:"ULONG",value:65536},{name:"scripts",type:"TABLE",value:new oe.ScriptList(e.scripts)},{name:"features",type:"TABLE",value:new oe.FeatureList(e.features)},{name:"lookups",type:"TABLE",value:new oe.LookupList(e.lookups,Ms)}])}var Is={parse:Fs,make:Ds};function Rs(e){var t={};e.skip("uShort");var n=e.parseUShort();V.argument(0===n,"Unsupported kern sub-table version."),e.skip("uShort",2);var i=e.parseUShort();e.skip("uShort",3);for(var o=0;o<i;o+=1){var r=e.parseUShort(),s=e.parseUShort(),a=e.parseShort();t[r+","+s]=a}return t}function Vs(e){var t={};e.skip("uShort"),e.parseULong()>1&&console.warn("Only the first kern subtable is supported."),e.skip("uLong");var n=255&e.parseUShort();if(e.skip("uShort"),0===n){var i=e.parseUShort();e.skip("uShort",3);for(var o=0;o<i;o+=1){var r=e.parseUShort(),s=e.parseUShort(),a=e.parseShort();t[r+","+s]=a}}return t}function Ps(e,t){var n=new _e.Parser(e,t),i=n.parseUShort();if(0===i)return Rs(n);if(1===i)return Vs(n);throw new Error("Unsupported kern table version ("+i+").")}var As={parse:Ps};function Ls(e,t,n,i){for(var o=new _e.Parser(e,t),r=i?o.parseUShort:o.parseULong,s=[],a=0;a<n+1;a+=1){var u=r.call(o);i&&(u*=2),s.push(u)}return s}var Us={parse:Ls};function Bs(e,t){n(102).readFile(e,(function(e,n){if(e)return t(e.message);t(null,zn(n))}))}function Xs(e,t){var n=new XMLHttpRequest;n.open("get",e,!0),n.responseType="arraybuffer",n.onload=function(){return n.response?t(null,n.response):t("Font could not be loaded: "+n.statusText)},n.onerror=function(){t("Font could not be loaded")},n.send()}function ks(e,t){for(var n=[],i=12,o=0;o<t;o+=1){var r=_e.getTag(e,i),s=_e.getULong(e,i+4),a=_e.getULong(e,i+8),u=_e.getULong(e,i+12);n.push({tag:r,checksum:s,offset:a,length:u,compression:!1}),i+=16}return n}function zs(e,t){for(var n=[],i=44,o=0;o<t;o+=1){var r=_e.getTag(e,i),s=_e.getULong(e,i+4),a=_e.getULong(e,i+8),u=_e.getULong(e,i+12),l=void 0;l=a<u&&"WOFF",n.push({tag:r,offset:s,compression:l,compressedLength:a,length:u}),i+=20}return n}function js(e,t){if("WOFF"===t.compression){var n=new Uint8Array(e.buffer,t.offset+2,t.compressedLength-2),i=new Uint8Array(t.length);if(N(n,i),i.byteLength!==t.length)throw new Error("Decompression error: "+t.tag+" decompressed length doesn't match recorded length");return{data:new DataView(i.buffer,0),offset:0}}return{data:e,offset:t.offset}}function Gs(e,t){var n,i;t=null==t?{}:t;var o,r,s,a,u,l,c,h,d,p,f,g,m,_=new ds({empty:!0}),y=new DataView(e,0),x=[],w=_e.getTag(y,0);if(w===String.fromCharCode(0,1,0,0)||"true"===w||"typ1"===w)_.outlinesFormat="truetype",x=ks(y,o=_e.getUShort(y,4));else if("OTTO"===w)_.outlinesFormat="cff",x=ks(y,o=_e.getUShort(y,4));else{if("wOFF"!==w)throw new Error("Unsupported OpenType signature "+w);var v=_e.getTag(y,4);if(v===String.fromCharCode(0,1,0,0))_.outlinesFormat="truetype";else{if("OTTO"!==v)throw new Error("Unsupported OpenType flavor "+w);_.outlinesFormat="cff"}x=zs(y,o=_e.getUShort(y,12))}for(var b=0;b<o;b+=1){var S=x[b],T=void 0;switch(S.tag){case"cmap":T=js(y,S),_.tables.cmap=Te.parse(T.data,T.offset),_.encoding=new Me(_.tables.cmap);break;case"cvt ":T=js(y,S),m=new _e.Parser(T.data,T.offset),_.tables.cvt=m.parseShortList(S.length/2);break;case"fvar":s=S;break;case"fpgm":T=js(y,S),m=new _e.Parser(T.data,T.offset),_.tables.fpgm=m.parseByteList(S.length);break;case"head":T=js(y,S),_.tables.head=Mt.parse(T.data,T.offset),_.unitsPerEm=_.tables.head.unitsPerEm,n=_.tables.head.indexToLocFormat;break;case"hhea":T=js(y,S),_.tables.hhea=Rt.parse(T.data,T.offset),_.ascender=_.tables.hhea.ascender,_.descender=_.tables.hhea.descender,_.numberOfHMetrics=_.tables.hhea.numberOfHMetrics;break;case"hmtx":h=S;break;case"ltag":T=js(y,S),i=kt.parse(T.data,T.offset);break;case"maxp":T=js(y,S),_.tables.maxp=Gt.parse(T.data,T.offset),_.numGlyphs=_.tables.maxp.numGlyphs;break;case"name":f=S;break;case"OS/2":T=js(y,S),_.tables.os2=dn.parse(T.data,T.offset);break;case"post":T=js(y,S),_.tables.post=gn.parse(T.data,T.offset),_.glyphNames=new Ie(_.tables.post);break;case"prep":T=js(y,S),m=new _e.Parser(T.data,T.offset),_.tables.prep=m.parseByteList(S.length);break;case"glyf":a=S;break;case"loca":p=S;break;case"CFF ":r=S;break;case"kern":d=S;break;case"GDEF":u=S;break;case"GPOS":l=S;break;case"GSUB":c=S;break;case"meta":g=S}}var E=js(y,f);if(_.tables.name=an.parse(E.data,E.offset,i),_.names=_.tables.name,a&&p){var C=0===n,O=js(y,p),N=Us.parse(O.data,O.offset,_.numGlyphs,C),F=js(y,a);_.glyphs=oi.parse(F.data,F.offset,N,_,t)}else{if(!r)throw new Error("Font doesn't contain TrueType or CFF outlines.");var M=js(y,r);Ot.parse(M.data,M.offset,_,t)}var D=js(y,h);if(Ut.parse(_,D.data,D.offset,_.numberOfHMetrics,_.numGlyphs,_.glyphs,t),Pe(_,t),d){var I=js(y,d);_.kerningPairs=As.parse(I.data,I.offset)}else _.kerningPairs={};if(u){var R=js(y,u);_.tables.gdef=Os.parse(R.data,R.offset)}if(l){var V=js(y,l);_.tables.gpos=Is.parse(V.data,V.offset),_.position.init()}if(c){var P=js(y,c);_.tables.gsub=vn.parse(P.data,P.offset)}if(s){var A=js(y,s);_.tables.fvar=ws.parse(A.data,A.offset,_.names)}if(g){var L=js(y,g);_.tables.meta=Tn.parse(L.data,L.offset),_.metas=_.tables.meta}return _}function Hs(e,t,n){n=null==n?{}:n;var i="undefined"!=typeof window||n.isUrl?Xs:Bs;return new Promise((function(o,r){i(e,(function(e,i){if(e){if(t)return t(e);r(e)}var s;try{s=Gs(i,n)}catch(e){if(t)return t(e,null);r(e)}if(t)return t(null,s);o(s)}))}))}function qs(e,t){return Gs(zn(n(102).readFileSync(e)),t)}var Ws=Object.freeze({__proto__:null,Font:ds,Glyph:Be,Path:D,BoundingBox:M,_parse:_e,parse:Gs,load:Hs,loadSync:qs});e.BoundingBox=M,e.Font=ds,e.Glyph=Be,e.Path=D,e._parse=_e,e.default=Ws,e.load=Hs,e.loadSync=qs,e.parse=Gs,Object.defineProperty(e,"__esModule",{value:!0})}(t)},802:function(e,t){!function(e){"use strict";var t=(e,t,n,i)=>{let o=65535&e|0,r=e>>>16&65535|0,s=0;for(;0!==n;){s=n>2e3?2e3:n,n-=s;do{o=o+t[i++]|0,r=r+o|0}while(--s);o%=65521,r%=65521}return o|r<<16|0};const n=new Uint32Array((()=>{let e,t=[];for(var n=0;n<256;n++){e=n;for(var i=0;i<8;i++)e=1&e?3988292384^e>>>1:e>>>1;t[n]=e}return t})());var i=(e,t,i,o)=>{const r=n,s=o+i;e^=-1;for(let n=o;n<s;n++)e=e>>>8^r[255&(e^t[n])];return-1^e};const o=16209,r=16191;var s=function(e,t){let n,i,s,a,u,l,c,h,d,p,f,g,m,_,y,x,w,v,b,S,T,E,C,O;const N=e.state;n=e.next_in,C=e.input,i=n+(e.avail_in-5),s=e.next_out,O=e.output,a=s-(t-e.avail_out),u=s+(e.avail_out-257),l=N.dmax,c=N.wsize,h=N.whave,d=N.wnext,p=N.window,f=N.hold,g=N.bits,m=N.lencode,_=N.distcode,y=(1<<N.lenbits)-1,x=(1<<N.distbits)-1;e:do{g<15&&(f+=C[n++]<<g,g+=8,f+=C[n++]<<g,g+=8),w=m[f&y];t:for(;;){if(v=w>>>24,f>>>=v,g-=v,v=w>>>16&255,0===v)O[s++]=65535&w;else{if(!(16&v)){if(0==(64&v)){w=m[(65535&w)+(f&(1<<v)-1)];continue t}if(32&v){N.mode=r;break e}e.msg="invalid literal/length code",N.mode=o;break e}b=65535&w,v&=15,v&&(g<v&&(f+=C[n++]<<g,g+=8),b+=f&(1<<v)-1,f>>>=v,g-=v),g<15&&(f+=C[n++]<<g,g+=8,f+=C[n++]<<g,g+=8),w=_[f&x];n:for(;;){if(v=w>>>24,f>>>=v,g-=v,v=w>>>16&255,!(16&v)){if(0==(64&v)){w=_[(65535&w)+(f&(1<<v)-1)];continue n}e.msg="invalid distance code",N.mode=o;break e}if(S=65535&w,v&=15,g<v&&(f+=C[n++]<<g,g+=8,g<v&&(f+=C[n++]<<g,g+=8)),S+=f&(1<<v)-1,S>l){e.msg="invalid distance too far back",N.mode=o;break e}if(f>>>=v,g-=v,v=s-a,S>v){if(v=S-v,v>h&&N.sane){e.msg="invalid distance too far back",N.mode=o;break e}if(T=0,E=p,0===d){if(T+=c-v,v<b){b-=v;do{O[s++]=p[T++]}while(--v);T=s-S,E=O}}else if(d<v){if(T+=c+d-v,v-=d,v<b){b-=v;do{O[s++]=p[T++]}while(--v);if(T=0,d<b){v=d,b-=v;do{O[s++]=p[T++]}while(--v);T=s-S,E=O}}}else if(T+=d-v,v<b){b-=v;do{O[s++]=p[T++]}while(--v);T=s-S,E=O}for(;b>2;)O[s++]=E[T++],O[s++]=E[T++],O[s++]=E[T++],b-=3;b&&(O[s++]=E[T++],b>1&&(O[s++]=E[T++]))}else{T=s-S;do{O[s++]=O[T++],O[s++]=O[T++],O[s++]=O[T++],b-=3}while(b>2);b&&(O[s++]=O[T++],b>1&&(O[s++]=O[T++]))}break}}break}}while(n<i&&s<u);b=g>>3,n-=b,g-=b<<3,f&=(1<<g)-1,e.next_in=n,e.next_out=s,e.avail_in=n<i?i-n+5:5-(n-i),e.avail_out=s<u?u-s+257:257-(s-u),N.hold=f,N.bits=g};const a=15,u=852,l=592,c=0,h=1,d=2,p=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),f=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),g=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),m=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);var _=(e,t,n,i,o,r,s,_)=>{const y=_.bits;let x,w,v,b,S,T,E=0,C=0,O=0,N=0,F=0,M=0,D=0,I=0,R=0,V=0,P=null;const A=new Uint16Array(a+1),L=new Uint16Array(a+1);let U,B,X,k=null;for(E=0;E<=a;E++)A[E]=0;for(C=0;C<i;C++)A[t[n+C]]++;for(F=y,N=a;N>=1&&0===A[N];N--);if(F>N&&(F=N),0===N)return o[r++]=20971520,o[r++]=20971520,_.bits=1,0;for(O=1;O<N&&0===A[O];O++);for(F<O&&(F=O),I=1,E=1;E<=a;E++)if(I<<=1,I-=A[E],I<0)return-1;if(I>0&&(e===c||1!==N))return-1;for(L[1]=0,E=1;E<a;E++)L[E+1]=L[E]+A[E];for(C=0;C<i;C++)0!==t[n+C]&&(s[L[t[n+C]]++]=C);if(e===c?(P=k=s,T=20):e===h?(P=p,k=f,T=257):(P=g,k=m,T=0),V=0,C=0,E=O,S=r,M=F,D=0,v=-1,R=1<<F,b=R-1,e===h&&R>u||e===d&&R>l)return 1;for(;;){U=E-D,s[C]+1<T?(B=0,X=s[C]):s[C]>=T?(B=k[s[C]-T],X=P[s[C]-T]):(B=96,X=0),x=1<<E-D,w=1<<M,O=w;do{w-=x,o[S+(V>>D)+w]=U<<24|B<<16|X|0}while(0!==w);for(x=1<<E-1;V&x;)x>>=1;if(0!==x?(V&=x-1,V+=x):V=0,C++,0==--A[E]){if(E===N)break;E=t[n+s[C]]}if(E>F&&(V&b)!==v){for(0===D&&(D=F),S+=O,M=E-D,I=1<<M;M+D<N&&(I-=A[M+D],!(I<=0));)M++,I<<=1;if(R+=1<<M,e===h&&R>u||e===d&&R>l)return 1;v=V&b,o[v]=F<<24|M<<16|S-r|0}}return 0!==V&&(o[S+V]=E-D<<24|64<<16|0),_.bits=F,0},y={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8};const x=0,w=1,v=2,{Z_FINISH:b,Z_BLOCK:S,Z_TREES:T,Z_OK:E,Z_STREAM_END:C,Z_NEED_DICT:O,Z_STREAM_ERROR:N,Z_DATA_ERROR:F,Z_MEM_ERROR:M,Z_BUF_ERROR:D,Z_DEFLATED:I}=y,R=16180,V=16181,P=16182,A=16183,L=16184,U=16185,B=16186,X=16187,k=16188,z=16189,j=16190,G=16191,H=16192,q=16193,W=16194,Y=16195,K=16196,Z=16197,Q=16198,$=16199,J=16200,ee=16201,te=16202,ne=16203,ie=16204,oe=16205,re=16206,se=16207,ae=16208,ue=16209,le=16210,ce=16211,he=852,de=592,pe=15,fe=e=>(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24);function ge(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const me=e=>{if(!e)return 1;const t=e.state;return!t||t.strm!==e||t.mode<R||t.mode>ce?1:0},_e=e=>{if(me(e))return N;const t=e.state;return e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=R,t.last=0,t.havedict=0,t.flags=-1,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new Int32Array(he),t.distcode=t.distdyn=new Int32Array(de),t.sane=1,t.back=-1,E},ye=e=>{if(me(e))return N;const t=e.state;return t.wsize=0,t.whave=0,t.wnext=0,_e(e)},xe=(e,t)=>{let n;if(me(e))return N;const i=e.state;return t<0?(n=0,t=-t):(n=5+(t>>4),t<48&&(t&=15)),t&&(t<8||t>15)?N:(null!==i.window&&i.wbits!==t&&(i.window=null),i.wrap=n,i.wbits=t,ye(e))},we=(e,t)=>{if(!e)return N;const n=new ge;e.state=n,n.strm=e,n.window=null,n.mode=R;const i=xe(e,t);return i!==E&&(e.state=null),i};let ve,be,Se=!0;const Te=e=>{if(Se){ve=new Int32Array(512),be=new Int32Array(32);let t=0;for(;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(_(w,e.lens,0,288,ve,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;_(v,e.lens,0,32,be,0,e.work,{bits:5}),Se=!1}e.lencode=ve,e.lenbits=9,e.distcode=be,e.distbits=5},Ee=(e,t,n,i)=>{let o;const r=e.state;return null===r.window&&(r.wsize=1<<r.wbits,r.wnext=0,r.whave=0,r.window=new Uint8Array(r.wsize)),i>=r.wsize?(r.window.set(t.subarray(n-r.wsize,n),0),r.wnext=0,r.whave=r.wsize):(o=r.wsize-r.wnext,o>i&&(o=i),r.window.set(t.subarray(n-i,n-i+o),r.wnext),(i-=o)?(r.window.set(t.subarray(n-i,n),0),r.wnext=i,r.whave=r.wsize):(r.wnext+=o,r.wnext===r.wsize&&(r.wnext=0),r.whave<r.wsize&&(r.whave+=o))),0};var Ce={inflateReset:ye,inflateReset2:xe,inflateResetKeep:_e,inflateInit:e=>we(e,pe),inflateInit2:we,inflate:(e,n)=>{let o,r,a,u,l,c,h,d,p,f,g,m,y,ce,he,de,pe,ge,_e,ye,xe,we,ve=0;const be=new Uint8Array(4);let Se,Ce;const Oe=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(me(e)||!e.output||!e.input&&0!==e.avail_in)return N;o=e.state,o.mode===G&&(o.mode=H),l=e.next_out,a=e.output,h=e.avail_out,u=e.next_in,r=e.input,c=e.avail_in,d=o.hold,p=o.bits,f=c,g=h,we=E;e:for(;;)switch(o.mode){case R:if(0===o.wrap){o.mode=H;break}for(;p<16;){if(0===c)break e;c--,d+=r[u++]<<p,p+=8}if(2&o.wrap&&35615===d){0===o.wbits&&(o.wbits=15),o.check=0,be[0]=255&d,be[1]=d>>>8&255,o.check=i(o.check,be,2,0),d=0,p=0,o.mode=V;break}if(o.head&&(o.head.done=!1),!(1&o.wrap)||(((255&d)<<8)+(d>>8))%31){e.msg="incorrect header check",o.mode=ue;break}if((15&d)!==I){e.msg="unknown compression method",o.mode=ue;break}if(d>>>=4,p-=4,xe=8+(15&d),0===o.wbits&&(o.wbits=xe),xe>15||xe>o.wbits){e.msg="invalid window size",o.mode=ue;break}o.dmax=1<<o.wbits,o.flags=0,e.adler=o.check=1,o.mode=512&d?z:G,d=0,p=0;break;case V:for(;p<16;){if(0===c)break e;c--,d+=r[u++]<<p,p+=8}if(o.flags=d,(255&o.flags)!==I){e.msg="unknown compression method",o.mode=ue;break}if(57344&o.flags){e.msg="unknown header flags set",o.mode=ue;break}o.head&&(o.head.text=d>>8&1),512&o.flags&&4&o.wrap&&(be[0]=255&d,be[1]=d>>>8&255,o.check=i(o.check,be,2,0)),d=0,p=0,o.mode=P;case P:for(;p<32;){if(0===c)break e;c--,d+=r[u++]<<p,p+=8}o.head&&(o.head.time=d),512&o.flags&&4&o.wrap&&(be[0]=255&d,be[1]=d>>>8&255,be[2]=d>>>16&255,be[3]=d>>>24&255,o.check=i(o.check,be,4,0)),d=0,p=0,o.mode=A;case A:for(;p<16;){if(0===c)break e;c--,d+=r[u++]<<p,p+=8}o.head&&(o.head.xflags=255&d,o.head.os=d>>8),512&o.flags&&4&o.wrap&&(be[0]=255&d,be[1]=d>>>8&255,o.check=i(o.check,be,2,0)),d=0,p=0,o.mode=L;case L:if(1024&o.flags){for(;p<16;){if(0===c)break e;c--,d+=r[u++]<<p,p+=8}o.length=d,o.head&&(o.head.extra_len=d),512&o.flags&&4&o.wrap&&(be[0]=255&d,be[1]=d>>>8&255,o.check=i(o.check,be,2,0)),d=0,p=0}else o.head&&(o.head.extra=null);o.mode=U;case U:if(1024&o.flags&&(m=o.length,m>c&&(m=c),m&&(o.head&&(xe=o.head.extra_len-o.length,o.head.extra||(o.head.extra=new Uint8Array(o.head.extra_len)),o.head.extra.set(r.subarray(u,u+m),xe)),512&o.flags&&4&o.wrap&&(o.check=i(o.check,r,m,u)),c-=m,u+=m,o.length-=m),o.length))break e;o.length=0,o.mode=B;case B:if(2048&o.flags){if(0===c)break e;m=0;do{xe=r[u+m++],o.head&&xe&&o.length<65536&&(o.head.name+=String.fromCharCode(xe))}while(xe&&m<c);if(512&o.flags&&4&o.wrap&&(o.check=i(o.check,r,m,u)),c-=m,u+=m,xe)break e}else o.head&&(o.head.name=null);o.length=0,o.mode=X;case X:if(4096&o.flags){if(0===c)break e;m=0;do{xe=r[u+m++],o.head&&xe&&o.length<65536&&(o.head.comment+=String.fromCharCode(xe))}while(xe&&m<c);if(512&o.flags&&4&o.wrap&&(o.check=i(o.check,r,m,u)),c-=m,u+=m,xe)break e}else o.head&&(o.head.comment=null);o.mode=k;case k:if(512&o.flags){for(;p<16;){if(0===c)break e;c--,d+=r[u++]<<p,p+=8}if(4&o.wrap&&d!==(65535&o.check)){e.msg="header crc mismatch",o.mode=ue;break}d=0,p=0}o.head&&(o.head.hcrc=o.flags>>9&1,o.head.done=!0),e.adler=o.check=0,o.mode=G;break;case z:for(;p<32;){if(0===c)break e;c--,d+=r[u++]<<p,p+=8}e.adler=o.check=fe(d),d=0,p=0,o.mode=j;case j:if(0===o.havedict)return e.next_out=l,e.avail_out=h,e.next_in=u,e.avail_in=c,o.hold=d,o.bits=p,O;e.adler=o.check=1,o.mode=G;case G:if(n===S||n===T)break e;case H:if(o.last){d>>>=7&p,p-=7&p,o.mode=re;break}for(;p<3;){if(0===c)break e;c--,d+=r[u++]<<p,p+=8}switch(o.last=1&d,d>>>=1,p-=1,3&d){case 0:o.mode=q;break;case 1:if(Te(o),o.mode=$,n===T){d>>>=2,p-=2;break e}break;case 2:o.mode=K;break;case 3:e.msg="invalid block type",o.mode=ue}d>>>=2,p-=2;break;case q:for(d>>>=7&p,p-=7&p;p<32;){if(0===c)break e;c--,d+=r[u++]<<p,p+=8}if((65535&d)!=(d>>>16^65535)){e.msg="invalid stored block lengths",o.mode=ue;break}if(o.length=65535&d,d=0,p=0,o.mode=W,n===T)break e;case W:o.mode=Y;case Y:if(m=o.length,m){if(m>c&&(m=c),m>h&&(m=h),0===m)break e;a.set(r.subarray(u,u+m),l),c-=m,u+=m,h-=m,l+=m,o.length-=m;break}o.mode=G;break;case K:for(;p<14;){if(0===c)break e;c--,d+=r[u++]<<p,p+=8}if(o.nlen=257+(31&d),d>>>=5,p-=5,o.ndist=1+(31&d),d>>>=5,p-=5,o.ncode=4+(15&d),d>>>=4,p-=4,o.nlen>286||o.ndist>30){e.msg="too many length or distance symbols",o.mode=ue;break}o.have=0,o.mode=Z;case Z:for(;o.have<o.ncode;){for(;p<3;){if(0===c)break e;c--,d+=r[u++]<<p,p+=8}o.lens[Oe[o.have++]]=7&d,d>>>=3,p-=3}for(;o.have<19;)o.lens[Oe[o.have++]]=0;if(o.lencode=o.lendyn,o.lenbits=7,Se={bits:o.lenbits},we=_(x,o.lens,0,19,o.lencode,0,o.work,Se),o.lenbits=Se.bits,we){e.msg="invalid code lengths set",o.mode=ue;break}o.have=0,o.mode=Q;case Q:for(;o.have<o.nlen+o.ndist;){for(;ve=o.lencode[d&(1<<o.lenbits)-1],he=ve>>>24,de=ve>>>16&255,pe=65535&ve,!(he<=p);){if(0===c)break e;c--,d+=r[u++]<<p,p+=8}if(pe<16)d>>>=he,p-=he,o.lens[o.have++]=pe;else{if(16===pe){for(Ce=he+2;p<Ce;){if(0===c)break e;c--,d+=r[u++]<<p,p+=8}if(d>>>=he,p-=he,0===o.have){e.msg="invalid bit length repeat",o.mode=ue;break}xe=o.lens[o.have-1],m=3+(3&d),d>>>=2,p-=2}else if(17===pe){for(Ce=he+3;p<Ce;){if(0===c)break e;c--,d+=r[u++]<<p,p+=8}d>>>=he,p-=he,xe=0,m=3+(7&d),d>>>=3,p-=3}else{for(Ce=he+7;p<Ce;){if(0===c)break e;c--,d+=r[u++]<<p,p+=8}d>>>=he,p-=he,xe=0,m=11+(127&d),d>>>=7,p-=7}if(o.have+m>o.nlen+o.ndist){e.msg="invalid bit length repeat",o.mode=ue;break}for(;m--;)o.lens[o.have++]=xe}}if(o.mode===ue)break;if(0===o.lens[256]){e.msg="invalid code -- missing end-of-block",o.mode=ue;break}if(o.lenbits=9,Se={bits:o.lenbits},we=_(w,o.lens,0,o.nlen,o.lencode,0,o.work,Se),o.lenbits=Se.bits,we){e.msg="invalid literal/lengths set",o.mode=ue;break}if(o.distbits=6,o.distcode=o.distdyn,Se={bits:o.distbits},we=_(v,o.lens,o.nlen,o.ndist,o.distcode,0,o.work,Se),o.distbits=Se.bits,we){e.msg="invalid distances set",o.mode=ue;break}if(o.mode=$,n===T)break e;case $:o.mode=J;case J:if(c>=6&&h>=258){e.next_out=l,e.avail_out=h,e.next_in=u,e.avail_in=c,o.hold=d,o.bits=p,s(e,g),l=e.next_out,a=e.output,h=e.avail_out,u=e.next_in,r=e.input,c=e.avail_in,d=o.hold,p=o.bits,o.mode===G&&(o.back=-1);break}for(o.back=0;ve=o.lencode[d&(1<<o.lenbits)-1],he=ve>>>24,de=ve>>>16&255,pe=65535&ve,!(he<=p);){if(0===c)break e;c--,d+=r[u++]<<p,p+=8}if(de&&0==(240&de)){for(ge=he,_e=de,ye=pe;ve=o.lencode[ye+((d&(1<<ge+_e)-1)>>ge)],he=ve>>>24,de=ve>>>16&255,pe=65535&ve,!(ge+he<=p);){if(0===c)break e;c--,d+=r[u++]<<p,p+=8}d>>>=ge,p-=ge,o.back+=ge}if(d>>>=he,p-=he,o.back+=he,o.length=pe,0===de){o.mode=oe;break}if(32&de){o.back=-1,o.mode=G;break}if(64&de){e.msg="invalid literal/length code",o.mode=ue;break}o.extra=15&de,o.mode=ee;case ee:if(o.extra){for(Ce=o.extra;p<Ce;){if(0===c)break e;c--,d+=r[u++]<<p,p+=8}o.length+=d&(1<<o.extra)-1,d>>>=o.extra,p-=o.extra,o.back+=o.extra}o.was=o.length,o.mode=te;case te:for(;ve=o.distcode[d&(1<<o.distbits)-1],he=ve>>>24,de=ve>>>16&255,pe=65535&ve,!(he<=p);){if(0===c)break e;c--,d+=r[u++]<<p,p+=8}if(0==(240&de)){for(ge=he,_e=de,ye=pe;ve=o.distcode[ye+((d&(1<<ge+_e)-1)>>ge)],he=ve>>>24,de=ve>>>16&255,pe=65535&ve,!(ge+he<=p);){if(0===c)break e;c--,d+=r[u++]<<p,p+=8}d>>>=ge,p-=ge,o.back+=ge}if(d>>>=he,p-=he,o.back+=he,64&de){e.msg="invalid distance code",o.mode=ue;break}o.offset=pe,o.extra=15&de,o.mode=ne;case ne:if(o.extra){for(Ce=o.extra;p<Ce;){if(0===c)break e;c--,d+=r[u++]<<p,p+=8}o.offset+=d&(1<<o.extra)-1,d>>>=o.extra,p-=o.extra,o.back+=o.extra}if(o.offset>o.dmax){e.msg="invalid distance too far back",o.mode=ue;break}o.mode=ie;case ie:if(0===h)break e;if(m=g-h,o.offset>m){if(m=o.offset-m,m>o.whave&&o.sane){e.msg="invalid distance too far back",o.mode=ue;break}m>o.wnext?(m-=o.wnext,y=o.wsize-m):y=o.wnext-m,m>o.length&&(m=o.length),ce=o.window}else ce=a,y=l-o.offset,m=o.length;m>h&&(m=h),h-=m,o.length-=m;do{a[l++]=ce[y++]}while(--m);0===o.length&&(o.mode=J);break;case oe:if(0===h)break e;a[l++]=o.length,h--,o.mode=J;break;case re:if(o.wrap){for(;p<32;){if(0===c)break e;c--,d|=r[u++]<<p,p+=8}if(g-=h,e.total_out+=g,o.total+=g,4&o.wrap&&g&&(e.adler=o.check=o.flags?i(o.check,a,g,l-g):t(o.check,a,g,l-g)),g=h,4&o.wrap&&(o.flags?d:fe(d))!==o.check){e.msg="incorrect data check",o.mode=ue;break}d=0,p=0}o.mode=se;case se:if(o.wrap&&o.flags){for(;p<32;){if(0===c)break e;c--,d+=r[u++]<<p,p+=8}if(4&o.wrap&&d!==(4294967295&o.total)){e.msg="incorrect length check",o.mode=ue;break}d=0,p=0}o.mode=ae;case ae:we=C;break e;case ue:we=F;break e;case le:return M;default:return N}return e.next_out=l,e.avail_out=h,e.next_in=u,e.avail_in=c,o.hold=d,o.bits=p,(o.wsize||g!==e.avail_out&&o.mode<ue&&(o.mode<re||n!==b))&&Ee(e,e.output,e.next_out,g-e.avail_out),f-=e.avail_in,g-=e.avail_out,e.total_in+=f,e.total_out+=g,o.total+=g,4&o.wrap&&g&&(e.adler=o.check=o.flags?i(o.check,a,g,e.next_out-g):t(o.check,a,g,e.next_out-g)),e.data_type=o.bits+(o.last?64:0)+(o.mode===G?128:0)+(o.mode===$||o.mode===W?256:0),(0===f&&0===g||n===b)&&we===E&&(we=D),we},inflateEnd:e=>{if(me(e))return N;let t=e.state;return t.window&&(t.window=null),e.state=null,E},inflateGetHeader:(e,t)=>{if(me(e))return N;const n=e.state;return 0==(2&n.wrap)?N:(n.head=t,t.done=!1,E)},inflateSetDictionary:(e,n)=>{const i=n.length;let o,r,s;return me(e)?N:(o=e.state,0!==o.wrap&&o.mode!==j?N:o.mode===j&&(r=1,r=t(r,n,i,0),r!==o.check)?F:(s=Ee(e,n,i,i),s?(o.mode=le,M):(o.havedict=1,E)))},inflateInfo:"pako inflate (from Nodeca project)"};const Oe=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var Ne=function(e){const t=Array.prototype.slice.call(arguments,1);for(;t.length;){const n=t.shift();if(n){if("object"!=typeof n)throw new TypeError(n+"must be non-object");for(const t in n)Oe(n,t)&&(e[t]=n[t])}}return e},Fe={assign:Ne,flattenChunks:e=>{let t=0;for(let n=0,i=e.length;n<i;n++)t+=e[n].length;const n=new Uint8Array(t);for(let t=0,i=0,o=e.length;t<o;t++){let o=e[t];n.set(o,i),i+=o.length}return n}};let Me=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(e){Me=!1}const De=new Uint8Array(256);for(let e=0;e<256;e++)De[e]=e>=252?6:e>=248?5:e>=240?4:e>=224?3:e>=192?2:1;De[254]=De[254]=1;const Ie=(e,t)=>{if(t<65534&&e.subarray&&Me)return String.fromCharCode.apply(null,e.length===t?e:e.subarray(0,t));let n="";for(let i=0;i<t;i++)n+=String.fromCharCode(e[i]);return n};var Re={string2buf:e=>{if("function"==typeof TextEncoder&&TextEncoder.prototype.encode)return(new TextEncoder).encode(e);let t,n,i,o,r,s=e.length,a=0;for(o=0;o<s;o++)n=e.charCodeAt(o),55296==(64512&n)&&o+1<s&&(i=e.charCodeAt(o+1),56320==(64512&i)&&(n=65536+(n-55296<<10)+(i-56320),o++)),a+=n<128?1:n<2048?2:n<65536?3:4;for(t=new Uint8Array(a),r=0,o=0;r<a;o++)n=e.charCodeAt(o),55296==(64512&n)&&o+1<s&&(i=e.charCodeAt(o+1),56320==(64512&i)&&(n=65536+(n-55296<<10)+(i-56320),o++)),n<128?t[r++]=n:n<2048?(t[r++]=192|n>>>6,t[r++]=128|63&n):n<65536?(t[r++]=224|n>>>12,t[r++]=128|n>>>6&63,t[r++]=128|63&n):(t[r++]=240|n>>>18,t[r++]=128|n>>>12&63,t[r++]=128|n>>>6&63,t[r++]=128|63&n);return t},buf2string:(e,t)=>{const n=t||e.length;if("function"==typeof TextDecoder&&TextDecoder.prototype.decode)return(new TextDecoder).decode(e.subarray(0,t));let i,o;const r=new Array(2*n);for(o=0,i=0;i<n;){let t=e[i++];if(t<128){r[o++]=t;continue}let s=De[t];if(s>4)r[o++]=65533,i+=s-1;else{for(t&=2===s?31:3===s?15:7;s>1&&i<n;)t=t<<6|63&e[i++],s--;s>1?r[o++]=65533:t<65536?r[o++]=t:(t-=65536,r[o++]=55296|t>>10&1023,r[o++]=56320|1023&t)}}return Ie(r,o)},utf8border:(e,t)=>{(t=t||e.length)>e.length&&(t=e.length);let n=t-1;for(;n>=0&&128==(192&e[n]);)n--;return n<0||0===n?t:n+De[e[n]]>t?n:t}},Ve={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"};function Pe(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}var Ae=Pe;function Le(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}var Ue=Le;const Be=Object.prototype.toString,{Z_NO_FLUSH:Xe,Z_FINISH:ke,Z_OK:ze,Z_STREAM_END:je,Z_NEED_DICT:Ge,Z_STREAM_ERROR:He,Z_DATA_ERROR:qe,Z_MEM_ERROR:We}=y;function Ye(e){this.options=Fe.assign({chunkSize:65536,windowBits:15,to:""},e||{});const t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,0===t.windowBits&&(t.windowBits=-15)),!(t.windowBits>=0&&t.windowBits<16)||e&&e.windowBits||(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&0==(15&t.windowBits)&&(t.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new Ae,this.strm.avail_out=0;let n=Ce.inflateInit2(this.strm,t.windowBits);if(n!==ze)throw new Error(Ve[n]);if(this.header=new Ue,Ce.inflateGetHeader(this.strm,this.header),t.dictionary&&("string"==typeof t.dictionary?t.dictionary=Re.string2buf(t.dictionary):"[object ArrayBuffer]"===Be.call(t.dictionary)&&(t.dictionary=new Uint8Array(t.dictionary)),t.raw&&(n=Ce.inflateSetDictionary(this.strm,t.dictionary),n!==ze)))throw new Error(Ve[n])}function Ke(e,t){const n=new Ye(t);if(n.push(e),n.err)throw n.msg||Ve[n.err];return n.result}function Ze(e,t){return(t=t||{}).raw=!0,Ke(e,t)}Ye.prototype.push=function(e,t){const n=this.strm,i=this.options.chunkSize,o=this.options.dictionary;let r,s,a;if(this.ended)return!1;for(s=t===~~t?t:!0===t?ke:Xe,"[object ArrayBuffer]"===Be.call(e)?n.input=new Uint8Array(e):n.input=e,n.next_in=0,n.avail_in=n.input.length;;){for(0===n.avail_out&&(n.output=new Uint8Array(i),n.next_out=0,n.avail_out=i),r=Ce.inflate(n,s),r===Ge&&o&&(r=Ce.inflateSetDictionary(n,o),r===ze?r=Ce.inflate(n,s):r===qe&&(r=Ge));n.avail_in>0&&r===je&&n.state.wrap>0&&0!==e[n.next_in];)Ce.inflateReset(n),r=Ce.inflate(n,s);switch(r){case He:case qe:case Ge:case We:return this.onEnd(r),this.ended=!0,!1}if(a=n.avail_out,n.next_out&&(0===n.avail_out||r===je))if("string"===this.options.to){let e=Re.utf8border(n.output,n.next_out),t=n.next_out-e,o=Re.buf2string(n.output,e);n.next_out=t,n.avail_out=i-t,t&&n.output.set(n.output.subarray(e,e+t),0),this.onData(o)}else this.onData(n.output.length===n.next_out?n.output:n.output.subarray(0,n.next_out));if(r!==ze||0!==a){if(r===je)return r=Ce.inflateEnd(this.strm),this.onEnd(r),this.ended=!0,!0;if(0===n.avail_in)break}}return!0},Ye.prototype.onData=function(e){this.chunks.push(e)},Ye.prototype.onEnd=function(e){e===ze&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=Fe.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var Qe=Ye,$e=Ke,Je=Ze,et=Ke,tt=y,nt={Inflate:Qe,inflate:$e,inflateRaw:Je,ungzip:et,constants:tt};e.Inflate=Qe,e.constants=tt,e.default=nt,e.inflate=$e,e.inflateRaw=Je,e.ungzip=et,Object.defineProperty(e,"__esModule",{value:!0})}(t)},102:()=>{}},n={};function i(e){var o=n[e];if(void 0!==o)return o.exports;var r=n[e]={exports:{}};return t[e].call(r.exports,r,r.exports,i),r.exports}i.d=(e,t)=>{for(var n in t)i.o(t,n)&&!i.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},i.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),i.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var o={};return(()=>{"use strict";i.d(o,{default:()=>Vw});let t=0,n=0,r=0;const s={CONNECTION_ERROR:t++,BROWSER_EVENT:t++,INITIALIZED_EVENT:t++,SHUTDOWN_EVENT:t++,INITIALIZED_ERROR:t++,NOT_STARTED_STATE:n++,IN_PROGRESS_STATE:n++,COMPLETE_STATE:n++,FAILED_STATE:n++,initializeOnly:1,inputOnly:2,outputOnly:4,inputOutput:7,SFBool:r++,SFColor:r++,SFColorRGBA:r++,SFDouble:r++,SFFloat:r++,SFImage:r++,SFInt32:r++,SFMatrix3d:r++,SFMatrix3f:r++,SFMatrix4d:r++,SFMatrix4f:r++,SFNode:r++,SFRotation:r++,SFString:r++,SFTime:r++,SFVec2d:r++,SFVec2f:r++,SFVec3d:r++,SFVec3f:r++,SFVec4d:r++,SFVec4f:r++,VrmlMatrix:r++,MFBool:r++,MFColor:r++,MFColorRGBA:r++,MFDouble:r++,MFFloat:r++,MFImage:r++,MFInt32:r++,MFMatrix3d:r++,MFMatrix3f:r++,MFMatrix4d:r++,MFMatrix4f:r++,MFNode:r++,MFRotation:r++,MFString:r++,MFTime:r++,MFVec2d:r++,MFVec2f:r++,MFVec3d:r++,MFVec3f:r++,MFVec4d:r++,MFVec4f:r++,X3DBaseNode:0};function a(){this.indent="",this.indentChar="  ",this.precision=6,this.doublePrecision=14,this.removeTrailingZeros=/\.?0*(?=$|[eE])/,this.executionContextStack=[null],this.importedNodesIndex=new Map,this.exportedNodesIndex=new Map,this.nodes=new Set,this.names=new Map,this.namesByNode=new Map,this.importedNames=new Map,this.routeNodes=new Set,this.level=0,this.newName=0,this.containerFields=[],this.units=!0,this.unitCategories=[],this.names.set(null,new Map)}a.prototype={constructor:a,Indent:function(){return this.indent},IncIndent:function(){this.indent+=this.indentChar},DecIndent:function(){this.indent=this.indent.substr(0,this.indent.length-this.indentChar.length)},PadRight:function(e,t){for(let n=0,i=t-e.length;n<i;++n)e+=" ";return e},Precision:function(e){return Math.fround(e).toPrecision(this.precision).replace(this.removeTrailingZeros,"")},DoublePrecision:function(e){return e.toPrecision(this.doublePrecision).replace(this.removeTrailingZeros,"")},PushExecutionContext:function(e){this.executionContextStack.push(e),this.names.has(e)||this.names.set(e,new Map),this.importedNodesIndex.has(e)||this.importedNodesIndex.set(e,new Set),this.exportedNodesIndex.has(e)||this.exportedNodesIndex.set(e,new Set)},PopExecutionContext:function(){this.executionContextStack.pop(),this.ExecutionContext()||(this.importedNodesIndex.clear(),this.exportedNodesIndex.clear())},ExecutionContext:function(){return this.executionContextStack.at(-1)},EnterScope:function(){0===this.level&&(this.newName=0),++this.level},LeaveScope:function(){--this.level,0===this.level&&(this.nodes.clear(),this.namesByNode.clear(),this.importedNames.clear())},ExportedNodes:function(e){const t=this.exportedNodesIndex.get(this.ExecutionContext());e.forEach((function(e){try{t.add(e.getLocalNode())}catch(e){}}))},ImportedNodes:function(e){const t=this.importedNodesIndex.get(this.ExecutionContext());e.forEach((function(e){try{t.add(e.getInlineNode())}catch(e){}}))},AddImportedNode:function(e,t){this.importedNames.set(e,t)},AddRouteNode:function(e){this.routeNodes.add(e)},ExistsRouteNode:function(e){return this.routeNodes.has(e)},IsSharedNode:function(e){return this.ExecutionContext()!==e.getExecutionContext()},AddNode:function(e){this.nodes.add(e),this.AddRouteNode(e)},ExistsNode:function(e){return this.nodes.has(e)},Name:function(){const e=/_\d+$/;return function(t){const n=this.namesByNode.get(t);if(void 0!==n)return n;{const n=this.names.get(this.ExecutionContext());if(0===t.getName().length){if(this.NeedsName(t)){const e=this.UniqueName();return n.set(e,t),this.namesByNode.set(t,e),e}return t.getName()}let i=t.getName();const o=null!==i.match(e);if(i=i.replace(e,""),0===i.length){if(!this.NeedsName(t))return"";i=this.UniqueName()}else{let e=0,t=o?i+"_"+ ++e:i;for(;n.has(t);)t=i+"_"+ ++e;i=t}return n.set(i,t),this.namesByNode.set(t,i),i}}}(),NeedsName:function(e){if(e.getCloneCount()>1)return!0;if(e.hasRoutes())return!0;const t=e.getExecutionContext(),n=this.importedNodesIndex.get(t);if(!n){const n=this.exportedNodesIndex.get(t);return!(!n||!n.has(e))}return!!n.has(e)||void 0},UniqueName:function(){const e=this.names.get(this.ExecutionContext());for(;;){const t="_"+ ++this.newName;if(!e.has(t))return t}},LocalName:function(e){const t=this.importedNames.get(e);if(void 0!==t)return t;if(this.ExistsNode(e))return this.Name(e);throw new Error("Couldn't get local name for node '"+e.getTypeName()+"'.")},PushContainerField:function(e){this.containerFields.push(e)},PopContainerField:function(){this.containerFields.pop()},ContainerField:function(){return this.containerFields.length?this.containerFields[this.containerFields.length-1]:null},AccessType:function(e){switch(e){case s.initializeOnly:return"initializeOnly";case s.inputOnly:return"inputOnly";case s.outputOnly:return"outputOnly";case s.inputOutput:return"inputOutput"}},SetUnits:function(e){this.units=e},GetUnits:function(){return this.units},PushUnitCategory:function(e){this.unitCategories.push(e)},PopUnitCategory:function(){this.unitCategories.pop()},Unit:function(e){return 0==this.unitCategories.length?e:this.unitCategories.at(-1)},ToUnit:function(e,t){if(this.units){const n=this.ExecutionContext();if(n)return n.toUnit(e,t)}return t},XMLEncode:function(e){return e.replace(/&/g,"&amp;").replace(/\\/g,"&#92;").replace(/\t/g,"&#x9;").replace(/\n/g,"&#xA;").replace(/\r/g,"&#xD;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/'/g,"&apos;").replace(/"/g,'\\"')},escapeCDATA:function(e){return e.replace(/\]\]\>/g,"\\]\\]\\>")}};for(const e of Reflect.ownKeys(a.prototype))Object.defineProperty(a.prototype,e,{enumerable:!1});a.Get=function(e){return e.generator||(e.generator=new a),e.generator};const u=a,l={assign:function(){function e(e,t){this.set(t,e)}return function(t,n){return t.clear(),n.forEach(e,t),t}}(),values:function(){function e(e){this.push(e)}return function(t,n){return t.length=0,n.forEach(e,t),t}}()},c=l,h=Symbol(),d=Symbol(),p=Symbol();function f(){}f.prototype={constructor:f,[h]:"",[d]:new Map,[p]:[],getId:function(){return f.getId(this)},getTypeName:function(){return"X3DObject"},setName:function(e){this[h]=e},getName:function(){return this[h]},getDisplayName:function(){return this[h]},getInterestId:function(e,t){return f.getId(t)+"."+String(e)},hasInterest:function(e,t){return this[d].has(this.getInterestId(e,t))},addInterest:function(e,t){this[d]===f.prototype[d]&&(this[d]=new Map,this[p]=[]);const n=this.getInterestId(e,t),i=t[e];if(arguments.length>2){const e=Array.prototype.slice.call(arguments,2);e.unshift(t),e.push(this),this[d].set(n,Function.prototype.bind.apply(i,e))}else this[d].set(n,i.bind(t,this))},removeInterest:function(e,t){this[d].delete(this.getInterestId(e,t))},getInterests:function(){return this[d]},processInterests:function(){if(this[d].size)for(const e of c.values(this[p],this[d]))e()},toString:function(e){const t={string:""};return e&&u.Get(t).PushExecutionContext(e),this.toStream(t),t.string},toVRMLString:function(){const e={string:""};return this.toVRMLStream(e),e.string},toXMLString:function(){const e={string:""};return this.toXMLStream(e),e.string},toJSONString:function(){const e={string:""};return this.toVRMLStream(e),e.string},toStream:function(e){e.string="[object "+this.getTypeName()+"]"},dispose:function(){}};for(const e of Reflect.ownKeys(f.prototype))Object.defineProperty(f.prototype,e,{enumerable:!1});f.getId=function(){const e=new WeakMap;let t=0;return function(n){const i=e.get(n);return void 0!==i?i:(e.set(n,++t),t)}}();const g=f,m=Symbol(),_=Symbol(),y=Symbol();function x(){g.call(this)}x.prototype=Object.assign(Object.create(g.prototype),{constructor:x,[m]:0,[_]:!1,[y]:new Set,setModificationTime:function(e){this[m]=e},getModificationTime:function(){return this[m]},setTainted:function(e){this[_]=e},isTainted:function(){return this[_]},addEvent:function(){this.setModificationTime(Date.now());for(const e of this[y])e.addEvent(this)},addEventObject:function(e,t){this.setModificationTime(Date.now());for(const e of this[y])e.addEventObject(this,t)},addParent:function(e){this[y]===x.prototype[y]&&(this[y]=new Set),this[y].add(e)},removeParent:function(e){this[y].delete(e)},getParents:function(){return this[y]},dispose:function(){this[y].clear(),g.prototype.dispose.call(this)}});for(const e of Reflect.ownKeys(x.prototype))Object.defineProperty(x.prototype,e,{enumerable:!1});const w=x,v=Symbol();function b(){this[v]=[]}b.prototype={create:function(e){if(this[v].length){const t=this[v].pop();return t.field=e,t.clear(),t}const t=new Set;return t.field=e,t},copy:function(e){if(this[v].length){const t=this[v].pop();t.field=e.field,t.clear();for(const n of e)t.add(n);return t}const t=new Set(e);return t.field=e.field,t},push:function(e){this[v].push(e)},clear:function(){this[v].length=0}};for(const e of Reflect.ownKeys(b.prototype))Object.defineProperty(b.prototype,e,{enumerable:!1});const S=new b,T=Symbol.for("X3DEventObject.browser");function E(e){w.call(this),this[T]=e}E.prototype=Object.assign(Object.create(w.prototype),{constructor:E,getBrowser:function(){return this[T]},getExtendedEventHandling:function(){return!0},addEvent:function(e){e.isTainted()||(e.setTainted(!0),this.addEventObject(e,S.create(e)))},addEventObject:function(e,t){const n=this.getBrowser();n.addBrowserEvent(),n.addTaintedField(e,t),this.isTainted()||(e.isInput()||this.getExtendedEventHandling()&&!e.isOutput())&&this.addNodeEvent()},addNodeEvent:function(){if(this.isTainted())return;const e=this.getBrowser();this.setTainted(!0),e.addTaintedNode(this),e.addBrowserEvent()},processEvents:function(){this.setTainted(!1),this.processInterests()}});for(const e of Reflect.ownKeys(E.prototype))Object.defineProperty(E.prototype,e,{enumerable:!1});const C=E;function O(e,t,n){this.accessType=e,this.dataType=n.getType(),this.name=t,this.value=n}O.prototype=Object.assign(Object.create(g.prototype),{constructor:O,getTypeName:function(){return"X3DFieldDefinition"}});for(const e of Reflect.ownKeys(O.prototype))Object.defineProperty(O.prototype,e,{enumerable:!1});const N=O,F=Symbol(),M=Symbol(),D={get:function(e,t){const n=e[t];if(void 0!==n)return n;if("string"==typeof t){const n=+t;return Number.isInteger(n)?e[F][n]:void 0}},set:function(e,t,n){return void 0!==e[t]&&(e[t]=n,!0)},has:function(e,t){return Number.isInteger(+t)?t<e[F].length:t in e},ownKeys:function(e){return Object.keys(e[F])},getOwnPropertyDescriptor:function(e,t){if("string"!=typeof t)return;const n=+t;if(Number.isInteger(n)&&n<e[F].length){const n=Object.getOwnPropertyDescriptor(e[F],t);return n&&(n.writable=!1),n}}};function I(e){if(this[F]=[],this[M]=new Map,this[Symbol.iterator]=this[F][Symbol.iterator],e)for(const t of e)this.add(t.name,t);return new Proxy(this,D)}I.prototype={constructor:I,equals:function(e){const t=this[F],n=e[F]||e,i=t.length;if(t===n)return!0;if(i!==n.length)return!1;for(let e=0;e<i;++e)if(t[e]!==n[e])return!1;return!0},has:function(e){return this[M].has(e)},get:function(e){return this[M].get(e)},add:function(e,t){this[F].push(t),this[M].set(e,t)},addAlias:function(e,t){this[M].set(e,this[M].get(t))},update:function(e,t,n){const i=this[M].get(e);if(e!==t&&this.remove(t),this[M].delete(e),this[M].set(t,n),void 0!==i){const e=this[F].indexOf(i);e>-1&&(this[F][e]=n)}else this[F].push(n)},remove:function(e){const t=this[M].get(e);if(void 0===t)return;const n=this[F].indexOf(t);this[M].delete(e),n>-1&&this[F].splice(n,1)},at:Array.prototype.at,concat:Array.prototype.concat,every:Array.prototype.every,fill:Array.prototype.fill,filter:Array.prototype.filter,find:Array.prototype.find,findIndex:Array.prototype.findIndex,forEach:Array.prototype.forEach,includes:Array.prototype.includes,indexOf:Array.prototype.indexOf,join:Array.prototype.join,keys:function(){return Array(this.length).keys()},lastIndexOf:Array.prototype.lastIndexOf,map:Array.prototype.map,reduce:Array.prototype.reduce,reduceRight:Array.prototype.reduceRight,slice:Array.prototype.slice,some:Array.prototype.some,values:function(){return this[Symbol.iterator]},toString:function(e){const t={string:""};return e&&Generator.Get(t).PushExecutionContext(e),this.toStream(t),t.string},toVRMLStream:function(e){for(const t of this[F])try{t.toVRMLStream(e),e.string+="\n",t instanceof Jn&&(e.string+="\n")}catch(e){console.error(e)}},toXMLStream:function(e){for(const t of this[F])try{t.toXMLStream(e),e.string+="\n"}catch(e){console.error(e)}},toStream:function(e){e.string="[object "+this.getTypeName()+"]"}};for(const e of Reflect.ownKeys(I.prototype))Object.defineProperty(I.prototype,e,{enumerable:!1});Object.defineProperty(I.prototype,"length",{get:function(){return this[F].length},enumerable:!1,configurable:!1});const R=I;function V(e){return R.call(this,e)}V.prototype=Object.assign(Object.create(R.prototype),{constructor:V,getTypeName:function(){return"FieldDefinitionArray"}});for(const e of Reflect.ownKeys(V.prototype))Object.defineProperty(V.prototype,e,{enumerable:!1});const P=V;function A(){return R.call(this)}A.prototype=Object.assign(Object.create(R.prototype),{constructor:A,getTypeName:function(){return"FieldArray"}});for(const e of Reflect.ownKeys(A.prototype))Object.defineProperty(A.prototype,e,{enumerable:!1});const L=A,U=Symbol(),B=Symbol(),X=Symbol(),k=Symbol(),z=Symbol(),j=Symbol(),G=Symbol(),H=Symbol(),q=Symbol(),W=Symbol(),Y=Symbol.for("X3DField.uniformLocation");function K(e){return w.call(this),this[U]=e,this}K.prototype=Object.assign(Object.create(w.prototype),{constructor:K,[U]:null,[B]:s.initializeOnly,[X]:null,[Y]:null,[k]:new Set,[z]:new Map,[j]:new Set,[G]:new Map,[H]:new Set,[q]:new Set,[W]:new Map,create:function(){return new this.constructor},equals:function(e){return this[U]===e.valueOf()},assign:function(e){this.set(e.getValue()),this.addEvent()},set:function(e){this[U]=e},setValue:function(e){this.set(e instanceof this.constructor?e.getValue():e),this.addEvent()},getValue:function(){return this[U]},setAccessType:function(e){this[B]=e},getAccessType:function(){return this[B]},isInitializable:function(){return this[B]&s.initializeOnly},isInput:function(){return this[B]&s.inputOnly},isOutput:function(){return this[B]&s.outputOnly},isReadable:function(){return this[B]!==s.inputOnly},isWritable:function(){return this[B]!==s.initializeOnly},setUnit:function(e){this[X]=e},getUnit:function(){return this[X]},hasReferences:function(){return 0!==this[k].size},isReference:function(e){return e===this[B]||e===s.inputOutput},addReference:function(e){const t=this.getReferences();if(!t.has(e)){switch(t.add(e),this.getAccessType()&e.getAccessType()){case s.initializeOnly:e.addFieldInterest(this),this.assign(e);break;case s.inputOnly:e.addFieldInterest(this);break;case s.outputOnly:this.addFieldInterest(e);break;case s.inputOutput:e.addFieldInterest(this),this.addFieldInterest(e),this.assign(e)}this.processReferencesCallbacks()}},removeReference:function(e){switch(this.getReferences().delete(e),this.getAccessType()&e.getAccessType()){case s.initializeOnly:case s.inputOnly:e.removeFieldInterest(this);break;case s.outputOnly:this.removeFieldInterest(e);break;case s.inputOutput:e.removeFieldInterest(this),this.removeFieldInterest(e)}this.processReferencesCallbacks()},getReferences:function(){return this[k]===K.prototype[k]&&(this[k]=new Set),this[k]},addReferencesCallback:function(e,t){this[z]===K.prototype[z]&&(this[z]=new Map),this[z].set(e,t)},removeReferencesCallback:function(e){this[z].delete(e)},getReferencesCallbacks:function(){return this[z]},processReferencesCallbacks:function(){const e=[];return function(){if(this[z].size)for(const t of c.values(e,this[z]))t()}}(),addFieldInterest:function(e){this[j]===K.prototype[j]&&(this[j]=new Set),this[j].add(e)},removeFieldInterest:function(e){this[j].delete(e)},getFieldInterests:function(){return this[j]},addFieldCallback:function(e,t){this[G]===K.prototype[G]&&(this[G]=new Map),this[G].set(e,t)},removeFieldCallback:function(e){this[G].delete(e)},getFieldCallbacks:function(){return this[G]},addInputRoute:function(e){this[H]===K.prototype[H]&&(this[H]=new Set),this[H].add(e),this.processRouteCallbacks()},removeInputRoute:function(e){this[H].delete(e),this.processRouteCallbacks()},getInputRoutes:function(){return this[H]},addOutputRoute:function(e){this[q]===K.prototype[q]&&(this[q]=new Set),this[q].add(e),this.processRouteCallbacks()},removeOutputRoute:function(e){this[q].delete(e),this.processRouteCallbacks()},getOutputRoutes:function(){return this[q]},addRouteCallback:function(e,t){this[W]===K.prototype[W]&&(this[W]=new Map),this[W].set(e,t)},removeRouteCallback:function(e){this[W].delete(e)},getRouteCallbacks:function(){return this[W]},processRouteCallbacks:function(){const e=[];return function(){if(this[W].size)for(const t of c.values(e,this[W]))t()}}(),processEvent:function(){const e=[];return function(t=S.create(this)){if(t.has(this))return;t.add(this),this.setTainted(!1);const n=t.field;n!==this&&this.set(n.getValue(),n.length),this.processInterests();let i=!0;if(this[j].size)for(const e of this[j].values())i?(i=!1,e.addEventObject(this,t)):e.addEventObject(this,S.copy(t));if(i&&S.push(t),this[G].size)for(const t of c.values(e,this[G]))t(this.valueOf())}}(),addCloneCount:Function.prototype,removeCloneCount:Function.prototype,valueOf:function(){return this},fromString:function(e,t){const n=new(window[Symbol.for("X_ITE.X3D-8.0.0a")].require("x_ite/Parser/VRMLParser"))(t);if(n.setUnits(!!t),n.setInput(e),!n.fieldValue(this))throw new Error("Couldn't read value for field '"+this.getName()+"'.")},dispose:function(){for(const e of new Set(this[H]))e.dispose();for(const e of new Set(this[q]))e.dispose();w.prototype.dispose.call(this)}});for(const e of Reflect.ownKeys(K.prototype))Object.defineProperty(K.prototype,e,{enumerable:!1});const Z=K;function Q(e){return Z.call(this,!!e)}Q.prototype=Object.assign(Object.create(Z.prototype),{constructor:Q,copy:function(){return new Q(this.getValue())},isDefaultValue:function(){return!1===this.getValue()},set:function(e){Z.prototype.set.call(this,!!e)},getTypeName:function(){return"SFBool"},getType:function(){return s.SFBool},valueOf:function(){return this.getValue()},toStream:function(e){e.string+=this.getValue()?"TRUE":"FALSE"},toVRMLStream:function(e){this.toStream(e)},toXMLStream:function(e){e.string+=this.getValue()?"true":"false"}});for(const e of Reflect.ownKeys(Q.prototype))Object.defineProperty(Q.prototype,e,{enumerable:!1});const $=Q;function J(){}J.prototype={constructor:J,radians:function(e){return e*(Math.PI/180)},degrees:function(e){return e*(180/Math.PI)},random:function(e,t){return e+Math.random()*(t-e)},fract:function(e){return e%1},clamp:function(e,t,n){return Math.min(Math.max(e,t),n)},interval:function(e,t,n){return e>=n?(e-t)%(n-t)+t:e<t?(e-n)%(n-t)+n:e},lerp:function(e,t,n){return e+n*(t-e)},slerp:function(e,t,n){let i=e.dot(t);if(i>=1)return e;i<0&&(i=-i,t.negate());const o=Math.acos(i),r=Math.sin(o),s=Math.sin((1-n)*o)/r,a=Math.sin(n*o)/r;return e.x=e.x*s+t.x*a,e.y=e.y*s+t.y*a,e.z=e.z*s+t.z*a,e.w=e.w*s+t.w*a,e},simpleSlerp:function(e,t,n){const i=e.dot(t);if(i>=1)return e;const o=Math.acos(i),r=Math.sin(o),s=Math.sin((1-n)*o)/r,a=Math.sin(n*o)/r;return e.x=e.x*s+t.x*a,e.y=e.y*s+t.y*a,e.z=e.z*s+t.z*a,e.w=e.w*s+t.w*a,e},isPowerOfTwo:function(e){return 0==(e-1&e)},nextPowerOfTwo:function(e){return this.isPowerOfTwo(e)?e:1<<32-Math.clz32(e)},cmp:function(e,t){return e>t?1:e<t?-1:0},less:function(e,t){return e<t},greater:function(e,t){return e>t},lowerBound:function(e,t,n,i,o=this.less){let r=0,s=0,a=n-t;for(;a>0;)s=a>>>1,r=t+s,o(e[r],i)?(t=++r,a-=s+1):a=s;return t},upperBound:function(e,t,n,i,o=this.less){let r=0,s=0,a=n-t;for(;a>0;)s=a>>>1,r=t+s,o(i,e[r])?a=s:(t=++r,a-=s+1);return t},set_difference:function(e,t,n){for(const i of e)t.has(i)||n.add(i);return n}};const ee=new J,te=ee.clamp,ne=Symbol.for("X_ITE.Color3.r"),ie=Symbol.for("X_ITE.Color3.g"),oe=Symbol.for("X_ITE.Color3.b");function re(e,t,n){arguments.length?(this[ne]=te(e,0,1),this[ie]=te(t,0,1),this[oe]=te(n,0,1)):(this[ne]=0,this[ie]=0,this[oe]=0)}re.prototype={constructor:re,length:3,[Symbol.iterator]:function*(){yield this[ne],yield this[ie],yield this[oe]},copy:function(){const e=Object.create(re.prototype);return e[ne]=this[ne],e[ie]=this[ie],e[oe]=this[oe],e},assign:function(e){this[ne]=e[ne],this[ie]=e[ie],this[oe]=e[oe]},set:function(e,t,n){this[ne]=te(e,0,1),this[ie]=te(t,0,1),this[oe]=te(n,0,1)},equals:function(e){return this[ne]===e[ne]&&this[ie]===e[ie]&&this[oe]===e[oe]},getHSV:function(e){let t,n,i;const o=Math.min(this[ne],this[ie],this[oe]),r=Math.max(this[ne],this[ie],this[oe]);i=r;const s=r-o;return 0!==r&&0!==s?(n=s/r,t=this[ne]===r?(this[ie]-this[oe])/s:this[ie]===r?2+(this[oe]-this[ne])/s:4+(this[ne]-this[ie])/s,t*=Math.PI/3,t<0&&(t+=2*Math.PI)):n=t=0,e[0]=t,e[1]=n,e[2]=i,e},setHSV:function(e,t,n){if(t=te(t,0,1),n=te(n,0,1),0===t)this[ne]=this[ie]=this[oe]=n;else{const i=ee.degrees(ee.interval(e,0,2*Math.PI))/60,o=Math.floor(i),r=i-o,s=n*(1-t),a=n*(1-t*r),u=n*(1-t*(1-r));switch(o%6){case 0:this[ne]=n,this[ie]=u,this[oe]=s;break;case 1:this[ne]=a,this[ie]=n,this[oe]=s;break;case 2:this[ne]=s,this[ie]=n,this[oe]=u;break;case 3:this[ne]=s,this[ie]=a,this[oe]=n;break;case 4:this[ne]=u,this[ie]=s,this[oe]=n;break;default:this[ne]=n,this[ie]=s,this[oe]=a}}},toString:function(){return this[ne]+" "+this[ie]+" "+this[oe]}};const se={get:function(){return this[ne]},set:function(e){this[ne]=te(e,0,1)},enumerable:!0,configurable:!1},ae={get:function(){return this[ie]},set:function(e){this[ie]=te(e,0,1)},enumerable:!0,configurable:!1},ue={get:function(){return this[oe]},set:function(e){this[oe]=te(e,0,1)},enumerable:!0,configurable:!1};Object.defineProperty(re.prototype,"r",se),Object.defineProperty(re.prototype,"g",ae),Object.defineProperty(re.prototype,"b",ue),se.enumerable=!1,ae.enumerable=!1,ue.enumerable=!1,Object.defineProperty(re.prototype,"0",se),Object.defineProperty(re.prototype,"1",ae),Object.defineProperty(re.prototype,"2",ue),Object.assign(re,{HSV:function(e,t,n){const i=Object.create(this.prototype);return i.setHSV(e,t,n),i},lerp:function(e,t,n,i){let o=e[0],r=t[0];const s=e[1],a=t[1],u=e[2],l=t[2];0===s&&(o=r),0===a&&(r=o);const c=Math.abs(r-o);if(c<=Math.PI)return i[0]=o+n*(r-o),i[1]=s+n*(a-s),i[2]=u+n*(l-u),i;const h=2*Math.PI,d=(h-c)*n;let p=o<r?o-d:o+d;return p<0?p+=h:p>h&&(p-=h),i[0]=p,i[1]=s+n*(a-s),i[2]=u+n*(l-u),i}});const le=re;function ce(e,t,n){switch(arguments.length){case 0:return Z.call(this,new le);case 1:return Z.call(this,arguments[0]);case 3:return Z.call(this,new le(+e,+t,+n))}throw new Error("Invalid arguments.")}ce.prototype=Object.assign(Object.create(Z.prototype),{constructor:ce,[Symbol.iterator]:function*(){yield*this.getValue()},copy:function(){return new ce(this.getValue().copy())},getTypeName:function(){return"SFColor"},getType:function(){return s.SFColor},equals:function(e){return this.getValue().equals(e.getValue())},isDefaultValue:function(){return 0===this.getValue().r&&0===this.getValue().g&&0===this.getValue().b},set:function(e){this.getValue().assign(e)},getHSV:function(){return this.getValue().getHSV([])},setHSV:function(e,t,n){this.getValue().setHSV(e,t,n),this.addEvent()},lerp:function(){const e=[],t=[],n=[];return function(i,o){const r=new ce;return this.getValue().getHSV(e),i.getValue().getHSV(t),le.lerp(e,t,o,n),r.setHSV(n[0],n[1],n[2],n[3]),r}}(),toStream:function(e){const t=u.Get(e),n=this.getValue(),i=n.length-1;for(let o=0;o<i;++o)e.string+=t.Precision(n[o]),e.string+=" ";e.string+=t.Precision(n[i])},toVRMLStream:function(e){this.toStream(e)},toXMLStream:function(e){this.toStream(e)}});for(const e of Reflect.ownKeys(ce.prototype))Object.defineProperty(ce.prototype,e,{enumerable:!1});const he={get:function(){return this.getValue().r},set:function(e){this.getValue().r=+e,this.addEvent()},enumerable:!0,configurable:!1},de={get:function(){return this.getValue().g},set:function(e){this.getValue().g=+e,this.addEvent()},enumerable:!0,configurable:!1},pe={get:function(){return this.getValue().b},set:function(e){this.getValue().b=+e,this.addEvent()},enumerable:!0,configurable:!1};Object.defineProperty(ce.prototype,"r",he),Object.defineProperty(ce.prototype,"g",de),Object.defineProperty(ce.prototype,"b",pe),he.enumerable=!1,de.enumerable=!1,pe.enumerable=!1,Object.defineProperty(ce.prototype,"0",he),Object.defineProperty(ce.prototype,"1",de),Object.defineProperty(ce.prototype,"2",pe);const fe=ce,ge=ee.clamp,me=Symbol.for("X_ITE.Color3.r"),_e=Symbol.for("X_ITE.Color3.g"),ye=Symbol.for("X_ITE.Color3.b"),xe=Symbol();function we(e,t,n,i){arguments.length?(this[me]=ge(e,0,1),this[_e]=ge(t,0,1),this[ye]=ge(n,0,1),this[xe]=ge(i,0,1)):(this[me]=0,this[_e]=0,this[ye]=0,this[xe]=0)}we.prototype={constructor:we,length:4,[Symbol.iterator]:function*(){yield this[me],yield this[_e],yield this[ye],yield this[xe]},copy:function(){const e=Object.create(we.prototype);return e[me]=this[me],e[_e]=this[_e],e[ye]=this[ye],e[xe]=this[xe],e},assign:function(e){this[me]=e[me],this[_e]=e[_e],this[ye]=e[ye],this[xe]=e[xe]},set:function(e,t,n,i){this[me]=ge(e,0,1),this[_e]=ge(t,0,1),this[ye]=ge(n,0,1),this[xe]=ge(i,0,1)},equals:function(e){return this[me]===e[me]&&this[_e]===e[_e]&&this[ye]===e[ye]&&this[xe]===e[xe]},getHSVA:function(e){return le.prototype.getHSV.call(this,e),e[3]=this[xe],e},setHSVA:function(e,t,n,i){le.prototype.setHSV.call(this,e,t,n),this[xe]=ge(i,0,1)},toString:function(){return this[me]+" "+this[_e]+" "+this[ye]+" "+this[xe]}};const ve={get:function(){return this[me]},set:function(e){this[me]=ge(e,0,1)},enumerable:!0,configurable:!1},be={get:function(){return this[_e]},set:function(e){this[_e]=ge(e,0,1)},enumerable:!0,configurable:!1},Se={get:function(){return this[ye]},set:function(e){this[ye]=ge(e,0,1)},enumerable:!0,configurable:!1},Te={get:function(){return this[xe]},set:function(e){this[xe]=ge(e,0,1)},enumerable:!0,configurable:!1};Object.defineProperty(we.prototype,"r",ve),Object.defineProperty(we.prototype,"g",be),Object.defineProperty(we.prototype,"b",Se),Object.defineProperty(we.prototype,"a",Te),ve.enumerable=!1,be.enumerable=!1,Se.enumerable=!1,Te.enumerable=!1,Object.defineProperty(we.prototype,"0",ve),Object.defineProperty(we.prototype,"1",be),Object.defineProperty(we.prototype,"2",Se),Object.defineProperty(we.prototype,"3",Te),Object.assign(we,{HSVA:function(e,t,n,i){const o=Object.create(this.prototype);return o.setHSVA(e,t,n,i),o},lerp:function(e,t,n,i){const o=e[3];return le.lerp(e,t,n,i),i[3]=o+n*(t[3]-o),i}});const Ee=we;function Ce(e,t,n,i){switch(arguments.length){case 0:return Z.call(this,new Ee);case 1:return Z.call(this,arguments[0]);case 4:return Z.call(this,new Ee(+e,+t,+n,+i))}throw new Error("Invalid arguments.")}Ce.prototype=Object.assign(Object.create(Z.prototype),{constructor:Ce,[Symbol.iterator]:function*(){yield*this.getValue()},copy:function(){return new Ce(this.getValue().copy())},getTypeName:function(){return"SFColorRGBA"},getType:function(){return s.SFColorRGBA},equals:fe.prototype.equals,isDefaultValue:function(){return 0===this.getValue().r&&0===this.getValue().g&&0===this.getValue().b&&0===this.getValue().a},set:fe.prototype.set,getHSVA:function(){return this.getValue().getHSVA([])},setHSVA:function(e,t,n,i){this.getValue().setHSVA(e,t,n,i),this.addEvent()},lerp:function(){const e=[],t=[],n=[];return function(i,o){const r=new Ce;return this.getValue().getHSVA(e),i.getValue().getHSVA(t),Ee.lerp(e,t,o,n),r.setHSVA(n[0],n[1],n[2],n[3]),r}}(),toStream:fe.prototype.toStream,toVRMLStream:fe.prototype.toVRMLStream,toXMLStream:fe.prototype.toXMLStream});for(const e of Reflect.ownKeys(Ce.prototype))Object.defineProperty(Ce.prototype,e,{enumerable:!1});const Oe={get:function(){return this.getValue().r},set:function(e){this.getValue().r=+e,this.addEvent()},enumerable:!0,configurable:!1},Ne={get:function(){return this.getValue().g},set:function(e){this.getValue().g=+e,this.addEvent()},enumerable:!0,configurable:!1},Fe={get:function(){return this.getValue().b},set:function(e){this.getValue().b=+e,this.addEvent()},enumerable:!0,configurable:!1},Me={get:function(){return this.getValue().a},set:function(e){this.getValue().a=+e,this.addEvent()},enumerable:!0,configurable:!1};Object.defineProperty(Ce.prototype,"r",Oe),Object.defineProperty(Ce.prototype,"g",Ne),Object.defineProperty(Ce.prototype,"b",Fe),Object.defineProperty(Ce.prototype,"a",Me),Oe.enumerable=!1,Ne.enumerable=!1,Fe.enumerable=!1,Me.enumerable=!1,Object.defineProperty(Ce.prototype,"0",Oe),Object.defineProperty(Ce.prototype,"1",Ne),Object.defineProperty(Ce.prototype,"2",Fe),Object.defineProperty(Ce.prototype,"3",Me);const De=Ce;function Ie(e){return Z.call(this,arguments.length?+e:0)}Ie.prototype=Object.assign(Object.create(Z.prototype),{constructor:Ie,copy:function(){return new Ie(this.getValue())},getTypeName:function(){return"SFDouble"},getType:function(){return s.SFDouble},isDefaultValue:function(){return 0===this.getValue()},set:function(e){Z.prototype.set.call(this,+e)},valueOf:Z.prototype.getValue,toStream:function(e){const t=u.Get(e),n=t.Unit(this.getUnit());e.string+=t.DoublePrecision(t.ToUnit(n,this.getValue()))},toVRMLStream:function(e){this.toStream(e)},toXMLStream:function(e){this.toStream(e)}});for(const e of Reflect.ownKeys(Ie.prototype))Object.defineProperty(Ie.prototype,e,{enumerable:!1});const Re=Ie;function Ve(e){return Z.call(this,arguments.length?+e:0)}Ve.prototype=Object.assign(Object.create(Z.prototype),{constructor:Ve,copy:function(){return new Ve(this.getValue())},getTypeName:function(){return"SFFloat"},getType:function(){return s.SFFloat},isDefaultValue:function(){return 0===this.getValue()},set:function(e){Z.prototype.set.call(this,+e)},valueOf:Z.prototype.getValue,toStream:function(e){const t=u.Get(e),n=t.Unit(this.getUnit());e.string+=t.Precision(t.ToUnit(n,this.getValue()))},toVRMLStream:function(e){this.toStream(e)},toXMLStream:function(e){this.toStream(e)}});for(const e of Reflect.ownKeys(Ve.prototype))Object.defineProperty(Ve.prototype,e,{enumerable:!1});const Pe=Ve;function Ae(e){return Z.call(this,~~e)}Ae.prototype=Object.assign(Object.create(Z.prototype),{constructor:Ae,copy:function(){return new Ae(this.getValue())},getTypeName:function(){return"SFInt32"},getType:function(){return s.SFInt32},isDefaultValue:function(){return 0===this.getValue()},set:function(e){Z.prototype.set.call(this,~~e)},valueOf:Z.prototype.getValue,toStream:function(e,t){e.string+=this.getValue().toString(t)},toVRMLStream:function(e){this.toStream(e)},toXMLStream:function(e){e.string+=this.getValue().toString()}});for(const e of Reflect.ownKeys(Ae.prototype))Object.defineProperty(Ae.prototype,e,{enumerable:!1});const Le=Ae;function Ue(e,t,n){return Object.assign(Object.create(Z.prototype),{[Symbol.iterator]:function*(){yield*this.getValue()},copy:function(){return new this.constructor(this.getValue().copy())},equals:function(e){return this.getValue().equals(e.getValue())},isDefaultValue:function(){return this.getValue().equals(e.Identity)},set:function(e){this.getValue().assign(e)},setTransform:function(e,t,n,i,o){e=e?e.getValue():null,t=t?t.getValue():null,n=n?n.getValue():null,i=i?i.getValue():null,o=o?o.getValue():null,this.getValue().set(e,t,n,i,o)},getTransform:function(e,t,n,i,o){e=e?e.getValue():null,t=t?t.getValue():null,n=n?n.getValue():null,i=i?i.getValue():null,o=o?o.getValue():null,this.getValue().get(e,t,n,i,o)},determinant:function(){return this.getValue().determinant()},transpose:function(){return new this.constructor(e.transpose(this.getValue()))},inverse:function(){return new this.constructor(e.inverse(this.getValue()))},multLeft:function(t){return new this.constructor(e.multLeft(this.getValue(),t.getValue()))},multRight:function(t){return new this.constructor(e.multRight(this.getValue(),t.getValue()))},multVecMatrix:function(e){return new t(this.getValue().multVecMatrix(e.getValue().copy()))},multMatrixVec:function(e){return new t(this.getValue().multMatrixVec(e.getValue().copy()))},multDirMatrix:function(e){return new t(this.getValue().multDirMatrix(e.getValue().copy()))},multMatrixDir:function(e){return new t(this.getValue().multMatrixDir(e.getValue().copy()))},toStream:function(e){const t=Generator.Get(e),i=this.getValue(),o=i.length-1;for(let r=0;r<o;++r)e.string+=n?t.DoublePrecision(i[r]):t.Precision(i[r]),e.string+=" ";e.string+=n?t.DoublePrecision(i[o]):t.Precision(i[o])},toVRMLStream:function(e){this.toStream(e)},toXMLStream:function(e){this.toStream(e)}})}function Be(e,t){return Object.assign(Object.create(Z.prototype),{[Symbol.iterator]:function*(){yield*this.getValue()},copy:function(){return new this.constructor(this.getValue().copy())},equals:function(e){return this.getValue().equals(e.getValue())},isDefaultValue:function(){return this.getValue().equals(e.Zero)},set:function(e){this.getValue().assign(e)},abs:function(){return new this.constructor(e.abs(this.getValue()))},add:function(t){return new this.constructor(e.add(this.getValue(),t.getValue()))},distance:function(e){return this.getValue().distance(e.getValue())},divide:function(t){return new this.constructor(e.divide(this.getValue(),t))},divVec:function(t){return new this.constructor(e.divVec(this.getValue(),t.getValue()))},dot:function(e){return this.getValue().dot(e.getValue())},inverse:function(){return new this.constructor(e.inverse(this.getValue()))},length:function(){return this.getValue().magnitude()},lerp:function(t,n){return new this.constructor(e.lerp(this.getValue(),t,n))},max:function(t){return new this.constructor(e.max(this.getValue(),t.getValue()))},min:function(t){return new this.constructor(e.min(this.getValue(),t.getValue()))},multiply:function(t){return new this.constructor(e.multiply(this.getValue(),t))},multVec:function(t){return new this.constructor(e.multVec(this.getValue(),t.getValue()))},negate:function(){return new this.constructor(e.negate(this.getValue()))},normalize:function(t){return new this.constructor(e.normalize(this.getValue()))},subtract:function(t){return new this.constructor(e.subtract(this.getValue(),t.getValue()))},toStream:function(e){const n=u.Get(e),i=this.getValue(),o=n.Unit(this.getUnit()),r=i.length-1;for(let s=0;s<r;++s)e.string+=t?n.DoublePrecision(n.ToUnit(o,i[s])):n.Precision(n.ToUnit(o,i[s])),e.string+=" ";e.string+=t?n.DoublePrecision(n.ToUnit(o,i[r])):n.Precision(n.ToUnit(o,i[r]))},toVRMLStream:function(e){this.toStream(e)},toXMLStream:function(e){this.toStream(e)}})}function Xe(e,t){this.x=e,this.y=t}Xe.prototype={constructor:Xe,length:2,[Symbol.iterator]:function*(){yield this.x,yield this.y},copy:function(){const e=Object.create(Xe.prototype);return e.x=this.x,e.y=this.y,e},assign:function(e){return this.x=e.x,this.y=e.y,this},set:function(e,t){return this.x=e,this.y=t,this},equals:function(e){return this.x===e.x&&this.y===e.y},negate:function(){return this.x=-this.x,this.y=-this.y,this},inverse:function(){return this.x=1/this.x,this.y=1/this.y,this},add:function(e){return this.x+=e.x,this.y+=e.y,this},subtract:function(e){return this.x-=e.x,this.y-=e.y,this},multiply:function(e){return this.x*=e,this.y*=e,this},multVec:function(e){return this.x*=e.x,this.y*=e.y,this},divide:function(e){return this.x/=e,this.y/=e,this},divVec:function(e){return this.x/=e.x,this.y/=e.y,this},normalize:function(){const e=Math.hypot(this.x,this.y);return e&&(this.x/=e,this.y/=e),this},dot:function(e){return this.x*e.x+this.y*e.y},norm:function(){const e=this.x,t=this.y;return e*e+t*t},magnitude:function(){return Math.hypot(this.x,this.y)},distance:function(e){return Math.hypot(this.x-e.x,this.y-e.y)},lerp:function(e,t){const n=this.x,i=this.y;return this.x=n+t*(e.x-n),this.y=i+t*(e.y-i),this},abs:function(){return this.x=Math.abs(this.x),this.y=Math.abs(this.y),this},min:function(e){let t=this.x,n=this.y;for(const e of arguments)t=Math.min(t,e.x),n=Math.min(n,e.y);return this.x=t,this.y=n,this},max:function(e){let t=this.x,n=this.y;for(const e of arguments)t=Math.max(t,e.x),n=Math.max(n,e.y);return this.x=t,this.y=n,this},toString:function(){return this.x+" "+this.y}},Object.defineProperty(Xe.prototype,"0",{get:function(){return this.x},set:function(e){this.x=e},enumerable:!1,configurable:!1}),Object.defineProperty(Xe.prototype,"1",{get:function(){return this.y},set:function(e){this.y=e},enumerable:!1,configurable:!1}),Object.assign(Xe,{Zero:new Xe(0,0),One:new Xe(1,1),xAxis:new Xe(1,0),yAxis:new Xe(0,1),negate:function(e){return e.copy().negate()},inverse:function(e){return e.copy().inverse()},add:function(e,t){return e.copy().add(t)},subtract:function(e,t){return e.copy().subtract(t)},multiply:function(e,t){return e.copy().multiply(t)},multVec:function(e,t){return e.copy().multVec(t)},divide:function(e,t){return e.copy().divide(t)},divVec:function(e,t){return e.copy().divVec(t)},normalize:function(e){return e.copy().normalize()},dot:function(e,t){return e.dot(t)},magnitude:function(e){return e.magnitude()},distance:function(e,t){return e.distance(t)},lerp:function(e,t,n){return e.copy().lerp(t,n)},abs:function(e){return e.copy().abs()},min:function(e,t){return this.prototype.min.apply(e.copy(),arguments)},max:function(e,t){return this.prototype.max.apply(e.copy(),arguments)}});const ke=Xe;function ze(e,t,n){function i(e,t){switch(arguments.length){case 0:return Z.call(this,new ke(0,0));case 1:return Z.call(this,arguments[0]);case 2:return Z.call(this,new ke(+e,+t))}throw new Error("Invalid arguments.")}i.prototype=Object.assign(Object.create(Z.prototype),Be(ke,n),{constructor:i,getTypeName:function(){return e},getType:function(){return t}});for(const e of Reflect.ownKeys(i.prototype))Object.defineProperty(i.prototype,e,{enumerable:!1});const o={get:function(){return this.getValue().x},set:function(e){this.getValue().x=+e,this.addEvent()},enumerable:!0,configurable:!1},r={get:function(){return this.getValue().y},set:function(e){this.getValue().y=+e,this.addEvent()},enumerable:!0,configurable:!1};return Object.defineProperty(i.prototype,"x",o),Object.defineProperty(i.prototype,"y",r),o.enumerable=!1,r.enumerable=!1,Object.defineProperty(i.prototype,"0",o),Object.defineProperty(i.prototype,"1",r),i}const je={SFVec2d:ze("SFVec2d",s.SFVec2d,!0),SFVec2f:ze("SFVec2f",s.SFVec2f,!1)};function Ge(e,t,n){this.x=e,this.y=t,this.z=n}Ge.prototype={constructor:Ge,length:3,[Symbol.iterator]:function*(){yield this.x,yield this.y,yield this.z},copy:function(){const e=Object.create(Ge.prototype);return e.x=this.x,e.y=this.y,e.z=this.z,e},assign:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this},set:function(e,t,n){return this.x=e,this.y=t,this.z=n,this},equals:function(e){return this.x===e.x&&this.y===e.y&&this.z===e.z},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},inverse:function(){return this.x=1/this.x,this.y=1/this.y,this.z=1/this.z,this},add:function(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this},subtract:function(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this},multiply:function(e){return this.x*=e,this.y*=e,this.z*=e,this},multVec:function(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this},divide:function(e){return this.x/=e,this.y/=e,this.z/=e,this},divVec:function(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this},cross:function(e){const t=this.x,n=this.y,i=this.z,o=e.x,r=e.y,s=e.z;return this.x=n*s-i*r,this.y=i*o-t*s,this.z=t*r-n*o,this},normalize:function(){const e=Math.hypot(this.x,this.y,this.z);return e&&(this.x/=e,this.y/=e,this.z/=e),this},dot:function(e){return this.x*e.x+this.y*e.y+this.z*e.z},norm:function(){let e=this.x,t=this.y,n=this.z;return e*e+t*t+n*n},magnitude:function(){return Math.hypot(this.x,this.y,this.z)},distance:function(e){return Math.hypot(this.x-e.x,this.y-e.y,this.z-e.z)},lerp:function(e,t){const n=this.x,i=this.y,o=this.z;return this.x=n+t*(e.x-n),this.y=i+t*(e.y-i),this.z=o+t*(e.z-o),this},slerp:function(){const e=new Ge(0,0,0);return function(t,n){return ee.simpleSlerp(this,e.assign(t),n)}}(),abs:function(){return this.x=Math.abs(this.x),this.y=Math.abs(this.y),this.z=Math.abs(this.z),this},min:function(e){let t=this.x,n=this.y,i=this.z;for(const e of arguments)t=Math.min(t,e.x),n=Math.min(n,e.y),i=Math.min(i,e.z);return this.x=t,this.y=n,this.z=i,this},max:function(e){let t=this.x,n=this.y,i=this.z;for(const e of arguments)t=Math.max(t,e.x),n=Math.max(n,e.y),i=Math.max(i,e.z);return this.x=t,this.y=n,this.z=i,this},toString:function(){return this.x+" "+this.y+" "+this.z}},Object.defineProperty(Ge.prototype,"0",{get:function(){return this.x},set:function(e){this.x=e},enumerable:!1,configurable:!1}),Object.defineProperty(Ge.prototype,"1",{get:function(){return this.y},set:function(e){this.y=e},enumerable:!1,configurable:!1}),Object.defineProperty(Ge.prototype,"2",{get:function(){return this.z},set:function(e){this.z=e},enumerable:!1,configurable:!1}),Object.assign(Ge,{Zero:new Ge(0,0,0),One:new Ge(1,1,1),xAxis:new Ge(1,0,0),yAxis:new Ge(0,1,0),zAxis:new Ge(0,0,1),negate:function(e){return e.copy().negate()},inverse:function(e){return e.copy().inverse()},add:function(e,t){return e.copy().add(t)},subtract:function(e,t){return e.copy().subtract(t)},multiply:function(e,t){return e.copy().multiply(t)},multVec:function(e,t){return e.copy().multVec(t)},divide:function(e,t){return e.copy().divide(t)},divVec:function(e,t){return e.copy().divVec(t)},cross:function(e,t){return e.copy().cross(t)},normalize:function(e){return e.copy().normalize()},dot:function(e,t){return e.dot(t)},magnitude:function(e){return e.magnitude()},distance:function(e,t){return e.distance(t)},lerp:function(e,t,n){return e.copy().lerp(t,n)},slerp:function(e,t,n){return e.copy().slerp(t,n)},abs:function(e){return e.copy().abs()},min:function(e,t){return this.prototype.min.apply(e.copy(),arguments)},max:function(e,t){return this.prototype.max.apply(e.copy(),arguments)}});const He=Ge;function qe(){arguments.length?(this[0]=arguments[0],this[1]=arguments[1],this[2]=arguments[2],this[3]=arguments[3]):this.identity()}qe.prototype={constructor:qe,order:2,length:4,[Symbol.iterator]:function*(){const e=this.length;for(let t=0;t<e;++t)yield this[t]},copy:function(){const e=Object.create(qe.prototype);return e[0]=this[0],e[1]=this[1],e[2]=this[2],e[3]=this[3],e},assign:function(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this},equals:function(e){return this[0]===e[0]&&this[1]===e[1]&&this[2]===e[2]&&this[3]===e[3]},set1:function(e,t,n){this[e*this.order+t]=n},get1:function(e,t){return this[e*this.order+t]},set:function(){switch(arguments.length){case 0:this.identity();break;case 4:this[0]=arguments[0],this[1]=arguments[1],this[2]=arguments[2],this[3]=arguments[3]}return this},determinant1:function(){return this[0]},determinant:function(){return this[0]*this[3]-this[1]*this[2]},transpose:function(){const e=this[1];return this[1]=this[2],this[2]=e,this},inverse:function(){const e=this[0],t=this[1],n=this[2],i=this[3],o=e*i-t*n;return this[0]=i/o,this[1]=-t/o,this[2]=-n/o,this[3]=e/o,this},multLeft:function(e){const t=this[0],n=this[1],i=this[2],o=this[3],r=e[0],s=e[1],a=e[2],u=e[3];return this[0]=t*r+i*s,this[1]=n*r+o*s,this[2]=t*a+i*u,this[3]=n*a+o*u,this},multRight:function(e){const t=this[0],n=this[1],i=this[2],o=this[3],r=e[0],s=e[1],a=e[2],u=e[3];return this[0]=r*t+a*n,this[1]=s*t+u*n,this[2]=r*i+a*o,this[3]=s*i+u*o,this},multVecMatrix:function(e){if("number"==typeof e){const t=e,n=t*this[2]+this[3];return(t*this[0]+this[1])/n}const t=e.x,n=e.y;return e.x=t*this[0]+n*this[2],e.y=t*this[1]+n*this[3],e},multMatrixVec:function(e){if("number"==typeof e){const t=e,n=t*this[2]+this[3];return(t*this[0]+this[1])/n}const t=e.x,n=e.y;return e.x=t*this[0]+n*this[1],e.y=t*this[2]+n*this[3],e},identity:function(){this[0]=1,this[1]=0,this[2]=0,this[3]=1},toString:function(){return this[0]+" "+this[1]+" "+this[2]+" "+this[3]}},Object.defineProperty(qe.prototype,"x",{get:function(){const e=new ke(0,0);return function(){return e.set(this[0],this[1])}}(),enumerable:!1,configurable:!1}),Object.defineProperty(qe.prototype,"y",{get:function(){const e=new ke(0,0);return function(){return e.set(this[2],this[3])}}(),enumerable:!1,configurable:!1}),Object.defineProperty(qe.prototype,"xAxis",{get:function(){return this[0]},enumerable:!1,configurable:!1}),Object.defineProperty(qe.prototype,"origin",{get:function(){return this[2]},enumerable:!1,configurable:!1}),Object.defineProperty(qe.prototype,"submatrix",{get:function(){return this[0]},enumerable:!1,configurable:!1}),Object.assign(qe,{Identity:new qe});const We=qe,Ye=[],Ke=[],Ze=[];function Qe(e,t){const n=e.order,i=t.values,o=t.vectors;let r,s,a,u,l,c,h,d,p,f,g,m,_,y=e.length;for(m=0;m<n;++m)for(Ye[m]=Ye[m]||new Array(n),Ke[m]=i[m]=e.get1(m,m),Ze[m]=0,_=0;_<n;++_)o[m][_]=m===_?1:0,Ye[m][_]=e.get1(_,m);for(m=0;m<50;++m){for(r=0,f=0;f<n-1;++f)for(g=f+1;g<n;++g)r+=Math.abs(Ye[f][g]);if(0===r)break;for(p=m<3?.2*r/y:0,f=0;f<n-1;++f)for(g=f+1;g<n;++g)if(d=100*Math.abs(Ye[f][g]),m>3&&Math.abs(i[f])+d===Math.abs(i[f])&&Math.abs(i[g])+d===Math.abs(i[g]))Ye[f][g]=0;else if(Math.abs(Ye[f][g])>p){for(h=i[g]-i[f],Math.abs(h)+d===Math.abs(h)?l=Ye[f][g]/h:(s=.5*h/Ye[f][g],l=1/(Math.abs(s)+Math.sqrt(1+s*s)),s<0&&(l=-l)),a=1/Math.sqrt(1+l*l),u=l*a,c=u/(1+a),h=l*Ye[f][g],Ze[f]-=h,Ze[g]+=h,i[f]-=h,i[g]+=h,Ye[f][g]=0,_=0;_<f;++_)d=Ye[_][f],h=Ye[_][g],Ye[_][f]=d-u*(h+d*c),Ye[_][g]=h+u*(d-h*c);for(_=f+1;_<g;++_)d=Ye[f][_],h=Ye[_][g],Ye[f][_]=d-u*(h+d*c),Ye[_][g]=h+u*(d-h*c);for(_=g+1;_<n;++_)d=Ye[f][_],h=Ye[g][_],Ye[f][_]=d-u*(h+d*c),Ye[g][_]=h+u*(d-h*c);for(_=0;_<n;++_)d=o[_][f],h=o[_][g],o[_][f]=d-u*(h+d*c),o[_][g]=h+u*(d-h*c)}for(f=0;f<n;++f)i[f]=Ke[f]+=Ze[f],Ze[f]=0}return t}function $e(){arguments.length?(this[0]=arguments[0],this[1]=arguments[1],this[2]=arguments[2],this[3]=arguments[3],this[4]=arguments[4],this[5]=arguments[5],this[6]=arguments[6],this[7]=arguments[7],this[8]=arguments[8]):this.identity()}$e.prototype={constructor:$e,order:3,length:9,[Symbol.iterator]:function*(){const e=this.length;for(let t=0;t<e;++t)yield this[t]},copy:function(){const e=Object.create($e.prototype);return e[0]=this[0],e[1]=this[1],e[2]=this[2],e[3]=this[3],e[4]=this[4],e[5]=this[5],e[6]=this[6],e[7]=this[7],e[8]=this[8],e},assign:function(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this[4]=e[4],this[5]=e[5],this[6]=e[6],this[7]=e[7],this[8]=e[8],this},equals:function(e){return this[0]===e[0]&&this[1]===e[1]&&this[2]===e[2]&&this[3]===e[3]&&this[4]===e[4]&&this[5]===e[5]&&this[6]===e[6]&&this[7]===e[7]&&this[8]===e[8]},rotation:function(){return math.atan2(this[1],this[0])},set1:function(e,t,n){return this[e*this.order+t]=n,this},get1:function(e,t){return this[e*this.order+t]},set:function(){const e=new ke(0,0);return function(t,n,i,o,r){switch(arguments.length){case 0:this.identity();break;case 1:null===t&&(t=ke.Zero),this.identity(),this.translate(t);break;case 2:null===t&&(t=ke.Zero),null===n&&(n=0),this.identity(),this.translate(t),0!==n&&this.rotate(n);break;case 3:null===t&&(t=ke.Zero),null===n&&(n=0),null===i&&(i=ke.One),this.identity(),this.translate(t),0!==n&&this.rotate(n),i.equals(ke.One)||this.scale(i);break;case 4:if(null===t&&(t=ke.Zero),null===n&&(n=0),null===i&&(i=ke.One),null===o&&(o=0),this.identity(),this.translate(t),0!==n&&this.rotate(n),!i.equals(ke.One)){0!==o?(this.rotate(o),this.scale(i),this.rotate(-o)):this.scale(i)}break;case 5:{null===t&&(t=ke.Zero),null===n&&(n=0),null===i&&(i=ke.One),null===o&&(o=0),null===r&&(r=ke.Zero),this.identity(),this.translate(t);const s=!r.equals(ke.Zero);s&&this.translate(r),0!==n&&this.rotate(n),i.equals(ke.One)||(0!==o?(this.rotate(o),this.scale(i),this.rotate(-o)):this.scale(i)),s&&this.translate(e.assign(r).negate());break}case 9:this[0]=arguments[0],this[1]=arguments[1],this[2]=arguments[2],this[3]=arguments[3],this[4]=arguments[4],this[5]=arguments[5],this[6]=arguments[6],this[7]=arguments[7],this[8]=arguments[8]}return this}}(),get:function(){const e=new ke(0,0),t=new He(0,0,0),n=new ke(0,0),i=new He(0,0,0),o=new ke(0,0),r=new We,s=new We,a=new ke(0,0);return function(u,l,c,h,d){switch(null===u&&(u=e),null===l&&(l=t),null===c&&(c=n),null===h&&(h=i),null===d&&(d=o),arguments.length){case 1:u.set(this[6],this[7]);break;case 2:this.factor(u,r,n,s),l[0]=r[0],l[1]=r[1],l[2]=Math.atan2(r[1],r[0]);break;case 3:this.factor(u,r,c,s),l[0]=r[0],l[1]=r[1],l[2]=Math.atan2(r[1],r[0]);break;case 4:this.factor(u,r,c,s),l[0]=r[0],l[1]=r[1],l[2]=Math.atan2(r[1],r[0]),h[0]=s[0],h[1]=s[1],h[2]=Math.atan2(s[1],s[0]);break;case 5:Je.set(a.assign(d).negate()),Je.multLeft(this),Je.translate(d),Je.get(u,l,c,h)}}}(),factor:function(){const e=new We,t=new We,n=new We,i={values:[],vectors:[[],[]]};return function(o,r,s,a){o.set(this[6],this[7]);const u=this.submatrix,l=u.determinant()<0?-1:1;n.assign(u).transpose().multLeft(u);const c=Qe(n,i);a.set(c.vectors[0][0],c.vectors[1][0],c.vectors[0][1],c.vectors[1][1]),s.x=l*Math.sqrt(c.values[0]),s.y=l*Math.sqrt(c.values[1]),e[0]=1/s.x,e[3]=1/s.y,r.assign(t.assign(a).transpose().multRight(e).multRight(a).multRight(u))}}(),determinant2:function(){return this[0]*this[4]-this[1]*this[3]},determinant:function(){const e=this[0],t=this[1],n=this[2],i=this[3],o=this[4],r=this[5],s=this[6],a=this[7],u=this[8];return e*(o*u-r*a)-t*(i*u-r*s)+n*(i*a-o*s)},transpose:function(){let e;return e=this[1],this[1]=this[3],this[3]=e,e=this[2],this[2]=this[6],this[6]=e,e=this[5],this[5]=this[7],this[7]=e,this},inverse:function(){const e=this[0],t=this[1],n=this[2],i=this[3],o=this[4],r=this[5],s=this[6],a=this[7],u=this[8],l=e*o,c=e*a,h=i*t,d=i*a,p=s*t,f=s*o;let g=l*u-c*r-h*u+d*n+p*r-f*n;g=1/g;const m=(o*u-a*r)*g,_=-(t*u-a*n)*g,y=(t*r-o*n)*g,x=-(i*u-s*r)*g,w=(e*u-s*n)*g,v=-(e*r-i*n)*g;return this[0]=m,this[1]=_,this[2]=y,this[3]=x,this[4]=w,this[5]=v,this[6]=(d-f)*g,this[7]=-(c-p)*g,this[8]=(l-h)*g,this},multLeft:function(e){const t=this[0],n=this[1],i=this[2],o=this[3],r=this[4],s=this[5],a=this[6],u=this[7],l=this[8],c=e[0],h=e[1],d=e[2],p=e[3],f=e[4],g=e[5],m=e[6],_=e[7],y=e[8];return this[0]=t*c+o*h+a*d,this[1]=n*c+r*h+u*d,this[2]=i*c+s*h+l*d,this[3]=t*p+o*f+a*g,this[4]=n*p+r*f+u*g,this[5]=i*p+s*f+l*g,this[6]=t*m+o*_+a*y,this[7]=n*m+r*_+u*y,this[8]=i*m+s*_+l*y,this},multRight:function(e){const t=this[0],n=this[1],i=this[2],o=this[3],r=this[4],s=this[5],a=this[6],u=this[7],l=this[8],c=e[0],h=e[1],d=e[2],p=e[3],f=e[4],g=e[5],m=e[6],_=e[7],y=e[8];return this[0]=t*c+n*p+i*m,this[1]=t*h+n*f+i*_,this[2]=t*d+n*g+i*y,this[3]=o*c+r*p+s*m,this[4]=o*h+r*f+s*_,this[5]=o*d+r*g+s*y,this[6]=a*c+u*p+l*m,this[7]=a*h+u*f+l*_,this[8]=a*d+u*g+l*y,this},multVecMatrix:function(e){if(2===e.length){const t=e.x,n=e.y,i=t*this[2]+n*this[5]+this[8];return e.x=(t*this[0]+n*this[3]+this[6])/i,e.y=(t*this[1]+n*this[4]+this[7])/i,e}const t=e.x,n=e.y,i=e.z;return e.x=t*this[0]+n*this[3]+i*this[6],e.y=t*this[1]+n*this[4]+i*this[7],e.z=t*this[2]+n*this[5]+i*this[8],e},multMatrixVec:function(e){if(2===e.length){const t=e.x,n=e.y,i=t*this[6]+n*this[7]+this[8];return e.x=(t*this[0]+n*this[1]+this[2])/i,e.y=(t*this[3]+n*this[4]+this[5])/i,e}const t=e.x,n=e.y,i=e.z;return e.x=t*this[0]+n*this[1]+i*this[2],e.y=t*this[3]+n*this[4]+i*this[5],e.z=t*this[6]+n*this[7]+i*this[8],e},multDirMatrix:function(e){const t=e.x,n=e.y;return e.x=t*this[0]+n*this[3],e.y=t*this[1]+n*this[4],e},multMatrixDir:function(e){const t=e.x,n=e.y;return e.x=t*this[0]+n*this[1],e.y=t*this[3]+n*this[4],e},identity:function(){this[0]=1,this[1]=0,this[2]=0,this[3]=0,this[4]=1,this[5]=0,this[6]=0,this[7]=0,this[8]=1},translate:function(e){const t=e.x,n=e.y;return this[6]+=this[0]*t+this[3]*n,this[7]+=this[1]*t+this[4]*n,this},rotate:function(e){return this.multLeft($e.Rotation(e)),this},scale:function(e){const t=e.x,n=e.y;return this[0]*=t,this[3]*=n,this[1]*=t,this[4]*=n,this},toString:function(){return this[0]+" "+this[1]+" "+this[2]+" "+this[3]+" "+this[4]+" "+this[5]+" "+this[6]+" "+this[7]+" "+this[8]}},Object.defineProperty($e.prototype,"x",{get:function(){const e=new He(0,0,0);return function(){return e.set(this[0],this[1],this[2])}}(),enumerable:!1,configurable:!1}),Object.defineProperty($e.prototype,"y",{get:function(){const e=new He(0,0,0);return function(){return e.set(this[3],this[4],this[5])}}(),enumerable:!1,configurable:!1}),Object.defineProperty($e.prototype,"z",{get:function(){const e=new He(0,0,0);return function(){return e.set(this[6],this[7],this[8])}}(),enumerable:!1,configurable:!1}),Object.defineProperty($e.prototype,"xAxis",{get:function(){const e=new ke(0,0);return function(){return e.set(this[0],this[1])}}(),enumerable:!1,configurable:!1}),Object.defineProperty($e.prototype,"yAxis",{get:function(){const e=new ke(0,0);return function(){return e.set(this[3],this[4])}}(),enumerable:!1,configurable:!1}),Object.defineProperty($e.prototype,"origin",{get:function(){const e=new ke(0,0);return function(){return e.set(this[6],this[7])}}(),enumerable:!1,configurable:!1}),Object.defineProperty($e.prototype,"submatrix",{get:function(){const e=new We;return function(){return e[0]=this[0],e[1]=this[1],e[2]=this[3],e[3]=this[4],e}}(),enumerable:!1,configurable:!1}),Object.assign($e,{Identity:new $e,Rotation:function(e){const t=Math.sin(e),n=Math.cos(e);return new $e(n,t,0,-t,n,0,0,0,1)},Matrix2:function(e){return new $e(e[0],e[1],0,e[2],e[3],0,0,0,1)},transpose:function(e){return e.copy().transpose()},inverse:function(e){return e.copy().inverse()},multLeft:function(e,t){return e.copy().multLeft(t)},multRight:function(e,t){return e.copy().multRight(t)}});const Je=new $e,et=$e;function tt(e,t,n,i){function o(e,t,n,i,o,r,s,a,u){switch(arguments.length){case 0:return Z.call(this,new et);case 1:return Z.call(this,arguments[0]);case 9:return Z.call(this,new et(+e,+t,+n,+i,+o,+r,+s,+a,+u))}throw new Error("Invalid arguments.")}o.prototype=Object.assign(Object.create(Z.prototype),Ue(et,n,i),{constructor:o,getTypeName:function(){return e},getType:function(){return t},setTransform:function(e,t,n,i,o){e=e?e.getValue():null,t=t||0,n=n?n.getValue():null,i=i||0,o=o?o.getValue():null,this.getValue().set(e,t,n,i,o)}});for(const e of Reflect.ownKeys(o.prototype))Object.defineProperty(o.prototype,e,{enumerable:!1});function r(e){Object.defineProperty(o.prototype,e,{get:function(){return this.getValue()[e]},set:function(t){this.getValue()[e]=+t,this.addEvent()},enumerable:!0,configurable:!1})}for(let e=0,t=et.prototype.length;e<t;++e)r(e);return o}const nt={SFMatrix3d:tt("SFMatrix3d",s.SFMatrix3d,je.SFVec2d,!0),SFMatrix3f:tt("SFMatrix3f",s.SFMatrix3f,je.SFVec2f,!1)};function it(e,t,n){function i(e,t,n){switch(arguments.length){case 0:return Z.call(this,new He(0,0,0));case 1:return Z.call(this,arguments[0]);case 3:return Z.call(this,new He(+e,+t,+n))}throw new Error("Invalid arguments.")}i.prototype=Object.assign(Object.create(Z.prototype),Be(He,n),{constructor:i,getTypeName:function(){return e},getType:function(){return t},cross:function(e){return new this.constructor(He.cross(this.getValue(),e.getValue()))}});for(const e of Reflect.ownKeys(i.prototype))Object.defineProperty(i.prototype,e,{enumerable:!1});const o={get:function(){return this.getValue().x},set:function(e){this.getValue().x=+e,this.addEvent()},enumerable:!0,configurable:!1},r={get:function(){return this.getValue().y},set:function(e){this.getValue().y=+e,this.addEvent()},enumerable:!0,configurable:!1},s={get:function(){return this.getValue().z},set:function(e){this.getValue().z=+e,this.addEvent()},enumerable:!0,configurable:!1};return Object.defineProperty(i.prototype,"x",o),Object.defineProperty(i.prototype,"y",r),Object.defineProperty(i.prototype,"z",s),o.enumerable=!1,r.enumerable=!1,s.enumerable=!1,Object.defineProperty(i.prototype,"0",o),Object.defineProperty(i.prototype,"1",r),Object.defineProperty(i.prototype,"2",s),i}const ot={SFVec3d:it("SFVec3d",s.SFVec3d,!0),SFVec3f:it("SFVec3f",s.SFVec3f,!1)};function rt(e,t,n,i){this.x=e,this.y=t,this.z=n,this.w=i}rt.prototype={constructor:rt,length:4,[Symbol.iterator]:function*(){yield this.x,yield this.y,yield this.z,yield this.w},copy:function(){const e=Object.create(rt.prototype);return e.x=this.x,e.y=this.y,e.z=this.z,e.w=this.w,e},assign:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w,this},set:function(e,t,n,i){return this.x=e,this.y=t,this.z=n,this.w=i,this},equals:function(e){return this.x===e.x&&this.y===e.y&&this.z===e.z&&this.w===e.w},getReal:function(e){e.x=this.x/this.w,e.y=this.y/this.w,e.z=this.z/this.w},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this},inverse:function(){return this.x=1/this.x,this.y=1/this.y,this.z=1/this.z,this.w=1/this.w,this},add:function(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this},subtract:function(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this},multiply:function(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this},multVec:function(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this},divide:function(e){return this.x/=e,this.y/=e,this.z/=e,this.w/=e,this},divVec:function(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this.w/=e.w,this},normalize:function(){const e=Math.hypot(this.x,this.y,this.z,this.w);return e&&(this.x/=e,this.y/=e,this.z/=e,this.w/=e),this},dot:function(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w},norm:function(){const e=this.x,t=this.y,n=this.z,i=this.w;return e*e+t*t+n*n+i*i},magnitude:function(){return Math.hypot(this.x,this.y,this.z,this.w)},distance:function(e){return Math.hypot(this.x-e.x,this.y-e.y,this.z-e.z,this.w-e.w)},lerp:function(e,t){const n=this.x,i=this.y,o=this.z,r=this.w;return this.x=n+t*(e.x-n),this.y=i+t*(e.y-i),this.z=o+t*(e.z-o),this.w=r+t*(e.w-r),this},abs:function(){return this.x=Math.abs(this.x),this.y=Math.abs(this.y),this.z=Math.abs(this.z),this.w=Math.abs(this.w),this},min:function(e){let t=this.x,n=this.y,i=this.z,o=this.w;for(const e of arguments)t=Math.min(t,e.x),n=Math.min(n,e.y),i=Math.min(i,e.z),o=Math.min(o,e.w);return this.x=t,this.y=n,this.z=i,this.w=o,this},max:function(e){let t=this.x,n=this.y,i=this.z,o=this.w;for(const e of arguments)t=Math.max(t,e.x),n=Math.max(n,e.y),i=Math.max(i,e.z),o=Math.max(o,e.w);return this.x=t,this.y=n,this.z=i,this.w=o,this},toString:function(){return this.x+" "+this.y+" "+this.z+" "+this.w}},Object.defineProperty(rt.prototype,"0",{get:function(){return this.x},set:function(e){this.x=e},enumerable:!1,configurable:!1}),Object.defineProperty(rt.prototype,"1",{get:function(){return this.y},set:function(e){this.y=e},enumerable:!1,configurable:!1}),Object.defineProperty(rt.prototype,"2",{get:function(){return this.z},set:function(e){this.z=e},enumerable:!1,configurable:!1}),Object.defineProperty(rt.prototype,"3",{get:function(){return this.w},set:function(e){this.w=e},enumerable:!1,configurable:!1}),Object.assign(rt,{Zero:new rt(0,0,0,0),One:new rt(1,1,1,1),xAxis:new rt(1,0,0,0),yAxis:new rt(0,1,0,0),zAxis:new rt(0,0,1,0),wAxis:new rt(0,0,0,1),negate:function(e){return e.copy().negate()},inverse:function(e){return e.copy().inverse()},add:function(e,t){return e.copy().add(t)},subtract:function(e,t){return e.copy().subtract(t)},multiply:function(e,t){return e.copy().multiply(t)},multVec:function(e,t){return e.copy().multVec(t)},divide:function(e,t){return e.copy().divide(t)},divVec:function(e,t){return e.copy().divVec(t)},normalize:function(e){return e.copy().normalize()},dot:function(e,t){return e.dot(t)},magnitude:function(e){return e.magnitude()},distance:function(e,t){return e.distance(t)},lerp:function(e,t,n){return e.copy().lerp(t,n)},abs:function(e){return e.copy().abs()},min:function(e,t){return this.prototype.min.apply(e.copy(),arguments)},max:function(e,t){return this.prototype.max.apply(e.copy(),arguments)}});const st=rt;function at(e,t,n,i){this.x=e,this.y=t,this.z=n,this.w=i}at.prototype={constructor:at,length:4,[Symbol.iterator]:function*(){yield this.x,yield this.y,yield this.z,yield this.w},copy:function(){const e=Object.create(at.prototype);return e.x=this.x,e.y=this.y,e.z=this.z,e.w=this.w,e},assign:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w,this},set:function(e,t,n,i){return this.x=e,this.y=t,this.z=n,this.w=i,this},setMatrix:function(e){let t;t=e[0]>e[4]?e[0]>e[8]?0:2:e[4]>e[8]?1:2;const n=e[0]+e[4]+e[8];if(n>e[3*t+t]){this[3]=Math.sqrt(n+1)/2;const t=4*this[3];this[0]=(e[5]-e[7])/t,this[1]=(e[6]-e[2])/t,this[2]=(e[1]-e[3])/t}else{const n=(t+1)%3,i=(t+2)%3;this[t]=Math.sqrt(e[3*t+t]-e[3*n+n]-e[3*i+i]+1)/2;const o=4*this[t];this[n]=(e[3*t+n]+e[3*n+t])/o,this[i]=(e[3*t+i]+e[3*i+t])/o,this[3]=(e[3*n+i]-e[3*i+n])/o}return this},getMatrix:function(e){const t=this.x,n=this.y,i=this.z,o=this.w,r=t*t,s=t*n,a=n*n,u=n*i,l=i*t,c=i*i,h=o*t,d=o*n,p=o*i;return e[0]=1-2*(a+c),e[1]=2*(s+p),e[2]=2*(l-d),e[3]=2*(s-p),e[4]=1-2*(c+r),e[5]=2*(u+h),e[6]=2*(l+d),e[7]=2*(u-h),e[8]=1-2*(a+r),e},isReal:function(){return!(this.x||this.y||this.z)},isImag:function(){return!this.w},equals:function(e){return this.x===e.x&&this.y===e.y&&this.z===e.z&&this.w===e.w},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this},inverse:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},add:function(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this},subtract:function(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this},multiply:function(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this},multLeft:function(e){const t=this.x,n=this.y,i=this.z,o=this.w,r=e.x,s=e.y,a=e.z,u=e.w;return this.x=o*r+t*u+n*a-i*s,this.y=o*s+n*u+i*r-t*a,this.z=o*a+i*u+t*s-n*r,this.w=o*u-t*r-n*s-i*a,this},multRight:function(e){const t=this.x,n=this.y,i=this.z,o=this.w,r=e.x,s=e.y,a=e.z,u=e.w;return this.x=u*t+r*o+s*i-a*n,this.y=u*n+s*o+a*t-r*i,this.z=u*i+a*o+r*n-s*t,this.w=u*o-r*t-s*n-a*i,this},divide:function(e){return this.x/=e,this.y/=e,this.z/=e,this.w/=e,this},multVecQuat:function(e){const t=this.x,n=this.y,i=this.z,o=this.w,r=e.x,s=e.y,a=e.z,u=o*o-t*t-n*n-i*i,l=2*(r*t+s*n+a*i),c=2*o;return e.x=u*r+l*t+c*(n*a-i*s),e.y=u*s+l*n+c*(i*r-t*a),e.z=u*a+l*i+c*(t*s-n*r),e},multQuatVec:function(e){const t=this.x,n=this.y,i=this.z,o=this.w,r=e.x,s=e.y,a=e.z,u=o*o-t*t-n*n-i*i,l=2*(r*t+s*n+a*i),c=2*o;return e.x=u*r+l*t-c*(n*a-i*s),e.y=u*s+l*n-c*(i*r-t*a),e.z=u*a+l*i-c*(t*s-n*r),e},normalize:function(){let e=Math.hypot(this.x,this.y,this.z,this.w);return e&&(e=1/e,this.x*=e,this.y*=e,this.z*=e,this.w*=e),this},dot:function(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w},norm:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},magnitude:function(){return Math.hypot(this.x,this.y,this.z,this.w)},pow:function(t){if(t instanceof at)return this.assign(e.assign(t).multRight(this.log()).exp());if(this.isReal())return this.set(0,0,0,Math.pow(this.w,t));const n=this.magnitude(),i=Math.acos(this.w/n),o=this.imag.magnitude(),r=Math.pow(n,t),s=t*i,a=r/o*Math.sin(s);return this.x*=a,this.y*=a,this.z*=a,this.w=r*Math.cos(s),this},log:function(){if(this.isReal())return this.w>0?this.set(0,0,0,Math.log(this.w)):this.set(Math.PI,0,0,Math.log(-this.w));const e=this.magnitude(),t=this.imag.normalize().multiply(Math.acos(this.w/e)),n=Math.log(e);return this.x=t.x,this.y=t.y,this.z=t.z,this.w=n,this},exp:function(){if(this.isReal())return this.set(0,0,0,Math.exp(this.w));const e=this.imag,t=e.magnitude(),n=Math.exp(this.w),i=n*Math.cos(t),o=e.multiply(n*Math.sin(t)/t);return this.x=o.x,this.y=o.y,this.z=o.z,this.w=i,this},slerp:function(e,t){return ee.slerp(this,ut.assign(e),t)},squad:function(e,t,n,i){return ee.slerp(ee.slerp(this,ut.assign(n),i),ee.slerp(lt.assign(e),ct.assign(t),i),2*i*(1-i))},toString:function(){return this.x+" "+this.y+" "+this.z+" "+this.w}},Object.defineProperty(at.prototype,"0",{get:function(){return this.x},set:function(e){this.x=e},enumerable:!1,configurable:!1}),Object.defineProperty(at.prototype,"1",{get:function(){return this.y},set:function(e){this.y=e},enumerable:!1,configurable:!1}),Object.defineProperty(at.prototype,"2",{get:function(){return this.z},set:function(e){this.z=e},enumerable:!1,configurable:!1}),Object.defineProperty(at.prototype,"3",{get:function(){return this.w},set:function(e){this.w=e},enumerable:!1,configurable:!1}),Object.defineProperty(at.prototype,"real",{get:function(){return this.w},enumerable:!1,configurable:!1}),Object.defineProperty(at.prototype,"imag",{get:function(){const e=new He(0,0,0);return function(){return e.set(this.x,this.y,this.z)}}(),enumerable:!1,configurable:!1}),Object.assign(at,{negate:function(e){return e.copy().negate()},inverse:function(e){return e.copy().inverse()},add:function(e,t){return e.copy().add(t)},subtract:function(e,t){return e.copy().subtract(t)},multiply:function(e,t){return e.copy().multiply(t)},multLeft:function(e,t){return e.copy().multLeft(t)},multRight:function(e,t){return e.copy().multRight(t)},divide:function(e,t){return e.copy().divide(t)},normalize:function(e){return e.copy().normalize()},slerp:function(e,t,n){return e.copy().slerp(t,n)},squad:function(e,t,n,i,o){return e.copy().squad(t,n,i,o)},spline:function(e,t,n){return ht.assign(e),dt.assign(t),pt.assign(n),ht.dot(dt)<0&&ht.negate(),pt.dot(dt)<0&&pt.negate(),ft.assign(dt).inverse(),dt.multRight(ut.assign(ft).multRight(ht).log().add(lt.assign(ft).multRight(pt).log()).divide(-4).exp()).normalize().copy()}});const ut=new at(0,0,0,1),lt=new at(0,0,0,1),ct=new at(0,0,0,1),ht=new at(0,0,0,1),dt=new at(0,0,0,1),pt=new at(0,0,0,1),ft=new at(0,0,0,1),gt=at,mt=Symbol(),_t=Symbol(),yt=Symbol(),xt=Symbol();function wt(e,t,n,i){switch(this[mt]=0,this[_t]=0,this[yt]=1,this[xt]=0,arguments.length){case 0:return void(this.value=new gt(0,0,0,1));case 1:return this.value=arguments[0],void this.update();case 2:{const e=arguments[0],t=arguments[1];return this.value=new gt(0,0,0,1),t instanceof He?this.setFromToVec(e,t):void this.set(e.x,e.y,e.z,t)}case 4:return this.value=new gt(0,0,0,1),void this.set(e,t,n,i)}}wt.prototype={constructor:wt,length:4,[Symbol.iterator]:function*(){yield this[mt],yield this[_t],yield this[yt],yield this[xt]},update:function(){const e=this.get();return this[mt]=e.x,this[_t]=e.y,this[yt]=e.z,this[xt]=e.w,this},copy:function(){const e=Object.create(wt.prototype);return e[mt]=this[mt],e[_t]=this[_t],e[yt]=this[yt],e[xt]=this[xt],e.value=this.value.copy(),e},assign:function(e){return this[mt]=e[mt],this[_t]=e[_t],this[yt]=e[yt],this[xt]=e[xt],this.value.assign(e.value),this},set:function(e,t,n,i){this[mt]=e,this[_t]=t,this[yt]=n,this[xt]=i;const o=Math.hypot(e,t,n);if(0===o)return this.value.set(0,0,0,1),this;const r=ee.interval(i/2,0,Math.PI),s=Math.sin(r)/o;return this.value.set(e*s,t*s,n*s,Math.cos(r)),this},get:function(){const e=new st(0,0,0,0);return function(){const t=this.value;if(Math.abs(t.w)>1)return st.zAxis;{const n=2*Math.acos(t.w),i=Math.sin(n/2);if(0===i)return st.zAxis;{const o=t.imag.divide(i);return e.set(o.x,o.y,o.z,n)}}}}(),setAxisAngle:function(e,t){return this.set(e.x,e.y,e.z,t)},setFromToVec:function(){const e=new He(0,0,0),t=new He(0,0,0),n=new He(0,0,0),i=new He(0,0,0);return function(o,r){e.assign(o).normalize(),t.assign(r).normalize();const s=ee.clamp(e.dot(t),-1,1),a=n.assign(e).cross(t).normalize();return 0===a.magnitude()?s>0?this.value.set(0,0,0,1):(i.assign(e).cross(He.xAxis),0===i.norm()&&i.assign(e).cross(He.yAxis),i.normalize(),this.value.set(i.x,i.y,i.z,0)):(a.multiply(Math.sqrt(Math.abs(1-s)/2)),this.value.set(a.x,a.y,a.z,Math.sqrt(Math.abs(1+s)/2))),this.update(),this}}(),setAxis:function(e){this.set(e.x,e.y,e.z,this[xt])},getAxis:function(){const e=new He(0,0,0);return function(){return e.set(this[mt],this[_t],this[yt])}}(),setMatrix:function(e){return this.value.setMatrix(e).normalize(),this.update(),this},getMatrix:function(e){return this.value.getMatrix(e)},equals:function(e){return this.value.equals(e.value)},inverse:function(){return this.value.inverse(),this.update(),this},multLeft:function(e){return this.value.multLeft(e.value).normalize(),this.update(),this},multRight:function(e){return this.value.multRight(e.value).normalize(),this.update(),this},multVecRot:function(e){return this.value.multVecQuat(e)},multRotVec:function(e){return this.value.multQuatVec(e)},normalize:function(){return this.value.normalize(),this.update(),this},pow:function(e){return this.value.pow(e),this.update(),this},slerp:function(e,t){return this.value.slerp(e.value,t),this.update(),this},squad:function(e,t,n,i){return this.value.squad(e.value,t.value,n.value,i),this.update(),this},toString:function(){return this[mt]+" "+this[_t]+" "+this[yt]+" "+this[xt]}};const vt={get:function(){return this[mt]},set:function(e){this[mt]=e,this.set(e,this[_t],this[yt],this[xt])},enumerable:!0,configurable:!1},bt={get:function(){return this[_t]},set:function(e){this[_t]=e,this.set(this[mt],e,this[yt],this[xt])},enumerable:!0,configurable:!1},St={get:function(){return this[yt]},set:function(e){this[yt]=e,this.set(this[mt],this[_t],e,this[xt])},enumerable:!0,configurable:!1},Tt={get:function(){return this[xt]},set:function(e){this[xt]=e,this.set(this[mt],this[_t],this[yt],e)},enumerable:!0,configurable:!1};Object.defineProperty(wt.prototype,"x",vt),Object.defineProperty(wt.prototype,"y",bt),Object.defineProperty(wt.prototype,"z",St),Object.defineProperty(wt.prototype,"angle",Tt),vt.enumerable=!1,bt.enumerable=!1,St.enumerable=!1,Tt.enumerable=!1,Object.defineProperty(wt.prototype,"0",vt),Object.defineProperty(wt.prototype,"1",bt),Object.defineProperty(wt.prototype,"2",St),Object.defineProperty(wt.prototype,"3",Tt),Object.assign(wt,{Identity:new wt,inverse:function(e){return e.copy().inverse()},multRight:function(e,t){return e.copy().multRight(t)},normalize:function(e){return e.copy().normalize()},slerp:function(e,t,n){return e.copy().slerp(t,n)},squad:function(e,t,n,i,o){return e.copy().squad(t,n,i,o)},spline:function(e,t,n){const i=Object.create(this.prototype);return i.value=gt.spline(e.value,t.value,n.value),i.update(),i}});const Et=wt;function Ct(){arguments.length?(this[0]=arguments[0],this[1]=arguments[1],this[2]=arguments[2],this[3]=arguments[3],this[4]=arguments[4],this[5]=arguments[5],this[6]=arguments[6],this[7]=arguments[7],this[8]=arguments[8],this[9]=arguments[9],this[10]=arguments[10],this[11]=arguments[11],this[12]=arguments[12],this[13]=arguments[13],this[14]=arguments[14],this[15]=arguments[15]):this.identity()}Ct.prototype={constructor:Ct,order:4,length:16,[Symbol.iterator]:function*(){const e=this.length;for(let t=0;t<e;++t)yield this[t]},copy:function(){const e=Object.create(Ct.prototype);return e[0]=this[0],e[1]=this[1],e[2]=this[2],e[3]=this[3],e[4]=this[4],e[5]=this[5],e[6]=this[6],e[7]=this[7],e[8]=this[8],e[9]=this[9],e[10]=this[10],e[11]=this[11],e[12]=this[12],e[13]=this[13],e[14]=this[14],e[15]=this[15],e},assign:function(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this[4]=e[4],this[5]=e[5],this[6]=e[6],this[7]=e[7],this[8]=e[8],this[9]=e[9],this[10]=e[10],this[11]=e[11],this[12]=e[12],this[13]=e[13],this[14]=e[14],this[15]=e[15],this},equals:function(e){return this[0]===e[0]&&this[1]===e[1]&&this[2]===e[2]&&this[3]===e[3]&&this[4]===e[4]&&this[5]===e[5]&&this[6]===e[6]&&this[7]===e[7]&&this[8]===e[8]&&this[9]===e[9]&&this[10]===e[10]&&this[11]===e[11]&&this[12]===e[12]&&this[13]===e[13]&&this[14]===e[14]&&this[15]===e[15]},set1:function(e,t,n){return this[e*this.order+t]=n,this},get1:function(e,t){return this[e*this.order+t]},set:function(){const e=new Et,t=new He(0,0,0);return function(n,i,o,r,s){switch(arguments.length){case 0:this.identity();break;case 1:null===n&&(n=He.Zero),this.identity(),this.translate(n);break;case 2:null===n&&(n=He.Zero),null===i&&(i=Et.Identity),this.identity(),this.translate(n),i.equals(Et.Identity)||this.rotate(i);break;case 3:null===n&&(n=He.Zero),null===i&&(i=Et.Identity),null===o&&(o=He.One),this.identity(),this.translate(n),i.equals(Et.Identity)||this.rotate(i),o.equals(He.One)||this.scale(o);break;case 4:if(null===n&&(n=He.Zero),null===i&&(i=Et.Identity),null===o&&(o=He.One),null===r&&(r=Et.Identity),this.identity(),this.translate(n),i.equals(Et.Identity)||this.rotate(i),!o.equals(He.One)){!r.equals(Et.Identity)?(this.rotate(r),this.scale(o),this.rotate(e.assign(r).inverse())):this.scale(o)}break;case 5:{null===n&&(n=He.Zero),null===i&&(i=Et.Identity),null===o&&(o=He.One),null===r&&(r=Et.Identity),null===s&&(s=He.Zero),this.identity(),this.translate(n);const a=!s.equals(He.Zero);a&&this.translate(s),i.equals(Et.Identity)||this.rotate(i),o.equals(He.One)||(r.equals(Et.Identity)?this.scale(o):(this.rotate(r),this.scale(o),this.rotate(e.assign(r).inverse()))),a&&this.translate(t.assign(s).negate());break}case 16:this[0]=arguments[0],this[1]=arguments[1],this[2]=arguments[2],this[3]=arguments[3],this[4]=arguments[4],this[5]=arguments[5],this[6]=arguments[6],this[7]=arguments[7],this[8]=arguments[8],this[9]=arguments[9],this[10]=arguments[10],this[11]=arguments[11],this[12]=arguments[12],this[13]=arguments[13],this[14]=arguments[14],this[15]=arguments[15]}return this}}(),get:function(){const e=new He(0,0,0),t=new Et,n=new He(0,0,0),i=new Et,o=new He(0,0,0),r=new et,s=new et,a=new He(0,0,0);return function(u,l,c,h,d){switch(null===u&&(u=e),null===l&&(l=t),null===c&&(c=n),null===h&&(h=i),null===d&&(d=o),arguments.length){case 1:u.set(this[12],this[13],this[14]);break;case 2:this.factor(u,r,n,s),l.setMatrix(r);break;case 3:this.factor(u,r,c,s),l.setMatrix(r);break;case 4:this.factor(u,r,c,s),l.setMatrix(r),h.setMatrix(s);break;case 5:Ot.set(a.assign(d).negate()),Ot.multLeft(this),Ot.translate(d),Ot.get(u,l,c,h)}}}(),setRotation:function(e){return this.setQuaternion(e.value)},setQuaternion:function(e){const t=e.x,n=e.y,i=e.z,o=e.w,r=n*n,s=i*i,a=t*n,u=i*o,l=i*t,c=n*o,h=t*t,d=n*i,p=t*o;return this[0]=1-2*(r+s),this[1]=2*(a+u),this[2]=2*(l-c),this[3]=0,this[4]=2*(a-u),this[5]=1-2*(s+h),this[6]=2*(d+p),this[7]=0,this[8]=2*(l+c),this[9]=2*(d-p),this[10]=1-2*(r+h),this[11]=0,this[12]=0,this[13]=0,this[14]=0,this[15]=1,this},factor:function(){const e=new et,t=new et,n=new et,i={values:[],vectors:[[],[],[]]};return function(o,r,s,a){o.set(this[12],this[13],this[14]);const u=this.submatrix,l=u.determinant()<0?-1:1;n.assign(u).transpose().multLeft(u);const c=Qe(n,i);a.set(c.vectors[0][0],c.vectors[1][0],c.vectors[2][0],c.vectors[0][1],c.vectors[1][1],c.vectors[2][1],c.vectors[0][2],c.vectors[1][2],c.vectors[2][2]),s.x=l*Math.sqrt(c.values[0]),s.y=l*Math.sqrt(c.values[1]),s.z=l*Math.sqrt(c.values[2]),e[0]=1/s.x,e[4]=1/s.y,e[8]=1/s.z,r.assign(t.assign(a).transpose().multRight(e).multRight(a).multRight(u))}}(),determinant3:function(){const e=this[0],t=this[1],n=this[2],i=this[4],o=this[5],r=this[6],s=this[8],a=this[9],u=this[10];return e*(o*u-r*a)-t*(i*u-r*s)+n*(i*a-o*s)},determinant:function(){const e=this[0],t=this[1],n=this[2],i=this[3],o=this[4],r=this[5],s=this[6],a=this[7],u=this[8],l=this[9],c=this[10],h=this[11],d=this[12],p=this[13],f=this[14],g=this[15],m=c*g,_=f*h,y=s*g,x=f*a,w=s*h,v=c*a,b=n*g,S=f*i,T=n*h,E=c*i,C=n*a,O=s*i;return e*(m*r+x*l+w*p-_*r-y*l-v*p)+o*(_*t+b*l+E*p-m*t-S*l-T*p)+u*(y*t+S*r+C*p-x*t-b*r-O*p)+d*(v*t+T*r+O*l-w*t-E*r-C*l)},transpose:function(){let e;return e=this[1],this[1]=this[4],this[4]=e,e=this[2],this[2]=this[8],this[8]=e,e=this[3],this[3]=this[12],this[12]=e,e=this[6],this[6]=this[9],this[9]=e,e=this[7],this[7]=this[13],this[13]=e,e=this[11],this[11]=this[14],this[14]=e,this},inverse:function(){const e=this[0],t=this[1],n=this[2],i=this[3],o=this[4],r=this[5],s=this[6],a=this[7],u=this[8],l=this[9],c=this[10],h=this[11],d=this[12],p=this[13],f=this[14],g=this[15],m=c*g,_=f*h,y=s*g,x=f*a,w=s*h,v=c*a,b=n*g,S=f*i,T=n*h,E=c*i,C=n*a,O=s*i,N=u*p,F=d*l,M=o*p,D=d*r,I=o*l,R=u*r,V=e*p,P=d*t,A=e*l,L=u*t,U=e*r,B=o*t,X=m*r+x*l+w*p-(_*r+y*l+v*p),k=_*t+b*l+E*p-(m*t+S*l+T*p),z=y*t+S*r+C*p-(x*t+b*r+O*p),j=v*t+T*r+O*l-(w*t+E*r+C*l);let G=e*X+o*k+u*z+d*j;return G=1/G,this[0]=G*X,this[1]=G*k,this[2]=G*z,this[3]=G*j,this[4]=G*(_*o+y*u+v*d-m*o-x*u-w*d),this[5]=G*(m*e+S*u+T*d-_*e-b*u-E*d),this[6]=G*(x*e+b*o+O*d-y*e-S*o-C*d),this[7]=G*(w*e+E*o+C*u-v*e-T*o-O*u),this[8]=G*(N*a+D*h+I*g-F*a-M*h-R*g),this[9]=G*(F*i+V*h+L*g-N*i-P*h-A*g),this[10]=G*(M*i+P*a+U*g-D*i-V*a-B*g),this[11]=G*(R*i+A*a+B*h-I*i-L*a-U*h),this[12]=G*(M*c+R*f+F*s-I*f-N*s-D*c),this[13]=G*(A*f+N*n+P*c-V*c-L*f-F*n),this[14]=G*(V*s+B*f+D*n-U*f-M*n-P*s),this[15]=G*(U*c+I*n+L*s-A*s-B*c-R*n),this},multLeft:function(e){const t=this[0],n=this[1],i=this[2],o=this[3],r=this[4],s=this[5],a=this[6],u=this[7],l=this[8],c=this[9],h=this[10],d=this[11],p=this[12],f=this[13],g=this[14],m=this[15],_=e[0],y=e[1],x=e[2],w=e[3],v=e[4],b=e[5],S=e[6],T=e[7],E=e[8],C=e[9],O=e[10],N=e[11],F=e[12],M=e[13],D=e[14],I=e[15];return this[0]=t*_+r*y+l*x+p*w,this[1]=n*_+s*y+c*x+f*w,this[2]=i*_+a*y+h*x+g*w,this[3]=o*_+u*y+d*x+m*w,this[4]=t*v+r*b+l*S+p*T,this[5]=n*v+s*b+c*S+f*T,this[6]=i*v+a*b+h*S+g*T,this[7]=o*v+u*b+d*S+m*T,this[8]=t*E+r*C+l*O+p*N,this[9]=n*E+s*C+c*O+f*N,this[10]=i*E+a*C+h*O+g*N,this[11]=o*E+u*C+d*O+m*N,this[12]=t*F+r*M+l*D+p*I,this[13]=n*F+s*M+c*D+f*I,this[14]=i*F+a*M+h*D+g*I,this[15]=o*F+u*M+d*D+m*I,this},multRight:function(e){const t=this[0],n=this[1],i=this[2],o=this[3],r=this[4],s=this[5],a=this[6],u=this[7],l=this[8],c=this[9],h=this[10],d=this[11],p=this[12],f=this[13],g=this[14],m=this[15],_=e[0],y=e[1],x=e[2],w=e[3],v=e[4],b=e[5],S=e[6],T=e[7],E=e[8],C=e[9],O=e[10],N=e[11],F=e[12],M=e[13],D=e[14],I=e[15];return this[0]=t*_+n*v+i*E+o*F,this[1]=t*y+n*b+i*C+o*M,this[2]=t*x+n*S+i*O+o*D,this[3]=t*w+n*T+i*N+o*I,this[4]=r*_+s*v+a*E+u*F,this[5]=r*y+s*b+a*C+u*M,this[6]=r*x+s*S+a*O+u*D,this[7]=r*w+s*T+a*N+u*I,this[8]=l*_+c*v+h*E+d*F,this[9]=l*y+c*b+h*C+d*M,this[10]=l*x+c*S+h*O+d*D,this[11]=l*w+c*T+h*N+d*I,this[12]=p*_+f*v+g*E+m*F,this[13]=p*y+f*b+g*C+m*M,this[14]=p*x+f*S+g*O+m*D,this[15]=p*w+f*T+g*N+m*I,this},multVecMatrix:function(e){if(3===e.length){const t=e.x,n=e.y,i=e.z,o=1/(t*this[3]+n*this[7]+i*this[11]+this[15]);return e.x=(t*this[0]+n*this[4]+i*this[8]+this[12])*o,e.y=(t*this[1]+n*this[5]+i*this[9]+this[13])*o,e.z=(t*this[2]+n*this[6]+i*this[10]+this[14])*o,e}const t=e.x,n=e.y,i=e.z,o=e.w;return e.x=t*this[0]+n*this[4]+i*this[8]+o*this[12],e.y=t*this[1]+n*this[5]+i*this[9]+o*this[13],e.z=t*this[2]+n*this[6]+i*this[10]+o*this[14],e.w=t*this[3]+n*this[7]+i*this[11]+o*this[15],e},multMatrixVec:function(e){if(3===e.length){const t=e.x,n=e.y,i=e.z,o=1/(t*this[12]+n*this[13]+i*this[14]+this[15]);return e.x=(t*this[0]+n*this[1]+i*this[2]+this[3])*o,e.y=(t*this[4]+n*this[5]+i*this[6]+this[7])*o,e.z=(t*this[8]+n*this[9]+i*this[10]+this[11])*o,e}const t=e.x,n=e.y,i=e.z,o=e.w;return e.x=t*this[0]+n*this[1]+i*this[2]+o*this[3],e.y=t*this[4]+n*this[5]+i*this[6]+o*this[7],e.z=t*this[8]+n*this[9]+i*this[10]+o*this[11],e.w=t*this[12]+n*this[13]+i*this[14]+o*this[15],e},multDirMatrix:function(e){const t=e.x,n=e.y,i=e.z;return e.x=t*this[0]+n*this[4]+i*this[8],e.y=t*this[1]+n*this[5]+i*this[9],e.z=t*this[2]+n*this[6]+i*this[10],e},multMatrixDir:function(e){const t=e.x,n=e.y,i=e.z;return e.x=t*this[0]+n*this[1]+i*this[2],e.y=t*this[4]+n*this[5]+i*this[6],e.z=t*this[8]+n*this[9]+i*this[10],e},identity:function(){this[0]=1,this[1]=0,this[2]=0,this[3]=0,this[4]=0,this[5]=1,this[6]=0,this[7]=0,this[8]=0,this[9]=0,this[10]=1,this[11]=0,this[12]=0,this[13]=0,this[14]=0,this[15]=1},translate:function(e){const t=e.x,n=e.y,i=e.z;return this[12]+=this[0]*t+this[4]*n+this[8]*i,this[13]+=this[1]*t+this[5]*n+this[9]*i,this[14]+=this[2]*t+this[6]*n+this[10]*i,this},rotate:function(e){return this.multLeft(Ot.setQuaternion(e.value)),this},scale:function(e){const t=e.x,n=e.y,i=e.z;return this[0]*=t,this[4]*=n,this[8]*=i,this[1]*=t,this[5]*=n,this[9]*=i,this[2]*=t,this[6]*=n,this[10]*=i,this},getDepth:function(e){const t=e.x,n=e.y,i=e.z,o=1/(t*this[3]+n*this[7]+i*this[11]+this[15]);return(t*this[2]+n*this[6]+i*this[10]+this[14])*o},toString:function(){return this[0]+" "+this[1]+" "+this[2]+" "+this[3]+" "+this[4]+" "+this[5]+" "+this[6]+" "+this[7]+" "+this[8]+" "+this[9]+" "+this[10]+" "+this[11]+" "+this[12]+" "+this[13]+" "+this[14]+" "+this[15]}},Object.defineProperty(Ct.prototype,"x",{get:function(){const e=new st(0,0,0,0);return function(){return e.set(this[0],this[1],this[2],this[3])}}(),enumerable:!1,configurable:!1}),Object.defineProperty(Ct.prototype,"y",{get:function(){const e=new st(0,0,0,0);return function(){return e.set(this[4],this[5],this[6],this[7])}}(),enumerable:!1,configurable:!1}),Object.defineProperty(Ct.prototype,"z",{get:function(){const e=new st(0,0,0,0);return function(){return e.set(this[8],this[9],this[10],this[11])}}(),enumerable:!1,configurable:!1}),Object.defineProperty(Ct.prototype,"w",{get:function(){const e=new st(0,0,0,0);return function(){return e.set(this[12],this[13],this[14],this[15])}}(),enumerable:!1,configurable:!1}),Object.defineProperty(Ct.prototype,"xAxis",{get:function(){const e=new He(0,0,0);return function(){return e.set(this[0],this[1],this[2])}}(),enumerable:!1,configurable:!1}),Object.defineProperty(Ct.prototype,"yAxis",{get:function(){const e=new He(0,0,0);return function(){return e.set(this[4],this[5],this[6])}}(),enumerable:!1,configurable:!1}),Object.defineProperty(Ct.prototype,"zAxis",{get:function(){const e=new He(0,0,0);return function(){return e.set(this[8],this[9],this[10])}}(),enumerable:!1,configurable:!1}),Object.defineProperty(Ct.prototype,"origin",{get:function(){const e=new He(0,0,0);return function(){return e.set(this[12],this[13],this[14])}}(),enumerable:!1,configurable:!1}),Object.defineProperty(Ct.prototype,"submatrix",{get:function(){const e=new et;return function(){return e[0]=this[0],e[1]=this[1],e[2]=this[2],e[3]=this[4],e[4]=this[5],e[5]=this[6],e[6]=this[8],e[7]=this[9],e[8]=this[10],e}}(),enumerable:!1,configurable:!1}),Object.assign(Ct,{Identity:new Ct,Rotation:function(e){return Object.create(this.prototype).setQuaternion(e.value)},Quaternion:function(e){return Object.create(this.prototype).setQuaternion(e)},Matrix3:function(e){return new Ct(e[0],e[1],e[2],0,e[3],e[4],e[5],0,e[6],e[7],e[8],0,0,0,0,1)},transpose:function(e){return e.copy().transpose()},inverse:function(e){return e.copy().inverse()},multLeft:function(e,t){return e.copy().multLeft(t)},multRight:function(e,t){return e.copy().multRight(t)}});const Ot=new Ct,Nt=Ct;function Ft(e,t,n,i){function o(e,t,n,i,o,r,s,a,u,l,c,h,d,p,f,g){switch(arguments.length){case 0:return Z.call(this,new Nt);case 1:return Z.call(this,arguments[0]);case 16:return Z.call(this,new Nt(+e,+t,+n,+i,+o,+r,+s,+a,+u,+l,+c,+h,+d,+p,+f,+g))}throw new Error("Invalid arguments.")}o.prototype=Object.assign(Object.create(Z.prototype),Ue(Nt,n,i),{constructor:o,getTypeName:function(){return e},getType:function(){return t}});for(const e of Reflect.ownKeys(o.prototype))Object.defineProperty(o.prototype,e,{enumerable:!1});function r(e){Object.defineProperty(o.prototype,e,{get:function(){return this.getValue()[e]},set:function(t){this.getValue()[e]=t,this.addEvent()},enumerable:!0,configurable:!1})}for(let e=0,t=Nt.prototype.length;e<t;++e)r(e);return o}const Mt={SFMatrix4d:Ft("SFMatrix4d",s.SFMatrix4d,ot.SFVec3d,!0),SFMatrix4f:Ft("SFMatrix4f",s.SFMatrix4f,ot.SFVec3f,!1),VrmlMatrix:Ft("VrmlMatrix",s.VrmlMatrix,ot.SFVec3f,!1)},Dt=new WeakMap;function It(){}It.prototype={get:function(e){const t=Dt.get(e);if(t)return t;{const t=new Bt(e);return Dt.set(e,t),t}}};const Rt=new It,Vt=Symbol(),Pt=Symbol(),At=Symbol(),Lt={get:function(e,t){try{const n=e[t];if(void 0!==n)return n;const i=e.getValue().getField(t);if(i.getAccessType()===s.inputOnly)return;return i.valueOf()}catch(e){return}},set:function(e,t,n){if(t in e)return e[t]=n,!0;try{const i=e.getValue().getField(t);return i.getAccessType()!==s.outputOnly&&i.setValue(n),!0}catch(n){return console.error(e,t,n),!1}},has:function(e,t){try{return Boolean(e.getValue().getField(t))}catch(n){return t in e}},ownKeys:function(e){const t=e.getValue(),n=[];if(t)for(const e of t.getFieldDefinitions())n.push(e.name);return n},getOwnPropertyDescriptor:function(e,t){const n=e.getValue();if(n){const i=n.getFieldDefinitions().get(t);if(i)return{value:this.get(e,t),writable:i.accessType!==s.outputOnly,enumerable:!0,configurable:!0}}}};function Ut(e){const t=new Proxy(this,Lt);return this[Vt]=this,this[Pt]=t,e?(e.addParent(t),Z.call(this,e)):Z.call(this,null),t}Ut.prototype=Object.assign(Object.create(Z.prototype),{constructor:Ut,[Vt]:null,[Pt]:null,[At]:0,copy:function(e){const t=this[Vt].getValue();return t?new Ut(e?t.copy(e):t):new Ut},getTypeName:function(){return"SFNode"},getType:function(){return s.SFNode},equals:function(e){const t=this[Vt];return e?t.getValue()===e.getValue():null===t.getValue()},isDefaultValue:function(){return null===this[Vt].getValue()},set:function(e){const t=this[Vt],n=t.getValue();n&&(n.removeCloneCount(t[At]),n.removeParent(t[Pt])),e?(e.addParent(t[Pt]),e.addCloneCount(t[At]),Z.prototype.set.call(t,e)):Z.prototype.set.call(t,null)},getNodeTypeName:function(){const e=this[Vt].getValue();if(e)return e.getTypeName();throw new Error("SFNode.getNodeTypeName: node is null.")},getNodeName:function(){const e=this[Vt].getValue();if(e)return e.getName();throw new Error("SFNode.getNodeName: node is null.")},getNodeDisplayName:function(){const e=this[Vt].getValue();if(e)return e.getDisplayName();throw new Error("SFNode.getNodeDisplayName: node is null.")},getNodeType:function(){const e=this[Vt].getValue();if(e)return e.getType().slice();throw new Error("SFNode.getNodeType: node is null.")},getFieldDefinitions:function(){const e=this[Vt].getValue();if(e)return e.getFieldDefinitions();throw new Error("SFNode.getFieldDefinitions: node is null.")},addFieldCallback:function(e,t,n){const i=this[Vt];switch(arguments.length){case 2:return Z.prototype.addFieldCallback.apply(i,arguments);case 3:{const o=i.getValue();if(o)return o.getField(e).addFieldCallback(t,n);throw new Error("SFNode.addFieldCallback: node is null.")}}},removeFieldCallback:function(e,t){const n=this[Vt];switch(arguments.length){case 1:return Z.prototype.removeFieldCallback.apply(n,arguments);case 2:{const i=n.getValue();if(i)return i.getField(e).removeFieldCallback(t);throw new Error("SFNode.removeFieldCallback: node is null.")}}},addCloneCount:function(e){const t=this[Vt],n=t.getValue();t[At]+=e,n&&n.addCloneCount(e)},removeCloneCount:function(e){const t=this[Vt],n=t.getValue();t[At]-=e,n&&n.removeCloneCount(e)},valueOf:function(){const e=this[Vt].getValue();return e?Rt.get(e):null},toStream:function(e){const t=this[Vt].getValue();t?t.toStream(e):e.string+="NULL"},toVRMLStream:function(e){const t=this[Vt].getValue();t?t.toVRMLStream(e):e.string+="NULL"},toXMLString:function(){const e=this[Vt],t={string:""},n=u.Get(t),i=e.getValue();return n.PushExecutionContext(i.getExecutionContext()),e.toXMLStream(t),n.PopExecutionContext(),t.string},toXMLStream:function(e){const t=this[Vt].getValue();t?t.toXMLStream(e):e.string+="\x3c!-- NULL --\x3e"},dispose:function(){const e=this[Vt],t=e.getValue();t&&t.dispose(),Z.prototype.dispose.call(e)}});for(const e of Reflect.ownKeys(Ut.prototype))Object.defineProperty(Ut.prototype,e,{enumerable:!1});const Bt=Ut,Xt=ot.SFVec3f;function kt(e,t,n,i){switch(arguments.length){case 0:return Z.call(this,new Et);case 1:return Z.call(this,arguments[0]);case 2:return arguments[1]instanceof Xt?Z.call(this,new Et(arguments[0].getValue(),arguments[1].getValue())):Z.call(this,new Et(arguments[0].getValue(),+arguments[1]));case 4:return Z.call(this,new Et(+e,+t,+n,+i))}throw new Error("Invalid arguments.")}kt.prototype=Object.assign(Object.create(Z.prototype),{constructor:kt,[Symbol.iterator]:function*(){yield*this.getValue()},copy:function(){return new kt(this.getValue().copy())},equals:function(e){return this.getValue().equals(e.getValue())},isDefaultValue:function(){return this.getValue().equals(Et.Identity)},getTypeName:function(){return"SFRotation"},getType:function(){return s.SFRotation},set:function(e){this.getValue().assign(e)},setAxis:function(e){this.getValue().setAxis(e.getValue()),this.addEvent()},getAxis:function(){return new Xt(this.getValue().getAxis().copy())},inverse:function(){return new kt(Et.inverse(this.getValue()))},multiply:function(e){return new kt(Et.multRight(this.getValue(),e.getValue()))},multVec:function(e){return new Xt(this.getValue().multVecRot(e.getValue().copy()))},slerp:function(e,t){return new kt(Et.slerp(this.getValue(),e.getValue(),t))},toStream:function(e){const t=u.Get(e),n=this.getValue();e.string+=t.DoublePrecision(n.x)+" "+t.DoublePrecision(n.y)+" "+t.DoublePrecision(n.z)+" "+t.DoublePrecision(t.ToUnit("angle",n.angle))},toVRMLStream:function(e){this.toStream(e)},toXMLStream:function(e){this.toStream(e)}});for(const e of Reflect.ownKeys(kt.prototype))Object.defineProperty(kt.prototype,e,{enumerable:!1});const zt={get:function(){return this.getValue().x},set:function(e){this.getValue().x=+e,this.addEvent()},enumerable:!0,configurable:!1},jt={get:function(){return this.getValue().y},set:function(e){this.getValue().y=+e,this.addEvent()},enumerable:!0,configurable:!1},Gt={get:function(){return this.getValue().z},set:function(e){this.getValue().z=+e,this.addEvent()},enumerable:!0,configurable:!1},Ht={get:function(){return this.getValue().angle},set:function(e){this.getValue().angle=+e,this.addEvent()},enumerable:!0,configurable:!1};Object.defineProperty(kt.prototype,"x",zt),Object.defineProperty(kt.prototype,"y",jt),Object.defineProperty(kt.prototype,"z",Gt),Object.defineProperty(kt.prototype,"angle",Ht),zt.enumerable=!1,jt.enumerable=!1,Gt.enumerable=!1,Ht.enumerable=!1,Object.defineProperty(kt.prototype,"0",zt),Object.defineProperty(kt.prototype,"1",jt),Object.defineProperty(kt.prototype,"2",Gt),Object.defineProperty(kt.prototype,"3",Ht);const qt=kt,Wt=/\\(.)/g,Yt=/([\\"])/g;function Kt(e){return Z.call(this,arguments.length?""+e:"")}Object.assign(Kt,{unescape:function(e){return e.replace(Wt,"$1")},escape:function(e){return e.replace(Yt,"\\$1")}}),Kt.prototype=Object.assign(Object.create(Z.prototype),{constructor:Kt,[Symbol.iterator]:function*(){yield*this.getValue()},copy:function(){return new Kt(this.getValue())},getTypeName:function(){return"SFString"},getType:function(){return s.SFString},isDefaultValue:function(){return""===this.getValue()},set:function(e){Z.prototype.set.call(this,""+e)},valueOf:Z.prototype.getValue,toStream:function(e){e.string+='"'+Kt.escape(this.getValue())+'"'},toVRMLStream:function(e){this.toStream(e)},toXMLStream:function(e){e.string+=u.Get(e).XMLEncode(this.getValue())}});for(const e of Reflect.ownKeys(Kt.prototype))Object.defineProperty(Kt.prototype,e,{enumerable:!1});Object.defineProperty(Kt.prototype,"length",{get:function(){return this.getValue().length},enumerable:!0,configurable:!1});const Zt=Kt;function Qt(e){return Z.call(this,arguments.length?+e:0)}Qt.prototype=Object.assign(Object.create(Z.prototype),{constructor:Qt,copy:function(){return new Qt(this.getValue())},getTypeName:function(){return"SFTime"},getType:function(){return s.SFTime},isDefaultValue:function(){return 0===this.getValue()},set:function(e){Z.prototype.set.call(this,+e)},valueOf:Z.prototype.getValue,toStream:function(e){e.string+=this.getValue()},toVRMLStream:function(e){this.toStream(e)},toXMLStream:function(e){this.toStream(e)}});for(const e of Reflect.ownKeys(Qt.prototype))Object.defineProperty(Qt.prototype,e,{enumerable:!1});const $t=Qt;function Jt(e,t,n){function i(e,t,n,i){switch(arguments.length){case 0:return Z.call(this,new st(0,0,0,0));case 1:return Z.call(this,arguments[0]);case 4:return Z.call(this,new st(+e,+t,+n,+i))}throw new Error("Invalid arguments.")}i.prototype=Object.assign(Object.create(Z.prototype),Be(st,n),{constructor:i,getTypeName:function(){return e},getType:function(){return t}});for(const e of Reflect.ownKeys(i.prototype))Object.defineProperty(i.prototype,e,{enumerable:!1});const o={get:function(){return this.getValue().x},set:function(e){this.getValue().x=+e,this.addEvent()},enumerable:!0,configurable:!1},r={get:function(){return this.getValue().y},set:function(e){this.getValue().y=+e,this.addEvent()},enumerable:!0,configurable:!1},s={get:function(){return this.getValue().z},set:function(e){this.getValue().z=+e,this.addEvent()},enumerable:!0,configurable:!1},a={get:function(){return this.getValue().w},set:function(e){this.getValue().w=+e,this.addEvent()},enumerable:!0,configurable:!1};return Object.defineProperty(i.prototype,"x",o),Object.defineProperty(i.prototype,"y",r),Object.defineProperty(i.prototype,"z",s),Object.defineProperty(i.prototype,"w",a),o.enumerable=!1,r.enumerable=!1,s.enumerable=!1,a.enumerable=!1,Object.defineProperty(i.prototype,"0",o),Object.defineProperty(i.prototype,"1",r),Object.defineProperty(i.prototype,"2",s),Object.defineProperty(i.prototype,"3",a),i}const en={SFVec4d:Jt("SFVec4d",s.SFVec4d,!0),SFVec4f:Jt("SFVec4f",s.SFVec4f,!1)};function tn(e){Z.call(this,e)}tn.prototype=Object.assign(Object.create(Z.prototype),{constructor:tn,at:Array.prototype.at,concat:Array.prototype.concat,every:Array.prototype.every,fill:Array.prototype.fill,filter:Array.prototype.filter,find:Array.prototype.find,findIndex:Array.prototype.findIndex,forEach:Array.prototype.forEach,includes:Array.prototype.includes,indexOf:Array.prototype.indexOf,join:Array.prototype.join,keys:function(){return Array(this.length).keys()},lastIndexOf:Array.prototype.lastIndexOf,map:Array.prototype.map,reduce:Array.prototype.reduce,reduceRight:Array.prototype.reduceRight,slice:Array.prototype.slice,some:Array.prototype.some,values:function(){return this[Symbol.iterator]}});for(const e of Reflect.ownKeys(tn.prototype))Object.defineProperty(tn.prototype,e,{enumerable:!1});const nn=tn,on=Symbol(),rn=Symbol(),sn={get:function(e,t){const n=e[t];if(void 0!==n)return n;if("string"==typeof t){const n=e.getValue(),i=+t;return Number.isInteger(i)?(i>=n.length&&e.resize(i+1),n[i].valueOf()):e[t]}},set:function(e,t,n){if(t in e)return e[t]=n,!0;const i=e.getValue(),o=+t;return o>=i.length&&e.resize(o+1),i[o].setValue(n),!0},has:function(e,t){return Number.isInteger(+t)?t<e.getValue().length:t in e},ownKeys:function(e){return Object.keys(e.getValue())},getOwnPropertyDescriptor:function(e,t){if("string"!=typeof t)return;const n=+t;return Number.isInteger(n)&&n<e.getValue().length?Object.getOwnPropertyDescriptor(e.getValue(),t):void 0}};function an(e){const t=new Proxy(this,sn);return nn.call(this,[]),this[on]=this,this[rn]=t,e[0]instanceof Array&&(e=e[0]),an.prototype.push.apply(this,e),t}an.prototype=Object.assign(Object.create(nn.prototype),{constructor:an,[on]:null,[rn]:null,[Symbol.iterator]:function*(){const e=this[on].getValue();for(const t of e)yield t.valueOf()},getTarget:function(){return this[on]},copy:function(){const e=this[on],t=e.create(),n=e.getValue();return an.prototype.push.apply(t,n),t.setModificationTime(0),t},equals:function(e){const t=this[on].getValue(),n=e.getValue(),i=t.length;if(t===n)return!0;if(i!==n.length)return!1;for(let e=0;e<i;++e)if(!t[e].equals(n[e]))return!1;return!0},set:function(e){const t=this[on];t.resize(e.length,void 0,!0);const n=t.getValue();for(let t=0,i=e.length;t<i;++t)n[t].set(e[t]instanceof Z?e[t].getValue():e[t])},isDefaultValue:function(){return 0===this.length},setValue:function(e){const t=this[on];t.set(e instanceof an?e.getValue():e),t.addEvent()},unshift:function(e){const t=this[on],n=t.getValue();for(let e=arguments.length-1;e>=0;--e){const i=new(t.getSingleType());i.setValue(arguments[e]),t.addChildObject(i),n.unshift(i)}return t.addEvent(),n.length},shift:function(){const e=this[on],t=e.getValue();if(t.length){const n=t.shift();return e.removeChildObject(n),e.addEvent(),n.valueOf()}},push:function(e){const t=this[on],n=t.getValue();for(const e of arguments){const i=new(t.getSingleType());i.setValue(e),t.addChildObject(i),n.push(i)}return t.addEvent(),n.length},pop:function(){const e=this[on],t=e.getValue();if(t.length){const n=t.pop();return e.removeChildObject(n),e.addEvent(),n.valueOf()}},splice:function(e,t){const n=this[on],i=n.getValue();e>i.length&&(e=i.length),e+t>i.length&&(t=i.length-e);const o=n.erase(e,e+t);return arguments.length>2&&n.insert(e,arguments,2,arguments.length),o},insert:function(e,t,n,i){const o=this[on],r=[e,0];for(let e=n;e<i;++e){const n=new(o.getSingleType());n.setValue(t[e]),o.addChildObject(n),r.push(n)}Array.prototype.splice.apply(o.getValue(),r),o.addEvent()},find:function(e,t,n){const i=this[on].getValue();if("function"==typeof n){for(let o=e;o<t;++o)if(n(i[o].valueOf()))return o;return t}for(let o=e;o<t;++o)if(i[o].equals(n))return o;return t},remove:function(e,t,n){const i=this[on],o=i.getValue();if("function"==typeof n){if((e=i.find(e,t,n))!==t)for(let i=e;++i<t;){const t=o[i];if(!n(t.valueOf())){const n=o[e];o[e++]=t,o[i]=n}}return e!==t&&i.addEvent(),e}if((e=i.find(e,t,n))!==t)for(let i=e;++i<t;){const t=o[i];if(!t.equals(n)){const n=o[e];o[e++]=t,o[i]=n}}return e!==t&&i.addEvent(),e},erase:function(e,t){const n=this[on],i=n.getValue().splice(e,t-e);for(const e of i)n.removeChildObject(e);return n.addEvent(),i.map((function(e){return e.valueOf()}))},resize:function(e,t,n){const i=this[on],o=i.getValue();if(e<o.length){for(let t=e,n=o.length;t<n;++t)i.removeChildObject(o[t]);o.length=e,n||i.addEvent()}else if(e>o.length){for(let n=o.length;n<e;++n){const e=new(i.getSingleType());void 0!==t&&e.setValue(t),i.addChildObject(e),o.push(e)}n||i.addEvent()}},addChildObject:function(e){e.addParent(this[rn])},removeChildObject:function(e){e.removeParent(this[rn])},toStream:function(e){const t=this[on],n=t.getValue(),i=u.Get(e);switch(n.length){case 0:e.string+="[ ]";break;case 1:i.PushUnitCategory(t.getUnit()),n[0].toStream(e),i.PopUnitCategory();break;default:i.PushUnitCategory(t.getUnit()),e.string+="[\n",i.IncIndent();for(let t=0,o=n.length-1;t<o;++t)e.string+=i.Indent(),n[t].toStream(e),e.string+=",\n";e.string+=i.Indent(),n.at(-1).toStream(e),e.string+="\n",i.DecIndent(),e.string+=i.Indent(),e.string+="]",i.PopUnitCategory()}},toVRMLStream:function(e){this.toStream(e)},toXMLStream:function(e){const t=this[on];if(t.length){const n=u.Get(e),i=t.getValue();n.PushUnitCategory(t.getUnit());for(const t of i)t.toXMLStream(e),e.string+=", ";i.at(-1).toXMLStream(e),n.PopUnitCategory()}},dispose:function(){const e=this[on],t=e.getValue();for(const n of t)e.removeChildObject(n);t.length=0,nn.prototype.dispose.call(e)}});for(const e of Reflect.ownKeys(an.prototype))Object.defineProperty(an.prototype,e,{enumerable:!1});Object.defineProperty(an.prototype,"length",{get:function(){return this[on].getValue().length},set:function(e){this[on].resize(e)},enumerable:!1,configurable:!1});const un=an,ln=Symbol(),cn=Symbol(),hn=Symbol(),dn={get:function(e,t){const n=e[t];if(void 0!==n)return n;if("string"==typeof t){const n=+t;if(Number.isInteger(n)){const t=e.getComponents(),i=e.getValueType();let o=e.getValue();if(n>=e[hn]&&(o=e.resize(n+1)),1===t)return i(o[n]);{const o=new i,r=o.getValue(),s=n*t;return o.addEvent=gn.bind(e,s,r,t),o.getValue=fn.bind(e,s,r,t),o}}return e[t]}},set:function(e,t,n){if(t in e)return e[t]=n,!0;const i=e.getComponents();let o=+t,r=e.getValue();if(o>=e[hn]&&(r=e.resize(o+1)),1===i)r[o]=n;else{o*=i;for(let e=0;e<i;++e,++o)r[o]=n[e]}return e.addEvent(),!0},has:function(e,t){return Number.isInteger(+t)?t<e[hn]:t in e},ownKeys:function(e){const t=[];for(let n=0,i=e[hn];n<i;++n)t.push(String(n));return t},getOwnPropertyDescriptor:function(e,t){if("string"!=typeof t)return;const n=+t;return Number.isInteger(n)&&n<e[hn]?Object.getOwnPropertyDescriptor(e.getValue(),t):void 0}};function pn(e){return nn.call(this,new(this.getArrayType())(2)),this[ln]=this,this[cn]=[],e[0]instanceof Array&&(e=e[0]),pn.prototype.push.apply(this,e),new Proxy(this,dn)}pn.prototype=Object.assign(Object.create(nn.prototype),{constructor:pn,[ln]:null,[cn]:null,[hn]:0,[Symbol.iterator]:function*(){const e=this[ln],t=e.getValue(),n=e.getComponents(),i=e.getValueType(),o=e[hn];if(1===n)for(let e=0;e<o;++e)yield i(t[e]);else for(let t=0;t<o;++t){const o=new i,r=o.getValue(),s=t*n;o.addEvent=gn.bind(e,s,r,n),o.getValue=fn.bind(e,s,r,n),yield o}},getTarget:function(){return this[ln]},copy:function(){const e=this[ln],t=e.getValue(),n=e.create(),i=new(e.getArrayType())(t);return n[hn]=e[hn],nn.prototype.set.call(n,i,e[hn]),n.setModificationTime(0),n},equals:function(e){if(this===e)return!0;const t=this[ln],n=t[hn];if(n!==e[hn])return!1;const i=t.getValue(),o=e.getValue();for(let e=0,r=n*t.getComponents();e<r;++e)if(i[e]!==o[e])return!1;return!0},assign:function(e){const t=this[ln];t.set(e.getValue(),e.length),t.addEvent()},set:function(e,t){const n=this[ln],i=n.getComponents(),o=n[hn];let r=n.getValue(),s=void 0!==t?t*i:e.length;const a=s%i;a&&(s-=a,console.warn("Array length must be multiple of components size, which is "+i+".")),s/=i,r.length<e.length?(r=n.grow(e.length),r.set(e),a&&r.fill(0,s*i,s*i+a)):(r.set(e),s<o&&r.fill(0,s*i,o*i)),n[hn]=s},isDefaultValue:function(){return 0===this[hn]},setValue:function(e){const t=this[ln];e instanceof t.constructor?t.assign(e):(t.set(e),t.addEvent())},unshift:function(e){const t=this[ln],n=t.getComponents(),i=t[hn],o=arguments.length,r=t.grow((i+o)*n);if(r.copyWithin(o*n,0,i*n),1===n)r.set(arguments,0);else for(let e=0,t=0;t<o;++t){const i=arguments[t];for(let t=0;t<n;++t,++e)r[e]=i[t]}return t[hn]+=o,t.addEvent(),r.length},shift:function(){const e=this[ln],t=e[hn];if(t){const i=e.getValue(),o=e.getComponents(),r=e.getValueType(),s=t-1;if(1===o)var n=r(i[0]);else{const t=e[cn];for(let e=0;e<o;++e)t[e]=i[e];n=Object.create(r.prototype);r.apply(n,t)}return i.copyWithin(0,o,t*o),i.fill(0,o*s,t*o),e[hn]=s,e.addEvent(),n}},push:function(e){const t=this[ln],n=t.getComponents(),i=t[hn],o=arguments.length,r=t.grow((i+o)*n);if(1===n)r.set(arguments,i);else for(let e=i*n,t=0;t<o;++t){const i=arguments[t];for(let t=0;t<n;++t,++e)r[e]=i[t]}return t[hn]+=o,t.addEvent(),t[hn]},pop:function(){const e=this[ln],t=e[hn];if(t){const i=e.getValue(),o=e.getComponents(),r=e.getValueType(),s=t-1;if(1===o)var n=r(i[t-1]);else{const t=e[cn];for(let e=0,n=s*o;e<o;++e,++n)t[e]=i[n];n=Object.create(r.prototype);r.apply(n,t)}return i.fill(0,s*o,t*o),e[hn]=s,e.addEvent(),n}},splice:function(e,t){const n=this[ln],i=n[hn];e>i&&(e=i),e+t>i&&(t=i-e);const o=n.erase(e,e+t);return arguments.length>2&&n.spliceInsert(e,Array.prototype.splice.call(arguments,2)),n.addEvent(),o},spliceInsert:function(e,t){const n=this[ln],i=n.getComponents(),o=n[hn],r=t.length,s=n.grow((o+r)*i);if(e*=i,s.copyWithin(e+r*i,e,o*i),1===i)s.set(t,e);else for(let n=0,o=e;n<r;++n){const e=t[n];for(let t=0;t<i;++t,++o)s[o]=e[t]}n[hn]+=r},insert:function(e,t,n,i){const o=this[ln],r=o[hn],s=t.getValue(),a=o.getComponents(),u=i-n,l=o.grow((r+u)*a);for(e*=a,n*=a,i*=a,l.copyWithin(e+u*a,e,r*a);n<i;++e,++n)l[e]=s[n];o[hn]+=u,o.addEvent()},erase:function(e,t){const n=this[ln],i=n.getValue(),o=n.getComponents(),r=t-e,s=n[hn],a=s-r,u=n.create(),l=u.grow(r*o);t*=o;for(let n=0,r=e*=o;r<t;++n,++r)l[n]=i[r];return i.copyWithin(e,t,s*o),i.fill(0,a*o,s*o),n[hn]=a,u[hn]=r,n.addEvent(),u.slice()},resize:function(e,t,n){const i=this[ln],o=i[hn],r=i.getComponents();let s=i.getValue();if(e<o)s.fill(0,e*r,o*r),n||i.addEvent();else if(e>o){if(s=i.grow(e*r),void 0!==t)if(1===r)s.fill(t,o*r,e*r);else for(let n=o*r,i=e*r;n<i;)for(let e=0;e<r;++e,++n)s[n]=t[e];n||i.addEvent()}return i[hn]=e,s},grow:function(e){const t=this[ln],n=t.getValue();if(e<n.length)return n;const i=ee.nextPowerOfTwo(e),o=new(t.getArrayType())(i);return o.set(n),nn.prototype.set.call(t,o),o},shrinkToFit:function(){const e=this[ln],t=e.getValue(),n=e[hn]*e.getComponents();if(t.length==n)return t;const i=t.subarray(0,n);return nn.prototype.set.call(e,i),i},toStream:function(e){const t=this[ln],n=u.Get(e),i=t.getValue(),o=t[hn],r=t.getComponents(),s=new(t.getSingleType());switch(o){case 0:e.string+="[ ]";break;case 1:if(n.PushUnitCategory(t.getUnit()),1===r)s.set(i[0]),s.toStream(e);else{for(let e=0,t=0;e<r;++e,++t)s[e]=i[t];s.toStream(e)}n.PopUnitCategory();break;default:if(n.PushUnitCategory(t.getUnit()),e.string+="[\n",n.IncIndent(),1===r){for(let t=0,a=o-1;t<a;++t)e.string+=n.Indent(),s.set(i[t*r]),s.toStream(e),e.string+=",\n";e.string+=n.Indent(),s.set(i[(o-1)*r]),s.toStream(e),e.string+="\n"}else{for(let t=0,a=o-1;t<a;++t){e.string+=n.Indent();for(let e=0,n=t*r;e<r;++e,++n)s[e]=i[n];s.toStream(e),e.string+=",\n"}e.string+=n.Indent();for(let e=0,t=(o-1)*r;e<r;++e,++t)s[e]=i[t];s.toStream(e),e.string+="\n"}n.DecIndent(),e.string+=n.Indent(),e.string+="]",n.PopUnitCategory()}},toVRMLStream:function(e){this.toStream(e)},toXMLStream:function(e){const t=this[ln],n=t[hn];if(n){const i=u.Get(e),o=t.getValue(),r=t.getComponents(),s=new(t.getSingleType());if(i.PushUnitCategory(t.getUnit()),1===r){for(let t=0,i=n-1;t<i;++t)s.set(o[t*r]),s.toXMLStream(e),e.string+=", ";s.set(o[(n-1)*r]),s.toXMLStream(e)}else{for(let t=0,i=n-1;t<i;++t){for(let e=0,n=t*r;e<r;++e,++n)s[e]=o[n];s.toXMLStream(e),e.string+=", "}for(let e=0,t=(n-1)*r;e<r;++e,++t)s[e]=o[t];s.toXMLStream(e)}i.PopUnitCategory()}},dispose:function(){nn.prototype.dispose.call(this[ln])}});for(const e of Reflect.ownKeys(pn.prototype))Object.defineProperty(pn.prototype,e,{enumerable:!1});function fn(e,t,n){const i=this.getValue(),o=this[cn];for(let t=0;t<n;++t,++e)o[t]=i[e];return t.set.apply(t,o),t}function gn(e,t,n){const i=this.getValue();for(let o=0;o<n;++o,++e)i[e]=t[o];this.addEvent()}Object.defineProperty(pn.prototype,"length",{get:function(){return this[hn]},set:function(e){this[ln].resize(e)},enumerable:!1,configurable:!1});const mn=pn,_n=nt.SFMatrix3d,yn=nt.SFMatrix3f,xn=Mt.SFMatrix4d,wn=Mt.SFMatrix4f,vn=je.SFVec2d,bn=je.SFVec2f,Sn=ot.SFVec3d,Tn=ot.SFVec3f,En=en.SFVec4d,Cn=en.SFVec4f,On=Symbol();function Nn(e){return un.call(this,arguments)}Nn.prototype=Object.assign(Object.create(un.prototype),{constructor:Nn,[On]:0,getSingleType:function(){return Bt},getValueType:function(){return Bt},getArrayType:function(){return Array},getComponents:function(){return 1},getTypeName:function(){return"MFNode"},getType:function(){return s.MFNode},copy:function(e){if(e){const t=new Nn;for(const n of this.getValue())t.push(n.copy(e));return t.setModificationTime(0),t}return un.prototype.copy.call(this)},addCloneCount:function(e){this[On]+=e;for(const t of this.getValue())t.addCloneCount(e)},removeCloneCount:function(e){this[On]-=e;for(const t of this.getValue())t.removeCloneCount(e)},addChildObject:function(e){un.prototype.addChildObject.call(this,e),e.addCloneCount(this[On])},removeChildObject:function(e){un.prototype.removeChildObject.call(this,e),e.removeCloneCount(this[On])},toStream:function(e){const t=this.getTarget(),n=t.getValue(),i=u.Get(e);switch(n.length){case 0:e.string+="[ ]";break;case 1:i.PushUnitCategory(t.getUnit()),n[0].toStream(e),i.PopUnitCategory();break;default:i.PushUnitCategory(t.getUnit()),e.string+="[\n",i.IncIndent();for(let t=0,o=n.length;t<o;++t)e.string+=i.Indent(),n[t].toStream(e),e.string+="\n";i.DecIndent(),e.string+=i.Indent(),e.string+="]",i.PopUnitCategory()}},toVRMLString:function(){this.addCloneCount(1);const e=un.prototype.toVRMLString.call(this);return this.removeCloneCount(1),e},toVRMLStream:function(e){const t=this.getTarget().getValue(),n=u.Get(e);switch(t.length){case 0:e.string+="[ ]";break;case 1:n.EnterScope(),t[0].toVRMLStream(e),n.LeaveScope();break;default:n.EnterScope(),e.string+="[\n",n.IncIndent();for(const i of t)e.string+=n.Indent(),i.toVRMLStream(e),e.string+="\n";n.DecIndent(),e.string+=n.Indent(),e.string+="]",n.LeaveScope()}},toXMLString:function(){this.addCloneCount(1);const e=un.prototype.toXMLString.call(this);return this.removeCloneCount(1),e},toXMLStream:function(e){const t=u.Get(e),n=this.length;if(n){t.EnterScope();const i=this.getValue();for(let o=0,r=n-1;o<r;++o){const n=i[o].getValue();if(n)n.toXMLStream(e),e.string+="\n";else{e.string+=t.Indent(),e.string+="<",e.string+="NULL";const n=t.ContainerField();n&&(e.string+=" ",e.string+="containerField='",e.string+=t.XMLEncode(n.getName()),e.string+="'"),e.string+="/>"}}const o=i.at(-1).getValue();if(o)o.toXMLStream(e);else{e.string+=t.Indent(),e.string+="<",e.string+="NULL";const n=t.ContainerField();n&&(e.string+=" ",e.string+="containerField='",e.string+=t.XMLEncode(n.getName()),e.string+="'")}t.LeaveScope()}},dispose:function(){this.resize(0),un.prototype.dispose.call(this)}});for(const e of Reflect.ownKeys(Nn.prototype))Object.defineProperty(Nn.prototype,e,{enumerable:!1});function Fn(e){return un.call(this,arguments)}Fn.prototype=Object.assign(Object.create(un.prototype),{constructor:Fn,getValueType:function(){return String},getSingleType:function(){return Zt},getArrayType:function(){return Array},getComponents:function(){return 1},getTypeName:function(){return"MFString"},getType:function(){return s.MFString},toXMLStream:function(e){const t=this.length;if(t){const n=this.getValue();for(let i=0,o=t-1;i<o;++i)e.string+='"',n[i].toXMLStream(e),e.string+='"',e.string+=", ";e.string+='"',n.at(-1).toXMLStream(e),e.string+='"'}}});for(const e of Reflect.ownKeys(Fn.prototype))Object.defineProperty(Fn.prototype,e,{enumerable:!1});function Mn(e,t,n,i,o,r){function s(e){return mn.call(this,arguments)}s.prototype=Object.assign(Object.create(mn.prototype),{constructor:s,getSingleType:function(){return n},getValueType:function(){return i},getArrayType:function(){return o},getComponents:function(){return r},getTypeName:function(){return e},getType:function(){return t}});for(const e of Reflect.ownKeys(s.prototype))Object.defineProperty(s.prototype,e,{enumerable:!1});return s}function Dn(e){return e}const In={MFBool:Mn("MFBool",s.MFBool,$,Boolean,Uint8Array,1),MFColor:Mn("MFColor",s.MFColor,fe,fe,Float32Array,3),MFColorRGBA:Mn("MFColorRGBA",s.MFColorRGBA,De,De,Float32Array,4),MFDouble:Mn("MFDouble",s.MFDouble,Re,Dn,Float64Array,1),MFFloat:Mn("MFFloat",s.MFFloat,Pe,Dn,Float32Array,1),MFImage:function(e,t,n,i,o,r){function s(e){return un.call(this,arguments)}s.prototype=Object.assign(Object.create(un.prototype),{constructor:s,getSingleType:function(){return Un},getValueType:function(){return Un},getArrayType:function(){return o},getComponents:function(){return r},getTypeName:function(){return e},getType:function(){return t}});for(const e of Reflect.ownKeys(s.prototype))Object.defineProperty(s.prototype,e,{enumerable:!1});return s}("MFImage",s.MFImage,0,0,Array,1),MFInt32:Mn("MFInt32",s.MFInt32,Le,Dn,Int32Array,1),MFMatrix3d:Mn("MFMatrix3d",s.MFMatrix3d,_n,_n,Float64Array,9),MFMatrix3f:Mn("MFMatrix3f",s.MFMatrix3f,yn,yn,Float32Array,9),MFMatrix4d:Mn("MFMatrix4d",s.MFMatrix4d,xn,xn,Float64Array,16),MFMatrix4f:Mn("MFMatrix4f",s.MFMatrix4f,wn,wn,Float32Array,16),MFNode:Nn,MFRotation:Mn("MFRotation",s.MFRotation,qt,qt,Float64Array,4),MFString:Fn,MFTime:Mn("MFTime",s.MFTime,$t,Dn,Float64Array,1),MFVec2d:Mn("MFVec2d",s.MFVec2d,vn,vn,Float64Array,2),MFVec2f:Mn("MFVec2f",s.MFVec2f,bn,bn,Float32Array,2),MFVec3d:Mn("MFVec3d",s.MFVec3d,Sn,Sn,Float64Array,3),MFVec3f:Mn("MFVec3f",s.MFVec3f,Tn,Tn,Float32Array,3),MFVec4d:Mn("MFVec4d",s.MFVec4d,En,En,Float64Array,4),MFVec4f:Mn("MFVec4f",s.MFVec4f,Cn,Cn,Float32Array,4)},Rn=In;function Vn(e,t,n,i){const o=Rn.MFInt32;this.width=~~e,this.height=~~t,this.comp=~~n,this.array=new o,this.array.setValue(i),this.array.length=this.width*this.height}function Pn(e,t,n,i){const o=Rn.MFInt32;return arguments[0]instanceof Vn?Z.call(this,arguments[0]):4===arguments.length?Z.call(this,new Vn(e,t,n,i)):Z.call(this,new Vn(0,0,0,new o)),this.getValue().getArray().addParent(this),this.addInterest("set_size__",this),this}Vn.prototype={constructor:Vn,copy:function(){return new Vn(this.width,this.height,this.comp,this.array)},equals:function(e){return this.width===e.width&&this.height===e.height&&this.comp===e.comp&&this.array.equals(e.array)},assign:function(e){this.width=e.width,this.height=e.height,this.comp=e.comp,this.array.assign(e.array)},set:function(e,t,n,i){this.width=~~e,this.height=~~t,this.comp=~~n,this.array.assign(i)},setWidth:function(e){this.width=~~e,this.array.length=this.width*this.height},getWidth:function(){return this.width},setHeight:function(e){this.height=~~e,this.array.length=this.width*this.height},getHeight:function(){return this.height},setComp:function(e){this.comp=~~e},getComp:function(){return this.comp},setArray:function(e){this.array.setValue(e),this.array.length=this.width*this.height},getArray:function(){return this.array}},Pn.prototype=Object.assign(Object.create(Z.prototype),{constructor:Pn,set_size__:function(){this.getValue().getArray().length=this.width*this.height},copy:function(){return new Pn(this.getValue().copy())},equals:function(e){return this.getValue().equals(e.getValue())},isDefaultValue:function(){return 0===this.width&&0===this.height&&0===this.comp},set:function(e){this.getValue().assign(e)},getTypeName:function(){return"SFImage"},getType:function(){return s.SFImage},toStream:function(e){e.string+=this.width+" "+this.height+" "+this.comp;for(const t of this.array)e.string+=" 0x"+t.toString(16)},toVRMLStream:function(e){this.toStream(e)},toXMLStream:function(e){this.toStream(e)}});for(const e of Reflect.ownKeys(Pn.prototype))Object.defineProperty(Pn.prototype,e,{enumerable:!1});const An={get:function(){return this.getValue().getWidth()},set:function(e){this.getValue().setWidth(e),this.addEvent()},enumerable:!0,configurable:!1},Ln={get:function(){return this.getValue().getHeight()},set:function(e){this.getValue().setHeight(e),this.addEvent()},enumerable:!0,configurable:!1};Object.defineProperty(Pn.prototype,"width",An),Object.defineProperty(Pn.prototype,"height",Ln),Object.defineProperty(Pn.prototype,"comp",{get:function(){return this.getValue().getComp()},set:function(e){this.getValue().setComp(e),this.addEvent()},enumerable:!0,configurable:!1}),Object.defineProperty(Pn.prototype,"array",{get:function(){return this.getValue().getArray()},set:function(e){this.getValue().setArray(e),this.addEvent()},enumerable:!0,configurable:!1}),An.enumerable=!1,Ln.enumerable=!1,Object.defineProperty(Pn.prototype,"x",An),Object.defineProperty(Pn.prototype,"y",Ln);const Un=Pn,Bn=Object.assign({SFBool:$,SFColor:fe,SFColorRGBA:De,SFDouble:Re,SFFloat:Pe,SFImage:Un,SFInt32:Le,SFMatrix3d:nt.SFMatrix3d,SFMatrix3f:nt.SFMatrix3f,SFMatrix4d:Mt.SFMatrix4d,SFMatrix4f:Mt.SFMatrix4f,SFNode:Bt,SFRotation:qt,SFString:Zt,SFTime:$t,SFVec2d:je.SFVec2d,SFVec2f:je.SFVec2f,SFVec3d:ot.SFVec3d,SFVec3f:ot.SFVec3f,SFVec4d:en.SFVec4d,SFVec4f:en.SFVec4f,VrmlMatrix:Mt.VrmlMatrix},Rn),Xn=Symbol(),kn=Symbol(),zn=Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions"),jn=Symbol(),Gn=Symbol(),Hn=Symbol(),qn=Symbol(),Wn=Symbol(),Yn=Symbol(),Kn=Symbol("X3DBaseNode.set_live__"),Zn=Symbol(),Qn=Symbol();function $n(e){if(!this[Xn]){C.call(this,e.getBrowser()),this[Xn]=e,this[kn]=[s.X3DBaseNode],this[jn]=new L,this[Gn]=new L,this[Hn]=new Map,this[qn]=new L,this[Yn]=!0,this[Wn]=!1,this[Zn]=!1,this[Qn]=0,this.canUserDefinedFields()&&(this[zn]=new P(this[zn]));for(const e of this[zn])this.addField(e);this.addChildObjects("name_changed",new Bn.SFTime,"typeName_changed",new Bn.SFTime,"fields_changed",new Bn.SFTime,"cloneCount_changed",new Bn.SFTime)}}$n.prototype=Object.assign(Object.create(C.prototype),{constructor:$n,[zn]:new P([]),setName:function(e){C.prototype.setName.call(this,e),this[Wn]&&(this._name_changed=this.getBrowser().getCurrentTime())},getMainScene:function(){let e=this[Xn].getScene();for(;!e.isMainScene();)e=e.getScene();return e},getScene:function(){let e=this[Xn];for(;!e.isScene();)e=e.getExecutionContext();return e},getExecutionContext:function(){return this[Xn]},setExecutionContext:function(e){this[Xn]=e},addType:function(e){this[kn].push(e)},getType:function(){return this[kn]},getInnerNode:function(){return this},isLive:function(){function e(){return this._isLive}return function(){return Object.defineProperty(this,"isLive",{value:e,enumerable:!1,configurable:!0}),this.addChildObjects("isLive",new Bn.SFBool(this.getLiveState())),this._isLive.removeParent(this),this.getOuterNode&&this.getOuterNode()?this.getOuterNode().isLive().addInterest(Kn,this):this[Xn]!==this&&this[Xn].isLive().addInterest(Kn,this),this.isLive()}}(),setLive:function(e){this[Yn]=e.valueOf(),this[Kn]()},getLive:function(){return this[Yn]},getLiveState:function(){return this.getOuterNode&&this.getOuterNode()?this.getLive()&&this.getOuterNode().isLive().getValue():this!==this[Xn]?this.getLive()&&this[Xn].isLive().getValue():this.getLive()},[Kn]:function(){const e=this.getLiveState(),t=this.isLive();if(e){if(t.getValue())return;t.set(!0),t.processEvent()}else t.getValue()&&(t.set(!1),t.processEvent())},create:function(e){return new this.constructor(e||this[Xn])},setup:function(){const e={value:Function.prototype,enumerable:!1};return function(){Object.defineProperty(this,"setup",e);for(const e of this[jn])e.setTainted(!1);this.initialize(),this[Wn]=!0}}(),initialize:function(){},isInitialized:function(){return this[Wn]},copy:function(e){const t=this.create(e);if(this.canUserDefinedFields())for(const e of this[zn])t.getFields().has(e.name)||t.addUserDefinedField(e.accessType,e.name,e.value.copy());for(const e of this[jn])t.getFields().get(e.getName()).assign(e);return t.setup(),t},addChildObjects:function(e,t){for(let e=0,t=arguments.length;e<t;e+=2)this.addChildObject(arguments[e],arguments[e+1])},addChildObject:function(e,t){t.addParent(this),t.setName(e),Object.defineProperty(this,"_"+e,{get:function(){return t},set:function(e){t.setValue(e)},enumerable:!1,configurable:!1})},getFieldDefinitions:function(){return this[zn]},getFieldsAreEnumerable:function(){return!1},addField:function(e){const t=e.accessType,n=e.name,i=e.value.copy();i.setTainted(!this[Wn]),i.addParent(this),i.setName(n),i.setAccessType(t),this[jn].add(n,i),this[Gn].add(n,i),Object.defineProperty(this,"_"+n,{get:function(){return i},set:function(e){i.setValue(e)},enumerable:this.getFieldsAreEnumerable(),configurable:!0}),this.isPrivate()||i.addCloneCount(1),this[Wn]&&(this._fields_changed=this.getBrowser().getCurrentTime())},getField:function(){const e=/^set_(.*?)$/,t=/^(.*?)_changed$/;return function(n){const i=this[jn].get(n)||this[Hn].get(n);if(i)return i;const o=n.match(e);if(o){const e=this[jn].get(o[1])||this[Hn].get(o[1]);if(e&&e.getAccessType()===s.inputOutput)return e}else{const e=n.match(t);if(e){const t=this[jn].get(e[1])||this[Hn].get(e[1]);if(t&&t.getAccessType()===s.inputOutput)return t}}throw new Error("Unknown field '"+n+"' in node class "+this.getTypeName()+".")}}(),addAlias:function(e,t){this[Hn].set(e,t),Object.defineProperty(this,"_"+e,{get:function(){return t},set:function(e){t.setValue(e)},enumerable:!0,configurable:!1})},removeField:function(e){const t=this[Gn].get(e);t&&(t.removeParent(this),this[jn].remove(e),this[Gn].remove(e),delete this["_"+t.getName()],this.isPrivate()||t.removeCloneCount(1),this[Wn]&&(this._fields_changed=this.getBrowser().getCurrentTime()))},canUserDefinedFields:function(){return!1},addUserDefinedField:function(e,t,n){this[qn].has(t)&&this.removeUserDefinedField(t),n.setTainted(!this[Wn]),n.addParent(this),n.setName(t),n.setAccessType(e),this[zn].add(t,new N(e,t,n)),this[jn].add(t,n),this[qn].add(t,n),this.isPrivate()||n.addCloneCount(1),this[Wn]&&(this._fields_changed=this.getBrowser().getCurrentTime())},removeUserDefinedField:function(e){const t=this[qn].get(e);t&&(t.removeParent(this),this[jn].remove(e),this[qn].remove(e),this[zn].remove(e),this.isPrivate()||t.removeCloneCount(1),this[Wn]&&(this._fields_changed=this.getBrowser().getCurrentTime()))},getUserDefinedFields:function(){return this[qn]},getPredefinedFields:function(){return this[Gn]},getChangedFields:function(e){const t=[];if(e)for(const e of this[qn])t.push(e);for(const n of this[Gn])if(e&&(n.getInputRoutes().size||n.getOutputRoutes().size))t.push(n);else{if(0===n.getReferences().size){if(!n.isInitializable())continue;if(this.isDefaultValue(n))continue}t.push(n)}return t},isDefaultValue:function(e){const t=this.getFieldDefinitions().get(e.getName());return t?t.value.equals(e):!e.getModificationTime()},getFields:function(){return this[jn]},getSourceText:function(){return null},hasRoutes:function(){for(const e of this[jn]){if(e.getInputRoutes().size)return!0;if(e.getOutputRoutes().size)return!0}return!1},isPrivate:function(){return this[Zn]},setPrivate:function(e){if(this[Zn]=e,e)for(const e of this[jn])e.removeCloneCount(1);else for(const e of this[jn])e.addCloneCount(1)},getCloneCount:function(){return this[Qn]},addCloneCount:function(e){if(0===e)return;const t=this.getBrowser().getCurrentTime();this[Qn]+=e,this[Xn]._sceneGraph_changed=t,this[Wn]&&(this._cloneCount_changed=t)},removeCloneCount:function(e){if(0===e)return;const t=this.getBrowser().getCurrentTime();this[Qn]-=e,this[Xn]._sceneGraph_changed=t,this[Wn]&&(this._cloneCount_changed=t)},getEnum:function(e,t,n){return e.hasOwnProperty(t)?e[t]:n},dispose:function(){for(const e of this.getFields())e.dispose();C.prototype.dispose.call(this)}});for(const e of Reflect.ownKeys($n.prototype))Object.defineProperty($n.prototype,e,{enumerable:!1});const Jn=$n,ei="8.0.0a",ti=!0,ni=["ANGLE_instanced_arrays","EXT_blend_minmax","EXT_frag_depth","EXT_shader_texture_lod","EXT_texture_filter_anisotropic","OES_element_index_uint","OES_standard_derivatives","OES_texture_float","OES_texture_float_linear","OES_texture_half_float","OES_texture_half_float_linear","OES_vertex_array_object","WEBGL_compressed_texture_s3tc","WEBGL_debug_shaders","WEBGL_depth_texture","WEBGL_draw_buffers","WEBGL_lose_context","EXT_color_buffer_float","EXT_color_buffer_half_float","EXT_disjoint_timer_query","EXT_disjoint_timer_query_webgl2","EXT_sRGB","WEBGL_color_buffer_float","WEBGL_compressed_texture_astc","WEBGL_compressed_texture_atc","WEBGL_compressed_texture_etc","WEBGL_compressed_texture_etc1","WEBGL_compressed_texture_pvrtc","WEBGL_compressed_texture_s3tc","WEBGL_compressed_texture_s3tc_srgb","EXT_float_blend","OES_fbo_render_mipmap","WEBGL_get_buffer_sub_data_async","WEBGL_multiview","WEBGL_security_sensitive_resources","WEBGL_shared_resources","EXT_clip_cull_distance","WEBGL_debug","WEBGL_dynamic_texture","WEBGL_subarray_uploads","WEBGL_texture_multisample","WEBGL_texture_source_iframe","WEBGL_video_texture","EXT_texture_storage","OES_depth24","WEBGL_debug_shader_precision","WEBGL_draw_elements_no_range_check","WEBGL_subscribe_uniform","WEBGL_texture_from_depth_video"],ii={create:function(e,t,n){const i={preserveDrawingBuffer:n};let o=null;if(t>=2&&!o&&(o=e.getContext("webgl2",i),o&&(o.getVersion=function(){return 2})),t>=1&&!o&&(o=e.getContext("webgl",i)||e.getContext("experimental-webgl",i),o)){o.getVersion=function(){return 1};{const e=o.getExtension("OES_vertex_array_object");o.bindVertexArray=e.bindVertexArrayOES.bind(e),o.createVertexArray=e.createVertexArrayOES.bind(e),o.deleteVertexArray=e.deleteVertexArrayOES.bind(e),o.isVertexArray=e.isVertexArrayOES.bind(e)}}if(!o)throw new Error("Couldn't create WebGL context.");const r=o.getParameter(o.ALIASED_LINE_WIDTH_RANGE);1===r[0]&&1===r[1]?(o.lineWidth=Function.prototype,o.HAS_FEATURE_TRANSFORMED_LINES=o.getVersion()>=2,console.info("Lines are transformed if necessary to obtain thick lines.")):o.HAS_FEATURE_TRANSFORMED_LINES=!1,o.HAS_FEATURE_DEPTH_TEXTURE=o.getVersion()>=2||!!o.getExtension("WEBGL_depth_texture"),o.HAS_FEATURE_FRAG_DEPTH=o.getVersion()>=2||!!o.getExtension("EXT_frag_depth");for(const e of ni)o.getExtension(e);return o}};const oi={en:"C",de:'msgid ""\nmsgstr ""\n"Project-Id-Version: X_ITE\n"\n"POT-Creation-Date: 2015-12-23 04:56+0100\n"\n"PO-Revision-Date: 2015-12-23 04:57+0100\n"\n"Last-Translator: Holger Seelig <holger.seelig@yahoo.de>\n"\n"Language-Team: \n"\n"Language: de\n"\n"MIME-Version: 1.0\n"\n"Content-Type: text/plain; charset=UTF-8\n"\n"Content-Transfer-Encoding: 8bit\n"\n"X-Generator: Poedit 1.8.4\n"\n"X-Poedit-Basepath: ../x_ite\n"\n"Plural-Forms: nplurals=2; plural=(n != 1);\n"\n"X-Poedit-SourceCharset: UTF-8\n"\n"X-Poedit-SearchPath-0: .\n"\n\nmsgid "Less Properties"\nmsgstr "Weniger Eigenschaften"\n\nmsgid "More Properties"\nmsgstr "Mehr Eigenschaften"\n\nmsgid "Frame rate"\nmsgstr "Bildrate"\n\nmsgid "fps"\nmsgstr "BpS"\n\nmsgid "Speed"\nmsgstr "Geschwindigkeit"\n\nmsgid "m/s"\nmsgstr ""\n\nmsgid "km/h"\nmsgstr ""\n\nmsgid "Browser"\nmsgstr ""\n\nmsgid "ms"\nmsgstr ""\n\nmsgid "X3D total"\nmsgstr "X3D gesamt"\n\nmsgid "Event Processing"\nmsgstr "Ereignisverarbeitung"\n\nmsgid "Pointer"\nmsgstr "ZeigegerÃ¤t"\n\nmsgid "Camera"\nmsgstr "Kamera"\n\nmsgid "Collision Detection"\nmsgstr "Kollisionserkennung"\n\nmsgid "Rendering"\nmsgstr "Rendering"\n\nmsgid "Number of Shapes"\nmsgstr "Anzahl der Formen"\n\nmsgid "Number of Sensors"\nmsgstr "Anzahl der Sensoren"\n\nmsgid "Browser Timings"\nmsgstr "Zeitberechnung"\n\nmsgid "X_ITE Browser"\nmsgstr ""\n\nmsgid "Viewpoints"\nmsgstr "Ansichtspunkte"\n\nmsgid "Available Viewers"\nmsgstr "VerfÃ¼gbare Betrachter"\n\nmsgid "Straighten Horizon"\nmsgstr "Horizont gerade richten"\n\nmsgid "Primitive Quality"\nmsgstr "QualitÃ¤t der Grundobjekte"\n\nmsgid "High"\nmsgstr "Hoch"\n\nmsgid "high"\nmsgstr "hoch"\n\nmsgid "Medium"\nmsgstr "Mittel"\n\nmsgid "medium"\nmsgstr "mittel"\n\nmsgid "Low"\nmsgstr "Niedrig"\n\nmsgid "low"\nmsgstr "niedrig"\n\nmsgid "Texture Quality"\nmsgstr "Textur QualitÃ¤t"\n\nmsgid "Display Rubberband"\nmsgstr "Gummiband anzeigen"\n\nmsgid "Rubberband"\nmsgstr "Gummiband"\n\nmsgid "on"\nmsgstr "an"\n\nmsgid "off"\nmsgstr "aus"\n\nmsgid "Mute Browser"\nmsgstr "Browser stumm schalten"\n\nmsgid "Browser muted"\nmsgstr "Browser stumm geschalten"\n\nmsgid "Browser unmuted"\nmsgstr "Browser Ton an"\n\nmsgid "Leave Fullscreen"\nmsgstr "Vollbild verlassen"\n\nmsgid "Fullscreen"\nmsgstr "Vollbild"\n\nmsgid "About X_ITE"\nmsgstr "Ãber X_ITE"\n\nmsgid "Examine Viewer"\nmsgstr "Untersuchen"\n\nmsgid "Walk Viewer"\nmsgstr "Laufen"\n\nmsgid "Fly Viewer"\nmsgstr "Fliegen"\n\nmsgid "Plane Viewer"\nmsgstr "Ebenen Betrachter"\n\nmsgid "Look At Viewer"\nmsgstr "Auf Objekte zielen"\n\nmsgid "None Viewer"\nmsgstr "Kein Betrachter"\n\nmsgid "Loading %1 file"\nmsgstr "Lade %1 Datei"\n\nmsgid "Loading %1 files"\nmsgstr "Lade %1 Dateien"\n\nmsgid "Loading done"\nmsgstr "Fertig mit Laden"\n\nmsgid "Failed loading world."\nmsgstr "Laden der Dateien fehlgeschlagen."\n\nmsgid "Show World Info"\nmsgstr "World Info anzeigen"\n\nmsgid "Viewpoint is copied to clipboard."\nmsgstr "Ansichtspunkt wurde in die Zwischenablage kopiert."\n',fr:'msgid ""\nmsgstr ""\n"Project-Id-Version: X_ITE\n"\n"POT-Creation-Date: 2015-12-23 04:58+0100\n"\n"PO-Revision-Date: 2015-12-23 05:07+0100\n"\n"Last-Translator: Holger Seelig <holger.seelig@yahoo.de>\n"\n"Language-Team: \n"\n"Language: fr\n"\n"MIME-Version: 1.0\n"\n"Content-Type: text/plain; charset=UTF-8\n"\n"Content-Transfer-Encoding: 8bit\n"\n"X-Generator: Poedit 1.8.4\n"\n"X-Poedit-Basepath: ../x_ite\n"\n"Plural-Forms: nplurals=2; plural=(n != 1);\n"\n"X-Poedit-SourceCharset: UTF-8\n"\n"X-Poedit-SearchPath-0: .\n"\n\nmsgid "Less Properties"\nmsgstr "Moins de propriÃ©tÃ©s"\n\nmsgid "More Properties"\nmsgstr "Plus de propriÃ©tÃ©s"\n\nmsgid "Frame rate"\nmsgstr "FrÃ©quence"\n\nmsgid "fps"\nmsgstr "fps"\n\nmsgid "Speed"\nmsgstr "VÃ©locitÃ©"\n\nmsgid "m/s"\nmsgstr ""\n\nmsgid "km/h"\nmsgstr ""\n\nmsgid "Browser"\nmsgstr "X_ITE Navigateur"\n\nmsgid "ms"\nmsgstr ""\n\nmsgid "X3D total"\nmsgstr "X3D total"\n\nmsgid "Traitement des Ã©vÃ©nements"\nmsgstr "Routes"\n\nmsgid "Pointer"\nmsgstr "Pointeur"\n\nmsgid "Camera"\nmsgstr "CamÃ©ra"\n\nmsgid "Collision Detection"\nmsgstr "DÃ©tection des collisions"\n\nmsgid "Rendering"\nmsgstr "Rendement"\n\nmsgid "Number of Shapes"\nmsgstr "Nombre de formes"\n\nmsgid "Number of Sensors"\nmsgstr "Nombre de senseurs"\n\nmsgid "Browser Timings"\nmsgstr "Calcul du temps"\n\nmsgid "X_ITE Browser"\nmsgstr "X_ITE Navigateur"\n\nmsgid "Viewpoints"\nmsgstr "Points de vue"\n\nmsgid "Available Viewers"\nmsgstr "Visionneurs disponibles"\n\nmsgid "Straighten Horizon"\nmsgstr "Redresser l\'horizon"\n\nmsgid "Primitive Quality"\nmsgstr "QualitÃ© des objets simples"\n\nmsgid "High"\nmsgstr "Haut"\n\nmsgid "high"\nmsgstr "haut"\n\nmsgid "Medium"\nmsgstr "Moyenne"\n\nmsgid "medium"\nmsgstr "moyenne"\n\nmsgid "Low"\nmsgstr "Faible"\n\nmsgid "low"\nmsgstr "faible"\n\nmsgid "Texture Quality"\nmsgstr "QualitÃ© des textures"\n\nmsgid "Display Rubberband"\nmsgstr "PrÃ©senter le bande Ã©lastique"\n\nmsgid "Rubberband"\nmsgstr "Bande Ã©lastique"\n\nmsgid "on"\nmsgstr "marche"\n\nmsgid "off"\nmsgstr "arrÃªt"\n\nmsgid "Mute Browser"\nmsgstr "Rendre navigateur muet"\n\nmsgid "Browser muted"\nmsgstr "Navigateur muet"\n\nmsgid "Browser unmuted"\nmsgstr "Son de navigateur rÃ©activÃ©"\n\nmsgid "Leave Fullscreen"\nmsgstr "Sortie en plein Ã©cran"\n\nmsgid "Fullscreen"\nmsgstr "Plein Ã©cran"\n\nmsgid "About X_ITE"\nmsgstr "Ã propos de X_ITE"\n\nmsgid "Examine Viewer"\nmsgstr "Examiner"\n\nmsgid "Walk Viewer"\nmsgstr "Aller"\n\nmsgid "Fly Viewer"\nmsgstr "Voler"\n\nmsgid "Plane Viewer"\nmsgstr "Visionneur de la plaine"\n\nmsgid "Look At Viewer"\nmsgstr "Regarder un objet de prÃ¨s"\n\nmsgid "None Viewer"\nmsgstr "Pas de visionneur"\n\nmsgid "Loading %1 file"\nmsgstr "TÃ©lÃ©charger %1 fichier"\n\nmsgid "Loading %1 files"\nmsgstr "TÃ©lÃ©charger %1 fichiers"\n\nmsgid "Loading done"\nmsgstr "TÃ©lÃ©chargement fini"\n\nmsgid "Failed loading world."\nmsgstr "Le chargement des fichiers a Ã©chouÃ©."\n\nmsgid "Show World Info"\nmsgstr "Afficher World Info"\n\nmsgid "Viewpoint is copied to clipboard."\nmsgstr "Le point de vue est copiÃ© dans le presse-papiers."\n'},ri=/msgid\s+"(.*?)"\nmsgstr\s+"(.*?)"\n/g,si=function(){for(const e of navigator.languages){const t=e.split("-")[0];if(oi[t])return t}return(navigator.language||navigator.userLanguage).split("-")[0]}();!function(e){if(oi[e]){const i=function(e,t){const n=[];let i=null;for(;i=e.exec(t);)n.push(i);return n}(ri,oi[e]),o=oi[e]={};for(var t=0,n=i.length;t<n;++t)i[t][2].length&&(o[i[t][1]]=i[t][2])}}(si);const ai=function(e){const t=oi[si];if(void 0===t)return e;const n=t[e];return void 0===n?e:n};var ui=i(755);function li(e){return e.toFixed(2)}function ci(e){Jn.call(this,e),this.localStorage=this.getBrowser().getLocalStorage().addNameSpace("BrowserTimings."),this.enabled=!1}ci.prototype=Object.assign(Object.create(Jn.prototype),{constructor:ci,getTypeName:function(){return"BrowserTimings"},getComponentName:function(){return"X_ITE"},getContainerField:function(){return"browserTimings"},initialize:function(){Jn.prototype.initialize.call(this),this.localStorage.addDefaultValues({type:"LESS"}),this.localeOptions={minimumFractionDigits:2,maximumFractionDigits:2},this.startTime=0,this.frames=0,this.element=ui("<div></div>").hide().addClass("x_ite-private-browser-timings").appendTo(this.getBrowser().getSurface()),this.table=ui("<table></table>").appendTo(this.element),this.header=ui("<thead></thead>").append(ui("<tr></tr>").append(ui("<th colspan='2'></th>"))).appendTo(this.table),this.body=ui("<tbody></tbody>").appendTo(this.table),this.footer=ui("<tfoot></tfoot>").append(ui("<tr></tr>").append(ui("<td colspan='2'></td>"))).appendTo(this.table),this.button=ui("<button></button>").attr("type","button").appendTo(this.footer.find("td")),this.rows=[],this.button.on("click touchend",this.set_type__.bind(this)),this.set_button__()},getEnabled:function(){return this.enabled},setEnabled:function(e){this.enabled!==e&&(this.enabled=e,e?(this.element.stop(!0,!0).fadeIn(),this.getBrowser().prepareEvents().addInterest("update",this),this.update()):(this.element.stop(!0,!0).fadeOut(),this.getBrowser().prepareEvents().removeInterest("update",this)))},set_type__:function(){"MORE"===this.localStorage.type?this.localStorage.type="LESS":this.localStorage.type="MORE",this.set_button__(),this.build()},set_button__:function(){"MORE"===this.localStorage.type?this.button.text(ai("Less Properties")):this.button.text(ai("More Properties"))},update:function(){const e=this.getBrowser().getCurrentTime();e-this.startTime>1?(this.build(),this.frames=0,this.startTime=e):++this.frames},build:function(){const e=this.getBrowser(),t=e.getCurrentTime(),n=navigator.language||navigator.userLanguage,i=this.localeOptions,o=this.rows;let r=0;if(o[r++]=ui("<tr></tr>").append(ui("<td></td>").text(ai("Frame rate")+":")).append(ui("<td></td>").text(li(this.frames/(t-this.startTime)).toLocaleString(n,i)+" "+ai("fps"))),o[r++]=ui("<tr></tr>").append(ui("<td></td>").text(ai("Speed")+":")).append(ui("<td></td>").text(li(this.getSpeed(e.currentSpeed)).toLocaleString(n,i)+" "+this.getSpeedUnit(e.currentSpeed))),"MORE"===this.localStorage.type){const t=e.getWorld().getLayerSet().getLayers(),s=e.getActiveLayer(),a=e.getSystemTime(),u=s&&e.getCollisionCount()?s.collisionTime:0,l=e.getCollisionTime()+u,c=e.getBrowserTime()-(e.getCameraTime()+e.getCollisionTime()+e.getDisplayTime()+u),h=e.prepareEvents().getInterests().size-1,d=e.sensorEvents().getInterests().size;let p=0,f=0;for(const e of t)p+=e.numOpaqueShapes,f+=e.numTransparentShapes;o[1].addClass("x_ite-private-more"),o[r++]=ui("<tr></tr>").append(ui("<td></td>").text(ai("Browser")+":")).append(ui("<td></td>").text(li(a).toLocaleString(n,i)+" "+ai("ms"))),o[r++]=ui("<tr></tr>").append(ui("<td></td>").text(ai("X3D total")+":")).append(ui("<td></td>").text(li(e.getBrowserTime()).toLocaleString(n,i)+" "+ai("ms"))),o[r++]=ui("<tr></tr>").append(ui("<td></td>").text(ai("Event Processing")+":")).append(ui("<td></td>").text(li(c).toLocaleString(n,i)+" "+ai("ms"))),o[r++]=ui("<tr></tr>").append(ui("<td></td>").text(ai("Pointer")+":")).append(ui("<td></td>").text(li(e.getPointerTime()).toLocaleString(n,i)+" "+ai("ms"))),o[r++]=ui("<tr></tr>").append(ui("<td></td>").text(ai("Camera")+":")).append(ui("<td></td>").text(li(e.getCameraTime()).toLocaleString(n,i)+" "+ai("ms"))),o[r++]=ui("<tr></tr>").append(ui("<td></td>").text(ai("Picking")+":")).append(ui("<td></td>").text(li(e.getPickingTime()).toLocaleString(n,i)+" "+ai("ms"))),o[r++]=ui("<tr></tr>").append(ui("<td></td>").text(ai("Collision Detection")+":")).append(ui("<td></td>").text(li(l).toLocaleString(n,i)+" "+ai("ms"))),o[r++]=ui("<tr></tr>").append(ui("<td></td>").text(ai("Rendering")+":")).append(ui("<td></td>").text(li(e.getDisplayTime()).toLocaleString(n,i)+" "+ai("ms"))),o[r++]=ui("<tr></tr>").append(ui("<td></td>").text(ai("Number of Shapes")+":")).append(ui("<td></td>").text(p+" + "+f)),o[r++]=ui("<tr></tr>").append(ui("<td></td>").text(ai("Number of Sensors")+":")).append(ui("<td></td>").text(h+d))}o.length=r,this.header.find("th").text(ai("Browser Timings")),this.body.empty(),this.body.append(o)},getSpeed:function(e){return e<15?e:3.6*e},getSpeedUnit:function(e){return ai(e<15?"m/s":"km/h")}});const hi=ci;let di=0;const pi={LOW:di++,MEDIUM:di++,HIGH:di++};let fi=0;const gi={POINT:fi++,WIREFRAME:fi++,FLAT:fi++,GOURAUD:fi++,PHONG:fi++};let mi=0;const _i={LOW:mi++,MEDIUM:mi++,HIGH:mi++};function yi(e){Jn.call(this,e),this.addAlias("AntiAliased",this._Antialiased);const t=this.getBrowser();this.localStorage=t.getLocalStorage().addNameSpace("BrowserOptions."),this.textureQuality=_i.MEDIUM,this.primitiveQuality=pi.MEDIUM,this.shading=gi.GOURAUD,this.setAttributeSplashScreen()}function xi(e,t){return"TRUE"===(e=String(e).toUpperCase())||"FALSE"!==e&&t}yi.prototype=Object.assign(Object.create(Jn.prototype),{constructor:yi,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new P([new N(s.inputOutput,"SplashScreen",new Bn.SFBool(!0)),new N(s.inputOutput,"Dashboard",new Bn.SFBool(!0)),new N(s.inputOutput,"Rubberband",new Bn.SFBool(!0)),new N(s.inputOutput,"EnableInlineViewpoints",new Bn.SFBool(!0)),new N(s.inputOutput,"Antialiased",new Bn.SFBool(!0)),new N(s.inputOutput,"TextureQuality",new Bn.SFString("MEDIUM")),new N(s.inputOutput,"PrimitiveQuality",new Bn.SFString("MEDIUM")),new N(s.inputOutput,"QualityWhenMoving",new Bn.SFString("MEDIUM")),new N(s.inputOutput,"Shading",new Bn.SFString("GOURAUD")),new N(s.inputOutput,"MotionBlur",new Bn.SFBool),new N(s.inputOutput,"Gravity",new Bn.SFFloat(9.80665)),new N(s.inputOutput,"StraightenHorizon",new Bn.SFBool(!0)),new N(s.inputOutput,"LogarithmicDepthBuffer",new Bn.SFBool(!1)),new N(s.inputOutput,"Timings",new Bn.SFBool(!1))]),getTypeName:function(){return"BrowserOptions"},getComponentName:function(){return"X_ITE"},getContainerField:function(){return"browserOptions"},initialize:function(){Jn.prototype.initialize.call(this),this.localStorage.addDefaultValues({Rubberband:this._Rubberband.getValue(),PrimitiveQuality:this._PrimitiveQuality.getValue(),TextureQuality:this._TextureQuality.getValue(),StraightenHorizon:this._StraightenHorizon.getValue(),Timings:this._Timings.getValue()}),this._SplashScreen.addInterest("set_splashScreen__",this),this._Rubberband.addInterest("set_rubberband__",this),this._PrimitiveQuality.addInterest("set_primitiveQuality__",this),this._TextureQuality.addInterest("set_textureQuality__",this),this._Shading.addInterest("set_shading__",this),this._StraightenHorizon.addInterest("set_straightenHorizon__",this),this._LogarithmicDepthBuffer.addInterest("set_logarithmicDepthBuffer__",this),this._Timings.addInterest("set_timings__",this),this.configure()},configure:function(){const e=this.localStorage;for(const t of this.getFieldDefinitions()){const n=this.getField(t.name);void 0===e[t.name]&&(n.equals(t.value)||n.assign(t.value))}const t=e.Rubberband,n=e.PrimitiveQuality,i=e.TextureQuality,o=e.StraightenHorizon,r=e.Timings;this.setAttributeSplashScreen(),t!==this._Rubberband.getValue()&&(this._Rubberband=t),n!==this._PrimitiveQuality.getValue()&&(this._PrimitiveQuality=n),i!==this._TextureQuality.getValue()&&(this._TextureQuality=i),o!==this._StraightenHorizon.getValue()&&(this._StraightenHorizon=o),r!==this._Timings.getValue()&&(this._Timings=r)},setAttributeSplashScreen:function(){this._SplashScreen.set(this.getSplashScreen())},getCache:function(){return xi(this.getBrowser().getElement().attr("cache"),!0)},getContextMenu:function(){return xi(this.getBrowser().getElement().attr("contextMenu"),!0)},getDebug:function(){return xi(this.getBrowser().getElement().attr("debug"),!1)},getNotifications:function(){return xi(this.getBrowser().getElement().attr("notifications"),!0)},getSplashScreen:function(){return xi(this.getBrowser().getElement().attr("splashScreen"),!0)},getPrimitiveQuality:function(){return this.primitiveQuality},getShading:function(){return this.shading},getTextureQuality:function(){return this.textureQuality},set_splashScreen__:function(e){this.getBrowser().getElement().attr("splashScreen",e.getValue()?"true":"false")},set_rubberband__:function(e){this.localStorage.Rubberband=e.getValue()},set_primitiveQuality__:function(e){const t=this.getBrowser(),n=e.getValue().toUpperCase();this.localStorage.PrimitiveQuality=n,this.primitiveQuality=this.getEnum(pi,n,pi.MEDIUM),"function"==typeof t.setPrimitiveQuality2D&&t.setPrimitiveQuality2D(this.primitiveQuality),"function"==typeof t.setPrimitiveQuality3D&&t.setPrimitiveQuality3D(this.primitiveQuality)},set_textureQuality__:function(e){const t=this.getBrowser(),n=e.getValue().toUpperCase();this.localStorage.TextureQuality=n,this.textureQuality=this.getEnum(_i,n,_i.MEDIUM),"function"==typeof t.setTextureQuality&&t.setTextureQuality(this.textureQuality)},set_shading__:function(){const e={[gi.POINT]:"POINT",[gi.WIREFRAME]:"WIREFRAME",[gi.FLAT]:"FLAT",[gi.GOURAUD]:"GOURAUD",[gi.PHONG]:"PHONG"};return function(t){const n=this.getBrowser(),i=t.getValue().toUpperCase().replace("POINTSET","POINT");this.shading=this.getEnum(gi,i,gi.GOURAUD),n.getRenderingProperties()._Shading=e[this.shading],n.setShading(this.shading)}}(),set_straightenHorizon__:function(e){this.localStorage.StraightenHorizon=e.getValue()},set_logarithmicDepthBuffer__:function(e){const t=this.getBrowser(),n=t.getContext();t.getRenderingProperties()._LogarithmicDepthBuffer=e.getValue()&&n.HAS_FEATURE_FRAG_DEPTH},set_timings__:function(e){this.localStorage.Timings=e.getValue(),this.getBrowser().getBrowserTimings().setEnabled(e.getValue())}});const wi=yi;function vi(e){Jn.call(this,e)}vi.prototype=Object.assign(Object.create(Jn.prototype),{constructor:vi,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new P([new N(s.initializeOnly,"ABSTRACT_NODES",new Bn.SFBool(!0)),new N(s.initializeOnly,"CONCRETE_NODES",new Bn.SFBool(!0)),new N(s.initializeOnly,"EXTERNAL_INTERACTIONS",new Bn.SFBool(!0)),new N(s.initializeOnly,"PROTOTYPE_CREATE",new Bn.SFBool(!0)),new N(s.initializeOnly,"DOM_IMPORT",new Bn.SFBool(!0)),new N(s.initializeOnly,"XML_ENCODING",new Bn.SFBool(!0)),new N(s.initializeOnly,"CLASSIC_VRML_ENCODING",new Bn.SFBool(!0)),new N(s.initializeOnly,"BINARY_ENCODING",new Bn.SFBool)]),getTypeName:function(){return"BrowserProperties"},getComponentName:function(){return"X_ITE"},getContainerField:function(){return"browserProperties"}});const bi=vi;function Si(e){Jn.call(this,e),this.addAlias("AntiAliased",this._Antialiased)}Si.prototype=Object.assign(Object.create(Jn.prototype),{constructor:Si,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new P([new N(s.outputOnly,"Shading",new Bn.SFString),new N(s.outputOnly,"MaxTextureSize",new Bn.SFInt32),new N(s.outputOnly,"TextureUnits",new Bn.SFInt32),new N(s.outputOnly,"MaxLights",new Bn.SFInt32),new N(s.outputOnly,"Antialiased",new Bn.SFBool(!0)),new N(s.outputOnly,"ColorDepth",new Bn.SFInt32),new N(s.outputOnly,"TextureMemory",new Bn.SFDouble),new N(s.outputOnly,"LogarithmicDepthBuffer",new Bn.SFBool(!1))]),getTypeName:function(){return"RenderingProperties"},getComponentName:function(){return"X_ITE"},getContainerField:function(){return"renderingProperties"},initialize:function(){Jn.prototype.initialize.call(this);const e=this.getBrowser();this._MaxTextureSize=e.getMaxTextureSize(),this._TextureUnits=e.getMaxCombinedTextureUnits(),this._MaxLights=e.getMaxLights(),this._ColorDepth=e.getColorDepth(),this._TextureMemory=e.getTextureMemory()}});const Ti=Si;var Ei=i(755);function Ci(e){Jn.call(this,e),this.addChildObjects("string",new Zt)}Ei.fn.textWidth=function(e){const t=Ei(this).children(),n="<span>"+Ei(this).html()+"</span>";Ei(this).html(n);const i=Ei(this).find("span:first").width();return Ei(this).empty(),Ei(this).append(t),i},Ci.prototype=Object.assign(Object.create(Jn.prototype),{constructor:Ci,getTypeName:function(){return"Notification"},getComponentName:function(){return"X_ITE"},initialize:function(){Jn.prototype.initialize.call(this),this.element=Ei("<div></div>").hide().addClass("x_ite-private-notification").appendTo(this.getBrowser().getSurface()).animate({width:0}),Ei("<span></span>").appendTo(this.element),this._string.addInterest("set_string__",this)},set_string__:function(){this.getBrowser().getBrowserOptions().getNotifications()&&0!==this._string.length&&(this.element.children().text(this._string.getValue()),this.element.stop(!0,!0).fadeIn(0).animate({width:this.element.textWidth()}).animate({delay:1},5e3).animate({width:0}).fadeOut(0))}});const Oi=Ci;i(40);var Ni=i(755);const Fi=Symbol();function Mi(e){Jn.call(this,e),this[Fi]=null}Mi.prototype=Object.assign(Object.create(Jn.prototype),{constructor:Mi,getTypeName:function(){return"ContextMenu"},getComponentName:function(){return"X_ITE"},getContainerField:function(){return"contextMenu"},initialize:function(){Jn.prototype.initialize.call(this);const e=this.getBrowser();this.init({element:e.getElement(),appendTo:e.getShadow(),build:this.build.bind(this),animation:{duration:500,show:"fadeIn",hide:"fadeOut"}})},getUserMenu:function(){return this[Fi]},setUserMenu:function(e){this[Fi]=e},createUserMenu:function(){const e={};if("function"==typeof this[Fi]){const t=this[Fi]();if(Ni.isPlainObject(t))for(const n in t)e["user-"+n]=t[n]}return e},build:function(e){const t=this.getBrowser(),n=t.getElement().fullScreen();if(!t.getBrowserOptions().getContextMenu())return;const i={className:"x_ite-private-menu",items:{title:{name:t.getName()+" Browser v"+t.getVersion(),className:"context-menu-title context-menu-not-selectable"},separator0:"--------",viewpoints:{name:ai("Viewpoints"),className:"context-menu-icon x_ite-private-icon-viewpoint",items:this.getViewpoints()},"available-viewers":{name:ai("Available Viewers"),items:this.getAvailableViewers()},"straighten-horizon":{name:ai("Straighten Horizon"),type:"checkbox",selected:t.getBrowserOption("StraightenHorizon"),events:{click:function(e){const n=Ni(e.target).is(":checked");if(t.setBrowserOption("StraightenHorizon",n),n){t.getNotification()._string=ai("Straighten Horizon")+": "+ai("on");const e=t.getActiveViewpoint();e&&e.straighten(t.getActiveLayer(),!0)}else t.getNotification()._string=ai("Straighten Horizon")+": "+ai("off")}.bind(this)}},"display-rubberband":{name:ai("Display Rubberband"),type:"checkbox",selected:t.getBrowserOption("Rubberband"),events:{click:function(e){const n=Ni(e.target).is(":checked");t.setBrowserOption("Rubberband",n),t.getNotification()._string=n?ai("Rubberband")+": "+ai("on"):ai("Rubberband")+": "+ai("off")}.bind(this)}},separator1:"--------","primitive-quality":{name:ai("Primitive Quality"),className:"context-menu-icon x_ite-private-icon-primitive-quality",items:{high:{name:ai("High"),type:"radio",radio:"primitive-quality",selected:"HIGH"===t.getBrowserOption("PrimitiveQuality"),events:{click:function(){t.setBrowserOption("PrimitiveQuality","HIGH"),t.getNotification()._string=ai("Primitive Quality")+": "+ai("high")}.bind(this)}},medium:{name:ai("Medium"),type:"radio",radio:"primitive-quality",selected:"MEDIUM"===t.getBrowserOption("PrimitiveQuality"),events:{click:function(){t.setBrowserOption("PrimitiveQuality","MEDIUM"),t.getNotification()._string=ai("Primitive Quality")+": "+ai("medium")}.bind(this)}},low:{name:ai("Low"),type:"radio",radio:"primitive-quality",selected:"LOW"===t.getBrowserOption("PrimitiveQuality"),events:{click:function(){t.setBrowserOption("PrimitiveQuality","LOW"),t.getNotification()._string=ai("Primitive Quality")+": "+ai("low")}.bind(this)}}}},"texture-quality":{name:ai("Texture Quality"),className:"context-menu-icon x_ite-private-icon-texture-quality",items:{high:{name:ai("High"),type:"radio",radio:"texture-quality",selected:"HIGH"===t.getBrowserOption("TextureQuality"),events:{click:function(){t.setBrowserOption("TextureQuality","HIGH"),t.getNotification()._string=ai("Texture Quality")+": "+ai("high")}.bind(this)}},medium:{name:ai("Medium"),type:"radio",radio:"texture-quality",selected:"MEDIUM"===t.getBrowserOption("TextureQuality"),events:{click:function(){t.setBrowserOption("TextureQuality","MEDIUM"),t.getNotification()._string=ai("Texture Quality")+": "+ai("medium")}.bind(this)}},low:{name:ai("Low"),type:"radio",radio:"texture-quality",selected:"LOW"===t.getBrowserOption("TextureQuality"),events:{click:function(){t.setBrowserOption("TextureQuality","LOW"),t.getNotification()._string=ai("Texture Quality")+": "+ai("low")}.bind(this)}}}},shading:{name:ai("Shading"),className:"context-menu-icon x_ite-private-icon-shading",items:{point:{name:ai("Point"),type:"radio",radio:"shading",selected:"POINT"===t.getBrowserOption("Shading"),events:{click:function(){t.setBrowserOption("Shading","POINT"),t.getNotification()._string=ai("Shading")+": "+ai("Point")}.bind(this)}},wireframe:{name:ai("Wireframe"),type:"radio",radio:"shading",selected:"WIREFRAME"===t.getBrowserOption("Shading"),events:{click:function(){t.setBrowserOption("Shading","WIREFRAME"),t.getNotification()._string=ai("Shading")+": "+ai("Wireframe")}.bind(this)}},flat:{name:ai("Flat"),type:"radio",radio:"shading",selected:"FLAT"===t.getBrowserOption("Shading"),events:{click:function(){t.setBrowserOption("Shading","FLAT"),t.getNotification()._string=ai("Shading")+": "+ai("Flat")}.bind(this)}},gouraud:{name:ai("Gouraud"),type:"radio",radio:"shading",selected:"GOURAUD"===t.getBrowserOption("Shading"),events:{click:function(){t.setBrowserOption("Shading","GOURAUD"),t.getNotification()._string=ai("Shading")+": "+ai("Gouraud")}.bind(this)}},phong:{name:ai("Phong"),type:"radio",radio:"shading",selected:"PHONG"===t.getBrowserOption("Shading"),events:{click:function(){t.setBrowserOption("Shading","PHONG"),t.getNotification()._string=ai("Shading")+": "+ai("Phong")}.bind(this)}}}},separator2:"--------","browser-timings":{name:ai("Browser Timings"),type:"checkbox",selected:t.getBrowserOption("Timings"),events:{click:function(e){t.setBrowserOption("Timings",Ni(e.target).is(":checked")),t.getSurface().focus()}.bind(this)}},fullscreen:{name:ai(n?"Leave Fullscreen":"Fullscreen"),className:"context-menu-icon "+(n?"x_ite-private-icon-leave-fullscreen":"x_ite-private-icon-enter-fullscreen"),callback:function(){t.getElement().toggleFullScreen()}.bind(this)},separator3:"--------"}};Object.assign(i.items,this.createUserMenu()),Object.assign(i.items,{separator4:"--------","world-info":{name:ai("Show World Info"),className:"context-menu-icon x_ite-private-icon-world-info",callback:function(){t.getShadow().find(".x_ite-private-world-info").remove();const e=t.getShadow().find(".x_ite-private-browser"),n=Ni("<div></div>").addClass("x_ite-private-world-info-overlay").appendTo(e),i=Ni("<div></div>").addClass("x_ite-private-world-info").appendTo(n),o=t.getExecutionContext().getWorldInfos()[0],r=o.title,s=o.info;Ni("<div></div>").addClass("x_ite-private-world-info-top").text("World Info").appendTo(i),r.length&&Ni("<div></div>").addClass("x_ite-private-world-info-title").text(r).appendTo(i);for(const e of s)Ni("<div></div>").addClass("x_ite-private-world-info-info").text(e).appendTo(i);i.find("a").on("click",(function(e){e.stopPropagation()})),i.find("a[href^=http]").each((function(){-1===this.href.indexOf(location.hostname)&&Ni(this).attr("target","_blank")})),n.on("click",(function(){n.remove()}))}},about:{name:ai("About X_ITE"),className:"context-menu-icon x_ite-private-icon-help-about",callback:function(){window.open(t.getProviderUrl())}}}),Ni.isEmptyObject(i.items.viewpoints.items)&&delete i.items.viewpoints,Object.keys(i.items["available-viewers"].items).length<2&&delete i.items["available-viewers"],t.getCurrentViewer().match(/^(?:EXAMINE|FLY)$/)||delete i.items["straighten-horizon"],t.getDebug()||delete i.items.shading;const o=t.getExecutionContext().getWorldInfos()[0];return(!o||0===o.title.length&&0===o.info.length)&&delete i.items["world-info"],i},getViewpoints:function(){const e=this.getBrowser(),t=e.getActiveLayer();if(!t)return{};const n=e.getBrowserOption("EnableInlineViewpoints"),i=e.currentScene,o=t.getViewpoints().get(),r=t.getViewpoint(),s={};for(const t of o){const o=t._description.getValue();if(""===o)continue;if(!n&&t.getScene()!==i)continue;const a={name:o,callback:function(t){e.bindViewpoint(e.getActiveLayer(),t),e.getSurface().focus()}.bind(this,t)};t===r&&(a.className="context-menu-selected"),s["Viewpoint"+t.getId()]=a}return s},getAvailableViewers:function(){const e=this.getBrowser(),t=e._viewer.getValue(),n=e._availableViewers,i={};for(const o of n)i[o]={name:ai(this.getViewerName(o)),className:"context-menu-icon x_ite-private-icon-"+o.toLowerCase()+"-viewer",callback:function(t){e._viewer=t,e.getNotification()._string=ai(this.getViewerName(t)),e.getSurface().focus()}.bind(this,o)},o===t&&(i[o].className+=" context-menu-selected");return i},getViewerName:function(e){switch(e){case"EXAMINE":return ai("Examine Viewer");case"WALK":return ai("Walk Viewer");case"FLY":return ai("Fly Viewer");case"PLANE":return ai("Plane Viewer");case"LOOKAT":return ai("Look At Viewer");case"NONE":return ai("None Viewer")}},init:function(e){this.show=this.createRoot.bind(this,e),e.element.on("contextmenu",this.show)},show:function(e){},hide:function(e){},createRoot:function(e,t){const n=e.build(t);if(!n)return;const i=Ni("<div></div>").addClass("context-menu-layer").addClass(n.className).appendTo(e.appendTo),o=this.hide=function(){return delete this.hide,i.remove(),a[e.animation.hide](e.animation.duration,(function(){a.remove(),e.events&&"function"==typeof e.events.hide&&e.events.hide()})),!1}.bind(this),r=t.pageX-Ni(document).scrollLeft(),s=t.pageY-Ni(document).scrollTop(),a=Ni("<ul></ul>").hide().addClass("context-menu-list").addClass(n.className).addClass("context-menu-root").css({left:r,top:s}).appendTo(e.appendTo);for(const e in n.items)a.append(this.createItem(n.items[e],"context-menu-root",e,2,o));return a[e.animation.show](e.animation.duration),a.offset().left-Ni(document).scrollLeft()+a.outerWidth()>Ni(window).width()&&a.offset({left:Ni(document).scrollLeft()+Math.max(0,Ni(window).width()-a.outerWidth())}),a.offset().top-Ni(document).scrollTop()+a.outerHeight()>Ni(window).height()&&a.offset({top:Ni(document).scrollTop()+Math.max(0,Ni(window).height()-a.outerHeight())}),a.find("ul").each((function(e,t){const n=(t=Ni(t)).outerWidth()+a.outerWidth(),i=a.offset().left-Ni(document).scrollLeft()+n>Ni(window).width()?"right":"left";t.css("width",t.outerWidth()),t.css(i,t.parent().closest("ul").width()),t.outerHeight()>=Ni(window).height()&&t.css({"max-height":"100vh","overflow-y":"scroll"})})),a.find("li").on("mouseenter touchstart",(function(e){e.stopImmediatePropagation();const t=Ni(e.target).closest("li").children("ul");if(!t.length)return;t.css("top","");const n=t.offset().top+t.outerHeight()-Ni(window).scrollTop()-Ni(window).height();n>0&&t.offset({top:t.offset().top-n})})),i.on("click contextmenu",o),a.on("contextmenu",o),e.events&&"function"==typeof e.events.show&&e.events.show(a),!1},createItem:function(e,t,n,i,o){const r=Ni("<li></li>").addClass("context-menu-item");switch(typeof e){case"string":e.match(/^-+$/)&&r.addClass(["context-menu-separator","context-menu-not-selectable"]);break;case"object":switch(e.className&&r.addClass(e.className),e.type){case"radio":case"checkbox":{const n=Ni("<label></label>").appendTo(r),i=Ni("<input></input>").appendTo(n);i.attr("type",e.type).attr("name","context-menu-input-"+(e.radio||t)),Ni("<span></span>").text(e.name).appendTo(n),e.selected&&i.attr("checked","checked");for(const t in e.events)"function"==typeof e.events[t]&&i.on(t,e.events[t]);r.addClass("context-menu-input");break}default:e.name&&Ni("<span></span>").text(e.name).appendTo(r),"function"==typeof e.callback&&r.on("click",e.callback).on("click",o)}}if("object"==typeof e.items&&i<3){const t=Ni("<ul></ul>").addClass("context-menu-list").css({"z-index":i}).appendTo(r);for(const r in e.items)t.append(this.createItem(e.items[r],n,r,i+1,o));r.addClass("context-menu-submenu")}return r}});const Di=Mi,Ii=new Map,Ri=new Map,Vi={addNodeTypeName:function(e){Ii.set(e,e),Ii.set(e.toUpperCase(),e)},getNodeTypeName:function(e){return Ii.get(e)},addFieldName:function(e){Ri.set(e,e),Ri.set(e.toLowerCase(),e)},getFieldName:function(e){return Ri.get(e)}},Pi=new Map,Ai=new Map;let Li=s.X3DBaseNode;function Ui(){}Ui.prototype={addType:function(e,t){s[e]=++Li,Pi.set(e,t),Vi.addNodeTypeName(e);for(const e of t.prototype[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]){const t=e.name;e.accessType&s.initializeOnly&&Vi.addFieldName(t)}},getType:function(e){return Pi.get(e)},getTypes:()=>Array.from(Pi.values()),addAbstractType:function(e,t){s[e]=++Li,Ai.set(e,t)},getAbstractType:function(e){return Ai.get(e)},getAbstractTypes:()=>Array.from(Ai.values())};for(const e of Reflect.ownKeys(Ui.prototype))Object.defineProperty(Ui.prototype,e,{enumerable:!1});const Bi=new Ui;function Xi(e){return R.call(this,e)}Xi.prototype=Object.assign(Object.create(R.prototype),{constructor:Xi,getTypeName:function(){return"NamedNodesArray"}});for(const e of Reflect.ownKeys(Xi.prototype))Object.defineProperty(Xi.prototype,e,{enumerable:!1});const ki=Xi;function zi(e){Jn.call(this,e),this.addType(s.X3DNode)}zi.prototype=Object.assign(Object.create(Jn.prototype),{constructor:zi,copy:function(e){if(!e||e.getType().includes(s.X3DExecutionContext))return Jn.prototype.copy.call(this,e);{const t=e.getBody();if(this.getName().length){const e=t.getNamedNodes().get(this.getName());if(e)return e}const n=this.create(t);this.getNeedsName()&&this.getExecutionContext().updateNamedNode(this.getExecutionContext().getUniqueName(),this),this.getName().length&&t.updateNamedNode(this.getName(),n);for(const t of this.getPredefinedFields())try{const i=n.getField(t.getName());if(t.hasReferences())for(const n of t.getReferences())try{i.addReference(e.getField(n.getName()))}catch(e){console.error(e.message)}else if(t.getAccessType()&s.initializeOnly)switch(t.getType()){case s.SFNode:case s.MFNode:i.assign(t.copy(e));break;default:i.assign(t)}i.setModificationTime(t.getModificationTime())}catch(e){console.log(e.message)}for(const t of this.getUserDefinedFields()){const i=t.copy(e);if(n.addUserDefinedField(t.getAccessType(),t.getName(),i),t.hasReferences())for(const n of t.getReferences())try{i.addReference(e.getField(n.getName()))}catch(t){console.error("No reference '"+n.getName()+"' inside execution context "+e.getTypeName()+" '"+e.getName()+"'.")}i.setModificationTime(t.getModificationTime())}return n.setup(),n}},getDisplayName:function(){const e=/_\d+$/;return function(){return this.getName().replace(e,"")}}(),getNeedsName:function(){if(this.getName().length)return!1;if(this.getCloneCount()>1)return!0;if(this.hasRoutes())return!0;const e=this.getExecutionContext();for(const t of e.getImportedNodes())if(t.getInlineNode()===this)return!0;if(e.isScene())for(const t of e.getExportedNodes())if(t.getLocalNode()===this)return!0;return!1},getFieldsAreEnumerable:function(){return!0},traverse:function(){},toStream:function(e){e.string+=this.getTypeName()+" { }"},toVRMLStream:function(e){const t=u.Get(e);t.EnterScope();const n=t.Name(this);if(n.length&&t.ExistsNode(this))return e.string+="USE",e.string+=" ",e.string+=n,void t.LeaveScope();n.length&&(t.AddNode(this),e.string+="DEF",e.string+=" ",e.string+=n,e.string+=" "),e.string+=this.getTypeName(),e.string+=" ",e.string+="{";const i=this.getChangedFields(),o=this.getUserDefinedFields();let r=0,s=0;if(this.canUserDefinedFields()){for(const e of o)r=Math.max(r,e.getTypeName().length),s=Math.max(s,t.AccessType(e.getAccessType()).length);if(o.length){e.string+="\n",t.IncIndent();for(const t of o)this.toVRMLStreamUserDefinedField(e,t,r,s),e.string+="\n";t.DecIndent(),0!==i.length&&(e.string+="\n")}}0===i.length?o.length?e.string+=t.Indent():e.string+=" ":(0===o.length&&(e.string+="\n"),t.IncIndent(),i.forEach((function(t){this.toVRMLStreamField(e,t,r,s),e.string+="\n"}),this),t.DecIndent(),e.string+=t.Indent()),e.string+="}",t.LeaveScope()},toVRMLStreamField:function(e,t,n,i){const o=u.Get(e),r=o.IsSharedNode(this);if(0===t.getReferences().size||!o.ExecutionContext()||r)t.isInitializable()&&(e.string+=o.Indent(),e.string+=t.getName(),e.string+=" ",t.toVRMLStream(e));else{let n=0,i=!1;t.getReferences().forEach((function(r){i||=r.isInitializable(),e.string+=o.Indent(),e.string+=t.getName(),e.string+=" ",e.string+="IS",e.string+=" ",e.string+=r.getName(),++n,n!==t.getReferences().size&&(e.string+="\n")})),t.getAccessType()!==s.inputOutput||i||this.isDefaultValue(t)||(e.string+="\n",e.string+=o.Indent(),e.string+=t.getName(),e.string+=" ",t.toVRMLStream(e))}},toVRMLStreamUserDefinedField:function(e,t,n,i){const o=u.Get(e),r=o.IsSharedNode(this);if(0===t.getReferences().size||!o.ExecutionContext()||r)e.string+=o.Indent(),e.string+=o.PadRight(o.AccessType(t.getAccessType()),i),e.string+=" ",e.string+=o.PadRight(t.getTypeName(),n),e.string+=" ",e.string+=t.getName(),t.isInitializable()&&(e.string+=" ",t.toVRMLStream(e));else{let r=0,a=!1;t.getReferences().forEach((function(s){a||=s.isInitializable(),e.string+=o.Indent(),e.string+=o.PadRight(o.AccessType(t.getAccessType()),i),e.string+=" ",e.string+=o.PadRight(t.getTypeName(),n),e.string+=" ",e.string+=t.getName(),e.string+=" ",e.string+="IS",e.string+=" ",e.string+=s.getName(),++r,r!==t.getReferences().size&&(e.string+="\n")})),t.getAccessType()!==s.inputOutput||a||t.isDefaultValue()||(e.string+="\n",e.string+=o.Indent(),e.string+=o.PadRight(o.AccessType(t.getAccessType()),i),e.string+=" ",e.string+=o.PadRight(t.getTypeName(),n),e.string+=" ",e.string+=t.getName(),t.isInitializable()&&(e.string+=" ",t.toVRMLStream(e)))}},toXMLStream:function(e){const t=u.Get(e),n=t.IsSharedNode(this);t.EnterScope();const i=t.Name(this);if(i.length&&t.ExistsNode(this)){e.string+=t.Indent(),e.string+="<",e.string+=this.getTypeName(),e.string+=" ",e.string+="USE='",e.string+=t.XMLEncode(i),e.string+="'";const n=t.ContainerField();return n&&n.getName()!==this.getContainerField()&&(e.string+=" ",e.string+="containerField='",e.string+=t.XMLEncode(n.getName()),e.string+="'"),e.string+="/>",void t.LeaveScope()}e.string+=t.Indent(),e.string+="<",e.string+=this.getTypeName(),i.length&&(t.AddNode(this),e.string+=" ",e.string+="DEF='",e.string+=t.XMLEncode(i),e.string+="'");const o=t.ContainerField();o&&o.getName()!==this.getContainerField()&&(e.string+=" ",e.string+="containerField='",e.string+=t.XMLEncode(o.getName()),e.string+="'");const r=this.getChangedFields(),a=this.getUserDefinedFields(),l=[],c=[];let h=this.getSourceText();h&&0===h.length&&(h=null),t.IncIndent(),t.IncIndent();for(const i of r){let o=!1;if(t.ExecutionContext()&&i.getAccessType()===s.inputOutput&&0!==i.getReferences().size){let e=!1;i.getReferences().forEach((function(t){e||=t.isInitializable()})),e||(o=!this.isDefaultValue(i))}if(0===i.getReferences().size||!t.ExecutionContext()||n||o){if(o&&l.push(i),i.isInitializable())switch(i.getType()){case s.SFNode:case s.MFNode:c.push(i);break;default:if(i===h)break;e.string+="\n",e.string+=t.Indent(),e.string+=i.getName(),e.string+="='",i.toXMLStream(e),e.string+="'"}}else l.push(i)}if(t.DecIndent(),t.DecIndent(),this.canUserDefinedFields()&&a.length||l.length&&!n||c.length||h){if(e.string+=">\n",t.IncIndent(),this.canUserDefinedFields())for(const i of a){e.string+=t.Indent(),e.string+="<field",e.string+=" ",e.string+="accessType='",e.string+=t.AccessType(i.getAccessType()),e.string+="'",e.string+=" ",e.string+="type='",e.string+=i.getTypeName(),e.string+="'",e.string+=" ",e.string+="name='",e.string+=t.XMLEncode(i.getName()),e.string+="'";let o=!1;if(i.getAccessType()===s.inputOutput&&0!==i.getReferences().size){let e=!1;i.getReferences().forEach((function(t){e||=t.isInitializable()})),e||(o=!0)}if(0===i.getReferences().size||!t.ExecutionContext()||n||o)if(o&&t.ExecutionContext()&&l.push(i),!i.isInitializable()||i.isDefaultValue())e.string+="/>\n";else switch(i.getType()){case s.SFNode:case s.MFNode:t.PushContainerField(i),e.string+=">\n",t.IncIndent(),i.toXMLStream(e),e.string+="\n",t.DecIndent(),e.string+=t.Indent(),e.string+="</field>\n",t.PopContainerField();break;default:e.string+=" ",e.string+="value='",i.toXMLStream(e),e.string+="'",e.string+="/>\n"}else t.ExecutionContext()&&l.push(i),e.string+="/>\n"}if(l.length&&!n){e.string+=t.Indent(),e.string+="<IS>",e.string+="\n",t.IncIndent();for(const n of l){n.getReferences().forEach((function(i){e.string+=t.Indent(),e.string+="<connect",e.string+=" ",e.string+="nodeField='",e.string+=t.XMLEncode(n.getName()),e.string+="'",e.string+=" ",e.string+="protoField='",e.string+=t.XMLEncode(i.getName()),e.string+="'",e.string+="/>\n"}))}t.DecIndent(),e.string+=t.Indent(),e.string+="</IS>\n"}for(const n of c)t.PushContainerField(n),n.toXMLStream(e),e.string+="\n",t.PopContainerField();if(h)for(const n of h)e.string+="<![CDATA[",e.string+=t.escapeCDATA(n),e.string+="]]>\n";t.DecIndent(),e.string+=t.Indent(),e.string+="</",e.string+=this.getTypeName(),e.string+=">"}else e.string+="/>";t.LeaveScope()},dispose:function(){const e=this.getExecutionContext();if(this.getName()&&e.removeNamedNode(this.getName()),!e.isMainScene()){const t=e.getExecutionContext();for(const e of t.getImportedNodes())try{e.getExportedNode()===this&&t.removeImportedNode(e.getImportedName())}catch(e){}}if(e.isScene())for(const t of e.getExportedNodes())t.getLocalNode()===this&&e.removeExportedNode(t.getExportedName());for(const e of new Set(this.getParents()))if(e instanceof Bn.SFNode){for(const t of new Set(e.getParents()))if(t instanceof Bn.MFNode){const n=t.length;t.erase(t.remove(0,n,e),n)}e.setValue(null)}Jn.prototype.dispose.call(this)}});const ji=zi,Gi=Symbol(),Hi=Symbol(),qi=Symbol(),Wi=Symbol();function Yi(e,t,n,i){ji.call(this,e),this[Gi]=t,this[Hi]=n,this[qi]=i,this[Wi]=new Set,this[Gi]._loadState.addInterest("set_loadState__",this)}Yi.prototype=Object.assign(Object.create(ji.prototype),{constructor:Yi,getInlineNode:function(){return this[Gi]},getExportedName:function(){return this[Hi]},getExportedNode:function(){return this[Gi].getInternalScene().getExportedNode(this[Hi]).getValue()},getImportedName:function(){return this[qi]},addRoute:function(e,t,n,i){const o={sourceNode:e,sourceField:t,destinationNode:n,destinationField:i};this[Wi].add(o),this[Gi].checkLoadState()===s.COMPLETE_STATE&&this.resolveRoute(o)},resolveRoute:function(e){try{const t=e.sourceField,n=e.destinationField;let i=e.sourceNode,o=e.destinationNode;e.real&&e.real.dispose(),i instanceof Yi&&(i=i.getExportedNode()),o instanceof Yi&&(o=o.getExportedNode()),e.real=this.getExecutionContext().addSimpleRoute(i,t,o,n)}catch(e){console.error(e.message)}},deleteRoute:function(e){for(const t of this[Wi])t.real===e&&this[Wi].delete(t)},deleteRoutes:function(){for(const e of this[Wi]){const t=e.real;t&&(delete e.real,this.getExecutionContext().deleteSimpleRoute(t))}},set_loadState__:function(){switch(this[Gi].checkLoadState()){case s.NOT_STARTED_STATE:case s.FAILED_STATE:this.deleteRoutes();break;case s.COMPLETE_STATE:this.deleteRoutes();for(const e of this[Wi])this.resolveRoute(e)}},toVRMLStream:function(e){const t=u.Get(e);if(!t.ExistsNode(this.getInlineNode()))throw new Error("X3DImportedNode.toXMLStream: Inline node does not exist.");e.string+=t.Indent(),e.string+="IMPORT",e.string+=" ",e.string+=t.Name(this.getInlineNode()),e.string+=".",e.string+=this.getExportedName(),this.getImportedName()!==this.getExportedName()&&(e.string+=" ",e.string+="AS",e.string+=" ",e.string+=this.getImportedName());try{t.AddRouteNode(this),t.AddImportedNode(this.getExportedNode(),this.getImportedName())}catch(n){for(const n of this[Wi]){const i=n.sourceNode,o=n.sourceField,r=n.destinationNode,s=n.destinationField;if(t.ExistsRouteNode(i)&&t.ExistsRouteNode(r)){const n=i instanceof Yi?i.getImportedName():t.Name(i),a=r instanceof Yi?r.getImportedName():t.Name(r);e.string+="\n",e.string+="\n",e.string+=t.Indent(),e.string+="ROUTE",e.string+=" ",e.string+=n,e.string+=".",e.string+=o,e.string+=" ",e.string+="TO",e.string+=" ",e.string+=a,e.string+=".",e.string+=s}}}},toXMLStream:function(e){const t=u.Get(e);if(!t.ExistsNode(this.getInlineNode()))throw new Error("X3DImportedNode.toXMLStream: Inline node does not exist.");e.string+=t.Indent(),e.string+="<IMPORT",e.string+=" ",e.string+="inlineDEF='",e.string+=t.XMLEncode(t.Name(this.getInlineNode())),e.string+="'",e.string+=" ",e.string+="importedDEF='",e.string+=t.XMLEncode(this.getExportedName()),e.string+="'",this.getImportedName()!==this.getExportedName()&&(e.string+=" ",e.string+="AS='",e.string+=t.XMLEncode(this.getImportedName()),e.string+="'"),e.string+="/>";try{t.AddRouteNode(this),t.AddImportedNode(this.getExportedNode(),this.getImportedName())}catch(n){for(const n of this[Wi]){const i=n.sourceNode,o=n.sourceField,r=n.destinationNode,s=n.destinationField;if(t.ExistsRouteNode(i)&&t.ExistsRouteNode(r)){const n=i instanceof Yi?i.getImportedName():t.Name(i),a=r instanceof Yi?r.getImportedName():t.Name(r);e.string+="\n",e.string+="\n",e.string+=t.Indent(),e.string+="<ROUTE",e.string+=" ",e.string+="fromNode='",e.string+=t.XMLEncode(n),e.string+="'",e.string+=" ",e.string+="fromField='",e.string+=t.XMLEncode(o),e.string+="'",e.string+=" ",e.string+="toNode='",e.string+=t.XMLEncode(a),e.string+="'",e.string+=" ",e.string+="toField='",e.string+=t.XMLEncode(s),e.string+="'",e.string+="/>"}}}},dispose:function(){this[Gi]._loadState.removeInterest("set_loadState__",this),this.deleteRoutes(),ji.prototype.dispose.call(this)}});for(const e of Reflect.ownKeys(Yi.prototype))Object.defineProperty(Yi.prototype,e,{enumerable:!1});Object.defineProperty(Yi.prototype,"inlineNode",{get:function(){return Rt.get(this[Gi])},enumerable:!0,configurable:!1}),Object.defineProperty(Yi.prototype,"exportedName",{get:function(){return this[Hi]},enumerable:!0,configurable:!1}),Object.defineProperty(Yi.prototype,"exportedNode",{get:function(){return this[Gi].getInternalScene().getExportedNode(this[Hi])},enumerable:!0,configurable:!1}),Object.defineProperty(Yi.prototype,"importedName",{get:function(){return this[qi]},enumerable:!0,configurable:!1});const Ki=Yi;function Zi(e){return R.call(this,e)}Zi.prototype=Object.assign(Object.create(R.prototype),{constructor:Zi,getTypeName:function(){return"ImportedNodesArray"}});for(const e of Reflect.ownKeys(Zi.prototype))Object.defineProperty(Zi.prototype,e,{enumerable:!1});const Qi=Zi;function $i(e){return R.call(this,e)}$i.prototype=Object.assign(Object.create(R.prototype),{constructor:$i,getTypeName:function(){return"ExternProtoDeclarationArray"}});for(const e of Reflect.ownKeys($i.prototype))Object.defineProperty($i.prototype,e,{enumerable:!1});const Ji=$i;function eo(e){return R.call(this,e)}eo.prototype=Object.assign(Object.create(R.prototype),{constructor:eo,getTypeName:function(){return"ProtoDeclarationArray"}});for(const e of Reflect.ownKeys(eo.prototype))Object.defineProperty(eo.prototype,e,{enumerable:!1});const to=eo,no=Symbol(),io=Symbol(),oo=Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions"),ro=Symbol();function so(e,t){this[no]=t,this[io]=new Map(t.getFields().map((e=>[e,e.getName()]))),this[oo]=t.getFieldDefinitions(),this[ro]=null,ji.call(this,e),this.addType(s.X3DPrototypeInstance)}so.prototype=Object.assign(Object.create(ji.prototype),{constructor:so,create:function(e){return new so(e,this[no])},getTypeName:function(){return this[no].getName()},getComponentName:function(){return"Core"},getContainerField:function(){return"children"},initialize:function(){ji.prototype.initialize.call(this),this.setProtoNode(this[no])},construct:function(){this[ro]&&this[ro].dispose();const e=this[no].getProtoDeclaration();if(!e)return this[ro]=new Ca(this.getExecutionContext()),this[ro].setOuterNode(this),this[ro].setup(),void(this.isInitialized()&&w.prototype.addEvent.call(this));if(this[no].isExternProto)for(const t of e.getUserDefinedFields())try{const e=this.getField(t.getName());if(e.getAccessType()!==t.getAccessType())continue;if(e.getType()!==t.getType())continue;if(!e.isInitializable())continue;if(e.getModificationTime())continue;if(e.hasReferences())continue;if(e.equals(t))continue;e.assign(t)}catch(n){this.addField(e.getFieldDefinitions().get(t.getName()))}this[ro]=new Ca(e.getExecutionContext()),this[ro].setOuterNode(this),this.importExternProtos(e.getBody().externprotos),this.importProtos(e.getBody().protos),this.copyRootNodes(e.getBody().rootNodes),this.copyImportedNodes(e.getBody(),e.getBody().getImportedNodes()),this.copyRoutes(e.getBody(),e.getBody().routes),this[ro].setup(),this.isInitialized()&&w.prototype.addEvent.call(this),this[no]._updateInstances.removeInterest("construct",this),this[no]._updateInstances.addInterest("update",this)},update:function(){const e=this[io],t=new Map(this.getFields().map((e=>[e.getName(),e])));for(const e of t.values())this.removeField(e.getName());this[io]=new Map(this[no].getFields().map((e=>[e,e.getName()])));for(const e of this.getFieldDefinitions())this.addField(e);for(const n of this[io].keys()){const i=e.get(n);if(!i)continue;const o=this.getFields().get(n.getName()),r=t.get(i);r.addParent(this),r.setAccessType(o.getAccessType()),r.setName(o.getName()),this.getPredefinedFields().update(o.getName(),o.getName(),r),this.getFields().update(o.getName(),o.getName(),r),this.isPrivate()||r.addCloneCount(1),t.delete(i),o.dispose()}for(const e of t.values())e.dispose();this.construct()},getExtendedEventHandling:function(){return!1},getProtoNode:function(){return this[no]},setProtoNode:function(e){if(e!==this[no]){if(this[no]){const e=this[no];e._name_changed.removeFieldInterest(this._typeName_changed),e._updateInstances.removeInterest("construct",this),e._updateInstances.removeInterest("update",this)}this[io]=new Map(e.getFields().map((e=>[e,e.getName()]))),this[oo]=e.getFieldDefinitions()}this[no]=e,e._name_changed.addFieldInterest(this._typeName_changed);const t=this.getExecutionContext().getOuterNode();t&&t.getType().includes(s.X3DProtoDeclaration)||(e.isExternProto?this[no].checkLoadState()===s.COMPLETE_STATE?this.construct():(e._updateInstances.addInterest("construct",this),e.requestImmediateLoad()):this.construct())},getBody:function(){return this[ro]},getInnerNode:function(){const e=this[ro].getRootNodes().getValue();if(e.length){const t=e[0];if(t)return t.getValue().getInnerNode()}throw new Error("Root node not available.")},importExternProtos:function(e){const t=this[ro].externprotos;for(const n of e)t.add(n.getName(),n)},importProtos:function(e){const t=this[ro].protos;for(const n of e)t.add(n.getName(),n)},copyRootNodes:function(e){const t=this[ro].getRootNodes();for(const n of e)t.push(n.copy(this))},copyImportedNodes:function(e,t){for(const e of t)try{const t=this[ro].getNamedNode(e.getInlineNode().getName()),n=e.getImportedName(),i=e.getExportedName();this[ro].addImportedNode(t,i,n)}catch(e){console.error("Bad IMPORT specification in copy: ",e)}},copyRoutes:function(e,t){for(const n of t)try{const t=this[ro].getLocalNode(e.getLocalName(n.sourceNode)),i=this[ro].getLocalNode(e.getLocalName(n.destinationNode));this[ro].addRoute(t,n.sourceField,i,n.destinationField)}catch(e){console.error(e)}},toXMLStream:function(e){const t=u.Get(e),n=t.IsSharedNode(this);t.EnterScope();const i=t.Name(this);if(i.length&&t.ExistsNode(this)){e.string+=t.Indent(),e.string+="<ProtoInstance",e.string+=" ",e.string+="name='",e.string+=t.XMLEncode(this.getTypeName()),e.string+="'",e.string+=" ",e.string+="USE='",e.string+=t.XMLEncode(i),e.string+="'";const n=t.ContainerField();return n&&n.getName()!==this.getContainerField()&&(e.string+=" ",e.string+="containerField='",e.string+=t.XMLEncode(n.getName()),e.string+="'"),e.string+="/>",void t.LeaveScope()}e.string+=t.Indent(),e.string+="<ProtoInstance",e.string+=" ",e.string+="name='",e.string+=t.XMLEncode(this.getTypeName()),e.string+="'",i.length&&(t.AddNode(this),e.string+=" ",e.string+="DEF='",e.string+=t.XMLEncode(i),e.string+="'");const o=t.ContainerField();o&&o.getName()!==this.getContainerField()&&(e.string+=" ",e.string+="containerField='",e.string+=t.XMLEncode(o.getName()),e.string+="'");const r=this.getChangedFields();if(0===r.length)e.string+="/>";else{e.string+=">\n",t.IncIndent();const i=[];for(const o of r){let r=!1;if(t.ExecutionContext()&&o.getAccessType()===s.inputOutput&&0!==o.getReferences().size){let e=!1;o.getReferences().forEach((function(t){e||=t.isInitializable()})),e||(r=!this.isDefaultValue(o))}if(0===o.getReferences().size||!t.ExecutionContext()||n||r)switch(r&&i.push(o),o.getType()){case s.MFNode:e.string+=t.Indent(),e.string+="<fieldValue",e.string+=" ",e.string+="name='",e.string+=t.XMLEncode(o.getName()),e.string+="'",0===o.length?e.string+="/>\n":(t.PushContainerField(o),e.string+=">\n",t.IncIndent(),o.toXMLStream(e),e.string+="\n",t.DecIndent(),e.string+=t.Indent(),e.string+="</fieldValue>\n",t.PopContainerField());break;case s.SFNode:if(null!==o.getValue()){t.PushContainerField(o),e.string+=t.Indent(),e.string+="<fieldValue",e.string+=" ",e.string+="name='",e.string+=t.XMLEncode(o.getName()),e.string+="'",e.string+=">\n",t.IncIndent(),o.toXMLStream(e),e.string+="\n",t.DecIndent(),e.string+=t.Indent(),e.string+="</fieldValue>\n",t.PopContainerField();break}default:e.string+=t.Indent(),e.string+="<fieldValue",e.string+=" ",e.string+="name='",e.string+=t.XMLEncode(o.getName()),e.string+="'",e.string+=" ",e.string+="value='",o.toXMLStream(e),e.string+="'",e.string+="/>\n"}else i.push(o)}if(i.length&&!n){e.string+=t.Indent(),e.string+="<IS>",e.string+="\n",t.IncIndent();for(const n of i){n.getReferences().forEach((function(i){e.string+=t.Indent(),e.string+="<connect",e.string+=" ",e.string+="nodeField='",e.string+=t.XMLEncode(n.getName()),e.string+="'",e.string+=" ",e.string+="protoField='",e.string+=t.XMLEncode(i.getName()),e.string+="'",e.string+="/>\n"}))}t.DecIndent(),e.string+=t.Indent(),e.string+="</IS>\n"}t.DecIndent(),e.string+=t.Indent(),e.string+="</ProtoInstance>"}t.LeaveScope()},dispose:function(){this[no]._updateInstances.removeInterest("construct",this),this[no]._updateInstances.removeInterest("update",this),this[ro]&&this[ro].dispose(),ji.prototype.dispose.call(this)}});const ao=so;function uo(e){Jn.call(this,e),this.addType(s.X3DProtoDeclarationNode),this.addChildObjects("updateInstances",new Bn.SFTime)}Bi.addAbstractType("X3DProtoDeclarationNode",uo),uo.prototype=Object.assign(Object.create(Jn.prototype),{constructor:uo,canUserDefinedFields:function(){return!0},createInstance:function(e,t=!0){if(!1===t)return new ao(e,this);{const t=new ao(e,this);return t.setup(),Rt.get(t)}},newInstance:function(){return this.createInstance(this.getExecutionContext())},requestUpdateInstances:function(){this._updateInstances=this.getBrowser().getCurrentTime()},updateInstances:function(){this._updateInstances.processEvent()}});for(const e of Reflect.ownKeys(uo.prototype))Object.defineProperty(uo.prototype,e,{enumerable:!1});const lo=uo;Bi.addAbstractType("X3DProtoDeclaration",ho);const co=Symbol();function ho(e){lo.call(this,e),this.addType(s.X3DProtoDeclaration),this.addChildObjects("loadState",new Bn.SFInt32(s.NOT_STARTED_STATE)),this[co]=new Ca(e),this[co].setOuterNode(this),this[co].setLive(!1),this.setLive(!1)}ho.prototype=Object.assign(Object.create(lo.prototype),{constructor:ho,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new P([new N(s.inputOutput,"metadata",new Bn.SFNode)]),getTypeName:function(){return"X3DProtoDeclaration"},initialize:function(){lo.prototype.initialize.call(this),this[co].setup(),this._loadState=s.COMPLETE_STATE},getProtoDeclaration:function(){return this},getBody:function(){return this[co]},checkLoadState:function(){return this._loadState.getValue()},canUserDefinedFields:function(){return!0},toVRMLStream:function(e){const t=u.Get(e);e.string+=t.Indent(),e.string+="PROTO",e.string+=" ",e.string+=this.getName(),e.string+=" ",e.string+="[",t.EnterScope();const n=this.getUserDefinedFields();let i=0,o=0;if(0===n.length)e.string+=" ";else{for(const e of n)i=Math.max(i,e.getTypeName().length),o=Math.max(o,t.AccessType(e.getAccessType()).length);e.string+="\n",t.IncIndent();for(const t of n)this.toVRMLStreamUserDefinedField(e,t,i,o),e.string+="\n";t.DecIndent(),e.string+=t.Indent()}t.LeaveScope(),e.string+="]",e.string+="\n",e.string+=t.Indent(),e.string+="{",e.string+="\n",t.IncIndent(),this[co].toVRMLStream(e),t.DecIndent(),e.string+=t.Indent(),e.string+="}"},toVRMLStreamUserDefinedField:function(e,t,n,i){const o=u.Get(e);e.string+=o.Indent(),e.string+=o.PadRight(o.AccessType(t.getAccessType()),i),e.string+=" ",e.string+=o.PadRight(t.getTypeName(),n),e.string+=" ",e.string+=t.getName(),t.isInitializable()&&(e.string+=" ",t.toVRMLStream(e))},toXMLStream:function(e){const t=u.Get(e);e.string+=t.Indent(),e.string+="<ProtoDeclare",e.string+=" ",e.string+="name='",e.string+=t.XMLEncode(this.getName()),e.string+="'",e.string+=">",e.string+="\n",t.EnterScope();const n=this.getUserDefinedFields();if(0!==n.length){t.IncIndent(),e.string+=t.Indent(),e.string+="<ProtoInterface>\n",t.IncIndent();for(const i of n)if(e.string+=t.Indent(),e.string+="<field",e.string+=" ",e.string+="accessType='",e.string+=t.AccessType(i.getAccessType()),e.string+="'",e.string+=" ",e.string+="type='",e.string+=i.getTypeName(),e.string+="'",e.string+=" ",e.string+="name='",e.string+=t.XMLEncode(i.getName()),e.string+="'",i.isDefaultValue())e.string+="/>\n";else switch(i.getType()){case s.SFNode:case s.MFNode:t.PushContainerField(i),e.string+=">\n",t.IncIndent(),i.toXMLStream(e),e.string+="\n",t.DecIndent(),e.string+=t.Indent(),e.string+="</field>\n",t.PopContainerField();break;default:e.string+=" ",e.string+="value='",i.toXMLStream(e),e.string+="'",e.string+="/>\n"}t.DecIndent(),e.string+=t.Indent(),e.string+="</ProtoInterface>\n",t.DecIndent()}t.LeaveScope(),t.IncIndent(),e.string+=t.Indent(),e.string+="<ProtoBody>\n",t.IncIndent(),this[co].toXMLStream(e),t.DecIndent(),e.string+=t.Indent(),e.string+="</ProtoBody>\n",t.DecIndent(),e.string+=t.Indent(),e.string+="</ProtoDeclare>"}});for(const e of Reflect.ownKeys(ho.prototype))Object.defineProperty(ho.prototype,e,{enumerable:!1});Object.defineProperty(ho.prototype,"name",{get:function(){return this.getName()},enumerable:!0,configurable:!1}),Object.defineProperty(ho.prototype,"fields",{get:function(){return this.getFieldDefinitions()},enumerable:!0,configurable:!1}),Object.defineProperty(ho.prototype,"isExternProto",{get:function(){return!1},enumerable:!0,configurable:!1});const po=ho,fo=Symbol(),go=Symbol(),mo=Symbol(),_o=Symbol();function yo(e){this.addType(s.X3DUrlObject),this.addChildObjects("loadState",new Bn.SFInt32(s.NOT_STARTED_STATE),"loadNow",new Bn.SFTime),this[fo]=!0,this[go]=Date.now()}yo.prototype={constructor:yo,initialize:function(){this.isLive().addInterest("set_live__",this),this._load.addInterest("set_load__",this),this._url.addInterest("set_url__",this),this._loadNow.addInterest("loadNow",this),this._autoRefresh.addInterest("set_autoRefresh__",this),this._autoRefreshTimeLimit.addInterest("set_autoRefresh__",this)},setLoadState:function(e,t=!0){if(this._loadState=e,e===s.COMPLETE_STATE&&(this[mo]=Date.now(),this.setAutoRefreshTimer(this._autoRefresh.getValue())),t)switch(e){case s.NOT_STARTED_STATE:break;case s.IN_PROGRESS_STATE:this.getScene().addLoadCount(this);break;case s.COMPLETE_STATE:case s.FAILED_STATE:this.getScene().removeLoadCount(this)}},checkLoadState:function(){return this._loadState.getValue()},getLoadState:function(){return this._loadState},setCache:function(e){this[fo]=e},getCache:function(){return this[fo]},requestImmediateLoad:function(e=!0){const t=this.checkLoadState();t!==s.COMPLETE_STATE&&t!==s.IN_PROGRESS_STATE&&this._load.getValue()&&0!==this._url.length&&(this.setCache(e),this.setLoadState(s.IN_PROGRESS_STATE),this.isInitialized()?this._loadNow=this.getBrowser().getCurrentTime():this.loadNow())},loadNow:function(){},requestUnload:function(){const e=this.checkLoadState();e!==s.NOT_STARTED_STATE&&e!==s.FAILED_STATE&&(this.setLoadState(s.NOT_STARTED_STATE),this.unLoadNow())},unLoadNow:function(){},setAutoRefreshTimer:function(e){if(clearTimeout(this[_o]),this._autoRefresh.getValue()<=0)return;const t=this._autoRefreshTimeLimit.getValue();0!==t&&(Date.now()-this[go])/1e3>t-e||(this[_o]=setTimeout(this.performAutoRefresh.bind(this),1e3*e))},performAutoRefresh:function(){this.setLoadState(s.NOT_STARTED_STATE),this.requestImmediateLoad(!1)},set_live__:function(){this.isLive().getValue()?this.set_autoRefresh__():clearTimeout(this[_o])},set_load__:function(){this._load.getValue()?this.requestImmediateLoad():this.requestUnload()},set_url__:function(){this._load.getValue()&&(this.setLoadState(s.NOT_STARTED_STATE),this.requestImmediateLoad())},set_autoRefresh__:function(){if(this.checkLoadState()!==s.COMPLETE_STATE)return;const e=(Date.now()-this[mo])/1e3,t=this._autoRefresh.getValue();let n=t-e;n<0&&(n=Math.ceil(e/t)*t-e),this.setAutoRefreshTimer(n)},dispose:function(){}};const xo=yo;function wo(e){this.scene=e,this.executionContexts=[e],this.prototypes=[],this.units=!0}wo.prototype={constructor:wo,getScene:function(){return this.scene},getBrowser:function(){return this.scene.getBrowser()},getExecutionContext:function(){return this.executionContexts.at(-1)},pushExecutionContext:function(e){return this.executionContexts.push(e)},popExecutionContext:function(){this.executionContexts.pop()},getPrototype:function(){return this.prototypes.at(-1)},pushPrototype:function(e){return this.prototypes.push(e)},popPrototype:function(){this.prototypes.pop()},isInsideProtoDefinition:function(){return Boolean(this.prototypes.length)},addRootNode:function(e){this.getExecutionContext().rootNodes.push(e)},loadComponents:function(){const e=["Core","EnvironmentalEffects","EnvironmentalSensor","Geometry3D","Grouping","Interpolation","Lighting","Navigation","Networking","PointingDeviceSensor","Rendering","Scripting","Shape","Sound","Text","Texturing","Time"];return function(){const t=this.getBrowser(),n=this.getScene();return"2.0"===n.getSpecificationVersion()?t.loadComponents(e):Promise.all([t.loadComponents(n.getProfile()||[]),t.loadComponents(n.getComponents())])}}(),setUnits:function(e){if("boolean"==typeof arguments[0])return void(this.units=arguments[0]);const t=/Titania\s+V(\d+).*/,n=e.match(t);if(n){if(parseInt(n[1])<4)return void(this.units=!1)}this.units=!0},getUnits:function(){return this.units},fromUnit:function(e,t){return this.units?this.scene.fromUnit(e,t):t}};const vo=wo;var bo={Whitespaces:new RegExp("([\\x20\\n,\\t\\r]+)","gy"),Comment:new RegExp("#(.*?)(?=[\\n\\r])","gy"),Header:new RegExp("^#(VRML|X3D) V(.*?) (utf8)(?:[ \\t]+(.*?))?[ \\t]*[\\n\\r]","gy"),AS:new RegExp("AS","gy"),COMPONENT:new RegExp("COMPONENT","gy"),DEF:new RegExp("DEF","gy"),EXPORT:new RegExp("EXPORT","gy"),EXTERNPROTO:new RegExp("EXTERNPROTO","gy"),FALSE:new RegExp("FALSE|false","gy"),IMPORT:new RegExp("IMPORT","gy"),IS:new RegExp("IS","gy"),META:new RegExp("META","gy"),NULL:new RegExp("NULL","gy"),TRUE:new RegExp("TRUE|true","gy"),PROFILE:new RegExp("PROFILE","gy"),PROTO:new RegExp("PROTO","gy"),ROUTE:new RegExp("ROUTE","gy"),TO:new RegExp("TO","gy"),UNIT:new RegExp("UNIT","gy"),USE:new RegExp("USE","gy"),OpenBrace:new RegExp("\\{","gy"),CloseBrace:new RegExp("\\}","gy"),OpenBracket:new RegExp("\\[","gy"),CloseBracket:new RegExp("\\]","gy"),Period:new RegExp("\\.","gy"),Colon:new RegExp("\\:","gy"),Id:new RegExp("([^\\x30-\\x39\\x00-\\x20\\x22\\x23\\x27\\x2b\\x2c\\x2d\\x2e\\x5b\\x5c\\x5d\\x7b\\x7d\\x7f]{1}[^\\x00-\\x20\\x22\\x23\\x27\\x2c\\x2e\\x5b\\x5c\\x5d\\x7b\\x7d\\x7f]*)","gy"),ComponentNameId:new RegExp("([^\\x30-\\x39\\x00-\\x20\\x22\\x23\\x27\\x2b\\x2c\\x2d\\x2e\\x5b\\x5c\\x5d\\x7b\\x7d\\x7f\\x3a]{1}[^\\x00-\\x20\\x22\\x23\\x27\\x2c\\x2e\\x5b\\x5c\\x5d\\x7b\\x7d\\x7f\\x3a]*)","gy"),initializeOnly:new RegExp("initializeOnly","gy"),inputOnly:new RegExp("inputOnly","gy"),outputOnly:new RegExp("outputOnly","gy"),inputOutput:new RegExp("inputOutput","gy"),field:new RegExp("field","gy"),eventIn:new RegExp("eventIn","gy"),eventOut:new RegExp("eventOut","gy"),exposedField:new RegExp("exposedField","gy"),FieldType:new RegExp("(MFBool|MFColorRGBA|MFColor|MFDouble|MFFloat|MFImage|MFInt32|MFMatrix3d|MFMatrix3f|MFMatrix4d|MFMatrix4f|MFNode|MFRotation|MFString|MFTime|MFVec2d|MFVec2f|MFVec3d|MFVec3f|MFVec4d|MFVec4f|SFBool|SFColorRGBA|SFColor|SFDouble|SFFloat|SFImage|SFInt32|SFMatrix3d|SFMatrix3f|SFMatrix4d|SFMatrix4f|SFNode|SFRotation|SFString|SFTime|SFVec2d|SFVec2f|SFVec3d|SFVec3f|SFVec4d|SFVec4f)","gy"),int32:new RegExp("((?:0[xX][\\da-fA-F]+)|(?:[+-]?\\d+))","gy"),double:new RegExp("([+-]?(?:(?:(?:\\d*\\.\\d+)|(?:\\d+(?:\\.)?))(?:[eE][+-]?\\d+)?))","gy"),string:new RegExp('"((?:[^\\\\"]|\\\\\\\\|\\\\\\")*)"',"gy"),Inf:new RegExp("[+]?(?:inf|Infinity)","gy"),NegativeInf:new RegExp("-(?:inf|Infinity)","gy"),NaN:new RegExp("[+-]?(nan|NaN)","gy"),Break:new RegExp("\\r?\\n","g")};function So(e){return this.lastIndex=e.lastIndex,e.result=this.exec(e.input),!!e.result&&(e.lastIndex=this.lastIndex,!0)}for(var To in bo)bo[To].parse=So;function Eo(e){vo.call(this,e)}Eo.prototype=Object.assign(Object.create(vo.prototype),{constructor:Eo,accessTypes:{field:s.initializeOnly,eventIn:s.inputOnly,eventOut:s.outputOnly,exposedField:s.inputOutput,initializeOnly:s.initializeOnly,inputOnly:s.inputOnly,outputOnly:s.outputOnly,inputOutput:s.inputOutput},SFBool:new Bn.SFBool,SFColor:new Bn.SFColor,SFColorRGBA:new Bn.SFColorRGBA,SFDouble:new Bn.SFDouble,SFFloat:new Bn.SFFloat,SFImage:new Bn.SFImage,SFInt32:new Bn.SFInt32,SFMatrix3f:new Bn.SFMatrix3f,SFMatrix3d:new Bn.SFMatrix3d,SFMatrix4f:new Bn.SFMatrix4f,SFMatrix4d:new Bn.SFMatrix4d,SFNode:new Bn.SFNode,SFRotation:new Bn.SFRotation,SFString:new Bn.SFString,SFTime:new Bn.SFTime,SFVec2d:new Bn.SFVec2d,SFVec2f:new Bn.SFVec2f,SFVec3d:new Bn.SFVec3d,SFVec3f:new Bn.SFVec3f,SFVec4d:new Bn.SFVec4d,SFVec4f:new Bn.SFVec4f,MFBool:new Bn.MFBool,MFColor:new Bn.MFColor,MFColorRGBA:new Bn.MFColorRGBA,MFDouble:new Bn.MFDouble,MFFloat:new Bn.MFFloat,MFImage:new Bn.MFImage,MFInt32:new Bn.MFInt32,MFMatrix3d:new Bn.MFMatrix3d,MFMatrix3f:new Bn.MFMatrix3f,MFMatrix4d:new Bn.MFMatrix4d,MFMatrix4f:new Bn.MFMatrix4f,MFNode:new Bn.MFNode,MFRotation:new Bn.MFRotation,MFString:new Bn.MFString,MFTime:new Bn.MFTime,MFVec2d:new Bn.MFVec2d,MFVec2f:new Bn.MFVec2f,MFVec3d:new Bn.MFVec3d,MFVec3f:new Bn.MFVec3f,MFVec4d:new Bn.MFVec4d,MFVec4f:new Bn.MFVec4f,isValid:function(){return!!this.input.match(/^(?:#X3D|#VRML|(?:[\x20\n,\t\r]*|#.*?[\r\n])*(PROFILE|COMPONENT|META|UNIT|EXTERNPROTO|PROTO|DEF|NULL|IMPORT|EXPORT|ROUTE|\w+(?:[\x20\n,\t\r]*|#.*?[\r\n])\{|$))/)},getInput:function(){return this.input},setInput:function(e){this.input=e,this.lineNumber=1,this.lastIndex=0},parseIntoScene:function(e,t){try{this.success=e,this.error=t,this.getScene().setEncoding("VRML"),this.getScene().setProfile(this.getBrowser().getProfile("Full")),this.x3dScene()}catch(t){throw new Error(this.getError(t))}},exception:function(e){if(this.getBrowser().isStrict())throw new Error(e);console.warn(e)},getError:function(e){var t=e.message,n=this.getLine(),i=this.getLastLine(),o=this.getLastLine(),r=i.length-n.length+1;return i.length>80&&(i=i.substr(r-40,80),o="",r=40),"\n********************************************************************************\nParser error at line "+this.lineNumber+":"+r+"\nin '"+this.getScene().getWorldURL()+"'\n\n"+o+"\n"+i+"\n"+Array(r).join(" ")+"^\n"+t+"\n********************************************************************************\n"},getLine:function(){for(var e=this.input,t=this.lastIndex,n="";t<e.length&&"\n"!==e[t]&&"\r"!==e[t];)n+=e[t++];return this.lastIndex=t,n},getLastLine:function(){var e=this.input,t=this.lastIndex,n="";for(t<e.length&&("\n"!==e[t]||"\r"!==e[t])&&--t;t>=0&&"\n"!==e[t]&&"\r"!==e[t];)n=e[t--]+n;return this.lastIndex=t,n},comments:function(){for(;this.comment(););},comment:function(){return!!this.whitespaces()||bo.Comment.parse(this)},whitespaces:function(){return!!bo.Whitespaces.parse(this)&&(this.xml||this.lines(this.result[1]),!0)},lines:function(e){var t=e.match(bo.Break);t&&(this.lineNumber+=t.length)},x3dScene:function(){this.headerStatement(),this.profileStatement(),this.componentStatements(),this.unitStatements(),this.metaStatements();try{this.setUnits(this.getScene().getMetaData("generator"))}catch(e){}if(this.success)this.loadComponents().then(function(){try{if(this.statements(),this.lastIndex<this.input.length)throw new Error("Unknown statement.");this.success(this.getScene())}catch(e){this.error(new Error(this.getError(e)))}}.bind(this)).catch(function(e){this.error(e)}.bind(this));else if(this.statements(),this.lastIndex<this.input.length)throw new Error("Unknown statement.")},headerStatement:function(){bo.Header.lastIndex=0;var e=bo.Header.exec(this.input);return!!e&&(this.getScene().setSpecificationVersion(e[2]),this.getScene().setEncoding("VRML"),!0)},profileStatement:function(){if(this.comments(),bo.PROFILE.parse(this)){if(this.profileNameId()){var e=this.getBrowser().getProfile(this.result[1]);return void this.getScene().setProfile(e)}throw new Error("Expected a profile name.")}},componentStatements:function(){for(var e=this.componentStatement();e;)this.getScene().addComponent(e),e=this.componentStatement()},componentStatement:function(){if(this.comments(),bo.COMPONENT.parse(this)){if(this.componentNameId()){var e=this.result[1];if(this.comments(),bo.Colon.parse(this)){if(this.componentSupportLevel()){var t=this.value;return this.getBrowser().getComponent(e,t)}throw new Error("Expected a component support level.")}throw new Error("Expected a ':' after component name.")}throw new Error("Expected a component name.")}return null},componentSupportLevel:function(){return this.int32()},unitStatements:function(){for(;this.unitStatement(););},unitStatement:function(){if(this.comments(),bo.UNIT.parse(this)){if(this.categoryNameId()){var e=this.result[1];if(this.unitNameId()){var t=this.result[1];if(this.unitConversionFactor()){var n=this.value;try{return this.getScene().updateUnit(e,t,n),!0}catch(e){return console.log(e.message),!0}}throw new Error("Expected unit conversion factor.")}throw new Error("Expected unit name identifier.")}throw new Error("Expected category name identifier after UNIT statement.")}return!1},unitConversionFactor:function(){return this.double()},metaStatements:function(){for(;this.metaStatement(););},metaStatement:function(){if(this.comments(),bo.META.parse(this)){if(this.metakey()){var e=this.value;if(this.metavalue()){var t=this.value;return this.getScene().setMetaData(e,t),!0}throw new Error("Expected metadata value.")}throw new Error("Expected metadata key.")}return!1},metakey:function(){return this.string()},metavalue:function(){return this.string()},exportStatement:function(){if(this.comments(),bo.EXPORT.parse(this)){if(this.nodeNameId()){var e=this.result[1],t="";this.comments();var n=this.getScene().getLocalNode(e);if(bo.AS.parse(this)){if(!this.exportedNodeNameId())throw new Error("No name given after AS.");t=this.result[1]}else t=e;if(this.getScene()===this.getExecutionContext())return this.getScene().updateExportedNode(t,n),!0;throw new Error("Export statement not allowed here.")}throw new Error("No name given after EXPORT.")}return!1},importStatement:function(){if(this.comments(),bo.IMPORT.parse(this)){if(this.nodeNameId()){var e=this.result[1],t=this.getExecutionContext().getNamedNode(e);if(this.comments(),bo.Period.parse(this)){if(this.exportedNodeNameId()){var n=this.result[1],i=n;if(this.comments(),bo.AS.parse(this)){if(!this.nodeNameId())throw new Error("No name given after AS.");i=this.result[1]}return this.getExecutionContext().updateImportedNode(t,n,i),!0}throw new Error("Expected exported node name.")}throw new Error("Expected a '.' after exported node name.")}throw new Error("No name given after IMPORT statement.")}return!1},statements:function(){for(;this.statement(););},statement:function(){if(this.protoStatement())return!0;if(this.routeStatement())return!0;if(this.importStatement())return!0;if(this.exportStatement())return!0;var e=this.nodeStatement();return!1!==e&&(this.addRootNode(e),!0)},nodeStatement:function(){if(this.comments(),bo.DEF.parse(this)){if(this.nodeNameId())return this.node(this.result[1]);throw new Error("No name given after DEF.")}if(bo.USE.parse(this)){if(this.nodeNameId())return this.getExecutionContext().getNamedNode(this.result[1]).getValue();throw new Error("No name given after USE.")}return bo.NULL.parse(this)?null:this.node("")},protoStatement:function(){return!!this.proto()||!!this.externproto()},protoStatements:function(){for(;this.protoStatement(););},proto:function(){if(this.comments(),bo.PROTO.parse(this)){if(this.nodeTypeId()){var e=this.result[1];if(this.comments(),bo.OpenBracket.parse(this)){var t=this.interfaceDeclarations();if(this.comments(),bo.CloseBracket.parse(this)){if(this.comments(),bo.OpenBrace.parse(this)){for(var n=new po(this.getExecutionContext()),i=0,o=t.length;i<o;++i){var r=t[i];n.addUserDefinedField(r.getAccessType(),r.getName(),r)}if(this.pushPrototype(n),this.pushExecutionContext(n.getBody()),this.protoBody(),this.popExecutionContext(),this.popPrototype(),this.comments(),bo.CloseBrace.parse(this)){n.setup();try{const t=this.getExecutionContext().getProtoDeclaration(e);this.getExecutionContext().updateProtoDeclaration(this.getExecutionContext().getUniqueProtoName(e),t)}catch(e){}return this.getExecutionContext().updateProtoDeclaration(e,n),!0}throw new Error("Expected a '}' at the end of PROTO body.")}throw new Error("Expected a '{' at the beginning of PROTO body.")}throw new Error("Expected a ']' at the end of PROTO interface declaration.")}throw new Error("Expected a '[' at the beginning of PROTO interface declaration.")}throw new Error("Invalid PROTO definition name.")}return!1},protoBody:function(){this.protoStatements();var e=this.rootNodeStatement();!1!==e&&this.addRootNode(e),this.statements()},rootNodeStatement:function(){if(this.comments(),bo.DEF.parse(this)){if(this.nodeNameId()){var e=this.result[0];if(!1!==(t=this.node(e)))return t;throw new Error("Expected node type name after DEF.")}throw new Error("No name given after DEF.")}var t;return!1!==(t=this.node(""))&&t},interfaceDeclarations:function(){for(var e=[],t=this.interfaceDeclaration();t;)e.push(t),t=this.interfaceDeclaration();return e},restrictedInterfaceDeclaration:function(){if(this.comments(),bo.inputOnly.parse(this)||bo.eventIn.parse(this)){if(this.fieldType()){var e=this.result[1];if(this.inputOnlyId()){var t=this.result[1];return(n=this[e].create()).setAccessType(s.inputOnly),n.setName(t),n}throw new Error("Expected a name for field.")}throw this.Id(),new Error("Unknown event or field type: '"+this.result[1]+"'.")}if(bo.outputOnly.parse(this)||bo.eventOut.parse(this)){if(this.fieldType()){e=this.result[1];if(this.outputOnlyId()){t=this.result[1];return(n=this[e].create()).setAccessType(s.outputOnly),n.setName(t),n}throw new Error("Expected a name for field.")}throw this.Id(),new Error("Unknown event or field type: '"+this.result[1]+"'.")}if(bo.initializeOnly.parse(this)||bo.field.parse(this)){if(this.fieldType()){e=this.result[1];if(this.initializeOnlyId()){t=this.result[1];var n=this[e].create();if(this.fieldValue(n))return n.setAccessType(s.initializeOnly),n.setName(t),n;throw new Error("Couldn't read value for field '"+t+"'.")}throw new Error("Expected a name for field.")}throw this.Id(),new Error("Unknown event or field type: '"+this.result[1]+"'.")}return null},interfaceDeclaration:function(){if(n=this.restrictedInterfaceDeclaration())return n;if(this.comments(),bo.inputOutput.parse(this)||bo.exposedField.parse(this)){if(this.fieldType()){var e=this.result[1];if(this.inputOutputId()){var t=this.result[1],n=this[e].create();if(this.fieldValue(n))return n.setAccessType(s.inputOutput),n.setName(t),n;throw new Error("Couldn't read value for field '"+t+"'.")}throw new Error("Expected a name for field.")}throw this.Id(),new Error("Unknown event or field type: '"+this.result[1]+"'.")}return null},externproto:function(){if(this.comments(),bo.EXTERNPROTO.parse(this)){if(this.nodeTypeId()){var e=this.result[1];if(this.comments(),bo.OpenBracket.parse(this)){var t=this.externInterfaceDeclarations();if(this.comments(),bo.CloseBracket.parse(this)){if(this.URLList(this.MFString)){for(var n=new ua(this.getExecutionContext(),this.MFString),i=0,o=t.length;i<o;++i){var r=t[i];n.addUserDefinedField(r.getAccessType(),r.getName(),r)}n.setup();try{const t=this.getExecutionContext().getExternProtoDeclaration(e);this.getExecutionContext().updateExternProtoDeclaration(this.getExecutionContext().getUniqueExternProtoName(e),t)}catch(e){}return this.getExecutionContext().updateExternProtoDeclaration(e,n),!0}throw new Error("Expected a URL list after EXTERNPROTO interface declaration '"+e+"'.")}throw new Error("Expected a ']' at the end of EXTERNPROTO interface declaration.")}throw new Error("Expected a '[' at the beginning of EXTERNPROTO interface declaration.")}throw new Error("Invalid EXTERNPROTO definition name.")}return!1},externInterfaceDeclarations:function(){for(var e=[],t=this.externInterfaceDeclaration();t;)e.push(t),t=this.externInterfaceDeclaration();return e},externInterfaceDeclaration:function(){if(this.comments(),bo.inputOnly.parse(this)||bo.eventIn.parse(this)){if(this.fieldType()){var e=this.result[1];if(this.inputOnlyId()){var t=this.result[1];return(n=this[e].create()).setAccessType(s.inputOnly),n.setName(t),n}throw new Error("Expected a name for field.")}throw this.Id(),new Error("Unknown event or field type: '"+this.result[1]+"'.")}if(bo.outputOnly.parse(this)||bo.eventOut.parse(this)){if(this.fieldType()){e=this.result[1];if(this.outputOnlyId()){t=this.result[1];return(n=this[e].create()).setAccessType(s.outputOnly),n.setName(t),n}throw new Error("Expected a name for field.")}throw this.Id(),new Error("Unknown event or field type: '"+this.result[1]+"'.")}if(bo.initializeOnly.parse(this)||bo.field.parse(this)){if(this.fieldType()){e=this.result[1];if(this.initializeOnlyId()){t=this.result[1];return(n=this[e].create()).setAccessType(s.initializeOnly),n.setName(t),n}throw new Error("Expected a name for field.")}throw this.Id(),new Error("Unknown event or field type: '"+this.result[1]+"'.")}if(bo.inputOutput.parse(this)||bo.exposedField.parse(this)){if(this.fieldType()){e=this.result[1];if(this.inputOutputId()){var n;t=this.result[1];return(n=this[e].create()).setAccessType(s.inputOutput),n.setName(t),n}throw new Error("Expected a name for field.")}throw this.Id(),new Error("Unknown event or field type: '"+this.result[1]+"'.")}return null},URLList:function(e){return this.mfstringValue(e)},routeStatement:function(){if(this.comments(),bo.ROUTE.parse(this)){if(this.nodeNameId()){var e=this.result[1],t=this.getExecutionContext().getLocalNode(e);if(this.comments(),bo.Period.parse(this)){if(this.outputOnlyId()){var n=this.result[1];if(this.comments(),bo.TO.parse(this)){if(this.nodeNameId()){var i=this.result[1],o=this.getExecutionContext().getLocalNode(i);if(this.comments(),bo.Period.parse(this)){if(this.inputOnlyId())try{var r=this.result[1];return this.getExecutionContext().addRoute(t,n,o,r),!0}catch(e){return this.exception(e.message),!0}throw new Error("Bad ROUTE specification: Expected a field name.")}throw new Error("Bad ROUTE specification: Expected a '.' after node name.")}throw new Error("Bad ROUTE specification: Expected a node name.")}throw new Error("Bad ROUTE specification: Expected a 'TO'.")}throw new Error("Bad ROUTE specification: Expected a field name.")}throw new Error("Bad ROUTE specification: Expected a '.' after node name.")}throw new Error("Bad ROUTE specification: Expected a node name.")}return!1},node:function(e){if(this.nodeTypeId()){var t=this.result[1],n=this.getExecutionContext().createNode(t,!1);if(!n&&!(n=this.getExecutionContext().createProto(t,!1)))throw new Error("Unknown node type or proto '"+t+"', you probably have insufficient component/profile statements.");if(e.length){try{var i=this.getExecutionContext().getNamedNode(e);this.getExecutionContext().updateNamedNode(this.getExecutionContext().getUniqueName(e),i)}catch(e){}this.getExecutionContext().updateNamedNode(e,n)}if(this.comments(),bo.OpenBrace.parse(this)){if(n.canUserDefinedFields()?this.scriptBody(n):this.nodeBody(n),this.comments(),bo.CloseBrace.parse(this))return this.isInsideProtoDefinition()||n.setup(),n;throw new Error("Expected '}' at the end of node body.")}throw new Error("Expected '{' at the beginning of node body.")}return!1},scriptBody:function(e){for(;this.scriptBodyElement(e););},scriptBodyElement:function(e){var t=this.lastIndex,n=this.lineNumber;if(this.Id()){var i=this.accessTypes[this.result[1]];if(i&&this.fieldType()){var o=this.result[1];if(this.Id()){var r=this.result[1];if(this.comments(),bo.IS.parse(this)){if(this.isInsideProtoDefinition()){if(this.Id()){var a=this.result[1];try{var u=this.getPrototype().getField(a)}catch(e){return this.exception("No such event or field '"+a+"' inside PROTO "+this.getPrototype().getName()+" interface declaration."),!0}var l=this[o];if(l.getType()===u.getType()){if(u.isReference(i)){try{i===(c=e.getField(r)).getAccessType()&&u.getType()===c.getType()||(c=this.createUserDefinedField(e,i,r,l))}catch(t){var c=this.createUserDefinedField(e,i,r,l)}return c.addReference(u),!0}throw new Error("Field '"+r+"' and '"+u.getName()+"' in PROTO '"+this.getPrototype().getName()+"' are incompatible as an IS mapping.")}throw new Error("Field '"+r+"' and '"+u.getName()+"' in PROTO '"+this.getPrototype().getName()+"' have different types.")}throw new Error("No name give after IS statement.")}throw new Error("IS statement outside PROTO definition.")}}}}if(this.lastIndex=t,this.lineNumber=n,c=this.interfaceDeclaration()){try{if(c.getAccessType()===s.inputOutput){var h=e.getField(c.getName());if(h.getAccessType()===s.inputOutput&&c.getType()===h.getType())return h.setValue(c),!0}}catch(e){}return e.addUserDefinedField(c.getAccessType(),c.getName(),c),!0}return this.nodeBodyElement(e)},createUserDefinedField:function(e,t,n,i){var o=i.create();return e.addUserDefinedField(t,n,o),o},nodeBody:function(e){for(;this.nodeBodyElement(e););},nodeBodyElement:function(e){if(this.protoStatement())return!0;if(this.routeStatement())return!0;if(this.Id()){var t=this.result[1];try{var n=e.getField(t)}catch(n){throw new Error("Unknown field '"+t+"' in class '"+e.getTypeName()+"'.")}if(this.comments(),bo.IS.parse(this)){if(this.isInsideProtoDefinition()){if(this.Id()){var i=this.result[1];try{var o=this.getPrototype().getField(i)}catch(e){return this.exception("No such event or field '"+i+"' inside PROTO "+this.getPrototype().getName()),!0}if(n.getType()===o.getType()){if(o.isReference(n.getAccessType()))return n.addReference(o),!0;throw new Error("Field '"+n.getName()+"' and '"+o.getName()+"' in PROTO "+this.getPrototype().getName()+" are incompatible as an IS mapping.")}throw new Error("Field '"+n.getName()+"' and '"+o.getName()+"' in PROTO "+this.getPrototype().getName()+" have different types.")}throw new Error("No name give after IS statement.")}throw new Error("IS statement outside PROTO definition.")}if(n.isInitializable()){if(this.fieldValue(n))return!0;throw new Error("Couldn't read value for field '"+t+"'.")}throw new Error("Couldn't assign value to "+this.accessTypeToString(n.getAccessType())+" field '"+t+"'.")}return!1},profileNameId:function(){return this.Id()},componentNameId:function(){return this.comments(),bo.ComponentNameId.parse(this)},categoryNameId:function(){return this.Id()},unitNameId:function(){return this.Id()},exportedNodeNameId:function(){return this.Id()},nodeNameId:function(){return this.Id()},nodeTypeId:function(){return this.Id()},initializeOnlyId:function(){return this.Id()},inputOnlyId:function(){return this.Id()},outputOnlyId:function(){return this.Id()},inputOutputId:function(){return this.Id()},Id:function(){return this.comments(),bo.Id.parse(this)},fieldType:function(){return this.comments(),bo.FieldType.parse(this)},fieldValue:function(e){return this.fieldTypes[e.getType()].call(this,e)},double:function(){return this.comments(),bo.double.parse(this)?(this.value=parseFloat(this.result[1]),!0):bo.Inf.parse(this)?(this.value=Number.POSITIVE_INFINITY,!0):bo.NegativeInf.parse(this)?(this.value=Number.NEGATIVE_INFINITY,!0):!!bo.NaN.parse(this)&&(this.value=Number.NaN,!0)},int32:function(){return this.comments(),!!bo.int32.parse(this)&&(this.value=parseInt(this.result[1]),!0)},string:function(){return this.comments(),!!bo.string.parse(this)&&(this.value=Bn.SFString.unescape(this.result[1]),this.lines(this.value),!0)},sfboolValue:function(e){return this.comments(),bo.TRUE.parse(this)?(e.setValue(!0),!0):!!bo.FALSE.parse(this)&&(e.setValue(!1),!0)},mfboolValue:function(e){if(e.length=0,this.sfboolValue(this.SFBool))return e.push(this.SFBool),!0;if(bo.OpenBracket.parse(this)){if(this.sfboolValues(e),this.comments(),bo.CloseBracket.parse(this))return!0;throw new Error("Expected ']'.")}return!1},sfboolValues:function(e){for(e.length=0,e=e.getTarget();this.sfboolValue(this.SFBool);)e.push(this.SFBool)},sfcolorValue:function(e){if(this.double()){var t=this.value;if(this.double()){var n=this.value;if(this.double()){var i=this.value;return e.r=t,e.g=n,e.b=i,!0}}}return!1},mfcolorValue:function(e){if(e.length=0,this.sfcolorValue(this.SFColor))return e.push(this.SFColor),!0;if(bo.OpenBracket.parse(this)){if(this.sfcolorValues(e),this.comments(),bo.CloseBracket.parse(this))return!0;throw new Error("Expected ']'.")}return!1},sfcolorValues:function(e){for(e.length=0,e=e.getTarget();this.sfcolorValue(this.SFColor);)e.push(this.SFColor)},sfcolorrgbaValue:function(e){if(this.double()){var t=this.value;if(this.double()){var n=this.value;if(this.double()){var i=this.value;if(this.double()){var o=this.value;return e.r=t,e.g=n,e.b=i,e.a=o,!0}}}}return!1},mfcolorrgbaValue:function(e){if(e.length=0,this.sfcolorrgbaValue(this.SFColorRGBA))return e.push(this.SFColorRGBA),!0;if(bo.OpenBracket.parse(this)){if(this.sfcolorrgbaValues(e),this.comments(),bo.CloseBracket.parse(this))return!0;throw new Error("Expected ']'.")}return!1},sfcolorrgbaValues:function(e){for(e.length=0,e=e.getTarget();this.sfcolorrgbaValue(this.SFColorRGBA);)e.push(this.SFColorRGBA)},sfdoubleValue:function(e){return!!this.double()&&(e.setValue(this.fromUnit(e.getUnit(),this.value)),!0)},mfdoubleValue:function(e){if(e.length=0,this.SFDouble.setUnit(e.getUnit()),this.sfdoubleValue(this.SFDouble))return e.push(this.SFDouble),!0;if(bo.OpenBracket.parse(this)){if(this.sfdoubleValues(e),this.comments(),bo.CloseBracket.parse(this))return!0;throw new Error("Expected ']'.")}return!1},sfdoubleValues:function(e){for(e.length=0,e=e.getTarget(),this.SFDouble.setUnit(e.getUnit());this.sfdoubleValue(this.SFDouble);)e.push(this.SFDouble)},sffloatValue:function(e){return this.sfdoubleValue(e)},mffloatValue:function(e){if(e.length=0,this.SFFloat.setUnit(e.getUnit()),this.sffloatValue(this.SFFloat))return e.push(this.SFFloat),!0;if(bo.OpenBracket.parse(this)){if(this.sffloatValues(e),this.comments(),bo.CloseBracket.parse(this))return!0;throw new Error("Expected ']'.")}return!1},sffloatValues:function(e){for(e.length=0,e=e.getTarget(),this.SFFloat.setUnit(e.getUnit());this.sffloatValue(this.SFFloat);)e.push(this.SFFloat)},sfimageValue:function(e){if(this.int32()){var t=this.value;if(this.int32()){var n=this.value;if(this.int32()){var i=this.value,o=t*n;e.width=t,e.height=n,e.comp=i;for(var r=e.array,s=0;s<o;++s){if(!this.int32())return!1;r[s]=this.value}return!0}}}return!1},mfimageValue:function(e){if(e.length=0,this.sfimageValue(this.SFImage))return e.push(this.SFImage),!0;if(bo.OpenBracket.parse(this)){if(this.sfimageValues(e),this.comments(),bo.CloseBracket.parse(this))return!0;throw new Error("Expected ']'.")}return!1},sfimageValues:function(e){for(e.length=0,e=e.getTarget();this.sfimageValue(this.SFImage);)e.push(this.SFImage)},sfint32Value:function(e){return!!this.int32()&&(e.setValue(this.value),!0)},mfint32Value:function(e){if(e.length=0,this.sfint32Value(this.SFInt32))return e.push(this.SFInt32),!0;if(bo.OpenBracket.parse(this)){if(this.sfint32Values(e),this.comments(),bo.CloseBracket.parse(this))return!0;throw new Error("Expected ']'.")}return!1},sfint32Values:function(e){for(e.length=0,e=e.getTarget();this.sfint32Value(this.SFInt32);)e.push(this.SFInt32)},sfmatrix3dValue:function(e){if(this.double()){var t=this.value;if(this.double()){var n=this.value;if(this.double()){var i=this.value;if(this.double()){var o=this.value;if(this.double()){var r=this.value;if(this.double()){var s=this.value;if(this.double()){var a=this.value;if(this.double()){var u=this.value;if(this.double()){var l=this.value;return e[0]=t,e[1]=n,e[2]=i,e[3]=o,e[4]=r,e[5]=s,e[6]=a,e[7]=u,e[8]=l,!0}}}}}}}}}return!1},mfmatrix3dValue:function(e){if(e.length=0,this.sfmatrix3dValue(this.SFMatrix3d))return e.push(this.SFMatrix3d),!0;if(bo.OpenBracket.parse(this)){if(this.sfmatrix3dValues(e),this.comments(),bo.CloseBracket.parse(this))return!0;throw new Error("Expected ']'.")}return!1},sfmatrix3dValues:function(e){for(e.length=0,e=e.getTarget();this.sfmatrix3dValue(this.SFMatrix3d);)e.push(this.SFMatrix3d)},sfmatrix3fValue:function(e){return this.sfmatrix3dValue(e)},mfmatrix3fValue:function(e){if(e.length=0,this.sfmatrix3fValue(this.SFMatrix3f))return e.push(this.SFMatrix3f),!0;if(bo.OpenBracket.parse(this)){if(this.sfmatrix3fValues(e),this.comments(),bo.CloseBracket.parse(this))return!0;throw new Error("Expected ']'.")}return!1},sfmatrix3fValues:function(e){for(e.length=0,e=e.getTarget();this.sfmatrix3fValue(this.SFMatrix3f);)e.push(this.SFMatrix3f)},sfmatrix4dValue:function(e){if(this.double()){var t=this.value;if(this.double()){var n=this.value;if(this.double()){var i=this.value;if(this.double()){var o=this.value;if(this.double()){var r=this.value;if(this.double()){var s=this.value;if(this.double()){var a=this.value;if(this.double()){var u=this.value;if(this.double()){var l=this.value;if(this.double()){var c=this.value;if(this.double()){var h=this.value;if(this.double()){var d=this.value;if(this.double()){var p=this.value;if(this.double()){var f=this.value;if(this.double()){var g=this.value;if(this.double()){var m=this.value;return e[0]=t,e[1]=n,e[2]=i,e[3]=o,e[4]=r,e[5]=s,e[6]=a,e[7]=u,e[8]=l,e[9]=c,e[10]=h,e[11]=d,e[12]=p,e[13]=f,e[14]=g,e[15]=m,!0}}}}}}}}}}}}}}}}return!1},mfmatrix4dValue:function(e){if(e.length=0,this.sfmatrix4dValue(this.SFMatrix4d))return e.push(this.SFMatrix4d),!0;if(bo.OpenBracket.parse(this)){if(this.sfmatrix4dValues(e),this.comments(),bo.CloseBracket.parse(this))return!0;throw new Error("Expected ']'.")}return!1},sfmatrix4dValues:function(e){for(e.length=0,e=e.getTarget();this.sfmatrix4dValue(this.SFMatrix4d);)e.push(this.SFMatrix4d)},sfmatrix4fValue:function(e){return this.sfmatrix4dValue(e)},mfmatrix4fValue:function(e){if(e.length=0,this.sfmatrix4fValue(this.SFMatrix4f))return e.push(this.SFMatrix4f),!0;if(bo.OpenBracket.parse(this)){if(this.sfmatrix4fValues(e),this.comments(),bo.CloseBracket.parse(this))return!0;throw new Error("Expected ']'.")}return!1},sfmatrix4fValues:function(e){for(e.length=0,e=e.getTarget();this.sfmatrix4fValue(this.SFMatrix4f);)e.push(this.SFMatrix4f)},sfnodeValue:function(e){var t=this.nodeStatement();return!1!==t&&(e.setValue(t),!0)},mfnodeValue:function(e){e.length=0;var t=this.nodeStatement();if(!1!==t)return e.push(t),!0;if(bo.OpenBracket.parse(this)){if(this.nodeStatements(e),this.comments(),bo.CloseBracket.parse(this))return!0;throw new Error("Expected ']'.")}return!1},nodeStatements:function(e){for(var t=this.nodeStatement();!1!==t;)e.push(t),t=this.nodeStatement()},sfrotationValue:function(e){if(this.double()){var t=this.value;if(this.double()){var n=this.value;if(this.double()){var i=this.value;if(this.double()){var o=this.value;return e.x=t,e.y=n,e.z=i,e.angle=this.fromUnit("angle",o),!0}}}}return!1},mfrotationValue:function(e){if(e.length=0,this.sfrotationValue(this.SFRotation))return e.push(this.SFRotation),!0;if(bo.OpenBracket.parse(this)){if(this.sfrotationValues(e),this.comments(),bo.CloseBracket.parse(this))return!0;throw new Error("Expected ']'.")}return!1},sfrotationValues:function(e){for(e.length=0,e=e.getTarget();this.sfrotationValue(this.SFRotation);)e.push(this.SFRotation)},sfstringValue:function(e){return!!this.string()&&(e.setValue(this.value),!0)},mfstringValue:function(e){if(e.length=0,this.sfstringValue(this.SFString))return e.push(this.SFString),!0;if(bo.OpenBracket.parse(this)){if(this.sfstringValues(e),this.comments(),bo.CloseBracket.parse(this))return!0;throw new Error("Expected ']'.")}return!1},sfstringValues:function(e){for(e.length=0,e=e.getTarget();this.sfstringValue(this.SFString);)e.push(this.SFString)},sftimeValue:function(e){return this.sfdoubleValue(e)},mftimeValue:function(e){if(e.length=0,this.sftimeValue(this.SFTime))return e.push(this.SFTime),!0;if(bo.OpenBracket.parse(this)){if(this.sftimeValues(e),this.comments(),bo.CloseBracket.parse(this))return!0;throw new Error("Expected ']'.")}return!1},sftimeValues:function(e){for(e.length=0,e=e.getTarget();this.sftimeValue(this.SFTime);)e.push(this.SFTime)},sfvec2dValue:function(e){if(this.double()){var t=this.value;if(this.double()){var n=this.value,i=e.getUnit();return e.x=this.fromUnit(i,t),e.y=this.fromUnit(i,n),!0}}return!1},mfvec2dValue:function(e){if(e.length=0,this.SFVec2d.setUnit(e.getUnit()),this.sfvec2dValue(this.SFVec2d))return e.push(this.SFVec2d),!0;if(bo.OpenBracket.parse(this)){if(this.sfvec2dValues(e),this.comments(),bo.CloseBracket.parse(this))return!0;throw new Error("Expected ']'.")}return!1},sfvec2dValues:function(e){for(e.length=0,e=e.getTarget(),this.SFVec2d.setUnit(e.getUnit());this.sfvec2dValue(this.SFVec2d);)e.push(this.SFVec2d)},sfvec2fValue:function(e){return this.sfvec2dValue(e)},mfvec2fValue:function(e){if(e.length=0,this.SFVec2f.setUnit(e.getUnit()),this.sfvec2fValue(this.SFVec2f))return e.push(this.SFVec2f),!0;if(bo.OpenBracket.parse(this)){if(this.sfvec2fValues(e),this.comments(),bo.CloseBracket.parse(this))return!0;throw new Error("Expected ']'.")}return!1},sfvec2fValues:function(e){for(e.length=0,e=e.getTarget(),this.SFVec2f.setUnit(e.getUnit());this.sfvec2fValue(this.SFVec2f);)e.push(this.SFVec2f)},sfvec3dValue:function(e){if(this.double()){var t=this.value;if(this.double()){var n=this.value;if(this.double()){var i=this.value,o=e.getUnit();return e.x=this.fromUnit(o,t),e.y=this.fromUnit(o,n),e.z=this.fromUnit(o,i),!0}}}return!1},mfvec3dValue:function(e){if(e.length=0,this.SFVec3d.setUnit(e.getUnit()),this.sfvec3dValue(this.SFVec3d))return e.push(this.SFVec3d),!0;if(bo.OpenBracket.parse(this)){if(this.sfvec3dValues(e),this.comments(),bo.CloseBracket.parse(this))return!0;throw new Error("Expected ']'.")}return!1},sfvec3dValues:function(e){for(e.length=0,e=e.getTarget(),this.SFVec3d.setUnit(e.getUnit());this.sfvec3dValue(this.SFVec3d);)e.push(this.SFVec3d)},sfvec3fValue:function(e){return this.sfvec3dValue(e)},mfvec3fValue:function(e){if(e.length=0,this.SFVec3f.setUnit(e.getUnit()),this.sfvec3fValue(this.SFVec3f))return e.push(this.SFVec3f),!0;if(bo.OpenBracket.parse(this)){if(this.sfvec3fValues(e),this.comments(),bo.CloseBracket.parse(this))return!0;throw new Error("Expected ']'.")}return!1},sfvec3fValues:function(e){for(e.length=0,e=e.getTarget(),this.SFVec3f.setUnit(e.getUnit());this.sfvec3fValue(this.SFVec3f);)e.push(this.SFVec3f)},sfvec4dValue:function(e){if(this.double()){var t=this.value;if(this.double()){var n=this.value;if(this.double()){var i=this.value;if(this.double()){var o=this.value,r=e.getUnit();return e.x=this.fromUnit(r,t),e.y=this.fromUnit(r,n),e.z=this.fromUnit(r,i),e.w=this.fromUnit(r,o),!0}}}}return!1},mfvec4dValue:function(e){if(e.length=0,this.SFVec4d.setUnit(e.getUnit()),this.sfvec4dValue(this.SFVec4d))return e.push(this.SFVec4d),!0;if(bo.OpenBracket.parse(this)){if(this.sfvec4dValues(e),this.comments(),bo.CloseBracket.parse(this))return!0;throw new Error("Expected ']'.")}return!1},sfvec4dValues:function(e){for(e.length=0,e=e.getTarget(),this.SFVec4d.setUnit(e.getUnit());this.sfvec4dValue(this.SFVec4d);)e.push(this.SFVec4d)},sfvec4fValue:function(e){return this.sfvec4dValue(e)},mfvec4fValue:function(e){if(e.length=0,this.SFVec4f.setUnit(e.getUnit()),this.sfvec4fValue(this.SFVec4f))return e.push(this.SFVec4f),!0;if(bo.OpenBracket.parse(this)){if(this.sfvec4fValues(e),this.comments(),bo.CloseBracket.parse(this))return!0;throw new Error("Expected ']'.")}return!1},sfvec4fValues:function(e){for(e.length=0,e=e.getTarget(),this.SFVec4f.setUnit(e.getUnit());this.sfvec4fValue(this.SFVec4f);)e.push(this.SFVec4f)},accessTypeToString:function(e){switch(e){case s.initializeOnly:return"initializeOnly";case s.inputOnly:return"inputOnly";case s.outputOnly:return"outputOnly";case s.inputOutput:return"inputOutput"}}}),Eo.prototype.fieldTypes=[],Eo.prototype.fieldTypes[s.SFBool]=Eo.prototype.sfboolValue,Eo.prototype.fieldTypes[s.SFColor]=Eo.prototype.sfcolorValue,Eo.prototype.fieldTypes[s.SFColorRGBA]=Eo.prototype.sfcolorrgbaValue,Eo.prototype.fieldTypes[s.SFDouble]=Eo.prototype.sfdoubleValue,Eo.prototype.fieldTypes[s.SFFloat]=Eo.prototype.sffloatValue,Eo.prototype.fieldTypes[s.SFImage]=Eo.prototype.sfimageValue,Eo.prototype.fieldTypes[s.SFInt32]=Eo.prototype.sfint32Value,Eo.prototype.fieldTypes[s.SFMatrix3f]=Eo.prototype.sfmatrix3dValue,Eo.prototype.fieldTypes[s.SFMatrix3d]=Eo.prototype.sfmatrix3fValue,Eo.prototype.fieldTypes[s.SFMatrix4f]=Eo.prototype.sfmatrix4dValue,Eo.prototype.fieldTypes[s.SFMatrix4d]=Eo.prototype.sfmatrix4fValue,Eo.prototype.fieldTypes[s.SFNode]=Eo.prototype.sfnodeValue,Eo.prototype.fieldTypes[s.SFRotation]=Eo.prototype.sfrotationValue,Eo.prototype.fieldTypes[s.SFString]=Eo.prototype.sfstringValue,Eo.prototype.fieldTypes[s.SFTime]=Eo.prototype.sftimeValue,Eo.prototype.fieldTypes[s.SFVec2d]=Eo.prototype.sfvec2dValue,Eo.prototype.fieldTypes[s.SFVec2f]=Eo.prototype.sfvec2fValue,Eo.prototype.fieldTypes[s.SFVec3d]=Eo.prototype.sfvec3dValue,Eo.prototype.fieldTypes[s.SFVec3f]=Eo.prototype.sfvec3fValue,Eo.prototype.fieldTypes[s.SFVec4d]=Eo.prototype.sfvec4dValue,Eo.prototype.fieldTypes[s.SFVec4f]=Eo.prototype.sfvec4fValue,Eo.prototype.fieldTypes[s.MFBool]=Eo.prototype.mfboolValue,Eo.prototype.fieldTypes[s.MFColor]=Eo.prototype.mfcolorValue,Eo.prototype.fieldTypes[s.MFColorRGBA]=Eo.prototype.mfcolorrgbaValue,Eo.prototype.fieldTypes[s.MFDouble]=Eo.prototype.mfdoubleValue,Eo.prototype.fieldTypes[s.MFFloat]=Eo.prototype.mffloatValue,Eo.prototype.fieldTypes[s.MFImage]=Eo.prototype.mfimageValue,Eo.prototype.fieldTypes[s.MFInt32]=Eo.prototype.mfint32Value,Eo.prototype.fieldTypes[s.MFMatrix3d]=Eo.prototype.mfmatrix3dValue,Eo.prototype.fieldTypes[s.MFMatrix3f]=Eo.prototype.mfmatrix3fValue,Eo.prototype.fieldTypes[s.MFMatrix4d]=Eo.prototype.mfmatrix4dValue,Eo.prototype.fieldTypes[s.MFMatrix4f]=Eo.prototype.mfmatrix4fValue,Eo.prototype.fieldTypes[s.MFNode]=Eo.prototype.mfnodeValue,Eo.prototype.fieldTypes[s.MFRotation]=Eo.prototype.mfrotationValue,Eo.prototype.fieldTypes[s.MFString]=Eo.prototype.mfstringValue,Eo.prototype.fieldTypes[s.MFTime]=Eo.prototype.mftimeValue,Eo.prototype.fieldTypes[s.MFVec2d]=Eo.prototype.mfvec2dValue,Eo.prototype.fieldTypes[s.MFVec2f]=Eo.prototype.mfvec2fValue,Eo.prototype.fieldTypes[s.MFVec3d]=Eo.prototype.mfvec3dValue,Eo.prototype.fieldTypes[s.MFVec3f]=Eo.prototype.mfvec3fValue,Eo.prototype.fieldTypes[s.MFVec4d]=Eo.prototype.mfvec4dValue,Eo.prototype.fieldTypes[s.MFVec4f]=Eo.prototype.mfvec4fValue;const Co=Eo;var Oo=i(755);const No=Symbol.for("X_ITE.dom"),Fo={initializeOnly:s.initializeOnly,inputOnly:s.inputOnly,outputOnly:s.outputOnly,inputOutput:s.inputOutput};function Mo(e){vo.call(this,e),this.protoDeclarations=[],this.parents=[],this.parser=new Co(e),this.url=new Bn.MFString;try{this.setUnits(this.getScene().getMetaData("generator")),this.parser.setUnits(this.getUnits())}catch(e){}}Mo.prototype=Object.assign(Object.create(vo.prototype),{constructor:Mo,isValid:function(){return this.input instanceof XMLDocument||this.input instanceof HTMLElement||null===this.input},getInput:function(){return this.input},setInput(e){try{"string"==typeof e&&(e=Oo.parseXML(e)),this.input=e}catch(e){this.input=void 0}},parseIntoScene:function(e,t){this.scene[No]=this.input,this.success=e,this.error=t,this.getScene().setEncoding("XML"),this.getScene().setProfile(this.getBrowser().getProfile("Full")),this.xmlElement(this.input)},parseIntoNode:function(e,t){this.pushExecutionContext(e.getExecutionContext()),this.pushParent(e),this.childElement(t),this.popParent(),this.popExecutionContext()},xmlElement:function(e){if(null===e&&this.success)return this.success(this.getScene());switch(e.nodeName){case"#document":var t=Oo(e).children("X3D");if(t.length)for(var n=0;n<t.length;++n)this.x3dElement(t[n]);else this.success?this.loadComponents().then(function(){this.childrenElements(e),this.success(this.getScene())}.bind(this)).catch(function(e){this.error&&this.error(e)}.bind(this)):this.childrenElements(e);break;case"X3D":this.x3dElement(e);break;case"Scene":case"SCENE":this.success?this.loadComponents().then(function(){this.sceneElement(e),this.success(this.getScene())}.bind(this)).catch(function(e){this.error&&this.error(e)}.bind(this)):this.sceneElement(e);break;default:this.success?this.loadComponents().then(function(){this.childrenElements(e),this.success(this.getScene())}.bind(this)).catch(function(e){this.error&&this.error(e)}.bind(this)):this.childrenElements(e)}},x3dElement:function(e){try{var t=e.getAttribute("profile"),n=this.getBrowser().getProfile(t||"Full");this.getScene().setProfile(n)}catch(e){console.error(e)}var i=e.getAttribute("version");i&&this.getScene().setSpecificationVersion(i);for(var o=e.childNodes,r=0;r<o.length;++r)this.x3dElementChildHead(o[r]);if(this.success)this.loadComponents().then(function(){for(var e=0;e<o.length;++e)this.x3dElementChildScene(o[e]);this.success(this.getScene())}.bind(this)).catch(function(e){this.error&&this.error(e)}.bind(this));else for(r=0;r<o.length;++r)this.x3dElementChildScene(o[r])},x3dElementChildHead:function(e){switch(e.nodeName){case"head":case"HEAD":return void this.headElement(e)}},x3dElementChildScene:function(e){switch(e.nodeName){case"Scene":case"SCENE":return void this.sceneElement(e)}},headElement:function(e){for(var t=e.childNodes,n=0;n<t.length;++n)this.headElementChild(t[n]);try{this.setUnits(this.getScene().getMetaData("generator")),this.parser.setUnits(this.getUnits())}catch(e){}},headElementChild:function(e){switch(e.nodeName){case"component":case"COMPONENT":return void this.componentElement(e);case"unit":case"UNIT":return void this.unitElement(e);case"meta":case"META":return void this.metaElement(e)}},componentElement:function(e){try{var t=e.getAttribute("name"),n=parseInt(e.getAttribute("level"));if(null===t)return console.warn("XML Parser Error: Bad component statement: Expected name attribute.");if(null===n)return console.warn("XML Parser Error: Bad component statement: Expected level attribute.");var i=this.getBrowser().getComponent(t,n);this.getScene().addComponent(i)}catch(e){console.log(e.message)}},unitElement:function(e){var t=e.getAttribute("category"),n=e.getAttribute("name"),i=e.getAttribute("conversionFactor");return null===t?console.warn("XML Parser Error: Bad unit statement: Expected category attribute."):null===n?console.warn("XML Parser Error: Bad unit statement: Expected name attribute."):null===i?console.warn("XML Parser Error: Bad unit statement: Expected conversionFactor attribute."):void this.getScene().updateUnit(t,n,parseFloat(i))},metaElement:function(e){var t=e.getAttribute("name"),n=e.getAttribute("content");return null===t?console.warn("XML Parser Error: Bad meta statement: Expected name attribute."):null===n?console.warn("XML Parser Error: Bad meta statement: Expected content attribute."):void this.getScene().setMetaData(t,n)},sceneElement:function(e){this.childrenElements(e)},childrenElements:function(e){for(var t=e.childNodes,n=0;n<t.length;++n)this.childElement(t[n])},childElement:function(e){switch(e.nodeName){case"#comment":case"#text":return;case"#cdata-section":return void this.cdataNode(e);case"ExternProtoDeclare":case"EXTERNPROTODECLARE":return void this.externProtoDeclareElement(e);case"ProtoDeclare":case"PROTODECLARE":return void this.protoDeclareElement(e);case"IS":return void this.isElement(e);case"ProtoInstance":case"PROTOINSTANCE":return void this.protoInstanceElement(e);case"fieldValue":case"FIELDVALUE":return void this.fieldValueElement(e);case"field":case"FIELD":return void this.fieldElement(e);case"ROUTE":return void this.routeElement(e);case"IMPORT":return void this.importElement(e);case"EXPORT":return void this.exportElement(e);default:return void this.nodeElement(e)}},externProtoDeclareElement:function(e){var t=e.getAttribute("name");if(this.id(t)){var n=e.getAttribute("url");if(null===n)return console.warn("XML Parser Error: Bad ExternProtoDeclare statement: Expected url attribute.");this.parser.setInput(n),Co.prototype.sfstringValues.call(this.parser,this.url);var i=new ua(this.getExecutionContext(),this.url);this.pushParent(i),this.protoInterfaceElement(e),this.popParent(),i.setup();try{const e=this.getExecutionContext().getExternProtoDeclaration(t);this.getExecutionContext().updateExternProtoDeclaration(this.getExecutionContext().getUniqueExternProtoName(t),e)}catch(e){}this.getExecutionContext().updateExternProtoDeclaration(t,i)}},protoDeclareElement:function(e){var t=e.getAttribute("name");if(this.id(t)){for(var n=new po(this.getExecutionContext()),i=e.childNodes,o=0;o<i.length;++o){switch((r=i[o]).nodeName){case"ProtoInterface":case"PROTOINTERFACE":this.pushParent(n),this.protoInterfaceElement(r),this.popParent();break;default:continue}break}for(o=0;o<i.length;++o){var r;switch((r=i[o]).nodeName){case"ProtoBody":case"PROTOBODY":this.pushPrototype(n),this.pushExecutionContext(n.getBody()),this.pushParent(n),this.protoBodyElement(r),this.popParent(),this.popExecutionContext(),this.popPrototype();break;default:continue}break}n.setup();try{const e=this.getExecutionContext().getProtoDeclaration(t);this.getExecutionContext().updateProtoDeclaration(this.getExecutionContext().getUniqueProtoName(t),e)}catch(e){}this.getExecutionContext().updateProtoDeclaration(t,n)}},protoInterfaceElement:function(e){for(var t=e.childNodes,n=0;n<t.length;++n)this.protoInterfaceElementChild(t[n])},protoInterfaceElementChild:function(e){switch(e.nodeName){case"field":case"FIELD":return void this.fieldElement(e)}},fieldElement:function(e){try{if(0===this.getParents().length)return;var t=this.getParent();if(!(t instanceof Jn))return;if(!t.canUserDefinedFields())return;var n=Fo[e.getAttribute("accessType")];void 0===n&&(n=s.initializeOnly);var i=Bn[e.getAttribute("type")];if(void 0===i)return;var o=e.getAttribute("name");if(!this.id(o))return;var r=new i;n&s.initializeOnly&&(this.fieldValue(r,e.getAttribute("value")),this.pushParent(r),this.childrenElements(e),this.popParent()),t.addUserDefinedField(n,o,r)}catch(e){}},protoBodyElement:function(e){this.childrenElements(e)},isElement:function(e){if(this.isInsideProtoDefinition())for(var t=e.childNodes,n=0;n<t.length;++n)this.isElementChild(t[n])},isElementChild:function(e){switch(e.nodeName){case"connect":case"CONNECT":return void this.connectElement(e)}},connectElement:function(e){var t=e.getAttribute("nodeField"),n=e.getAttribute("protoField");if(null===t)return console.warn("XML Parser Error: Bad connect statement: Expected nodeField attribute.");if(null===n)return console.warn("XML Parser Error: Bad connect statement: Expected protoField attribute.");try{if(0===this.getParents().length)return;var i=this.getParent(),o=this.getPrototype();if(!(i instanceof Jn))return;var r=i.getField(t),s=o.getField(n);if(r.getType()!==s.getType())throw new Error("Field '"+r.getName()+"' and '"+s.getName()+"' in PROTO "+this.proto.getName()+" have different types.");if(!s.isReference(r.getAccessType()))throw new Error("Field '"+r.getName()+"' and '"+s.getName()+"' in PROTO "+o.getName()+" are incompatible as an IS mapping.");r.addReference(s)}catch(e){console.warn("XML Parser Error: Couldn't create IS reference: "+e.message)}},protoInstanceElement:function(e){try{if(this.useAttribute(e))return;var t=e.getAttribute("name");if(this.id(t)){var n=this.getExecutionContext().createProto(t,!1);if(!n)throw new Error("Unknown proto or externproto type '"+t+"'.");e.x3d=n,this.defAttribute(e,n),this.addNode(e,n),this.pushParent(n),this.childrenElements(e),this.isInsideProtoDefinition()||n.setup(),this.popParent()}}catch(e){console.warn("XML Parser Error: ",e.message)}},fieldValueElement:function(e){try{if(0===this.getParents().length)return;var t=this.getParent(),n=e.getAttribute("name");if(!(t instanceof ao))return;if(!this.id(n))return;var i=t.getField(n);i.getAccessType()&s.initializeOnly&&(i.getType()===s.MFNode&&(i.length=0),this.fieldValue(i,e.getAttribute("value")),this.pushParent(i),this.childrenElements(e),this.popParent())}catch(e){console.warn("XML Parser Error: Couldn't assign field value: "+e.message)}},nodeElement:function(e){try{if(this.useAttribute(e))return;var t=this.getExecutionContext().createNode(this.nodeNameToCamelCase(e.nodeName),!1);if(!t)throw new Error("Unknown node type '"+e.nodeName+"', you probably have insufficient component/profile statements.");e.x3d=t,this.defAttribute(e,t),this.addNode(e,t),this.pushParent(t),this.nodeAttributes(e,t),this.childrenElements(e),this.isInsideProtoDefinition()||t.setup(),this.popParent()}catch(t){if("NULL"==e.nodeName)return void this.addNode(e,null);console.error(t),console.error("XML Parser Error: "+t.message)}},routeElement:function(e){try{var t=e.getAttribute("fromNode"),n=e.getAttribute("fromField"),i=e.getAttribute("toNode"),o=e.getAttribute("toField");if(null===t)throw new Error("Bad ROUTE statement: Expected fromNode attribute.");if(null===n)throw new Error("Bad ROUTE statement: Expected fromField attribute.");if(null===i)throw new Error("Bad ROUTE statement: Expected toNode attribute.");if(null===o)throw new Error("Bad ROUTE statement: Expected toField attribute.");var r=this.getExecutionContext(),s=r.getLocalNode(t),a=r.getLocalNode(i),u=r.addRoute(s,n,a,o);e.x3d=u}catch(e){console.error(e),console.warn("XML Parser Error: "+e.message)}},importElement:function(e){try{var t=e.getAttribute("inlineDEF"),n=e.getAttribute("importedDEF")||e.getAttribute("exportedDEF"),i=e.getAttribute("AS");if(null===t)throw new Error("Bad IMPORT statement: Expected inlineDEF attribute.");if(null===n)throw new Error("Bad IMPORT statement: Expected importedDEF attribute.");i||(i=n);var o=this.getExecutionContext().getNamedNode(t);this.getExecutionContext().updateImportedNode(o,n,i)}catch(e){console.warn("XML Parser Error: "+e.message)}},exportElement:function(e){try{if(this.getScene()!==this.getExecutionContext())return void console.warn("XML Parser Error: Export statement not allowed here.");var t=e.getAttribute("localDEF"),n=e.getAttribute("AS");if(null===t)throw new Error("Bad EXPORT statement: Expected localDEF attribute.");n||(n=t);var i=this.getExecutionContext().getLocalNode(t);this.getScene().updateExportedNode(n,i)}catch(e){console.warn("XML Parser Error: "+e.message)}},cdataNode:function(e){if(0!==this.getParents().length){var t=this.getParent();if(t instanceof Jn){var n=t.getSourceText();n&&n.push(e.data)}}},useAttribute:function(e){try{var t=e.getAttribute("USE");if(this.id(t)){var n=this.getExecutionContext().getNamedNode(t);return this.addNode(e,n.getValue()),!0}}catch(e){console.warn("Invalid USE name: "+e.message)}return!1},defAttribute:function(e,t){try{var n=e.getAttribute("DEF");if(n){try{var i=this.getExecutionContext().getNamedNode(n);this.getExecutionContext().updateNamedNode(this.getExecutionContext().getUniqueName(n),i)}catch(e){}this.getExecutionContext().updateNamedNode(n,t)}}catch(e){console.warn("Invalid DEF name: "+e.message)}},nodeAttributes:function(e,t){for(var n=e.attributes,i=0;i<n.length;++i)this.nodeAttribute(n[i],t)},nodeAttribute:function(e,t){try{var n=t.getField(this.attributeToCamelCase(e.name));n.getAccessType()&s.initializeOnly&&this.fieldValue(n,e.value)}catch(e){}},fieldValue:function(e,t){null!==t&&(this.parser.pushExecutionContext(this.getExecutionContext()),this.parser.setInput(t),this.fieldTypes[e.getType()].call(this.parser,e),this.parser.popExecutionContext())},addNode:function(e,t){if(0===this.parents.length||this.getParent()instanceof po)this.getExecutionContext().rootNodes.push(t);else{var n=this.getParent();if(n instanceof Z)switch(n.getType()){case s.SFNode:return void n.setValue(t);case s.MFNode:return void n.push(t)}else try{var i=e.getAttribute("containerField");if(!i){if(!t)throw new Error("NULL node must have a container field attribute.");i=t.getContainerField()}var o=n.getField(i);switch(o.getType()){case s.SFNode:return void o.setValue(t);case s.MFNode:return void o.push(t)}}catch(e){}}},getParents:function(){return this.parents},getParent:function(){return this.parents.at(-1)},pushParent:function(e){return this.parents.push(e)},popParent:function(){this.parents.pop()},id:function(e){return null!==e&&0!==e.length},nodeNameToCamelCase:function(e){return Vi.getNodeTypeName(e)},attributeToCamelCase:function(e){return Vi.getFieldName(e)}}),Mo.prototype.fieldTypes=[],Mo.prototype.fieldTypes[s.SFBool]=Co.prototype.sfboolValue,Mo.prototype.fieldTypes[s.SFColor]=Co.prototype.sfcolorValue,Mo.prototype.fieldTypes[s.SFColorRGBA]=Co.prototype.sfcolorrgbaValue,Mo.prototype.fieldTypes[s.SFDouble]=Co.prototype.sfdoubleValue,Mo.prototype.fieldTypes[s.SFFloat]=Co.prototype.sffloatValue,Mo.prototype.fieldTypes[s.SFImage]=Co.prototype.sfimageValue,Mo.prototype.fieldTypes[s.SFInt32]=Co.prototype.sfint32Value,Mo.prototype.fieldTypes[s.SFMatrix3f]=Co.prototype.sfmatrix3dValue,Mo.prototype.fieldTypes[s.SFMatrix3d]=Co.prototype.sfmatrix3fValue,Mo.prototype.fieldTypes[s.SFMatrix4f]=Co.prototype.sfmatrix4dValue,Mo.prototype.fieldTypes[s.SFMatrix4d]=Co.prototype.sfmatrix4fValue,Mo.prototype.fieldTypes[s.SFNode]=function(e){e.setValue(null)},Mo.prototype.fieldTypes[s.SFRotation]=Co.prototype.sfrotationValue,Mo.prototype.fieldTypes[s.SFString]=function(e){e.setValue(Bn.SFString.unescape(this.input))},Mo.prototype.fieldTypes[s.SFTime]=Co.prototype.sftimeValue,Mo.prototype.fieldTypes[s.SFVec2d]=Co.prototype.sfvec2dValue,Mo.prototype.fieldTypes[s.SFVec2f]=Co.prototype.sfvec2fValue,Mo.prototype.fieldTypes[s.SFVec3d]=Co.prototype.sfvec3dValue,Mo.prototype.fieldTypes[s.SFVec3f]=Co.prototype.sfvec3fValue,Mo.prototype.fieldTypes[s.SFVec4d]=Co.prototype.sfvec4dValue,Mo.prototype.fieldTypes[s.SFVec4f]=Co.prototype.sfvec4fValue,Mo.prototype.fieldTypes[s.MFBool]=Co.prototype.sfboolValues,Mo.prototype.fieldTypes[s.MFColor]=Co.prototype.sfcolorValues,Mo.prototype.fieldTypes[s.MFColorRGBA]=Co.prototype.sfcolorrgbaValues,Mo.prototype.fieldTypes[s.MFDouble]=Co.prototype.sfdoubleValues,Mo.prototype.fieldTypes[s.MFFloat]=Co.prototype.sffloatValues,Mo.prototype.fieldTypes[s.MFImage]=Co.prototype.sfimageValues,Mo.prototype.fieldTypes[s.MFInt32]=Co.prototype.sfint32Values,Mo.prototype.fieldTypes[s.MFMatrix3d]=Co.prototype.sfmatrix3dValues,Mo.prototype.fieldTypes[s.MFMatrix3f]=Co.prototype.sfmatrix3fValues,Mo.prototype.fieldTypes[s.MFMatrix4d]=Co.prototype.sfmatrix4dValues,Mo.prototype.fieldTypes[s.MFMatrix4f]=Co.prototype.sfmatrix4fValues,Mo.prototype.fieldTypes[s.MFNode]=function(e){e.length=0},Mo.prototype.fieldTypes[s.MFRotation]=Co.prototype.sfrotationValues,Mo.prototype.fieldTypes[s.MFString]=Co.prototype.sfstringValues,Mo.prototype.fieldTypes[s.MFTime]=Co.prototype.sftimeValues,Mo.prototype.fieldTypes[s.MFVec2d]=Co.prototype.sfvec2dValues,Mo.prototype.fieldTypes[s.MFVec2f]=Co.prototype.sfvec2fValues,Mo.prototype.fieldTypes[s.MFVec3d]=Co.prototype.sfvec3dValues,Mo.prototype.fieldTypes[s.MFVec3f]=Co.prototype.sfvec3fValues,Mo.prototype.fieldTypes[s.MFVec4d]=Co.prototype.sfvec4dValues,Mo.prototype.fieldTypes[s.MFVec4f]=Co.prototype.sfvec4fValues;var Do=/\binf\b/g,Io=/\bnan\b/g,Ro=/^[\x20\n,\t\r"]+|[\x20\n,\t\r"]+$/g,Vo=/[\x20\n,\t\r"]+/,Po=new RegExp('"((?:[^\\\\"]|\\\\\\\\|\\\\\\")*)"',"g");function Ao(e){return e.replace(Do,"Infinity").replace(Io,"NaN").replace(Ro,"").split(Vo)}Mo.prototype.fieldTypes[s.MFColor]=Mo.prototype.fieldTypes[s.MFColorRGBA]=Mo.prototype.fieldTypes[s.MFMatrix3d]=Mo.prototype.fieldTypes[s.MFMatrix3f]=Mo.prototype.fieldTypes[s.MFMatrix4d]=Mo.prototype.fieldTypes[s.MFMatrix4f]=Mo.prototype.fieldTypes[s.MFVec4d]=Mo.prototype.fieldTypes[s.MFVec4f]=function(e){e.setValue(Ao(this.getInput()).map((function(e){return parseFloat(e)})))},Mo.prototype.fieldTypes[s.MFBool]=function(e){var t;e.setValue((t=this.getInput(),t.replace(Ro,"").split(Vo)).map((function(e){return"true"===e||"TRUE"===e})))},Mo.prototype.fieldTypes[s.MFInt32]=function(e){var t;e.setValue((t=this.getInput(),t.replace(Ro,"").split(Vo)).map((function(e){return parseInt(e)})))},Mo.prototype.fieldTypes[s.MFDouble]=Mo.prototype.fieldTypes[s.MFFloat]=Mo.prototype.fieldTypes[s.MFVec2d]=Mo.prototype.fieldTypes[s.MFVec2f]=Mo.prototype.fieldTypes[s.MFVec3d]=Mo.prototype.fieldTypes[s.MFVec3f]=function(e){var t=e.getUnit();e.setValue(Ao(this.getInput()).map((function(e){return this.fromUnit(t,parseFloat(e))}),this))},Mo.prototype.fieldTypes[s.MFString]=function(e){e.setValue(function(e){for(var t=null,n=[];t=Po.exec(e);)n.push(t[1]);return n.map(Bn.SFString.unescape)}(this.getInput()))};const Lo=Mo;function Uo(e){vo.call(this,e),this.x3djsonNS="http://www.web3d.org/specifications/x3d-namespace"}Uo.prototype=Object.assign(Object.create(vo.prototype),{constructor:Uo,isValid:function(){return this.input instanceof Object},getInput:function(){return this.input},setInput:function(e){try{"string"==typeof e&&(e=JSON.parse(e)),this.input=e}catch(e){this.input=void 0}},parseIntoScene:function(e,t){const n=this.createElement("X3D");this.convertToDOM(this.input,"",n);const i=new Lo(this.getScene());return i.setInput(n),i.parseIntoScene(e,t),n},elementSetAttribute:function(e,t,n){switch(t){case"SON schema":case"ncoding":break;default:"function"==typeof e.setAttribute&&e.setAttribute(t,n)}},convertChildren:function(e,t,n){for(const i in t)"object"==typeof t[i]&&(isNaN(parseInt(i))?this.convertObject(i,t,n,e.substr(1)):this.convertToDOM(t[i],i,n,e.substr(1)))},createElement:function(e,t){if(void 0===this.x3djsonNS)var n=document.createElement(e);else null==(n=document.createElementNS(this.x3djsonNS,e))&&(console.error("Trouble creating element for",e),n=document.createElement(e));return void 0!==t&&this.elementSetAttribute(n,"containerField",t),n},createCDATA:function(e,t,n){let i=n.trim().replace(/\\"/g,'\\"').replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&");do{i=(n=i).replace(/'([^'\r\n]*)\n([^']*)'/g,"'$1\\n$2'"),n!==i&&console.log("CDATA Replacing",n,"with",i)}while(i!==n);const o="<script> <![CDATA[ "+i+" ]]> <\/script>",r=(new DOMParser).parseFromString(o,"application/xml").children[0].childNodes[1];t.appendChild(r)},convertObject:function(e,t,n,i){if(null!==t&&"object"==typeof t[e])if("@"===e.substr(0,1))this.convertToDOM(t[e],e,n);else if("-"===e.substr(0,1))this.convertChildren(e,t[e],n);else if("#comment"===e)for(const i in t[e]){const o=document.createComment(this.commentStringToXML(t[e][i]));n.appendChild(o)}else if("#sourceCode"===e||"@sourceCode"===e||"#sourceText"===e)this.createCDATA(document,n,t[e].join("\r\n")+"\r\n");else if("connect"===e||"fieldValue"===e||"field"===e||"meta"===e||"component"===e){for(const o in t[e])if("object"==typeof t[e][o]){const r=this.createElement(e,i);this.convertToDOM(t[e][o],o,r),n.appendChild(r),n.appendChild(document.createTextNode("\n"))}}else{const o=this.createElement(e,i);this.convertToDOM(t[e],e,o),n.appendChild(o),n.appendChild(document.createTextNode("\n"))}},commentStringToXML:function(e){let t=e;return t!==(e=e.replace(/\\\\/g,"\\"))&&console.log("X3DJSONLD <!-> replacing",t,"with",e),e},SFStringToXML:function(e){const t=e;return t!==(e=(e=e.replace(/\\/g,"\\\\")).replace(/"/g,'\\"'))&&console.log("X3DJSONLD [] replacing",t,"with",e),e},JSONStringToXML:function(e){const t=e;return t!==(e=(e=e.replace(/\\/g,"\\\\")).replace(/\n/g,"\\n"))&&console.log("X3DJSONLD replacing",t,"with",e),e},convertToDOM:function(e,t,n,i){let o=!1,r=[],s=!1;for(const t in e)if(o=!isNaN(parseInt(t)),o)switch(typeof e[t]){case"number":case"boolean":r.push(e[t]);break;case"string":r.push(e[t]),s=!0;break;case"object":this.convertToDOM(e[t],t,n);break;case"undefined":break;default:console.error("Unknown type found in array "+typeof e[t])}else switch(typeof e[t]){case"object":"X3D"===t?this.convertToDOM(e[t],t,n):this.convertObject(t,e,n,i);break;case"number":case"boolean":this.elementSetAttribute(n,t.substr(1),e[t]);break;case"string":if("#comment"!==t)this.elementSetAttribute(n,t.substr(1),this.JSONStringToXML(e[t]));else{const i=document.createComment(this.commentStringToXML(e[t]));n.appendChild(i)}break;case"undefined":break;default:console.error("Unknown type found in object "+typeof e[t]),console.error(e)}if(o){if("@"===t.substr(0,1))if(s){s=!1;for(const e in r)r[e]=this.SFStringToXML(r[e]);this.elementSetAttribute(n,t.substr(1),'"'+r.join('" "')+'"')}else this.elementSetAttribute(n,t.substr(1),r.join(" "));o=!1}return n}});const Bo=Uo;function Xo(e){vo.call(this,e)}Xo.prototype=Object.assign(Object.create(vo.prototype),{constructor:Xo,parseIntoScene:function(e,t,n){for(const i of Xo.Parser)try{const o=new i(this.getScene());if(o.setInput(e),o.isValid())return o.pushExecutionContext(this.getExecutionContext()),o.parseIntoScene(t,n),void o.popExecutionContext()}catch(e){if(!n)throw e;return void n(e)}throw this.getScene().worldURL.startsWith("data:")?new Error("Couldn't parse X3D. No suitable file handler found for 'data:' URL."):new Error("Couldn't parse X3D. No suitable file handler found for '"+this.getScene().worldURL+"'.")}}),Xo.Parser=[Lo,Bo,Co];const ko=Xo,zo=new He(0,0,0),jo=new He(0,0,0),Go=new Nt;function Ho(e,t){this.normal=t.copy(),this.distanceFromOrigin=t.dot(e)}Ho.prototype={constructor:Ho,copy:function(){const e=Object.create(Ho.prototype);return e.normal=this.normal.copy(),e.distanceFromOrigin=this.distanceFromOrigin,e},assign:function(e){return this.normal.assign(e.normal),this.distanceFromOrigin=e.distanceFromOrigin,this},set:function(e,t){return this.normal.assign(t),this.distanceFromOrigin=t.dot(e),this},multRight:function(e){return jo.assign(this.normal).multiply(this.distanceFromOrigin),Go.assign(e).inverse(),Go.multMatrixDir(zo.assign(this.normal)).normalize(),e.multVecMatrix(jo),this.normal.assign(zo),this.distanceFromOrigin=zo.dot(jo),this},multLeft:function(e){return jo.assign(this.normal).multiply(this.distanceFromOrigin),Go.assign(e).inverse(),Go.multDirMatrix(zo.assign(this.normal)).normalize(),e.multMatrixVec(jo),this.normal.assign(zo),this.distanceFromOrigin=zo.dot(jo),this},getDistanceToPoint:function(e){return He.dot(e,this.normal)-this.distanceFromOrigin},intersectsLine:function(e,t){const n=e.point,i=e.direction,o=i.dot(this.normal);if(0===o)return!1;const r=(this.distanceFromOrigin-this.normal.dot(n))/o;return t.x=n.x+i.x*r,t.y=n.y+i.y*r,t.z=n.z+i.z*r,!0},toString:function(){return this.normal.toString()+" "+this.distanceFromOrigin}};const qo=Ho;var Wo=i(238);const Yo={area:function(){const e=new He(0,0,0),t=new He(0,0,0);return function(n,i,o){return e.assign(i).subtract(n).cross(t.assign(o).subtract(n)).magnitude()/2}}(),normal:function(e,t,n,i){const o=n.x-t.x,r=n.y-t.y,s=n.z-t.z,a=e.x-t.x,u=e.y-t.y,l=e.z-t.z;return i.set(r*l-s*u,s*a-o*l,o*u-r*a),i.normalize()},quadNormal:function(e,t,n,i,o){const r=n.x-e.x,s=n.y-e.y,a=n.z-e.z,u=i.x-t.x,l=i.y-t.y,c=i.z-t.z;return o.set(s*c-a*l,a*u-r*c,r*l-s*u),o.normalize()},triangulatePolygon:function(){const e=function(){const e=new Wo.GluTesselator;return e.gluTessCallback(Wo.gluEnum.GLU_TESS_VERTEX_DATA,(function(e,t){t[t.length]=e})),e.gluTessCallback(Wo.gluEnum.GLU_TESS_BEGIN,(function(e){e!==Wo.primitiveType.GL_TRIANGLES&&console.log("expected TRIANGLES but got type: "+e)})),e.gluTessCallback(Wo.gluEnum.GLU_TESS_ERROR,(function(e){console.log("error callback"),console.log("error number: "+e)})),e.gluTessCallback(Wo.gluEnum.GLU_TESS_COMBINE,(function(e,t,n){return t[0]})),e.gluTessCallback(Wo.gluEnum.GLU_TESS_EDGE_FLAG,(function(e){})),e.gluTessProperty(Wo.gluEnum.GLU_TESS_TOLERANCE,0),e.gluTessProperty(Wo.gluEnum.GLU_TESS_WINDING_RULE,Wo.windingRule.GLU_TESS_WINDING_ODD),e}();return function(){const t=arguments[arguments.length-1];e.gluTessBeginPolygon(t);for(let t=0,n=arguments.length-1;t<n;++t){e.gluTessBeginContour();for(const n of arguments[t])e.gluTessVertex(n,n);e.gluTessEndContour()}return e.gluTessEndPolygon(),t}}(),triangulateConvexPolygon:function(e,t){for(let n=1,i=e.length-1;n<i;++n)t.push(e[0],e[n],e[n+1])},getPolygonNormal:function(e,t){t.set(0,0,0);var n=e[0];for(let o=0,r=e.length;o<r;++o){var i=n;n=e[(o+1)%r];t.x+=(i.y-n.y)*(i.z+n.z),t.y+=(i.z-n.z)*(i.x+n.x),t.z+=(i.x-n.x)*(i.y+n.y)}return t.normalize()}},Ko={min:0,max:0},Zo={min:0,max:0};function Qo(){}function $o(e,t,n){n.min=Number.POSITIVE_INFINITY,n.max=Number.NEGATIVE_INFINITY;for(const i of e){const e=i.dot(t);e<n.min&&(n.min=e),e>n.max&&(n.max=e)}}function Jo(e,t,n){return t<=e&&e<=n}Qo.isSeparated=function(e,t,n){for(const s of e)if($o(t,s,Ko),$o(n,s,Zo),r=Zo.max,!Jo(o=Zo.min,i=Ko.min,Ko.max)&&!Jo(i,o,r))return!0;var i,o,r;return!1};const er=Qo;function tr(e,t,n){this.viewport=new st(0,0,0,0),this.scissor=new st(0,0,0,0),this.points=[new He(0,0,0),new He(0,0,0),new He(0,0,0),new He(0,0,0),new He(0,0,0),new He(0,0,0),new He(0,0,0),new He(0,0,0)],this.normals=[new He(0,0,0),new He(0,0,0),new He(0,0,0),new He(0,0,0),new He(0,0,0),new He(0,0,0)],this.edges=[new He(0,0,0),new He(0,0,0),new He(0,0,0),new He(0,0,0),new He(0,0,0),new He(0,0,0),new He(0,0,0),new He(0,0,0)],this.planes=[new qo(He.Zero,He.Zero),new qo(He.Zero,He.Zero),new qo(He.Zero,He.Zero),new qo(He.Zero,He.Zero),new qo(He.Zero,He.Zero),new qo(He.Zero,He.Zero)],arguments.length&&this.set(e,t,n)}tr.prototype={constructor:tr,set:function(){const e=new Nt;return function(t,n,i){this.viewport.assign(n),this.scissor.assign(i);const o=this.points,r=o[0],s=o[1],a=o[2],u=o[3],l=o[4],c=o[5],h=o[6],d=o[7],p=i[0],f=p+i[2],g=i[1],m=g+i[3];e.assign(t).inverse(),tr.unProjectPointMatrix(p,g,0,e,n,r),tr.unProjectPointMatrix(f,g,0,e,n,s),tr.unProjectPointMatrix(f,m,0,e,n,a),tr.unProjectPointMatrix(p,m,0,e,n,u),tr.unProjectPointMatrix(p,g,1,e,n,l),tr.unProjectPointMatrix(f,g,1,e,n,c),tr.unProjectPointMatrix(f,m,1,e,n,h),tr.unProjectPointMatrix(p,m,1,e,n,d);const _=this.normals;Yo.normal(r,s,a,_[0]),Yo.normal(d,l,r,_[1]),Yo.normal(h,a,s,_[2]),Yo.normal(a,h,d,_[3]),Yo.normal(s,r,l,_[4]),Yo.normal(l,d,h,_[5]);const y=this.planes;return y[0].set(s,_[0]),y[1].set(l,_[1]),y[2].set(a,_[2]),y[3].set(h,_[3]),y[4].set(r,_[4]),y[5].set(d,_[5]),this.edges.tainted=!0,this}}(),getViewport:function(){return this.viewport},getScissor:function(){return this.scissor},getEdges:function(){const e=this.edges;if(e.tainted){const t=this.points;e[0].assign(t[0]).subtract(t[1]),e[1].assign(t[1]).subtract(t[2]),e[2].assign(t[2]).subtract(t[3]),e[3].assign(t[3]).subtract(t[0]),e[4].assign(t[0]).subtract(t[4]),e[5].assign(t[1]).subtract(t[5]),e[6].assign(t[2]).subtract(t[6]),e[7].assign(t[3]).subtract(t[7]),e.tainted=!1}return e},intersectsSphere:function(e,t){const n=this.planes;return!(n[0].getDistanceToPoint(t)>e)&&(!(n[1].getDistanceToPoint(t)>e)&&(!(n[2].getDistanceToPoint(t)>e)&&(!(n[3].getDistanceToPoint(t)>e)&&(!(n[4].getDistanceToPoint(t)>e)&&!(n[5].getDistanceToPoint(t)>e)))))},intersectsBox:function(){const e=[new He(0,0,0),new He(0,0,0),new He(0,0,0),new He(0,0,0),new He(0,0,0),new He(0,0,0),new He(0,0,0),new He(0,0,0)],t=[new He(0,0,0),new He(0,0,0),new He(0,0,0)],n=[new He(0,0,0),new He(0,0,0),new He(0,0,0)],i=[];for(let e=0;e<24;++e)i.push(new He(0,0,0));return function(o){o.getPoints(e);const r=this.points;if(er.isSeparated(o.getNormals(t),e,r))return!1;if(er.isSeparated(this.normals,e,r))return!1;o.getAxes(n);const s=this.getEdges();for(let e=0;e<3;++e)for(let t=0;t<8;++t)i[3*e+t].assign(n[e]).cross(s[t]);return!er.isSeparated(i,e,r)}}()},Object.assign(tr,{unProjectPoint:function(){const e=new Nt;return function(t,n,i,o,r,s,a){return this.unProjectPointMatrix(t,n,i,e.assign(o).multRight(r).inverse(),s,a)}}(),unProjectPointMatrix:function(){const e=new st(0,0,0,0);return function(t,n,i,o,r,s){e.set((t-r[0])/r[2]*2-1,(n-r[1])/r[3]*2-1,2*i-1,1),o.multVecMatrix(e);const a=1/e.w;return s.set(e.x*a,e.y*a,e.z*a,1)}}(),unProjectRay:function(){const e=new Nt;return function(t,n,i,o,r,s){return this.unProjectRayMatrix(t,n,e.assign(i).multRight(o).inverse(),r,s)}}(),unProjectRayMatrix:function(){const e=new He(0,0,0),t=new He(0,0,0);return function(n,i,o,r,s){return tr.unProjectPointMatrix(n,i,0,o,r,e),tr.unProjectPointMatrix(n,i,.9,o,r,t),s.setPoints(e,t)}}(),projectPoint:function(){const e=new st(0,0,0,0);return function(t,n,i,o,r){4===t.length?e.assign(t):e.set(t.x,t.y,t.z,1),i.multVecMatrix(n.multVecMatrix(e));const s=1/(2*e.w);return r.set((e.x*s+.5)*o[2]+o[0],(e.y*s+.5)*o[3]+o[1],e.z*s+.5)}}(),projectPointMatrix:function(){const e=new st(0,0,0,0);return function(t,n,i,o){4===t.length?e.assign(t):e.set(t.x,t.y,t.z,1),n.multVecMatrix(e);const r=1/(2*e.w);return o.set((e.x*r+.5)*i[2]+i[0],(e.y*r+.5)*i[3]+i[1],e.z*r+.5)}}(),projectLine:function(){const e=new Nt;return function(t,n,i,o,r){return this.projectLineMatrix(t,e.assign(n).multRight(i),o,r)}}(),projectLineMatrix:function(){const e=new ke(0,0),t=new ke(0,0),n=new He(0,0,0);return function(i,o,r,s){return tr.projectPointMatrix(i.point,o,r,e),tr.projectPointMatrix(n.assign(i.direction).multiply(1e9).add(i.point),o,r,t),s.setPoints(e,t)}}()});const nr=tr;function ir(e,t,n){const i=e.getContext();if(this.browser=e,this.width=t,this.height=n,this.array=new Uint8Array(t*n*4),this.lastBuffer=i.getParameter(i.FRAMEBUFFER_BINDING),this.buffer=i.createFramebuffer(),i.bindFramebuffer(i.FRAMEBUFFER,this.buffer),this.colorTexture=i.createTexture(),i.bindTexture(i.TEXTURE_2D,this.colorTexture),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.LINEAR),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,i.LINEAR),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,t,n,0,i.RGBA,i.UNSIGNED_BYTE,null),i.framebufferTexture2D(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.TEXTURE_2D,this.colorTexture,0),i.HAS_FEATURE_DEPTH_TEXTURE){this.depthTexture=i.createTexture(),i.bindTexture(i.TEXTURE_2D,this.depthTexture),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,i.NEAREST),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.NEAREST);const e=i.getVersion()>=2?i.DEPTH_COMPONENT24:i.DEPTH_COMPONENT;i.texImage2D(i.TEXTURE_2D,0,e,t,n,0,i.DEPTH_COMPONENT,i.UNSIGNED_INT,null),i.framebufferTexture2D(i.FRAMEBUFFER,i.DEPTH_ATTACHMENT,i.TEXTURE_2D,this.depthTexture,0)}else this.depthBuffer=i.createRenderbuffer(),i.bindRenderbuffer(i.RENDERBUFFER,this.depthBuffer),i.renderbufferStorage(i.RENDERBUFFER,i.DEPTH_COMPONENT16,t,n),i.framebufferRenderbuffer(i.FRAMEBUFFER,i.DEPTH_ATTACHMENT,i.RENDERBUFFER,this.depthBuffer);const o=i.checkFramebufferStatus(i.FRAMEBUFFER)===i.FRAMEBUFFER_COMPLETE;if(i.bindTexture(i.TEXTURE_2D,null),i.bindFramebuffer(i.FRAMEBUFFER,this.lastBuffer),!o)throw new Error("Couldn't create frame buffer.")}ir.prototype={constructor:ir,getWidth:function(){return this.width},getHeight:function(){return this.height},getColorTexture:function(){return this.colorTexture},getDepthTexture:function(){return this.depthTexture},readPixels:function(){const e=this.browser.getContext(),t=this.array,n=this.width,i=this.height;return e.readPixels(0,0,n,i,e.RGBA,e.UNSIGNED_BYTE,t),t},getDepth:function(){const e=new Nt,t=new He(0,0,0);return function(n,i){const o=this.browser.getContext(),r=this.array,s=this.width,a=this.height;let u=0,l=0,c=Number.POSITIVE_INFINITY;e.assign(n).inverse(),o.readPixels(0,0,s,a,o.RGBA,o.UNSIGNED_BYTE,r);for(let e=0,t=0;e<a;++e)for(let n=0;n<s;++n,t+=4){const i=r[t]/255+r[t+1]/65025+r[t+2]/16581375+r[t+3]/4228250625;i<c&&(u=n,l=e,c=i)}return nr.unProjectPointMatrix(u,l,c,e,i,t),t.z}}(),bind:function(){const e=this.browser.getContext();this.lastBuffer=e.getParameter(e.FRAMEBUFFER_BINDING),e.bindFramebuffer(e.FRAMEBUFFER,this.buffer)},unbind:function(){const e=this.browser.getContext();e.bindFramebuffer(e.FRAMEBUFFER,this.lastBuffer)},delete:function(){const e=this.browser.getContext();e.deleteFramebuffer(this.buffer),e.deleteTexture(this.colorTexture),e.HAS_FEATURE_DEPTH_TEXTURE?e.deleteTexture(this.depthTexture):e.deleteRenderbuffer(this.depthBuffer)}};for(const e of Reflect.ownKeys(ir.prototype))Object.defineProperty(ir.prototype,e,{enumerable:!1});const or=ir;let rr=0;const sr={POINTER:rr++,CAMERA:rr++,PICKING:rr++,COLLISION:rr++,SHADOW:rr++,DISPLAY:rr++};function ar(e,t){this.array=e,this.auxiliary=[],t&&(this.compare=t)}ar.prototype={compare:function(e,t){return e<t},sort:function(e,t){this.mergeSort(e,t-1)},mergeSort:function(e,t){if(e<t){const n=e+t>>>1;this.mergeSort(e,n),this.mergeSort(n+1,t),this.merge(e,n,t)}},merge:function(e,t,n){let i,o,r;for(i=0,o=e;o<=t;)this.auxiliary[i++]=this.array[o++];for(i=0,r=e;r<o&&o<=n;)this.compare(this.array[o],this.auxiliary[i])?this.array[r++]=this.array[o++]:this.array[r++]=this.auxiliary[i++];for(;r<o;)this.array[r++]=this.auxiliary[i++]}};const ur=ar,lr={frustum:function(e,t,n,i,o,r,s){const a=t-e,u=i-n,l=r-o,c=2*o,h=(t+e)/a,d=(i+n)/u,p=-(r+o)/l,f=-c*r/l,g=c/a,m=c/u;return s.set(g,0,0,0,0,m,0,0,h,d,p,-1,0,0,f,0)},perspective:function(e,t,n,i,o,r){const s=Math.tan(e/2)*t;if(i>o){const e=i*s/o;return this.frustum(-e,e,-s,s,t,n,r)}{const e=o*s/i;return this.frustum(-s,s,-e,e,t,n,r)}},perspective2:function(e,t,n,i,o,r){const s=Math.tan(e/2)*t;return this.frustum(-s,s,-s,s,t,n,r)},ortho:function(e,t,n,i,o,r,s){const a=t-e,u=i-n,l=r-o,c=2/a,h=2/u,d=-2/l,p=-(t+e)/a,f=-(i+n)/u,g=-(r+o)/l;return s.set(c,0,0,0,0,h,0,0,0,0,d,0,p,f,g,1)},orthoBox:function(){const e=new He(0,0,0),t=new He(0,0,0);return function(n,i){return n.getExtents(e,t),this.ortho(e.x,t.x,e.y,t.y,-t.z,-e.z,i)}}()};function cr(e,t){switch(arguments.length){case 0:return void(this.matrix=new Nt(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0));case 2:return void(this.matrix=new Nt(e.x/2,0,0,0,0,e.y/2,0,0,0,0,e.z/2,0,t.x,t.y,t.z,1));case 3:{const e=arguments[0],t=arguments[1],n=(t.x-e.x)/2,i=(t.y-e.y)/2,o=(t.z-e.z)/2,r=(t.x+e.x)/2,s=(t.y+e.y)/2,a=(t.z+e.z)/2;return void(this.matrix=new Nt(n,0,0,0,0,i,0,0,0,0,o,0,r,s,a,1))}}}cr.prototype={constructor:cr,copy:function(){const e=Object.create(cr.prototype);return e.matrix=this.matrix.copy(),e},assign:function(e){return this.matrix.assign(e.matrix),this},equals:function(e){return this.matrix.equals(e.matrix)},getMatrix:function(){return this.matrix},set:function(e,t){const n=this.matrix;switch(arguments.length){case 0:return n[0]=.5,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=.5,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=.5,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=0,this;case 2:return n[0]=e.x/2,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=e.y/2,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=e.z/2,n[11]=0,n[12]=t.x,n[13]=t.y,n[14]=t.z,n[15]=1,this;case 3:{const e=arguments[0],t=arguments[1],n=(t.x-e.x)/2,i=(t.y-e.y)/2,o=(t.z-e.z)/2,r=(t.x+e.x)/2,s=(t.y+e.y)/2,a=(t.z+e.z)/2;return this.matrix.set(n,0,0,0,0,i,0,0,0,0,o,0,r,s,a,1),this}}},setExtents:function(e,t){const n=this.matrix,i=(t.x-e.x)/2,o=(t.y-e.y)/2,r=(t.z-e.z)/2,s=(t.x+e.x)/2,a=(t.y+e.y)/2,u=(t.z+e.z)/2;return n[0]=i,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=o,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=r,n[11]=0,n[12]=s,n[13]=a,n[14]=u,n[15]=1,this},getExtents:function(e,t){this.getAbsoluteExtents(e,t),e.add(this.center),t.add(this.center)},getAbsoluteExtents:function(){const e=new He(0,0,0),t=new He(0,0,0),n=new He(0,0,0);return function(i,o){const r=this.matrix,s=r.xAxis,a=r.yAxis,u=r.zAxis;e.assign(a).add(u);const l=u.subtract(a);t.assign(s).add(e),n.assign(s).add(l);const c=e.subtract(s),h=l.subtract(s);i.assign(t),o.assign(t),i.min(c,h,n),o.max(c,h,n),t.negate(),c.negate(),h.negate(),n.negate(),i.min(t,c,h,n),o.max(t,c,h,n)}}(),getPoints:function(){const e=new He(0,0,0),t=new He(0,0,0),n=new He(0,0,0),i=new He(0,0,0);return function(o){const r=this.matrix;e.assign(r.xAxis),t.assign(r.yAxis),n.assign(r.zAxis),i.assign(t).add(n);const s=n.subtract(t);o[0].assign(e).add(i),o[1].assign(i).subtract(e),o[2].assign(s).subtract(e),o[3].assign(e).add(s),o[4].assign(o[2]).negate(),o[5].assign(o[3]).negate(),o[6].assign(o[0]).negate(),o[7].assign(o[1]).negate();const a=this.center;return o[0].add(a),o[1].add(a),o[2].add(a),o[3].add(a),o[4].add(a),o[5].add(a),o[6].add(a),o[7].add(a),o}}(),getAxes:function(e){const t=this.matrix;return e[0].assign(t.xAxis),e[1].assign(t.yAxis),e[2].assign(t.zAxis),e},getNormals:function(){const e=new He(0,0,0),t=new He(0,0,0),n=new He(0,0,0),i=[He.xAxis,He.yAxis,He.zAxis];return function(o){const r=this.matrix;if(e.assign(r.xAxis),t.assign(r.yAxis),n.assign(r.zAxis),0===e.norm()&&(e.assign(t).cross(n),0===e.norm())){for(const n of i)if(e.assign(n).cross(t),0!==e.norm())break;if(0===e.norm()){for(const t of i)if(e.assign(t).cross(n),0!==e.norm())break;0===e.norm()&&e.assign(He.xAxis)}}if(0===t.norm()&&(t.assign(n).cross(e),0===t.norm())){for(const e of i)if(t.assign(e).cross(n),0!==t.norm())break;if(0===t.norm()){for(const n of i)if(t.assign(n).cross(e),0!==t.norm())break;0===t.norm()&&t.assign(He.yAxis)}}if(0===n.norm()&&(n.assign(e).cross(t),0===n.norm())){for(const t of i)if(n.assign(t).cross(e),0!==n.norm())break;if(0===n.norm()){for(const e of i)if(n.assign(e).cross(t),0!==n.norm())break;0===n.norm()&&n.assign(He.zAxis)}}return o[0].assign(t).cross(n).normalize(),o[1].assign(n).cross(e).normalize(),o[2].assign(e).cross(t).normalize(),o}}(),isEmpty:function(){return 0===this.matrix[15]},add:function(){const e=new He(0,0,0),t=new He(0,0,0),n=new He(0,0,0),i=new He(0,0,0);return function(o){return this.isEmpty()?this.assign(o):o.isEmpty()?this:(this.getExtents(e,t),o.getExtents(n,i),this.set(e.min(n),t.max(i),!0))}}(),multLeft:function(e){return this.matrix.multLeft(e),this},multRight:function(e){return this.matrix.multRight(e),this},containsPoint:function(){const e=new He(0,0,0),t=new He(0,0,0);return function(n){return this.getExtents(e,t),e.x<=n.x&&t.x>=n.x&&e.y<=n.y&&t.y>=n.y&&e.z<=n.z&&t.z>=n.z}}(),intersectsBox:function(){const e=[new He(0,0,0),new He(0,0,0),new He(0,0,0),new He(0,0,0),new He(0,0,0),new He(0,0,0),new He(0,0,0),new He(0,0,0)],t=[new He(0,0,0),new He(0,0,0),new He(0,0,0),new He(0,0,0),new He(0,0,0),new He(0,0,0),new He(0,0,0),new He(0,0,0)],n=[new He(0,0,0),new He(0,0,0),new He(0,0,0)],i=[new He(0,0,0),new He(0,0,0),new He(0,0,0)],o=[new He(0,0,0),new He(0,0,0),new He(0,0,0),new He(0,0,0),new He(0,0,0),new He(0,0,0),new He(0,0,0),new He(0,0,0),new He(0,0,0)],r=[new He(0,0,0),new He(0,0,0),new He(0,0,0)];return function(s){if(this.isEmpty())return!1;if(s.isEmpty())return!1;if(this.getPoints(e),s.getPoints(t),er.isSeparated(this.getNormals(r),e,t))return!1;if(er.isSeparated(s.getNormals(r),e,t))return!1;this.getAxes(n),s.getAxes(i);for(let e=0;e<3;++e)for(let t=0;t<3;++t)o[3*e+t].assign(n[e]).cross(i[t]);return!er.isSeparated(o,e,t)}}(),intersectsTriangle:function(){const e=[new He(0,0,0),new He(0,0,0),new He(0,0,0),new He(0,0,0),new He(0,0,0),new He(0,0,0),new He(0,0,0),new He(0,0,0)],t=[new He(0,0,0),new He(0,0,0),new He(0,0,0)],n=[new He(0,0,0),new He(0,0,0),new He(0,0,0),new He(0,0,0),new He(0,0,0),new He(0,0,0),new He(0,0,0),new He(0,0,0),new He(0,0,0)],i=[new He(0,0,0),new He(0,0,0),new He(0,0,0)],o=[],r=[new He(0,0,0)],s=[new He(0,0,0),new He(0,0,0),new He(0,0,0)];return function(a,u,l){if(this.isEmpty())return!1;if(this.getPoints(e),o[0]=a,o[1]=u,o[2]=l,er.isSeparated(this.getNormals(i),e,o))return!1;if(Yo.normal(a,u,l,r[0]),er.isSeparated(r,e,o))return!1;this.getAxes(t),s[0].assign(a).subtract(u),s[1].assign(u).subtract(l),s[2].assign(l).subtract(a);for(let e=0;e<3;++e)for(let i=0;i<3;++i)n[3*e+i].assign(t[e]).cross(s[i]);return!er.isSeparated(n,e,o)}}(),toString:function(){return this.size+", "+this.center}},Object.defineProperty(cr.prototype,"size",{get:function(){const e=new He(0,0,0),t=new He(0,0,0);return function(){return this.getAbsoluteExtents(e,t),t.subtract(e)}}(),enumerable:!0,configurable:!1}),Object.defineProperty(cr.prototype,"center",{get:function(){return this.matrix.origin},enumerable:!0,configurable:!1});const hr=cr;const dr=function(e){return Object.assign([new e],{top:0,set:function(e){this[this.top].assign(e)},get:function(){return this[this.top]},push:function(){const e=++this.top;e<this.length?this[e].assign(this[e-1]):this[e]=this[e-1].copy()},pushMatrix:function(e){const t=++this.top;t<this.length?this[t].assign(e):this[t]=e.copy()},pop:function(){--this.top},clear:function(){this.top=0},size:function(){return this.top+1},identity:function(){this[this.top].identity()},multLeft:function(e){this[this.top].multLeft(e)},translate:function(e){this[this.top].translate(e)},rotate:function(e){this[this.top].rotate(e)},scale:function(e){this[this.top].scale(e)}})};function pr(e,t){return e.distance<t.distance}function fr(e){this.viewVolumes=[],this.cameraSpaceMatrix=new dr(Nt),this.viewMatrix=new dr(Nt),this.projectionMatrix=new dr(Nt),this.modelViewMatrix=new dr(Nt),this.viewportArray=new Int32Array(4),this.projectionMatrixArray=new Float32Array(16),this.cameraSpaceMatrixArray=new Float32Array(16),this.localObjectsCount=[0,0,0],this.globalObjects=[],this.localObjects=[],this.lights=[],this.globalShadows=[!1],this.localShadows=[!1],this.localFogs=[null],this.layouts=[],this.textureProjectors=[],this.generatedCubeMapTextures=[],this.collisions=[],this.numOpaqueShapes=0,this.numTransparentShapes=0,this.numCollisionShapes=0,this.numShadowShapes=0,this.opaqueShapes=[],this.transparentShapes=[],this.transparencySorter=new ur(this.transparentShapes,pr),this.collisionShapes=[],this.activeCollisions=new Set,this.shadowShapes=[],this.speed=0;try{this.depthBuffer=new or(e.getBrowser(),16,16)}catch(e){console.error(e),this.getDepth=function(){return 0}}}function gr(e,t){for(var n=0,i=t.length;n<i;++n)e[n]=t[n];e.length=i}fr.prototype={constructor:fr,initialize:function(){},isIndependent:function(){return!0},getRenderTime:function(){return this.renderTime},getViewVolumes:function(){return this.viewVolumes},getViewVolume:function(){return this.viewVolumes.at(-1)},getCameraSpaceMatrix:function(){return this.cameraSpaceMatrix},getViewMatrix:function(){return this.viewMatrix},getProjectionMatrix:function(){return this.projectionMatrix},getModelViewMatrix:function(){return this.modelViewMatrix},getViewportArray:function(){return this.viewportArray},getProjectionMatrixArray:function(){return this.projectionMatrixArray},getCameraSpaceMatrixArray:function(){return this.cameraSpaceMatrixArray},getGlobalObjects:function(){return this.globalObjects},getLocalObjects:function(){return this.localObjects},getLocalObjectsCount:function(){return this.localObjectsCount},getLights:function(){return this.lights},pushGlobalShadows:function(e){this.globalShadows.push(e||this.globalShadows.at(-1))},pushLocalShadows:function(e){this.localShadows.push(e||this.localShadows.at(-1))},popLocalShadows:function(){this.localShadows.pop()},setGlobalFog:function(){const e=new Nt;return function(t){if(t.getFogType()){const n=this.localFogs[0]||t.getFogs().pop();e.assign(t.getModelMatrix()).multRight(this.getViewMatrix().get()),n.set(t,e),this.localFogs[0]=n}else this.localFogs[0]=null}}(),getLocalFogs:function(){return this.localFogs},getLayouts:function(){return this.layouts},getParentLayout:function(){return this.layouts.at(-1)},getTextureProjectors:function(){return this.textureProjectors},getGeneratedCubeMapTextures:function(){return this.generatedCubeMapTextures},getCollisions:function(){return this.collisions},setNumCollisionShapes:function(e){this.numCollisionShapes=e},getNumCollisionShapes:function(){return this.numCollisionShapes},getCollisionShapes:function(){return this.collisionShapes},setNumShadowShapes:function(e){this.numShadowShapes=e},getNumShadowShapes:function(){return this.numShadowShapes},getShadowShapes:function(){return this.shadowShapes},setNumOpaqueShapes:function(e){this.numOpaqueShapes=e},getNumOpaqueShapes:function(){return this.numOpaqueShapes},getOpaqueShapes:function(){return this.opaqueShapes},setNumTransparentShapes:function(e){this.numTransparentShapes=e},getNumTransparentShapes:function(){return this.numTransparentShapes},getTransparentShapes:function(){return this.transparentShapes},constrainTranslation:function(e,t){const n=this.getDistance(e)-this.getNavigationInfo().getCollisionRadius();if(n>0){return e.magnitude()>n?e.normalize().multiply(n):e}return t?this.constrainTranslation(e.normalize().multiply(n),!1):e.assign(He.Zero)},getDistance:function(){const e=new Nt,t=new Nt,n=new Et(0,0,1,0),i=new He(0,0,0),o=new Et(0,0,1,0);return function(r){const s=Date.now(),a=this.getViewpoint(),u=this.getNavigationInfo(),l=u.getCollisionRadius(),c=u.getStepHeight()-u.getAvatarHeight(),h=u.getNearValue(),d=u.getAvatarHeight();lr.ortho(-l,l,Math.min(c,-l),l,h,Math.max(2*l,2*d),e),n.assign(a._orientation.getValue()).inverse().multRight(a.getOrientation()),o.setFromToVec(He.zAxis,i.assign(r).negate()).multRight(n),a.straightenHorizon(o),t.assign(a.getModelMatrix()),t.translate(a.getUserPosition()),t.rotate(o),t.inverse(),t.multRight(e),t.multLeft(a.getCameraSpaceMatrix()),this.getProjectionMatrix().pushMatrix(t);const p=this.getDepth(e);return this.getProjectionMatrix().pop(),this.collisionTime+=Date.now()-s,-p}}(),getDepth:function(){const e=new st(0,0,16,16),t=new nr;return t.set(Nt.Identity,e,e),function(n){this.depthBuffer.bind(),this.viewVolumes.push(t),this.depth(this.collisionShapes,this.numCollisionShapes);const i=this.depthBuffer.getDepth(n,e);return this.viewVolumes.pop(),this.depthBuffer.unbind(),i}}(),render:function(e,t,n){switch(e){case sr.COLLISION:this.numCollisionShapes=0,t.call(n,e,this),this.collide(),this.gravite();break;case sr.SHADOW:this.numShadowShapes=0,t.call(n,e,this),this.depth(this.shadowShapes,this.numShadowShapes);break;case sr.DISPLAY:this.lightIndex=0,this.numOpaqueShapes=0,this.numTransparentShapes=0,this.setGlobalFog(this.getFog()),t.call(n,e,this),this.draw()}},addCollisionShape:function(){const e=new He(0,0,0),t=new He(0,0,0);return function(n){const i=this.getModelViewMatrix().get();i.multDirMatrix(e.assign(n.getBBoxSize())),i.multVecMatrix(t.assign(n.getBBoxCenter()));const o=e.magnitude()/2,r=this.viewVolumes.at(-1);if(r.intersectsSphere(o,t)){const e=this.numCollisionShapes++;e===this.collisionShapes.length&&this.collisionShapes.push({renderObject:this,modelViewMatrix:new Float32Array(16),collisions:[],clipPlanes:[]});const t=this.collisionShapes[e];return t.modelViewMatrix.set(i),t.shapeNode=n,t.scissor=r.getScissor(),gr(t.collisions,this.collisions),gr(t.clipPlanes,this.localObjects),!0}return!1}}(),addShadowShape:function(){const e=new He(0,0,0),t=new He(0,0,0);return function(n){const i=this.getModelViewMatrix().get();i.multDirMatrix(e.assign(n.getBBoxSize())),i.multVecMatrix(t.assign(n.getBBoxCenter()));const o=e.magnitude()/2,r=this.viewVolumes.at(-1);if(r.intersectsSphere(o,t)){const e=this.numShadowShapes++;e===this.shadowShapes.length&&this.shadowShapes.push({renderObject:this,modelViewMatrix:new Float32Array(16),clipPlanes:[]});const t=this.shadowShapes[e];return t.modelViewMatrix.set(i),t.shapeNode=n,t.scissor=r.getScissor(),gr(t.clipPlanes,this.localObjects),!0}return!1}}(),addDisplayShape:function(){const e=new He(0,0,0),t=new He(0,0,0);return function(n){const i=this.getModelViewMatrix().get();i.multDirMatrix(e.assign(n.getBBoxSize())),i.multVecMatrix(t.assign(n.getBBoxCenter()));const o=e.magnitude()/2,r=this.viewVolumes.at(-1);if(r.intersectsSphere(o,t)){if(n.getTransparent()){const e=this.numTransparentShapes++;e===this.transparentShapes.length&&this.transparentShapes.push(this.createRenderContext(!0));var s=this.transparentShapes[e]}else{const e=this.numOpaqueShapes++;e===this.opaqueShapes.length&&this.opaqueShapes.push(this.createRenderContext(!1));s=this.opaqueShapes[e]}return s.modelViewMatrix.set(i),s.scissor.assign(r.getScissor()),s.shadows=this.localShadows.at(-1),s.fogNode=this.localFogs.at(-1),s.shapeNode=n,s.appearanceNode=n.getAppearance(),s.distance=t.z,gr(s.objectsCount,this.localObjectsCount),gr(s.localObjects,this.localObjects),!0}return!1}}(),createRenderContext:function(e){return{renderObject:this,transparent:e,modelViewMatrix:new Float32Array(16),scissor:new st(0,0,0,0),localObjects:[],objectsCount:[0,0,0]}},collide:function(){const e=new Nt,t=new Nt,n=new hr(He.Zero,He.Zero),i=new He(0,0,0);return function(){const o=new Set,r=2.2*this.getNavigationInfo().getCollisionRadius();i.set(r,r,r);for(let r=0,s=this.numCollisionShapes;r<s;++r){const s=this.collisionShapes[r],a=s.collisions;if(a.length&&(n.set(i,He.Zero),n.multRight(e.assign(s.modelViewMatrix).inverse()),s.shapeNode.intersectsBox(n,s.clipPlanes,t.assign(s.modelViewMatrix))))for(const e of a)o.add(e)}if(this.activeCollisions.size){const e=o.size?ee.set_difference(this.activeCollisions,o,new Set):this.activeCollisions;for(const t of e)t.set_active(!1)}this.activeCollisions=o;for(const e of o)e.set_active(!0)}}(),gravite:function(){const e=new Nt,t=new Nt,n=new He(0,0,0),i=new Et(0,0,1,0);return function(){const o=this.getBrowser();if(o.getActiveLayer()===this){if("WALK"!==o.getCurrentViewer())return}else if("WALK"!==this.getNavigationInfo().getViewer())return;const r=this.getNavigationInfo(),s=this.getViewpoint(),a=r.getCollisionRadius(),u=r.getNearValue(),l=r.getAvatarHeight(),c=r.getStepHeight();lr.ortho(-a,a,-a,a,u,Math.max(2*a,2*l),e);const h=s.getUpVector(),d=i.setFromToVec(He.zAxis,h);t.assign(s.getModelMatrix()),t.translate(s.getUserPosition()),t.rotate(d),t.inverse(),t.multRight(e),t.multLeft(s.getCameraSpaceMatrix()),this.getProjectionMatrix().pushMatrix(t);let p=-this.getDepth(e);this.getProjectionMatrix().pop(),p-=l;const f=i.setFromToVec(He.yAxis,h);if(p>0){const e=this.speed?o.getCurrentFrameRate():1e6;this.speed-=o.getBrowserOptions()._Gravity.getValue()/e;let t=this.speed/e;t<-p&&(t=-p,this.speed=0),s._positionOffset=s._positionOffset.getValue().add(f.multVecRot(n.set(0,t,0)))}else this.speed=0,p=-p,p>.01&&p<c&&(this.constrainTranslation(f.multVecRot(n.set(0,p,0)),!1),s._positionOffset=n.add(s._positionOffset.getValue()))}}(),depth:function(){const e=new Float32Array(16);return function(t,n){const i=this.getBrowser().getContext(),o=this.getViewVolume().getViewport();e.set(this.getProjectionMatrix().get()),i.viewport(o[0],o[1],o[2],o[3]),i.scissor(o[0],o[1],o[2],o[3]),i.clearColor(1,0,0,0),i.clear(i.COLOR_BUFFER_BIT|i.DEPTH_BUFFER_BIT),i.depthMask(!0),i.enable(i.DEPTH_TEST),i.disable(i.BLEND),i.disable(i.CULL_FACE);for(let o=0;o<n;++o){const n=t[o],r=n.scissor;i.scissor(r.x,r.y,r.z,r.w),n.shapeNode.depth(i,n,e)}}}(),draw:function(){const e=this.getBrowser(),t=e.getContext(),n=this.getViewVolume().getViewport(),i=this.lights,o=this.textureProjectors,r=this.generatedCubeMapTextures,s=this.globalShadows,a=s.at(-1),u=this.getNavigationInfo()._headlight.getValue(),l=i.reduce(((e,t)=>e+t.lightNode.getGlobal()),+u),c=o.reduce(((e,t)=>e+t.textureProjectorNode.getGlobal()),0);if(this.renderTime=Date.now(),this.isIndependent()){for(const e of i)e.renderShadowMap(this);for(const e of r)e.renderTexture(this)}u&&e.getHeadlight().setGlobalVariables(this);for(const e of i)e.setGlobalVariables(this);for(const e of o)e.setGlobalVariables(this);this.viewportArray.set(n),this.cameraSpaceMatrixArray.set(this.getCameraSpaceMatrix().get()),this.projectionMatrixArray.set(this.getProjectionMatrix().get()),t.viewport(n.x,n.y,n.z,n.w),t.scissor(n.x,n.y,n.z,n.w),t.clear(t.DEPTH_BUFFER_BIT),this.getBackground().display(t,this,n),t.depthMask(!0),t.enable(t.DEPTH_TEST),t.disable(t.BLEND);const h=this.opaqueShapes;for(let n=0,i=this.numOpaqueShapes;n<i;++n){const i=h[n],o=i.scissor;t.scissor(o.x,o.y,o.z,o.w),i.shadows||=a,i.objectsCount[1]+=l,i.objectsCount[2]+=c,i.shapeNode.display(t,i),e.resetTextureUnits()}t.depthMask(!1),t.enable(t.BLEND);const d=this.transparentShapes;this.transparencySorter.sort(0,this.numTransparentShapes);for(let n=0,i=this.numTransparentShapes;n<i;++n){const i=d[n],o=i.scissor;t.scissor(o.x,o.y,o.z,o.w),i.shadows||=a,i.objectsCount[1]+=l,i.objectsCount[2]+=c,i.shapeNode.display(t,i),e.resetTextureUnits()}t.depthMask(!0),t.disable(t.BLEND);const p=this.globalObjects;if(this.isIndependent()){const t=e.getLocalObjects();for(const e of t)e.dispose();t.length=0;for(const e of p)e.dispose()}p.length=0,i.length=0,s.length=1,o.length=0,r.length=0}};const mr=fr;function _r(e){this.getExecutionContext()||(ji.call(this,e),this.addType(s.X3DChildNode),this.addChildObjects("isCameraObject",new Bn.SFBool),this.addChildObjects("isPickableObject",new Bn.SFBool),this._isCameraObject.setAccessType(s.outputOnly),this._isPickableObject.setAccessType(s.outputOnly))}_r.prototype=Object.assign(Object.create(ji.prototype),{constructor:_r,setCameraObject:function(e){e!==this._isCameraObject.getValue()&&(this._isCameraObject=e)},getCameraObject:function(){return this._isCameraObject.getValue()},setPickableObject:function(e){e!==this._isPickableObject.getValue()&&(this._isPickableObject=e)},getPickableObject:function(){return this._isPickableObject.getValue()}});const yr=_r;function xr(e,t,n=!0){try{if(t&&(t instanceof Bn.SFNode&&(t=t.getValue()),t&&(n&&(t=t.getInnerNode()),t.getType().includes(e))))return t}catch(e){}return null}function wr(e){this.addType(s.X3DBoundedObject),this.addChildObjects("transformSensors_changed",new Bn.SFTime),this._bboxSize.setUnit("length"),this._bboxCenter.setUnit("length"),this.childBBox=new hr,this.transformSensorNodes=new Set}wr.prototype={constructor:wr,initialize:function(){},getDefaultBBoxSize:function(){const e=new He(-1,-1,-1);return function(){return e}}(),getBBox:function(e,t,n){const i=this.childBBox;t.set();for(var o=0,r=e.length;o<r;++o){const r=e[o];r.getBBox&&t.add(r.getBBox(i,n))}return t},displayBBox:function(){const e=new hr,t=new Nt;return function(n,i){const o=i.getModelViewMatrix();this.getBBox(e),t.set(e.center,null,e.size),o.push(),o.multLeft(t),this.getBrowser().getBBoxNode().traverse(n,i),o.pop()}}(),addTransformSensor:function(e){this.transformSensorNodes.add(e),this._transformSensors_changed=this.getBrowser().getCurrentTime()},removeTransformSensor:function(e){this.transformSensorNodes.delete(e),this._transformSensors_changed=this.getBrowser().getCurrentTime()},getTransformSensors:function(){return this.transformSensorNodes},dispose:function(){}};const vr=wr;function br(e){yr.call(this,e),vr.call(this,e),this.addType(s.X3DGroupingNode),this.hidden=!1,this.allowedTypes=new Set,this.clipPlaneNodes=[],this.localFogNodes=[],this.lightNodes=[],this.textureProjectorNodes=[],this.pointingDeviceSensorNodes=[],this.maybeCameraObjects=[],this.cameraObjects=[],this.maybePickableSensorNodes=[],this.pickableSensorNodes=[],this.pickableObjects=[],this.childNodes=[],this.displayNodes=[],this.visibleNodes=[],this.boundedObjects=[],this.sensors=new Map}function Sr(e,t,n,i,o,r){const s=new Set;for(let e=o;e<r;++e)s.add(i[e]);return e.remove(t,n,(function(e){return s.has(e)}))}br.prototype=Object.assign(Object.create(yr.prototype),vr.prototype,{constructor:br,initialize:function(){yr.prototype.initialize.call(this),vr.prototype.initialize.call(this),this._transformSensors_changed.addInterest("set_transformSensors__",this),this._addChildren.addInterest("set_addChildren__",this),this._removeChildren.addInterest("set_removeChildren__",this),this._children.addInterest("set_children__",this),this.set_children__()},getBBox:function(e,t){return this.getSubBBox(e,t)},getSubBBox:function(e,t){return this._bboxSize.getValue().equals(this.getDefaultBBoxSize())?vr.prototype.getBBox.call(this,this.visibleNodes,e,t):e.set(this._bboxSize.getValue(),this._bboxCenter.getValue())},setHidden:function(e){e!==this.hidden&&(this.hidden=e,this.set_children__())},setAllowedTypes:function(){const e=this.allowedTypes;e.clear();for(const t of arguments)e.add(t)},set_addChildren__:function(){0!==this._addChildren.length&&(this._addChildren.setTainted(!0),this._addChildren.erase(Sr(this._addChildren,0,this._addChildren.length,this._children,0,this._children.length),this._addChildren.length),this._children.isTainted()||(this._children.removeInterest("set_children__",this),this._children.addInterest("connectChildren",this)),this._children.insert(this._children.length,this._addChildren,0,this._addChildren.length),this.add(this._addChildren),this._addChildren.length=0,this._addChildren.setTainted(!1))},set_removeChildren__:function(){0!==this._removeChildren.length&&(this._removeChildren.setTainted(!0),this._children.length>0&&(this._children.isTainted()||(this._children.removeInterest("set_children__",this),this._children.addInterest("connectChildren",this)),this._children.erase(Sr(this._children,0,this._children.length,this._removeChildren,0,this._removeChildren.length),this._children.length),this.remove(this._removeChildren)),this._removeChildren.length=0,this._removeChildren.setTainted(!1))},set_children__:function(){this.clear(),this.add(this._children)},connectChildren:function(){this._children.removeInterest("connectChildren",this),this._children.addInterest("set_children__",this)},clear:function(){for(const e of this.maybePickableSensorNodes)e._isPickableObject.removeInterest("set_pickableObjects__",this);for(const e of this.childNodes)e._isCameraObject.removeInterest("set_cameraObjects__",this),e._isPickableObject.removeInterest("set_pickableObjects__",this),xr(s.X3DBoundedObject,e)&&(e._visible.removeInterest("set_visibles__",this),e._bboxDisplay.removeInterest("set_bboxDisplays__",this));this.clipPlaneNodes.length=0,this.localFogNodes.length=0,this.lightNodes.length=0,this.textureProjectorNodes.length=0,this.pointingDeviceSensorNodes.length=0,this.maybeCameraObjects.length=0,this.maybePickableSensorNodes.length=0,this.childNodes.length=0},add:function(e){if(!this.hidden){for(const t of e)if(t)try{const e=t.getValue().getInnerNode(),n=e.getType();for(let t=n.length-1;t>=0;--t){switch(n[t]){case s.X3DPointingDeviceSensorNode:this.pointingDeviceSensorNodes.push(e);break;case s.ClipPlane:this.clipPlaneNodes.push(e);break;case s.LocalFog:this.localFogNodes.push(e);break;case s.X3DTextureProjectorNode:this.textureProjectorNodes.push(e);break;case s.X3DLightNode:this.lightNodes.push(e);break;case s.X3DBindableNode:this.maybeCameraObjects.push(e);break;case s.TransformSensor:case s.X3DPickSensorNode:e._isPickableObject.addInterest("set_pickableObjects__",this),this.maybePickableSensorNodes.push(e);break;case s.X3DBackgroundNode:case s.X3DChildNode:e._isCameraObject.addInterest("set_cameraObjects__",this),e._isPickableObject.addInterest("set_pickableObjects__",this),xr(s.X3DBoundedObject,e)&&(e._visible.addInterest("set_visibles__",this),e._bboxDisplay.addInterest("set_bboxDisplays__",this)),this.maybeCameraObjects.push(e),this.childNodes.push(e);break;case s.BooleanFilter:case s.BooleanToggle:case s.NurbsOrientationInterpolator:case s.NurbsPositionInterpolator:case s.NurbsSurfaceInterpolator:case s.TimeSensor:case s.X3DFollowerNode:case s.X3DInfoNode:case s.X3DInterpolatorNode:case s.X3DKeyDeviceSensorNode:case s.X3DLayoutNode:case s.X3DScriptNode:case s.X3DSequencerNode:case s.X3DTriggerNode:break;default:continue}break}}catch(e){}this.set_pickableObjects__(),this.set_displayNodes__(),this.set_visibles__(),this.set_bboxDisplays__()}},remove:function(e){for(const n of e)if(n)try{const e=n.getValue().getInnerNode(),i=e.getType();for(let n=i.length-1;n>=0;--n){switch(i[n]){case s.X3DPointingDeviceSensorNode:{const t=this.pointingDeviceSensorNodes.indexOf(e);t>=0&&this.pointingDeviceSensorNodes.splice(t,1);break}case s.ClipPlane:{const t=this.clipPlaneNodes.indexOf(e);t>=0&&this.clipPlaneNodes.splice(t,1);break}case s.LocalFog:{const t=this.localFogNodes.indexOf(e);t>=0&&this.localFogNodes.splice(t,1);break}case s.X3DTextureProjectorNode:{const t=this.textureProjectorNodes.indexOf(e);t>=0&&this.textureProjectorNodes.splice(t,1);break}case s.X3DLightNode:{const t=this.lightNodes.indexOf(e);t>=0&&this.lightNodes.splice(t,1);break}case s.X3DBindableNode:{const t=this.maybeCameraObjects.indexOf(e);t>=0&&this.maybeCameraObjects.splice(t,1);break}case s.TransformSensor:case s.X3DPickSensorNode:{e._isPickableObject.removeInterest("set_pickableObjects__",this);const t=this.maybePickableSensorNodes.indexOf(e);t>=0&&this.maybePickableSensorNodes.splice(t,1);break}case s.X3DBackgroundNode:case s.X3DChildNode:var t;e._isCameraObject.removeInterest("set_cameraObjects__",this),e._isPickableObject.removeInterest("set_pickableObjects__",this),xr(s.X3DBoundedObject,e)&&(e._visible.removeInterest("set_visibles__",this),e._bboxDisplay.removeInterest("set_bboxDisplays__",this)),(t=this.maybeCameraObjects.indexOf(e))>=0&&this.maybeCameraObjects.splice(t,1),(t=this.childNodes.indexOf(e))>=0&&this.childNodes.splice(t,1);break;case s.BooleanFilter:case s.BooleanToggle:case s.NurbsOrientationInterpolator:case s.NurbsPositionInterpolator:case s.NurbsSurfaceInterpolator:case s.TimeSensor:case s.X3DFollowerNode:case s.X3DInfoNode:case s.X3DInterpolatorNode:case s.X3DKeyDeviceSensorNode:case s.X3DLayoutNode:case s.X3DScriptNode:case s.X3DSequencerNode:case s.X3DTriggerNode:break;default:continue}break}}catch(e){}this.set_pickableObjects__(),this.set_displayNodes__(),this.set_visibles__(),this.set_bboxDisplays__()},set_cameraObjects__:function(){const e=this.cameraObjects;e.length=0;for(const t of this.maybeCameraObjects)t.getCameraObject()&&(xr(s.X3DBoundedObject,t)?t._visible.getValue()&&e.push(t):e.push(t));this.setCameraObject(Boolean(e.length))},set_pickableObjects__:function(){const e=this.pickableSensorNodes,t=this.pickableObjects;e.length=0,t.length=0;for(const t of this.maybePickableSensorNodes)t.getPickableObject()&&e.push(t);for(const e of this.childNodes)e.getPickableObject()&&t.push(e);this.set_transformSensors__()},set_transformSensors__:function(){this.setPickableObject(Boolean(this.getTransformSensors().size||this.pickableSensorNodes.length||this.pickableObjects.length))},set_displayNodes__:function(){const e=this.displayNodes;e.length=0;for(const t of this.clipPlaneNodes)e.push(t);for(const t of this.localFogNodes)e.push(t);for(const t of this.lightNodes)e.push(t);for(const t of this.textureProjectorNodes)e.push(t)},set_visibles__:function(){const e=this.childNodes,t=this.visibleNodes;t.length=0;for(const n of e)xr(s.X3DBoundedObject,n)?n._visible.getValue()&&t.push(n):t.push(n);this.set_cameraObjects__()},set_bboxDisplays__:function(){const e=this.boundedObjects;e.length=0;for(const t of this.childNodes)xr(s.X3DBoundedObject,t)&&t._bboxDisplay.getValue()&&e.push(t)},traverse:function(e,t){switch(e){case sr.POINTER:{const n=this.pointingDeviceSensorNodes,i=this.clipPlaneNodes,o=this.sensors;if(o.clear(),n.length){for(const e of n)e.push(t,o);o.size&&this.getBrowser().getSensors().push(o)}for(const e of i)e.push(t);for(const n of this.childNodes)n.traverse(e,t);for(const e of i)e.pop(t);return void(o.size&&this.getBrowser().getSensors().pop())}case sr.CAMERA:for(const n of this.cameraObjects)n.traverse(e,t);return;case sr.PICKING:{if(this.getTransformSensors().size){const e=t.getModelViewMatrix().get();for(const t of this.getTransformSensors())t.collect(e)}for(const n of this.pickableSensorNodes)n.traverse(e,t);const n=this.getBrowser(),i=n.getPickingHierarchy();if(i.push(this),n.getPickable().at(-1))for(const n of this.childNodes)n.traverse(e,t);else for(const n of this.pickableObjects)n.traverse(e,t);return void i.pop()}case sr.COLLISION:{const n=this.clipPlaneNodes;for(const e of n)e.push(t);for(const n of this.childNodes)n.traverse(e,t);for(const e of n)e.pop(t);return}case sr.SHADOW:{const n=this.clipPlaneNodes;for(const e of n)e.push(t);for(const n of this.visibleNodes)n.traverse(e,t);for(const e of n)e.push(t);return}case sr.DISPLAY:{const n=this.displayNodes;for(const e of n)e.push(t,this);for(const n of this.visibleNodes)n.traverse(e,t);for(const n of this.boundedObjects)n.displayBBox(e,t);for(const e of n)e.pop(t);return}}},dispose:function(){vr.prototype.dispose.call(this),yr.prototype.dispose.call(this)}});const Tr=br;function Er(e){Tr.call(this,e),this.addType(s.X3DViewportNode)}Er.prototype=Object.assign(Object.create(Tr.prototype),{constructor:Er});const Cr=Er;function Or(e,t){Jn.call(this,e),this.array=[t],this.transitionNode=t.create(e)}Or.prototype=Object.assign(Object.create(Jn.prototype),{constructor:Or,getTypeName:function(){return"BindableStack"},get:function(){return this.array},top:function(){return this.transitionNode._transitionActive.getValue()?this.transitionNode:this.array.at(-1)},pushOnTop:function(e){e!==this.array[0]&&(this.array.at(-1)._isBound=!1,this.array.push(e)),e._isBound=!0,e._bindTime=this.getBrowser().getCurrentTime(),this.addNodeEvent()},update:function(e,t,n){if(0===t.length&&0===n.length)return;const i=this.top(),o=this.array.at(-1);for(const e of t){const t=this.array.indexOf(e);t>0&&this.array.splice(t,1)}o!==this.array[0]&&n.some((e=>!e._set_bind.getValue()&&e===o))&&this.array.pop();for(const e of n)if(e._set_bind.getValue()){const t=this.array.indexOf(e);t>-1&&this.array.splice(t,1),this.array.push(e)}const r=this.array.at(-1);r!==o&&(o._set_bind=!1,o._isBound=!1,r._set_bind=!0,r._isBound=!0,r._bindTime=this.getBrowser().getCurrentTime(),this.transitionNode=r.create(this.getExecutionContext()),this.transitionNode.setup(),this.transitionNode.transitionStart(e,i,r),this.transitionNode._transitionActive.getValue()&&this.transitionNode._transitionActive.addInterest("set_transitionActive__",this),this.addNodeEvent())},set_transitionActive__:function(e){e.getValue()||(this.transitionNode._transitionActive.removeInterest("set_transitionActive__",this),this.addNodeEvent())}});for(const e of Reflect.ownKeys(Or.prototype))Object.defineProperty(Or.prototype,e,{enumerable:!1});const Nr=Or;function Fr(e,t){Jn.call(this,e),this.collected=[t],this.array=[t],this.updateTime=0,this.removedNodes=[]}Fr.prototype=Object.assign(Object.create(Jn.prototype),{constructor:Fr,getTypeName:function(){return"BindableList"},get:function(){return this.array},getBound:function(e){if(this.array.length>1){const t=!1,n=this.getMainScene();if(e&&e.length)for(let i=1,o=this.array.length;i<o;++i){const o=this.array[i],r=o.getExecutionContext().getOuterNode(),s=r instanceof ao?r.getScene():o.getScene();if((t||s===n)&&o.getName()==e)return o}for(let e=1,i=this.array.length;e<i;++e){const i=this.array[e],o=i.getExecutionContext().getOuterNode(),r=o instanceof ao?o.getScene():i.getScene();if((t||r===n)&&i._isBound.getValue())return i}for(let e=1,i=this.array.length;e<i;++e){const i=this.array[e],o=i.getExecutionContext().getOuterNode(),r=o instanceof ao?o.getScene():i.getScene();if(t||r===n)return i}}return this.array[0]},push:function(e){return this.collected.push(e)},update:function(e,t){const n=this.collected.filter((e=>e._set_bind.getModificationTime()>this.updateTime)),i=this.removedNodes;if(!function(e,t){if(e.length!==t.length)return!1;for(let n=0;n<e.length;++n)if(e[n]!==t[n])return!1;return!0}(this.collected,this.array)){for(const e of this.array)-1===this.collected.indexOf(e)&&i.push(e);const e=this.array;this.array=this.collected,this.collected=e}this.collected.length=1,t.update(e,i,n),i.length=0,this.updateTime=Date.now()}});for(const e of Reflect.ownKeys(Fr.prototype))Object.defineProperty(Fr.prototype,e,{enumerable:!1});const Mr=Fr;function Dr(e){yr.call(this,e),this.addType(s.X3DBindableNode),this.addChildObjects("transitionActive",new Bn.SFBool)}Dr.prototype=Object.assign(Object.create(yr.prototype),{constructor:Dr,getCameraObject:function(){return!0},transitionStart:function(){}});const Ir=Dr,Rr={TELEPORT:!0,LINEAR:!0,ANIMATE:!0};function Vr(e){Ir.call(this,e),this.addType(s.NavigationInfo),this.addChildObjects("transitionStart",new Bn.SFBool,"availableViewers",new Bn.MFString,"viewer",new Bn.SFString("EXAMINE")),this._avatarSize.setUnit("length"),this._speed.setUnit("speed"),this._visibilityLimit.setUnit("speed")}Vr.prototype=Object.assign(Object.create(Ir.prototype),{constructor:Vr,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new P([new N(s.inputOutput,"metadata",new Bn.SFNode),new N(s.inputOnly,"set_bind",new Bn.SFBool),new N(s.inputOutput,"type",new Bn.MFString("EXAMINE","ANY")),new N(s.inputOutput,"avatarSize",new Bn.MFFloat(.25,1.6,.75)),new N(s.inputOutput,"speed",new Bn.SFFloat(1)),new N(s.inputOutput,"headlight",new Bn.SFBool(!0)),new N(s.inputOutput,"visibilityLimit",new Bn.SFFloat),new N(s.inputOutput,"transitionType",new Bn.MFString("LINEAR")),new N(s.inputOutput,"transitionTime",new Bn.SFTime(1)),new N(s.outputOnly,"transitionComplete",new Bn.SFBool),new N(s.outputOnly,"isBound",new Bn.SFBool),new N(s.outputOnly,"bindTime",new Bn.SFTime)]),getTypeName:function(){return"NavigationInfo"},getComponentName:function(){return"Navigation"},getContainerField:function(){return"children"},initialize:function(){Ir.prototype.initialize.call(this),this._type.addInterest("set_type__",this),this._headlight.addInterest("set_headlight__",this),this._transitionStart.addInterest("set_transitionStart__",this),this._transitionComplete.addInterest("set_transitionComplete__",this),this._isBound.addInterest("set_isBound__",this),this.set_type__(),this.set_headlight__()},getViewer:function(){return this._viewer.getValue()},getCollisionRadius:function(){return this._avatarSize.length>0&&this._avatarSize[0]>0?this._avatarSize[0]:.25},getAvatarHeight:function(){return this._avatarSize.length>1?this._avatarSize[1]:1.6},getStepHeight:function(){return this._avatarSize.length>2?this._avatarSize[2]:.75},getNearValue:function(){const e=this.getCollisionRadius();return 0===e?1e-5:e/2},getFarValue:function(e){return this._visibilityLimit.getValue()?this._visibilityLimit.getValue():e.getMaxFarValue()},getTransitionType:function(){for(const e of this._transitionType){if(Rr[e])return e}return"LINEAR"},set_type__:function(){this._viewer="EXAMINE";for(const e of this._type){switch(e){case"EXAMINE":case"WALK":case"FLY":case"LOOKAT":case"PLANE":case"NONE":this._viewer=e;break;case"PLANE_create3000.de":this._viewer="PLANE";break;default:continue}break}let e=!1,t=!1,n=!1,i=!1,o=!1,r=!1;if(this._type.length)for(const s of this._type){switch(s){case"EXAMINE":default:e=!0;continue;case"WALK":t=!0;continue;case"FLY":n=!0;continue;case"LOOKAT":r=!0;continue;case"PLANE":i=!0;continue;case"NONE":o=!0;continue;case"ANY":e=!0,t=!0,n=!0,i=!0,o=!0,r=!0}break}else e=!0,t=!0,n=!0,i=!0,o=!0,r=!0;this._availableViewers.length=0,e&&this._availableViewers.push("EXAMINE"),t&&this._availableViewers.push("WALK"),n&&this._availableViewers.push("FLY"),i&&this._availableViewers.push("PLANE"),r&&this._availableViewers.push("LOOKAT"),o&&this._availableViewers.push("NONE")},set_headlight__:function(){this._headlight.getValue()?delete this.enable:this.enable=Function.prototype},set_transitionStart__:function(){this._transitionActive.getValue()||(this._transitionActive=!0)},set_transitionComplete__:function(){this._transitionActive.getValue()&&(this._transitionActive=!1)},set_isBound__:function(){this._isBound.getValue()||this._transitionActive.getValue()&&(this._transitionActive=!1)},enable:function(e,t){e===sr.DISPLAY&&this._headlight.getValue()&&t.getGlobalObjects().push(this.getBrowser().getHeadlight())},traverse:function(e,t){e===sr.CAMERA&&t.getLayer().getNavigationInfos().push(this)}});const Pr=Vr;function Ar(e){const t=[];return{size:0,pop:function(){return 0!==this.size?t[--this.size]:new e},push:function(e){t[this.size++]=e},clear:function(){t.length=0,this.size=0}}}const Lr=Ar(Ur);function Ur(){this.fogMatrix=new Float32Array(9)}function Br(e){this.addType(s.X3DFogObject),this._visibilityRange.setUnit("length"),this.hidden=!1,this.colorArray=new Float32Array(3)}Ur.prototype={constructor:Ur,set:function(e,t){this.fogNode=e,this.fogKey=String(e.getFogType()),this.fogMatrix.set(t.submatrix.inverse())},getFogKey:function(){return this.fogKey},setShaderUniforms:function(e,t){if(t.hasFog(this))return;const n=this.fogNode;e.uniform3fv(t.x3d_FogColor,n.colorArray),e.uniform1f(t.x3d_FogVisibilityRange,n.visibilityRange),e.uniformMatrix3fv(t.x3d_FogMatrix,!1,this.fogMatrix)},dispose:function(){Lr.push(this)}},Br.prototype={constructor:Br,initialize:function(){this._fogType.addInterest("set_fogType__",this),this._color.addInterest("set_color__",this),this._visibilityRange.addInterest("set_visibilityRange__",this),this.set_color__(),this.set_visibilityRange__()},setHidden:function(e){this.hidden=e,this.set_fogType__(),this.getBrowser().addBrowserEvent()},getHidden:function(){return this.hidden},getFogType:function(){return this.fogType},getFogs:function(){return Lr},set_fogType__:function(){const e=new Map([["LINEAR",1],["EXPONENTIAL",2]]);return function(){this.hidden||0===this.visibilityRange?this.fogType=0:this.fogType=e.get(this._fogType.getValue())||1}}(),set_color__:function(){const e=this._color.getValue(),t=this.colorArray;t[0]=e.r,t[1]=e.g,t[2]=e.b},set_visibilityRange__:function(){this.visibilityRange=Math.max(0,this._visibilityRange.getValue()),this.set_fogType__()},dispose:function(){}};const Xr=Br;function kr(e){Ir.call(this,e),Xr.call(this,e),this.addType(s.Fog),this.modelMatrix=new Nt}kr.prototype=Object.assign(Object.create(Ir.prototype),Xr.prototype,{constructor:kr,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new P([new N(s.inputOutput,"metadata",new Bn.SFNode),new N(s.inputOnly,"set_bind",new Bn.SFBool),new N(s.inputOutput,"fogType",new Bn.SFString("LINEAR")),new N(s.inputOutput,"color",new Bn.SFColor(1,1,1)),new N(s.inputOutput,"visibilityRange",new Bn.SFFloat),new N(s.outputOnly,"isBound",new Bn.SFBool),new N(s.outputOnly,"bindTime",new Bn.SFTime)]),getTypeName:function(){return"Fog"},getComponentName:function(){return"EnvironmentalEffects"},getContainerField:function(){return"children"},initialize:function(){Ir.prototype.initialize.call(this),Xr.prototype.initialize.call(this)},getModelMatrix:function(){return this.modelMatrix},traverse:function(e,t){e===sr.CAMERA&&(t.getLayer().getFogs().push(this),this.modelMatrix.assign(t.getModelViewMatrix().get()))},dispose:function(){Xr.prototype.dispose.call(this),Ir.prototype.dispose.call(this)}});const zr=kr;function jr(){this.vertexArray=null,this.shaderNode=null,this.tainted=!0}jr.prototype={update:function(e=!0){return this.tainted||=e,this},enable:function(e,t){return this.tainted||this.shaderNode!==t?(e.deleteVertexArray(this.vertexArray),this.vertexArray=e.createVertexArray(),this.shaderNode=t,this.tainted=!1,e.bindVertexArray(this.vertexArray),!0):(e.bindVertexArray(this.vertexArray),!1)},disable:function(e){e.bindVertexArray(null)},delete:function(e){e.deleteVertexArray(this.vertexArray)}};const Gr=jr,Hr=[new He(0,0,1),new He(0,0,-1),new He(0,1,0),new He(0,-1,0),new He(1,0,0)];function qr(e){ji.call(this,e),this.addType(s.X3DGeometryNode),this.addChildObjects("transparent",new Bn.SFBool,"bbox_changed",new Bn.SFTime,"rebuild",new Bn.SFTime),this._transparent.setAccessType(s.outputOnly),this._bbox_changed.setAccessType(s.outputOnly),this._rebuild.setAccessType(s.outputOnly);const t=this.getBrowser();this.min=new He(0,0,0),this.max=new He(0,0,0),this.bbox=new hr(this.min,this.max,!0),this.solid=!0,this.primitiveMode=t.getContext().TRIANGLES,this.geometryType=3,this.flatShading=void 0,this.colorMaterial=!1,this.attribNodes=[],this.attribArrays=[],this.textureCoordinateMapping=new Map,this.multiTexCoords=[],this.texCoords=qr.createArray(),this.fogDepths=qr.createArray(),this.colors=qr.createArray(),this.normals=qr.createArray(),this.flatNormals=qr.createArray(),this.vertices=qr.createArray(),this.hasFogCoords=!1,this.hasNormals=!1,this.geometryKey="",this.vertexCount=0,this.planes=[];for(let e=0;e<5;++e)this.planes[e]=new qo(He.Zero,He.zAxis)}qr.createArray=function(){const e=[];return e.typedArray=new Float32Array,e.assign=function(e){const t=e.length;for(let n=0;n<t;++n)this[n]=e[n];this.length=t},e.getValue=function(){return this.typedArray},e.shrinkToFit=function(){this.length===this.typedArray.length?this.typedArray.set(this):this.typedArray=new Float32Array(this)},e},qr.prototype=Object.assign(Object.create(ji.prototype),{constructor:qr,setup:function(){ji.prototype.setup.call(this),this.rebuild()},initialize:function(){ji.prototype.initialize.call(this);const e=this.getBrowser(),t=e.getContext();this.isLive().addInterest("set_live__",this),this.addInterest("requestRebuild",this),this._rebuild.addInterest("rebuild",this),this.frontFace=t.CCW,this.backFace=new Map([[t.CCW,t.CW],[t.CW,t.CCW]]),this.attribBuffers=[],this.textureCoordinateNode=e.getDefaultTextureCoordinate(),this.texCoordBuffers=Array.from({length:e.getMaxTextures()},(()=>t.createBuffer())),this.fogDepthBuffer=t.createBuffer(),this.colorBuffer=t.createBuffer(),this.normalBuffer=t.createBuffer(),this.vertexBuffer=t.createBuffer(),this.vertexArrayObject=new Gr,this.shadowArrayObject=new Gr,this.set_live__()},setGeometryType:function(e){this.geometryType=e},getGeometryType:function(){return this.geometryType},setTransparent:function(e){e!==this._transparent.getValue()&&(this._transparent=e)},getTransparent:function(){return this._transparent.getValue()},getBBox:function(){return this.bbox},setBBox:function(e){if(!e.equals(this.bbox)){e.getExtents(this.min,this.max),this.bbox.assign(e);for(let e=0;e<5;++e)this.planes[e].set(e%2?this.min:this.max,Hr[e]);this._bbox_changed.addEvent()}},getMin:function(){return this.min},getMax:function(){return this.max},getMatrix:function(){return Nt.Identity},setPrimitiveMode:function(e){this.primitiveMode=e},getPrimitiveMode:function(){return this.primitiveMode},setSolid:function(e){this.solid=e},setCCW:function(e){const t=this.getBrowser().getContext();this.frontFace=e?t.CCW:t.CW},getAttrib:function(){return this.attribNodes},getAttribs:function(){return this.attribArrays},getAttribBuffers:function(){return this.attribBuffers},setFogDepths:function(e){this.fogDepths.assign(e)},getFogDepths:function(){return this.fogDepths},setColors:function(e){this.colors.assign(e)},getColors:function(){return this.colors},setMultiTexCoords:function(e){const t=this.multiTexCoords,n=e.length;for(let i=0;i<n;++i)t[i]=e[i];t.length=n},getMultiTexCoords:function(){return this.multiTexCoords},getTexCoords:function(){return this.texCoords},getTextureCoordinate:function(){return this.textureCoordinateNode},setTextureCoordinate:function(e){this.textureCoordinateNode.removeInterest("updateTextureCoordinateMapping",this),this.textureCoordinateNode=e||this.getBrowser().getDefaultTextureCoordinate(),this.textureCoordinateNode.addInterest("updateTextureCoordinateMapping",this),this.updateTextureCoordinateMapping()},getTextureCoordinateMapping:function(){return this.textureCoordinateMapping},updateTextureCoordinateMapping:function(){this.textureCoordinateMapping.clear(),this.textureCoordinateNode.getTextureCoordinateMapping(this.textureCoordinateMapping)},setNormals:function(e){this.normals.assign(e)},getNormals:function(){return this.normals},setVertices:function(e){this.vertices.assign(e)},getVertices:function(){return this.vertices},updateVertexArrays:function(){this.vertexArrayObject.update(),this.shadowArrayObject.update(),this.updateParticlesShadow=!0,this.updateParticles=!0},buildTexCoords:function(){const e=this.texCoords;if(0===e.length){const t=this.getTexCoordParams(),n=t.min,i=t.Sindex,o=t.Tindex,r=t.Ssize,s=n[i],a=n[o],u=this.vertices.getValue();for(let t=0,n=u.length;t<n;t+=4)e.push((u[t+i]-s)/r,(u[t+o]-a)/r,0,1);e.shrinkToFit()}this.getMultiTexCoords().push(e)},getTexCoordParams:function(){const e={min:new He(0,0,0),Ssize:0,Sindex:0,Tindex:0};return function(){const t=this.getBBox(),n=t.size,i=n.x,o=n.y,r=n.z;return e.min.assign(t.center).subtract(n.divide(2)),i>=o&&i>=r?(e.Ssize=i,e.Sindex=0,e.Tindex=o>=r?1:2):o>=i&&o>=r?(e.Ssize=o,e.Sindex=1,e.Tindex=i>=r?0:2):(e.Ssize=r,e.Sindex=2,e.Tindex=i>=o?0:1),e}}(),refineNormals:function(e,t,n){if(0===n)return t;const i=Math.cos(ee.clamp(n,0,Math.PI)),o=[];for(const n in e){const r=e[n];for(const e of r){const n=t[e],s=new He(0,0,0);for(const e of r){const o=t[e];o.dot(n)>=i&&s.add(o)}o[e]=s.normalize()}}return o},transformLine:function(e){},transformMatrix:function(e){},isClipped:function(e,t){return t.some((function(t){return t.isClipped(e)}))},intersectsLine:function(e,t,n,i,o){return this.intersectsLineWithGeometry(e,t.getModelViewMatrix().get(),t.getLocalObjects(),o)},intersectsLineWithGeometry:function(){const e=new Nt,t={u:0,v:0,t:0},n=new He(0,0,0),i=new He(0,0,0),o=new He(0,0,0),r=new He(0,0,0);return function(s,a,u,l){if(this.intersectsBBox(s)){this.transformLine(s),this.transformMatrix(e.assign(a));const c=this.multiTexCoords[0].getValue(),h=this.normals.getValue(),d=this.vertices.getValue(),p=this.vertexCount;for(let a=0;a<p;a+=3){const p=4*a;if(n.x=d[p],n.y=d[p+1],n.z=d[p+2],i.x=d[p+4],i.y=d[p+5],i.z=d[p+6],o.x=d[p+8],o.y=d[p+9],o.z=d[p+10],s.intersectsTriangle(n,i,o,t)){const n=t.u,i=t.v,o=t.t,s=new He(o*d[p]+n*d[p+4]+i*d[p+8],o*d[p+1]+n*d[p+5]+i*d[p+9],o*d[p+2]+n*d[p+6]+i*d[p+10]);if(u.length&&this.isClipped(e.multVecMatrix(r.assign(s)),u))continue;const f=new ke(o*c[p]+n*c[p+4]+i*c[p+8],o*c[p+1]+n*c[p+5]+i*c[p+9]),g=3*a,m=new He(o*h[g]+n*h[g+3]+i*h[g+6],o*h[g+1]+n*h[g+4]+i*h[g+7],o*h[g+2]+n*h[g+5]+i*h[g+8]);l.push({texCoord:f,normal:m,point:this.getMatrix().multVecMatrix(s)})}}}return l.length}}(),getPlanesWithOffset:function(){const e=new He(0,0,0),t=new He(0,0,0),n=[];for(let e=0;e<5;++e)n[e]=new qo(He.Zero,He.zAxis);return function(i,o,r,s,a,u){e.set(i,o,r),t.set(s,a,u);for(let i=0;i<5;++i)n[i].set(i%2?e:t,Hr[i]);return n}}(),intersectsBBox:function(){const e=new He(0,0,0);return function(t,n){if(n)var i=this.min,o=this.max,r=i.x-n.x,s=o.x+n.x,a=i.y-n.y,u=o.y+n.y,l=i.z-n.z,c=o.z+n.z,h=this.getPlanesWithOffset(r,a,l,s,u,c);else i=this.min,o=this.max,r=i.x,s=o.x,a=i.y,u=o.y,l=i.z,c=o.z,h=this.planes;return!!(h[0].intersectsLine(t,e)&&e.x>=r&&e.x<=s&&e.y>=a&&e.y<=u)||(!!(h[1].intersectsLine(t,e)&&e.x>=r&&e.x<=s&&e.y>=a&&e.y<=u)||(!!(h[2].intersectsLine(t,e)&&e.x>=r&&e.x<=s&&e.z>=l&&e.z<=c)||(!!(h[3].intersectsLine(t,e)&&e.x>=r&&e.x<=s&&e.z>=l&&e.z<=c)||!!(h[4].intersectsLine(t,e)&&e.y>=a&&e.y<=u&&e.z>=l&&e.z<=c))))}}(),intersectsBox:function(){const e=new He(0,0,0),t=new He(0,0,0),n=new He(0,0,0),i=new Nt,o=new He(0,0,0);return function(r,s,a){if(r.intersectsBox(this.bbox)){r.multRight(i.assign(this.getMatrix()).inverse()),this.transformMatrix(a);const u=this.vertices.getValue();for(let i=0,l=this.vertexCount;i<l;i+=3){const l=4*i;if(e.x=u[l],e.y=u[l+1],e.z=u[l+2],t.x=u[l+4],t.y=u[l+5],t.z=u[l+6],n.x=u[l+8],n.y=u[l+9],n.z=u[l+10],r.intersectsTriangle(e,t,n)){if(s.length){if(this.isClipped(a.multVecMatrix(o.assign(e)),s))continue;if(this.isClipped(a.multVecMatrix(o.assign(t)),s))continue;if(this.isClipped(a.multVecMatrix(o.assign(n)),s))continue}return!0}}}return!1}}(),set_live__:function(){this.isLive().getValue()?this.getBrowser().getBrowserOptions()._Shading.addInterest("set_shading__",this):this.getBrowser().getBrowserOptions()._Shading.removeInterest("set_shading__",this)},set_shading__:function(){const e=new He(0,0,0),t=new He(0,0,0),n=new He(0,0,0),i=new He(0,0,0);return function(o){if(this.geometryType<2)return;const r=this.getBrowser(),s=r.getBrowserOptions().getShading()===gi.FLAT;if(s===this.flatShading)return;this.flatShading=s;const a=r.getContext();if(s&&!this.flatNormals.length){const o=this.frontFace===a.CW,r=this.flatNormals,s=this.vertices.getValue();for(let a=0,u=s.length;a<u;a+=12)Yo.normal(e.set(s[a],s[a+1],s[a+2]),t.set(s[a+4],s[a+5],s[a+6]),n.set(s[a+8],s[a+9],s[a+10]),i),o&&i.negate(),r.push(i.x,i.y,i.z,i.x,i.y,i.z,i.x,i.y,i.z);r.shrinkToFit()}a.bindBuffer(a.ARRAY_BUFFER,this.normalBuffer),a.bufferData(a.ARRAY_BUFFER,s?this.flatNormals.getValue():this.normals.getValue(),a.DYNAMIC_DRAW)}}(),requestRebuild:function(){this._rebuild.addEvent()},rebuild:function(){const e=new He(0,0,0);return function(){this.clear(),this.build();for(const e of this.attribArrays)e.shrinkToFit();for(const e of this.multiTexCoords)e.shrinkToFit();this.fogDepths.shrinkToFit(),this.colors.shrinkToFit(),this.normals.shrinkToFit(),this.vertices.shrinkToFit();const t=this.min,n=this.max,i=this.vertices.getValue();if(i.length){if(t.x===Number.POSITIVE_INFINITY)for(let o=0,r=i.length;o<r;o+=4)e.set(i[o],i[o+1],i[o+2]),t.min(e),n.max(e);this.bbox.setExtents(t,n)}else this.bbox.setExtents(t.set(0,0,0),n.set(0,0,0));this._bbox_changed.addEvent();for(let e=0;e<5;++e)this.planes[e].set(e%2?t:n,Hr[e]);if(0===this.multiTexCoords.length&&this.buildTexCoords(),this.multiTexCoords.length){const e=this.getBrowser().getMaxTextures();for(let t=this.multiTexCoords.length;t<e;++t)this.multiTexCoords[t]=this.multiTexCoords.at(-1);this.multiTexCoords.length=e}this.transfer(),this.updateGeometryKey(),this.updateRenderFunctions()}}(),clear:function(){this.min.set(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),this.max.set(Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY);{const e=this.attribArrays;for(const t of e)t.length=0;const t=this.attribNodes.length;for(let n=e.length;n<t;++n)e[n]=qr.createArray();e.length=t}this.flatShading=void 0,this.fogDepths.length=0,this.colors.length=0,this.multiTexCoords.length=0,this.texCoords.length=0,this.normals.length=0,this.flatNormals.length=0,this.vertices.length=0},transfer:function(){const e=this.getBrowser().getContext();for(let t=this.attribBuffers.length,n=this.attribArrays.length;t<n;++t)this.attribBuffers.push(e.createBuffer());for(let t=0,n=this.attribArrays.length;t<n;++t)e.bindBuffer(e.ARRAY_BUFFER,this.attribBuffers[t]),e.bufferData(e.ARRAY_BUFFER,this.attribArrays[t].getValue(),e.DYNAMIC_DRAW);const t=this.hasFogCoords;e.bindBuffer(e.ARRAY_BUFFER,this.fogDepthBuffer),e.bufferData(e.ARRAY_BUFFER,this.fogDepths.getValue(),e.DYNAMIC_DRAW),this.hasFogCoords=!!this.fogDepths.length,this.hasFogCoords!==t&&this.updateVertexArrays();const n=this.colorMaterial;e.bindBuffer(e.ARRAY_BUFFER,this.colorBuffer),e.bufferData(e.ARRAY_BUFFER,this.colors.getValue(),e.DYNAMIC_DRAW),this.colorMaterial=!!this.colors.length,this.colorMaterial!==n&&this.updateVertexArrays();for(let t=0,n=this.multiTexCoords.length;t<n;++t)e.bindBuffer(e.ARRAY_BUFFER,this.texCoordBuffers[t]),e.bufferData(e.ARRAY_BUFFER,this.multiTexCoords[t].getValue(),e.DYNAMIC_DRAW);const i=this.hasNormals;this.set_shading__(this.getBrowser().getBrowserOptions()._Shading),this.hasNormals=!!this.normals.getValue().length,this.hasNormals!==i&&this.updateVertexArrays(),e.bindBuffer(e.ARRAY_BUFFER,this.vertexBuffer),e.bufferData(e.ARRAY_BUFFER,this.vertices.getValue(),e.DYNAMIC_DRAW),this.vertexCount=this.vertices.length/4},updateGeometryKey:function(){this.geometryKey="",this.geometryKey+=this.geometryType,this.geometryKey+=this.hasFogCoords?"1":"0",this.geometryKey+=this.colorMaterial?"1":"0",this.geometryKey+=this.hasNormals?"1":"0"},updateRenderFunctions:function(){this.vertexCount?(delete this.depth,delete this.display,delete this.displayParticlesDepth,delete this.displayParticles):(this.depth=Function.prototype,this.display=Function.prototype,this.displayParticlesDepth=Function.prototype,this.displayParticles=Function.prototype)},traverse:function(e,t){},depth:function(e,t,n){this.shadowArrayObject.enable(e,n)&&n.enableVertexAttribute(e,this.vertexBuffer,0,0),e.drawArrays(this.primitiveMode,0,this.vertexCount)},display:function(e,t){const n=t.appearanceNode,i=n.getShader(this,t);if(this.solid||!n.getBackMaterial()||this.getBrowser().getWireframe())this.displayGeometry(e,t,n,i,!0,!0);else{const o=n.getBackShader(this,t);this.displayGeometry(e,t,n,o,!0,!1),this.displayGeometry(e,t,n,i,!1,!0)}},displayGeometry:function(e,t,n,i,o,r){const s=this.getBrowser(),a=n.getBlendMode(),u=this.attribNodes,l=this.attribBuffers,c=s.getPrimitiveMode(this.primitiveMode);if(a&&a.enable(e),i.enable(e),i.setUniforms(e,this,t,r),this.vertexArrayObject.enable(e,i)){for(let t=0,n=u.length;t<n;++t)u[t].enable(e,i,l[t]);this.hasFogCoords&&i.enableFogDepthAttribute(e,this.fogDepthBuffer,0,0),this.colorMaterial&&i.enableColorAttribute(e,this.colorBuffer,0,0),i.enableTexCoordAttribute(e,this.texCoordBuffers,0,0),i.enableNormalAttribute(e,this.normalBuffer,0,0),i.enableVertexAttribute(e,this.vertexBuffer,0,0)}if(s.getWireframe())for(let t=0,n=this.vertexCount;t<n;t+=3)e.drawArrays(c,t,3);else{const n=Nt.prototype.determinant3.call(t.modelViewMatrix)>0;e.frontFace(n?this.frontFace:this.backFace.get(this.frontFace)),t.transparent||o!==r?(e.enable(e.CULL_FACE),o&&!this.solid&&(e.cullFace(e.FRONT),e.drawArrays(c,0,this.vertexCount)),r&&(e.cullFace(e.BACK),e.drawArrays(c,0,this.vertexCount))):(this.solid?e.enable(e.CULL_FACE):e.disable(e.CULL_FACE),e.drawArrays(c,0,this.vertexCount))}a&&a.disable(e)},displayParticlesDepth:function(e,t,n,i){const o=i.outputParticles;if(o.shadowArrayObject.update(this.updateParticlesShadow).enable(e,n)){const t=i.particleStride;n.enableParticleAttribute(e,o,t,i.particleOffset,1),n.enableParticleMatrixAttribute(e,o,t,i.matrixOffset,1),n.enableVertexAttribute(e,this.vertexBuffer,0,0),this.updateParticlesShadow=!1}e.drawArraysInstanced(this.primitiveMode,0,this.vertexCount,i.numParticles)},displayParticles:function(e,t,n){const i=t.appearanceNode,o=i.getShader(this,t);if(this.solid||!i.getBackMaterial()||this.getBrowser().getWireframe())this.displayParticlesGeometry(e,t,i,o,!0,!0,n);else{const r=i.getBackShader(this,t);this.displayParticlesGeometry(e,t,i,r,!0,!1,n),this.displayParticlesGeometry(e,t,i,o,!1,!0,n)}},displayParticlesGeometry:function(e,t,n,i,o,r,s){const a=this.getBrowser(),u=n.getBlendMode(),l=this.attribNodes,c=this.attribBuffers,h=a.getPrimitiveMode(this.primitiveMode);u&&u.enable(e),i.enable(e),i.setUniforms(e,this,t,r);const d=s.outputParticles;if(d.vertexArrayObject.update(this.updateParticles).enable(e,i)){const t=s.particleStride;i.enableParticleAttribute(e,d,t,s.particleOffset,1),i.enableParticleMatrixAttribute(e,d,t,s.matrixOffset,1);for(let t=0,n=l.length;t<n;++t)l[t].enable(e,i,c[t]);this.hasFogCoords&&i.enableFogDepthAttribute(e,this.fogDepthBuffer,0,0),this.colorMaterial&&i.enableColorAttribute(e,this.colorBuffer,0,0),i.enableTexCoordAttribute(e,this.texCoordBuffers,0,0),i.enableNormalAttribute(e,this.normalBuffer,0,0),i.enableVertexAttribute(e,this.vertexBuffer,0,0),this.updateParticles=!1}const p=Nt.prototype.determinant3.call(t.modelViewMatrix)>0;e.frontFace(p?this.frontFace:this.backFace.get(this.frontFace)),t.transparent||o!==r?(e.enable(e.CULL_FACE),o&&!this.solid&&(e.cullFace(e.FRONT),e.drawArraysInstanced(h,0,this.vertexCount,s.numParticles)),r&&(e.cullFace(e.BACK),e.drawArraysInstanced(h,0,this.vertexCount,s.numParticles))):(this.solid?e.enable(e.CULL_FACE):e.disable(e.CULL_FACE),e.drawArraysInstanced(h,0,this.vertexCount,s.numParticles)),u&&u.disable(e)}});const Wr=qr;function Yr(e={}){Object.assign(this,{geometryType:3,hasFogCoords:!1,colorMaterial:!1,hasNormals:!1,textureNode:!1,objectsCount:[0,0,0],textureCoordinateMapping:new Map,textureCoordinateNode:null},e),this.updateGeometryKey()}Yr.prototype={constructor:Yr,updateGeometryKey:Wr.prototype.updateGeometryKey,getTextureCoordinateMapping:function(){return this.textureCoordinateMapping},getTextureCoordinate:function(){return this.textureCoordinateNode}};const Kr=Yr;function Zr(e,t){this.real=e,this.imag=t}Zr.prototype={constructor:Zr,[Symbol.iterator]:function*(){yield this.real,yield this.imag},copy:function(){const e=Object.create(Zr.prototype);return e.real=this.real,e.imag=this.imag,e},assign:function(e){return this.real=e.real,this.imag=e.imag,this},equals:function(e){return this.real===e.real&&this.imag===e.imag},setPolar:function(e,t){return this.real=e*Math.cos(t),this.imag=e*Math.sin(t),this},conjugate:function(){return this.imag=-this.imag,this},negate:function(){return this.real=-this.real,this.imag=-this.imag,this},inverse:function(){const e=this.real*this.real+this.imag*this.imag;return this.real/=e,this.imag/=-e,this},add:function(e){return this.real+=e.real,this.imag+=e.imag,this},subtract:function(e){return this.real-=e.real,this.imag-=e.imag,this},multiply:function(e){return this.real*=e,this.imag*=e,this},multComp:function(){const e=this.real,t=this.imag;return this.real=e*value.real-t*value.imag,this.imag=e*value.imag+t*value.real,this},divComp:function(e){const t=this.real,n=this.imag,i=e.real,o=e.imag,r=i*i+o*o;return this.real=(t*i+n*o)/r,this.imag=(n*i-t*o)/r,this},toString:function(){return this.imag?this.real+" "+this.imag+"i":String(this.real)}},Object.defineProperty(Zr.prototype,"magnitude",{get:function(){return this.real?this.imag?Math.hypot(this.real,this.imag):Math.abs(this.real):Math.abs(this.imag)},set:function(e){this.setPolar(e,this.angle)},enumerable:!1,configurable:!1}),Object.defineProperty(Zr.prototype,"angle",{get:function(){return Math.atan2(this.imag,this.real)},set:function(e){this.setPolar(this.magnitude,e)},enumerable:!1,configurable:!1}),Object.assign(Zr,{Polar:function(e,t){return Object.create(Zr.prototype).setPolar(e,t)},multiply:function(e,t){return e.copy().multiply(t)},multComp:function(e,t){return e.copy().multComp(t)}});const Qr=Zr;function $r(e=0){this.value=e}$r.prototype={constructor:$r,get:function(e){const t=1<<e;return!!(this.value&t)},set:function(e,t){const n=1<<e;t?this.value|=n:this.value&=~n},clear:function(){this.value=0},valueOf:function(){return this.value},toString:function(e){return this.value.toString(e)}};const Jr=$r,es=Math.SQRT2/2;function ts(e){Ir.call(this,e),this.addType(s.X3DBackgroundNode),this._skyAngle.setUnit("angle"),this._groundAngle.setUnit("angle");this.getBrowser();this.hidden=!1,this.projectionMatrixArray=new Float32Array(16),this.modelMatrix=new Nt,this.modelViewMatrixArray=new Float32Array(16),this.clipPlanes=[],this.colors=[],this.sphere=[],this.textureBits=new Jr,this.sphereContext=new Kr({colorMaterial:!0}),this.texturesContext=new Kr({textureNode:!0})}ts.prototype=Object.assign(Object.create(Ir.prototype),{constructor:ts,initialize:function(){Ir.prototype.initialize.call(this);const e=this.getBrowser(),t=e.getContext();this.colorBuffer=t.createBuffer(),this.sphereBuffer=t.createBuffer(),this.texCoordBuffers=new Array(e.getMaxTextures()).fill(t.createBuffer()),this.frontBuffer=t.createBuffer(),this.backBuffer=t.createBuffer(),this.leftBuffer=t.createBuffer(),this.rightBuffer=t.createBuffer(),this.topBuffer=t.createBuffer(),this.bottomBuffer=t.createBuffer(),this.sphereArrayObject=new Gr,this.frontArrayObject=new Gr,this.backArrayObject=new Gr,this.leftArrayObject=new Gr,this.rightArrayObject=new Gr,this.topArrayObject=new Gr,this.bottomArrayObject=new Gr,this._groundAngle.addInterest("build",this),this._groundColor.addInterest("build",this),this._skyAngle.addInterest("build",this),this._skyColor.addInterest("build",this),this.build(),this.transferRectangle()},set_frontTexture__:function(e){this.updateTexture("frontTexture",e,0)},set_backTexture__:function(e){this.updateTexture("backTexture",e,1)},set_leftTexture__:function(e){this.updateTexture("leftTexture",e,2)},set_rightTexture__:function(e){this.updateTexture("rightTexture",e,3)},set_topTexture__:function(e){this.updateTexture("topTexture",e,4)},set_bottomTexture__:function(e){this.updateTexture("bottomTexture",e,5)},updateTexture:function(e,t,n){this[e]&&this[e]._loadState.removeInterest("setTextureBit",this),this[e]=t,t?(t._loadState.addInterest("setTextureBit",this,n,t),this.setTextureBit(n,t,t._loadState)):this.textureBits.set(n,!1)},setTextureBit:function(e,t,n){this.textureBits.set(e,n.getValue()===s.COMPLETE_STATE||t&&t.getData())},setHidden:function(e){this.hidden=e,this.getBrowser().addBrowserEvent()},getHidden:function(){return this.hidden},getTransparent:function(){return!!this.hidden||0!==this._transparency.getValue()&&(!(this.frontTexture&&!this.frontTexture._transparent.getValue())||(!(this.backTexture&&!this.backTexture._transparent.getValue())||(!(this.leftTexture&&!this.leftTexture._transparent.getValue())||(!(this.rightTexture&&!this.rightTexture._transparent.getValue())||(!(this.topTexture&&!this.topTexture._transparent.getValue())||!(this.bottomTexture&&!this.bottomTexture._transparent.getValue()))))))},getColor:function(e,t,n){return t[ee.upperBound(n,0,n.length,e)]},build:function(){const e=es;if(this.colors.length=0,this.sphere.length=0,0===this._groundColor.length&&1==this._skyColor.length){this.sphere.vertices=36,this.sphere.push(e,e,-e,1,-e,e,-e,1,-e,-e,-e,1,e,e,-e,1,-e,-e,-e,1,e,-e,-e,1,-e,e,e,1,e,e,e,1,-e,-e,e,1,-e,-e,e,1,e,e,e,1,e,-e,e,1,-e,e,-e,1,-e,e,e,1,-e,-e,e,1,-e,e,-e,1,-e,-e,e,1,-e,-e,-e,1,e,e,e,1,e,e,-e,1,e,-e,e,1,e,-e,e,1,e,e,-e,1,e,-e,-e,1,e,e,e,1,-e,e,e,1,-e,e,-e,1,e,e,e,1,-e,e,-e,1,e,e,-e,1,-e,-e,e,1,e,-e,e,1,-e,-e,-e,1,-e,-e,-e,1,e,-e,e,1,e,-e,-e,1);const t=this._skyColor[0];for(let e=0,n=this.sphere.vertices;e<n;++e)this.colors.push(t.r,t.g,t.b,1)}else{if(this._skyColor.length>this._skyAngle.length){const e=this._skyAngle.slice();(0===e.length||e[0]>0)&&e.unshift(0),e.at(-1)<Math.PI&&e.push(Math.PI),2===e.length&&e.splice(1,0,(e[0]+e[1])/2),this.buildSphere(1,e,this._skyAngle,this._skyColor,!1)}if(this._groundColor.length>this._groundAngle.length){const e=this._groundAngle.slice().reverse();(0===e.length||e[0]<Math.PI/2)&&e.unshift(Math.PI/2),e.at(-1)>0&&e.push(0),this.buildSphere(1,e,this._groundAngle,this._groundColor,!0)}}this.transferSphere()},buildSphere:function(){const e=new Qr(0,0),t=new Qr(0,0),n=new Qr(0,0),i=new Qr(0,0),o=new Qr(0,0),r=new Qr(0,0);return function(s,a,u,l,c){const h=c?Math.PI/2:Math.PI,d=a.length-1;for(let p=0;p<d;++p){let d=ee.clamp(a[p],0,h),f=ee.clamp(a[p+1],0,h);c&&(d=Math.PI-d,f=Math.PI-f),e.setPolar(s,d),t.setPolar(s,f);const g=this.getColor(a[p],l,u),m=this.getColor(a[p+1],l,u);for(let s=0;s<20;++s){const a=s<19?s+1:0;let u=2*Math.PI*(s/20);n.setPolar(-e.imag,u),i.setPolar(-t.imag,u),u=2*Math.PI*(a/20),o.setPolar(-t.imag,u),r.setPolar(-e.imag,u),this.colors.push(g.r,g.g,g.b,1,m.r,m.g,m.b,1,m.r,m.g,m.b,1,g.r,g.g,g.b,1,g.r,g.g,g.b,1,m.r,m.g,m.b,1),this.sphere.push(n.imag,e.real,n.real,1,o.imag,t.real,o.real,1,i.imag,t.real,i.real,1,n.imag,e.real,n.real,1,r.imag,e.real,r.real,1,o.imag,t.real,o.real,1)}}}}(),transferSphere:function(){const e=this.getBrowser().getContext();e.bindBuffer(e.ARRAY_BUFFER,this.colorBuffer),e.bufferData(e.ARRAY_BUFFER,new Float32Array(this.colors),e.DYNAMIC_DRAW),e.bindBuffer(e.ARRAY_BUFFER,this.sphereBuffer),e.bufferData(e.ARRAY_BUFFER,new Float32Array(this.sphere),e.DYNAMIC_DRAW),this.sphereCount=this.sphere.length/4},transferRectangle:function(){const e=[1,1,0,1,0,1,0,1,0,0,0,1,1,1,0,1,0,0,0,1,1,0,0,1],t=[es,es,-es,1,-es,es,-es,1,-es,-es,-es,1,es,es,-es,1,-es,-es,-es,1,es,-es,-es,1],n=[-es,es,es,1,es,es,es,1,es,-es,es,1,-es,es,es,1,es,-es,es,1,-es,-es,es,1],i=[-es,es,-es,1,-es,es,es,1,-es,-es,es,1,-es,es,-es,1,-es,-es,es,1,-es,-es,-es,1],o=[es,es,es,1,es,es,-es,1,es,-es,-es,1,es,es,es,1,es,-es,-es,1,es,-es,es,1],r=[es,es,es,1,-es,es,es,1,-es,es,-es,1,es,es,es,1,-es,es,-es,1,es,es,-es,1],s=[es,-es,-es,1,-es,-es,-es,1,-es,-es,es,1,es,-es,-es,1,-es,-es,es,1,es,-es,es,1];return function(){const a=this.getBrowser().getContext();a.bindBuffer(a.ARRAY_BUFFER,this.texCoordBuffers[0]),a.bufferData(a.ARRAY_BUFFER,new Float32Array(e),a.DYNAMIC_DRAW),a.bindBuffer(a.ARRAY_BUFFER,this.frontBuffer),a.bufferData(a.ARRAY_BUFFER,new Float32Array(t),a.DYNAMIC_DRAW),a.bindBuffer(a.ARRAY_BUFFER,this.backBuffer),a.bufferData(a.ARRAY_BUFFER,new Float32Array(n),a.DYNAMIC_DRAW),a.bindBuffer(a.ARRAY_BUFFER,this.leftBuffer),a.bufferData(a.ARRAY_BUFFER,new Float32Array(i),a.DYNAMIC_DRAW),a.bindBuffer(a.ARRAY_BUFFER,this.rightBuffer),a.bufferData(a.ARRAY_BUFFER,new Float32Array(o),a.DYNAMIC_DRAW),a.bindBuffer(a.ARRAY_BUFFER,this.topBuffer),a.bufferData(a.ARRAY_BUFFER,new Float32Array(r),a.DYNAMIC_DRAW),a.bindBuffer(a.ARRAY_BUFFER,this.bottomBuffer),a.bufferData(a.ARRAY_BUFFER,new Float32Array(s),a.DYNAMIC_DRAW)}}(),traverse:function(e,t){switch(e){case sr.CAMERA:return t.getLayer().getBackgrounds().push(this),void this.modelMatrix.assign(t.getModelViewMatrix().get());case sr.DISPLAY:{const e=t.getLocalObjects(),n=this.clipPlanes;let i=0;for(let t=0,o=e.length;t<o;++t)e[t].isClipped&&(n[i++]=e[t]);return n.length=i,this.sphereContext.objectsCount[0]=n.length,void(this.texturesContext.objectsCount[0]=n.length)}}},display:function(){const e=new Nt,t=new Nt,n=new Et,i=new He(0,0,0),o=new He(0,0,0);return function(r,s,a){if(this.hidden)return;r.depthMask(!1),r.disable(r.DEPTH_TEST),r.enable(r.CULL_FACE),r.frontFace(r.CCW);const u=.8*-nr.unProjectPointMatrix(0,0,1,e.assign(s.getProjectionMatrix().get()).inverse(),a,o).z;this.projectionMatrixArray.set(s.getProjectionMatrix().get()),t.assign(this.modelMatrix),t.multRight(s.getViewMatrix().get()),t.get(null,n),t.identity(),t.rotate(n),t.scale(i.set(u,u,u)),this.modelViewMatrixArray.set(t),this.drawSphere(s),+this.textureBits&&this.drawCube(s)}}(),drawSphere:function(e){const t=this._transparency.getValue();if(t>=1)return;const n=this.getBrowser(),i=n.getContext(),o=n.getDefaultMaterial().getShader(this.sphereContext);o.enable(i),o.setClipPlanes(i,this.clipPlanes),i.uniformMatrix4fv(o.x3d_ProjectionMatrix,!1,this.projectionMatrixArray),i.uniformMatrix4fv(o.x3d_ModelViewMatrix,!1,this.modelViewMatrixArray),i.uniform1f(o.x3d_Transparency,t),i.uniform1i(o.x3d_TextureCoordinateGeneratorMode[0],0),this.sphereArrayObject.enable(i,o)&&(o.enableColorAttribute(i,this.colorBuffer,0,0),o.enableVertexAttribute(i,this.sphereBuffer,0,0)),t?i.enable(i.BLEND):i.disable(i.BLEND),i.drawArrays(i.TRIANGLES,0,this.sphereCount)},drawCube:function(){const e=new Float32Array(Nt.Identity);return function(t){const n=this.getBrowser(),i=n.getContext(),o=n.getDefaultMaterial().getShader(this.texturesContext);o.enable(i),o.setClipPlanes(i,this.clipPlanes),i.uniformMatrix4fv(o.x3d_ProjectionMatrix,!1,this.projectionMatrixArray),i.uniformMatrix4fv(o.x3d_ModelViewMatrix,!1,this.modelViewMatrixArray),i.uniformMatrix4fv(o.x3d_TextureMatrix[0],!1,e),i.uniform3f(o.x3d_EmissiveColor,1,1,1),i.uniform1f(o.x3d_Transparency,0),i.uniform1i(o.x3d_TextureCoordinateGeneratorMode[0],0),this.drawRectangle(i,n,o,t,this.frontTexture,this.frontBuffer,this.frontArrayObject),this.drawRectangle(i,n,o,t,this.backTexture,this.backBuffer,this.backArrayObject),this.drawRectangle(i,n,o,t,this.leftTexture,this.leftBuffer,this.leftArrayObject),this.drawRectangle(i,n,o,t,this.rightTexture,this.rightBuffer,this.rightArrayObject),this.drawRectangle(i,n,o,t,this.topTexture,this.topBuffer,this.topArrayObject),this.drawRectangle(i,n,o,t,this.bottomTexture,this.bottomBuffer,this.bottomArrayObject)}}(),drawRectangle:function(e,t,n,i,o,r,a){o&&(o.checkLoadState()===s.COMPLETE_STATE||o.getData())&&(o.setShaderUniforms(e,n,i),a.enable(e,n)&&(n.enableTexCoordAttribute(e,this.texCoordBuffers,0,0),n.enableVertexAttribute(e,r,0,0)),o._transparent.getValue()?e.enable(e.BLEND):e.disable(e.BLEND),e.drawArrays(e.TRIANGLES,0,6),t.resetTextureUnits())}});const ns=ts;function is(e){ji.call(this,e),this.addType(s.X3DAppearanceChildNode)}is.prototype=Object.assign(Object.create(ji.prototype),{constructor:is});const os=is;function rs(e){os.call(this,e),this.addType(s.X3DTextureNode),this.addChildObjects("transparent",new Bn.SFBool),this._transparent.setAccessType(s.outputOnly)}rs.prototype=Object.assign(Object.create(os.prototype),{constructor:rs,setTransparent:function(e){e!==this._transparent.getValue()&&(this._transparent=e)},getTransparent:function(){return this._transparent.getValue()}});const ss=rs;function as(e){ss.call(this,e),this.addType(s.X3DSingleTextureNode)}as.prototype=Object.assign(Object.create(ss.prototype),{constructor:as,initialize:function(){ss.prototype.initialize.call(this),this._textureProperties.addInterest("set_textureProperties__",this,!0);const e=this.getBrowser().getContext();this.texture=e.createTexture(),this.set_textureProperties__(!1)},set_textureProperties__:function(e){this.texturePropertiesNode&&this.texturePropertiesNode.removeInterest("updateTextureParameters",this),this.texturePropertiesNode=xr(s.TextureProperties,this._textureProperties),this.texturePropertiesNode||(this.texturePropertiesNode=this.getBrowser().getDefaultTextureProperties()),this.texturePropertiesNode.addInterest("updateTextureParameters",this),e&&this.updateTextureParameters()},getCount:function(){return 1},getTexture:function(){return this.texture},updateTextureParameters:function(){const e=["EXT_texture_filter_anisotropic","MOZ_EXT_texture_filter_anisotropic","WEBKIT_EXT_texture_filter_anisotropic"];return function(t,n,i,o,r,s,a,u){const l=this.getBrowser().getContext();l.bindTexture(t,this.getTexture()),Math.max(o,r)<this.getBrowser().getMinTextureSize()&&!n?(l.texParameteri(t,l.TEXTURE_MIN_FILTER,l.NEAREST),l.texParameteri(t,l.TEXTURE_MAG_FILTER,l.NEAREST)):(i._generateMipMaps.getValue()&&l.generateMipmap(t),l.texParameteri(t,l.TEXTURE_MIN_FILTER,l[i.getMinificationFilter()]),l.texParameteri(t,l.TEXTURE_MAG_FILTER,l[i.getMagnificationFilter()])),n?(l.texParameteri(t,l.TEXTURE_WRAP_S,l[i.getBoundaryModeS()]),l.texParameteri(t,l.TEXTURE_WRAP_T,l[i.getBoundaryModeT()]),l.getVersion()>=2&&l.texParameteri(t,l.TEXTURE_WRAP_R,l[i.getBoundaryModeR()])):(l.texParameteri(t,l.TEXTURE_WRAP_S,s?l.REPEAT:l.CLAMP_TO_EDGE),l.texParameteri(t,l.TEXTURE_WRAP_T,a?l.REPEAT:l.CLAMP_TO_EDGE),l.getVersion()>=2&&l.texParameteri(t,l.TEXTURE_WRAP_R,u?l.REPEAT:l.CLAMP_TO_EDGE));for(const n of e){const e=l.getExtension(n);if(e){l.texParameterf(t,e.TEXTURE_MAX_ANISOTROPY_EXT,i._anisotropicDegree.getValue());break}}}}(),updateTextureBits:function(e,t=0){const n=this.getTextureType()-1;e.set(2*t+0,1&n),e.set(2*t+1,2&n)},getShaderOptions:function(){const e={2:"2D",3:"3D",4:"CUBE"};return function(t,n=0){t.push("X3D_TEXTURE"+n+"_"+e[this.getTextureType()])}}()});const us=as,ls=new Uint8Array([255,255,255,255]);function cs(e){us.call(this,e),this.addType(s.X3DTexture2DNode);const t=this.getBrowser().getContext();this.target=t.TEXTURE_2D,this.width=0,this.height=0,this.flipY=!1,this.data=null}cs.prototype=Object.assign(Object.create(us.prototype),{constructor:cs,initialize:function(){us.prototype.initialize.call(this),this._repeatS.addInterest("updateTextureParameters",this),this._repeatT.addInterest("updateTextureParameters",this);const e=this.getBrowser().getContext();e.bindTexture(e.TEXTURE_2D,this.getTexture()),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,1,1,0,e.RGBA,e.UNSIGNED_BYTE,ls)},getTarget:function(){return this.target},getTextureType:function(){return 2},getTextureTypeString:function(){return"2D"},getWidth:function(){return this.width},getHeight:function(){return this.height},getFlipY:function(){return this.flipY},getData:function(){return this.data},clearTexture:function(){this.setTexture(1,1,!1,ls,!1),this.data=null},setTexture:function(e,t,n,i,o){this.width=e,this.height=t,this.flipY=o,this.data=i;const r=this.getBrowser().getContext();r.pixelStorei(r.UNPACK_FLIP_Y_WEBGL,o),r.bindTexture(r.TEXTURE_2D,this.getTexture()),r.texImage2D(r.TEXTURE_2D,0,r.RGBA,e,t,0,r.RGBA,r.UNSIGNED_BYTE,i),r.pixelStorei(r.UNPACK_FLIP_Y_WEBGL,!1),this.setTransparent(n),this.updateTextureParameters(),this.addNodeEvent()},updateTexture:function(e,t){this.data=e;const n=this.getBrowser().getContext();n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,t),n.bindTexture(n.TEXTURE_2D,this.getTexture()),n.texSubImage2D(n.TEXTURE_2D,0,0,0,n.RGBA,n.UNSIGNED_BYTE,e),n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,!1),this.texturePropertiesNode._generateMipMaps.getValue()&&n.generateMipmap(n.TEXTURE_2D),this.addNodeEvent()},updateTextureParameters:function(){us.prototype.updateTextureParameters.call(this,this.target,this._textureProperties.getValue(),this.texturePropertiesNode,this.width,this.height,this._repeatS.getValue(),this._repeatT.getValue(),!1)},setShaderUniforms:function(e,t,n,i=t.x3d_Texture[0]){const o=this.getBrowser().getTexture2DUnit();e.activeTexture(e.TEXTURE0+o),e.bindTexture(e.TEXTURE_2D,this.getTexture()),e.uniform1i(i.texture2D,o)}});const hs=cs;var ds=i(755);function ps(e){hs.call(this,e),xo.call(this,e),this.addType(s.ImageTexture),this.image=ds("<img></img>"),this.canvas=ds("<canvas></canvas>"),this.urlStack=new Bn.MFString}ps.prototype=Object.assign(Object.create(hs.prototype),xo.prototype,{constructor:ps,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new P([new N(s.inputOutput,"metadata",new Bn.SFNode),new N(s.inputOutput,"description",new Bn.SFString),new N(s.inputOutput,"load",new Bn.SFBool(!0)),new N(s.inputOutput,"url",new Bn.MFString),new N(s.inputOutput,"autoRefresh",new Bn.SFTime),new N(s.inputOutput,"autoRefreshTimeLimit",new Bn.SFTime(3600)),new N(s.initializeOnly,"repeatS",new Bn.SFBool(!0)),new N(s.initializeOnly,"repeatT",new Bn.SFBool(!0)),new N(s.initializeOnly,"textureProperties",new Bn.SFNode)]),getTypeName:function(){return"ImageTexture"},getComponentName:function(){return"Texturing"},getContainerField:function(){return"texture"},initialize:function(){hs.prototype.initialize.call(this),xo.prototype.initialize.call(this),this.image.on("load",this.setImage.bind(this)),this.image.on("abort error",this.setError.bind(this)),this.image[0].crossOrigin="Anonymous",this.requestImmediateLoad()},unLoadNow:function(){this.clearTexture()},loadNow:function(){this.urlStack.setValue(this._url),this.loadNext()},loadNext:function(){if(0===this.urlStack.length)return this.clearTexture(),void this.setLoadState(s.FAILED_STATE);this.URL=new URL(this.urlStack.shift(),this.getExecutionContext().getWorldURL()),"data:"!==this.URL.protocol&&(this.getBrowser().getBrowserOptions().getCache()&&this.getCache()||this.URL.searchParams.set("_",Date.now())),this.image.attr("src",this.URL.href)},setError:function(e){"data:"!==this.URL.protocol&&console.warn("Error loading image:",decodeURI(this.URL.href),e.type),this.loadNext()},setImage:function(){"data:"!==this.URL.protocol&&console.info("Done loading image:",decodeURI(this.URL.href));try{const e=this.getBrowser().getContext(),t=this.image[0],n=this.canvas[0],i=n.getContext("2d",{willReadFrequently:!0});let o=t.width,r=t.height;e.getVersion()>=2||ee.isPowerOfTwo(o)&&ee.isPowerOfTwo(r)?(n.width=o,n.height=r,i.clearRect(0,0,o,r),i.save(),i.translate(0,r),i.scale(1,-1),i.drawImage(t,0,0),i.restore()):(o=ee.nextPowerOfTwo(o),r=ee.nextPowerOfTwo(r),n.width=o,n.height=r,i.clearRect(0,0,o,r),i.save(),i.translate(0,r),i.scale(1,-1),i.drawImage(t,0,0,t.width,t.height,0,0,o,r),i.restore());const a=i.getImageData(0,0,o,r).data;let u=!1;for(let e=3,t=a.length;e<t;e+=4)if(255!==a[e]){u=!0;break}this.setTexture(o,r,u,new Uint8Array(a.buffer),!1),this.setLoadState(s.COMPLETE_STATE)}catch(e){console.log(e.message),this.setError()}},dispose:function(){xo.prototype.dispose.call(this),hs.prototype.dispose.call(this)}});const fs=ps;function gs(e){ns.call(this,e),this.addType(s.Background)}gs.prototype=Object.assign(Object.create(ns.prototype),{constructor:gs,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new P([new N(s.inputOutput,"metadata",new Bn.SFNode),new N(s.inputOnly,"set_bind",new Bn.SFBool),new N(s.inputOutput,"frontUrl",new Bn.MFString),new N(s.inputOutput,"backUrl",new Bn.MFString),new N(s.inputOutput,"leftUrl",new Bn.MFString),new N(s.inputOutput,"rightUrl",new Bn.MFString),new N(s.inputOutput,"topUrl",new Bn.MFString),new N(s.inputOutput,"bottomUrl",new Bn.MFString),new N(s.inputOutput,"skyAngle",new Bn.MFFloat),new N(s.inputOutput,"skyColor",new Bn.MFColor(new Bn.SFColor)),new N(s.inputOutput,"groundAngle",new Bn.MFFloat),new N(s.inputOutput,"groundColor",new Bn.MFColor),new N(s.inputOutput,"transparency",new Bn.SFFloat),new N(s.outputOnly,"isBound",new Bn.SFBool),new N(s.outputOnly,"bindTime",new Bn.SFTime)]),getTypeName:function(){return"Background"},getComponentName:function(){return"EnvironmentalEffects"},getContainerField:function(){return"children"},initialize:function(){ns.prototype.initialize.call(this);const e=new fs(this.getExecutionContext()),t=new fs(this.getExecutionContext()),n=new fs(this.getExecutionContext()),i=new fs(this.getExecutionContext()),o=new fs(this.getExecutionContext()),r=new fs(this.getExecutionContext()),s=this.getBrowser().getBackgroundTextureProperties();this._frontUrl.addFieldInterest(e._url),this._backUrl.addFieldInterest(t._url),this._leftUrl.addFieldInterest(n._url),this._rightUrl.addFieldInterest(i._url),this._topUrl.addFieldInterest(o._url),this._bottomUrl.addFieldInterest(r._url),e._url=this._frontUrl,t._url=this._backUrl,n._url=this._leftUrl,i._url=this._rightUrl,o._url=this._topUrl,r._url=this._bottomUrl,e._textureProperties=s,t._textureProperties=s,n._textureProperties=s,i._textureProperties=s,o._textureProperties=s,r._textureProperties=s,e.setup(),t.setup(),n.setup(),i.setup(),o.setup(),r.setup(),this.set_frontTexture__(e),this.set_backTexture__(t),this.set_leftTexture__(n),this.set_rightTexture__(i),this.set_topTexture__(o),this.set_bottomTexture__(r)}});const ms=gs;var _s=new Nt;function ys(e,t,n){ji.call(this,e),mr.call(this,e),this.addType(s.X3DLayerNode),this.groupNode=n,this.currentViewport=null,this.defaultNavigationInfo=new Pr(e),this.defaultViewpoint=t,this.defaultBackground=new ms(e),this.defaultFog=new zr(e),this.navigationInfoStack=new Nr(e,this.defaultNavigationInfo),this.viewpointStack=new Nr(e,this.defaultViewpoint),this.backgroundStack=new Nr(e,this.defaultBackground),this.fogStack=new Nr(e,this.defaultFog),this.navigationInfos=new Mr(e,this.defaultNavigationInfo),this.viewpoints=new Mr(e,this.defaultViewpoint),this.backgrounds=new Mr(e,this.defaultBackground),this.fogs=new Mr(e,this.defaultFog),this.defaultBackground.setHidden(!0),this.defaultFog.setHidden(!0),this.collisionTime=0}ys.prototype=Object.assign(Object.create(ji.prototype),mr.prototype,{constructor:ys,layer0:!1,initialize:function(){ji.prototype.initialize.call(this),mr.prototype.initialize.call(this),this.defaultNavigationInfo.setup(),this.defaultViewpoint.setup(),this.defaultBackground.setup(),this.defaultFog.setup(),this.navigationInfoStack.setup(),this.viewpointStack.setup(),this.backgroundStack.setup(),this.fogStack.setup(),this.navigationInfos.setup(),this.viewpoints.setup(),this.backgrounds.setup(),this.fogs.setup(),this._viewport.addInterest("set_viewport__",this),this.set_viewport__()},isLayer0:function(e){this.layer0=e,this.defaultBackground.setHidden(!e)},getLayer:function(){return this},getGroup:function(){return this.groupNode},getViewport:function(){return this.currentViewport},getBackground:function(){return this.backgroundStack.top()},getFog:function(){return this.fogStack.top()},getNavigationInfo:function(){return this.navigationInfoStack.top()},getViewpoint:function(){return this.viewpointStack.top()},getBackgrounds:function(){return this.backgrounds},getFogs:function(){return this.fogs},getNavigationInfos:function(){return this.navigationInfos},getViewpoints:function(){return this.viewpoints},getUserViewpoints:function(){for(var e=[],t=0;t<this.viewpoints.get().length;++t){var n=this.viewpoints.get()[t];n._description.length&&e.push(n)}return e},getBackgroundStack:function(){return this.backgroundStack},getFogStack:function(){return this.fogStack},getNavigationInfoStack:function(){return this.navigationInfoStack},getViewpointStack:function(){return this.viewpointStack},getBBox:function(e,t){return this.groupNode.getBBox(e,t)},lookAt:function(e,t){this.getViewpoint().lookAtBBox(this.getBBox(new hr),e,t)},set_viewport__:function(){this.currentViewport=xr(s.X3DViewportNode,this._viewport),this.currentViewport||(this.currentViewport=this.getBrowser().getDefaultViewport())},bindBindables:function(e){this.traverse(sr.CAMERA,this);const t=this.navigationInfos.getBound(),n=this.backgrounds.getBound(),i=this.fogs.getBound(),o=this.viewpoints.getBound(e);this.navigationInfoStack.pushOnTop(t),this.viewpointStack.pushOnTop(o),this.backgroundStack.pushOnTop(n),this.fogStack.pushOnTop(i),o.resetUserOffsets()},traverse:function(e,t){t=t||this;var n=this.getViewpoint();switch(this.getProjectionMatrix().pushMatrix(n.getProjectionMatrix(this)),this.getCameraSpaceMatrix().pushMatrix(n.getCameraSpaceMatrix()),this.getViewMatrix().pushMatrix(n.getViewMatrix()),e){case sr.POINTER:this.pointer(e,t);break;case sr.CAMERA:this.camera(e,t);break;case sr.PICKING:this.picking(e,t);break;case sr.COLLISION:this.collision(e,t);break;case sr.SHADOW:case sr.DISPLAY:this.display(e,t)}this.getViewMatrix().pop(),this.getCameraSpaceMatrix().pop(),this.getProjectionMatrix().pop()},pointer:function(e,t){if(this._isPickable.getValue()){var n=this.getBrowser(),i=this.currentViewport.getRectangle(n);if(n.getSelectedLayer()){if(n.getSelectedLayer()!==this)return}else if(!n.isPointerInRectangle(i))return;n.setHitRay(this.getProjectionMatrix().get(),i),this.getModelViewMatrix().pushMatrix(this.getViewMatrix().get()),this.currentViewport.push(this),this.groupNode.traverse(e,t),this.currentViewport.pop(this),this.getModelViewMatrix().pop()}},camera:function(e,t){this.getModelViewMatrix().pushMatrix(Nt.Identity),this.currentViewport.push(this),this.groupNode.traverse(e,t),this.currentViewport.pop(this),this.getModelViewMatrix().pop(),this.navigationInfos.update(this,this.navigationInfoStack),this.viewpoints.update(this,this.viewpointStack),this.backgrounds.update(this,this.backgroundStack),this.fogs.update(this,this.fogStack),this.getViewpoint().update()},picking:function(e,t){this.getModelViewMatrix().pushMatrix(Nt.Identity),this.currentViewport.push(this),this.groupNode.traverse(e,t),this.currentViewport.pop(this),this.getModelViewMatrix().pop()},collision:function(e,t){var n=this.getNavigationInfo();if(!n._transitionActive.getValue()){var i=n.getCollisionRadius(),o=n.getAvatarHeight(),r=Math.max(2*i,2*o);this.collisionTime=0,lr.ortho(-r,r,-r,r,-r,r,_s),this.getProjectionMatrix().pushMatrix(_s),this.getModelViewMatrix().pushMatrix(this.getViewMatrix().get()),this.currentViewport.push(this),t.render(e,this.groupNode.traverse,this.groupNode),this.currentViewport.pop(this),this.getModelViewMatrix().pop(),this.getProjectionMatrix().pop()}},display:function(e,t){this.getNavigationInfo().enable(e,t),this.getModelViewMatrix().pushMatrix(this.getViewMatrix().get()),this.currentViewport.push(this),t.render(e,this.groupNode.traverse,this.groupNode),this.currentViewport.pop(this),this.getModelViewMatrix().pop()}});const xs=ys;function ws(e){yr.call(this,e),this.addType(s.X3DSensorNode)}ws.prototype=Object.assign(Object.create(yr.prototype),{constructor:ws});const vs=ws;function bs(e){this.addType(s.X3DTimeDependentNode),this.addChildObjects("initialized",new Bn.SFTime,"isEvenLive",new Bn.SFBool),this.startTimeValue=0,this.pauseTimeValue=0,this.resumeTimeValue=0,this.stopTimeValue=0,this.start=0,this.pause=0,this.pauseInterval=0,this.startTimeout=null,this.pauseTimeout=null,this.resumeTimeout=null,this.stopTimeout=null,this.disabled=!1}bs.prototype=Object.assign(Object.create(yr.prototype),{constructor:bs,initialize:function(){this.isLive().addInterest("set_live__",this),this._isEvenLive.addInterest("set_live__",this),this._initialized.addInterest("set_loop__",this),this._enabled.addInterest("set_enabled__",this),this._loop.addInterest("set_loop__",this),this._startTime.addInterest("set_startTime__",this),this._pauseTime.addInterest("set_pauseTime__",this),this._resumeTime.addInterest("set_resumeTime__",this),this._stopTime.addInterest("set_stopTime__",this),this.startTimeValue=this._startTime.getValue(),this.pauseTimeValue=this._pauseTime.getValue(),this.resumeTimeValue=this._resumeTime.getValue(),this.stopTimeValue=this._stopTime.getValue(),this._initialized=this.getBrowser().getCurrentTime()},getDisabled:function(){return this.disabled},getLiveState:function(){return this.getLive()&&(this.getExecutionContext().isLive().getValue()||this._isEvenLive.getValue())},getElapsedTime:function(){return this.getBrowser().getCurrentTime()-this.start-this.pauseInterval},resetElapsedTime:function(){this.start=this.getBrowser().getCurrentTime(),this.pause=this.getBrowser().getCurrentTime(),this.pauseInterval=0},set_live__:function(){this.isLive().getValue()||this._isEvenLive.getValue()?this.disabled&&(this.disabled=!1,this._isActive.getValue()&&!this._isPaused.getValue()&&this.real_resume()):this.disabled||!this._isActive.getValue()||this._isPaused.getValue()||(this.disabled=!0,this.real_pause())},set_enabled__:function(){this._enabled.getValue()?this.set_loop__():this.stop()},set_loop__:function(){this._enabled.getValue()&&this._loop.getValue()&&this.stopTimeValue<=this.startTimeValue&&this.startTimeValue<=this.getBrowser().getCurrentTime()&&this.do_start()},set_startTime__:function(){this.startTimeValue=this._startTime.getValue(),this._enabled.getValue()&&(this.removeTimeout("startTimeout"),this.startTimeValue<=this.getBrowser().getCurrentTime()?this.do_start():this.addTimeout("startTimeout","do_start",this.startTimeValue))},set_pauseTime__:function(){if(this.pauseTimeValue=this._pauseTime.getValue(),this._enabled.getValue()){if(this.removeTimeout("pauseTimeout"),this.pauseTimeValue<=this.resumeTimeValue)return;this.pauseTimeValue<=this.getBrowser().getCurrentTime()?this.do_pause():this.addTimeout("pauseTimeout","do_pause",this.pauseTimeValue)}},set_resumeTime__:function(){if(this.resumeTimeValue=this._resumeTime.getValue(),this._enabled.getValue()){if(this.removeTimeout("resumeTimeout"),this.resumeTimeValue<=this.pauseTimeValue)return;this.resumeTimeValue<=this.getBrowser().getCurrentTime()?this.do_resume():this.addTimeout("resumeTimeout","do_resume",this.resumeTimeValue)}},set_stopTime__:function(){if(this.stopTimeValue=this._stopTime.getValue(),this._enabled.getValue()){if(this.removeTimeout("stopTimeout"),this.stopTimeValue<=this.startTimeValue)return;this.stopTimeValue<=this.getBrowser().getCurrentTime()?this.do_stop():this.addTimeout("stopTimeout","do_stop",this.stopTimeValue)}},do_start:function(){this._isActive.getValue()||(this.resetElapsedTime(),this._isActive=!0,this.set_start(),this.isLive().getValue()?this.getBrowser().timeEvents().addInterest("set_time",this):(this.disabled=!0,this.real_pause()),this._elapsedTime=0)},do_pause:function(){this._isActive.getValue()&&!this._isPaused.getValue()&&(this._isPaused=!0,this.pauseTimeValue!==this.getBrowser().getCurrentTime()&&(this.pauseTimeValue=this.getBrowser().getCurrentTime()),this.isLive().getValue()&&this.real_pause())},real_pause:function(){this.pause=Date.now(),this.set_pause(),this.getBrowser().timeEvents().removeInterest("set_time",this)},do_resume:function(){this._isActive.getValue()&&this._isPaused.getValue()&&(this._isPaused=!1,this.resumeTimeValue!==this.getBrowser().getCurrentTime()&&(this.resumeTimeValue=this.getBrowser().getCurrentTime()),this.isLive().getValue()&&this.real_resume())},real_resume:function(){const e=(Date.now()-this.pause)/1e3;this.pauseInterval+=e,this.set_resume(e),this.getBrowser().timeEvents().addInterest("set_time",this),this.getBrowser().addBrowserEvent()},do_stop:function(){this.stop()},stop:function(){this._isActive.getValue()&&(this.set_stop(),this._elapsedTime=this.getElapsedTime(),this._isPaused.getValue()&&(this._isPaused=!1),this._isActive=!1,this.getBrowser().timeEvents().removeInterest("set_time",this))},timeout:function(e){this._enabled.getValue()&&(this.getBrowser().advanceTime(),this[e]())},addTimeout:function(e,t,n){this.removeTimeout(e),this[e]=setTimeout(this.timeout.bind(this,t),1e3*(n-this.getBrowser().getCurrentTime()))},removeTimeout:function(e){clearTimeout(this[e]),this[e]=null},set_start:function(){},set_pause:function(){},set_resume:function(){},set_stop:function(){},set_time:function(){}});const Ss=bs;function Ts(e){vs.call(this,e),Ss.call(this,e),this.addType(s.TimeSensor),this.addChildObjects("range",new Bn.MFFloat(0,0,1)),this.cycle=0,this.interval=0,this.fraction=0,this.first=0,this.last=1,this.scale=1}Ts.prototype=Object.assign(Object.create(vs.prototype),Ss.prototype,{constructor:Ts,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new P([new N(s.inputOutput,"metadata",new Bn.SFNode),new N(s.inputOutput,"enabled",new Bn.SFBool(!0)),new N(s.inputOutput,"cycleInterval",new Bn.SFTime(1)),new N(s.inputOutput,"loop",new Bn.SFBool),new N(s.inputOutput,"startTime",new Bn.SFTime),new N(s.inputOutput,"resumeTime",new Bn.SFTime),new N(s.inputOutput,"pauseTime",new Bn.SFTime),new N(s.inputOutput,"stopTime",new Bn.SFTime),new N(s.outputOnly,"isPaused",new Bn.SFBool),new N(s.outputOnly,"isActive",new Bn.SFBool),new N(s.outputOnly,"cycleTime",new Bn.SFTime),new N(s.outputOnly,"elapsedTime",new Bn.SFTime),new N(s.outputOnly,"fraction_changed",new Bn.SFFloat),new N(s.outputOnly,"time",new Bn.SFTime)]),getTypeName:function(){return"TimeSensor"},getComponentName:function(){return"Time"},getContainerField:function(){return"children"},initialize:function(){vs.prototype.initialize.call(this),Ss.prototype.initialize.call(this),this._cycleInterval.addInterest("set_cycleInterval__",this),this._range.addInterest("set_range__",this)},setRange:function(e,t,n){const i=this.getBrowser().getCurrentTime(),o=this._startTime.getValue(),r=this._cycleInterval.getValue();this.first=t,this.last=n,this.scale=this.last-this.first,this.interval=r*this.scale,this.fraction=ee.fract((e>=1?0:e)+(this.interval?(i-o)/this.interval:0)),this.cycle=i-(this.fraction-this.first)*r},set_cycleInterval__:function(){this._isActive.getValue()&&this.setRange(this.fraction,this._range[1],this._range[2])},set_range__:function(){this._isActive.getValue()&&(this.setRange(this._range[0],this._range[1],this._range[2]),this._isPaused.getValue()||this.set_fraction(this.getBrowser().getCurrentTime()))},set_start:function(){this.setRange(this._range[0],this._range[1],this._range[2]),this.isLive().getValue()&&(this._fraction_changed=this.fraction,this._time=this.getBrowser().getCurrentTime())},set_resume:function(e){const t=this.getBrowser().getCurrentTime(),n=this._startTime.getValue();this.setRange(this.interval?ee.fract(this.fraction-(t-n)/this.interval):0,this._range[1],this._range[2])},set_fraction:function(e){this._fraction_changed=this.fraction=this.first+(this.interval?ee.fract((e-this.cycle)/this.interval):0)*this.scale},set_time:function(){const e=this.getBrowser().getCurrentTime();e-this.cycle>=this.interval?this._loop.getValue()?this.interval&&(this.cycle+=this.interval*Math.floor((e-this.cycle)/this.interval),this._elapsedTime=this.getElapsedTime(),this._cycleTime=e,this.set_fraction(e)):(this._fraction_changed=this.fraction=this.last,this.stop()):(this._elapsedTime=this.getElapsedTime(),this.set_fraction(e)),this._time=e}});const Es=Ts;function Cs(e){yr.call(this,e),this.addType(s.X3DInterpolatorNode)}Cs.prototype=Object.assign(Object.create(yr.prototype),{constructor:Cs,setup:function(){this.set_key__(),this._key.length&&this.interpolate(0,0,0),yr.prototype.setup.call(this)},initialize:function(){yr.prototype.initialize.call(this),this._set_fraction.addInterest("set_fraction__",this),this._key.addInterest("set_key__",this)},set_fraction__:function(){const e=this._key,t=e.length,n=this._set_fraction.getValue();switch(t){case 0:return;case 1:return this.interpolate(0,0,0);default:{if(n<=e[0])return this.interpolate(0,1,0);const i=ee.upperBound(e,0,t,n);if(i!==t){const t=i-1,o=(n-e[t])/(e[i]-e[t]);this.interpolate(t,i,ee.clamp(o,0,1))}else this.interpolate(t-2,t-1,1)}}},set_key__:function(){this.set_keyValue__()},set_keyValue__:function(){},interpolate:function(){}});const Os=Cs;function Ns(e){Os.call(this,e),this.addType(s.EaseInEaseOut)}Ns.prototype=Object.assign(Object.create(Os.prototype),{constructor:Ns,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new P([new N(s.inputOutput,"metadata",new Bn.SFNode),new N(s.inputOnly,"set_fraction",new Bn.SFFloat),new N(s.inputOutput,"key",new Bn.MFFloat),new N(s.inputOutput,"easeInEaseOut",new Bn.MFVec2f),new N(s.outputOnly,"modifiedFraction_changed",new Bn.SFFloat)]),getTypeName:function(){return"EaseInEaseOut"},getComponentName:function(){return"Interpolation"},getContainerField:function(){return"children"},initialize:function(){Os.prototype.initialize.call(this),this._easeInEaseOut.addInterest("set_keyValue__",this)},set_keyValue__:function(){this._easeInEaseOut.length<this._key.length&&this._easeInEaseOut.resize(this._key.length,this._easeInEaseOut.length?this._easeInEaseOut[this._easeInEaseOut.length-1]:new Bn.SFVec2f)},interpolate:function(e,t,n){let i=this._easeInEaseOut[e].y,o=this._easeInEaseOut[t].x;const r=i+o;if(r<0)this._modifiedFraction_changed=n;else{r>1&&(o/=r,i/=r);const e=1/(2-i-o);if(n<i)this._modifiedFraction_changed=e/i*n*n;else if(n<=1-o)this._modifiedFraction_changed=e*(2*n-i);else{const t=1-n;this._modifiedFraction_changed=1-e*t*t/o}}}});const Fs=Ns;function Ms(e){Os.call(this,e),this.addType(s.PositionInterpolator)}Ms.prototype=Object.assign(Object.create(Os.prototype),{constructor:Ms,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new P([new N(s.inputOutput,"metadata",new Bn.SFNode),new N(s.inputOnly,"set_fraction",new Bn.SFFloat),new N(s.inputOutput,"key",new Bn.MFFloat),new N(s.inputOutput,"keyValue",new Bn.MFVec3f),new N(s.outputOnly,"value_changed",new Bn.SFVec3f)]),getTypeName:function(){return"PositionInterpolator"},getComponentName:function(){return"Interpolation"},getContainerField:function(){return"children"},initialize:function(){Os.prototype.initialize.call(this),this._keyValue.addInterest("set_keyValue__",this)},set_keyValue__:function(){const e=this._key,t=this._keyValue;t.length<e.length&&t.resize(e.length,t.length?t[t.length-1]:new Bn.SFVec3f)},interpolate:function(){const e=new He(0,0,0);return function(t,n,i){this._value_changed=e.assign(this._keyValue[t].getValue()).lerp(this._keyValue[n].getValue(),i)}}()});const Ds=Ms;function Is(e){Os.call(this,e),this.addType(s.OrientationInterpolator),this._keyValue.setUnit("angle"),this._value_changed.setUnit("angle")}Is.prototype=Object.assign(Object.create(Os.prototype),{constructor:Is,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new P([new N(s.inputOutput,"metadata",new Bn.SFNode),new N(s.inputOnly,"set_fraction",new Bn.SFFloat),new N(s.inputOutput,"key",new Bn.MFFloat),new N(s.inputOutput,"keyValue",new Bn.MFRotation),new N(s.outputOnly,"value_changed",new Bn.SFRotation)]),getTypeName:function(){return"OrientationInterpolator"},getComponentName:function(){return"Interpolation"},getContainerField:function(){return"children"},initialize:function(){Os.prototype.initialize.call(this),this._keyValue.addInterest("set_keyValue__",this)},set_keyValue__:function(){const e=this._key,t=this._keyValue;t.length<e.length&&t.resize(e.length,t.length?t[t.length-1]:new Bn.SFRotation)},interpolate:function(){const e=new Et(0,0,1,0),t=new Et(0,0,1,0);return function(n,i,o){e.assign(this._keyValue[n].getValue()),t.assign(this._keyValue[i].getValue()),this._value_changed=e.slerp(t,o)}}()});const Rs=Is;function Vs(e){Ir.call(this,e),this.addType(s.X3DViewpointNode),this.addChildObjects("positionOffset",new Bn.SFVec3f,"orientationOffset",new Bn.SFRotation,"scaleOffset",new Bn.SFVec3f(1,1,1),"scaleOrientationOffset",new Bn.SFRotation,"centerOfRotationOffset",new Bn.SFVec3f,"fieldOfViewScale",new Bn.SFFloat(1)),this.userPosition=new He(0,1,0),this.userOrientation=new Et(0,0,1,0),this.userCenterOfRotation=new He(0,0,0),this.modelMatrix=new Nt,this.cameraSpaceMatrix=new Nt(1,0,0,0,0,1,0,0,0,0,1,0,0,0,10,1),this.viewMatrix=new Nt(1,0,0,0,0,1,0,0,0,0,1,0,0,0,-10,1);const t=this.getBrowser();this.timeSensor=new Es(t.getPrivateScene()),this.easeInEaseOut=new Fs(t.getPrivateScene()),this.positionInterpolator=new Ds(t.getPrivateScene()),this.orientationInterpolator=new Rs(t.getPrivateScene()),this.scaleInterpolator=new Ds(t.getPrivateScene()),this.scaleOrientationInterpolator=new Rs(t.getPrivateScene())}Vs.prototype=Object.assign(Object.create(Ir.prototype),{constructor:Vs,initialize:function(){Ir.prototype.initialize.call(this),this.timeSensor._stopTime=1,this.timeSensor.setup(),this.easeInEaseOut._key=new Bn.MFFloat(0,1),this.easeInEaseOut._easeInEaseOut=new Bn.MFVec2f(new Bn.SFVec2f(0,0),new Bn.SFVec2f(0,0)),this.easeInEaseOut.setup(),this.positionInterpolator._key=new Bn.MFFloat(0,1),this.orientationInterpolator._key=new Bn.MFFloat(0,1),this.scaleInterpolator._key=new Bn.MFFloat(0,1),this.scaleOrientationInterpolator._key=new Bn.MFFloat(0,1),this.positionInterpolator.setup(),this.orientationInterpolator.setup(),this.scaleInterpolator.setup(),this.scaleOrientationInterpolator.setup(),this.timeSensor._isActive.addFieldInterest(this._transitionActive),this.timeSensor._fraction_changed.addFieldInterest(this.easeInEaseOut._set_fraction),this.easeInEaseOut._modifiedFraction_changed.addFieldInterest(this.positionInterpolator._set_fraction),this.easeInEaseOut._modifiedFraction_changed.addFieldInterest(this.orientationInterpolator._set_fraction),this.easeInEaseOut._modifiedFraction_changed.addFieldInterest(this.scaleInterpolator._set_fraction),this.easeInEaseOut._modifiedFraction_changed.addFieldInterest(this.scaleOrientationInterpolator._set_fraction),this.positionInterpolator._value_changed.addFieldInterest(this._positionOffset),this.orientationInterpolator._value_changed.addFieldInterest(this._orientationOffset),this.scaleInterpolator._value_changed.addFieldInterest(this._scaleOffset),this.scaleOrientationInterpolator._value_changed.addFieldInterest(this._scaleOrientationOffset),this._isBound.addInterest("set_bound__",this)},getEaseInEaseOut:function(){return this.easeInEaseOut},setInterpolators:function(){},getPosition:function(){return this._position.getValue()},getUserPosition:function(){return this.userPosition.assign(this.getPosition()).add(this._positionOffset.getValue())},getOrientation:function(){return this._orientation.getValue()},getUserOrientation:function(){return this.userOrientation.assign(this.getOrientation()).multRight(this._orientationOffset.getValue())},getCenterOfRotation:function(){return this._centerOfRotation.getValue()},getUserCenterOfRotation:function(){return this.userCenterOfRotation.assign(this.getCenterOfRotation()).add(this._centerOfRotationOffset.getValue())},getProjectionMatrix:function(e){const t=e.getNavigationInfo();return this.getProjectionMatrixWithLimits(t.getNearValue(),t.getFarValue(this),e.getLayer().getViewport().getRectangle(this.getBrowser()))},getCameraSpaceMatrix:function(){return this.cameraSpaceMatrix},getViewMatrix:function(){return this.viewMatrix},getModelMatrix:function(){return this.modelMatrix},getMaxFarValue:function(){return this.getBrowser().getRenderingProperty("LogarithmicDepthBuffer")?1e10:1e5},getUpVector:function(){return He.yAxis},getSpeedFactor:function(){return 1},setVRMLTransition:function(e){this.VRMLTransition=e},getVRMLTransition:function(){return this.VRMLTransition},transitionStart:function(){const e=new He(0,0,0),t=new Et(0,0,1,0),n=new He(0,0,0),i=new Et(0,0,1,0);return function(o,r,s){if(this.to=s,s._jump.getValue()){if(s._retainUserOffsets.getValue()||s.resetUserOffsets(),this!==s)for(const e of s.getFields())this.getField(e.getName()).assign(e);const a=o.getNavigationInfo(),u=a._transitionTime.getValue();let l=a.getTransitionType();switch("2.0"==this.getExecutionContext().getSpecificationVersion()&&(l=s.getVRMLTransition()?"LINEAR":"TELEPORT"),s.setVRMLTransition(!1),u<=0&&(l="TELEPORT"),l){case"TELEPORT":return void(a._transitionComplete=!0);case"ANIMATE":this.easeInEaseOut._easeInEaseOut=new Bn.MFVec2f(new Bn.SFVec2f(0,1),new Bn.SFVec2f(1,0));break;default:this.easeInEaseOut._easeInEaseOut=new Bn.MFVec2f(new Bn.SFVec2f(0,0),new Bn.SFVec2f(0,0))}this.timeSensor._cycleInterval=u,this.timeSensor._stopTime=this.getBrowser().getCurrentTime(),this.timeSensor._startTime=this.getBrowser().getCurrentTime(),this.timeSensor._isActive.addInterest("set_active__",this,a),s.getRelativeTransformation(r,e,t,n,i),this.positionInterpolator._keyValue=new Bn.MFVec3f(e,s._positionOffset),this.orientationInterpolator._keyValue=new Bn.MFRotation(t,s._orientationOffset),this.scaleInterpolator._keyValue=new Bn.MFVec3f(n,s._scaleOffset),this.scaleOrientationInterpolator._keyValue=new Bn.MFRotation(i,s._scaleOrientationOffset),this._positionOffset=e,this._orientationOffset=t,this._scaleOffset=n,this._scaleOrientationOffset=i,this.setInterpolators(r,s),this._transitionActive=!0}else s.getRelativeTransformation(r,e,t,n,i),s._positionOffset=e,s._orientationOffset=t,s._scaleOffset=n,s._scaleOrientationOffset=i,s.setInterpolators(r,s)}}(),transitionStop:function(){this.timeSensor._stopTime=this.getBrowser().getCurrentTime(),this.timeSensor._isActive.removeInterest("set_active__",this)},resetUserOffsets:function(){this._positionOffset=He.Zero,this._orientationOffset=Et.Identity,this._scaleOffset=He.One,this._scaleOrientationOffset=Et.Identity,this._centerOfRotationOffset=He.Zero,this._fieldOfViewScale=1},getRelativeTransformation:function(e,t,n,i,o){this.modelMatrix.copy().multRight(e.getViewMatrix()).inverse().get(t,n,i,o),t.subtract(this.getPosition()),n.assign(this.getOrientation().copy().inverse().multRight(n))},lookAtPoint:function(e,t,n,i){this.getCameraSpaceMatrix().multVecMatrix(t),Nt.inverse(this.getModelMatrix()).multVecMatrix(t);const o=2*e.getNavigationInfo().getNearValue();this.lookAt(e,t,o,n,i)},lookAtBBox:function(e,t,n,i){t=t.copy().multRight(Nt.inverse(this.getModelMatrix()));const o=2*e.getNavigationInfo().getNearValue();this.lookAt(e,t.center,o,n,i)},lookAt:function(e,t,n,i,o){const r=t.copy().add(this.getUserOrientation().multVecRot(new He(0,0,n))).subtract(this.getPosition());e.getNavigationInfo()._transitionStart=!0,this.timeSensor._cycleInterval=.2,this.timeSensor._stopTime=this.getBrowser().getCurrentTime(),this.timeSensor._startTime=this.getBrowser().getCurrentTime(),this.timeSensor._isActive.addInterest("set_active__",this,e.getNavigationInfo()),this.easeInEaseOut._easeInEaseOut=new Bn.MFVec2f(new Bn.SFVec2f(0,1),new Bn.SFVec2f(1,0));const s=He.lerp(this._positionOffset.getValue(),r,i),a=He.add(this.getPosition(),s).subtract(t);let u=Et.multRight(this._orientationOffset.getValue(),new Et(this.getUserOrientation().multVecRot(new He(0,0,1)),a));o&&(u=Et.inverse(this.getOrientation()).multRight(this.straightenHorizon(Et.multRight(this.getOrientation(),u)))),this.positionInterpolator._keyValue=new Bn.MFVec3f(this._positionOffset,s),this.orientationInterpolator._keyValue=new Bn.MFRotation(this._orientationOffset,u),this.scaleInterpolator._keyValue=new Bn.MFVec3f(this._scaleOffset,this._scaleOffset),this.scaleOrientationInterpolator._keyValue=new Bn.MFRotation(this._scaleOrientationOffset,this._scaleOrientationOffset),this.setInterpolators(this,this),this._centerOfRotationOffset=He.subtract(t,this.getCenterOfRotation()),this._set_bind=!0},straighten:function(e,t){e.getNavigationInfo()._transitionStart=!0,this.timeSensor._cycleInterval=.4,this.timeSensor._stopTime=this.getBrowser().getCurrentTime(),this.timeSensor._startTime=this.getBrowser().getCurrentTime(),this.timeSensor._isActive.addInterest("set_active__",this,e.getNavigationInfo()),this.easeInEaseOut._easeInEaseOut=new Bn.MFVec2f(new Bn.SFVec2f(0,1),new Bn.SFVec2f(1,0));const n=Et.multRight(Et.inverse(this.getOrientation()),this.straightenHorizon(this.getUserOrientation()));this.positionInterpolator._keyValue=new Bn.MFVec3f(this._positionOffset,this._positionOffset),this.orientationInterpolator._keyValue=new Bn.MFRotation(this._orientationOffset,n),this.scaleInterpolator._keyValue=new Bn.MFVec3f(this._scaleOffset,this._scaleOffset),this.scaleOrientationInterpolator._keyValue=new Bn.MFRotation(this._scaleOrientationOffset,this._scaleOrientationOffset),this.setInterpolators(this,this),this._set_bind=!0},straightenHorizon:function(){const e=new He(0,0,0),t=new He(0,0,0),n=new Et(0,0,1,0);return function(i,o=this.getUpVector()){i.multVecRot(e.assign(He.xAxis).negate()),i.multVecRot(t.assign(He.zAxis));const r=t.cross(o);return Math.abs(t.dot(o))>=1||Math.abs(r.dot(e))>=1?i:(n.setFromToVec(e,r),i.multRight(n))}}(),set_active__:function(e,t){this._isBound.getValue()&&!t.getValue()&&1===this.timeSensor._fraction_changed.getValue()&&(e._transitionComplete=!0)},set_bound__:function(){this._isBound.getValue()?this.getBrowser().getNotification()._string=this._description:this.timeSensor._stopTime=this.getBrowser().getCurrentTime()},traverse:function(e,t){e===sr.CAMERA&&(t.getLayer().getViewpoints().push(this),this.modelMatrix.assign(t.getModelViewMatrix().get()))},update:function(){this.cameraSpaceMatrix.set(this.getUserPosition(),this.getUserOrientation(),this._scaleOffset.getValue(),this._scaleOrientationOffset.getValue()),this.cameraSpaceMatrix.multRight((this.to||this).modelMatrix),this.viewMatrix.assign(this.cameraSpaceMatrix).inverse()}});const Ps=Vs;function As(e){Os.call(this,e),this.addType(s.ScalarInterpolator)}As.prototype=Object.assign(Object.create(Os.prototype),{constructor:As,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new P([new N(s.inputOutput,"metadata",new Bn.SFNode),new N(s.inputOnly,"set_fraction",new Bn.SFFloat),new N(s.inputOutput,"key",new Bn.MFFloat),new N(s.inputOutput,"keyValue",new Bn.MFFloat),new N(s.outputOnly,"value_changed",new Bn.SFFloat)]),getTypeName:function(){return"ScalarInterpolator"},getComponentName:function(){return"Interpolation"},getContainerField:function(){return"children"},initialize:function(){Os.prototype.initialize.call(this),this._keyValue.addInterest("set_keyValue__",this)},set_keyValue__:function(){const e=this._key,t=this._keyValue;t.length<e.length&&t.resize(e.length,t.length?t[t.length-1]:0)},interpolate:function(e,t,n){this._value_changed=ee.lerp(this._keyValue[e],this._keyValue[t],n)}});const Ls=As;function Us(e){Ps.call(this,e),this.addType(s.Viewpoint),this._position.setUnit("length"),this._centerOfRotation.setUnit("length"),this._fieldOfView.setUnit("angle"),this.projectionMatrix=new Nt,this.fieldOfViewInterpolator=new Ls(this.getBrowser().getPrivateScene())}Us.prototype=Object.assign(Object.create(Ps.prototype),{constructor:Us,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new P([new N(s.inputOutput,"metadata",new Bn.SFNode),new N(s.inputOnly,"set_bind",new Bn.SFBool),new N(s.inputOutput,"description",new Bn.SFString),new N(s.inputOutput,"position",new Bn.SFVec3f(0,0,10)),new N(s.inputOutput,"orientation",new Bn.SFRotation),new N(s.inputOutput,"centerOfRotation",new Bn.SFVec3f),new N(s.inputOutput,"fieldOfView",new Bn.SFFloat(.7854)),new N(s.inputOutput,"jump",new Bn.SFBool(!0)),new N(s.inputOutput,"retainUserOffsets",new Bn.SFBool),new N(s.outputOnly,"isBound",new Bn.SFBool),new N(s.outputOnly,"bindTime",new Bn.SFTime)]),getTypeName:function(){return"Viewpoint"},getComponentName:function(){return"Navigation"},getContainerField:function(){return"children"},initialize:function(){Ps.prototype.initialize.call(this),this.fieldOfViewInterpolator._key=new Bn.MFFloat(0,1),this.fieldOfViewInterpolator.setup(),this.getEaseInEaseOut()._modifiedFraction_changed.addFieldInterest(this.fieldOfViewInterpolator._set_fraction),this.fieldOfViewInterpolator._value_changed.addFieldInterest(this._fieldOfViewScale)},setInterpolators:function(e,t){if(e.getType().includes(s.Viewpoint)||e.getType().includes(s.GeoViewpoint)){const n=e.getFieldOfView()/t.getFieldOfView();this.fieldOfViewInterpolator._keyValue=new Bn.MFFloat(n,t._fieldOfViewScale.getValue()),this._fieldOfViewScale=n}else this.fieldOfViewInterpolator._keyValue=new Bn.MFFloat(t._fieldOfViewScale.getValue(),t._fieldOfViewScale.getValue()),this._fieldOfViewScale=t._fieldOfViewScale.getValue()},getLogarithmicDepthBuffer:function(){return!1},getFieldOfView:function(){const e=this._fieldOfView.getValue()*this._fieldOfViewScale.getValue();return e>0&&e<Math.PI?e:Math.PI/4},getScreenScale:function(e,t,n){const i=t[2],o=t[3];let r=Math.abs(e.z)*Math.tan(this.getFieldOfView()/2)*2;return r/=i>o?o:i,n.set(r,r,r)},getViewportSize:function(){const e=new ke(0,0);return function(t,n){const i=t[2],o=t[3],r=n*Math.tan(this.getFieldOfView()/2)*2,s=i/o;return s>1?e.set(r*s,r):e.set(r,r/s)}}(),getLookAtDistance:function(e){return e.size.magnitude()/2/Math.tan(this.getFieldOfView()/2)},getProjectionMatrixWithLimits:function(e,t,n){return lr.perspective(this.getFieldOfView(),e,t,n[2],n[3],this.projectionMatrix)}});const Bs=Us;function Xs(e){Tr.call(this,e),this.addType(s.Group)}Xs.prototype=Object.assign(Object.create(Tr.prototype),{constructor:Xs,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new P([new N(s.inputOutput,"metadata",new Bn.SFNode),new N(s.inputOutput,"visible",new Bn.SFBool(!0)),new N(s.inputOutput,"bboxDisplay",new Bn.SFBool),new N(s.initializeOnly,"bboxSize",new Bn.SFVec3f(-1,-1,-1)),new N(s.initializeOnly,"bboxCenter",new Bn.SFVec3f),new N(s.inputOnly,"addChildren",new Bn.MFNode),new N(s.inputOnly,"removeChildren",new Bn.MFNode),new N(s.inputOutput,"children",new Bn.MFNode)]),getTypeName:function(){return"Group"},getComponentName:function(){return"Grouping"},getContainerField:function(){return"children"}});const ks=Xs;function zs(e){xs.call(this,e,new Bs(e),new ks(e)),this.addType(s.Layer)}zs.prototype=Object.assign(Object.create(xs.prototype),{constructor:zs,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new P([new N(s.inputOutput,"metadata",new Bn.SFNode),new N(s.inputOutput,"isPickable",new Bn.SFBool(!0)),new N(s.inputOutput,"viewport",new Bn.SFNode),new N(s.inputOnly,"addChildren",new Bn.MFNode),new N(s.inputOnly,"removeChildren",new Bn.MFNode),new N(s.inputOutput,"children",new Bn.MFNode)]),getTypeName:function(){return"Layer"},getComponentName:function(){return"Layering"},getContainerField:function(){return"layers"},initialize:function(){xs.prototype.initialize.call(this),this._addChildren.addFieldInterest(this.getGroup()._addChildren),this._removeChildren.addFieldInterest(this.getGroup()._removeChildren),this._children.addFieldInterest(this.getGroup()._children),this.getGroup()._children=this._children,this.getGroup().setPrivate(!0),this.getGroup().setup()}});const js=zs;function Gs(e){ji.call(this,e),this.addType(s.LayerSet),this.layerNodes=[new js(e)],this.layerNode0=this.layerNodes[0],this.activeLayerNode=null}Gs.prototype=Object.assign(Object.create(ji.prototype),{constructor:Gs,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new P([new N(s.inputOutput,"metadata",new Bn.SFNode),new N(s.inputOutput,"activeLayer",new Bn.SFInt32),new N(s.inputOutput,"order",new Bn.MFInt32(0)),new N(s.inputOutput,"layers",new Bn.MFNode)]),getTypeName:function(){return"LayerSet"},getComponentName:function(){return"Layering"},getContainerField:function(){return"children"},initialize:function(){ji.prototype.initialize.call(this),this.layerNode0.setPrivate(!0),this.layerNode0.setup(),this.layerNode0.isLayer0(!0),this._activeLayer.addInterest("set_activeLayer__",this),this._order.addInterest("set_layers__",this),this._layers.addInterest("set_layers__",this),this.set_layers__()},getActiveLayer:function(){return this.activeLayerNode},setLayer0:function(e){this.layerNode0=e,this.set_layers__()},getLayer0:function(){return this.layerNode0},getLayers:function(){return this.layerNodes},set_activeLayer__:function(){if(0===this._activeLayer.getValue())this.activeLayerNode!==this.layerNode0&&(this.activeLayerNode=this.layerNode0);else{const e=this._activeLayer-1;e>=0&&e<this._layers.length?this.activeLayerNode!==this._layers[e].getValue()&&(this.activeLayerNode=xr(s.X3DLayerNode,this._layers[e])):null!==this.activeLayerNode&&(this.activeLayerNode=null)}},set_layers__:function(){const e=this._layers.getValue();this.layerNodes.length=0;for(let t of this._order)if(0===t)this.layerNodes.push(this.layerNode0);else if(--t,t>=0&&t<e.length){const n=xr(s.X3DLayerNode,e[t]);n&&this.layerNodes.push(n)}this.set_activeLayer__()},bindBindables:function(e){const t=this._layers.getValue();this.layerNode0.bindBindables(e);for(let n=0,i=t.length;n<i;++n){const i=xr(s.X3DLayerNode,t[n]);i&&i.bindBindables(e)}},traverse:function(e,t){const n=this.layerNodes;if(e===sr.POINTER)for(let i=0,o=n.length;i<o;++i)this.getBrowser().setLayerNumber(i),n[i].traverse(e,t);else for(const i of n)i.traverse(e,t)}});const Hs=Gs;function qs(e){Jn.call(this,e),this.addType(s.X3DWorld),this.addChildObjects("activeLayer",new Bt(this.layer0)),this.defaultLayerSet=new Hs(e),this.layerSet=this.defaultLayerSet,this.layer0=new js(e)}Bi.addAbstractType("X3DWorld",qs),qs.prototype=Object.assign(Object.create(Jn.prototype),{constructor:qs,getTypeName:function(){return"X3DWorld"},initialize:function(){Jn.prototype.initialize.call(this),this.layerSet.setPrivate(!0),this.layerSet.setup(),this.layerSet.setLayer0(this.layer0),this.layerSet._activeLayer.addInterest("set_rootNodes__",this),this.getExecutionContext().getRootNodes().addInterest("set_rootNodes__",this),this.set_rootNodes__(),this.layer0.setPrivate(!0),this.layer0.isLayer0(!0),this.layer0.setup(),this.set_activeLayer__()},getCache:function(){return!0},getLayerSet:function(){return this.layerSet},getActiveLayer:function(){return this._activeLayer.getValue()},set_rootNodes__:function(){const e=this.layerSet,t=this.getExecutionContext().getRootNodes();this.layerSet=this.defaultLayerSet,this.layer0._children=t;for(const e of t){const t=xr(s.LayerSet,e);t&&(this.layerSet=t)}this.layerSet!==e&&(this.layerSet.setLayer0(this.layer0),e._activeLayer.removeInterest("set_activeLayer__",this),this.layerSet._activeLayer.addInterest("set_activeLayer__",this),this.set_activeLayer__())},set_activeLayer__:function(){this._activeLayer=this.layerSet.getActiveLayer()},bindBindables:function(){const e=this.getExecutionContext().getWorldURL();this.layerSet.bindBindables(decodeURIComponent(new URL(e,e).hash.substr(1)))},traverse:function(e,t){this.layerSet.traverse(e,t)}});for(const e of Reflect.ownKeys(qs.prototype))Object.defineProperty(qs.prototype,e,{enumerable:!1});const Ws=qs;function Ys(e){e.ajaxTransport("+binary",(function(e,t,n){if(e.dataType&&"binary"==e.dataType)return{send:function(t,n){const i=e.xhr();if(i.open(e.type,e.url,e.async,e.username,e.password),e.xhrFields)for(const t in e.xhrFields)i[t]=e.xhrFields[t];e.mimeType&&i.overrideMimeType&&i.overrideMimeType(e.mimeType);for(const e in t)i.setRequestHeader(e,t[e]);i.onload=function(){i.onload=i.onerror=null;const t={};t[e.dataType]=i.response,n(i.status||200,i.statusText,t,i.getAllResponseHeaders())},i.onerror=function(){i.onload=i.onerror=null,n(i.status||404,i.statusText)},i.responseType=e.responseType||"blob",i.send(e.hasContent&&e.data||null)},abort:function(){const t=e.xhr();t.onload=t.onerror=null,t.abort()}}}))}var Ks=i(755),Zs=i(802);Ys(Ks);Symbol.for("X_ITE.dom");const Qs=/^\s*(?:vrmlscript|javascript|ecmascript)\:([^]*)$/,$s=/^data:(.*?)(?:;charset=(.*?))?(?:;(base64))?,([^]*)$/,Js=/^(?:(.*?);(.*?)$)/,ea=new RegExp(".(?:html|xhtml)$"),ta={"text/html":!0,"application/xhtml+xml":!0},na=new Bn.MFString;function ia(e,t){g.call(this),this.node=e,this.browser=e.getBrowser(),this.external=void 0===t?this.browser.isExternal():t,this.executionContext=this.external?e.getExecutionContext():this.browser.currentScene,this.userAgent=this.browser.getName()+"/"+this.browser.getVersion()+" (X3D Browser; +"+this.browser.getProviderUrl()+")",this.target="",this.url=[],this.URL=new URL(this.getReferer(),this.getReferer()),this.fileReader=new FileReader,this.text=!0}ia.prototype=Object.assign(Object.create(g.prototype),{constructor:ia,abort:function(){this.callback=Function.prototype,this.bindViewpoint=Function.prototype,this.foreign=Function.prototype},isPrivate:function(){return!0},getWorldURL:function(){return this.URL},createX3DFromString:function(e,t,n,i){try{const o=this.browser.createScene();return this.node instanceof Ws?o.loader=this:o.setExecutionContext(this.executionContext),o.setWorldURL(decodeURI(new URL(e,this.getReferer()).href)),n&&(n=this.setScene.bind(this,o,n,i)),new ko(o).parseIntoScene(t,n,i),o}catch(e){if(!i)throw i;i(e)}},setScene:function(e,t,n){e._initLoadCount.addInterest("set_initLoadCount__",this,e,t,n),e._initLoadCount.addEvent()},set_initLoadCount__:function(e,t,n,i){if(!i.getValue()){e._initLoadCount.removeInterest("set_initLoadCount__",this),delete e.loader;try{t(e)}catch(e){if(!n)throw e;n(e)}"data:"!==this.URL.protocol&&console.info("Done loading scene "+decodeURI(this.URL.href))}},createX3DFromURL:function(e,t,n,i,o){return this.bindViewpoint=i,this.foreign=o,this.target=this.getTarget(t||na),n?this.loadDocument(e,this.createX3DFromURLAsync.bind(this,n)):this.createX3DFromURLSync(e)},createX3DFromURLAsync:function(e,t){null===t?e(null,this.URL):this.createX3DFromString(this.URL,t,e,this.loadDocumentError.bind(this))},createX3DFromURLSync:function(e){if(0===e.length)throw new Error("No URL given.");let t=null,n=!1;for(const i of e)if(this.URL=new URL(i,this.getReferer()),Ks.ajax({url:decodeURI(this.URL.href),dataType:"text",async:!1,cache:this.browser.getBrowserOptions().getCache()&&this.node.getCache(),global:!1,context:this,success:function(e){try{t=this.createX3DFromString(this.URL,e),n=!0}catch(e){this.error(e)}},error:function(e,t,n){}}),n)return t;throw new Error("Couldn't load any url of '"+Array.prototype.join.call(e,", ")+"'.")},loadScript:function(e,t){this.script=!0,this.loadDocument(e,t)},loadDocument:function(e,t){if(this.url=e.copy(),this.callback=t,0===e.length)return this.loadDocumentError(new Error("No URL given."));this.loadDocumentAsync(this.url.shift())},loadBinaryDocument:function(e,t){if(this.url=e.copy(),this.callback=t,this.text=!1,0===e.length)return this.loadDocumentError(new Error("No URL given."));this.loadDocumentAsync(this.url.shift())},getTarget:function(e){for(const t of e){const e=t.split("=");if(2===e.length&&"target"===e[0])return e[1]}return""},loadDocumentAsync:function(e){try{if(0===e.length)return void this.loadDocumentError(new Error("URL is empty."));if(this.script){const t=Qs.exec(e);if(t)return void this.callback(t[1])}{const t=$s.exec(e);if(t){let e=t[4];return e="base64"===t[3]?atob(e):unescape(e),void this.callback(e)}}if(this.URL=new URL(e,this.getReferer()),this.bindViewpoint&&this.URL.href.substr(0,this.getReferer().length)===this.getReferer())return void this.bindViewpoint(decodeURIComponent(this.URL.hash.substr(1)));if(this.foreign){if(this.target.length&&"_self"!==this.target)return this.foreign(this.URL.href,this.target);if(this.URL.href.match(ea))return this.foreign(this.URL.href,this.target)}Ks.ajax({url:decodeURI(this.URL.href),dataType:"binary",async:!0,cache:this.browser.getBrowserOptions().getCache()&&this.node.getCache(),global:!1,context:this,success:function(e,t,n){if(this.foreign&&ta[this.getContentType(n)])return this.foreign(this.URL.href,this.target);this.text?(this.fileReader.onload=this.readAsArrayBuffer.bind(this,e),this.fileReader.readAsArrayBuffer(e)):(this.fileReader.onload=this.readAsBinaryString.bind(this),this.fileReader.readAsBinaryString(e))},error:function(e,t,n){this.loadDocumentError(new Error(n))}})}catch(e){return void this.loadDocumentError(e)}},readAsArrayBuffer:function(e){try{this.callback(Zs.ungzip(this.fileReader.result,{to:"string"}),this.URL)}catch(t){this.fileReader.onload=this.readAsText.bind(this,e),this.fileReader.readAsText(e)}},readAsText:function(e){try{this.callback(this.fileReader.result,this.URL)}catch(e){this.loadDocumentError(e)}},readAsBinaryString:function(){try{this.callback(this.fileReader.result,this.URL)}catch(e){this.loadDocumentError(e)}},loadDocumentError:function(e){this.error(e),this.url.length?this.loadDocumentAsync(this.url.shift()):this.callback(null)},error:function(e){"data:"===this.URL.protocol?console.warn("Couldn't load URL 'data':",e.message):console.warn("Couldn't load URL '"+decodeURI(this.URL.href)+"':",e.message),console.error(e)},getReferer:function(){return"X3DWorld"===this.node.getTypeName()&&this.external?this.browser.getLocation():this.executionContext.getWorldURL()},getContentType:function(e){const t=e.getResponseHeader("Content-Type"),n=Js.exec(t);return n?n[1]:""}});for(const e of Reflect.ownKeys(ia.prototype))Object.defineProperty(ia.prototype,e,{enumerable:!1});const oa=ia;Bi.addAbstractType("X3DExternProtoDeclaration",aa);const ra=Symbol(),sa=Symbol();function aa(e,t){lo.call(this,e),xo.call(this,e),this.addType(s.X3DExternProtoDeclaration),this.addChildObjects("load",new Bn.SFBool(!0),"url",t.copy(),"autoRefresh",new Bn.SFTime,"autoRefreshTimeLimit",new Bn.SFTime(3600))}aa.prototype=Object.assign(Object.create(lo.prototype),xo.prototype,{constructor:aa,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new P([new N(s.inputOutput,"metadata",new Bn.SFNode)]),getTypeName:function(){return"X3DExternProtoDeclaration"},initialize:function(){lo.prototype.initialize.call(this),xo.prototype.initialize.call(this)},set_live__:function(){xo.prototype.set_live__.call(this),this.checkLoadState()===s.COMPLETE_STATE&&this[sa].setLive(this.isLive().getValue())},canUserDefinedFields:function(){return!0},setProtoDeclaration:function(e){if(this[ra]=e,e){for(const e of this.getUserDefinedFields())this.removeUserDefinedField(e.getName());for(const t of e.getUserDefinedFields())this.addUserDefinedField(t.getAccessType(),t.getName(),t)}this.updateInstances()},getProtoDeclaration:function(){return this[ra]},loadNow:function(){this.getScene().addInitLoadCount(this),new oa(this).createX3DFromURL(this._url,null,this.setInternalSceneAsync.bind(this))},setInternalSceneAsync:function(e){e?this.setInternalScene(e):this.setError(new Error("File could not be loaded.")),this.getScene().removeInitLoadCount(this)},setInternalScene:function(e){this[sa]=e;const t=decodeURIComponent(new URL(this[sa].getWorldURL()).hash.substr(1)),n=t?this[sa].protos.get(t):this[sa].protos[0];if(!n)throw new Error("PROTO not found");this[sa].setLive(this.isLive().getValue()),this[sa].setPrivate(this.getScene().isPrivate()),this[sa].setExecutionContext(this.getExecutionContext()),this.setLoadState(s.COMPLETE_STATE),this.setProtoDeclaration(n)},getInternalScene:function(){return this[sa]},setError:function(e){console.error("Error loading extern prototype:",e),this[sa]=this.getBrowser().getPrivateScene(),this.setLoadState(s.FAILED_STATE),this.setProtoDeclaration(null)},toVRMLStream:function(e){const t=u.Get(e);e.string+=t.Indent(),e.string+="EXTERNPROTO",e.string+=" ",e.string+=this.getName(),e.string+=" ",e.string+="[";const n=this.getUserDefinedFields();let i=0,o=0;if(0===n.length)e.string+=" ";else{for(const e of n)i=Math.max(i,e.getTypeName().length),o=Math.max(o,t.AccessType(e.getAccessType()).length);e.string+="\n",t.IncIndent();for(const t of n)this.toVRMLStreamUserDefinedField(e,t,i,o),e.string+="\n";t.DecIndent(),e.string+=t.Indent()}e.string+="]",e.string+="\n",e.string+=t.Indent(),this._url.toVRMLStream(e)},toVRMLStreamUserDefinedField:function(e,t,n,i){const o=u.Get(e);e.string+=o.Indent(),e.string+=o.PadRight(o.AccessType(t.getAccessType()),i),e.string+=" ",e.string+=o.PadRight(t.getTypeName(),n),e.string+=" ",e.string+=t.getName()},toXMLStream:function(e){const t=u.Get(e);e.string+=t.Indent(),e.string+="<ExternProtoDeclare",e.string+=" ",e.string+="name='",e.string+=t.XMLEncode(this.getName()),e.string+="'",e.string+=" ",e.string+="url='",this._url.toXMLStream(e),e.string+="'",e.string+=">\n",t.IncIndent();const n=this.getUserDefinedFields();for(const i of n)e.string+=t.Indent(),e.string+="<field",e.string+=" ",e.string+="accessType='",e.string+=t.AccessType(i.getAccessType()),e.string+="'",e.string+=" ",e.string+="type='",e.string+=i.getTypeName(),e.string+="'",e.string+=" ",e.string+="name='",e.string+=t.XMLEncode(i.getName()),e.string+="'",e.string+="/>\n";t.DecIndent(),e.string+=t.Indent(),e.string+="</ExternProtoDeclare>"}});for(const e of Reflect.ownKeys(aa.prototype))Object.defineProperty(aa.prototype,e,{enumerable:!1});Object.defineProperty(aa.prototype,"name",{get:function(){return this.getName()},enumerable:!0,configurable:!1}),Object.defineProperty(aa.prototype,"fields",{get:function(){return this.getFieldDefinitions()},enumerable:!0,configurable:!1}),Object.defineProperty(aa.prototype,"isExternProto",{get:function(){return!0},enumerable:!0,configurable:!1}),Object.defineProperty(aa.prototype,"urls",{get:function(){return this._url},enumerable:!0,configurable:!1}),Object.defineProperty(aa.prototype,"loadState",{get:function(){return this.checkLoadState()},enumerable:!0,configurable:!1});const ua=aa;function la(){return R.call(this)}la.prototype=Object.assign(Object.create(R.prototype),{constructor:la,getTypeName:function(){return"RouteArray"}});for(const e of Reflect.ownKeys(la.prototype))Object.defineProperty(la.prototype,e,{enumerable:!1});const ca=la,ha=Symbol(),da=Symbol(),pa=Symbol(),fa=Symbol(),ga=Symbol();function ma(e,t,n,i,o){g.call(this,e),this[ha]=e,this[da]=t,this[pa]=n,this[fa]=i,this[ga]=o,n.addFieldInterest(o),n.addOutputRoute(this),o.addInputRoute(this)}ma.prototype=Object.assign(Object.create(g.prototype),{getTypeName:function(){return"X3DRoute"},getExecutionContext:function(){return this[ha]},getSourceNode:function(){return this[da]},getSourceField:function(){return this[pa]},getDestinationNode:function(){return this[fa]},getDestinationField:function(){return this[ga]},disconnect:function(){this[pa].removeFieldInterest(this[ga]),this[pa].removeOutputRoute(this),this[ga].removeInputRoute(this)},toVRMLStream:function(e){const t=u.Get(e),n=t.LocalName(this[da]),i=t.LocalName(this[fa]);e.string+=t.Indent(),e.string+="ROUTE",e.string+=" ",e.string+=n,e.string+=".",e.string+=this[pa].getName(),this[pa].getAccessType()===s.inputOutput&&(e.string+="_changed"),e.string+=" ",e.string+="TO",e.string+=" ",e.string+=i,e.string+=".",this[ga].getAccessType()===s.inputOutput&&(e.string+="set_"),e.string+=this[ga].getName()},toXMLStream:function(e){const t=u.Get(e),n=t.LocalName(this[da]),i=t.LocalName(this[fa]);e.string+=t.Indent(),e.string+="<ROUTE",e.string+=" ",e.string+="fromNode='",e.string+=t.XMLEncode(n),e.string+="'",e.string+=" ",e.string+="fromField='",e.string+=t.XMLEncode(this[pa].getName()),this[pa].getAccessType()===s.inputOutput&&(e.string+="_changed"),e.string+="'",e.string+=" ",e.string+="toNode='",e.string+=t.XMLEncode(i),e.string+="'",e.string+=" ",e.string+="toField='",this[ga].getAccessType()===s.inputOutput&&(e.string+="set_"),e.string+=t.XMLEncode(this[ga].getName()),e.string+="'",e.string+="/>"},dispose:function(){this.disconnect(),this[ha].deleteRoute(this),g.prototype.dispose.call(this)}});for(const e of Reflect.ownKeys(ma.prototype))Object.defineProperty(ma.prototype,e,{enumerable:!1});Object.defineProperty(ma.prototype,"sourceNode",{get:function(){return Rt.get(this[da])},enumerable:!0,configurable:!1}),Object.defineProperty(ma.prototype,"sourceField",{get:function(){return this[pa].getName()},enumerable:!0,configurable:!1}),Object.defineProperty(ma.prototype,"destinationNode",{get:function(){return Rt.get(this[fa])},enumerable:!0,configurable:!1}),Object.defineProperty(ma.prototype,"destinationField",{get:function(){return this[ga].getName()},enumerable:!0,configurable:!1});const _a=ma,ya=Symbol(),xa=Symbol(),wa=Symbol(),va=Symbol(),ba=Symbol(),Sa=Symbol();function Ta(e){Jn.call(this,e),this.addType(s.X3DExecutionContext),this.addChildObjects("rootNodes",new Bn.MFNode,"worldInfos",new Bn.MFNode,"sceneGraph_changed",new Bn.SFTime),this._rootNodes.setAccessType(s.initializeOnly),this._rootNodes.addCloneCount(1),this[ya]=new ki,this[xa]=new Qi,this[wa]=new to,this[va]=new Ji,this[ba]=new ca,this.addChildObjects("namedNodes_changed",new Bn.SFTime,"importedNodes_changed",new Bn.SFTime,"protos_changed",new Bn.SFTime,"externprotos_changed",new Bn.SFTime,"routes_changed",new Bn.SFTime)}Bi.addAbstractType("X3DExecutionContext",Ta),Ta.prototype=Object.assign(Object.create(Jn.prototype),{constructor:Ta,initialize:function(){Jn.prototype.initialize.call(this),this.isScene()||this._sceneGraph_changed.addInterest("set_sceneGraph",this)},set_sceneGraph:function(){this.getExecutionContext()._sceneGraph_changed=this.getBrowser().getCurrentTime()},isScene:function(){return!1},getTypeName:function(){return"X3DExecutionContext"},[Sa]:null,getOuterNode:function(){return this[Sa]},setOuterNode:function(e){this[Sa]=e},getSpecificationVersion:function(){return this.getExecutionContext().getSpecificationVersion()},getEncoding:function(){return this.getExecutionContext().getEncoding()},getWorldURL:function(){return this.getExecutionContext().getWorldURL()},getProfile:function(){return this.getExecutionContext().getProfile()},getComponents:function(){return this.getExecutionContext().getComponents()},fromUnit:function(e,t){return this.getExecutionContext().fromUnit(e,t)},toUnit:function(e,t){return this.getExecutionContext().toUnit(e,t)},getUnits:function(){return this.getExecutionContext().getUnits()},createNode:function(e,t=!0){if(e=String(e),!1===t){const t=this.getBrowser().getSupportedNode(e);return t?new t(this):null}{const t=this.getBrowser().getSupportedNode(e);if(!t)throw new Error("Unknown node type '"+e+"'.");const n=new t(this);return n.setup(),Rt.get(n)}},createProto:function(e,t=!0){e=String(e);let n=this;for(;;){const i=n.protos.get(e);if(i)return i.createInstance(this,t);const o=n.externprotos.get(e);if(o)return o.createInstance(this,t);if(n.isScene())break;n=n.getExecutionContext()}if(!1===t)return null;throw new Error("Unknown proto or externproto type '"+e+"'.")},addNamedNode:function(e,t){if(this[ya].has(e))throw new Error("Couldn't add named node: node named '"+e+"' is already in use.");this.updateNamedNode(e,t)},updateNamedNode:function(e,t){if(e=String(e),!(t=xr(s.X3DNode,t,!1)))throw new Error("Couldn't update named node: node must be of type X3DNode.");if(t.getExecutionContext()!==this)throw new Error("Couldn't update named node: node does not belong to this execution context.");if(0===e.length)throw new Error("Couldn't update named node: node name is empty.");this.removeNamedNode(t.getName()),this.removeNamedNode(e),t.setName(e),this[ya].add(e,t),this._namedNodes_changed=this.getBrowser().getCurrentTime()},removeNamedNode:function(e){e=String(e);const t=this[ya].get(e);t&&(t.setName(""),this[ya].remove(e),this._namedNodes_changed=this.getBrowser().getCurrentTime())},getNamedNode:function(e){e=String(e);const t=this[ya].get(e);if(t)return Rt.get(t);throw new Error("Named node '"+e+"' not found.")},getNamedNodes:function(){return this[ya]},getUniqueName:function(e=""){return Ea.call(this,ya,e)},addImportedNode:function(e,t,n){if(void 0===n&&(n=t),t=String(t),n=String(n),this[xa].has(n))throw new Error("Couldn't add imported node: imported name '"+n+"' already in use.");this.updateImportedNode(e,t,n)},updateImportedNode:function(e,t,n){if(e=xr(s.Inline,e,!1),t=String(t),n=void 0===n?t:String(n),!e)throw new Error("Node must be of type Inline node.");if(e.getExecutionContext()!==this)throw new Error("Couldn't update imported node: Inline node does not belong to this execution context.");if(0===t.length)throw new Error("Couldn't update imported node: exported name is empty.");if(0===n.length)throw new Error("Couldn't update imported node: imported name is empty.");this.removeImportedNode(n);const i=new Ki(this,e,t,n);this[xa].add(n,i),i.setup(),this._importedNodes_changed=this.getBrowser().getCurrentTime()},removeImportedNode:function(e){e=String(e);const t=this[xa].get(e);t&&(t.dispose(),this[xa].remove(e),this._importedNodes_changed=this.getBrowser().getCurrentTime())},getImportedNode:function(e){e=String(e);const t=this[xa].get(e);if(t)return Rt.get(t.getExportedNode());throw new Error("Imported node '"+e+"' not found.")},getImportedNodes:function(){return this[xa]},getLocalNode:function(e){e=String(e);try{return this.getNamedNode(e)}catch(t){const n=this[xa].get(e);if(n)return Rt.get(n);throw new Error("Unknown named or imported node '"+e+"'.")}},getLocalName:function(e){if(!(e=xr(s.X3DNode,e,!1)))throw new Error("Couldn't get local name: node must be of type X3DNode.");if(e.getExecutionContext()===this)return e.getName();for(const t of this[xa])try{if(t.getExportedNode()===e)return t.getImportedName()}catch(e){}throw new Error("Couldn't get local name: node is shared.")},setRootNodes:function(){},getRootNodes:function(){return this._rootNodes},getProtoDeclaration:function(e){e=String(e);const t=this[wa].get(e);if(t)return t;throw new Error("Proto declaration '"+e+"' not found.")},addProtoDeclaration(e,t){if(e=String(e),!(t instanceof po))throw new Error("Couldn't add proto declaration: proto must be of type X3DProtoDeclaration.");if(this[wa].get(e))throw new Error("Couldn't add proto declaration: proto '"+e+"' already in use.");if(0===(e=String(e)).length)throw new Error("Couldn't add proto declaration: proto name is empty.");this[wa].add(e,t),t.setName(e),this._protos_changed=this.getBrowser().getCurrentTime()},updateProtoDeclaration(e,t){if(e=String(e),!(t instanceof po))throw new Error("Couldn't add proto declaration: proto must be of type X3DProtoDeclaration.");if(0===(e=String(e)).length)throw new Error("Couldn't add proto declaration: proto name is empty.");this[wa].update(t.getName(),e,t),t.setName(e),this._protos_changed=this.getBrowser().getCurrentTime()},removeProtoDeclaration(e){e=String(e),this[wa].remove(e),this._protos_changed=this.getBrowser().getCurrentTime()},getProtoDeclarations:function(){return this[wa]},getUniqueProtoName:function(e=""){return Ea.call(this,wa,e)},getExternProtoDeclaration:function(e){e=String(e);const t=this[va].get(e);if(t)return t;throw new Error("Extern proto declaration '"+e+"' not found.")},addExternProtoDeclaration(e,t){if(e=String(e),!(t instanceof ua))throw new Error("Couldn't add extern proto declaration: extern proto must be of type X3DExternProtoDeclaration.");if(this[va].get(e))throw new Error("Couldn't add extern proto declaration: extern proto '"+e+"' already in use.");if(0===(e=String(e)).length)throw new Error("Couldn't add extern proto declaration: extern proto name is empty.");this[va].add(e,t),t.setName(e),this._externprotos_changed=this.getBrowser().getCurrentTime()},updateExternProtoDeclaration(e,t){if(e=String(e),!(t instanceof ua))throw new Error("Couldn't add extern proto declaration: extern proto must be of type X3DExternProtoDeclaration.");if(0===(e=String(e)).length)throw new Error("Couldn't add extern proto declaration: extern proto name is empty.");this[va].update(t.getName(),e,t),t.setName(e),this._externprotos_changed=this.getBrowser().getCurrentTime()},removeExternProtoDeclaration(e){e=String(e),this[va].remove(e),this._externprotos_changed=this.getBrowser().getCurrentTime()},getExternProtoDeclarations:function(){return this[va]},getUniqueExternProtoName:function(e=""){return Ea.call(this,va,e)},addRoute:function(e,t,n,i){if(e=xr(s.X3DNode,e,!1),t=String(t),n=xr(s.X3DNode,n,!1),i=String(i),!e)throw new Error("Bad ROUTE specification: source node must be of type X3DNode.");if(!n)throw new Error("Bad ROUTE specification: destination node must be of type X3DNode.");let o=e instanceof Ki?e:null,r=n instanceof Ki?n:null;try{e.getExecutionContext()!==this&&(o=this.getLocalNode(this.getLocalName(e)).getValue())}catch(e){}try{n.getExecutionContext()!==this&&(r=this.getLocalNode(this.getLocalName(n)).getValue())}catch(e){}if(o instanceof Ki&&r instanceof Ki?(o.addRoute(o,t,r,i),r.addRoute(o,t,r,i)):o instanceof Ki?o.addRoute(o,t,n,i):r instanceof Ki&&r.addRoute(e,t,r,i),o!==e&&r!==n)return this.addSimpleRoute(e,t,n,i)},addSimpleRoute:function(e,t,n,i){try{if(t=e.getField(t),i=n.getField(i),!t.isOutput())throw new Error("Field named '"+t.getName()+"' in node named '"+e.getName()+"' of type "+e.getTypeName()+" is not an output field.");if(!i.isInput())throw new Error("Field named '"+i.getName()+"' in node named '"+n.getName()+"' of type "+n.getTypeName()+" is not an input field.");if(t.getType()!==i.getType())throw new Error("ROUTE types "+t.getTypeName()+" and "+i.getTypeName()+" do not match.");const o=t.getId()+"."+i.getId();let r=this[ba].get(o);return r||(r=new _a(this,e,t,n,i),this[ba].add(o,r),this._routes_changed=this.getBrowser().getCurrentTime(),r)}catch(e){throw new Error("Bad ROUTE specification: "+e.message)}},deleteRoute:function(e){if(4===arguments.length&&!(e=this.getRoute.apply(this,arguments)))return!1;this.deleteSimpleRoute(e)&&this.deleteImportedRoute(e.sourceNode,e.destinationNode,e)},deleteSimpleRoute:function(e){try{const t=e.getSourceField(),n=e.getDestinationField(),i=t.getId()+"."+n.getId();return this[ba].remove(i),e.disconnect(),this._routes_changed=this.getBrowser().getCurrentTime(),!0}catch(e){return console.error(e),!1}},deleteImportedRoute(e,t,n){let i=null,o=null;try{e.getValue().getExecutionContext()!==this&&(i=this.getLocalNode(this.getLocalName(e)).getValue())}catch(e){}try{t.getValue().getExecutionContext()!==this&&(o=this.getLocalNode(this.getLocalName(t)).getValue())}catch(e){}i instanceof Ki&&o instanceof Ki?(i.deleteRoute(n),o.deleteRoute(n)):i instanceof Ki?i.deleteRoute(n):o instanceof Ki&&o.deleteRoute(n)},getRoute:function(e,t,n,i){if(e=xr(s.X3DNode,e,!1),t=String(t),n=xr(s.X3DNode,n,!1),i=String(i),!e)throw new Error("Bad ROUTE specification: sourceNode must be of type X3DNode.");if(!n)throw new Error("Bad ROUTE specification: destinationNode must be of type X3DNode.");t=e.getField(t),i=n.getField(i);const o=t.getId()+"."+i.getId();return this[ba].get(o)},getRoutes:function(){return this[ba]},getWorldInfos:function(){return this._worldInfos},addWorldInfo:function(e){this._worldInfos.push(e)},removeWorldInfo:function(e){for(let t=this._worldInfos.length-1;t>=0;--t)this._worldInfos[t].getValue()===e&&this._worldInfos.splice(t,1)},toVRMLStream:function(e){const t=u.Get(e);t.PushExecutionContext(this),t.EnterScope(),t.ImportedNodes(this.getImportedNodes()),this.getExternProtoDeclarations().toVRMLStream(e),this.getProtoDeclarations().toVRMLStream(e);const n=this.getRootNodes();for(let i=0,o=n.length;i<o;++i){const r=n[i];e.string+=t.Indent(),r?r.toVRMLStream(e):e.string+="NULL",e.string+="\n",i!==o-1&&(e.string+="\n")}const i=this.getImportedNodes();i.size&&(e.string+="\n",i.forEach((function(t){try{t.toVRMLStream(e),e.string+="\n"}catch(e){}})));const o=this.getRoutes();o.length&&(e.string+="\n",o.toVRMLStream(e)),t.LeaveScope(),t.PopExecutionContext()},toXMLStream:function(e){const t=u.Get(e);t.PushExecutionContext(this),t.EnterScope(),t.ImportedNodes(this.getImportedNodes()),this.getExternProtoDeclarations().toXMLStream(e),this.getProtoDeclarations().toXMLStream(e);const n=this.getRootNodes();n.length&&(n.toXMLStream(e),e.string+="\n");this.getImportedNodes().forEach((function(t){try{t.toXMLStream(e),e.string+="\n"}catch(e){}})),this.getRoutes().toXMLStream(e),t.LeaveScope(),t.PopExecutionContext()},dispose:function(){this._rootNodes.dispose();for(const e of this[ba])this.deleteRoute(e);Jn.prototype.dispose.call(this)}});const Ea=function(){const e=/_\d+$/;return function(t,n=""){let i=n=String(n).replace(e,""),o=64;for(;o&&(this[t].has(i)||0===i.length);){const e=o,t=o<<=1;i=n,i+="_",i+=Math.round(ee.random(e,t))}return i}}();for(const e of Reflect.ownKeys(Ta.prototype))Object.defineProperty(Ta.prototype,e,{enumerable:!1});Object.defineProperty(Ta.prototype,"specificationVersion",{get:function(){return this.getSpecificationVersion()},enumerable:!0,configurable:!1}),Object.defineProperty(Ta.prototype,"encoding",{get:function(){return this.getEncoding()},enumerable:!0,configurable:!1}),Object.defineProperty(Ta.prototype,"profile",{get:function(){return this.getProfile()},enumerable:!0,configurable:!1}),Object.defineProperty(Ta.prototype,"components",{get:function(){return this.getComponents()},enumerable:!0,configurable:!1}),Object.defineProperty(Ta.prototype,"worldURL",{get:function(){return this.getWorldURL()},enumerable:!0,configurable:!1}),Object.defineProperty(Ta.prototype,"units",{get:function(){return this.getUnits()},enumerable:!0,configurable:!1}),Object.defineProperty(Ta.prototype,"rootNodes",{get:function(){return this.getRootNodes()},set:function(e){this.setRootNodes(e)},enumerable:!0,configurable:!1}),Object.defineProperty(Ta.prototype,"protos",{get:function(){return this.getProtoDeclarations()},enumerable:!0,configurable:!1}),Object.defineProperty(Ta.prototype,"externprotos",{get:function(){return this.getExternProtoDeclarations()},enumerable:!0,configurable:!1}),Object.defineProperty(Ta.prototype,"routes",{get:function(){return this.getRoutes()},enumerable:!0,configurable:!1});const Ca=Ta;function Oa(e,t,n,i,o){this.name=e,this.level=t,this.title=n,this.providerUrl=i,this.dependencies=o}Oa.prototype=Object.assign(Object.create(g.prototype),{constructor:Oa,getTypeName:function(){return"ComponentInfo"},toVRMLStream:function(e){e.string+="COMPONENT",e.string+=" ",e.string+=this.name,e.string+=" ",e.string+=":",e.string+=" ",e.string+=this.level},toXMLStream:function(e){const t=u.Get(e);e.string+=t.Indent(),e.string+="<component",e.string+=" ",e.string+="name='",e.string+=this.name,e.string+="'",e.string+=" ",e.string+="level='",e.string+=this.level,e.string+="'",e.string+="/>"}});for(const e of Reflect.ownKeys(Oa.prototype))Object.defineProperty(Oa.prototype,e,{enumerable:!1});const Na=Oa;function Fa(e){return R.call(this,e)}Fa.prototype=Object.assign(Object.create(R.prototype),{constructor:Fa,getTypeName:function(){return"ComponentInfoArray"},addComponent:function(e){this.add(e.name,new Na(e.name,e.level,e.title,e.providerUrl,e.dependencies||[]))}});for(const e of Reflect.ownKeys(Fa.prototype))Object.defineProperty(Fa.prototype,e,{enumerable:!1});const Ma=Fa;function Da(e,t,n){Object.defineProperty(this,"category",{value:e,writable:!1}),this.name=t,this.conversionFactor=n}Da.prototype=Object.assign(Object.create(g.prototype),{constructor:Da,getTypeName:function(){return"UnitInfo"},toVRMLStream:function(e){e.string+="UNIT",e.string+=" ",e.string+=this.category,e.string+=" ",e.string+=this.name,e.string+=" ",e.string+=this.conversionFactor},toXMLStream:function(e){const t=u.Get(e);e.string+=t.Indent(),e.string+="<unit",e.string+=" ",e.string+="category='",e.string+=this.category,e.string+="'",e.string+=" ",e.string+="name='",e.string+=t.XMLEncode(this.name),e.string+="'",e.string+=" ",e.string+="conversionFactor='",e.string+=this.conversionFactor,e.string+="'",e.string+="/>"}});for(const e of Reflect.ownKeys(Da.prototype))Object.defineProperty(Da.prototype,e,{enumerable:!1});Object.defineProperty(Da.prototype,"conversion_factor",{get:function(){return this.conversionFactor},enumerable:!1,configurable:!1});const Ia=Da;function Ra(e){return R.call(this,e)}Ra.prototype=Object.assign(Object.create(R.prototype),{constructor:Ra,getTypeName:function(){return"UnitInfoArray"}});for(const e of Reflect.ownKeys(Ra.prototype))Object.defineProperty(Ra.prototype,e,{enumerable:!1});const Va=Ra,Pa=Symbol(),Aa=Symbol();function La(e,t){g.call(this),this[Pa]=e,this[Aa]=t}La.prototype=Object.assign(Object.create(g.prototype),{constructor:La,getExportedName:function(){return this[Pa]},getLocalNode:function(){return this[Aa]},toVRMLStream:function(e){const t=u.Get(e),n=t.LocalName(this[Aa]);e.string+=t.Indent(),e.string+="EXPORT",e.string+=" ",e.string+=n,this[Pa]!==n&&(e.string+=" ",e.string+="AS",e.string+=" ",e.string+=this[Pa])},toXMLStream:function(e){const t=u.Get(e),n=t.LocalName(this[Aa]);e.string+=t.Indent(),e.string+="<EXPORT",e.string+=" ",e.string+="localDEF='",e.string+=t.XMLEncode(n),e.string+="'",this[Pa]!==n&&(e.string+=" ",e.string+="AS='",e.string+=t.XMLEncode(this[Pa]),e.string+="'"),e.string+="/>"}});for(const e of Reflect.ownKeys(La.prototype))Object.defineProperty(La.prototype,e,{enumerable:!1});Object.defineProperty(La.prototype,"exportedName",{get:function(){return Rt.get(this[Pa])},enumerable:!0,configurable:!1}),Object.defineProperty(La.prototype,"localNode",{get:function(){return Rt.get(this[Aa])},enumerable:!0,configurable:!1});const Ua=La;function Ba(e){return R.call(this,e)}Ba.prototype=Object.assign(Object.create(R.prototype),{constructor:Ba,getTypeName:function(){return"ExportedNodesArray"}});for(const e of Reflect.ownKeys(Ba.prototype))Object.defineProperty(Ba.prototype,e,{enumerable:!1});const Xa=Ba,ka=Symbol(),za=Symbol(),ja=Symbol(),Ga=Symbol(),Ha=Symbol(),qa=Symbol(),Wa=Symbol(),Ya=Symbol();function Ka(e){Ca.call(this,e),this.addType(s.X3DScene),this[ka]="3.3",this[za]="SCRIPTED",this[ja]=null,this[Ga]=new Ma([]),this[Ha]=location.toString(),this[qa]=new Va,this[qa].add("angle",new Ia("angle","radian",1)),this[qa].add("force",new Ia("force","newton",1)),this[qa].add("length",new Ia("length","metre",1)),this[qa].add("mass",new Ia("mass","kilogram",1)),this[Wa]=new Map,this[Ya]=new Xa,this.addChildObjects("profile_changed",new Bn.SFTime,"components_changed",new Bn.SFTime,"units_changed",new Bn.SFTime,"metadata_changed",new Bn.SFTime,"exportedNodes_changed",new Bn.SFTime),this.getRootNodes().setAccessType(s.inputOutput),this.setLive(!1)}Bi.addAbstractType("X3DScene",Ka),Ka.prototype=Object.assign(Object.create(Ca.prototype),{constructor:Ka,getTypeName:function(){return"X3DScene"},isMainScene:function(){return this===this.getExecutionContext()},isScene:function(){return!0},setSpecificationVersion:function(e){this[ka]=String(e)},getSpecificationVersion:function(){return this[ka]},setEncoding:function(e){this[za]=String(e)},getEncoding:function(){return this[za]},setWorldURL:function(e){this[Ha]=String(e)},getWorldURL:function(){return this[Ha]},setProfile:function(e){this[ja]=e,this._profile_changed=this.getBrowser().getCurrentTime()},getProfile:function(){return this[ja]},addComponent:function(e){this[Ga].add(e.name,e),this._components_changed=this.getBrowser().getCurrentTime()},removeComponent:function(e){this[Ga].remove(e.name),this._components_changed=this.getBrowser().getCurrentTime()},getComponents:function(){return this[Ga]},updateUnit:function(e,t,n){const i=this[qa].get(e);i&&(i.name=String(t),i.conversionFactor=Number(n),this._units_changed=this.getBrowser().getCurrentTime())},getUnit:function(e){return this[qa].get(e)},getUnits:function(){return this[qa]},fromUnit:function(e,t){switch(e){case"angle":case"force":case"length":case"mass":return t*this.getUnits().get(e).conversionFactor;case"acceleration:":case"speed":return t*this.getUnits().get("length").conversionFactor;case"angularRate":return t*this.getUnits().get("angle").conversionFactor;case"area":return t*Math.pow(this.getUnits().get("length").conversionFactor,2);case"volume":return t*Math.pow(this.getUnits().get("length").conversionFactor,3)}return t},toUnit:function(e,t){switch(e){case"angle":case"force":case"length":case"mass":return t/this.getUnits().get(e).conversionFactor;case"acceleration:":case"speed":return t/this.getUnits().get("length").conversionFactor;case"angularRate":return t/this.getUnits().get("angle").conversionFactor;case"area":return t/Math.pow(this.getUnits().get("length").conversionFactor,2);case"volume":return t/Math.pow(this.getUnits().get("length").conversionFactor,3)}return t},setMetaData:function(e,t){(e=String(e)).length&&(this[Wa].set(e,String(t)),this._metadata_changed=this.getBrowser().getCurrentTime())},removeMetaData:function(e){e=String(e),this[Wa].delete(e),this._metadata_changed=this.getBrowser().getCurrentTime()},getMetaData:function(e){return e=String(e),this[Wa].get(e)},getMetaDatas:function(){return this[Wa]},addExportedNode:function(e,t){if(e=String(e),this[Ya].has(e))throw new Error("Couldn't add exported node: exported name '"+e+"' already in use.");this.updateExportedNode(e,t),this._exportedNodes_changed=this.getBrowser().getCurrentTime()},updateExportedNode:function(e,t){if(e=String(e),t=xr(s.X3DNode,t,!1),0===e.length)throw new Error("Couldn't update exported node: node exported name is empty.");if(!t)throw new Error("Couldn't update exported node: node must be of type X3DNode.");this.removeExportedNode(e);const n=new Ua(e,t);this[Ya].add(e,n),this._exportedNodes_changed=this.getBrowser().getCurrentTime()},removeExportedNode:function(e){e=String(e),this[Ya].remove(e),this._exportedNodes_changed=this.getBrowser().getCurrentTime()},getExportedNode:function(e){e=String(e);const t=this[Ya].get(e);if(t)return Rt.get(t.getLocalNode());throw new Error("Exported node '"+e+"' not found.")},getExportedNodes:function(){return this[Ya]},addRootNode:function(e){e=Rt.get(xr(s.X3DNode,e,!1));const t=this.getRootNodes();for(const n of t)if(n.equals(e))return;t.push(e)},removeRootNode:function(e){e=Rt.get(xr(s.X3DNode,e,!1));const t=this.getRootNodes(),n=t.length;t.erase(t.remove(0,n,e),n)},setRootNodes:function(e){if(!(e instanceof Bn.MFNode))throw new Error("Value must be of type MFNode.");this.getRootNodes().assign(e)},toVRMLStream:function(e){const t=u.Get(e);let n=this.getSpecificationVersion();"2.0"===n&&(n="3.3"),e.string+="#X3D V",e.string+=n,e.string+=" ",e.string+="utf8",e.string+=" ",e.string+=this.getBrowser().name,e.string+=" ",e.string+="V",e.string+=this.getBrowser().version,e.string+="\n",e.string+="\n";const i=this.getProfile();i&&(i.toVRMLStream(e),e.string+="\n",e.string+="\n");const o=this.getComponents();o.length&&(o.toVRMLStream(e),e.string+="\n");{let t=!0;for(const n of this.getUnits())1!==n.conversionFactor&&(t=!1,n.toVRMLStream(e),e.string+="\n");t||(e.string+="\n")}const r=this.getMetaDatas();r.size&&(r.forEach((function(t,n){e.string+="META",e.string+=" ",e.string+=new Bn.SFString(n).toString(),e.string+=" ",e.string+=new Bn.SFString(t).toString(),e.string+="\n"})),e.string+="\n");const s=this.getExportedNodes();t.PushExecutionContext(this),t.EnterScope(),t.ExportedNodes(s),Ca.prototype.toVRMLStream.call(this,e),s.size&&(e.string+="\n",s.forEach((function(t){try{t.toVRMLStream(e),e.string+="\n"}catch(e){console.error(e)}}))),t.LeaveScope(),t.PopExecutionContext()},toXMLStream:function(e){const t=u.Get(e);let n=this.getSpecificationVersion();"2.0"===n&&(n="3.3"),e.string+='<?xml version="1.0" encoding="UTF-8"?>\n',e.string+='<!DOCTYPE X3D PUBLIC "ISO//Web3D//DTD X3D ',e.string+=n,e.string+='//EN" "http://www.web3d.org/specifications/x3d-',e.string+=n,e.string+='.dtd">\n',e.string+="<X3D",e.string+=" ",e.string+="profile='",e.string+=this.getProfile()?this.getProfile().name:"Full",e.string+="'",e.string+=" ",e.string+="version='",e.string+=n,e.string+="'",e.string+=" ",e.string+="xmlns:xsd='http://www.w3.org/2001/XMLSchema-instance'",e.string+=" ",e.string+="xsd:noNamespaceSchemaLocation='http://www.web3d.org/specifications/x3d-",e.string+=n,e.string+=".xsd'>\n",t.IncIndent(),e.string+=t.Indent(),e.string+="<head>\n",t.IncIndent(),this.getComponents().toXMLStream(e);for(const t of this.getUnits())1!==t.conversionFactor&&(t.toXMLStream(e),e.string+="\n");this.getMetaDatas().forEach((function(n,i){e.string+=t.Indent(),e.string+="<meta",e.string+=" ",e.string+="name='",e.string+=t.XMLEncode(i),e.string+="'",e.string+=" ",e.string+="content='",e.string+=t.XMLEncode(n),e.string+="'",e.string+="/>\n"})),t.DecIndent(),e.string+=t.Indent(),e.string+="</head>\n",e.string+=t.Indent(),e.string+="<Scene>\n",t.IncIndent();const i=this.getExportedNodes();t.PushExecutionContext(this),t.EnterScope(),t.ExportedNodes(i),Ca.prototype.toXMLStream.call(this,e);for(const t of i)try{t.toXMLStream(e),e.string+="\n"}catch(e){console.error(e)}t.LeaveScope(),t.PopExecutionContext(),t.DecIndent(),e.string+=t.Indent(),e.string+="</Scene>\n",t.DecIndent(),e.string+="</X3D>\n"}});for(const e of Reflect.ownKeys(Ka.prototype))Object.defineProperty(Ka.prototype,e,{enumerable:!1});const Za=Ka,Qa=Symbol.for("X3DEventObject.browser"),$a=Symbol();function Ja(e){this[Qa]=e,Za.call(this,this),this.addChildObjects("initLoadCount",new Bn.SFInt32,"loadCount",new Bn.SFInt32),this[$a]=new Set}Ja.prototype=Object.assign(Object.create(Za.prototype),{constructor:Ja,setExecutionContext:function(e){if(!this.isMainScene()){const e=this.getScene();for(const t of this[$a])e.removeLoadCount(t)}if(Za.prototype.setExecutionContext.call(this,e),!this.isMainScene()){const e=this.getScene();for(const t of this[$a])e.addLoadCount(t)}},addInitLoadCount:function(e){this._initLoadCount=this._initLoadCount.getValue()+1},removeInitLoadCount:function(e){this._initLoadCount=this._initLoadCount.getValue()-1},addLoadCount:function(e){if(this[$a].has(e))return;this[$a].add(e),this._loadCount=this[$a].size;const t=this.getBrowser(),n=this.getScene();this!==t.getExecutionContext()&&this.loader!==t.loader||t.addLoadCount(e),this.isMainScene()||n.addLoadCount(e)},removeLoadCount:function(e){if(!this[$a].has(e))return;this[$a].delete(e),this._loadCount=this[$a].size;const t=this.getBrowser(),n=this.getScene();this!==t.getExecutionContext()&&this.loader!==t.loader||t.removeLoadCount(e),this.isMainScene()||n.removeLoadCount(e)},getLoadingObjects:function(){return this[$a]}});for(const e of Reflect.ownKeys(Ja.prototype))Object.defineProperty(Ja.prototype,e,{enumerable:!1});const eu=Ja,tu=new WeakMap,nu=new WeakMap,iu=new WeakMap,ou={get:function(e,t){const n=e[t];if(void 0!==n)return n;const i=e.getStorage()[e.getNameSpace()+t];if(void 0===i||"undefined"===i||null===i)return e.getDefaultValue(t);return JSON.parse(i)},set:function(e,t,n){return void 0===n?e.getStorage().removeItem(e.getNameSpace()+t):e.getStorage()[e.getNameSpace()+t]=JSON.stringify(n),!0}};function ru(e,t){return this.target=this,tu.set(this,e),nu.set(this,t),iu.set(this,{}),new Proxy(this,ou)}ru.prototype={constructor:ru,getStorage:function(){return tu.get(this.target)},getNameSpace:function(){return nu.get(this.target)},addNameSpace:function(e){return new ru(this.getStorage(),this.getNameSpace()+e)},addDefaultValues:function(e){Object.assign(iu.get(this.target),e)},getDefaultValue(e){const t=iu.get(this.target)[e];return void 0===t?void 0:JSON.parse(JSON.stringify(t))},clear:function(){const e=this.getStorage(),t=this.getNameSpace();for(const n of Object.keys(e))n.startsWith(t)&&e.removeItem(n)}};const su=ru;var au=i(755);const uu=Symbol(),lu=Symbol(),cu=Symbol(),hu=Symbol(),du=Symbol(),pu=Symbol(),fu=Symbol(),gu=Symbol(),mu=Symbol(),_u=Symbol(),yu=Symbol(),xu=Symbol(),wu=Symbol(),vu=Symbol(),bu=Symbol(),Su=Symbol(),Tu=Symbol(),Eu=Symbol(),Cu=Symbol();let Ou=0;function Nu(e){const t=au(e.prop("shadowRoot")),n=au("<div></div>").addClass("x_ite-private-browser").attr("tabindex",0),i=au("<div></div>").addClass("x_ite-private-surface").appendTo(n),o=au("<div></div>").hide().addClass("x_ite-private-splash-screen").appendTo(n),r=(au("<div></div>").addClass("x_ite-private-spinner").appendTo(o),au("<div></div>").addClass("x_ite-private-progress").appendTo(o));au("<div></div>").addClass("x_ite-private-x_ite").html(this.getName()+"<span class='x_ite-private-x3d'>X3D</span>").appendTo(r),au("<div></div>").addClass("x_ite-private-progressbar").appendTo(r).append(au("<div></div>")),au("<div></div>").addClass("x_ite-private-spinner-text").appendTo(r),this[uu]=++Ou,this[lu]=e,this[cu]=t.length?t.append(n.hide()):this[lu].prepend(n),this[hu]=i,this[du]=au("<canvas></canvas>").addClass("x_ite-private-canvas").prependTo(i),this[pu]=ii.create(this[du][0],2,"true"===e.attr("preserveDrawingBuffer")),this[fu]=o,t.length&&t.prop("loaded").then((function(){n.show()})),this[gu]=new su(localStorage,"X_ITE.X3DBrowser("+this[uu]+")."),this[mu]=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent),this[_u]=new hi(this.getPrivateScene()),this[yu]=new wi(this.getPrivateScene()),this[xu]=new bi(this.getPrivateScene()),this[wu]=new Ti(this.getPrivateScene()),this[vu]=new Oi(this.getPrivateScene()),this[bu]=new Di(this.getPrivateScene()),this[Cu]=1,au(".x_ite-console").empty(),this.addChildObjects("controlKey",new Bn.SFBool,"shiftKey",new Bn.SFBool,"altKey",new Bn.SFBool,"altGrKey",new Bn.SFBool)}Nu.prototype={initialize:function(){this[_u].setup(),this[yu].setup(),this[xu].setup(),this[wu].setup(),this[vu].setup(),this[bu].setup(),Object.defineProperty(this.getElement().get(0),"src",{get:function(){return this.getExecutionContext().getWorldURL()}.bind(this),set:function(e){this.loadURL(new Bn.MFString(e),new Bn.MFString)}.bind(this),enumerable:!0,configurable:!1}),Object.defineProperty(this.getElement().get(0),"url",{get:function(){return new Bn.MFString(this.getExecutionContext().getWorldURL())}.bind(this),set:function(e){this.loadURL(e,new Bn.MFString)}.bind(this),enumerable:!0,configurable:!1}),this.getElement().on("keydown.X3DCoreContext",this[Tu].bind(this)),this.getElement().on("keyup.X3DCoreContext",this[Eu].bind(this))},getDebug:function(){return this.getBrowserOptions().getDebug()},getInstanceId:function(){return this[uu]},isStrict:function(){return!1},getElement:function(){return this[lu]},getShadow:function(){return this[cu]},getSurface:function(){return this[hu]},getSplashScreen:function(){return this[fu]},getCanvas:function(){return this[du]},getContext:function(){return this[pu]},getMobile:function(){return this[mu]},getLocalStorage:function(){return this[gu]},getBrowserTimings:function(){return this[_u]},getBrowserOptions:function(){return this[yu]},getBrowserProperties:function(){return this[xu]},getRenderingProperties:function(){return this[wu]},getNotification:function(){return this[vu]},getContextMenu:function(){return this[bu]},getPrivateScene:function(){return this[Su]||(this[Su]=new eu(this),this[Su].setPrivate(!0),this[Su].setLive(!0),this[Su].setup()),this[Su]},getPixelPerPoint:function(){return this[Cu]},connectedCallback:function(){const e=au("<div></div>").hide().css("height","10in").appendTo(this[cu]);this[Cu]=e.height()/720||1,e.remove()},attributeChangedCallback:function(e,t,n){switch(e.toLowerCase()){case"splashscreen":this.getBrowserOptions().setAttributeSplashScreen();break;case"src":this.loadURL(new Bn.MFString(n),new Bn.MFString);break;case"url":this.loadURL(this.parseUrlAttribute(n),new Bn.MFString)}},parseUrlAttribute:function(e){const t=new Bn.MFString;return t.fromString(e,this.getExecutionContext()),t},callBrowserEventHandler:function(e){const t=window.jQuery?window.jQuery(this.getElement().get(0)):this.getElement();for(const n of e.split(" "))t.trigger(n)},getShiftKey:function(){return this._shiftKey.getValue()},getControlKey:function(){return this._controlKey.getValue()},getAltKey:function(){return this._altKey.getValue()},getAltGrKey:function(){return this._altGrKey.getValue()},[Tu]:function(e){switch(e.keyCode){case 16:this._shiftKey=!0;break;case 17:this._controlKey=!0;break;case 18:this._altKey=!0;break;case 49:this.getDebug()&&this.getControlKey()&&(e.preventDefault(),this.setBrowserOption("Shading","POINT"),this.getNotification()._string="Shading: Pointset");break;case 50:this.getDebug()&&this.getControlKey()&&(e.preventDefault(),this.setBrowserOption("Shading","WIREFRAME"),this.getNotification()._string="Shading: Wireframe");break;case 51:this.getDebug()&&this.getControlKey()&&(e.preventDefault(),this.setBrowserOption("Shading","FLAT"),this.getNotification()._string="Shading: Flat");break;case 52:this.getDebug()&&this.getControlKey()&&(e.preventDefault(),this.setBrowserOption("Shading","GOURAUD"),this.getNotification()._string="Shading: Gouraud");break;case 53:this.getDebug()&&this.getControlKey()&&(e.preventDefault(),this.setBrowserOption("Shading","PHONG"),this.getNotification()._string="Shading: Phong");break;case 83:this.getDebug()&&this.getControlKey()&&(e.preventDefault(),this.isLive().getValue()?this.endUpdate():this.beginUpdate(),this.getNotification()._string=this.isLive().getValue()?"Begin Update":"End Update");break;case 225:this._altGrKey=!0;break;case 171:case 187:this.getControlKey()&&(e.preventDefault(),this.setBrowserOption("Timings",!this.getBrowserOption("Timings")));break;case 36:e.preventDefault(),this.firstViewpoint();break;case 35:e.preventDefault(),this.lastViewpoint();break;case 33:e.preventDefault(),this.previousViewpoint();break;case 34:e.preventDefault(),this.nextViewpoint();break;case 119:if(this.getShiftKey()){e.preventDefault();const t=this.getActiveViewpoint();if(!t)break;const n=this.getPrivateScene().createNode(t.getTypeName());switch(t.getTypeName()){case"Viewpoint":n.position=t.getUserPosition(),n.orientation=t.getUserOrientation(),n.centerOfRotation=t.getUserCenterOfRotation(),n.fieldOfView=t.getFieldOfView();break;case"OrthoViewpoint":n.position=t.getUserPosition(),n.orientation=t.getUserOrientation(),n.centerOfRotation=t.getUserCenterOfRotation(),n.fieldOfView=new Bn.MFFloat(t.getMinimumX(),t.getMinimumY(),t.getMaximumX(),t.getMaximumY());break;case"GeoViewpoint":{const e=t._geoOrigin,i=new He(0,0,0);if(e.getValue()&&"GeoOrigin"===e.getNodeTypeName()){const t=this.getPrivateScene().createNode("GeoOrigin");n.geoOrigin=t,t.geoSystem=e.geoSystem,t.geoCoords=e.geoCoords,t.rotateYUp=e.rotateYUp}n.geoSystem=t._geoSystem,n.position=t.getGeoCoord(t.getUserPosition(),i),n.orientation=t.getUserOrientation(),n.centerOfRotation=t.getGeoCoord(t.getUserCenterOfRotation(),i),n.fieldOfView=t.getFieldOfView();break}}let i;switch(this.getExecutionContext().getEncoding()){case"ASCII":case"VRML":i=n.toVRMLString();break;case"JSON":i=n.toJSONString();break;default:i=n.toXMLString()}i+="\n",this.copyToClipboard(i),this.getNotification()._string=ai("Viewpoint is copied to clipboard."),console.log("Copied Viewpoint to Clipboard."),console.debug(i)}}},[Eu]:function(e){switch(e.which){case 16:this._shiftKey=!1;break;case 17:this._controlKey=!1;break;case 18:this._altKey=!1;break;case 225:this._altGrKey=!1}},copyToClipboard:function(e){const t=au("<textarea></textarea>");this.getShadow().find(".x_ite-private-browser").prepend(t),t.text(e).select(),document.execCommand("copy"),t.remove()}};const Fu=Nu;function Mu(e){ji.call(this,e),this.addType(s.TextureProperties)}Mu.prototype=Object.assign(Object.create(ji.prototype),{constructor:Mu,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new P([new N(s.inputOutput,"metadata",new Bn.SFNode),new N(s.inputOutput,"borderColor",new Bn.SFColorRGBA),new N(s.inputOutput,"borderWidth",new Bn.SFInt32),new N(s.inputOutput,"anisotropicDegree",new Bn.SFFloat(1)),new N(s.initializeOnly,"generateMipMaps",new Bn.SFBool),new N(s.inputOutput,"minificationFilter",new Bn.SFString("DEFAULT")),new N(s.inputOutput,"magnificationFilter",new Bn.SFString("DEFAULT")),new N(s.inputOutput,"boundaryModeS",new Bn.SFString("REPEAT")),new N(s.inputOutput,"boundaryModeT",new Bn.SFString("REPEAT")),new N(s.inputOutput,"boundaryModeR",new Bn.SFString("REPEAT")),new N(s.inputOutput,"textureCompression",new Bn.SFString("DEFAULT")),new N(s.inputOutput,"texturePriority",new Bn.SFFloat)]),getTypeName:function(){return"TextureProperties"},getComponentName:function(){return"Texturing"},getContainerField:function(){return"textureProperties"},getBorderWidth:function(){return ee.clamp(this._borderWidth.getValue(),0,1)},getBoundaryMode:function(){const e=new Map([["CLAMP","CLAMP_TO_EDGE"],["CLAMP_TO_EDGE","CLAMP_TO_EDGE"],["CLAMP_TO_BOUNDARY","CLAMP_TO_EDGE"],["MIRRORED_REPEAT","MIRRORED_REPEAT"],["REPEAT","REPEAT"]]);return function(t){const n=e.get(t);return void 0!==n?n:"REPEAT"}}(),getBoundaryModeS:function(){return this.getBoundaryMode(this._boundaryModeS.getValue())},getBoundaryModeT:function(){return this.getBoundaryMode(this._boundaryModeT.getValue())},getBoundaryModeR:function(){return this.getBoundaryMode(this._boundaryModeR.getValue())},getMinificationFilter:function(){const e=new Map([["AVG_PIXEL_AVG_MIPMAP","LINEAR_MIPMAP_LINEAR"],["AVG_PIXEL","LINEAR"],["AVG_PIXEL_NEAREST_MIPMAP","LINEAR_MIPMAP_NEAREST"],["NEAREST_PIXEL_AVG_MIPMAP","NEAREST_MIPMAP_LINEAR"],["NEAREST_PIXEL_NEAREST_MIPMAP","NEAREST_MIPMAP_NEAREST"],["NEAREST_PIXEL","NEAREST"],["NICEST","LINEAR_MIPMAP_LINEAR"],["FASTEST","NEAREST"]]);return function(){if(this._generateMipMaps.getValue()){const t=e.get(this._minificationFilter.getValue());return void 0!==t?t:this.getBrowser().getDefaultTextureProperties().getMinificationFilter()}return"LINEAR"}}(),getMagnificationFilter:function(){const e=new Map([["AVG_PIXEL","LINEAR"],["NEAREST_PIXEL","NEAREST"],["NICEST","LINEAR"],["FASTEST","NEAREST"]]);return function(){const t=e.get(this._magnificationFilter.getValue());return void 0!==t?t:this.getBrowser().getDefaultTextureProperties().getMagnificationFilter()}}(),getTextureCompression:function(){const e=new Map([["DEFAULT","RGBA"],["NICEST","RGBA"],["FASTEST","RGBA"],["LOW","RGBA"],["MEDIUM","RGBA"],["HIGH","RGBA"]]);return function(){const t=this.getBrowser().getContext(),n=t.getExtension("WEBGL_compressed_texture_etc"),i=n?n[e.get(this._textureCompression.getValue())]:void 0;return void 0!==i?i:t.RGBA}}()});const Du=Mu,Iu=Symbol();function Ru(){}Ru.prototype={initialize:function(){},getBackgroundTextureProperties:function(){return this[Iu]=new Du(this.getPrivateScene()),this[Iu]._boundaryModeS="CLAMP_TO_EDGE",this[Iu]._boundaryModeT="CLAMP_TO_EDGE",this[Iu]._boundaryModeR="CLAMP_TO_EDGE",this[Iu]._minificationFilter="NICEST",this[Iu]._magnificationFilter="NICEST",this[Iu].setup(),this.getBackgroundTextureProperties=function(){return this[Iu]},Object.defineProperty(this,"getBackgroundTextureProperties",{enumerable:!1}),this[Iu]}};const Vu=Ru;function Pu(e){Wr.call(this,e),this.addType(s.X3DComposedGeometryNode),this.fogCoordNode=null,this.colorNode=null,this.texCoordNode=null,this.normalNode=null,this.coordNode=null}Pu.prototype=Object.assign(Object.create(Wr.prototype),{constructor:Pu,initialize:function(){Wr.prototype.initialize.call(this),this._attrib.addInterest("set_attrib__",this),this._fogCoord.addInterest("set_fogCoord__",this),this._color.addInterest("set_color__",this),this._texCoord.addInterest("set_texCoord__",this),this._normal.addInterest("set_normal__",this),this._coord.addInterest("set_coord__",this),this.set_attrib__(),this.set_fogCoord__(),this.set_color__(),this.set_texCoord__(),this.set_normal__(),this.set_coord__()},getFogCoord:function(){return this.fogCoordNode},getColor:function(){return this.colorNode},getTexCoord:function(){return this.texCoordNode},getNormal:function(){return this.normalNode},getCoord:function(){return this.coordNode},set_attrib__:function(){const e=this.getAttrib();for(const t of e)t.removeInterest("requestRebuild",this),t._attribute_changed.removeInterest("updateVertexArrays",this);e.length=0;for(const t of this._attrib){const n=xr(s.X3DVertexAttributeNode,t);n&&e.push(n)}for(const t of e)t.addInterest("requestRebuild",this),t._attribute_changed.addInterest("updateVertexArrays",this);this.updateVertexArrays()},set_fogCoord__:function(){this.fogCoordNode&&this.fogCoordNode.removeInterest("requestRebuild",this),this.fogCoordNode=xr(s.FogCoordinate,this._fogCoord),this.fogCoordNode&&this.fogCoordNode.addInterest("requestRebuild",this)},set_color__:function(){this.colorNode&&(this.colorNode.removeInterest("requestRebuild",this),this.colorNode._transparent.removeInterest("set_transparent__",this)),this.colorNode=xr(s.X3DColorNode,this._color),this.colorNode?(this.colorNode.addInterest("requestRebuild",this),this.colorNode._transparent.addInterest("set_transparent__",this),this.set_transparent__()):this.setTransparent(!1)},set_transparent__:function(){this.setTransparent(this.colorNode.getTransparent())},set_texCoord__:function(){this.texCoordNode&&this.texCoordNode.removeInterest("requestRebuild",this),this.texCoordNode=xr(s.X3DTextureCoordinateNode,this._texCoord),this.texCoordNode&&this.texCoordNode.addInterest("requestRebuild",this),this.setTextureCoordinate(this.texCoordNode)},set_normal__:function(){this.normalNode&&this.normalNode.removeInterest("requestRebuild",this),this.normalNode=xr(s.X3DNormalNode,this._normal),this.normalNode&&this.normalNode.addInterest("requestRebuild",this)},set_coord__:function(){this.coordNode&&this.coordNode.removeInterest("requestRebuild",this),this.coordNode=xr(s.X3DCoordinateNode,this._coord),this.coordNode&&this.coordNode.addInterest("requestRebuild",this)},getPolygonIndex:function(e){return e},getTriangleIndex:function(e){return e},build:function(e,t,n,i){if(!this.coordNode||this.coordNode.isEmpty())return;t-=t%e,i-=i%n;const o=this._colorPerVertex.getValue(),r=this._normalPerVertex.getValue(),s=this.getAttrib(),a=s.length,u=this.getAttribs(),l=this.getFogCoord(),c=this.getColor(),h=this.getTexCoord(),d=this.getNormal(),p=this.getCoord(),f=this.getFogDepths(),g=this.getColors(),m=this.getMultiTexCoords(),_=this.getNormals(),y=this.getVertices();h&&h.init(m);for(let e=0;e<i;++e){const t=Math.floor(e/n),i=this.getPolygonIndex(this.getTriangleIndex(e));for(let e=0;e<a;++e)s[e].addValue(i,u[e]);l&&l.addDepth(i,f),c&&(o?c.addColor(i,g):c.addColor(t,g)),h&&h.addTexCoord(i,m),d&&(r?d.addVector(i,_):d.addVector(t,_)),p.addPoint(i,y)}this.getNormal()||this.buildNormals(e,t,i),this.setSolid(this._solid.getValue()),this.setCCW(this._ccw.getValue())},buildNormals:function(e,t,n){const i=this.createNormals(e,t),o=this.getNormals();for(let e=0;e<n;++e){const t=i[this.getTriangleIndex(e)];o.push(t.x,t.y,t.z)}},createNormals:function(e,t){const n=this.createFaceNormals(e,t);if(this._normalPerVertex.getValue()){const e=[];for(let n=0;n<t;++n){const t=this.getPolygonIndex(n);let i=e[t];i||(i=e[t]=[]),i.push(n)}return this.refineNormals(e,n,Math.PI)}return n},createFaceNormals:function(e,t){const n=!this._ccw.getValue(),i=this.coordNode,o=[];for(let r=0;r<t;r+=e){const t=this.getPolygonNormal(r,e,i);n&&t.negate();for(let n=0;n<e;++n)o.push(t)}return o},getPolygonNormal:function(){let e=new He(0,0,0),t=new He(0,0,0);return function(n,i,o){const r=new He(0,0,0);o.get1Point(this.getPolygonIndex(n),t);for(let s=0;s<i;++s){const a=e;e=t,t=a,o.get1Point(this.getPolygonIndex(n+(s+1)%i),t),r.x+=(e.y-t.y)*(e.z+t.z),r.y+=(e.z-t.z)*(e.x+t.x),r.z+=(e.x-t.x)*(e.y+t.y)}return r.normalize()}}()});const Au=Pu;function Lu(e){Au.call(this,e),this.addType(s.IndexedFaceSet),this._creaseAngle.setUnit("angle")}Lu.prototype=Object.assign(Object.create(Au.prototype),{constructor:Lu,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new P([new N(s.inputOutput,"metadata",new Bn.SFNode),new N(s.inputOnly,"set_colorIndex",new Bn.MFInt32),new N(s.inputOnly,"set_texCoordIndex",new Bn.MFInt32),new N(s.inputOnly,"set_normalIndex",new Bn.MFInt32),new N(s.inputOnly,"set_coordIndex",new Bn.MFInt32),new N(s.initializeOnly,"solid",new Bn.SFBool(!0)),new N(s.initializeOnly,"ccw",new Bn.SFBool(!0)),new N(s.initializeOnly,"convex",new Bn.SFBool(!0)),new N(s.initializeOnly,"creaseAngle",new Bn.SFFloat),new N(s.initializeOnly,"colorPerVertex",new Bn.SFBool(!0)),new N(s.initializeOnly,"normalPerVertex",new Bn.SFBool(!0)),new N(s.initializeOnly,"colorIndex",new Bn.MFInt32),new N(s.initializeOnly,"texCoordIndex",new Bn.MFInt32),new N(s.initializeOnly,"normalIndex",new Bn.MFInt32),new N(s.initializeOnly,"coordIndex",new Bn.MFInt32),new N(s.inputOutput,"attrib",new Bn.MFNode),new N(s.inputOutput,"fogCoord",new Bn.SFNode),new N(s.inputOutput,"color",new Bn.SFNode),new N(s.inputOutput,"texCoord",new Bn.SFNode),new N(s.inputOutput,"normal",new Bn.SFNode),new N(s.inputOutput,"coord",new Bn.SFNode)]),getTypeName:function(){return"IndexedFaceSet"},getComponentName:function(){return"Geometry3D"},getContainerField:function(){return"geometry"},initialize:function(){Au.prototype.initialize.call(this),this._set_colorIndex.addFieldInterest(this._colorIndex),this._set_texCoordIndex.addFieldInterest(this._texCoordIndex),this._set_normalIndex.addFieldInterest(this._normalIndex),this._set_coordIndex.addFieldInterest(this._coordIndex)},getTexCoordPerVertexIndex:function(e){return e<this._texCoordIndex.length?this._texCoordIndex[e]:this._coordIndex[e]},getColorPerVertexIndex:function(e){return e<this._colorIndex.length?this._colorIndex[e]:this._coordIndex[e]},getColorIndex:function(e){return e<this._colorIndex.length?this._colorIndex[e]:e},getNormalPerVertexIndex:function(e){return e<this._normalIndex.length?this._normalIndex[e]:this._coordIndex[e]},getNormalIndex:function(e){return e<this._normalIndex.length?this._normalIndex[e]:e},build:function(){const e=this.triangulate();if(0===e.length)return;const t=this._colorPerVertex.getValue(),n=this._normalPerVertex.getValue(),i=this._coordIndex.getValue(),o=this.getAttrib(),r=o.length,s=this.getAttribs(),a=this.getFogCoord(),u=this.getColor(),l=this.getTexCoord(),c=this.getNormal(),h=this.getCoord(),d=this.getFogDepths(),p=this.getColors(),f=this.getMultiTexCoords(),g=this.getNormals(),m=this.getVertices();l&&l.init(f);for(const _ of e){const e=_.triangles,y=_.face;for(const _ of e){const e=i[_];for(let t=0;t<r;++t)o[t].addValue(e,s[t]);a&&a.addDepth(e,d),u&&(t?u.addColor(this.getColorPerVertexIndex(_),p):u.addColor(this.getColorIndex(y),p)),l&&l.addTexCoord(this.getTexCoordPerVertexIndex(_),f),c&&(n?c.addVector(this.getNormalPerVertexIndex(_),g):c.addVector(this.getNormalIndex(y),g)),h.addPoint(e,m)}}this.getNormal()||this.buildNormals(e),this.setSolid(this._solid.getValue()),this.setCCW(this._ccw.getValue())},triangulate:function(){const e=this._convex.getValue(),t=this._coordIndex.length,n=[];if(!this.getCoord())return n;if(t&&this._coordIndex[t-1]>-1&&this._coordIndex.push(-1),t){const t=this._coordIndex.getValue(),i=this._coordIndex.length;let o=[];for(let r=0,s=0;r<i;++r){if(t[r]>-1)o.push(r);else{if(o.length)switch(o.length){case 0:case 1:case 2:o.length=0;break;case 3:n.push({vertices:o,triangles:o,face:s}),o=[];break;default:{const t=[],i={vertices:o,triangles:t,face:s};e?this.triangulateConvexPolygon(o,t):this.triangulatePolygon(o,t),t.length<3?o.length=0:(n.push(i),o=[]);break}}++s}}}return n},triangulatePolygon:function(){const e=[];return function(t,n){const i=this._coordIndex.getValue(),o=this.getCoord(),r=t.length;for(let n=0;n<r;++n){const r=t[n];let s=e[n];s||(s=e[n]=new He(0,0,0)),s.index=r,o.get1Point(i[r],s)}e.length=r,Yo.triangulatePolygon(e,n);for(let e=0,t=n.length;e<t;++e)n[e]=n[e].index}}(),triangulateConvexPolygon:function(e,t){for(let n=1,i=e.length-1;n<i;++n)t.push(e[0],e[n],e[n+1])},buildNormals:function(e){const t=this.createNormals(e),n=this.getNormals();for(const i of e)for(const e of i.triangles){const i=t[e];n.push(i.x,i.y,i.z)}},createNormals:function(){const e=[],t=[];return function(n){const i=!this._ccw.getValue(),o=this._coordIndex.getValue(),r=this.getCoord();e.length=0,t.length=0;for(const a of n){const n=a.vertices,u=n.length;switch(u){case 3:var s=r.getNormal(o[n[0]],o[n[1]],o[n[2]]);break;case 4:s=r.getQuadNormal(o[n[0]],o[n[1]],o[n[2]],o[n[3]]);break;default:s=this.getPolygonNormal(n,o,r)}for(let e=0;e<u;++e){const i=n[e],r=o[i];let s=t[r];s||(s=t[r]=[]),s.push(i)}i&&s.negate();for(let t=0;t<u;++t)e[n[t]]=s}return this.refineNormals(t,e,this._creaseAngle.getValue())}}(),getPolygonNormal:function(){let e=new He(0,0,0),t=new He(0,0,0);return function(n,i,o){const r=new He(0,0,0);o.get1Point(i[n[0]],t);for(let s=0,a=n.length;s<a;++s){const u=e;e=t,t=u,o.get1Point(i[n[(s+1)%a]],t),r.x+=(e.y-t.y)*(e.z+t.z),r.y+=(e.z-t.z)*(e.x+t.x),r.z+=(e.x-t.x)*(e.y+t.y)}return r.normalize()}}()});const Uu=Lu;function Bu(e){ji.call(this,e),this.addType(s.X3DGeometricPropertyNode)}Bu.prototype=Object.assign(Object.create(ji.prototype),{constructor:Bu});const Xu=Bu;function ku(e){Xu.call(this,e),this.addType(s.X3DCoordinateNode)}ku.prototype=Object.assign(Object.create(Xu.prototype),{constructor:ku,initialize:function(){Xu.prototype.initialize.call(this),this._point.addInterest("set_point__",this),this.set_point__()},set_point__:function(){this.point=this._point.getValue(),this.length=this._point.length},isEmpty:function(){return 0===this.length},getSize:function(){return this.length},set1Point:function(e,t){this._point[e]=t},get1Point:function(e,t){if(e<this.length){const n=this.point;return e*=3,t.set(n[e],n[e+1],n[e+2])}return t.set(0,0,0)},addPoint:function(e,t){if(e<this.length){const n=this.point;e*=3,t.push(n[e],n[e+1],n[e+2],1)}else t.push(0,0,0,1)},addPoints:function(e,t){const n=this.point;for(var i=0,o=3*this.length;i<o;i+=3)e.push(n[i],n[i+1],n[i+2],1);for(i=o,o=3*t;i<o;i+=3)e.push(0,0,0,1)},getNormal:function(){const e=new He(0,0,0),t=new He(0,0,0),n=new He(0,0,0);return function(i,o,r){const s=this.length;return i<s&&o<s&&r<s?Yo.normal(this.get1Point(i,e),this.get1Point(o,t),this.get1Point(r,n),new He(0,0,0)):new He(0,0,0)}}(),getQuadNormal:function(){const e=new He(0,0,0),t=new He(0,0,0),n=new He(0,0,0),i=new He(0,0,0);return function(o,r,s,a){const u=this.length;return o<u&&r<u&&s<u&&a<u?Yo.quadNormal(this.get1Point(o,e),this.get1Point(r,t),this.get1Point(s,n),this.get1Point(a,i),new He(0,0,0)):new He(0,0,0)}}()});const zu=ku;function ju(e){zu.call(this,e),this.addType(s.Coordinate),this._point.setUnit("length")}ju.prototype=Object.assign(Object.create(zu.prototype),{constructor:ju,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new P([new N(s.inputOutput,"metadata",new Bn.SFNode),new N(s.inputOutput,"point",new Bn.MFVec3f)]),getTypeName:function(){return"Coordinate"},getComponentName:function(){return"Rendering"},getContainerField:function(){return"coord"}});const Gu=ju;function Hu(e){Xu.call(this,e),this.addType(s.X3DTextureCoordinateNode)}Hu.prototype=Object.assign(Object.create(Xu.prototype),{constructor:Hu});const qu=Hu;function Wu(e){qu.call(this,e),this.addType(s.X3DSingleTextureCoordinateNode),this.texCoordArray=Wr.createArray()}Wu.prototype=Object.assign(Object.create(qu.prototype),{constructor:Wu,init:function(e){this.texCoordArray.length=0,e.push(this.texCoordArray)},getCount:function(){return 1},addTexCoord:function(e,t){this.addTexCoordToChannel(e,t[0])},getTextureCoordinateMapping:function(e,t=0){this._mapping.getValue()&&e.set(this._mapping.getValue(),t)},setShaderUniforms:function(e,t){for(let n=0,i=t.x3d_MaxTextures;n<i;++n)this.setShaderUniformsToChannel(e,t,n)},setShaderUniformsToChannel:function(e,t,n=0){e.uniform1i(t.x3d_TextureCoordinateGeneratorMode[n],0)}});const Yu=Wu;function Ku(e){Yu.call(this,e),this.addType(s.TextureCoordinate)}Ku.prototype=Object.assign(Object.create(Yu.prototype),{constructor:Ku,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new P([new N(s.inputOutput,"metadata",new Bn.SFNode),new N(s.inputOutput,"mapping",new Bn.SFString),new N(s.inputOutput,"point",new Bn.MFVec2f)]),getTypeName:function(){return"TextureCoordinate"},getComponentName:function(){return"Texturing"},getContainerField:function(){return"texCoord"},initialize:function(){Yu.prototype.initialize.call(this),this._point.addInterest("set_point__",this),this.set_point__()},set_point__:function(){this.point=this._point.getValue(),this.length=this._point.length},isEmpty:function(){return 0===this.length},getSize:function(){return this.length},get1Point:function(e,t){if(e>=0&&e<this.length){const n=this.point;return e*=2,t.set(n[e],n[e+1],0,1)}if(e>=0&&this.length){const n=this.point;return e%=this.length,e*=2,t.set(n[e],n[e+1],0,1)}return t.set(0,0,0,1)},addTexCoordToChannel:function(e,t){if(e>=0&&e<this.length){const n=this.point;e*=2,t.push(n[e],n[e+1],0,1)}else if(e>=0&&this.length){const n=this.point;e%=this.length,e*=2,t.push(n[e],n[e+1],0,1)}else t.push(0,0,0,1)},getTexCoord:function(e){const t=this.point,n=this.length;for(let i=0,o=0;i<n;++i,o+=2)e.push(t[o],t[o+1],0,1);return e}});const Zu=Ku;function Qu(e){Jn.call(this,e)}Qu.prototype=Object.assign(Object.create(Jn.prototype),{constructor:Qu,getTypeName:function(){return"BoxOptions"},getComponentName:function(){return"X_ITE"},getContainerField:function(){return"boxOptions"},initialize:function(){Jn.prototype.initialize.call(this)},getGeometry:function(){if(this.geometry)return this.geometry;this.geometry=new Uu(this.getExecutionContext()),this.geometry._texCoord=new Zu(this.getExecutionContext()),this.geometry._coord=new Gu(this.getExecutionContext());const e=this.geometry,t=this.geometry._texCoord.getValue(),n=this.geometry._coord.getValue();return e._texCoordIndex=new Bn.MFInt32(0,1,2,3,-1,0,1,2,3,-1,0,1,2,3,-1,0,1,2,3,-1,0,1,2,3,-1,0,1,2,3,-1),e._coordIndex=new Bn.MFInt32(0,1,2,3,-1,5,4,7,6,-1,1,5,6,2,-1,4,0,3,7,-1,4,5,1,0,-1,3,2,6,7,-1),t._point=new Bn.MFVec2f(new Bn.SFVec2f(1,1),new Bn.SFVec2f(0,1),new Bn.SFVec2f(0,0),new Bn.SFVec2f(1,0)),n._point=new Bn.MFVec3f(new Bn.SFVec3f(1,1,1),new Bn.SFVec3f(-1,1,1),new Bn.SFVec3f(-1,-1,1),new Bn.SFVec3f(1,-1,1),new Bn.SFVec3f(1,1,-1),new Bn.SFVec3f(-1,1,-1),new Bn.SFVec3f(-1,-1,-1),new Bn.SFVec3f(1,-1,-1)),t.setup(),n.setup(),e.setup(),this.geometry}});const $u=Qu;function Ju(e){Jn.call(this,e),this.addChildObjects("xDimension",new Bn.SFInt32(20),"yDimension",new Bn.SFInt32(1))}Ju.prototype=Object.assign(Object.create(Jn.prototype),{constructor:Ju,getTypeName:function(){return"ConeOptions"},getComponentName:function(){return"X_ITE"},getContainerField:function(){return"coneOptions"}});const el=Ju;function tl(e){Jn.call(this,e),this.addChildObjects("xDimension",new Bn.SFInt32(20),"yDimension",new Bn.SFInt32(1))}tl.prototype=Object.assign(Object.create(Jn.prototype),{constructor:tl,getTypeName:function(){return"CylinderOptions"},getComponentName:function(){return"X_ITE"},getContainerField:function(){return"cylinderOptions"}});const nl=tl;function il(e){Jn.call(this,e),this.addChildObjects("xDimension",new Bn.SFInt32(32),"yDimension",new Bn.SFInt32(15))}il.prototype=Object.assign(Object.create(Jn.prototype),{constructor:il,getTypeName:function(){return"QuadSphereOptions"},getComponentName:function(){return"X_ITE"},getContainerField:function(){return"quadSphereOptions"},initialize:function(){Jn.prototype.initialize.call(this),this.addInterest("eventsProcessed",this)},getGeometry:function(){return this.geometry||this.eventsProcessed(),this.geometry},createTexCoordIndex:function(){const e=this._xDimension.getValue()+1,t=this._yDimension.getValue(),n=this.geometry._texCoordIndex;for(let t=0,i=e-1;t<i;++t)n.push(t),n.push(t+e-1),n.push(t+e),n.push(-1);for(let i=e-1,o=0,r=t-3;o<r;++o,++i)for(let t=0,o=e-1;t<o;++t,++i)n.push(i),n.push(i+e),n.push(i+e+1),n.push(i+1),n.push(-1);let i=(t-2)*e-1;for(let t=0,o=e-1;t<o;++t,++i)n.push(i+e),n.push(i+1),n.push(i),n.push(-1)},createTexCoord:function(){const e=this._xDimension.getValue()+1,t=this._yDimension.getValue(),n=this.geometry._texCoord.getValue()._point,i=-.5/(e-1);for(let t=1;t<e;++t){const o=t/(e-1)+i;n.push(new ke(o,1))}for(let i=1,o=t-1;i<o;++i){const o=1-i/(t-1);for(let t=0;t<e;++t){const i=t/(e-1);n.push(new ke(i,o))}}for(let t=1;t<e;++t){const o=t/(e-1)+i;n.push(new ke(o,0))}},createCoordIndex:function(){const e=this._xDimension.getValue()+1,t=this._yDimension.getValue(),n=this.geometry._coordIndex;let i=1;for(const t=e-1;i<t;++i)n.push(0),n.push(i),n.push(i+1),n.push(-1);n.push(0),n.push(i),n.push(1),n.push(-1);let o=1;for(let i=0,r=t-3;i<r;++i,++o){for(let t=0,i=e-2;t<i;++t,++o)n.push(o),n.push(o+e-1),n.push(o+e),n.push(o+1),n.push(-1);n.push(o),n.push(o+e-1),n.push(o+1),n.push(o-e+2),n.push(-1)}const r=o+e-1;for(let t=0,i=e-2;t<i;++t,++o)n.push(r),n.push(o+1),n.push(o),n.push(-1);n.push(r),n.push(r-e+1),n.push(o),n.push(-1)},createPoints:function(){const e=this._xDimension.getValue()+1,t=this._yDimension.getValue(),n=this.geometry._coord.getValue()._point;n.push(new He(0,1,0));for(let i=1,o=t-1;i<o;++i){const t=Qr.Polar(1,-Math.PI*i/o);for(let i=0,o=e-1;i<o;++i){const e=Qr.Polar(t.imag,2*Math.PI*i/o);n.push(new He(e.imag,t.real,e.real))}}n.push(new He(0,-1,0))},eventsProcessed:function(){this.geometry=new Uu(this.getExecutionContext()),this.geometry._texCoord=new Zu(this.getExecutionContext()),this.geometry._coord=new Gu(this.getExecutionContext()),this.createTexCoordIndex(),this.createTexCoord(),this.createCoordIndex(),this.createPoints();const e=this.geometry,t=this.geometry._texCoord.getValue(),n=this.geometry._coord.getValue();e._creaseAngle=Math.PI,t.setup(),n.setup(),e.setup()}});const ol=il;function rl(){}function sl(e,t){const n=new t(this.getPrivateScene());return n.setup(),this[e]=function(){return n},Object.defineProperty(this,e,{enumerable:!1}),n}rl.prototype={initialize:function(){this.setPrimitiveQuality3D(this.getBrowserOptions().getPrimitiveQuality())},getBoxOptions:function(){return sl.call(this,"getBoxOptions",$u)},getConeOptions:function(){return sl.call(this,"getConeOptions",el)},getCylinderOptions:function(){return sl.call(this,"getCylinderOptions",nl)},getSphereOptions:function(){return sl.call(this,"getSphereOptions",ol)},setPrimitiveQuality3D:function(e){const t=this.getConeOptions(),n=this.getCylinderOptions(),i=this.getSphereOptions();switch(e){case pi.LOW:t._xDimension=16,n._xDimension=16,i._xDimension=20,i._yDimension=9;break;case pi.MEDIUM:t._xDimension=20,n._xDimension=20,i._xDimension=32,i._yDimension=15;break;case pi.HIGH:t._xDimension=32,n._xDimension=32,i._xDimension=64,i._yDimension=31}}};const al=rl;let ul=0;const ll={AUTO:ul++,OPAQUE:ul++,MASK:ul++,BLEND:ul++};function cl(e){yr.call(this,e),vr.call(this,e),this.addType(s.X3DShapeNode),this.bbox=new hr,this.bboxSize=new He(0,0,0),this.bboxCenter=new He(0,0,0)}cl.prototype=Object.assign(Object.create(yr.prototype),vr.prototype,{constructor:cl,initialize:function(){yr.prototype.initialize.call(this),vr.prototype.initialize.call(this),this._bboxSize.addInterest("set_bbox__",this),this._bboxCenter.addInterest("set_bbox__",this),this._appearance.addInterest("set_apparance__",this),this._geometry.addInterest("set_geometry__",this),this._appearance.addInterest("set_transparent__",this),this._geometry.addInterest("set_transparent__",this),this.set_apparance__(),this.set_geometry__(),this.set_transparent__()},getBBox:function(e,t){return t?this._castShadow.getValue()?e.assign(this.bbox):e.set():e.assign(this.bbox)},getBBoxSize:function(){return this.bboxSize},getBBoxCenter:function(){return this.bboxCenter},getAppearance:function(){return this.apparanceNode},getGeometry:function(){return this.geometryNode},setTransparent:function(e){this.transparent=e},getTransparent:function(){return this.transparent},set_bbox__:function(){this._bboxSize.getValue().equals(this.getDefaultBBoxSize())?this.getGeometry()?this.bbox.assign(this.getGeometry().getBBox()):this.bbox.set():this.bbox.set(this._bboxSize.getValue(),this._bboxCenter.getValue()),this.bboxSize.assign(this.bbox.size),this.bboxCenter.assign(this.bbox.center)},set_apparance__:function(){this.apparanceNode&&this.apparanceNode._transparent.removeInterest("set_transparent__",this),this.apparanceNode=xr(s.X3DAppearanceNode,this._appearance),this.apparanceNode?(this.apparanceNode._alphaMode.addInterest("set_transparent__",this),this.apparanceNode._transparent.addInterest("set_transparent__",this)):this.apparanceNode=this.getBrowser().getDefaultAppearance()},set_geometry__:function(){this.geometryNode&&(this.geometryNode._transparent.addInterest("set_transparent__",this),this.geometryNode._bbox_changed.addInterest("set_bbox__",this)),this.geometryNode=xr(s.X3DGeometryNode,this._geometry),this.geometryNode&&(this.geometryNode._transparent.addInterest("set_transparent__",this),this.geometryNode._bbox_changed.addInterest("set_bbox__",this)),this.set_bbox__()},set_transparent__:function(){this.apparanceNode.getAlphaMode()===ll.AUTO?this.transparent=this.apparanceNode.getTransparent()||this.geometryNode&&this.geometryNode.getTransparent():this.transparent=this.apparanceNode.getTransparent()},dispose:function(){vr.prototype.dispose.call(this),yr.prototype.dispose.call(this)}});const hl=cl;function dl(e,t){this.point=e.copy(),this.direction=t.copy()}dl.prototype={constructor:dl,copy:function(){const e=Object.create(dl.prototype);return e.point=this.point.copy(),e.direction=this.direction.copy(),e},assign:function(e){return this.point.assign(e.point),this.direction.assign(e.direction),this},set:function(e,t){return this.point.assign(e),this.direction.assign(t),this},setPoints:function(e,t){return this.point.assign(e),this.direction.assign(t).subtract(e).normalize(),this},multMatrixLine:function(e){return e.multMatrixVec(this.point),e.multMatrixDir(this.direction).normalize(),this},multLineMatrix:function(e){return e.multVecMatrix(this.point),e.multDirMatrix(this.direction).normalize(),this},getClosestPointToPoint:function(e,t){const n=t.assign(e).subtract(this.point).dot(this.direction);return t.assign(this.direction).multiply(n).add(this.point)},getClosestPointToLine:function(){const e=new He(0,0,0);return function(t,n){const i=this.point,o=t.point,r=this.direction,s=t.direction;let a=r.dot(s);return!(Math.abs(a)>=1)&&(e.assign(o).subtract(i),a=(e.dot(r)-a*e.dot(s))/(1-a*a),n.assign(r).multiply(a).add(i),!0)}}(),getPerpendicularVectorToPoint:function(){const e=new He(0,0,0);return function(t,n){return n.assign(this.point).subtract(t),n.subtract(e.assign(this.direction).multiply(n.dot(this.direction)))}}(),getPerpendicularVectorToLine:function(){const e=new He(0,0,0),t=new He(0,0,0);return function(n,i){const o=i;e.assign(this.point).subtract(n.point);const r=e.dot(this.direction),s=e.dot(n.direction),a=this.direction.dot(n.direction),u=a*a,l=(r-s*a)/(1-u),c=-(s-r*a)/(1-u);return t.assign(this.direction).multiply(l),o.assign(n.direction).multiply(c),o.subtract(t).add(e)}}(),intersectsTriangle:function(){const e=new He(0,0,0),t=new He(0,0,0);return function(n,i,o,r){const s=i.subtract(n),a=o.subtract(n);e.assign(this.direction).cross(a);const u=s.dot(e);if(0===u)return!1;const l=1/u;t.assign(this.point).subtract(n);const c=t.dot(e)*l;if(c<0||c>1)return!1;const h=t.cross(s),d=this.direction.dot(h)*l;return!(d<0||c+d>1)&&(r.u=c,r.v=d,r.t=1-c-d,!0)}}(),toString:function(){return this.point+", "+this.direction}},dl.Points=function(e,t){const n=Object.create(dl.prototype);return n.point=e.copy(),n.direction=He.subtract(t,e).normalize(),n};const pl=dl;function fl(e,t){this.array=e,t&&(this.compare=t)}fl.prototype={compare:function(e,t){return e<t},sort:function(e,t){t-e>1&&this.quicksort(e,t-1)},quicksort:function(e,t){let n=e,i=t;const o=this.array,r=this.compare,s=o[e+t>>>1];for(;;){for(;r(o[n],s);)++n;for(;r(s,o[i]);)--i;if(!(n<i)){n===i&&(++n,--i);break}{const e=o[n];o[n]=o[i],o[i]=e,n++,i--}}e<i&&this.quicksort(e,i),n<t&&this.quicksort(n,t)}};const gl=fl;function ml(e){hl.call(this,e),this.addType(s.Shape)}ml.prototype=Object.assign(Object.create(hl.prototype),{constructor:ml,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new P([new N(s.inputOutput,"metadata",new Bn.SFNode),new N(s.inputOutput,"visible",new Bn.SFBool(!0)),new N(s.inputOutput,"castShadow",new Bn.SFBool(!0)),new N(s.inputOutput,"bboxDisplay",new Bn.SFBool),new N(s.initializeOnly,"bboxSize",new Bn.SFVec3f(-1,-1,-1)),new N(s.initializeOnly,"bboxCenter",new Bn.SFVec3f),new N(s.inputOutput,"appearance",new Bn.SFNode),new N(s.inputOutput,"geometry",new Bn.SFNode)]),getTypeName:function(){return"Shape"},getComponentName:function(){return"Shape"},getContainerField:function(){return"children"},initialize:function(){hl.prototype.initialize.call(this),this._transformSensors_changed.addInterest("set_transformSensors__",this),this.set_transformSensors__()},getShapeKey:function(){return 0},set_geometry__:function(){hl.prototype.set_geometry__.call(this),this.getGeometry()?delete this.traverse:this.traverse=Function.prototype},set_transformSensors__:function(){this.setPickableObject(this.getTransformSensors().size)},intersectsBox:function(e,t,n){return this.getGeometry().intersectsBox(e,t,n)},traverse:function(e,t){switch(e){case sr.POINTER:this.pointer(t);break;case sr.PICKING:this.picking(t);break;case sr.COLLISION:t.addCollisionShape(this);break;case sr.SHADOW:this._castShadow.getValue()&&t.addShadowShape(this);break;case sr.DISPLAY:t.addDisplayShape(this)&&this.getAppearance().traverse(e,t)}this.getGeometry().traverse(e,t)},pointer:function(){const e=new Nt,t=new Nt,n=new pl(new He(0,0,0),new He(0,0,0)),i=[],o=new gl(i,(function(e,t){return e.point.z>t.point.z})),r=function(e,t){return e.point.z>t};return function(s){const a=this.getBrowser();if(a.getPickOnlySensors()&&1===a.getSensors().length)return;const u=this.getGeometry();if(e.assign(s.getModelViewMatrix().get()),t.assign(e).inverse(),n.assign(a.getHitRay()).multLineMatrix(t),u.intersectsLine(n,s,t,this.getAppearance(),i)){for(const t of i)e.multVecMatrix(t.point);o.sort(0,i.length);const n=ee.lowerBound(i,0,i.length,-s.getNavigationInfo().getNearValue(),r);n!==i.length&&(t.multMatrixDir(i[n].normal).normalize(),a.addHit(i[n],s.getLayer(),this,e.multRight(s.getCameraSpaceMatrix().get()))),i.length=0}}}(),picking:function(e){const t=e.getModelViewMatrix().get();if(this.getTransformSensors().size)for(const e of this.getTransformSensors())e.collect(t);const n=this.getBrowser(),i=n.getPickSensors(),o=n.getPickingHierarchy();o.push(this);for(const e of i.at(-1))e.collect(this.getGeometry(),t,o);o.pop()},depth:function(e,t,n){const i=t.clipPlanes,o=this.getBrowser().getDepthShader(i.length,!1);o.enable(e),o.setClipPlanes(e,i),e.uniformMatrix4fv(o.x3d_ProjectionMatrix,!1,n),e.uniformMatrix4fv(o.x3d_ModelViewMatrix,!1,t.modelViewMatrix),this.getGeometry().depth(e,t,o)},display:function(e,t){this.getGeometry().display(e,t)}});const _l=ml;function yl(e,t){this.point=e.copy(),this.direction=t.copy()}yl.prototype={constructor:yl,copy:function(){const e=Object.create(yl.prototype);return e.point=this.point.copy(),e.direction=this.direction.copy(),e},assign:function(e){return this.point.assign(e.point),this.direction.assign(e.direction),this},set:function(e,t){return this.point.assign(e),this.direction.assign(t),this},setPoints:function(e,t){return this.point.assign(e),this.direction.assign(t).subtract(e).normalize(),this},multMatrixLine:function(e){return e.multMatrixVec(this.point),e.multMatrixDir(this.direction).normalize(),this},multLineMatrix:function(e){return e.multVecMatrix(this.point),e.multDirMatrix(this.direction).normalize(),this},getClosestPointToPoint:function(e,t){const n=t.assign(e).subtract(this.point).dot(this.direction);return t.assign(this.direction).multiply(n).add(this.point)},getPerpendicularVectorToPoint:function(){const e=new ke(0,0);return function(t,n){return n.assign(this.point).subtract(t),n.subtract(e.assign(this.direction).multiply(n.dot(this.direction)))}}(),intersectsLine:function(){const e=new ke(0,0);return function(t,n){const i=this.point,o=t.point,r=this.direction,s=t.direction,a=r.dot(s);if(Math.abs(a)>=1)return!1;e.assign(o).subtract(i);const u=(e.dot(r)-a*e.dot(s))/(1-a*a);return n.assign(r).multiply(u).add(i),!0}}(),toString:function(){return this.point+", "+this.direction}},yl.Points=function(e,t){const n=Object.create(yl.prototype);return n.point=e.copy(),n.direction=ke.subtract(t,e).normalize(),n};const xl=yl;function wl(e){this.getExecutionContext()||Wr.call(this,e);const t=this.getBrowser().getContext();this.transformVertexArrayObject=new Gr,this.thickVertexArrayObject=new Gr,this.lineStippleBuffer=t.createBuffer(),this.trianglesBuffer=t.createBuffer(),this.setGeometryType(1),this.setPrimitiveMode(t.LINES),this.setSolid(!1)}wl.prototype=Object.assign(Object.create(Wr.prototype),{constructor:wl,updateVertexArrays:function(){Wr.prototype.updateVertexArrays.call(this),this.transformVertexArrayObject.update(),this.thickVertexArrayObject.update()},intersectsLine:function(){const e=new hr,t=new He(0,0,0),n=new He(0,0,0),i=new He(0,0,0),o=new He(0,0,0),r=new Nt,s=new He(0,0,0),a=new He(0,0,0),u=new ke(0,0),l=new ke(0,0),c=new xl(ke.Zero,ke.yAxis),h=new ke(0,0),d=new pl(He.Zero,He.zAxis),p=new pl(He.Zero,He.zAxis),f=new He(0,0,0),g=new We,m=new He(0,0,0);return function(_,y,x,w,v){const b=y.getModelViewMatrix().get(),S=y.getViewVolume().getViewport(),T=(e.assign(this.getBBox()).multRight(b).getExtents(t,n),w.getLineProperties()),E=Math.max(1.5,T&&T.getApplied()?T.getLinewidthScaleFactor()/2:1),C=y.getViewpoint().getScreenScale(t,S,i),O=x.multDirMatrix(C.multiply(E)),N=y.getViewpoint().getScreenScale(n,S,o),F=x.multDirMatrix(N.multiply(E));if(this.intersectsBBox(_,O.abs().max(F.abs()))){const e=this.getBrowser().getPointer(),t=y.getProjectionMatrix().get(),n=y.getLocalObjects(),i=this.getVertices(),o=i.length;r.assign(b).multRight(t);for(let _=0;_<o;_+=8)if(s.set(i[_+0],i[_+1],i[_+2]),a.set(i[_+4],i[_+5],i[_+6]),nr.projectPointMatrix(s,r,S,u),nr.projectPointMatrix(a,r,S,l),c.setPoints(u,l),c.getClosestPointToPoint(e,h)){const i=u.distance(l),o=u.distance(h),r=l.distance(h);if(o<=i&&r<=i&&h.distance(e)<=E){if(n.length&&this.isClipped(b.multVecMatrix(m.assign(h)),n))continue;const r=c.direction,u=g.set(r.x,r.y,-r.y,r.x).inverse().multVecMatrix(e.copy().subtract(h)),l=u.set(o/i,(u.y/E+1)/2),_=a.copy().subtract(s).normalize();nr.unProjectRay(h.x,h.y,b,t,S,d),p.setPoints(s,a).getClosestPointToLine(d,f),v.push({texCoord:l,normal:_,point:f.copy()})}}}return v.length}}(),intersectsLineWithGeometry:function(){return!1},intersectsBox:function(e,t,n){return!1},buildTexCoords:function(){const e=this.getTexCoords();if(e.getValue().length/6!=this.getVertices().length/8){const t=this.getBrowser().getContext(),n=this.getVertices().length/8;e.length=6*n,e.fill(0),e.shrinkToFit(),t.bindBuffer(t.ARRAY_BUFFER,this.lineStippleBuffer),t.bufferData(t.ARRAY_BUFFER,e.getValue(),t.DYNAMIC_DRAW),t.bindBuffer(t.ARRAY_BUFFER,this.trianglesBuffer),t.bufferData(t.ARRAY_BUFFER,new Float32Array(72*n),t.DYNAMIC_DRAW)}},updateLengthSoFar:function(){const e=new Nt,t=new st(0,0,0),n=new st(0,0,0),i=new ke(0,0),o=new ke(0,0);return function(r,s){const a=s.renderObject.getViewVolume().getViewport(),u=s.renderObject.getProjectionMatrix().get(),l=this.getTexCoords().getValue(),c=this.getVertices(),h=c.length;e.assign(s.modelViewMatrix).multRight(u);let d=0;for(let r=0,s=0;r<h;r+=8,s+=6)t.set(c[r],c[r+1],c[r+2],c[r+3]),n.set(c[r+4],c[r+5],c[r+6],c[r+7]),nr.projectPointMatrix(t,e,a,i),nr.projectPointMatrix(n,e,a,o),l[s]=o.x,l[s+1]=o.y,l[s+3]=i.x,l[s+4]=i.y,l[s+5]=d,d+=o.subtract(i).magnitude();r.bindBuffer(r.ARRAY_BUFFER,this.lineStippleBuffer),r.bufferData(r.ARRAY_BUFFER,l,r.DYNAMIC_DRAW)}}(),display:function(){const e=new Nt,t=new Float32Array(16),n=new Float32Array(16);return function(i,o){const r=this.getBrowser(),s=o.appearanceNode,a=s.getLineProperties(),u=s.getShader(this,o),l=s.getBlendMode(),c=this.getAttrib(),h=this.getAttribBuffers();if(a&&(a.getApplied()&&1!==a.getLinetype()&&this.updateLengthSoFar(i,o),a.getTransformLines())){const s=o.renderObject,c=s.getViewVolume().getViewport(),h=s.getProjectionMatrix().get(),d=r.getPrimitiveMode(i.TRIANGLES),p=r.getLineTransformShader();if(t.set(e.assign(o.modelViewMatrix).multRight(h)),n.set(e.inverse()),p.enable(i),i.uniform4f(p.viewport,c.x,c.y,c.z,c.w),i.uniformMatrix4fv(p.modelViewProjectionMatrix,!1,t),i.uniformMatrix4fv(p.invModelViewProjectionMatrix,!1,n),i.uniform1f(p.scale,a.getLinewidthScaleFactor()/2),this.transformVertexArrayObject.enable(i,u)){const e=6*Float32Array.BYTES_PER_ELEMENT,t=0,n=3*Float32Array.BYTES_PER_ELEMENT,o=2*Float32Array.BYTES_PER_ELEMENT,r=0,s=1*Float32Array.BYTES_PER_ELEMENT,a=8*Float32Array.BYTES_PER_ELEMENT,u=0,l=4*Float32Array.BYTES_PER_ELEMENT,c=8*Float32Array.BYTES_PER_ELEMENT,h=0,d=4*Float32Array.BYTES_PER_ELEMENT;p.enableFloatAttrib(i,"x3d_LineStipple0",this.lineStippleBuffer,3,e,t),p.enableFloatAttrib(i,"x3d_LineStipple1",this.lineStippleBuffer,3,e,n),this.hasFogCoords&&(p.enableFloatAttrib(i,"x3d_FogDepth0",this.fogDepthBuffer,1,o,r),p.enableFloatAttrib(i,"x3d_FogDepth1",this.fogDepthBuffer,1,o,s)),this.colorMaterial&&(p.enableFloatAttrib(i,"x3d_Color0",this.colorBuffer,4,a,u),p.enableFloatAttrib(i,"x3d_Color1",this.colorBuffer,4,a,l)),p.enableFloatAttrib(i,"x3d_Vertex0",this.vertexBuffer,4,c,h),p.enableFloatAttrib(i,"x3d_Vertex1",this.vertexBuffer,4,c,d)}if(i.bindTransformFeedback(i.TRANSFORM_FEEDBACK,r.getLineTransformFeedback()),i.bindBufferBase(i.TRANSFORM_FEEDBACK_BUFFER,0,this.trianglesBuffer),i.enable(i.RASTERIZER_DISCARD),i.beginTransformFeedback(i.POINTS),i.drawArraysInstanced(i.POINTS,0,this.vertexCount/2,2),i.endTransformFeedback(),i.disable(i.RASTERIZER_DISCARD),i.bindTransformFeedback(i.TRANSFORM_FEEDBACK,null),l&&l.enable(i),u.enable(i),u.setUniforms(i,this,o),this.thickVertexArrayObject.enable(i,u)){const e=12*Float32Array.BYTES_PER_ELEMENT,t=0,n=3*Float32Array.BYTES_PER_ELEMENT,o=4*Float32Array.BYTES_PER_ELEMENT,r=8*Float32Array.BYTES_PER_ELEMENT;u.enableLineStippleAttribute(i,this.trianglesBuffer,e,t),this.hasFogCoords&&u.enableFogDepthAttribute(i,this.trianglesBuffer,e,n),this.colorMaterial&&u.enableColorAttribute(i,this.trianglesBuffer,e,o),u.enableVertexAttribute(i,this.trianglesBuffer,e,r),i.bindBuffer(i.ARRAY_BUFFER,null)}if(r.getWireframe())for(let e=0,t=3*this.vertexCount;e<t;e+=3)i.drawArrays(d,e,3);else i.frontFace(i.CCW),i.enable(i.CULL_FACE),i.drawArrays(d,0,3*this.vertexCount);return void(l&&l.disable(i))}const d=r.getPrimitiveMode(this.getPrimitiveMode());if(l&&l.enable(i),u.enable(i),u.setUniforms(i,this,o),this.vertexArrayObject.enable(i,u)){for(let e=0,t=c.length;e<t;++e)c[e].enable(i,u,h[e]);u.enableLineStippleAttribute(i,this.lineStippleBuffer,0,0),this.hasFogCoords&&u.enableFogDepthAttribute(i,this.fogDepthBuffer,0,0),this.colorMaterial&&u.enableColorAttribute(i,this.colorBuffer,0,0),u.enableVertexAttribute(i,this.vertexBuffer,0,0)}i.drawArrays(d,0,this.vertexCount),l&&l.disable(i),i.lineWidth(1)}}(),displayParticles:function(e,t,n){const i=this.getBrowser(),o=t.appearanceNode,r=o.getShader(this,t),s=o.getBlendMode(),a=this.getAttrib(),u=this.getAttribBuffers(),l=i.getPrimitiveMode(this.getPrimitiveMode());s&&s.enable(e),r.enable(e),r.setUniforms(e,this,t);const c=n.outputParticles;if(c.vertexArrayObject.update(this.updateParticles).enable(e,r)){const t=n.particleStride;r.enableParticleAttribute(e,c,t,n.particleOffset,1),r.enableParticleMatrixAttribute(e,c,t,n.matrixOffset,1);for(let t=0,n=a.length;t<n;++t)a[t].enable(e,r,u[t]);this.hasFogCoords&&r.enableFogDepthAttribute(e,this.fogDepthBuffer,0,0),this.colorMaterial&&r.enableColorAttribute(e,this.colorBuffer,0,0),r.enableTexCoordAttribute(e,this.texCoordBuffers,0,0),r.enableVertexAttribute(e,this.vertexBuffer,0,0),this.updateParticles=!1}e.drawArraysInstanced(l,0,this.vertexCount,n.numParticles),s&&s.disable(e),e.lineWidth(1)}});const vl=wl;function bl(e){vl.call(this,e),this.addType(s.IndexedLineSet),this.fogCoordNode=null,this.colorNode=null,this.normalNode=null,this.coordNode=null}bl.prototype=Object.assign(Object.create(vl.prototype),{constructor:bl,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new P([new N(s.inputOutput,"metadata",new Bn.SFNode),new N(s.inputOnly,"set_colorIndex",new Bn.MFInt32),new N(s.inputOnly,"set_coordIndex",new Bn.MFInt32),new N(s.initializeOnly,"colorPerVertex",new Bn.SFBool(!0)),new N(s.initializeOnly,"colorIndex",new Bn.MFInt32),new N(s.initializeOnly,"coordIndex",new Bn.MFInt32),new N(s.inputOutput,"attrib",new Bn.MFNode),new N(s.inputOutput,"fogCoord",new Bn.SFNode),new N(s.inputOutput,"color",new Bn.SFNode),new N(s.inputOutput,"normal",new Bn.SFNode),new N(s.inputOutput,"coord",new Bn.SFNode)]),getTypeName:function(){return"IndexedLineSet"},getComponentName:function(){return"Rendering"},getContainerField:function(){return"geometry"},initialize:function(){vl.prototype.initialize.call(this),this._set_colorIndex.addFieldInterest(this._colorIndex),this._set_coordIndex.addFieldInterest(this._coordIndex),this._attrib.addInterest("set_attrib__",this),this._fogCoord.addInterest("set_fogCoord__",this),this._color.addInterest("set_color__",this),this._normal.addInterest("set_normal__",this),this._coord.addInterest("set_coord__",this),this.set_attrib__(),this.set_fogCoord__(),this.set_color__(),this.set_normal__(),this.set_coord__()},set_attrib__:function(){const e=this.getAttrib();for(const t of e)t.removeInterest("requestRebuild",this),t._attribute_changed.removeInterest("updateVertexArrays",this);e.length=0;for(const t of this._attrib){const n=xr(s.X3DVertexAttributeNode,t);n&&e.push(n)}for(const t of e)t.addInterest("requestRebuild",this),t._attribute_changed.addInterest("updateVertexArrays",this);this.updateVertexArrays()},set_fogCoord__:function(){this.fogCoordNode&&this.fogCoordNode.removeInterest("requestRebuild",this),this.fogCoordNode=xr(s.FogCoordinate,this._fogCoord),this.fogCoordNode&&this.fogCoordNode.addInterest("requestRebuild",this)},set_color__:function(){this.colorNode&&(this.colorNode.removeInterest("requestRebuild",this),this.colorNode._transparent.removeInterest("set_transparent__",this)),this.colorNode=xr(s.X3DColorNode,this._color),this.colorNode?(this.colorNode.addInterest("requestRebuild",this),this.colorNode._transparent.addInterest("set_transparent__",this),this.set_transparent__()):this.setTransparent(!1)},set_transparent__:function(){this.setTransparent(this.colorNode.getTransparent())},set_normal__:function(){this.normalNode&&this.normalNode.removeInterest("requestRebuild",this),this.normalNode=xr(s.X3DNormalNode,this._normal),this.normalNode&&this.normalNode.addInterest("requestRebuild",this)},set_coord__:function(){this.coordNode&&this.coordNode.removeInterest("requestRebuild",this),this.coordNode=xr(s.X3DCoordinateNode,this._coord),this.coordNode&&this.coordNode.addInterest("requestRebuild",this)},getColorPerVertexIndex:function(e){return e<this._colorIndex.length?this._colorIndex[e]:this._coordIndex[e]},getColorIndex:function(e){return e<this._colorIndex.length?this._colorIndex[e]:e},getPolylineIndices:function(){const e=this._coordIndex,t=[];let n=[];if(e.length){for(let i=0,o=e.length;i<o;++i){e[i]>=0?n.push(i):(t.push(n),n=[])}e[e.length-1]>=0&&t.push(n)}return t},build:function(){if(!this.coordNode||this.coordNode.isEmpty())return;const e=this._coordIndex,t=this.getPolylineIndices(),n=this._colorPerVertex.getValue(),i=this.getAttrib(),o=i.length,r=this.getAttribs(),s=this.fogCoordNode,a=this.colorNode,u=this.coordNode,l=this.getFogDepths(),c=this.getColors(),h=this.getVertices();let d=0;for(const p of t){if(p.length>1)for(let t=0,f=p.length-1;t<f;++t)for(let f=t,g=t+2;f<g;++f){const t=p[f],g=e[t];for(let e=0;e<o;++e)i[e].addValue(g,r[e]);s&&s.addDepth(g,l),a&&(n?a.addColor(this.getColorPerVertexIndex(t),c):a.addColor(this.getColorIndex(d),c)),u.addPoint(g,h)}++d}}});const Sl=bl;function Tl(e){Xu.call(this,e),this.addType(s.X3DColorNode),this.addChildObjects("transparent",new Bn.SFBool),this._transparent.setAccessType(s.outputOnly)}Tl.prototype=Object.assign(Object.create(Xu.prototype),{constructor:Tl,setTransparent:function(e){e!==this._transparent.getValue()&&(this._transparent=e)},getTransparent:function(){return this._transparent.getValue()}});const El=Tl;function Cl(e){El.call(this,e),this.addType(s.Color)}Cl.prototype=Object.assign(Object.create(El.prototype),{constructor:Cl,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new P([new N(s.inputOutput,"metadata",new Bn.SFNode),new N(s.inputOutput,"color",new Bn.MFColor)]),getTypeName:function(){return"Color"},getComponentName:function(){return"Rendering"},getContainerField:function(){return"color"},initialize:function(){El.prototype.initialize.call(this),this._color.addInterest("set_color__",this),this.set_color__()},set_color__:function(){this.color=this._color.getValue(),this.length=this._color.length},addColor:function(e,t){if(e>=0&&e<this.length){const n=this.color;e*=3,t.push(n[e],n[e+1],n[e+2],1)}else if(this.length){const n=this.color;e=3*(this.length-1),t.push(n[e],n[e+1],n[e+2],1)}else t.push(1,1,1,1)},addColors:function(e,t){if(this.length){const o=this.color;for(var n=0,i=3*Math.min(t,this.length);n<i;n+=3)e.push(o[n],o[n+1],o[n+2],1);if(this.length<t){const r=o[n=3*(this.length-1)],s=o[n+1],a=o[n+2];for(n=i,i=3*t;n<i;n+=3)e.push(r,s,a,1)}}else for(let n=0;n<t;++n)e.push(1,1,1,1);return e}});const Ol=Cl,Nl=Symbol();function Fl(){}Fl.prototype={initialize:function(){},getBBoxNode:function(){const e=new _l(this.getPrivateScene()),t=new Sl(this.getPrivateScene()),n=new Ol(this.getPrivateScene()),i=new Gu(this.getPrivateScene());return e._geometry=t,t._coordIndex=new Bn.MFFloat(0,1,2,3,0,-1,4,5,6,7,4,-1,0,4,-1,1,5,-1,2,6,-1,3,7,-1),t._color=n,t._coord=i,n._color=new Bn.MFColor(new Bn.SFColor(1,1,1)),i._point=new Bn.MFVec3f(new Bn.SFVec3f(.5,.5,.5),new Bn.SFVec3f(-.5,.5,.5),new Bn.SFVec3f(-.5,-.5,.5),new Bn.SFVec3f(.5,-.5,.5),new Bn.SFVec3f(.5,.5,-.5),new Bn.SFVec3f(-.5,.5,-.5),new Bn.SFVec3f(-.5,-.5,-.5),new Bn.SFVec3f(.5,-.5,-.5)),i.setup(),n.setup(),t.setup(),e.setup(),this[Nl]=e,this.getBBoxNode=function(){return this[Nl]},Object.defineProperty(this,"getBBoxNode",{enumerable:!1}),e}};const Ml=Fl,Dl=Ar(nr);function Il(e){Cr.call(this,e),this.addType(s.Viewport),this.rectangle=new st(0,0,0,0)}Il.prototype=Object.assign(Object.create(Cr.prototype),{constructor:Il,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new P([new N(s.inputOutput,"metadata",new Bn.SFNode),new N(s.inputOutput,"clipBoundary",new Bn.MFFloat(0,1,0,1)),new N(s.inputOutput,"visible",new Bn.SFBool(!0)),new N(s.inputOutput,"bboxDisplay",new Bn.SFBool),new N(s.initializeOnly,"bboxSize",new Bn.SFVec3f(-1,-1,-1)),new N(s.initializeOnly,"bboxCenter",new Bn.SFVec3f),new N(s.inputOnly,"addChildren",new Bn.MFNode),new N(s.inputOnly,"removeChildren",new Bn.MFNode),new N(s.inputOutput,"children",new Bn.MFNode)]),getTypeName:function(){return"Viewport"},getComponentName:function(){return"Layering"},getContainerField:function(){return"viewport"},getRectangle:function(e){const t=e.getViewport(),n=Math.floor(t[2]*this.getLeft()),i=Math.floor(t[2]*this.getRight()),o=Math.floor(t[3]*this.getBottom()),r=Math.floor(t[3]*this.getTop());return this.rectangle.set(n,o,Math.max(0,i-n),Math.max(0,r-o)),this.rectangle},getLeft:function(){return this._clipBoundary.length>0?this._clipBoundary[0]:0},getRight:function(){return this._clipBoundary.length>1?this._clipBoundary[1]:1},getBottom:function(){return this._clipBoundary.length>2?this._clipBoundary[2]:0},getTop:function(){return this._clipBoundary.length>3?this._clipBoundary[3]:1},traverse:function(e,t){if(this.push(t),e===sr.POINTER)this.getBrowser().isPointerInRectangle(this.rectangle)&&Cr.prototype.traverse.call(this,e,t);else Cr.prototype.traverse.call(this,e,t);this.pop(t)},push:function(e){const t=e.getViewVolumes(),n=this.getRectangle(this.getBrowser()),i=t.length?t.at(-1).getViewport():n,o=Dl.pop();o.set(e.getProjectionMatrix().get(),i,n),t.push(o)},pop:function(e){Dl.push(e.getViewVolumes().pop())}});const Rl=Il,Vl=Symbol();function Pl(){this[Vl]=new Rl(this.getPrivateScene())}Pl.prototype={initialize:function(){this[Vl].setPrivate(!0),this[Vl].setup()},getDefaultViewport:function(){return this[Vl]}};const Al=Pl,Ll=Symbol(),Ul=Symbol();function Bl(){const e=this.getContext(),t=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS);this[Ll]=t>8?8:2,this[Ul]=[]}Bl.prototype={initialize:function(){},getMaxLights:function(){return this[Ll]},popShadowBuffer:function(e){try{const t=this[Ul][e];if(t){if(t.length)return t.pop()}else this[Ul][e]=[];return new or(this,e,e)}catch(e){return console.error(e),null}},pushShadowBuffer:function(e){e&&this[Ul][e.getWidth()].push(e)}};const Xl=Bl;function kl(e){Ps.call(this,e),this.addType(s.OrthoViewpoint),this.addChildObjects("fieldOfViewOffset",new Bn.MFFloat(0,0,0,0)),this._position.setUnit("length"),this._centerOfRotation.setUnit("length"),this._fieldOfView.setUnit("length"),this.projectionMatrix=new Nt,this.fieldOfViewOffsetInterpolator0=new Ls(this.getBrowser().getPrivateScene()),this.fieldOfViewOffsetInterpolator1=new Ls(this.getBrowser().getPrivateScene()),this.fieldOfViewOffsetInterpolator2=new Ls(this.getBrowser().getPrivateScene()),this.fieldOfViewOffsetInterpolator3=new Ls(this.getBrowser().getPrivateScene()),this.fieldOfViewScaleInterpolator=new Ls(this.getBrowser().getPrivateScene())}kl.prototype=Object.assign(Object.create(Ps.prototype),{constructor:kl,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new P([new N(s.inputOutput,"metadata",new Bn.SFNode),new N(s.inputOnly,"set_bind",new Bn.SFBool),new N(s.inputOutput,"description",new Bn.SFString),new N(s.inputOutput,"position",new Bn.SFVec3f(0,0,10)),new N(s.inputOutput,"orientation",new Bn.SFRotation),new N(s.inputOutput,"centerOfRotation",new Bn.SFVec3f),new N(s.inputOutput,"fieldOfView",new Bn.MFFloat(-1,-1,1,1)),new N(s.inputOutput,"jump",new Bn.SFBool(!0)),new N(s.inputOutput,"retainUserOffsets",new Bn.SFBool),new N(s.outputOnly,"isBound",new Bn.SFBool),new N(s.outputOnly,"bindTime",new Bn.SFTime)]),getTypeName:function(){return"OrthoViewpoint"},getComponentName:function(){return"Navigation"},getContainerField:function(){return"children"},initialize:function(){Ps.prototype.initialize.call(this),this._fieldOfView.addInterest("set_fieldOfView__",this),this._fieldOfViewOffset.addInterest("set_fieldOfView__",this),this._fieldOfViewScale.addInterest("set_fieldOfView__",this),this.fieldOfViewOffsetInterpolator0._key=new Bn.MFFloat(0,1),this.fieldOfViewOffsetInterpolator1._key=new Bn.MFFloat(0,1),this.fieldOfViewOffsetInterpolator2._key=new Bn.MFFloat(0,1),this.fieldOfViewOffsetInterpolator3._key=new Bn.MFFloat(0,1),this.fieldOfViewScaleInterpolator._key=new Bn.MFFloat(0,1),this.fieldOfViewOffsetInterpolator0.setup(),this.fieldOfViewOffsetInterpolator1.setup(),this.fieldOfViewOffsetInterpolator2.setup(),this.fieldOfViewOffsetInterpolator3.setup(),this.fieldOfViewScaleInterpolator.setup(),this.getEaseInEaseOut()._modifiedFraction_changed.addFieldInterest(this.fieldOfViewOffsetInterpolator0._set_fraction),this.getEaseInEaseOut()._modifiedFraction_changed.addFieldInterest(this.fieldOfViewOffsetInterpolator1._set_fraction),this.getEaseInEaseOut()._modifiedFraction_changed.addFieldInterest(this.fieldOfViewOffsetInterpolator2._set_fraction),this.getEaseInEaseOut()._modifiedFraction_changed.addFieldInterest(this.fieldOfViewOffsetInterpolator3._set_fraction),this.getEaseInEaseOut()._modifiedFraction_changed.addFieldInterest(this.fieldOfViewScaleInterpolator._set_fraction),this.fieldOfViewOffsetInterpolator0._value_changed.addInterest("set_fieldOfViewOffset__",this),this.fieldOfViewOffsetInterpolator1._value_changed.addInterest("set_fieldOfViewOffset__",this),this.fieldOfViewOffsetInterpolator2._value_changed.addInterest("set_fieldOfViewOffset__",this),this.fieldOfViewOffsetInterpolator3._value_changed.addInterest("set_fieldOfViewOffset__",this),this.fieldOfViewScaleInterpolator._value_changed.addFieldInterest(this._fieldOfViewScale),this.set_fieldOfView__()},set_fieldOfView__:function(){const e=this._fieldOfView.length,t=this._fieldOfViewScale.getValue();this.minimumX=((e>0?this._fieldOfView[0]:-1)+this._fieldOfViewOffset[0])*t,this.minimumY=((e>1?this._fieldOfView[1]:-1)+this._fieldOfViewOffset[1])*t,this.maximumX=((e>2?this._fieldOfView[2]:1)+this._fieldOfViewOffset[2])*t,this.maximumY=((e>3?this._fieldOfView[3]:1)+this._fieldOfViewOffset[3])*t,this.sizeX=this.maximumX-this.minimumX,this.sizeY=this.maximumY-this.minimumY},set_fieldOfViewOffset__:function(){this._fieldOfViewOffset[0]=this.fieldOfViewOffsetInterpolator0._value_changed.getValue(),this._fieldOfViewOffset[1]=this.fieldOfViewOffsetInterpolator1._value_changed.getValue(),this._fieldOfViewOffset[2]=this.fieldOfViewOffsetInterpolator2._value_changed.getValue(),this._fieldOfViewOffset[3]=this.fieldOfViewOffsetInterpolator3._value_changed.getValue()},setInterpolators:function(e,t){if(e.getType().includes(s.OrthoViewpoint)){const n=t._fieldOfView.length,i=e._fieldOfView.length,o=(i>0?e._fieldOfView[0]:-1)-(n>0?t._fieldOfView[0]:-1),r=(i>1?e._fieldOfView[1]:-1)-(n>1?t._fieldOfView[1]:-1),s=(i>2?e._fieldOfView[2]:1)-(n>2?t._fieldOfView[2]:1),a=(i>3?e._fieldOfView[3]:1)-(n>3?t._fieldOfView[3]:1);this.fieldOfViewOffsetInterpolator0._keyValue=new Bn.MFFloat(o,t._fieldOfViewOffset[0]),this.fieldOfViewOffsetInterpolator1._keyValue=new Bn.MFFloat(r,t._fieldOfViewOffset[1]),this.fieldOfViewOffsetInterpolator2._keyValue=new Bn.MFFloat(s,t._fieldOfViewOffset[2]),this.fieldOfViewOffsetInterpolator3._keyValue=new Bn.MFFloat(a,t._fieldOfViewOffset[3]),this.fieldOfViewScaleInterpolator._keyValue=new Bn.MFFloat(e._fieldOfViewScale.getValue(),t._fieldOfViewScale.getValue()),this._fieldOfViewOffset[0]=o,this._fieldOfViewOffset[1]=r,this._fieldOfViewOffset[2]=s,this._fieldOfViewOffset[3]=a,this._fieldOfViewScale=e._fieldOfViewScale.getValue()}else this.fieldOfViewOffsetInterpolator0._keyValue=new Bn.MFFloat(t._fieldOfViewOffset[0],t._fieldOfViewOffset[0]),this.fieldOfViewOffsetInterpolator1._keyValue=new Bn.MFFloat(t._fieldOfViewOffset[1],t._fieldOfViewOffset[1]),this.fieldOfViewOffsetInterpolator2._keyValue=new Bn.MFFloat(t._fieldOfViewOffset[2],t._fieldOfViewOffset[2]),this.fieldOfViewOffsetInterpolator3._keyValue=new Bn.MFFloat(t._fieldOfViewOffset[3],t._fieldOfViewOffset[3]),this.fieldOfViewScaleInterpolator._keyValue=new Bn.MFFloat(t._fieldOfViewScale.getValue(),t._fieldOfViewScale.getValue()),this._fieldOfViewOffset=t._fieldOfViewOffset.getValue(),this._fieldOfViewScale=t._fieldOfViewScale.getValue()},getLogarithmicDepthBuffer:function(){return!1},getMinimumX:function(){return this.minimumX},getMinimumY:function(){return this.minimumY},getMaximumX:function(){return this.maximumX},getMaximumY:function(){return this.maximumY},getSizeX:function(){return this.sizeX},getSizeY:function(){return this.sizeY},getMaxFarValue:function(){return 1e5},getScreenScale:function(e,t,n){const i=t[2],o=t[3],r=this.sizeX,s=this.sizeY;if(i/o>r/s){const e=s/o;return n.set(e,e,e)}{const e=r/i;return n.set(e,e,e)}},getViewportSize:function(){const e=new ke(0,0);return function(t,n){const i=t[2],o=t[3],r=this.sizeX,s=this.sizeY,a=i/o;return a>r/s?e.set(s*a,s):e.set(r,r/a)}}(),getLookAtDistance:function(e){return e.size.magnitude()/2+10},getProjectionMatrixWithLimits:function(e,t,n){const i=n[2]/n[3],o=this.sizeX,r=this.sizeY;if(i>o/r){const n=(this.minimumX+this.maximumX)/2,o=r*i/2;return lr.ortho(n-o,n+o,this.minimumY,this.maximumY,e,t,this.projectionMatrix)}{const n=(this.minimumY+this.maximumY)/2,r=o/i/2;return lr.ortho(this.minimumX,this.maximumX,n-r,n+r,e,t,this.projectionMatrix)}}});const zl=kl;function jl(e){Jn.call(this,e)}jl.prototype=Object.assign(Object.create(Jn.prototype),{constructor:jl,getTypeName:function(){return"X3DViewer"},initialize:function(){},getActiveLayer:function(){return this.getBrowser().getActiveLayer()},getViewport:function(){return this.getBrowser().getActiveLayer().getViewport()},getNavigationInfo:function(){return this.getBrowser().getActiveLayer().getNavigationInfo()},getActiveViewpoint:function(){return this.getBrowser().getActiveLayer().getViewpoint()},getStraightenHorizon:function(){return this.getBrowser().getBrowserOption("StraightenHorizon")},getButton:function(e){return 0===e&&this.getBrowser().getAltKey()?1:e},getPointOnCenterPlane:function(){const e=new He(0,0,-1),t=new He(0,0,0),n=new He(0,0,0);return function(i,o,r){const s=this.getNavigationInfo(),a=this.getActiveViewpoint(),u=this.getViewport().getRectangle(this.getBrowser()),l=a.getProjectionMatrixWithLimits(s.getNearValue(),s.getFarValue(a),u);if(nr.unProjectPoint(i,this.getBrowser().getViewport()[3]-o,.9,Nt.Identity,l,u,n),a instanceof zl)return r.set(n.x,n.y,-this.getDistanceToCenter(t).magnitude());const c=n.normalize();return r.assign(c).multiply(this.getDistanceToCenter(t).magnitude()/c.dot(e))}}(),getDistanceToCenter:function(e,t){const n=this.getActiveViewpoint();return e.assign(n.getPosition()).add(t||n._positionOffset.getValue()).subtract(n.getUserCenterOfRotation())},trackballProjectToSphere:function(e,t,n){const i=this.getViewport().getRectangle(this.getBrowser());return t=this.getBrowser().getViewport()[3]-t,e=(e-i[0])/i[2]-.5,t=(t-i[1])/i[3]-.5,n.set(e,t,function(e,t,n){const i=Math.hypot(t,n);if(i<e*Math.sqrt(.5))return Math.sqrt(e*e-i*i);const o=e/Math.sqrt(2);return o*o/i}(.5,e,t))},lookAtPoint:function(e,t,n){if(!this.touch(e,t))return;const i=this.getBrowser().getNearestHit();this.getActiveViewpoint().lookAtPoint(this.getActiveLayer(),i.intersection.point,.381966,n)},lookAtBBox:function(){const e=new hr;return function(t,n,i){if(!this.touch(t,n))return;const o=this.getBrowser().getNearestHit();o.shape.getBBox(e).multRight(o.modelViewMatrix),this.getActiveViewpoint().lookAtBBox(this.getActiveLayer(),e,.381966,i)}}(),touch:function(e,t){return this.getBrowser().touch(e,t,!1),this.getBrowser().getHits().length},dispose:function(){}});const Gl=jl;function Hl(e){yr.call(this,e),this.addType(s.X3DFollowerNode),this.buffer=[],this.a=this.getVector(),this.vector=this.getVector()}Hl.prototype=Object.assign(Object.create(yr.prototype),{constructor:Hl,initialize:function(){yr.prototype.initialize.call(this),this.isLive().addInterest("set_live__",this)},getBuffer:function(){return this.buffer},getValue:function(){return this._set_value.getValue()},getDestination:function(){return this._set_destination.getValue()},getInitialValue:function(){return this._initialValue.getValue()},getInitialDestination:function(){return this._initialDestination.getValue()},setValue:function(e){this._value_changed=e},setDestination:function(e){this.destination.assign(e)},duplicate:function(e){return e.copy()},assign:function(e,t,n){e[t].assign(n)},equals:function(e,t,n){return this.a.assign(e).subtract(t).magnitude()<n},interpolate:function(e,t,n){return this.vector.assign(e).lerp(t,n)},set_live__:function(){(this.isLive().getValue()||this.isPrivate())&&this._isActive.getValue()?(this.getBrowser().prepareEvents().addInterest("prepareEvents",this),this.getBrowser().addBrowserEvent()):this.getBrowser().prepareEvents().removeInterest("prepareEvents",this)},set_active:function(e){e!==this._isActive.getValue()&&(this._isActive=e,this.set_live__())}});const ql=Hl;function Wl(e){ql.call(this,e),this.addType(s.X3DChaserNode),this.destination=null,this.previousValue=null,this.bufferEndTime=0,this.stepTime=0,this.deltaOut=this.getVector()}Wl.prototype=Object.assign(Object.create(ql.prototype),{constructor:Wl,initialize:function(){ql.prototype.initialize.call(this),this._set_value.addInterest("set_value__",this),this._set_destination.addInterest("set_destination__",this),this._duration.addInterest("set_duration__",this),this.set_duration__();var e=this.getBuffer(),t=this.getInitialValue(),n=this.getInitialDestination(),i=this.getNumBuffers();this.bufferEndTime=this.getBrowser().getCurrentTime(),this.previousValue=this.duplicate(t),e[0]=this.duplicate(n);for(var o=1;o<i;++o)e[o]=this.duplicate(t);this.destination=this.duplicate(n),this.equals(n,t,this.getTolerance())?this.setValue(n):this.set_active(!0)},getNumBuffers:function(){return 60},getTolerance:function(){return 1e-8},getArray:function(){return this.getVector()},setPreviousValue:function(e){this.previousValue.assign(e)},step:function(e,t,n){this.output.add(this.deltaOut.assign(e).subtract(t).multiply(n))},stepResponse:function(e){if(e<=0)return 0;var t=this._duration.getValue();return e>=t?1:.5-.5*Math.cos(e/t*Math.PI)},set_value__:function(){this._isActive.getValue()||(this.bufferEndTime=this.getBrowser().getCurrentTime());for(var e=this.getBuffer(),t=this.getValue(),n=0,i=e.length;n<i;++n)this.assign(e,n,t);this.setPreviousValue(t),this.setValue(t),this.set_active(!0)},set_destination__:function(){this.setDestination(this.getDestination()),this._isActive.getValue()||(this.bufferEndTime=this.getBrowser().getCurrentTime()),this.set_active(!0)},set_duration__:function(){this.stepTime=this._duration.getValue()/this.getNumBuffers()},prepareEvents:function(){var e=this.getBuffer(),t=e.length,n=this.updateBuffer();this.output=this.interpolate(this.previousValue,e[t-1],this.stepResponse((t-1+n)*this.stepTime));for(var i=t-2;i>=0;--i)this.step(e[i],e[i+1],this.stepResponse((i+n)*this.stepTime));this.setValue(this.output),this.equals(this.output,this.destination,this.getTolerance())&&this.set_active(!1)},updateBuffer:function(){var e=this.getBuffer(),t=e.length,n=(this.getBrowser().getCurrentTime()-this.bufferEndTime)/this.stepTime;if(n>=1){var i=Math.floor(n);if(n-=i,i<t){this.setPreviousValue(e[t-i]);for(var o=t-1;o>=i;--o)this.assign(e,o,e[o-i]);for(o=0;o<i;++o){var r=o/i;this.assign(e,o,this.interpolate(this.destination,e[i],r))}}else{this.setPreviousValue(i==t?e[0]:this.destination);for(o=0;o<t;++o)this.assign(e,o,this.destination)}this.bufferEndTime+=i*this.stepTime}return n}});const Yl=Wl;function Kl(e){Yl.call(this,e),this.addType(s.PositionChaser)}Kl.prototype=Object.assign(Object.create(Yl.prototype),{constructor:Kl,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new P([new N(s.inputOutput,"metadata",new Bn.SFNode),new N(s.inputOnly,"set_value",new Bn.SFVec3f),new N(s.inputOnly,"set_destination",new Bn.SFVec3f),new N(s.initializeOnly,"initialValue",new Bn.SFVec3f),new N(s.initializeOnly,"initialDestination",new Bn.SFVec3f),new N(s.initializeOnly,"duration",new Bn.SFTime(1)),new N(s.outputOnly,"isActive",new Bn.SFBool),new N(s.outputOnly,"value_changed",new Bn.SFVec3f)]),getTypeName:function(){return"PositionChaser"},getComponentName:function(){return"Followers"},getContainerField:function(){return"children"},getVector:function(){return new He(0,0,0)}});const Zl=Kl;var Ql=new Et(0,0,1,0),$l=new Et(0,0,1,0);function Jl(e){Yl.call(this,e),this.addType(s.OrientationChaser),this._set_value.setUnit("angle"),this._set_destination.setUnit("angle"),this._initialValue.setUnit("angle"),this._initialDestination.setUnit("angle"),this._value_changed.setUnit("angle")}Jl.prototype=Object.assign(Object.create(Yl.prototype),{constructor:Jl,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new P([new N(s.inputOutput,"metadata",new Bn.SFNode),new N(s.inputOnly,"set_value",new Bn.SFRotation),new N(s.inputOnly,"set_destination",new Bn.SFRotation),new N(s.initializeOnly,"initialValue",new Bn.SFRotation),new N(s.initializeOnly,"initialDestination",new Bn.SFRotation),new N(s.initializeOnly,"duration",new Bn.SFTime(1)),new N(s.outputOnly,"isActive",new Bn.SFBool),new N(s.outputOnly,"value_changed",new Bn.SFRotation)]),getTypeName:function(){return"OrientationChaser"},getComponentName:function(){return"Followers"},getContainerField:function(){return"children"},getVector:function(){return new Et(0,0,1,0)},equals:function(e,t,n){return Ql.assign(e).inverse().multRight(t),Math.abs(Ql.angle)<n},interpolate:function(e,t,n){return $l.assign(e).slerp(t,n)},step:function(e,t,n){this.deltaOut.assign(t).inverse().multRight(e).multLeft(this.output),this.output.slerp(this.deltaOut,n)}});const ec=Jl;i(450);var tc=i(755);const nc=/Mac OS X/i.test(navigator.userAgent),ic=nc?1/120:.05;function oc(e){Gl.call(this,e),this.button=-1,this.orientationOffset=new Et(0,0,1,0),this.fromVector=new He(0,0,0),this.toVector=new He(0,0,0),this.fromPoint=new He(0,0,0),this.toPoint=new He(0,0,0),this.rotation=new Et(0,0,1,0),this.pressTime=0,this.motionTime=0,this.touchMode=0,this.touch1=new ke(0,0),this.touch2=new ke(0,0),this.tapStart=0,this.dblTapInterval=.4,this.initialPositionOffset=new He(0,0,0),this.initialOrientationOffset=new Et(0,0,1,0),this.positionChaser=new Zl(e),this.centerOfRotationChaser=new Zl(e),this.rotationChaser=new ec(e)}oc.prototype=Object.assign(Object.create(Gl.prototype),{constructor:oc,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new P([new N(s.outputOnly,"isActive",new Bn.SFBool)]),initialize:function(){Gl.prototype.initialize.call(this);const e=this.getBrowser(),t=e.getSurface();this.getNavigationInfo()._transitionStart.addInterest("disconnect",this),e._activeViewpoint.addInterest("set_activeViewpoint__",this),t.on("mousedown.ExamineViewer",this.mousedown.bind(this)),t.on("mouseup.ExamineViewer",this.mouseup.bind(this)),t.on("dblclick.ExamineViewer",this.dblclick.bind(this)),t.on("mousewheel.ExamineViewer",this.mousewheel.bind(this)),t.on("touchstart.ExamineViewer",this.touchstart.bind(this)),t.on("touchend.ExamineViewer",this.touchend.bind(this)),this.positionChaser._duration=.2,this.positionChaser.setPrivate(!0),this.positionChaser.setup(),this.centerOfRotationChaser._duration=.2,this.centerOfRotationChaser.setPrivate(!0),this.centerOfRotationChaser.setup(),this.rotationChaser._duration=.2,this.rotationChaser.setPrivate(!0),this.rotationChaser.setup(),this.set_activeViewpoint__()},set_activeViewpoint__:function(){if(this.getStraightenHorizon()){const e=this.getActiveViewpoint();e&&(e._orientationOffset=this.getOrientationOffset(Et.Identity,e._orientationOffset.getValue(),!1))}this.disconnect()},mousedown:function(e){if(this.button>=0)return;this.pressTime=Date.now();const t=this.getBrowser().getSurface().offset(),n=e.pageX-t.left,i=e.pageY-t.top;switch(this.getButton(e.button)){case 0:e.preventDefault(),e.stopImmediatePropagation(),this.button=e.button,tc(document).on("mouseup.ExamineViewer"+this.getId(),this.mouseup.bind(this)),tc(document).on("mousemove.ExamineViewer"+this.getId(),this.mousemove.bind(this)),tc(document).on("touchend.ExamineViewer"+this.getId(),this.touchend.bind(this)),tc(document).on("touchmove.ExamineViewer"+this.getId(),this.touchmove.bind(this)),this.disconnect(),this.getActiveViewpoint().transitionStop(),this.getBrowser().setCursor("MOVE"),this.trackballProjectToSphere(n,i,this.fromVector),this.rotation.assign(Et.Identity),this.motionTime=0,this._isActive=!0;break;case 1:e.preventDefault(),e.stopImmediatePropagation(),this.button=e.button,tc(document).on("mouseup.ExamineViewer"+this.getId(),this.mouseup.bind(this)),tc(document).on("mousemove.ExamineViewer"+this.getId(),this.mousemove.bind(this)),tc(document).on("touchend.ExamineViewer"+this.getId(),this.touchend.bind(this)),tc(document).on("touchmove.ExamineViewer"+this.getId(),this.touchmove.bind(this)),this.disconnect(),this.getActiveViewpoint().transitionStop(),this.getBrowser().setCursor("MOVE"),this.getPointOnCenterPlane(n,i,this.fromPoint),this._isActive=!0}},mouseup:function(e){if(e.button===this.button)switch(this.button=-1,tc(document).off(".ExamineViewer"+this.getId()),this.getButton(e.button)){case 0:e.preventDefault(),e.stopImmediatePropagation();this.getActiveViewpoint();this.getBrowser().setCursor("DEFAULT"),Math.abs(this.rotation.angle)>.003&&Date.now()-this.motionTime<40&&(this.getStraightenHorizon()&&(this.rotation=this.getHorizonRotation(this.rotation)),this.addSpinning(this.rotation)),this._isActive=!1;break;case 1:e.preventDefault(),e.stopImmediatePropagation(),this.getBrowser().setCursor("DEFAULT"),this._isActive=!1}},dblclick:function(e){e.preventDefault(),e.stopImmediatePropagation();const t=this.getBrowser().getSurface(),n=t.offset(),i=e.pageX-n.left-parseFloat(t.css("borderLeftWidth")),o=t.innerHeight()-(e.pageY-n.top-parseFloat(t.css("borderTopWidth")));this.disconnect(),this.lookAtBBox(i,o,this.getStraightenHorizon())},mousemove:function(){const e=new He(0,0,0);return function(t){const n=this.getBrowser().getSurface().offset(),i=t.pageX-n.left,o=t.pageY-n.top;switch(this.getButton(this.button)){case 0:{t.preventDefault(),t.stopImmediatePropagation();const e=this.trackballProjectToSphere(i,o,this.toVector);if(this.rotation.setFromToVec(e,this.fromVector),Math.abs(this.rotation.angle)<.003&&Date.now()-this.pressTime<50)return;this.addRotate(this.rotation),this.fromVector.assign(e),this.motionTime=Date.now();break}case 1:{t.preventDefault(),t.stopImmediatePropagation();const n=this.getActiveViewpoint(),r=this.getPointOnCenterPlane(i,o,this.toPoint),s=n.getUserOrientation().multVecRot(e.assign(this.fromPoint).subtract(r));this.addMove(s,s),this.fromPoint.assign(r);break}}}}(),mousewheel:function(){const e=new He(0,0,0),t=new He(0,0,0);return function(n){n.preventDefault(),n.stopImmediatePropagation();const i=this.getBrowser(),o=this.getActiveViewpoint();i.prepareEvents().removeInterest("spin",this),o.transitionStop(),this.getDistanceToCenter(e).multiply(n.zoomFactor||ic),o.getUserOrientation().multVecRot(t.set(0,0,e.magnitude())),n.deltaY>0?this.addMove(t.negate(),He.Zero):n.deltaY<0&&this.addMove(t,He.Zero)}}(),touchstart:function(e){const t=e.originalEvent.touches;switch(t.length){case 1:e.button=0,e.pageX=t[0].pageX,e.pageY=t[0].pageY,this.mousedown(e),this.touch1.set(t[0].pageX,t[0].pageY);break;case 2:this.touchend(e),e.button=1,e.pageX=(t[0].pageX+t[1].pageX)/2,e.pageY=(t[0].pageY+t[1].pageY)/2,this.mousedown(e),this.touch1.set(t[0].pageX,t[0].pageY),this.touch2.set(t[1].pageX,t[1].pageY);break;case 3:this.touchend(e)}},touchend:function(e){switch(this.button){case 0:e.button=0,e.pageX=this.touch1.x,e.pageY=this.touch1.y,this.mouseup(e),this.tapedTwice?this.dblclick(e):(this.tapedTwice=!0,setTimeout(function(){this.tapedTwice=!1}.bind(this),300));break;case 1:this.touchMode=0,e.button=1,this.mouseup(e)}},touchmove:function(){const e=new ke(0,0),t=new ke(0,0);return function(n){const i=n.originalEvent.touches;switch(i.length){case 1:n.pageX=i[0].pageX,n.pageY=i[0].pageY,this.mousemove(n);break;case 2:{e.set(i[0].pageX,i[0].pageY).subtract(this.touch1).normalize(),t.set(i[1].pageX,i[1].pageY).subtract(this.touch2).normalize();const o=e.dot(t)>.7,r=e.dot(t)<-.7;switch(this.touchMode||(o?1:r?2:0)){case 1:this.touchMode=1,n.pageX=(i[0].pageX+i[1].pageX)/2,n.pageY=(i[0].pageY+i[1].pageY)/2,this.mousemove(n);break;case 2:{this.touchMode=2;const e=this.touch1.distance(this.touch2);this.touch1.set(i[0].pageX,i[0].pageY),this.touch2.set(i[1].pageX,i[1].pageY);const t=this.touch1.distance(this.touch2)-e;n.deltaY=t,n.zoomFactor=Math.abs(t)/tc(window).width(),this.mousewheel(n);break}}this.touch1.set(i[0].pageX,i[0].pageY),this.touch2.set(i[1].pageX,i[1].pageY);break}}}}(),spin:function(){const e=this.getActiveViewpoint();this.orientationOffset.assign(e._orientationOffset.getValue()),e._orientationOffset=this.getOrientationOffset(this.rotation,this.orientationOffset),e._positionOffset=this.getPositionOffset(e._positionOffset.getValue(),this.orientationOffset,e._orientationOffset.getValue())},set_positionOffset__:function(e){this.getActiveViewpoint()._positionOffset=e},set_centerOfRotationOffset__:function(e){this.getActiveViewpoint()._centerOfRotationOffset=e},set_rotation__:function(e){const t=this.getActiveViewpoint();t._orientationOffset=this.getOrientationOffset(e.getValue(),this.initialOrientationOffset,!1),t._positionOffset=this.getPositionOffset(this.initialPositionOffset,this.initialOrientationOffset,t._orientationOffset.getValue())},addRotate:function(){const e=new Et;return function(t){const n=this.getActiveViewpoint();if(this.rotationChaser._isActive.getValue()&&this.rotationChaser._value_changed.hasInterest("set_rotation__",this))try{e.assign(this.rotationChaser._set_destination.getValue()).multLeft(t),this.getOrientationOffset(e,this.initialOrientationOffset,!0),this.rotationChaser._set_destination=e}catch(n){t=this.getHorizonRotation(t),e.assign(this.rotationChaser._set_destination.getValue()).multLeft(t),this.rotationChaser._set_destination=e}else try{this.initialOrientationOffset.assign(n._orientationOffset.getValue()),this.initialPositionOffset.assign(n._positionOffset.getValue()),this.getOrientationOffset(t,this.initialOrientationOffset,!0),this.rotationChaser._set_value=Et.Identity,this.rotationChaser._set_destination=t}catch(e){this.rotationChaser._set_value=Et.Identity,this.rotationChaser._set_destination=this.getHorizonRotation(t)}this.disconnect(),this.rotationChaser._value_changed.addInterest("set_rotation__",this)}}(),addSpinning:function(){const e=new Et(0,0,1,0);return function(t){this.disconnect(),this.getBrowser().prepareEvents().addInterest("spin",this),this.rotation.assign(e.assign(Et.Identity).slerp(t,.6))}}(),addMove:function(){const e=new He(0,0,0),t=new He(0,0,0);return function(n,i){const o=this.getActiveViewpoint();this.positionChaser._isActive.getValue()&&this.positionChaser._value_changed.hasInterest("set_positionOffset__",this)?(e.assign(this.positionChaser._set_destination.getValue()).add(n),this.positionChaser._set_destination=e):(e.assign(o._positionOffset.getValue()).add(n),this.positionChaser._set_value=o._positionOffset,this.positionChaser._set_destination=e),this.centerOfRotationChaser._isActive.getValue()&&this.centerOfRotationChaser._value_changed.hasInterest("set_centerOfRotationOffset__",this)?(t.assign(this.centerOfRotationChaser._set_destination.getValue()).add(i),this.centerOfRotationChaser._set_destination=t):(t.assign(o._centerOfRotationOffset.getValue()).add(i),this.centerOfRotationChaser._set_value=o._centerOfRotationOffset,this.centerOfRotationChaser._set_destination=t),this.disconnect(),this.positionChaser._value_changed.addInterest("set_positionOffset__",this),this.centerOfRotationChaser._value_changed.addInterest("set_centerOfRotationOffset__",this)}}(),getPositionOffset:function(){const e=new He(0,0,0),t=new He(0,0,0),n=new Et(0,0,1,0);return function(i,o,r){return this.getDistanceToCenter(e,i),n.assign(o).inverse().multRight(r).multVecRot(t.assign(e)).subtract(e).add(i)}}(),getOrientationOffset:function(){const e=new Et(0,0,1,0),t=new Et(0,0,1,0),n=new He(0,0,0);return function(i,o,r){const s=this.getActiveViewpoint(),a=this.getStraightenHorizon();e.assign(i).multRight(s.getOrientation()).multRight(o),a&&s.straightenHorizon(e,this.getUpVector(s));const u=t.assign(s.getOrientation()).inverse().multRight(e);if(a){if(!r)return u;const t=e.multVecRot(n.assign(He.zAxis));if(Math.abs(this.getUpVector(s).dot(t))<.97)return u;throw new Error("Critical angle")}return u}}(),getHorizonRotation:function(){const e=new He(0,0,0);return function(t){const n=t.multVecRot(e.assign(He.zAxis)),i=He.cross(He.yAxis,n),o=He.cross(i,He.yAxis);return new Et(He.zAxis,o)}}(),getUpVector:function(e){return"GeoViewpoint"!==e.getTypeName()||e.getUserPosition().magnitude()<65e5?e.getUpVector():He.zAxis},disconnect:function(){const e=this.getBrowser();this.positionChaser._value_changed.removeInterest("set_positionOffset__",this),this.centerOfRotationChaser._value_changed.removeInterest("set_centerOfRotationOffset__",this),this.rotationChaser._value_changed.removeInterest("set_rotation__",this),e.prepareEvents().removeInterest("spin",this)},dispose:function(){const e=this.getBrowser();this.disconnect(),e._activeViewpoint.removeInterest("set_activeViewpoint__",this),e.getSurface().off(".ExamineViewer"),tc(document).off(".ExamineViewer"+this.getId())}});const rc=oc;i(450);var sc=i(755);const ac=/Mac OS X/i.test(navigator.userAgent),uc=.007,lc=ac?Math.PI/512:Math.PI/32;function cc(e){Gl.call(this,e);const t=this.getBrowser().getContext();this.button=-1,this.fromVector=new He(0,0,0),this.toVector=new He(0,0,0),this.direction=new He(0,0,0),this.startTime=0,this.event=null,this.lookAround=!1,this.orientationChaser=new ec(e),this.lineCount=2,this.lineArray=new Float32Array(4*this.lineCount).fill(1),this.lineBuffer=t.createBuffer(),this.lineArrayObject=new Gr,this.geometryContext=new Kr({geometryType:1})}cc.prototype=Object.assign(Object.create(Gl.prototype),{constructor:cc,initialize:function(){Gl.prototype.initialize.call(this);const e=this.getBrowser(),t=e.getSurface();t.on("mousedown.X3DFlyViewer",this.mousedown.bind(this)),t.on("mouseup.X3DFlyViewer",this.mouseup.bind(this)),t.on("mousewheel.X3DFlyViewer",this.mousewheel.bind(this)),t.on("touchstart.X3DFlyViewer",this.touchstart.bind(this)),t.on("touchend.X3DFlyViewer",this.touchend.bind(this)),e._controlKey.addInterest("set_controlKey__",this),this.orientationChaser._duration=.3,this.orientationChaser.setPrivate(!0),this.orientationChaser.setup()},addCollision:function(){},removeCollision:function(){},set_controlKey__:function(){this.event&&0===this.event.button&&(this.button=-1,this.mousedown(this.event))},mousedown:function(e){if(this.button>=0)return;this.event=e;const t=this.getBrowser().getSurface().offset(),n=e.pageX-t.left,i=e.pageY-t.top;switch(this.getButton(e.button)){case 0:e.preventDefault(),e.stopImmediatePropagation(),this.button=e.button,sc(document).on("mouseup.X3DFlyViewer"+this.getId(),this.mouseup.bind(this)),sc(document).on("mousemove.X3DFlyViewer"+this.getId(),this.mousemove.bind(this)),sc(document).on("touchend.X3DFlyViewer"+this.getId(),this.touchend.bind(this)),sc(document).on("touchmove.X3DFlyViewer"+this.getId(),this.touchmove.bind(this)),this.disconnect(),this.getActiveViewpoint().transitionStop(),this.getBrowser().setCursor("MOVE"),this.addCollision(),this.getBrowser().getControlKey()||this.lookAround?this.trackballProjectToSphere(n,i,this.fromVector):(this.fromVector.set(n,0,i),this.toVector.assign(this.fromVector),this.getFlyDirection(this.fromVector,this.toVector,this.direction),this.addFly(),this.getBrowser().getBrowserOption("Rubberband")&&this.getBrowser().finished().addInterest("display",this,0)),this._isActive=!0;break;case 1:e.preventDefault(),e.stopImmediatePropagation(),this.button=e.button,sc(document).on("mouseup.X3DFlyViewer"+this.getId(),this.mouseup.bind(this)),sc(document).on("mousemove.X3DFlyViewer"+this.getId(),this.mousemove.bind(this)),this.disconnect(),this.getActiveViewpoint().transitionStop(),this.getBrowser().setCursor("MOVE"),this.addCollision(),this.fromVector.set(n,-i,0),this.toVector.assign(this.fromVector),this.direction.set(0,0,0),this.addPan(),this.getBrowser().getBrowserOption("Rubberband")&&this.getBrowser().finished().addInterest("display",this,1),this._isActive=!0}},mouseup:function(e){e.preventDefault(),e.button===this.button&&(this.event=null,this.button=-1,sc(document).off(".X3DFlyViewer"+this.getId()),this.disconnect(),this.getBrowser().setCursor("DEFAULT"),this.removeCollision(),this._isActive=!1)},mousemove:function(e){this.getBrowser().addBrowserEvent(),this.event=e;const t=this.getBrowser().getSurface().offset(),n=e.pageX-t.left,i=e.pageY-t.top;switch(this.getButton(this.button)){case 0:if(this.getBrowser().getControlKey()||this.lookAround){e.preventDefault(),e.stopImmediatePropagation();const t=this.trackballProjectToSphere(n,i,this.toVector);this.addRotation(this.fromVector,t),this.fromVector.assign(t);break}this.toVector.set(n,0,i),this.getFlyDirection(this.fromVector,this.toVector,this.direction);break;case 1:e.preventDefault(),e.stopImmediatePropagation(),this.toVector.set(n,-i,0),this.direction.assign(this.toVector).subtract(this.fromVector)}},mousewheel:function(e){e.preventDefault(),e.stopImmediatePropagation();this.getActiveViewpoint().transitionStop(),e.deltaY>0?this.addRoll(-lc):e.deltaY<0&&this.addRoll(lc)},touchstart:function(e){const t=e.originalEvent.touches;switch(t.length){case 1:e.button=0,e.pageX=t[0].pageX,e.pageY=t[0].pageY,this.mousedown(e);break;case 2:this.touchend(e),this.lookAround=!0,e.button=0,e.pageX=(t[0].pageX+t[1].pageX)/2,e.pageY=(t[0].pageY+t[1].pageY)/2,this.mousedown(e);break;case 3:this.touchend(e)}},touchend:function(e){if(0===this.button)this.lookAround=!1,e.button=0,this.mouseup(e)},touchmove:function(e){const t=e.originalEvent.touches;switch(t.length){case 1:e.button=0,e.pageX=t[0].pageX,e.pageY=t[0].pageY,this.mousemove(e);break;case 2:e.button=0,e.pageX=(t[0].pageX+t[1].pageX)/2,e.pageY=(t[0].pageY+t[1].pageY)/2,this.mousemove(e)}},fly:function(){const e=new He(0,0,0),t=new He(0,0,0),n=new He(0,0,0),i=new Et(0,0,1,0),o=new Et(0,0,1,0),r=new Et(0,0,1,0);return function(){const s=this.getNavigationInfo(),a=this.getActiveViewpoint(),u=Date.now(),l=(u-this.startTime)/1e3;e.assign(a.getUpVector()),this.direction.z>0?r.setFromToVec(this.direction,n.set(0,0,1)):r.setFromToVec(n.set(0,0,-1),this.direction);const c=this.direction.magnitude();let h=1-r.angle/(Math.PI/2);h*=s._speed.getValue(),h*=a.getSpeedFactor(),h*=this.getBrowser().getShiftKey()?.028:uc,h*=l;const d=this.getTranslationOffset(t.assign(this.direction).multiply(h));this.getActiveLayer().constrainTranslation(d,!0),a._positionOffset=d.add(a._positionOffset.getValue());const p=1.4*l*Math.pow(c/(c+40),2);i.assign(Et.Identity).slerp(r,p).multRight(a.getUserOrientation()),this.getStraightenHorizon()&&a.straightenHorizon(i),o.assign(a.getOrientation()).inverse().multRight(i),a._orientationOffset=o,this.startTime=u}}(),pan:function(){const e=new He(0,0,0),t=new He(0,0,0);return function(){const n=this.getNavigationInfo(),i=this.getActiveViewpoint(),o=Date.now(),r=(o-this.startTime)/1e3,s=i.getUpVector();this.constrainPanDirection(e.assign(this.direction));let a=1;a*=n._speed.getValue(),a*=i.getSpeedFactor(),a*=this.getBrowser().getShiftKey()?.0098:.007,a*=r;const u=i.getUserOrientation().multRight(new Et(i.getUserOrientation().multVecRot(t.assign(He.yAxis)),s)).multVecRot(e.multiply(a));this.getActiveLayer().constrainTranslation(u,!0),i._positionOffset=u.add(i._positionOffset.getValue()),this.startTime=o}}(),set_orientationOffset__:function(e){this.getActiveViewpoint()._orientationOffset=e},addFly:function(){this.startTime||(this.getBrowser().prepareEvents().addInterest("fly",this),this.getBrowser().addBrowserEvent(),this.startTime=Date.now())},addPan:function(){this.startTime||(this.disconnect(),this.getBrowser().prepareEvents().addInterest("pan",this),this.getBrowser().addBrowserEvent(),this.startTime=Date.now())},addRoll:function(){const e=new Et(0,0,1,0),t=new Et(0,0,1,0);return function(n){const i=this.getActiveViewpoint();this.orientationChaser._isActive.getValue()&&this.orientationChaser._value_changed.hasInterest("set_orientationOffset__",this)?(e.assign(i.getOrientation()).inverse().multRight(t.set(1,0,0,n)).multRight(i.getOrientation()).multRight(this.orientationChaser._set_destination.getValue()),this.orientationChaser._set_destination=e):(e.assign(i.getOrientation()).inverse().multRight(t.set(1,0,0,n)).multRight(i.getUserOrientation()),this.orientationChaser._set_value=i._orientationOffset,this.orientationChaser._set_destination=e),this.disconnect(),this.orientationChaser._value_changed.addInterest("set_orientationOffset__",this)}}(),addRotation:function(){const e=new Et(0,0,1,0),t=new Et(0,0,1,0);return function(n,i){const o=this.getActiveViewpoint();this.orientationChaser._isActive.getValue()&&this.orientationChaser._value_changed.hasInterest("set_orientationOffset__",this)?(e.setFromToVec(i,n).multRight(o.getOrientation()).multRight(this.orientationChaser._set_destination.getValue()),this.getStraightenHorizon()&&o.straightenHorizon(e),t.assign(o.getOrientation()).inverse().multRight(e),this.orientationChaser._set_destination=t):(e.setFromToVec(i,n).multRight(o.getUserOrientation()),this.getStraightenHorizon()&&o.straightenHorizon(e),t.assign(o.getOrientation()).inverse().multRight(e),this.orientationChaser._set_value=o._orientationOffset,this.orientationChaser._set_destination=t),this.disconnect(),this.orientationChaser._value_changed.addInterest("set_orientationOffset__",this)}}(),display:function(){const e=new He(0,0,0),t=new He(0,0,0),n=new Nt,i=new Float32Array(Nt.Identity),o=new Float32Array(Nt.Identity),r=[];return function(s){const a=this.getBrowser(),u=a.getContext(),l=a.getViewport(),c=l[2],h=l[3];i.set(lr.ortho(0,c,0,h,-1,1,n)),0===s?(e.set(this.fromVector.x,h-this.fromVector.z,0),t.set(this.toVector.x,h-this.toVector.z,0)):(e.set(this.fromVector.x,h+this.fromVector.y,0),t.set(this.toVector.x,h+this.toVector.y,0)),this.lineArray.set(e,0),this.lineArray.set(t,4),u.bindBuffer(u.ARRAY_BUFFER,this.lineBuffer),u.bufferData(u.ARRAY_BUFFER,this.lineArray,u.DYNAMIC_DRAW);const d=a.getDefaultMaterial().getShader(this.geometryContext);d.enable(u),d.setClipPlanes(u,r),u.uniformMatrix4fv(d.x3d_ProjectionMatrix,!1,i),u.uniformMatrix4fv(d.x3d_ModelViewMatrix,!1,o),this.lineArrayObject.enable(u,d)&&d.enableVertexAttribute(u,this.lineBuffer,0,0),u.disable(u.DEPTH_TEST),u.uniform3f(d.x3d_EmissiveColor,0,0,0),u.uniform1f(d.x3d_Transparency,0),u.drawArrays(u.LINES,0,this.lineCount),u.uniform3f(d.x3d_EmissiveColor,1,1,1),u.drawArrays(u.LINES,0,this.lineCount)}}(),disconnect:function(){const e=this.getBrowser();e.addBrowserEvent(),e.prepareEvents().removeInterest("fly",this),e.prepareEvents().removeInterest("pan",this),e.finished().removeInterest("display",this),this.orientationChaser._value_changed.removeInterest("set_orientationOffset__",this),this.startTime=0},dispose:function(){const e=this.getBrowser().getContext();e.deleteBuffer(this.lineBuffer),this.lineArrayObject.delete(e),this.disconnect(),this.getBrowser()._controlKey.removeInterest("set_controlKey__",this),this.getBrowser().getSurface().off(".X3DFlyViewer"),sc(document).off(".X3DFlyViewer"+this.getId())}});const hc=cc;function dc(e){hc.call(this,e)}dc.prototype=Object.assign(Object.create(hc.prototype),{constructor:dc,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new P([new N(s.outputOnly,"isActive",new Bn.SFBool)]),initialize:function(){hc.prototype.initialize.call(this),this.getBrowser().addCollision(this)},getStraightenHorizon:function(){return!0},getFlyDirection:function(e,t,n){return n.assign(t).subtract(e)},getTranslationOffset:function(){const e=new He(0,0,0),t=new Et(0,0,1,0),n=new Et(0,0,1,0);return function(i){const o=this.getActiveViewpoint(),r=o.getUpVector();t.assign(o.getUserOrientation()),t.multVecRot(e.assign(He.yAxis)),n.setFromToVec(e,r);return t.multRight(n).multVecRot(i)}}(),constrainPanDirection:function(e){return e.y<0&&(e.y=0),e},dispose:function(){this.getBrowser().removeCollision(this),hc.prototype.dispose.call(this)}});const pc=dc;function fc(e){hc.call(this,e)}fc.prototype=Object.assign(Object.create(hc.prototype),{constructor:fc,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new P([new N(s.outputOnly,"isActive",new Bn.SFBool)]),addCollision:function(){this.getBrowser().addCollision(this)},removeCollision:function(){this.getBrowser().removeCollision(this)},getFlyDirection:function(e,t,n){return n.assign(t).subtract(e)},getTranslationOffset:function(e){return this.getActiveViewpoint().getUserOrientation().multVecRot(e)},constrainPanDirection:function(e){return e}});const gc=fc;i(450);var mc=i(755);const _c=/Mac OS X/i.test(navigator.userAgent)?1/160:.05,yc=new He(0,0,0),xc=new He(0,0,0),wc=new He(0,0,0);function vc(e){Gl.call(this,e),this.button=-1,this.fromPoint=new He(0,0,0),this.toPoint=new He(0,0,0)}vc.prototype=Object.assign(Object.create(Gl.prototype),{constructor:vc,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new P([new N(s.outputOnly,"isActive",new Bn.SFBool)]),initialize:function(){Gl.prototype.initialize.call(this);const e=this.getBrowser().getSurface();e.on("mousedown.PlaneViewer",this.mousedown.bind(this)),e.on("mouseup.PlaneViewer",this.mouseup.bind(this)),e.on("mousemove.PlaneViewer",this.mousemove.bind(this)),e.on("mousewheel.PlaneViewer",this.mousewheel.bind(this))},mousedown:function(e){if(this.button>=0)return;const t=this.getBrowser().getSurface().offset(),n=e.pageX-t.left,i=e.pageY-t.top;if(1===this.getButton(e.button))e.preventDefault(),e.stopImmediatePropagation(),this.button=e.button,this.getBrowser().getSurface().off("mousemove.PlaneViewer"),mc(document).on("mouseup.PlaneViewer"+this.getId(),this.mouseup.bind(this)),mc(document).on("mousemove.PlaneViewer"+this.getId(),this.mousemove.bind(this)),this.getActiveViewpoint().transitionStop(),this.getBrowser().setCursor("MOVE"),this.getPointOnCenterPlane(n,i,this.fromPoint),this._isActive=!0},mouseup:function(e){e.preventDefault(),e.stopImmediatePropagation(),e.button===this.button&&(this.button=-1,mc(document).off(".PlaneViewer"+this.getId()),this.getBrowser().getSurface().on("mousemove.PlaneViewer",this.mousemove.bind(this)),this.getBrowser().setCursor("DEFAULT"),this._isActive=!1)},mousemove:function(e){const t=this.getBrowser().getSurface().offset(),n=e.pageX-t.left,i=e.pageY-t.top;switch(this.getButton(this.button)){case 1:{e.preventDefault(),e.stopImmediatePropagation();const t=this.getActiveViewpoint(),o=this.getPointOnCenterPlane(n,i,this.toPoint),r=t.getUserOrientation().multVecRot(this.fromPoint.subtract(o));t._positionOffset=xc.assign(t._positionOffset.getValue()).add(r),t._centerOfRotationOffset=wc.assign(t._centerOfRotationOffset.getValue()).add(r),this.fromPoint.assign(o);break}}},mousewheel:function(e){e.preventDefault(),e.stopImmediatePropagation();const t=this.getBrowser().getSurface().offset(),n=e.pageX-t.left,i=e.pageY-t.top,o=this.getActiveViewpoint(),r=this.getPointOnCenterPlane(n,i,this.fromPoint);o.transitionStop(),e.deltaY>0?o._fieldOfViewScale=Math.max(1e-5,o._fieldOfViewScale.getValue()*(1-_c)):e.deltaY<0&&(o._fieldOfViewScale=o._fieldOfViewScale.getValue()*(1+_c),this.constrainFieldOfViewScale()),o.set_fieldOfView___&&o.set_fieldOfView___();const s=this.getPointOnCenterPlane(n,i,this.toPoint),a=o.getUserOrientation().multVecRot(yc.assign(r).subtract(s));o._positionOffset=xc.assign(o._positionOffset.getValue()).add(a),o._centerOfRotationOffset=wc.assign(o._centerOfRotationOffset.getValue()).add(a)},constrainFieldOfViewScale:function(){const e=this.getActiveViewpoint();e.getTypeName().match(/^(?:Viewpoint|GeoViewpoint)$/)&&e._fieldOfView.getValue()*e._fieldOfViewScale.getValue()>=Math.PI&&(e._fieldOfViewScale=(Math.PI-.001)/e._fieldOfView.getValue())},dispose:function(){this.getBrowser().getSurface().off(".PlaneViewer"),mc(document).off(".PlaneViewer"+this.getId())}});const bc=vc;function Sc(e){Gl.call(this,e)}Sc.prototype=Object.assign(Object.create(Gl.prototype),{constructor:Sc,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new P([new N(s.outputOnly,"isActive",new Bn.SFBool)])});const Tc=Sc;i(450);var Ec=i(755);const Cc=/Mac OS X/i.test(navigator.userAgent)?1/120:.05;function Oc(e){Gl.call(this,e),this.button=-1,this.fromVector=new He(0,0,0),this.toVector=new He(0,0,0),this.touch1=new ke(0,0),this.touch2=new ke(0,0),this.tapStart=0,this.dblTapInterval=.4,this.positionChaser=new Zl(e),this.centerOfRotationChaser=new Zl(e),this.orientationChaser=new ec(e)}Oc.prototype=Object.assign(Object.create(Gl.prototype),{constructor:Oc,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new P([new N(s.outputOnly,"isActive",new Bn.SFBool)]),initialize:function(){Gl.prototype.initialize.call(this);const e=this.getBrowser().getSurface();e.on("mousedown.LookAtViewer",this.mousedown.bind(this)),e.on("mouseup.LookAtViewer",this.mouseup.bind(this)),e.on("dblclick.LookAtViewer",this.dblclick.bind(this)),e.on("mousewheel.LookAtViewer",this.mousewheel.bind(this)),e.on("touchstart.LookAtViewer",this.touchstart.bind(this)),e.on("touchend.LookAtViewer",this.touchend.bind(this)),this.positionChaser._duration=.3,this.positionChaser.setPrivate(!0),this.positionChaser.setup(),this.centerOfRotationChaser._duration=.3,this.centerOfRotationChaser.setPrivate(!0),this.centerOfRotationChaser.setup(),this.orientationChaser._duration=.3,this.orientationChaser.setPrivate(!0),this.orientationChaser.setup()},mousedown:function(e){if(this.button>=0)return;const t=this.getBrowser().getSurface().offset(),n=e.pageX-t.left,i=e.pageY-t.top;if(0===e.button)e.preventDefault(),e.stopImmediatePropagation(),this.button=e.button,Ec(document).on("mouseup.LookAtViewer"+this.getId(),this.mouseup.bind(this)),Ec(document).on("mousemove.LookAtViewer"+this.getId(),this.mousemove.bind(this)),Ec(document).on("touchend.LookAtViewer"+this.getId(),this.mouseup.bind(this)),Ec(document).on("touchmove.LookAtViewer"+this.getId(),this.touchmove.bind(this)),this.getActiveViewpoint().transitionStop(),this.trackballProjectToSphere(n,i,this.fromVector),this._isActive=!0},mouseup:function(e){if(e.button===this.button&&(this.button=-1,Ec(document).off(".LookAtViewer"+this.getId()),0===e.button))e.preventDefault(),e.stopImmediatePropagation(),this._isActive=!1},dblclick:function(e){e.preventDefault(),e.stopImmediatePropagation();const t=this.getBrowser().getSurface(),n=t.offset(),i=e.pageX-n.left-parseFloat(t.css("borderLeftWidth")),o=t.innerHeight()-(e.pageY-n.top-parseFloat(t.css("borderTopWidth")));this.disconnect(),this.lookAtPoint(i,o,this.getStraightenHorizon())},mousemove:function(e){this.getBrowser().addBrowserEvent(),this.event=e;const t=this.getBrowser().getSurface().offset(),n=e.pageX-t.left,i=e.pageY-t.top;switch(this.button){case 0:{e.preventDefault(),e.stopImmediatePropagation();const t=this.trackballProjectToSphere(n,i,this.toVector);this.addRotation(this.fromVector,t),this.fromVector.assign(t);break}}},mousewheel:function(){const e=new He(0,0,0),t=new He(0,0,0);return function(n){n.preventDefault(),n.stopImmediatePropagation();const i=this.getActiveViewpoint();i.transitionStop(),e=this.getDistanceToCenter(e).multiply(n.zoomFactor||Cc),t=i.getUserOrientation().multVecRot(t.set(0,0,e.magnitude())),n.deltaY>0?this.addMove(t.negate(),He.Zero):n.deltaY<0&&this.addMove(t,He.Zero)}}(),touchstart:function(e){const t=e.originalEvent.touches;switch(t.length){case 1:this.touch1.set(t[0].pageX,t[0].pageY);break;case 2:this.touchend(e),e.button=0,e.pageX=(t[0].pageX+t[1].pageX)/2,e.pageY=(t[0].pageY+t[1].pageY)/2,this.mousedown(e),this.touch1.set(t[0].pageX,t[0].pageY),this.touch2.set(t[1].pageX,t[1].pageY);break;case 3:this.touchend(e)}},touchend:function(e){if(0===this.button)this.mouseup(e);this.getBrowser().getCurrentTime()-this.tapStart<this.dblTapInterval&&(e.button=1,e.pageX=this.touch1.x,e.pageY=this.touch1.y,this.dblclick(e)),this.tapStart=this.getBrowser().getCurrentTime()},touchmove:function(){const e=new ke(0,0),t=new ke(0,0);return function(n){const i=n.originalEvent.touches;switch(i.length){case 1:break;case 2:{e.set(i[0].pageX,i[0].pageY).subtract(this.touch1).normalize(),t.set(i[1].pageX,i[1].pageY).subtract(this.touch2).normalize();const o=e.dot(t)>.7,r=e.dot(t)<-.7;if(o)n.button=0,n.pageX=(i[0].pageX+i[1].pageX)/2,n.pageY=(i[0].pageY+i[1].pageY)/2,this.mousemove(n);else if(r){const e=this.touch1.distance(this.touch2);this.touch1.set(i[0].pageX,i[0].pageY),this.touch2.set(i[1].pageX,i[1].pageY);const t=this.touch1.distance(this.touch2)-e;n.deltaY=t,n.zoomFactor=Math.abs(t)/Ec(window).width(),this.mousewheel(n)}this.touch1.set(i[0].pageX,i[0].pageY),this.touch2.set(i[1].pageX,i[1].pageY);break}}}}(),set_positionOffset__:function(e){this.getActiveViewpoint()._positionOffset=e},set_centerOfRotationOffset__:function(e){this.getActiveViewpoint()._centerOfRotationOffset=e},set_orientationOffset__:function(e){this.getActiveViewpoint()._orientationOffset=e},addMove:function(){const e=new He(0,0,0),t=new He(0,0,0);return function(n,i){const o=this.getActiveViewpoint();this.positionChaser._isActive.getValue()&&this.positionChaser._value_changed.hasInterest("set_positionOffset__",this)?(e.assign(this.positionChaser._set_destination.getValue()).add(n),this.positionChaser._set_destination=e):(e.assign(o._positionOffset.getValue()).add(n),this.positionChaser._set_value=o._positionOffset,this.positionChaser._set_destination=e),this.centerOfRotationChaser._isActive.getValue()&&this.centerOfRotationChaser._value_changed.hasInterest("set_centerOfRotationOffset__",this)?(t.assign(this.centerOfRotationChaser._set_destination.getValue()).add(i),this.centerOfRotationChaser._set_destination=t):(t.assign(o._centerOfRotationOffset.getValue()).add(i),this.centerOfRotationChaser._set_value=o._centerOfRotationOffset,this.centerOfRotationChaser._set_destination=t),this.disconnect(),this.positionChaser._value_changed.addInterest("set_positionOffset__",this),this.centerOfRotationChaser._value_changed.addInterest("set_centerOfRotationOffset__",this)}}(),addRotation:function(){const e=new Et(0,0,1,0),t=new Et(0,0,1,0);return function(n,i){const o=this.getActiveViewpoint();this.orientationChaser._isActive.getValue()&&this.orientationChaser._value_changed.hasInterest("set_orientationOffset__",this)?(e.setFromToVec(i,n).multRight(o.getOrientation()).multRight(this.orientationChaser._set_destination.getValue()),o.straightenHorizon(e),t.assign(o.getOrientation()).inverse().multRight(e),this.orientationChaser._set_destination=t):(e.setFromToVec(i,n).multRight(o.getUserOrientation()),o.straightenHorizon(e),t.assign(o.getOrientation()).inverse().multRight(e),this.orientationChaser._set_value=o._orientationOffset,this.orientationChaser._set_destination=t),this.disconnect(),this.orientationChaser._value_changed.addInterest("set_orientationOffset__",this)}}(),disconnect:function(){this.orientationChaser._value_changed.removeInterest("set_orientationOffset__",this),this.positionChaser._value_changed.removeInterest("set_positionOffset__",this),this.centerOfRotationChaser._value_changed.removeInterest("set_centerOfRotationOffset__",this)},dispose:function(){this.getBrowser().getSurface().off(".LookAtViewer"),Ec(document).off(".LookAtViewer"+this.getId())}});const Nc=Oc;function Fc(e){yr.call(this,e),this.addType(s.X3DLightNode)}Fc.prototype=Object.assign(Object.create(yr.prototype),{constructor:Fc,initialize:function(){yr.prototype.initialize.call(this),this._on.addInterest("set_on__",this),this._intensity.addInterest("set_on__",this),this.set_on__()},set_on__:function(){this._on.getValue()&&this.getIntensity()>0?(delete this.push,delete this.pop):(this.push=Function.prototype,this.pop=Function.prototype)},getGlobal:function(){return this._global.getValue()},getColor:function(){return this._color.getValue()},getIntensity:function(){return Math.max(this._intensity.getValue(),0)},getAmbientIntensity:function(){return ee.clamp(this._ambientIntensity.getValue(),0,1)},getDirection:function(){return this._direction.getValue()},getShadows:function(){return this._shadows.getValue()},getShadowColor:function(){return this._shadowColor.getValue()},getShadowIntensity:function(){return this.getShadows()?ee.clamp(this._shadowIntensity.getValue(),0,1):0},getShadowBias:function(){return ee.clamp(this._shadowBias.getValue(),0,1)},getShadowMapSize:function(){return Math.min(this._shadowMapSize.getValue(),this.getBrowser().getMaxTextureSize())},getBiasMatrix:function(){const e=new Nt(.5,0,0,0,0,.5,0,0,0,0,.5,0,.5,.5,.5,1);return function(){return e}}(),push:function(e,t){if(e.isIndependent()){const n=this.getLights().pop();this._global.getValue()?(n.set(this,e.getLayer().getGroup(),e.getModelViewMatrix().get()),e.getGlobalObjects().push(n),e.getLights().push(n),e.pushGlobalShadows(!!this.getShadowIntensity())):(n.set(this,t,e.getModelViewMatrix().get()),e.getLocalObjects().push(n),e.getLights().push(n),e.pushLocalShadows(!!this.getShadowIntensity()),++e.getLocalObjectsCount()[1])}else{const t=e.getLightContainer();this._global.getValue()?(t.getModelViewMatrix().pushMatrix(e.getModelViewMatrix().get()),e.getGlobalObjects().push(t),e.getLights().push(t),e.pushGlobalShadows(!!this.getShadowIntensity())):(t.getModelViewMatrix().pushMatrix(e.getModelViewMatrix().get()),e.getLocalObjects().push(t),e.getLights().push(t),e.pushLocalShadows(!!this.getShadowIntensity()),++e.getLocalObjectsCount()[1])}},pop:function(e){this._global.getValue()||(e.isIndependent()?this.getBrowser().getLocalObjects().push(e.getLocalObjects().pop()):e.getLocalObjects().pop(),e.popLocalShadows(),--e.getLocalObjectsCount()[1])}});const Mc=Fc,Dc=Ar(Ic);function Ic(){this.direction=new He(0,0,0),this.shadowBuffer=null,this.bbox=new hr,this.viewVolume=new nr,this.viewport=new st(0,0,0,0),this.projectionMatrix=new Nt,this.modelViewMatrix=new dr(Nt),this.modelMatrix=new Nt,this.invLightSpaceMatrix=new Nt,this.invLightSpaceProjectionMatrix=new Nt,this.shadowMatrix=new Nt,this.shadowMatrixArray=new Float32Array(16),this.rotation=new Et,this.textureUnit=void 0}function Rc(e){Mc.call(this,e),this.addType(s.DirectionalLight),"2.0"===e.getSpecificationVersion()&&(this._global=!0)}Ic.prototype={constructor:Ic,getModelViewMatrix:function(){return this.modelViewMatrix},set:function(e,t,n){const i=e.getShadowMapSize();this.browser=e.getBrowser(),this.lightNode=e,this.groupNode=t,this.modelViewMatrix.pushMatrix(n),e.getShadowIntensity()>0&&i>0&&(this.shadowBuffer=this.browser.popShadowBuffer(i),this.shadowBuffer||console.warn("Couldn't create shadow buffer."))},renderShadowMap:function(e){if(!this.shadowBuffer)return;const t=this.lightNode,n=e.getCameraSpaceMatrix().get(),i=this.modelMatrix.assign(this.modelViewMatrix.get()).multRight(n),o=this.invLightSpaceMatrix.assign(t.getGlobal()?i:Nt.Identity);o.rotate(this.rotation.setFromToVec(He.zAxis,this.direction.assign(t.getDirection()).negate())),o.inverse();const r=this.groupNode.getSubBBox(this.bbox,!0).multRight(o),s=t.getShadowMapSize(),a=this.viewport.set(0,0,s,s),u=lr.orthoBox(r,this.projectionMatrix);this.shadowBuffer.bind(),e.getViewVolumes().push(this.viewVolume.set(u,a,a)),e.getProjectionMatrix().pushMatrix(u),e.getModelViewMatrix().pushMatrix(o),e.render(sr.SHADOW,Tr.prototype.traverse,this.groupNode),e.getModelViewMatrix().pop(),e.getProjectionMatrix().pop(),e.getViewVolumes().pop(),this.shadowBuffer.unbind(),t.getGlobal()||o.multLeft(i.inverse()),this.invLightSpaceProjectionMatrix.assign(o).multRight(u).multRight(t.getBiasMatrix())},setGlobalVariables:function(e){this.modelViewMatrix.get().multDirMatrix(this.direction.assign(this.lightNode.getDirection())).normalize(),this.shadowBuffer&&(this.shadowMatrix.assign(e.getCameraSpaceMatrix().get()).multRight(this.invLightSpaceProjectionMatrix),this.shadowMatrixArray.set(this.shadowMatrix))},setShaderUniforms:function(e,t){const n=t.numLights++;if(this.shadowBuffer){const i=this.lightNode.getGlobal()?this.textureUnit=void 0!==this.textureUnit?this.textureUnit:this.browser.popTexture2DUnit():this.browser.getTexture2DUnit();void 0!==i?(e.activeTexture(e.TEXTURE0+i),e.HAS_FEATURE_DEPTH_TEXTURE?e.bindTexture(e.TEXTURE_2D,this.shadowBuffer.getDepthTexture()):e.bindTexture(e.TEXTURE_2D,this.shadowBuffer.getColorTexture()),e.uniform1i(t.x3d_ShadowMap[n],i)):console.warn("Not enough combined texture units for shadow map available.")}if(t.hasLight(n,this))return;const i=this.lightNode,o=i.getColor(),r=this.direction;if(e.uniform1i(t.x3d_LightType[n],1),e.uniform3f(t.x3d_LightColor[n],o.r,o.g,o.b),e.uniform1f(t.x3d_LightIntensity[n],i.getIntensity()),e.uniform1f(t.x3d_LightAmbientIntensity[n],i.getAmbientIntensity()),e.uniform3f(t.x3d_LightDirection[n],r.x,r.y,r.z),this.shadowBuffer){const o=i.getShadowColor();e.uniform3f(t.x3d_ShadowColor[n],o.r,o.g,o.b),e.uniform1f(t.x3d_ShadowIntensity[n],i.getShadowIntensity()),e.uniform1f(t.x3d_ShadowBias[n],i.getShadowBias()),e.uniformMatrix4fv(t.x3d_ShadowMatrix[n],!1,this.shadowMatrixArray),e.uniform1i(t.x3d_ShadowMapSize[n],i.getShadowMapSize())}},dispose:function(){this.browser.pushShadowBuffer(this.shadowBuffer),this.browser.pushTexture2DUnit(this.textureUnit),this.modelViewMatrix.clear(),this.shadowBuffer=null,this.textureUnit=void 0,Dc.push(this)}},Rc.prototype=Object.assign(Object.create(Mc.prototype),{constructor:Rc,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new P([new N(s.inputOutput,"metadata",new Bn.SFNode),new N(s.inputOutput,"global",new Bn.SFBool(!1)),new N(s.inputOutput,"on",new Bn.SFBool(!0)),new N(s.inputOutput,"color",new Bn.SFColor(1,1,1)),new N(s.inputOutput,"intensity",new Bn.SFFloat(1)),new N(s.inputOutput,"ambientIntensity",new Bn.SFFloat),new N(s.inputOutput,"direction",new Bn.SFVec3f(0,0,-1)),new N(s.inputOutput,"shadows",new Bn.SFBool),new N(s.inputOutput,"shadowColor",new Bn.SFColor),new N(s.inputOutput,"shadowIntensity",new Bn.SFFloat(1)),new N(s.inputOutput,"shadowBias",new Bn.SFFloat(.005)),new N(s.initializeOnly,"shadowMapSize",new Bn.SFInt32(1024))]),getTypeName:function(){return"DirectionalLight"},getComponentName:function(){return"Lighting"},getContainerField:function(){return"children"},getLights:function(){return Dc}});const Vc=Rc,Pc=Symbol(),Ac=Symbol(),Lc=Symbol();function Uc(){this.addChildObjects("activeLayer",new Bn.SFNode,"activeNavigationInfo",new Bn.SFNode,"activeViewpoint",new Bn.SFNode,"availableViewers",new Bn.MFString,"viewer",new Bn.SFString("EXAMINE")),this[Pc]=new Set,this[Ac]=new Tc(this)}Uc.prototype={initialize:function(){this._viewer.addInterest("set_viewer__",this),this.initialized().addInterest("set_world__",this),this.shutdown().addInterest("remove_world__",this),this[Lc]=function(e){const t=new Vc(e.getPrivateScene());t.setup();const n=t.getLights().pop();return n.set(t,null,Nt.Identity),n.dispose=Function.prototype,n}(this),this[Ac].setup()},getHeadlight:function(){return this[Lc]},getActiveLayer:function(){return this._activeLayer.getValue()},getActiveNavigationInfo:function(){return this._activeNavigationInfo.getValue()},getActiveViewpoint:function(){return this._activeViewpoint.getValue()},getCurrentViewer:function(){return this._viewer.getValue()},getViewer:function(){return this[Ac]},addCollision:function(e){this[Pc].add(e)},removeCollision:function(e){this[Pc].delete(e)},getCollisionCount:function(){return this[Pc].size},remove_world__:function(){this.getWorld()._activeLayer.removeInterest("set_activeLayer__",this)},set_world__:function(){this.getWorld()._activeLayer.addInterest("set_activeLayer__",this),this.set_activeLayer__()},set_activeLayer__:function(){this._activeLayer.getValue()&&(this._activeLayer.getValue().getNavigationInfoStack().removeInterest("set_activeNavigationInfo__",this),this._activeLayer.getValue().getViewpointStack().removeInterest("set_activeViewpoint__",this)),this._activeLayer=this.getWorld().getActiveLayer(),this._activeLayer.getValue()&&(this._activeLayer.getValue().getNavigationInfoStack().addInterest("set_activeNavigationInfo__",this),this._activeLayer.getValue().getViewpointStack().addInterest("set_activeViewpoint__",this)),this.set_activeNavigationInfo__(),this.set_activeViewpoint__()},set_activeNavigationInfo__:function(){this._activeNavigationInfo.getValue()&&this._activeNavigationInfo.getValue()._viewer.removeFieldInterest(this._viewer),this._activeLayer.getValue()?(this._activeNavigationInfo=this._activeLayer.getValue().getNavigationInfo(),this._activeNavigationInfo.getValue()._viewer.addFieldInterest(this._viewer),this._viewer=this._activeNavigationInfo.getValue()._viewer):(this._activeNavigationInfo=null,this._viewer="NONE")},set_activeViewpoint__:function(){this._activeLayer.getValue()?this._activeViewpoint=this._activeLayer.getValue().getViewpoint():this._activeViewpoint=null},set_viewer__:function(e){switch(this._activeNavigationInfo.getValue()?this._availableViewers=this._activeNavigationInfo.getValue()._availableViewers:this._availableViewers.length=0,this[Ac]&&this[Ac].dispose(),e.getValue()){case"EXAMINE":default:this[Ac]=new rc(this);break;case"WALK":this[Ac]=new pc(this);break;case"FLY":this[Ac]=new gc(this);break;case"PLANE":case"PLANE_create3000.de":this[Ac]=new bc(this);break;case"NONE":this[Ac]=new Tc(this);break;case"LOOKAT":this[Ac]=new Nc(this)}this[Ac].setup()}};const Bc=Uc;function Xc(){}Xc.prototype={getScriptUrl:function(){if(document.currentScript)var e=document.currentScript.src;else if("object"==typeof i.g&&"function"==typeof i.g.require&&"string"==typeof __filename)e=i.g.require("url").pathToFileURL(__filename).href;else e=document.location.href;return function(){return e}}(),getProviderUrl:function(e){return e?(this.getScriptUrl().match(/\.min\.js$/)&&(e+=".min"),new URL("assets/components/"+e+".js",this.getScriptUrl()).href):"https://create3000.github.io/x_ite/"},getFontsUrl:function(e){return new URL("assets/fonts/"+e,this.getScriptUrl()).href},getLinetypeUrl:function(){return new URL("assets/linetype/linetypes.png",this.getScriptUrl()).href},getHatchingUrl:function(e){return new URL("assets/hatching/"+e+".png",this.getScriptUrl()).href}};const kc=new Xc,zc=Symbol(),jc=Symbol(),Gc=Symbol(),Hc=Symbol(),qc=Symbol();function Wc(){this.addChildObjects("loadCount",new Bn.SFInt32),this[zc]=0,this[jc]=new Set,this[Gc]=!1,this[Hc]=function(e){let t=e.baseURI;return t.startsWith("about:")&&(t=document.baseURI),t}(this.getElement()[0]),this.getCanvas().hide(),this.getBrowserOptions().getSplashScreen()&&(this.getContextMenu().hide(),this.getSplashScreen().show())}Wc.prototype={initialize:function(){},getProviderUrl:function(){return kc.getProviderUrl()},getLocation:function(){return this[Hc]},getDefaultScene:function(){return this[qc]=this.createScene(),this[qc].setPrivate(!0),this[qc].setLive(!0),this[qc].setup(),this.getDefaultScene=function(){return this[qc]},Object.defineProperty(this,"getDefaultScene",{enumerable:!1}),this[qc]},setBrowserLoading:function(e){this[Gc]=e,this.setLoadCount(0),e?(this.resetLoadCount(),this.getShadow().find(".x_ite-private-world-info").remove(),this.getBrowserOptions().getSplashScreen()?(this.getContextMenu().hide(),this.getCanvas().stop(!0,!0).animate({delay:1},1).fadeOut(0),this.getSplashScreen().stop(!0,!0).animate({delay:1},1).fadeIn(0)):this.getCanvas().hide()):this.getBrowserOptions().getSplashScreen()?(this.getSplashScreen().stop(!0,!0).show().fadeOut(2e3),this.getCanvas().stop(!0,!0).hide().fadeIn(2e3)):this.getCanvas().show()},getLoading:function(){return this[Gc]},addLoadCount:function(e){this[jc].has(e)||(++this[zc],this[jc].add(e),this.setLoadCount(this[jc].size),this.setCursor("DEFAULT"))},removeLoadCount:function(e){this[jc].has(e)&&(this[jc].delete(e),this.setLoadCount(this[jc].size))},setLoadCount:function(e){this._loadCount=e;const t=[...this[jc]].reduce(((e,t)=>e+!t.isPrivate()),0);if(e||this[Gc])var n=ai(1==t?"Loading %1 file":"Loading %1 files").replace("%1",t||1);else{n=ai("Loading done");this.setCursor("DEFAULT")}this[Gc]||(this.getNotification()._string=n),this.getSplashScreen().find(".x_ite-private-spinner-text").text(n),this.getSplashScreen().find(".x_ite-private-progressbar div").css("width",100-100*e/this[zc]+"%")},resetLoadCount:function(){this._loadCount=0,this[zc]=0,this[jc].clear()}};const Yc=Wc,Kc=Symbol(),Zc=Symbol(),Qc=Symbol(),$c=Symbol(),Jc=Symbol();function eh(){this[Kc]=new Set,this[Zc]=[new Set],this[Qc]=[],this[$c]=[!1],this[Jc]=0}eh.prototype={initialize:function(){},addTransformSensor:function(e){this[Kc].add(e),this.enablePicking()},removeTransformSensor:function(e){this[Kc].delete(e),this.enablePicking()},addPickSensor:function(e){this[Zc][0].add(e),this.enablePicking()},removePickSensor:function(e){this[Zc][0].delete(e),this.enablePicking()},getPickSensors:function(){return this[Zc]},getPickingHierarchy:function(){return this[Qc]},getPickable:function(){return this[$c]},enablePicking:function(){this[Kc].size||this[Zc][0].size?this._sensorEvents.addInterest("picking",this):this._sensorEvents.removeInterest("picking",this)},picking:function(){const e=Date.now();this.getWorld().traverse(sr.PICKING,null);for(const e of this[Kc])e.process();for(const e of this[Zc][0])e.process();this[Jc]=Date.now()-e},getPickingTime:function(){return this[Jc]}};const th=eh;i(450);var nh=i(755);function ih(e){Jn.call(this,e),this.cursor="DEFAULT",this.isOver=!1,this.motionTime=0}ih.prototype=Object.assign(Object.create(Jn.prototype),{constructor:ih,getTypeName:function(){return"PointingDevice"},initialize:function(){const e=this.getBrowser().getSurface();e.on("mousedown.PointingDevice"+this.getId(),this.mousedown.bind(this)),e.on("mouseup.PointingDevice"+this.getId(),this.mouseup.bind(this)),e.on("dblclick.PointingDevice"+this.getId(),this.dblclick.bind(this)),e.on("mousemove.PointingDevice"+this.getId(),this.mousemove.bind(this)),e.on("mouseout.PointingDevice"+this.getId(),this.onmouseout.bind(this)),e.on("touchstart.PointingDevice"+this.getId(),this.touchstart.bind(this)),e.on("touchend.PointingDevice"+this.getId(),this.touchend.bind(this))},mousewheel:function(e){},mousedown:function(e){const t=this.getBrowser();if(t.getElement().focus(),!(t.getShiftKey()&&t.getControlKey()||0!==e.button)){const n=t.getSurface(),i=n.offset(),o=e.pageX-i.left-parseFloat(n.css("borderLeftWidth")),r=n.innerHeight()-(e.pageY-i.top-parseFloat(n.css("borderTopWidth")));n.off("mousemove.PointingDevice"+this.getId()),nh(document).on("mouseup.PointingDevice"+this.getId(),this.mouseup.bind(this)),nh(document).on("mousemove.PointingDevice"+this.getId(),this.mousemove.bind(this)),nh(document).on("touchend.PointingDevice"+this.getId(),this.touchend.bind(this)),nh(document).on("touchmove.PointingDevice"+this.getId(),this.touchmove.bind(this)),t.buttonPressEvent(o,r)&&(e.preventDefault(),e.stopImmediatePropagation(),t.setCursor("HAND"),t.finished().addInterest("onverifymotion",this,o,r))}},mouseup:function(e){if(e.preventDefault(),0===e.button){const t=this.getBrowser(),n=t.getSurface(),i=n.offset(),o=e.pageX-i.left-parseFloat(n.css("borderLeftWidth")),r=n.innerHeight()-(e.pageY-i.top-parseFloat(n.css("borderTopWidth")));nh(document).off(".PointingDevice"+this.getId()),n.on("mousemove.PointingDevice"+this.getId(),this.mousemove.bind(this)),t.buttonReleaseEvent(),t.setCursor(this.isOver?"HAND":"DEFAULT"),t.finished().addInterest("onverifymotion",this,o,r),t.addBrowserEvent(),this.cursor="DEFAULT"}},dblclick:function(e){this.isOver&&e.stopImmediatePropagation()},mousemove:function(e){e.preventDefault();const t=this.getBrowser();if(this.motionTime===t.getCurrentTime())return;this.motionTime=t.getCurrentTime();const n=t.getSurface(),i=n.offset(),o=e.pageX-i.left-parseFloat(n.css("borderLeftWidth")),r=n.innerHeight()-(e.pageY-i.top-parseFloat(n.css("borderTopWidth")));this.onmotion(o,r)},touchstart:function(e){const t=e.originalEvent.touches;switch(t.length){case 1:{e.button=0,e.pageX=t[0].pageX,e.pageY=t[0].pageY,this.mousedown(e);const n=this.getBrowser().getNearestHit();n&&0!==n.sensors.size||(this.touchX=e.pageX,this.touchY=e.pageY,this.touchTimeout=setTimeout(this.showContextMenu.bind(this,e),1200));break}case 2:this.touchend(e)}},touchend:function(e){e.button=0,this.mouseup(e),clearTimeout(this.touchTimeout)},touchmove:function(e){const t=e.originalEvent.touches;if(1===t.length)e.button=0,e.pageX=t[0].pageX,e.pageY=t[0].pageY,this.mousemove(e),Math.hypot(this.touchX-e.pageX,this.touchY-e.pageY)>7&&clearTimeout(this.touchTimeout)},onmotion:function(e,t){const n=this.getBrowser();n.motionNotifyEvent(e,t)?this.isOver||(this.isOver=!0,this.cursor=n.getCursor(),n.setCursor("HAND")):this.isOver&&(this.isOver=!1,n.setCursor(this.cursor))},onmouseout:function(e){this.getBrowser().leaveNotifyEvent()},onverifymotion:function(e,t){this.getBrowser().finished().removeInterest("onverifymotion",this),this.onmotion(e,t)},showContextMenu:function(e){this.getBrowser().getContextMenu().show(e)}});const oh=ih,rh=Symbol(),sh=Symbol(),ah=Symbol(),uh=Symbol(),lh=Symbol(),ch=Symbol(),hh=Symbol(),dh=Symbol(),ph=Symbol(),fh=Symbol(),gh=Symbol(),mh=Symbol(),_h=Symbol(),yh=Symbol(),xh=new pl(He.Zero,He.Zero);function wh(){this[rh]=new oh(this),this[ah]=new ke(0,0),this[uh]=new pl(He.Zero,He.Zero),this[lh]=[],this[ch]=[new Map],this[dh]=null,this[ph]=new Set,this[fh]=new Set,this[gh]=new ur(this[lh],(function(e,t){return e.intersection.point.z<t.intersection.point.z})),this[_h]=new ur(this[lh],(function(e,t){return e.layerNumber<t.layerNumber})),this[yh]=0}wh.prototype={initialize:function(){this.setCursor("DEFAULT"),this[rh].setup()},setCursor:function(e){const t=this.getSurface();switch(this[sh]=e,e){case"HAND":t.css("cursor","pointer");break;case"MOVE":t.css("cursor","move");break;case"CROSSHAIR":t.css("cursor","crosshair");break;default:this._loadCount.getValue()?t.css("cursor","wait"):this[rh]&&this[rh].isOver?t.css("cursor","pointer"):t.css("cursor","default")}},getCursor:function(){return this[sh]},getPointer:function(){return this[ah]},isPointerInRectangle:function(e){return this[ah].x>e.x&&this[ah].x<e.x+e.z&&this[ah].y>e.y&&this[ah].y<e.y+e.w},setLayerNumber:function(e){this[mh]=e},getSelectedLayer:function(){return this[dh]},setHitRay:function(e,t){nr.unProjectRay(this[ah].x,this[ah].y,Nt.Identity,e,t,this[uh])},getHitRay:function(){return this[uh]},getSensors:function(){return this[ch]},getPickOnlySensors:function(){return this[hh]},addHit:function(e,t,n,i){const o=this[ch].at(-1);this[lh].push({pointer:this[ah],hitRay:this[uh].copy(),intersection:e,sensors:new Set(o.values()),layer:t,layerNumber:this[mh],shape:n,modelViewMatrix:i.copy()})},getHits:function(){return this[lh]},getNearestHit:function(){return this[lh].at(-1)},buttonPressEvent:function(e,t){if(this.touch(e,t,!0),0===this[lh].length)return!1;const n=this.getNearestHit();this[dh]=n.layer,this[fh]=n.sensors;for(const e of this[fh])e.set_active__(!0,n);return!!n.sensors.size},buttonReleaseEvent:function(){this[dh]=null;for(const e of this[fh])e.set_active__(!1,null);return this[fh]=new Set,!0},motionNotifyEvent:function(e,t){return this.touch(e,t,!0),this.motion(),!(!this[lh].length||!this[lh].at(-1).sensors.size)},leaveNotifyEvent:function(){},touch:function(e,t,n){if(this.getViewer()._isActive.getValue())return void(this[yh]=0);const i=Date.now();this[hh]=n,this[ah].set(e,t),this[lh].length=0,this.getWorld().traverse(sr.POINTER,null),this[gh].sort(0,this[lh].length),this[_h].sort(0,this[lh].length),this.addBrowserEvent(),this[yh]=Date.now()-i},motion:function(){if(this[lh].length)var e=this[lh].at(-1);else e={pointer:this[ah],modelViewMatrix:new Nt,hitRay:this[dh]?this[uh]:xh,intersection:null,sensors:new Set,shape:null,layer:null,layerNumber:0};if(this[lh].length)var t=ee.set_difference(this[ph],e.sensors,new Set);else t=new Set(this[ph]);for(const n of t)n.set_over__(!1,e);if(this[lh].length){this[ph]=e.sensors;for(const t of this[ph])t.set_over__(!0,e)}else this[ph]=new Set;for(const t of this[fh])t.set_motion__(e)},getPointerTime:function(){return this[yh]}};const vh=wh;var bh=i(755),Sh=i(87);const Th=Symbol(),Eh=Symbol(),Ch=Symbol(),Oh=Symbol();function Nh(){this[Th]=[0,0,300,150],this[Eh]=[],this[Ch]=new Map}Nh.prototype={initialize:function(){const e=this.getContext();e.enable(e.SCISSOR_TEST),e.depthFunc(e.LEQUAL),e.clearDepth(1),e.blendFuncSeparate(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA,e.ONE,e.ONE_MINUS_SRC_ALPHA),e.blendEquationSeparate(e.FUNC_ADD,e.FUNC_ADD),bh(document).on("webkitfullscreenchange mozfullscreenchange fullscreenchange MSFullscreenChange",this.onfullscreen.bind(this)),this[Oh]=new Sh(this.getSurface(),this.reshape.bind(this)),this.getSurface().css("position",""),this.reshape()},getRenderer:function(){const e=this.getContext();if(!navigator.userAgent.match(/Firefox/)){const t=e.getExtension("WEBGL_debug_renderer_info");if(t)return e.getParameter(t.UNMASKED_RENDERER_WEBGL)}return e.getParameter(e.RENDERER)},getVendor:function(){const e=this.getContext();if(!navigator.userAgent.match(/Firefox/)){const t=e.getExtension("WEBGL_debug_renderer_info");if(t)return e.getParameter(t.UNMASKED_VENDOR_WEBGL)}return e.getParameter(e.VENDOR)},getWebGLVersion:function(){const e=this.getContext();return e.getParameter(e.VERSION)},getAntialiased:function(){const e=this.getContext();return e.getParameter(e.SAMPLES)>0},getMaxClipPlanes:function(){return 6},getDepthSize:function(){const e=this.getContext();return e.getParameter(e.DEPTH_BITS)},getColorDepth:function(){const e=this.getContext();return e.getParameter(e.RED_BITS)+e.getParameter(e.BLUE_BITS)+e.getParameter(e.GREEN_BITS)+e.getParameter(e.ALPHA_BITS)},getViewport:function(){return this[Th]},getLocalObjects:function(){return this[Eh]},getDepthShader:function(e,t){let n="";return n+=e,n+=t?"1":"0",this[Ch].get(n)||this.createDepthShader(n,e,t)},createDepthShader:function(e,t,n){const i=[];t&&(i.push("X3D_CLIP_PLANES"),i.push("X3D_NUM_CLIP_PLANES "+t)),n&&i.push("X3D_PARTICLE_SYSTEM");const o=this.createShader("DepthShader","Depth","Depth",i);return this[Ch].set(e,o),o},reshape:function(){const e=this.getContext(),t=this.getCanvas(),n=t.width(),i=t.height(),o=t[0];o.width=n,o.height=i,this[Th][2]=n,this[Th][3]=i,e.viewport(0,0,n,i),e.scissor(0,0,n,i),this.addBrowserEvent()},onfullscreen:function(){const e=this.getElement();e.fullScreen()?e.addClass("x_ite-fullscreen"):e.removeClass("x_ite-fullscreen")}};const Fh=Nh,Mh=Symbol();function Dh(){this[Mh]=[this]}Dh.prototype={initialize:function(){},isExternal:function(){return 1===this[Mh].length},getScriptStack:function(){return this[Mh]}};const Ih=Dh,Rh={includes:{1:{ClipPlanes:"\n#if defined (X3D_CLIP_PLANES)\n\nuniform vec4 x3d_ClipPlane [X3D_NUM_CLIP_PLANES];\n\nvoid\nclip ()\n{\n   for (int i = 0; i < X3D_NUM_CLIP_PLANES; ++ i)\n   {\n      if (dot (vertex, x3d_ClipPlane [i] .xyz) - x3d_ClipPlane [i] .w < 0.0)\n         discard;\n   }\n}\n\n#endif\n",Colors:"\n#define MANUAL_SRGB\n\nvec4\nSRGBtoLINEAR (const in vec4 srgbIn)\n{\n   #if defined (MANUAL_SRGB)\n      #if defined (SRGB_FAST_APPROXIMATION)\n         vec3 linOut = pow (srgbIn .xyz, vec3 (2.2));\n      #else //SRGB_FAST_APPROXIMATION\n         vec3 bLess  = step (vec3 (0.04045), srgbIn .xyz);\n         vec3 linOut = mix (srgbIn .xyz / vec3 (12.92), pow ((srgbIn .xyz + vec3 (0.055)) / vec3 (1.055), vec3 (2.4)), bLess);\n      #endif //SRGB_FAST_APPROXIMATION\n      return vec4 (linOut, srgbIn .w);\n   #else //MANUAL_SRGB\n      return srgbIn;\n   #endif //MANUAL_SRGB\n}\n\nvec4\nGamma (const in vec4 color)\n{\n   #if defined (MANUAL_SRGB)\n      return vec4 (pow (color .rgb, vec3 (1.0 / 2.2)), color .a);\n   #else\n      return color;\n   #endif\n}\n",Fog:"\n#if defined (X3D_FOG)\n\nuniform x3d_FogParameters x3d_Fog;\n\nfloat\ngetFogInterpolant ()\n{\n   // Returns 0.0 for fog color and 1.0 for material color.\n\n   #if defined (X3D_FOG_COORDS)\n      return clamp (1.0 - fogDepth, 0.0, 1.0);\n   #else\n      float visibilityRange = x3d_Fog .visibilityRange;\n      float dV              = length (x3d_Fog .matrix * vertex);\n\n      #if defined (X3D_FOG_LINEAR)\n         return max (0.0, visibilityRange - dV) / visibilityRange;\n      #elif defined (X3D_FOG_EXPONENTIAL)\n         return exp (-dV / max (0.001, visibilityRange - dV));\n      #endif\n   #endif\n}\n\nvec3\ngetFogColor (const in vec3 color)\n{\n   return mix (x3d_Fog .color, color, getFogInterpolant ());\n}\n\n#endif\n",Fragment:'\n#if defined (X3D_LOGARITHMIC_DEPTH_BUFFER)\n   #extension GL_EXT_frag_depth : enable\n#endif\n\nuniform float x3d_AlphaCutoff;\n\n#if defined (X3D_FOG) && defined (X3D_FOG_COORDS)\n   varying float fogDepth;\n#endif\n\n#if defined (X3D_COLOR_MATERIAL)\n   varying vec4 color;\n#endif\n\n#if ! defined (X3D_GEOMETRY_0D) && ! defined (X3D_GEOMETRY_1D)\n   #if defined (X3D_TEXTURE) || defined (X3D_MATERIAL_TEXTURES)\n      #if X3D_NUM_TEXTURE_COORDINATES > 0\n         varying vec4 texCoord0;\n      #endif\n\n      #if X3D_NUM_TEXTURE_COORDINATES > 1\n         varying vec4 texCoord1;\n      #endif\n   #endif\n#else\n   #if defined (X3D_TEXTURE) || defined (X3D_MATERIAL_TEXTURES)\n      #if X3D_NUM_TEXTURE_COORDINATES > 0\n         vec4 texCoord0 = vec4 (0.0);\n      #endif\n\n      #if X3D_NUM_TEXTURE_COORDINATES > 1\n         vec4 texCoord1 = vec4 (0.0);\n      #endif\n   #endif\n#endif\n\n#if defined (X3D_NORMALS)\n   varying vec3 normal;\n\n   #if defined (X3D_TEXTURE) || defined (X3D_MATERIAL_TEXTURES)\n      varying vec3 localNormal;\n   #endif\n#else\n   const vec3 normal = vec3 (0.0, 0.0, 1.0);\n\n   #if defined (X3D_TEXTURE) || defined (X3D_MATERIAL_TEXTURES)\n      const vec3 localNormal = vec3 (0.0, 0.0, 1.0);\n   #endif\n#endif\n\nvarying vec3 vertex;\n\n#if defined (X3D_TEXTURE) || defined (X3D_MATERIAL_TEXTURES)\n   varying vec3 localVertex;\n#endif\n\n#if defined (X3D_LOGARITHMIC_DEPTH_BUFFER)\n   uniform float x3d_LogarithmicFarFactor1_2;\n   varying float depth;\n#endif\n\n#pragma X3D include "Point.glsl"\n#pragma X3D include "Hatch.glsl"\n#pragma X3D include "Fog.glsl"\n#pragma X3D include "ClipPlanes.glsl"\n#pragma X3D include "Texture.glsl"\n\nvec4\ngetMaterialColor ();\n\nvec4\ngetFinalColor ()\n{\n   #if defined (X3D_GEOMETRY_0D) && defined (X3D_STYLE_PROPERTIES)\n      #if defined (X3D_TEXTURE) || defined (X3D_MATERIAL_TEXTURES)\n         setTexCoords ();\n\n         return getMaterialColor ();\n       #else\n         return getPointColor (getMaterialColor ());\n      #endif\n   #else\n      return getMaterialColor ();\n   #endif\n}\nvoid\nfragment_main ()\n{\n   #if defined (X3D_CLIP_PLANES)\n      clip ();\n   #endif\n\n   vec4 finalColor = getFinalColor ();\n\n   #if (defined (X3D_GEOMETRY_2D) || defined (X3D_GEOMETRY_3D)) && defined (X3D_STYLE_PROPERTIES)\n      finalColor = getHatchColor (finalColor);\n   #endif\n\n   #if defined (X3D_FOG)\n      finalColor .rgb = getFogColor (finalColor .rgb);\n   #endif\n\n   if (finalColor .a < x3d_AlphaCutoff)\n      discard;\n\n   gl_FragColor = finalColor;\n\n   #if defined (X3D_LOGARITHMIC_DEPTH_BUFFER)\n      //http://outerra.blogspot.com/2013/07/logarithmic-depth-buffer-optimizations.html\n      gl_FragDepthEXT = log2 (depth) * x3d_LogarithmicFarFactor1_2;\n   #endif\n}\n',Hatch:"\n#if (defined (X3D_GEOMETRY_2D) || defined (X3D_GEOMETRY_3D)) && defined (X3D_STYLE_PROPERTIES)\n\nuniform x3d_FillPropertiesParameters x3d_FillProperties;\n\nvec4\ngetHatchColor (vec4 color)\n{\n   vec4 finalColor = x3d_FillProperties .filled ? color : vec4 (0.0);\n\n   if (x3d_FillProperties .hatched)\n   {\n      vec4 hatch = texture2D (x3d_FillProperties .texture, gl_FragCoord .xy / 32.0);\n\n      hatch .rgb *= x3d_FillProperties .hatchColor;\n      finalColor  = mix (finalColor, hatch, hatch .a);\n   }\n\n   return finalColor;\n}\n\n#endif\n",Material:'\nuniform x3d_MaterialParameters x3d_Material;\n\n#if defined (X3D_LIGHTING)\n\n#pragma X3D include "SpotFactor.glsl"\n#pragma X3D include "Shadow.glsl"\n\nuniform x3d_LightSourceParameters x3d_LightSource [X3D_NUM_LIGHTS];\n\nvec3\ngetMaterialColor (const in vec3 vertex, const in vec3 N, const in vec3 ambientColor, const in vec3 diffuseColor, const in vec3 specularColor, const in float shininess)\n{\n   // Apply light sources\n\n   vec3 V = normalize (-vertex);\n\n   vec3 finalColor = vec3 (0.0);\n\n   for (int i = 0; i < X3D_NUM_LIGHTS; ++ i)\n   {\n      x3d_LightSourceParameters light = x3d_LightSource [i];\n\n      vec3  vL = light .location - vertex;\n      float dL = length (light .matrix * vL);\n      bool  di = light .type == x3d_DirectionalLight;\n\n      if (di || dL <= light .radius)\n      {\n         vec3 d = light .direction;\n         vec3 c = light .attenuation;\n         vec3 L = di ? -d : normalize (vL);      // Normalized vector from point on geometry to light source i position.\n         vec3 H = normalize (L + V);             // Specular term\n\n         float lightAngle     = max (dot (N, L), 0.0);      // Angle between normal and light ray.\n         vec3  diffuseTerm    = diffuseColor * lightAngle;\n         float specularFactor = shininess > 0.0 ? pow (max (dot (N, H), 0.0), shininess * 128.0) : 1.0;\n         vec3  specularTerm   = specularColor * specularFactor;\n\n         float attenuationFactor     = di ? 1.0 : 1.0 / max (dot (c, vec3 (1.0, dL, dL * dL)), 1.0);\n         float spotFactor            = light .type == x3d_SpotLight ? getSpotFactor (light .cutOffAngle, light .beamWidth, L, d) : 1.0;\n         float attenuationSpotFactor = attenuationFactor * spotFactor;\n         vec3  ambientTerm           = light .ambientIntensity * ambientColor;\n         vec3  diffuseSpecularTerm   = light .intensity * (diffuseTerm + specularTerm);\n\n         #if defined (X3D_FRAGMENT_SHADER) && defined (X3D_SHADOWS)\n            if (lightAngle > 0.0)\n               diffuseSpecularTerm = mix (diffuseSpecularTerm, light .shadowColor, getShadowIntensity (i, light));\n         #endif\n\n         finalColor += attenuationSpotFactor * light .color * (ambientTerm + diffuseSpecularTerm);\n      }\n   }\n\n   return finalColor;\n}\n\n#endif\n',Normal:"\n#if defined (X3D_NORMAL_TEXTURE)\n// Tangent-Bitangent-Normal-Matrix\nmat3\ngetTBNMatrix (const in vec2 texCoord)\n{\n   vec3 pos_dx = dFdx (vertex);\n   vec3 pos_dy = dFdy (vertex);\n   vec3 tex_dx = dFdx (vec3 (texCoord, 0.0));\n   vec3 tex_dy = dFdy (vec3 (texCoord, 0.0));\n   vec3 t      = (tex_dy .t * pos_dx - tex_dx .t * pos_dy) / (tex_dx .s * tex_dy.t - tex_dy .s * tex_dx .t);\n   vec3 N      = normalize (normal); // OR generated face normal: n = normalize (cross (pos_dx, pos_dy));\n   vec3 T      = normalize (t - N * dot (N, t));\n   vec3 B      = normalize (cross (N, T));\n   mat3 tbn    = mat3 (T, B, N);\n\n   return tbn;\n}\n#endif\n\n#if defined (X3D_NORMAL_TEXTURE)\nuniform x3d_NormalTextureParameters x3d_NormalTexture;\n#endif\n\nvec3\ngetNormalVector (const in float normalScale)\n{\n   float facing = gl_FrontFacing ? 1.0 : -1.0;\n\n   // Get normal vector.\n\n   #if defined (X3D_NORMAL_TEXTURE) && ! defined (X3D_NORMAL_TEXTURE_3D)\n      vec3 texCoord = getTexCoord (x3d_NormalTexture .textureTransformMapping, x3d_NormalTexture .textureCoordinateMapping);\n      vec3 scale    = vec3 (vec2 (normalScale), 1.0);\n      mat3 tbn      = getTBNMatrix (texCoord .st);\n\n      #if defined (X3D_NORMAL_TEXTURE_2D)\n         vec3 n = texture2D (x3d_NormalTexture .texture2D, texCoord .st) .rgb;\n      #elif defined (X3D_NORMAL_TEXTURE_CUBE)\n         vec3 n = textureCube (x3d_NormalTexture .textureCube, texCoord) .rgb;\n      #endif\n\n      return normalize (tbn * ((n * 2.0 - 1.0) * scale)) * facing;\n   #else\n      return normalize (normal) * facing;\n   #endif\n}\n",Pack:"\nvec4\npack (const in float value)\n{\n   const vec3 bitShifts = vec3 (255.0,\n                                255.0 * 255.0,\n                                255.0 * 255.0 * 255.0);\n\n   return vec4 (value, fract (value * bitShifts));\n}\n\n#if defined (X3D_DEPTH_TEXTURE)\n\nfloat\nunpack (const in vec4 color)\n{\n   return color .r;\n}\n\n#else\n\nfloat\nunpack (const vec4 color)\n{\n   const vec3 bitShifts = vec3 (1.0 / 255.0,\n                                1.0 / (255.0 * 255.0),\n                                1.0 / (255.0 * 255.0 * 255.0));\n\n   return color .x + dot (color .gba, bitShifts);\n}\n\n#endif\n",Perlin:"\n//https://gist.github.com/patriciogonzalezvivo/670c22f3966e662d2f83\n\nfloat rand (vec2 co) { return fract (sin (dot (co.xy, vec2 (12.9898,78.233))) * 43758.5453); }\nfloat rand (vec2 co, float l) { return rand (vec2 (rand (co), l)); }\nfloat rand (vec2 co, float l, float t) { return rand (vec2 (rand (co, l), t)); }\n\nfloat\nperlin (vec2 p, float dim, float time)\n{\n   const float M_PI = 3.14159265358979323846;\n\n   vec2 pos   = floor (p * dim);\n   vec2 posx  = pos + vec2 (1.0, 0.0);\n   vec2 posy  = pos + vec2 (0.0, 1.0);\n   vec2 posxy = pos + vec2 (1.0);\n\n   float c   = rand (pos,   dim, time);\n   float cx  = rand (posx,  dim, time);\n   float cy  = rand (posy,  dim, time);\n   float cxy = rand (posxy, dim, time);\n\n   vec2 d = fract (p * dim);\n\n   d = -0.5 * cos (d * M_PI) + 0.5;\n\n   float ccx    = mix (c,   cx,    d.x);\n   float cycxy  = mix (cy,  cxy,   d.x);\n   float center = mix (ccx, cycxy, d.y);\n\n   return center * 2.0 - 1.0;\n}\n\nvec3\nperlin (vec3 p)\n{\n   return vec3 (perlin (p.xy, 1.0, 0.0),\n                perlin (p.yz, 1.0, 0.0),\n                perlin (p.zx, 1.0, 0.0));\n}\n",Point:"\n#if defined (X3D_GEOMETRY_0D) && defined (X3D_STYLE_PROPERTIES)\n\nvarying float pointSize;\n\n#if defined (X3D_TEXTURE) || defined (X3D_MATERIAL_TEXTURES)\nvoid\nsetTexCoords ()\n{\n   vec4 texCoord = vec4 (gl_PointCoord .x, 1.0 - gl_PointCoord .y, 0.0, 1.0);\n\n   #if X3D_NUM_TEXTURE_COORDINATES > 0\n      texCoord0 = texCoord;\n   #endif\n\n   #if X3D_NUM_TEXTURE_COORDINATES > 1\n      texCoord1 = texCoord;\n   #endif\n}\n#endif\n\nvec4\ngetPointColor (in vec4 color)\n{\n   if (pointSize > 1.0)\n      color .a *= clamp (pointSize * (0.5 - distance (vec2 (0.5), gl_PointCoord)), 0.0, 1.0);\n\n   else\n      color .a *= pointSize;\n\n   return color;\n}\n\n#endif\n",PointSize:"\n#if defined (X3D_GEOMETRY_0D) && defined (X3D_STYLE_PROPERTIES)\n\nuniform x3d_PointPropertiesParameters x3d_PointProperties;\n\nvarying float pointSize;\n\nfloat\ngetPointSize (const in vec3 vertex)\n{\n   // Determine point size.\n\n   float pointSizeMinValue    = x3d_PointProperties .pointSizeMinValue;\n   float pointSizeMaxValue    = x3d_PointProperties .pointSizeMaxValue;\n   vec3  pointSizeAttenuation = x3d_PointProperties .pointSizeAttenuation;\n   float dL                   = length (vertex);\n   float pointSize            = 0.0;\n\n   pointSize  = x3d_PointProperties .pointSizeScaleFactor;\n   pointSize /= dot (pointSizeAttenuation, vec3 (1.0, dL, dL * dL));\n   pointSize  = clamp (pointSize, pointSizeMinValue, pointSizeMaxValue);\n\n   #if defined (X3D_TEXTURE) || defined (X3D_MATERIAL_TEXTURE)\n      return pointSize;\n   #else\n      return pointSize + 1.0 - step (pointSize, 1.0);\n   #endif\n}\n\n#endif\n",Shadow:'\n#if defined (X3D_FRAGMENT_SHADER) && defined (X3D_SHADOWS)\n\n#pragma X3D include "Pack.glsl"\n\nuniform sampler2D x3d_ShadowMap [X3D_NUM_LIGHTS];\n\nfloat\ngetShadowDepth (const in int index, const in vec2 shadowCoord)\n{\n   #if X3D_NUM_LIGHTS > 0\n   if (index == 0)\n      return unpack (texture2D (x3d_ShadowMap [0], shadowCoord));\n   #endif\n\n   #if X3D_NUM_LIGHTS > 1\n   if (index == 1)\n      return unpack (texture2D (x3d_ShadowMap [1], shadowCoord));\n   #endif\n\n   #if X3D_NUM_LIGHTS > 2\n   if (index == 2)\n      return unpack (texture2D (x3d_ShadowMap [2], shadowCoord));\n   #endif\n\n   #if X3D_NUM_LIGHTS > 3\n   if (index == 3)\n      return unpack (texture2D (x3d_ShadowMap [3], shadowCoord));\n   #endif\n\n   #if X3D_NUM_LIGHTS > 4\n   if (index == 4)\n      return unpack (texture2D (x3d_ShadowMap [4], shadowCoord));\n   #endif\n\n   #if X3D_NUM_LIGHTS > 5\n   if (index == 5)\n      return unpack (texture2D (x3d_ShadowMap [5], shadowCoord));\n   #endif\n\n   #if X3D_NUM_LIGHTS > 6\n   if (index == 6)\n      return unpack (texture2D (x3d_ShadowMap [6], shadowCoord));\n   #endif\n\n   #if X3D_NUM_LIGHTS > 7\n   if (index == 7)\n      return unpack (texture2D (x3d_ShadowMap [7], shadowCoord));\n   #endif\n\n   return 0.0;\n}\n\nfloat\ntexture2DCompare (const in int index, const in vec2 texCoord, const in float compare)\n{\n   float shadowDepth = getShadowDepth (index, texCoord);\n\n   return (1.0 - step (1.0, shadowDepth)) * step (shadowDepth, compare);\n}\n\nfloat\ntexture2DShadowLerp (const in int index, const in vec2 texelSize, const in float shadowMapSize, const in vec2 texCoord, const in float compare)\n{\n   const vec2 offset = vec2 (0.0, 1.0);\n\n   vec2 centroidTexCoord = floor (texCoord * shadowMapSize + 0.5) / shadowMapSize;\n\n   float lb = texture2DCompare (index, centroidTexCoord + texelSize * offset .xx, compare);\n   float lt = texture2DCompare (index, centroidTexCoord + texelSize * offset .xy, compare);\n   float rb = texture2DCompare (index, centroidTexCoord + texelSize * offset .yx, compare);\n   float rt = texture2DCompare (index, centroidTexCoord + texelSize * offset .yy, compare);\n\n   vec2 f = fract (texCoord * shadowMapSize + 0.5);\n\n   float a = mix (lb, lt, f.y);\n   float b = mix (rb, rt, f.y);\n   float c = mix (a, b, f.x);\n\n   return c;\n}\n\n//https://gist.github.com/tschw/da10c43c467ce8afd0c4\nvec2\ncubeToUVCompact (in vec3 v, const float texelSizeY)\n{\n   // Compact layout:\n   //\n   // xzXZ\t\tChar: Axis\n   // yyYY\t\tCase: Sign\n\n   // Number of texels to avoid at the edge of each square\n\n   vec3 absV = abs (v);\n\n   // Intersect unit cube\n\n   float scaleToCube = 1.0 / max (absV .x, max (absV .y, absV .z));\n\n   absV *= scaleToCube;\n\n   // Apply scale to avoid seams\n\n   // one texel less per square (half a texel on each side)\n   v *= scaleToCube * (1.0 - 2.0 * texelSizeY);\n\n   // Unwrap\n\n   // space: -1 ... 1 range for each square\n   //\n   // #X##\t\tdim    := ( 4 , 2 )\n   //  # #\t\tcenter := ( 1 , 1 )\n\n   vec2 planar = v .xy;\n\n   float almostATexel = 1.5 * texelSizeY;\n   float almostOne    = 1.0 - almostATexel;\n\n   if (absV .z >= almostOne)\n   {\n      // zZ\n\n      if (v .z > 0.0)\n         planar .x = 4.0 - v .x;\n   }\n   else if (absV .x >= almostOne)\n   {\n      // xX\n\n      float signX = sign (v .x);\n\n      planar .x = v .z * signX + 2.0 * signX;\n   }\n   else if (absV .y >= almostOne)\n   {\n      // yY\n\n      float signY = sign (v .y);\n\n      planar .x = (v .x + 0.5 + signY) * 2.0;\n      planar .y = v .z * signY - 2.0;\n   }\n\n   // Transform to UV space\n\n   // scale := 0.5 / dim\n   // translate := ( center + 0.5 ) / dim\n   return vec2 (0.125, 0.25) * planar + vec2 (0.375, 0.75);\n}\n\nmat4\ngetPointLightRotations (const in vec3 vector)\n{\n   mat4 rotations [6];\n   rotations [0] = mat4 ( 0, 0 , 1, 0,   0, 1,  0, 0,  -1,  0,  0, 0,   0, 0, 0, 1);  // left\n   rotations [1] = mat4 ( 0, 0, -1, 0,   0, 1,  0, 0,   1,  0,  0, 0,   0, 0, 0, 1);  // right\n   rotations [2] = mat4 (-1, 0,  0, 0,   0, 1,  0, 0,   0,  0, -1, 0,   0, 0, 0, 1);  // front\n   rotations [3] = mat4 ( 1, 0,  0, 0,   0, 1,  0, 0,   0,  0,  1, 0,   0, 0, 0, 1);  // back\n   rotations [4] = mat4 ( 1, 0,  0, 0,   0, 0,  1, 0,   0, -1,  0, 0,   0, 0, 0, 1);  // bottom\n   rotations [5] = mat4 ( 1, 0,  0, 0,   0, 0, -1, 0,   0,  1,  0, 0,   0, 0, 0, 1);  // top\n\n   vec3 a = abs (vector .xyz);\n\n   if (a .x > a .y)\n   {\n      if (a .x > a .z)\n         return vector .x > 0.0 ? rotations [1] : rotations [0];\n      else\n         return vector .z > 0.0 ? rotations [2] : rotations [3];\n   }\n   else\n   {\n      if (a .y > a .z)\n         return vector .y > 0.0 ? rotations [5] : rotations [4];\n      else\n         return vector .z > 0.0 ? rotations [2] : rotations [3];\n   }\n\n   return rotations [3];\n}\n\n// DEBUG\n//vec4 tex;\n\nfloat\ngetShadowIntensity (const in int index, const in x3d_LightSourceParameters light)\n{\n   if (light .type == x3d_PointLight)\n   {\n      const mat4 biasMatrix = mat4 (0.5, 0.0, 0.0, 0.0,\n                                    0.0, 0.5, 0.0, 0.0,\n                                    0.0, 0.0, 0.5, 0.0,\n                                    0.5, 0.5, 0.5, 1.0);\n\n      const mat4 projectionMatrix = mat4 (1.0, 0.0, 0.0, 0.0, 0.0, 0.5, 0.0, 0.0, 0.0, 0.0, -1.000025000312504, -1.0, 0, 0.0, -0.25000312503906297, 0.0);\n\n      vec2 texelSize = vec2 (1.0) / (float (light .shadowMapSize) * vec2 (4.0, 2.0));\n\n      // for point lights, the uniform @vShadowCoord is re-purposed to hold\n      // the vector from the light to the world-space position of the fragment.\n      vec4 shadowCoord     = light .shadowMatrix * vec4 (vertex, 1.0);\n      vec3 lightToPosition = shadowCoord .xyz;\n\n      shadowCoord       = biasMatrix * (projectionMatrix * (getPointLightRotations (lightToPosition) * shadowCoord));\n      shadowCoord .z   -= light .shadowBias;\n      shadowCoord .xyz /= shadowCoord .w;\n\n      // DEBUG\n      //tex = texture2D (x3d_ShadowMap [0], cubeToUVCompact (lightToPosition, texelSize .y));\n\n      #if defined (X3D_PCF_FILTERING) || defined (X3D_PCF_SOFT_FILTERING)\n\n         vec2 offset = vec2 (-1, 1) * (texelSize .y * 42.0);\n\n         float value = (\n            texture2DCompare (index, cubeToUVCompact (lightToPosition + offset .xyy, texelSize .y), shadowCoord .z) +\n            texture2DCompare (index, cubeToUVCompact (lightToPosition + offset .yyy, texelSize .y), shadowCoord .z) +\n            texture2DCompare (index, cubeToUVCompact (lightToPosition + offset .xyx, texelSize .y), shadowCoord .z) +\n            texture2DCompare (index, cubeToUVCompact (lightToPosition + offset .yyx, texelSize .y), shadowCoord .z) +\n            texture2DCompare (index, cubeToUVCompact (lightToPosition, texelSize .y), shadowCoord .z) +\n            texture2DCompare (index, cubeToUVCompact (lightToPosition + offset .xxy, texelSize .y), shadowCoord .z) +\n            texture2DCompare (index, cubeToUVCompact (lightToPosition + offset .yxy, texelSize .y), shadowCoord .z) +\n            texture2DCompare (index, cubeToUVCompact (lightToPosition + offset .xxx, texelSize .y), shadowCoord .z) +\n            texture2DCompare (index, cubeToUVCompact (lightToPosition + offset .yxx, texelSize .y), shadowCoord .z)\n         ) * (1.0 / 9.0);\n\n         return light .shadowIntensity * value;\n\n      #else // no percentage-closer filtering\n\n         float value = texture2DCompare (index, cubeToUVCompact (lightToPosition, texelSize .y), shadowCoord .z);\n\n         return light .shadowIntensity * value;\n\n      #endif\n   }\n   else\n   {\n      #if defined (X3D_PCF_FILTERING)\n\n         vec2 texelSize   = vec2 (1.0) / vec2 (light .shadowMapSize);\n         vec4 shadowCoord = light .shadowMatrix * vec4 (vertex, 1.0);\n\n         shadowCoord .z   -= light .shadowBias;\n         shadowCoord .xyz /= shadowCoord .w;\n\n         float dx0 = - texelSize .x;\n         float dy0 = - texelSize .y;\n         float dx1 = + texelSize .x;\n         float dy1 = + texelSize .y;\n\n         float value = (\n            texture2DCompare (index, shadowCoord .xy + vec2 (dx0, dy0), shadowCoord .z) +\n            texture2DCompare (index, shadowCoord .xy + vec2 (0.0, dy0), shadowCoord .z) +\n            texture2DCompare (index, shadowCoord .xy + vec2 (dx1, dy0), shadowCoord .z) +\n            texture2DCompare (index, shadowCoord .xy + vec2 (dx0, 0.0), shadowCoord .z) +\n            texture2DCompare (index, shadowCoord .xy, shadowCoord .z) +\n            texture2DCompare (index, shadowCoord .xy + vec2 (dx1, 0.0), shadowCoord .z) +\n            texture2DCompare (index, shadowCoord .xy + vec2 (dx0, dy1), shadowCoord .z) +\n            texture2DCompare (index, shadowCoord .xy + vec2 (0.0, dy1), shadowCoord .z) +\n            texture2DCompare (index, shadowCoord .xy + vec2 (dx1, dy1), shadowCoord .z)\n         ) * (1.0 / 9.0);\n\n         return light .shadowIntensity * value;\n\n      #elif defined (X3D_PCF_SOFT_FILTERING)\n\n         vec2 texelSize   = vec2 (1.0) / vec2 (light .shadowMapSize);\n         vec4 shadowCoord = light .shadowMatrix * vec4 (vertex, 1.0);\n\n         shadowCoord .z   -= light .shadowBias;\n         shadowCoord .xyz /= shadowCoord .w;\n\n         float dx0 = - texelSize.x;\n         float dy0 = - texelSize.y;\n         float dx1 = + texelSize.x;\n         float dy1 = + texelSize.y;\n\n         float value = (\n            texture2DShadowLerp (index, texelSize, float (shadowMapSize), shadowCoord .xy + vec2 (dx0, dy0), shadowCoord .z) +\n            texture2DShadowLerp (index, texelSize, float (shadowMapSize), shadowCoord .xy + vec2 (0.0, dy0), shadowCoord .z) +\n            texture2DShadowLerp (index, texelSize, float (shadowMapSize), shadowCoord .xy + vec2 (dx1, dy0), shadowCoord .z) +\n            texture2DShadowLerp (index, texelSize, float (shadowMapSize), shadowCoord .xy + vec2 (dx0, 0.0), shadowCoord .z) +\n            texture2DShadowLerp (index, texelSize, float (shadowMapSize), shadowCoord .xy, shadowCoord .z) +\n            texture2DShadowLerp (index, texelSize, float (shadowMapSize), shadowCoord .xy + vec2 (dx1, 0.0), shadowCoord .z) +\n            texture2DShadowLerp (index, texelSize, float (shadowMapSize), shadowCoord .xy + vec2 (dx0, dy1), shadowCoord .z) +\n            texture2DShadowLerp (index, texelSize, float (shadowMapSize), shadowCoord .xy + vec2 (0.0, dy1), shadowCoord .z) +\n            texture2DShadowLerp (index, texelSize, float (shadowMapSize), shadowCoord .xy + vec2 (dx1, dy1), shadowCoord .z)\n         ) * ( 1.0 / 9.0 );\n\n         return light .shadowIntensity * value;\n\n      #else // no percentage-closer filtering\n\n         vec4 shadowCoord = shadowMatrix * vec4 (vertex, 1.0);\n\n         shadowCoord .z   -= shadowBias;\n         shadowCoord .xyz /= shadowCoord .w;\n\n         float value = texture2DCompare (index, shadowCoord .xy, shadowCoord .z);\n\n         return light .shadowIntensity * value;\n\n      #endif\n   }\n\n   return 0.0;\n}\n\n#endif\n',SpotFactor:"\nfloat\ngetSpotFactor (const in float cutOffAngle, const in float beamWidth, const in vec3 L, const in vec3 d)\n{\n   float spotAngle = acos (clamp (dot (-L, d), -1.0, 1.0));\n\n   if (spotAngle >= cutOffAngle)\n      return 0.0;\n   else if (spotAngle <= beamWidth)\n      return 1.0;\n\n   return (spotAngle - cutOffAngle) / (beamWidth - cutOffAngle);\n}\n",Texture:'\n#if defined (X3D_TEXTURE) || defined (X3D_MATERIAL_TEXTURES)\n\n#pragma X3D include "Perlin.glsl"\n\nuniform mat4 x3d_TextureMatrix [X3D_NUM_TEXTURE_TRANSFORMS];\n\nmat4\ngetTextureMatrix (const in int i)\n{\n   #if defined (X3D_MULTI_TEXTURING)\n      mat4 textureMatrix = mat4 (0.0);\n\n      #if X3D_NUM_TEXTURE_TRANSFORMS > 0\n      if (i == 0)\n         textureMatrix = x3d_TextureMatrix [0];\n      #endif\n\n      #if X3D_NUM_TEXTURE_TRANSFORMS > 1\n      else if (i == 1)\n         textureMatrix = x3d_TextureMatrix [1];\n      #endif\n\n      return textureMatrix;\n   #else\n      return x3d_TextureMatrix [0];\n   #endif\n}\n\nvec4\ngetTexCoord (const in int i)\n{\n   #if defined (X3D_MULTI_TEXTURING)\n      vec4 texCoord = vec4 (0.0);\n\n      #if X3D_NUM_TEXTURE_COORDINATES > 0\n      if (i == 0)\n         texCoord = texCoord0;\n      #endif\n\n      #if X3D_NUM_TEXTURE_COORDINATES > 1\n      else if (i == 1)\n         texCoord = texCoord1;\n      #endif\n\n      return texCoord;\n   #else\n      return texCoord0;\n   #endif\n}\n\nvec4\ngetTexCoord (const in x3d_TextureCoordinateGeneratorParameters textureCoordinateGenerator, const in int textureTransformMapping, const in int textureCoordinateMapping)\n{\n   int mode = textureCoordinateGenerator .mode;\n\n   if (mode == x3d_None)\n   {\n      return getTextureMatrix (textureTransformMapping) * getTexCoord (textureCoordinateMapping);\n   }\n   else if (mode == x3d_Sphere)\n   {\n      vec2 N = normalize (gl_FrontFacing ? normal : -normal) .xy;\n\n      return vec4 (N * 0.5 + 0.5, 0.0, 1.0);\n   }\n   else if (mode == x3d_CameraSpaceNormal)\n   {\n      vec3 N = normalize (gl_FrontFacing ? normal : -normal);\n\n      return vec4 (N, 1.0);\n   }\n   else if (mode == x3d_CameraSpacePosition)\n   {\n      return vec4 (vertex, 1.0);\n   }\n   else if (mode == x3d_CameraSpaceReflectionVector)\n   {\n      vec3 N = normalize (gl_FrontFacing ? normal : -normal);\n\n      return vec4 (reflect (normalize (vertex), -N), 1.0);\n   }\n   else if (mode == x3d_SphereLocal)\n   {\n      vec2 N = normalize (gl_FrontFacing ? localNormal : -localNormal) .xy;\n\n      return vec4 (N * 0.5 + 0.5, 0.0, 1.0);\n   }\n   else if (mode == x3d_Coord)\n   {\n      return vec4 (localVertex, 1.0);\n   }\n   else if (mode == x3d_CoordEye)\n   {\n      return vec4 (vertex, 1.0);\n   }\n   else if (mode == x3d_Noise)\n   {\n      vec3 scale       = vec3 (textureCoordinateGenerator .parameter [0], textureCoordinateGenerator .parameter [1], textureCoordinateGenerator .parameter [2]);\n      vec3 translation = vec3 (textureCoordinateGenerator .parameter [3], textureCoordinateGenerator .parameter [4], textureCoordinateGenerator .parameter [5]);\n\n      return vec4 (perlin (localVertex * scale + translation), 1.0);\n   }\n   else if (mode == x3d_NoiseEye)\n   {\n      vec3 scale       = vec3 (textureCoordinateGenerator .parameter [0], textureCoordinateGenerator .parameter [1], textureCoordinateGenerator .parameter [2]);\n      vec3 translation = vec3 (textureCoordinateGenerator .parameter [3], textureCoordinateGenerator .parameter [4], textureCoordinateGenerator .parameter [5]);\n\n      return vec4 (perlin (vertex * scale + translation), 1.0);\n   }\n   else if (mode == x3d_SphereReflect)\n   {\n      vec3  N   = normalize (gl_FrontFacing ? normal : -normal);\n      float eta = textureCoordinateGenerator .parameter [0];\n\n      return vec4 (refract (normalize (vertex), -N, eta), 1.0);\n   }\n   else if (mode == x3d_SphereReflectLocal)\n   {\n      vec3  N   = normalize (gl_FrontFacing ? localNormal : -localNormal);\n      float eta = textureCoordinateGenerator .parameter [0];\n      vec3  eye = vec3 (textureCoordinateGenerator .parameter [1], textureCoordinateGenerator .parameter [2], textureCoordinateGenerator .parameter [3]);\n\n      return vec4 (refract (normalize (localVertex - eye), -N, eta), 1.0);\n   }\n\n   return getTextureMatrix (textureTransformMapping) * getTexCoord (textureCoordinateMapping);\n}\n\nuniform x3d_TextureCoordinateGeneratorParameters x3d_TextureCoordinateGenerator [X3D_NUM_TEXTURE_COORDINATES];\n\nvec3\ngetTexCoord (const in int textureTransformMapping, const in int textureCoordinateMapping)\n{\n   vec4 texCoord;\n\n   #if X3D_NUM_TEXTURE_COORDINATES > 0\n   if (textureCoordinateMapping == 0)\n      texCoord = getTexCoord (x3d_TextureCoordinateGenerator [0], textureTransformMapping, textureCoordinateMapping);\n   #endif\n\n   #if X3D_NUM_TEXTURE_COORDINATES > 1\n   else if (textureCoordinateMapping == 1)\n      texCoord = getTexCoord (x3d_TextureCoordinateGenerator [1], textureTransformMapping, textureCoordinateMapping);\n   #endif\n\n   texCoord .stp /= texCoord .q;\n\n   #if defined (X3D_GEOMETRY_2D)\n      if (gl_FrontFacing == false)\n         texCoord .s = 1.0 - texCoord .s;\n   #endif\n\n   return texCoord .stp;\n}\n\n#endif // X3D_TEXTURE || X3D_MATERIAL_TEXTURES\n\n#if defined (X3D_TEXTURE)\n\nuniform sampler2D   x3d_Texture2D [X3D_NUM_TEXTURES];\nuniform samplerCube x3d_TextureCube [X3D_NUM_TEXTURES];\n\n#if defined (X3D_MULTI_TEXTURING)\nvec4\ngetTexture (const in int i, const in vec3 texCoord)\n{\n   vec4 textureColor = vec4 (0.0);\n\n   #if X3D_NUM_TEXTURES > 0\n   if (i == 0)\n   {\n      #if defined (X3D_TEXTURE0_2D)\n         textureColor = texture2D (x3d_Texture2D [0], texCoord .st);\n      #elif defined (X3D_TEXTURE0_CUBE)\n         textureColor = textureCube (x3d_TextureCube [0], texCoord .stp);\n      #endif\n   }\n   #endif\n\n   #if X3D_NUM_TEXTURES > 1\n   else if (i == 1)\n   {\n      #if defined (X3D_TEXTURE0_2D)\n         textureColor = texture2D (x3d_Texture2D [1], texCoord .st);\n      #elif defined (X3D_TEXTURE0_CUBE)\n         textureColor = textureCube (x3d_TextureCube [1], texCoord .stp);\n      #endif\n   }\n   #endif\n\n   return textureColor;\n}\n#endif\n\n#if defined (X3D_MULTI_TEXTURING)\n   uniform vec4 x3d_MultiTextureColor;\n   uniform x3d_MultiTextureParameters x3d_MultiTexture [X3D_NUM_TEXTURES];\n#endif\n\nvec4\ngetTextureColor (const in vec4 diffuseColor, const in vec4 specularColor)\n{\n   #if defined (X3D_MULTI_TEXTURING)\n      vec4 currentColor = diffuseColor;\n\n      for (int i = 0; i < X3D_NUM_TEXTURES; ++ i)\n      {\n         // Get texture color.\n\n         vec3 texCoord     = getTexCoord (i, i);\n         vec4 textureColor = getTexture (i, texCoord);\n\n         // Multi texturing\n\n         x3d_MultiTextureParameters multiTexture = x3d_MultiTexture [i];\n\n         vec4 arg1 = textureColor;\n         vec4 arg2 = currentColor;\n\n         // Source\n\n         int source = multiTexture .source;\n\n         if (source == x3d_Diffuse)\n         {\n            arg1 = diffuseColor;\n         }\n         else if (source == x3d_Specular)\n         {\n            arg1 = specularColor;\n         }\n         else if (source == x3d_Factor)\n         {\n            arg1 = x3d_MultiTextureColor;\n         }\n\n         // Function\n\n         int function = multiTexture .function;\n\n         if (function == x3d_Complement)\n         {\n            arg1 = 1.0 - arg1;\n         }\n         else if (function == x3d_AlphaReplicate)\n         {\n            arg1 .a = arg2 .a;\n         }\n\n         // Mode\n\n         int mode      = multiTexture .mode;\n         int alphaMode = multiTexture .alphaMode;\n\n         // RGB\n\n         if (mode == x3d_Replace)\n         {\n            currentColor .rgb = arg1 .rgb;\n         }\n         else if (mode == x3d_Modulate)\n         {\n            currentColor .rgb = arg1 .rgb * arg2 .rgb;\n         }\n         else if (mode == x3d_Modulate2X)\n         {\n            currentColor .rgb = (arg1 .rgb * arg2 .rgb) * 2.0;\n         }\n         else if (mode == x3d_Modulate4X)\n         {\n            currentColor .rgb = (arg1 .rgb * arg2 .rgb) * 4.0;\n         }\n         else if (mode == x3d_Add)\n         {\n            currentColor .rgb = arg1 .rgb + arg2 .rgb;\n         }\n         else if (mode == x3d_AddSigned)\n         {\n            currentColor .rgb = arg1 .rgb + arg2 .rgb - 0.5;\n         }\n         else if (mode == x3d_AddSigned2X)\n         {\n            currentColor .rgb = (arg1 .rgb + arg2 .rgb - 0.5) * 2.0;\n         }\n         else if (mode == x3d_AddSmooth)\n         {\n            currentColor .rgb = arg1 .rgb + (1.0 - arg1 .rgb) * arg2 .rgb;\n         }\n         else if (mode == x3d_Subtract)\n         {\n            currentColor .rgb = arg1 .rgb - arg2 .rgb;\n         }\n         else if (mode == x3d_BlendDiffuseAlpha)\n         {\n            currentColor .rgb = arg1 .rgb * diffuseColor .a + arg2 .rgb * (1.0 - diffuseColor .a);\n         }\n         else if (mode == x3d_BlendTextureAlpha)\n         {\n            currentColor .rgb = arg1 .rgb * arg1 .a + arg2 .rgb * (1.0 - arg1 .a);\n         }\n         else if (mode == x3d_BlendFactorAlpha)\n         {\n            currentColor .rgb = arg1 .rgb * x3d_MultiTextureColor .a + arg2 .rgb * (1.0 - x3d_MultiTextureColor .a);\n         }\n         else if (mode == x3d_BlendCurrentAlpha)\n         {\n            currentColor .rgb = arg1 .rgb * arg2 .a + arg2 .rgb * (1.0 - arg2 .a);\n         }\n         else if (mode == x3d_ModulateAlphaAddColor)\n         {\n            currentColor .rgb = arg1 .rgb + arg1 .a * arg2 .rgb;\n         }\n         else if (mode == x3d_ModulateInvAlphaAddColor)\n         {\n            currentColor .rgb = (1.0 - arg1 .a) * arg2 .rgb + arg1 .rgb;\n         }\n         else if (mode == x3d_ModulateInvColorAddAlpha)\n         {\n            currentColor .rgb = (1.0 - arg1 .rgb) * arg2 .rgb + arg1 .a;\n         }\n         else if (mode == x3d_DotProduct3)\n         {\n            currentColor .rgb = vec3 (dot (arg1 .rgb * 2.0 - 1.0, arg2 .rgb * 2.0 - 1.0));\n         }\n         else if (mode == x3d_SelectArg1)\n         {\n            currentColor .rgb = arg1 .rgb;\n         }\n         else if (mode == x3d_SelectArg2)\n         {\n            currentColor .rgb = arg2 .rgb;\n         }\n         else if (mode == x3d_Off)\n            ;\n\n         // Alpha\n\n         if (alphaMode == x3d_Replace)\n         {\n            currentColor .a = arg1 .a;\n         }\n         else if (alphaMode == x3d_Modulate)\n         {\n            currentColor .a = arg1 .a * arg2 .a;\n         }\n         else if (alphaMode == x3d_Modulate2X)\n         {\n            currentColor .a = (arg1 .a * arg2 .a) * 2.0;\n         }\n         else if (alphaMode == x3d_Modulate4X)\n         {\n            currentColor .a = (arg1 .a * arg2 .a) * 4.0;\n         }\n         else if (alphaMode == x3d_Add)\n         {\n            currentColor .a = arg1 .a + arg2 .a;\n         }\n         else if (alphaMode == x3d_AddSigned)\n         {\n            currentColor .a = arg1 .a + arg2 .a - 0.5;\n         }\n         else if (alphaMode == x3d_AddSigned2X)\n         {\n            currentColor .a = (arg1 .a + arg2 .a - 0.5) * 2.0;\n         }\n         else if (alphaMode == x3d_AddSmooth)\n         {\n            currentColor .a = arg1 .a + (1.0 - arg1 .a) * arg2 .a;\n         }\n         else if (alphaMode == x3d_Subtract)\n         {\n            currentColor .a = arg1 .a - arg2 .a;\n         }\n         else if (alphaMode == x3d_BlendDiffuseAlpha)\n         {\n            currentColor .a = arg1 .a * diffuseColor .a + arg2 .a * (1.0 - diffuseColor .a);\n         }\n         else if (alphaMode == x3d_BlendTextureAlpha)\n         {\n            currentColor .a = arg1 .a * arg1 .a + arg2 .a * (1.0 - arg1 .a);\n         }\n         else if (alphaMode == x3d_BlendFactorAlpha)\n         {\n            currentColor .a = arg1 .a * x3d_MultiTextureColor .a + arg2 .a * (1.0 - x3d_MultiTextureColor .a);\n         }\n         else if (alphaMode == x3d_BlendCurrentAlpha)\n         {\n            currentColor .a = arg1 .a * arg2 .a + arg2 .a * (1.0 - arg2 .a);\n         }\n         else if (alphaMode == x3d_ModulateAlphaAddColor)\n         {\n            currentColor .a = arg1 .a + arg1 .a * arg2 .a;\n         }\n         else if (alphaMode == x3d_ModulateInvAlphaAddColor)\n         {\n            currentColor .a = (1.0 - arg1 .a) * arg2 .a + arg1 .a;\n         }\n         else if (alphaMode == x3d_ModulateInvColorAddAlpha)\n         {\n            currentColor .a = (1.0 - arg1 .a) * arg2 .a + arg1 .a;\n         }\n         else if (alphaMode == x3d_DotProduct3)\n         {\n            currentColor .a = dot (arg1 .rgb * 2.0 - 1.0, arg2 .rgb * 2.0 - 1.0);\n         }\n         else if (alphaMode == x3d_SelectArg1)\n         {\n            currentColor .a = arg1 .a;\n         }\n         else if (alphaMode == x3d_SelectArg2)\n         {\n            currentColor .a = arg2 .a;\n         }\n         else if (alphaMode == x3d_Off)\n            ;\n      }\n\n      return currentColor;\n   #else\n      // Get texture color.\n\n      vec3 texCoord = getTexCoord (0, 0);\n\n      #if defined (X3D_TEXTURE0_2D)\n         vec4 textureColor = texture2D (x3d_Texture2D [0], texCoord .st);\n      #elif defined (X3D_TEXTURE0_CUBE)\n         vec4 textureColor = textureCube (x3d_TextureCube [0], texCoord .stp);\n      #endif\n\n      return diffuseColor * textureColor;\n   #endif\n}\n\n#endif\n\n#if defined (X3D_PROJECTIVE_TEXTURE_MAPPING)\n\nuniform sampler2D x3d_ProjectiveTexture [X3D_NUM_TEXTURE_PROJECTORS];\nuniform mat4      x3d_ProjectiveTextureMatrix [X3D_NUM_TEXTURE_PROJECTORS];\nuniform vec3      x3d_ProjectiveTextureLocation [X3D_NUM_TEXTURE_PROJECTORS];\n\nvec4\ngetProjectiveTexture (const in int i, const in vec2 texCoord)\n{\n   vec4 color = vec4 (0.0);\n\n   #if X3D_NUM_TEXTURE_PROJECTORS > 0\n   if (i == 0)\n      color = texture2D (x3d_ProjectiveTexture [0], texCoord);\n   #endif\n\n   #if X3D_NUM_TEXTURE_PROJECTORS > 1\n   else if (i == 1)\n      color = texture2D (x3d_ProjectiveTexture [1], texCoord);\n   #endif\n\n   return color;\n}\n\nvec4\ngetProjectiveTextureColor (in vec4 currentColor)\n{\n   vec3 N = gl_FrontFacing ? normal : -normal;\n\n   for (int i = 0; i < X3D_NUM_TEXTURE_PROJECTORS; ++ i)\n   {\n      vec4 texCoord = x3d_ProjectiveTextureMatrix [i] * vec4 (vertex, 1.0);\n\n      texCoord .stp /= texCoord .q;\n\n      if (texCoord .s < 0.0 || texCoord .s > 1.0)\n         continue;\n\n      if (texCoord .t < 0.0 || texCoord .t > 1.0)\n         continue;\n\n      if (texCoord .p < 0.0 || texCoord .p > 1.0)\n         continue;\n\n      // We do not need to normalze p, as we only need the sign of the dot product.\n      vec3 p = x3d_ProjectiveTextureLocation [i] - vertex;\n\n      if (dot (N, p) < 0.0)\n         continue;\n\n      currentColor *= getProjectiveTexture (i, texCoord .st);\n   }\n\n   return currentColor;\n}\n\n#endif // X3D_PROJECTIVE_TEXTURE_MAPPING\n',Vertex:'\n// Uniforms\n\nuniform mat4 x3d_ProjectionMatrix;\nuniform mat4 x3d_ModelViewMatrix;\n\n// Attributes\n\n#if defined (X3D_FOG) && defined (X3D_FOG_COORDS)\n   attribute float x3d_FogDepth;\n#endif\n\n#if defined (X3D_COLOR_MATERIAL)\n   attribute vec4 x3d_Color;\n#endif\n\n#if ! defined (X3D_GEOMETRY_0D) && ! defined (X3D_GEOMETRY_1D)\n   #if defined (X3D_TEXTURE) || defined (X3D_MATERIAL_TEXTURES)\n      #if X3D_NUM_TEXTURE_COORDINATES > 0\n         attribute vec4 x3d_TexCoord0;\n      #endif\n\n      #if X3D_NUM_TEXTURE_COORDINATES > 1\n         attribute vec4 x3d_TexCoord1;\n      #endif\n   #endif\n#endif\n\nattribute vec4 x3d_Vertex;\n\n// Varyings\n\n#if defined (X3D_FOG) && defined (X3D_FOG_COORDS)\n   varying float fogDepth;\n#endif\n\n#if defined (X3D_COLOR_MATERIAL)\n   varying vec4 color;\n#endif\n\n#if ! defined (X3D_GEOMETRY_0D) && ! defined (X3D_GEOMETRY_1D)\n   #if defined (X3D_TEXTURE) || defined (X3D_MATERIAL_TEXTURES)\n      #if X3D_NUM_TEXTURE_COORDINATES > 0\n         varying vec4 texCoord0;\n      #endif\n\n      #if X3D_NUM_TEXTURE_COORDINATES > 1\n         varying vec4 texCoord1;\n      #endif\n   #endif\n#endif\n\n#if defined (X3D_NORMALS)\n   uniform mat3 x3d_NormalMatrix;\n   attribute vec3 x3d_Normal;\n   varying vec3 normal;\n\n   #if defined (X3D_TEXTURE) || defined (X3D_MATERIAL_TEXTURES)\n      varying vec3 localNormal;\n   #endif\n#endif\n\nvarying vec3 vertex;\n\n#if defined (X3D_TEXTURE) || defined (X3D_MATERIAL_TEXTURES)\n   varying vec3 localVertex;\n#endif\n\n#if defined (X3D_LOGARITHMIC_DEPTH_BUFFER)\n   varying float depth;\n#endif\n\n// Main\n\n#pragma X3D include "PointSize.glsl"\n\nvoid\nvertex_main ()\n{\n   #if defined (X3D_GEOMETRY_0D)\n      #if defined (X3D_STYLE_PROPERTIES)\n         gl_PointSize = pointSize = getPointSize (vertex);\n      #else\n         gl_PointSize = 1.0;\n      #endif\n   #endif\n\n   #if defined (X3D_FOG) && defined (X3D_FOG_COORDS)\n      fogDepth = x3d_FogDepth;\n   #endif\n\n   #if defined (X3D_COLOR_MATERIAL)\n      color = x3d_Color;\n   #endif\n\n   #if ! defined (X3D_GEOMETRY_0D) && ! defined (X3D_GEOMETRY_1D)\n      #if defined (X3D_TEXTURE) || defined (X3D_MATERIAL_TEXTURES)\n         #if X3D_NUM_TEXTURE_COORDINATES > 0\n            texCoord0 = x3d_TexCoord0;\n         #endif\n\n         #if X3D_NUM_TEXTURE_COORDINATES > 1\n            texCoord1 = x3d_TexCoord1;\n         #endif\n      #endif\n   #endif\n\n   #if defined (X3D_NORMALS)\n      normal      = x3d_NormalMatrix * x3d_Normal;\n\n      #if defined (X3D_TEXTURE) || defined (X3D_MATERIAL_TEXTURES)\n         localNormal = x3d_Normal;\n      #endif\n   #endif\n\n   vec4 position = x3d_ModelViewMatrix * x3d_Vertex;\n\n   vertex = position .xyz;\n\n   #if defined (X3D_TEXTURE) || defined (X3D_MATERIAL_TEXTURES)\n      localVertex = x3d_Vertex .xyz;\n   #endif\n\n   gl_Position = x3d_ProjectionMatrix * position;\n\n   #if defined (X3D_LOGARITHMIC_DEPTH_BUFFER)\n      depth = 1.0 + gl_Position .w;\n   #endif\n}\n'},2:{ClipPlanes:"\n#if defined (X3D_CLIP_PLANES)\n\nuniform vec4 x3d_ClipPlane [X3D_NUM_CLIP_PLANES];\n\nvoid\nclip ()\n{\n   for (int i = 0; i < X3D_NUM_CLIP_PLANES; ++ i)\n   {\n      if (dot (vertex, x3d_ClipPlane [i] .xyz) - x3d_ClipPlane [i] .w < 0.0)\n         discard;\n   }\n}\n\n#endif\n",Colors:"\n#define MANUAL_SRGB\n\nvec4\nSRGBtoLINEAR (const in vec4 srgbIn)\n{\n   #if defined (MANUAL_SRGB)\n      #if defined (SRGB_FAST_APPROXIMATION)\n         vec3 linOut = pow (srgbIn .xyz, vec3 (2.2));\n      #else //SRGB_FAST_APPROXIMATION\n         vec3 bLess  = step (vec3 (0.04045), srgbIn .xyz);\n         vec3 linOut = mix (srgbIn .xyz / vec3 (12.92), pow ((srgbIn .xyz + vec3 (0.055)) / vec3 (1.055), vec3 (2.4)), bLess);\n      #endif //SRGB_FAST_APPROXIMATION\n      return vec4 (linOut, srgbIn .w);\n   #else //MANUAL_SRGB\n      return srgbIn;\n   #endif //MANUAL_SRGB\n}\n\nvec4\nGamma (const in vec4 color)\n{\n   #if defined (MANUAL_SRGB)\n      return vec4 (pow (color .rgb, vec3 (1.0 / 2.2)), color .a);\n   #else\n      return color;\n   #endif\n}\n",Fog:"\n#if defined (X3D_FOG)\n\nuniform x3d_FogParameters x3d_Fog;\n\nfloat\ngetFogInterpolant ()\n{\n   // Returns 0.0 for fog color and 1.0 for material color.\n\n   #if defined (X3D_FOG_COORDS)\n      return clamp (1.0 - fogDepth, 0.0, 1.0);\n   #else\n      float visibilityRange = x3d_Fog .visibilityRange;\n      float dV              = length (x3d_Fog .matrix * vertex);\n\n      #if defined (X3D_FOG_LINEAR)\n         return max (0.0, visibilityRange - dV) / visibilityRange;\n      #elif defined (X3D_FOG_EXPONENTIAL)\n         return exp (-dV / max (0.001, visibilityRange - dV));\n      #endif\n   #endif\n}\n\nvec3\ngetFogColor (const in vec3 color)\n{\n   return mix (x3d_Fog .color, color, getFogInterpolant ());\n}\n\n#endif\n",Fragment:'\nuniform float x3d_AlphaCutoff;\n\n#if defined (X3D_FOG) && defined (X3D_FOG_COORDS)\n   in float fogDepth;\n#endif\n\n#if defined (X3D_COLOR_MATERIAL)\n   in vec4 color;\n#endif\n\n#if ! defined (X3D_GEOMETRY_0D) && ! defined (X3D_GEOMETRY_1D)\n   #if defined (X3D_TEXTURE) || defined (X3D_MATERIAL_TEXTURES)\n      #if X3D_NUM_TEXTURE_COORDINATES > 0\n         in vec4 texCoord0;\n      #endif\n\n      #if X3D_NUM_TEXTURE_COORDINATES > 1\n         in vec4 texCoord1;\n      #endif\n   #endif\n#else\n   #if defined (X3D_TEXTURE) || defined (X3D_MATERIAL_TEXTURES)\n      #if X3D_NUM_TEXTURE_COORDINATES > 0\n         vec4 texCoord0 = vec4 (0.0);\n      #endif\n\n      #if X3D_NUM_TEXTURE_COORDINATES > 1\n         vec4 texCoord1 = vec4 (0.0);\n      #endif\n   #endif\n#endif\n\n#if defined (X3D_NORMALS)\n   in vec3 normal;\n\n   #if defined (X3D_TEXTURE) || defined (X3D_MATERIAL_TEXTURES)\n      in vec3 localNormal;\n   #endif\n#else\n   const vec3 normal = vec3 (0.0, 0.0, 1.0);\n\n   #if defined (X3D_TEXTURE) || defined (X3D_MATERIAL_TEXTURES)\n      const vec3 localNormal = vec3 (0.0, 0.0, 1.0);\n   #endif\n#endif\n\nin vec3 vertex;\n\n#if defined (X3D_TEXTURE) || defined (X3D_MATERIAL_TEXTURES)\n   in vec3 localVertex;\n#endif\n\n#if defined (X3D_LOGARITHMIC_DEPTH_BUFFER)\n   uniform float x3d_LogarithmicFarFactor1_2;\n   in float depth;\n#endif\n\nout vec4 x3d_FragColor;\n\n#pragma X3D include "Point.glsl"\n#pragma X3D include "Stipple.glsl"\n#pragma X3D include "Hatch.glsl"\n#pragma X3D include "Fog.glsl"\n#pragma X3D include "ClipPlanes.glsl"\n#pragma X3D include "Texture.glsl"\n\nvec4\ngetMaterialColor ();\n\nvec4\ngetFinalColor ()\n{\n   #if defined (X3D_GEOMETRY_0D) && defined (X3D_STYLE_PROPERTIES)\n      #if defined (X3D_TEXTURE) || defined (X3D_MATERIAL_TEXTURES)\n         setTexCoords ();\n\n         return getMaterialColor ();\n       #else\n         return getPointColor (getMaterialColor ());\n      #endif\n   #else\n      return getMaterialColor ();\n   #endif\n}\n\nvoid\nfragment_main ()\n{\n   #if defined (X3D_CLIP_PLANES)\n      clip ();\n   #endif\n\n   #if defined (X3D_GEOMETRY_1D) && defined (X3D_STYLE_PROPERTIES)\n      stipple ();\n   #endif\n\n   vec4 finalColor = getFinalColor ();\n\n   #if (defined (X3D_GEOMETRY_2D) || defined (X3D_GEOMETRY_3D)) && defined (X3D_STYLE_PROPERTIES)\n      finalColor = getHatchColor (finalColor);\n   #endif\n\n   #if defined (X3D_FOG)\n      finalColor .rgb = getFogColor (finalColor .rgb);\n   #endif\n\n   if (finalColor .a < x3d_AlphaCutoff)\n      discard;\n\n   x3d_FragColor = finalColor;\n\n   #if defined (X3D_LOGARITHMIC_DEPTH_BUFFER)\n      //http://outerra.blogspot.com/2013/07/logarithmic-depth-buffer-optimizations.html\n      gl_FragDepth = log2 (depth) * x3d_LogarithmicFarFactor1_2;\n   #endif\n}\n',Hatch:"\n#if (defined (X3D_GEOMETRY_2D) || defined (X3D_GEOMETRY_3D)) && defined (X3D_STYLE_PROPERTIES)\n\nuniform x3d_FillPropertiesParameters x3d_FillProperties;\n\nvec4\ngetHatchColor (vec4 color)\n{\n   vec4 finalColor = x3d_FillProperties .filled ? color : vec4 (0.0);\n\n   if (x3d_FillProperties .hatched)\n   {\n      vec4 hatch = texture (x3d_FillProperties .texture, gl_FragCoord .xy / 32.0);\n\n      hatch .rgb *= x3d_FillProperties .hatchColor;\n      finalColor  = mix (finalColor, hatch, hatch .a);\n   }\n\n   return finalColor;\n}\n\n#endif\n",Line2:"\nstruct Line2\n{\n   vec2 point;\n   vec2 direction;\n};\n\nLine2\nline2 (const in vec2 point1, const in vec2 point2)\n{\n   return Line2 (point1, normalize (point2 - point1));\n}\n\nvec2\nclosest_point (const in Line2 line, const in vec2 point)\n{\n   vec2  r = point - line .point;\n   float d = dot (r, line .direction);\n\n   return line .direction * d + line .point;\n}\n",Material:'\nuniform x3d_MaterialParameters x3d_Material;\n\n#if defined (X3D_LIGHTING)\n\n#pragma X3D include "SpotFactor.glsl"\n#pragma X3D include "Shadow.glsl"\n\nuniform x3d_LightSourceParameters x3d_LightSource [X3D_NUM_LIGHTS];\n\nvec3\ngetMaterialColor (const in vec3 vertex, const in vec3 N, const in vec3 ambientColor, const in vec3 diffuseColor, const in vec3 specularColor, const in float shininess)\n{\n   // Apply light sources\n\n   vec3 V = normalize (-vertex);\n\n   vec3 finalColor = vec3 (0.0);\n\n   for (int i = 0; i < X3D_NUM_LIGHTS; ++ i)\n   {\n      x3d_LightSourceParameters light = x3d_LightSource [i];\n\n      vec3  vL = light .location - vertex;\n      float dL = length (light .matrix * vL);\n      bool  di = light .type == x3d_DirectionalLight;\n\n      if (di || dL <= light .radius)\n      {\n         vec3 d = light .direction;\n         vec3 c = light .attenuation;\n         vec3 L = di ? -d : normalize (vL);      // Normalized vector from point on geometry to light source i position.\n         vec3 H = normalize (L + V);             // Specular term\n\n         float lightAngle     = max (dot (N, L), 0.0);      // Angle between normal and light ray.\n         vec3  diffuseTerm    = diffuseColor * lightAngle;\n         float specularFactor = shininess > 0.0 ? pow (max (dot (N, H), 0.0), shininess * 128.0) : 1.0;\n         vec3  specularTerm   = specularColor * specularFactor;\n\n         float attenuationFactor     = di ? 1.0 : 1.0 / max (dot (c, vec3 (1.0, dL, dL * dL)), 1.0);\n         float spotFactor            = light .type == x3d_SpotLight ? getSpotFactor (light .cutOffAngle, light .beamWidth, L, d) : 1.0;\n         float attenuationSpotFactor = attenuationFactor * spotFactor;\n         vec3  ambientTerm           = light .ambientIntensity * ambientColor;\n         vec3  diffuseSpecularTerm   = light .intensity * (diffuseTerm + specularTerm);\n\n         #if defined (X3D_FRAGMENT_SHADER) && defined (X3D_SHADOWS)\n            if (lightAngle > 0.0)\n               diffuseSpecularTerm = mix (diffuseSpecularTerm, light .shadowColor, getShadowIntensity (i, light));\n         #endif\n\n         finalColor += attenuationSpotFactor * light .color * (ambientTerm + diffuseSpecularTerm);\n      }\n   }\n\n   return finalColor;\n}\n\n#endif\n',Normal:"\n#if defined (X3D_NORMAL_TEXTURE)\n// Tangent-Bitangent-Normal-Matrix\nmat3\ngetTBNMatrix (const in vec2 texCoord)\n{\n   vec3 pos_dx = dFdx (vertex);\n   vec3 pos_dy = dFdy (vertex);\n   vec3 tex_dx = dFdx (vec3 (texCoord, 0.0));\n   vec3 tex_dy = dFdy (vec3 (texCoord, 0.0));\n   vec3 t      = (tex_dy .t * pos_dx - tex_dx .t * pos_dy) / (tex_dx .s * tex_dy.t - tex_dy .s * tex_dx .t);\n   vec3 N      = normalize (normal); // OR generated face normal: n = normalize (cross (pos_dx, pos_dy));\n   vec3 T      = normalize (t - N * dot (N, t));\n   vec3 B      = normalize (cross (N, T));\n   mat3 tbn    = mat3 (T, B, N);\n\n   return tbn;\n}\n#endif\n\n#if defined (X3D_NORMAL_TEXTURE)\nuniform x3d_NormalTextureParameters x3d_NormalTexture;\n#endif\n\nvec3\ngetNormalVector (const in float normalScale)\n{\n   float facing = gl_FrontFacing ? 1.0 : -1.0;\n\n   // Get normal vector.\n\n   #if defined (X3D_NORMAL_TEXTURE)\n      vec3 texCoord = getTexCoord (x3d_NormalTexture .textureTransformMapping, x3d_NormalTexture .textureCoordinateMapping);\n      vec3 scale    = vec3 (vec2 (normalScale), 1.0);\n      mat3 tbn      = getTBNMatrix (texCoord .st);\n\n      #if defined (X3D_NORMAL_TEXTURE_2D)\n         vec3 n = texture (x3d_NormalTexture .texture2D, texCoord .st) .rgb;\n      #elif defined (X3D_NORMAL_TEXTURE_3D)\n         vec3 n = texture (x3d_NormalTexture .texture3D, texCoord) .rgb;\n      #elif defined (X3D_NORMAL_TEXTURE_CUBE)\n         vec3 n = texture (x3d_NormalTexture .textureCube, texCoord) .rgb;\n      #endif\n\n      return normalize (tbn * ((n * 2.0 - 1.0) * scale)) * facing;\n   #else\n      return normalize (normal) * facing;\n   #endif\n}\n",Pack:"\nvec4\npack (const in float value)\n{\n   const vec3 bitShifts = vec3 (255.0,\n                                255.0 * 255.0,\n                                255.0 * 255.0 * 255.0);\n\n   return vec4 (value, fract (value * bitShifts));\n}\n\n#if defined (X3D_DEPTH_TEXTURE)\n\nfloat\nunpack (const in vec4 color)\n{\n   return color .r;\n}\n\n#else\n\nfloat\nunpack (const vec4 color)\n{\n   const vec3 bitShifts = vec3 (1.0 / 255.0,\n                                1.0 / (255.0 * 255.0),\n                                1.0 / (255.0 * 255.0 * 255.0));\n\n   return color .x + dot (color .gba, bitShifts);\n}\n\n#endif\n",Particle:"\n#if defined (X3D_PARTICLE_SYSTEM)\n\nin vec4 x3d_Particle;\nin mat4 x3d_ParticleMatrix;\n\nuniform sampler2D x3d_TexCoordRamp;\n\nvec4\ntexelFetch (const in sampler2D sampler, const in int index, const in int lod)\n{\n   int   x = textureSize (sampler, lod) .x;\n   ivec2 p = ivec2 (index % x, index / x);\n   vec4  t = texelFetch (sampler, p, lod);\n\n   return t;\n}\n\n#if defined (X3D_TEX_COORD_RAMP)\nvec4\ngetTexCoord (const in vec4 texCoord)\n{\n   const int map [6] = int [6] (0, 1, 2, 0, 2, 3);\n\n   int index0 = int (x3d_Particle [3]);\n\n   return texelFetch (x3d_TexCoordRamp, index0 + map [gl_VertexID % 6], 0);\n}\n#else\n   #define getTexCoord(texCoord) texCoord\n#endif\n\nvec4\ngetVertex (const in vec4 vertex)\n{\n   return x3d_ParticleMatrix * vertex;\n}\n\n#else\n\n#define getVertex(vertex) vertex\n#define getTexCoord(texCoord) texCoord\n\n#endif\n",Perlin:"\n//https://gist.github.com/patriciogonzalezvivo/670c22f3966e662d2f83\n\nfloat rand (vec2 co) { return fract (sin (dot (co.xy, vec2 (12.9898,78.233))) * 43758.5453); }\nfloat rand (vec2 co, float l) { return rand (vec2 (rand (co), l)); }\nfloat rand (vec2 co, float l, float t) { return rand (vec2 (rand (co, l), t)); }\n\nfloat\nperlin (vec2 p, float dim, float time)\n{\n   const float M_PI = 3.14159265358979323846;\n\n   vec2 pos   = floor (p * dim);\n   vec2 posx  = pos + vec2 (1.0, 0.0);\n   vec2 posy  = pos + vec2 (0.0, 1.0);\n   vec2 posxy = pos + vec2 (1.0);\n\n   float c   = rand (pos,   dim, time);\n   float cx  = rand (posx,  dim, time);\n   float cy  = rand (posy,  dim, time);\n   float cxy = rand (posxy, dim, time);\n\n   vec2 d = fract (p * dim);\n\n   d = -0.5 * cos (d * M_PI) + 0.5;\n\n   float ccx    = mix (c,   cx,    d.x);\n   float cycxy  = mix (cy,  cxy,   d.x);\n   float center = mix (ccx, cycxy, d.y);\n\n   return center * 2.0 - 1.0;\n}\n\nvec3\nperlin (vec3 p)\n{\n   return vec3 (perlin (p.xy, 1.0, 0.0),\n                perlin (p.yz, 1.0, 0.0),\n                perlin (p.zx, 1.0, 0.0));\n}\n",Point:"\n#if defined (X3D_GEOMETRY_0D) && defined (X3D_STYLE_PROPERTIES)\n\nin float pointSize;\n\n#if defined (X3D_TEXTURE) || defined (X3D_MATERIAL_TEXTURES)\nvoid\nsetTexCoords ()\n{\n   vec4 texCoord = vec4 (gl_PointCoord .x, 1.0 - gl_PointCoord .y, 0.0, 1.0);\n\n   #if X3D_NUM_TEXTURE_COORDINATES > 0\n      texCoord0 = texCoord;\n   #endif\n\n   #if X3D_NUM_TEXTURE_COORDINATES > 1\n      texCoord1 = texCoord;\n   #endif\n}\n#endif\n\nvec4\ngetPointColor (in vec4 color)\n{\n   if (pointSize > 1.0)\n      color .a *= clamp (pointSize * (0.5 - distance (vec2 (0.5), gl_PointCoord)), 0.0, 1.0);\n\n   else\n      color .a *= pointSize;\n\n   return color;\n}\n\n#endif\n",PointSize:"\n#if defined (X3D_GEOMETRY_0D) && defined (X3D_STYLE_PROPERTIES)\n\nuniform x3d_PointPropertiesParameters x3d_PointProperties;\n\nout float pointSize;\n\nfloat\ngetPointSize (const in vec3 vertex)\n{\n   // Determine point size.\n\n   float pointSizeMinValue    = x3d_PointProperties .pointSizeMinValue;\n   float pointSizeMaxValue    = x3d_PointProperties .pointSizeMaxValue;\n   vec3  pointSizeAttenuation = x3d_PointProperties .pointSizeAttenuation;\n   float dL                   = length (vertex);\n   float pointSize            = 0.0;\n\n   pointSize  = x3d_PointProperties .pointSizeScaleFactor;\n   pointSize /= dot (pointSizeAttenuation, vec3 (1.0, dL, dL * dL));\n   pointSize  = clamp (pointSize, pointSizeMinValue, pointSizeMaxValue);\n\n   #if defined (X3D_TEXTURE) || defined (X3D_MATERIAL_TEXTURE)\n      return pointSize;\n   #else\n      return pointSize + 1.0 - step (pointSize, 1.0);\n   #endif\n}\n\n#endif\n",Shadow:'\n#if defined (X3D_FRAGMENT_SHADER) && defined (X3D_SHADOWS)\n\n#pragma X3D include "Pack.glsl"\n\nuniform sampler2D x3d_ShadowMap [X3D_NUM_LIGHTS];\n\nfloat\ngetShadowDepth (const in int index, const in vec2 shadowCoord)\n{\n   switch (index)\n   {\n      #if X3D_NUM_LIGHTS > 0\n      case 0:\n      {\n         return unpack (texture (x3d_ShadowMap [0], shadowCoord));\n      }\n      #endif\n      #if X3D_NUM_LIGHTS > 1\n      case 1:\n      {\n         return unpack (texture (x3d_ShadowMap [1], shadowCoord));\n      }\n      #endif\n      #if X3D_NUM_LIGHTS > 2\n      case 2:\n      {\n         return unpack (texture (x3d_ShadowMap [2], shadowCoord));\n      }\n      #endif\n      #if X3D_NUM_LIGHTS > 3\n      case 3:\n      {\n         return unpack (texture (x3d_ShadowMap [3], shadowCoord));\n      }\n      #endif\n      #if X3D_NUM_LIGHTS > 4\n      case 4:\n      {\n         return unpack (texture (x3d_ShadowMap [4], shadowCoord));\n      }\n      #endif\n      #if X3D_NUM_LIGHTS > 5\n      case 5:\n      {\n         return unpack (texture (x3d_ShadowMap [5], shadowCoord));\n      }\n      #endif\n      #if X3D_NUM_LIGHTS > 6\n      case 6:\n      {\n         return unpack (texture (x3d_ShadowMap [6], shadowCoord));\n      }\n      #endif\n      #if X3D_NUM_LIGHTS > 7\n      case 7:\n      {\n         return unpack (texture (x3d_ShadowMap [7], shadowCoord));\n      }\n      #endif\n      default:\n      {\n         return 0.0;\n      }\n   }\n}\n\nfloat\ntexture2DCompare (const in int index, const in vec2 texCoord, const in float compare)\n{\n   float shadowDepth = getShadowDepth (index, texCoord);\n\n   return (1.0 - step (1.0, shadowDepth)) * step (shadowDepth, compare);\n}\n\nfloat\ntexture2DShadowLerp (const in int index, const in vec2 texelSize, const in float shadowMapSize, const in vec2 texCoord, const in float compare)\n{\n   const vec2 offset = vec2 (0.0, 1.0);\n\n   vec2 centroidTexCoord = floor (texCoord * shadowMapSize + 0.5) / shadowMapSize;\n\n   float lb = texture2DCompare (index, centroidTexCoord + texelSize * offset .xx, compare);\n   float lt = texture2DCompare (index, centroidTexCoord + texelSize * offset .xy, compare);\n   float rb = texture2DCompare (index, centroidTexCoord + texelSize * offset .yx, compare);\n   float rt = texture2DCompare (index, centroidTexCoord + texelSize * offset .yy, compare);\n\n   vec2 f = fract (texCoord * shadowMapSize + 0.5);\n\n   float a = mix (lb, lt, f.y);\n   float b = mix (rb, rt, f.y);\n   float c = mix (a, b, f.x);\n\n   return c;\n}\n\n//https://gist.github.com/tschw/da10c43c467ce8afd0c4\nvec2\ncubeToUVCompact (in vec3 v, const float texelSizeY)\n{\n   // Compact layout:\n   //\n   // xzXZ\t\tChar: Axis\n   // yyYY\t\tCase: Sign\n\n   // Number of texels to avoid at the edge of each square\n\n   vec3 absV = abs (v);\n\n   // Intersect unit cube\n\n   float scaleToCube = 1.0 / max (absV .x, max (absV .y, absV .z));\n\n   absV *= scaleToCube;\n\n   // Apply scale to avoid seams\n\n   // one texel less per square (half a texel on each side)\n   v *= scaleToCube * (1.0 - 2.0 * texelSizeY);\n\n   // Unwrap\n\n   // space: -1 ... 1 range for each square\n   //\n   // #X##\t\tdim    := ( 4 , 2 )\n   //  # #\t\tcenter := ( 1 , 1 )\n\n   vec2 planar = v .xy;\n\n   float almostATexel = 1.5 * texelSizeY;\n   float almostOne    = 1.0 - almostATexel;\n\n   if (absV .z >= almostOne)\n   {\n      // zZ\n\n      if (v .z > 0.0)\n         planar .x = 4.0 - v .x;\n   }\n   else if (absV .x >= almostOne)\n   {\n      // xX\n\n      float signX = sign (v .x);\n\n      planar .x = v .z * signX + 2.0 * signX;\n   }\n   else if (absV .y >= almostOne)\n   {\n      // yY\n\n      float signY = sign (v .y);\n\n      planar .x = (v .x + 0.5 + signY) * 2.0;\n      planar .y = v .z * signY - 2.0;\n   }\n\n   // Transform to UV space\n\n   // scale := 0.5 / dim\n   // translate := ( center + 0.5 ) / dim\n   return vec2 (0.125, 0.25) * planar + vec2 (0.375, 0.75);\n}\n\nmat4\ngetPointLightRotations (const in vec3 vector)\n{\n   mat4 rotations [6];\n   rotations [0] = mat4 ( 0, 0 , 1, 0,   0, 1,  0, 0,  -1,  0,  0, 0,   0, 0, 0, 1);  // left\n   rotations [1] = mat4 ( 0, 0, -1, 0,   0, 1,  0, 0,   1,  0,  0, 0,   0, 0, 0, 1);  // right\n   rotations [2] = mat4 (-1, 0,  0, 0,   0, 1,  0, 0,   0,  0, -1, 0,   0, 0, 0, 1);  // front\n   rotations [3] = mat4 ( 1, 0,  0, 0,   0, 1,  0, 0,   0,  0,  1, 0,   0, 0, 0, 1);  // back\n   rotations [4] = mat4 ( 1, 0,  0, 0,   0, 0,  1, 0,   0, -1,  0, 0,   0, 0, 0, 1);  // bottom\n   rotations [5] = mat4 ( 1, 0,  0, 0,   0, 0, -1, 0,   0,  1,  0, 0,   0, 0, 0, 1);  // top\n\n   vec3 a = abs (vector .xyz);\n\n   if (a .x > a .y)\n   {\n      if (a .x > a .z)\n         return vector .x > 0.0 ? rotations [1] : rotations [0];\n      else\n         return vector .z > 0.0 ? rotations [2] : rotations [3];\n   }\n   else\n   {\n      if (a .y > a .z)\n         return vector .y > 0.0 ? rotations [5] : rotations [4];\n      else\n         return vector .z > 0.0 ? rotations [2] : rotations [3];\n   }\n\n   return rotations [3];\n}\n\n// DEBUG\n//vec4 tex;\n\nfloat\ngetShadowIntensity (const in int index, const in x3d_LightSourceParameters light)\n{\n   if (light .type == x3d_PointLight)\n   {\n      const mat4 biasMatrix = mat4 (0.5, 0.0, 0.0, 0.0,\n                                    0.0, 0.5, 0.0, 0.0,\n                                    0.0, 0.0, 0.5, 0.0,\n                                    0.5, 0.5, 0.5, 1.0);\n\n      const mat4 projectionMatrix = mat4 (1.0, 0.0, 0.0, 0.0, 0.0, 0.5, 0.0, 0.0, 0.0, 0.0, -1.000025000312504, -1.0, 0, 0.0, -0.25000312503906297, 0.0);\n\n      vec2 texelSize = vec2 (1.0) / (float (light .shadowMapSize) * vec2 (4.0, 2.0));\n\n      // for point lights, the uniform @vShadowCoord is re-purposed to hold\n      // the vector from the light to the world-space position of the fragment.\n      vec4 shadowCoord     = light .shadowMatrix * vec4 (vertex, 1.0);\n      vec3 lightToPosition = shadowCoord .xyz;\n\n      shadowCoord       = biasMatrix * (projectionMatrix * (getPointLightRotations (lightToPosition) * shadowCoord));\n      shadowCoord .z   -= light .shadowBias;\n      shadowCoord .xyz /= shadowCoord .w;\n\n      // DEBUG\n      //tex = texture2D (x3d_ShadowMap [0], cubeToUVCompact (lightToPosition, texelSize .y));\n\n      #if defined (X3D_PCF_FILTERING) || defined (X3D_PCF_SOFT_FILTERING)\n\n         vec2 offset = vec2 (-1, 1) * (texelSize .y * 42.0);\n\n         float value = (\n            texture2DCompare (index, cubeToUVCompact (lightToPosition + offset .xyy, texelSize .y), shadowCoord .z) +\n            texture2DCompare (index, cubeToUVCompact (lightToPosition + offset .yyy, texelSize .y), shadowCoord .z) +\n            texture2DCompare (index, cubeToUVCompact (lightToPosition + offset .xyx, texelSize .y), shadowCoord .z) +\n            texture2DCompare (index, cubeToUVCompact (lightToPosition + offset .yyx, texelSize .y), shadowCoord .z) +\n            texture2DCompare (index, cubeToUVCompact (lightToPosition, texelSize .y), shadowCoord .z) +\n            texture2DCompare (index, cubeToUVCompact (lightToPosition + offset .xxy, texelSize .y), shadowCoord .z) +\n            texture2DCompare (index, cubeToUVCompact (lightToPosition + offset .yxy, texelSize .y), shadowCoord .z) +\n            texture2DCompare (index, cubeToUVCompact (lightToPosition + offset .xxx, texelSize .y), shadowCoord .z) +\n            texture2DCompare (index, cubeToUVCompact (lightToPosition + offset .yxx, texelSize .y), shadowCoord .z)\n         ) * (1.0 / 9.0);\n\n         return light .shadowIntensity * value;\n\n      #else // no percentage-closer filtering\n\n         float value = texture2DCompare (index, cubeToUVCompact (lightToPosition, texelSize .y), shadowCoord .z);\n\n         return light .shadowIntensity * value;\n\n      #endif\n   }\n   else\n   {\n      #if defined (X3D_PCF_FILTERING)\n\n         vec2 texelSize   = vec2 (1.0) / vec2 (light .shadowMapSize);\n         vec4 shadowCoord = light .shadowMatrix * vec4 (vertex, 1.0);\n\n         shadowCoord .z   -= light .shadowBias;\n         shadowCoord .xyz /= shadowCoord .w;\n\n         float dx0 = - texelSize .x;\n         float dy0 = - texelSize .y;\n         float dx1 = + texelSize .x;\n         float dy1 = + texelSize .y;\n\n         float value = (\n            texture2DCompare (index, shadowCoord .xy + vec2 (dx0, dy0), shadowCoord .z) +\n            texture2DCompare (index, shadowCoord .xy + vec2 (0.0, dy0), shadowCoord .z) +\n            texture2DCompare (index, shadowCoord .xy + vec2 (dx1, dy0), shadowCoord .z) +\n            texture2DCompare (index, shadowCoord .xy + vec2 (dx0, 0.0), shadowCoord .z) +\n            texture2DCompare (index, shadowCoord .xy, shadowCoord .z) +\n            texture2DCompare (index, shadowCoord .xy + vec2 (dx1, 0.0), shadowCoord .z) +\n            texture2DCompare (index, shadowCoord .xy + vec2 (dx0, dy1), shadowCoord .z) +\n            texture2DCompare (index, shadowCoord .xy + vec2 (0.0, dy1), shadowCoord .z) +\n            texture2DCompare (index, shadowCoord .xy + vec2 (dx1, dy1), shadowCoord .z)\n         ) * (1.0 / 9.0);\n\n         return light .shadowIntensity * value;\n\n      #elif defined (X3D_PCF_SOFT_FILTERING)\n\n         vec2 texelSize   = vec2 (1.0) / vec2 (light .shadowMapSize);\n         vec4 shadowCoord = light .shadowMatrix * vec4 (vertex, 1.0);\n\n         shadowCoord .z   -= light .shadowBias;\n         shadowCoord .xyz /= shadowCoord .w;\n\n         float dx0 = - texelSize.x;\n         float dy0 = - texelSize.y;\n         float dx1 = + texelSize.x;\n         float dy1 = + texelSize.y;\n\n         float value = (\n            texture2DShadowLerp (index, texelSize, float (shadowMapSize), shadowCoord .xy + vec2 (dx0, dy0), shadowCoord .z) +\n            texture2DShadowLerp (index, texelSize, float (shadowMapSize), shadowCoord .xy + vec2 (0.0, dy0), shadowCoord .z) +\n            texture2DShadowLerp (index, texelSize, float (shadowMapSize), shadowCoord .xy + vec2 (dx1, dy0), shadowCoord .z) +\n            texture2DShadowLerp (index, texelSize, float (shadowMapSize), shadowCoord .xy + vec2 (dx0, 0.0), shadowCoord .z) +\n            texture2DShadowLerp (index, texelSize, float (shadowMapSize), shadowCoord .xy, shadowCoord .z) +\n            texture2DShadowLerp (index, texelSize, float (shadowMapSize), shadowCoord .xy + vec2 (dx1, 0.0), shadowCoord .z) +\n            texture2DShadowLerp (index, texelSize, float (shadowMapSize), shadowCoord .xy + vec2 (dx0, dy1), shadowCoord .z) +\n            texture2DShadowLerp (index, texelSize, float (shadowMapSize), shadowCoord .xy + vec2 (0.0, dy1), shadowCoord .z) +\n            texture2DShadowLerp (index, texelSize, float (shadowMapSize), shadowCoord .xy + vec2 (dx1, dy1), shadowCoord .z)\n         ) * ( 1.0 / 9.0 );\n\n         return light .shadowIntensity * value;\n\n      #else // no percentage-closer filtering\n\n         vec4 shadowCoord = shadowMatrix * vec4 (vertex, 1.0);\n\n         shadowCoord .z   -= shadowBias;\n         shadowCoord .xyz /= shadowCoord .w;\n\n         float value = texture2DCompare (index, shadowCoord .xy, shadowCoord .z);\n\n         return light .shadowIntensity * value;\n\n      #endif\n   }\n\n   return 0.0;\n}\n\n#endif\n',Stipple:'\n#if defined (X3D_GEOMETRY_1D) && defined (X3D_STYLE_PROPERTIES)\n\n#pragma X3D include "Line2.glsl"\n\nuniform x3d_LinePropertiesParameters x3d_LineProperties;\n\nflat in float lengthSoFar; // in px\nflat in vec2  startPoint;  // in px\nin vec2       midPoint;    // in px\n\nvoid\nstipple ()\n{\n   vec2  point = closest_point (line2 (startPoint, midPoint), gl_FragCoord .xy);\n   float s     = (lengthSoFar + length (point - startPoint)) * x3d_LineProperties .lineStippleScale;\n\n   #if defined (X3D_TEXTURE) || defined (X3D_MATERIAL_TEXTURES)\n      #if X3D_NUM_TEXTURE_COORDINATES > 0\n         texCoord0 = vec4 (s, 0.0, 0.0, 1.0);\n      #endif\n\n      #if X3D_NUM_TEXTURE_COORDINATES > 1\n         texCoord1 = vec4 (s, 0.0, 0.0, 1.0);\n      #endif\n   #endif\n\n   if (x3d_LineProperties .linetype != 16)\n   {\n      int   linetype = x3d_LineProperties .linetype;\n      int   height   = textureSize (x3d_LineProperties .texture, 0) .y;\n      float t        = 1.0 - float (linetype * 2 + 1) / float (height * 2);\n      float alpha    = texture (x3d_LineProperties .texture, vec2 (s, t)) .a;\n\n      if (alpha != 1.0)\n         discard;\n   }\n}\n\n#endif\n',SpotFactor:"\nfloat\ngetSpotFactor (const in float cutOffAngle, const in float beamWidth, const in vec3 L, const in vec3 d)\n{\n   float spotAngle = acos (clamp (dot (-L, d), -1.0, 1.0));\n\n   if (spotAngle >= cutOffAngle)\n      return 0.0;\n   else if (spotAngle <= beamWidth)\n      return 1.0;\n\n   return (spotAngle - cutOffAngle) / (beamWidth - cutOffAngle);\n}\n",Texture:'\n#if defined (X3D_TEXTURE) || defined (X3D_MATERIAL_TEXTURES)\n\n#pragma X3D include "Perlin.glsl"\n\nvec4\ngetTexCoord (const in int i)\n{\n   #if defined (X3D_MULTI_TEXTURING)\n      switch (i)\n      {\n         #if X3D_NUM_TEXTURE_COORDINATES > 0\n         case 0:\n            return texCoord0;\n         #endif\n         #if X3D_NUM_TEXTURE_COORDINATES > 1\n         case 1:\n            return texCoord1;\n         #endif\n      }\n\n      return vec4 (0.0);\n   #else\n      return texCoord0;\n   #endif\n}\n\nuniform mat4 x3d_TextureMatrix [X3D_NUM_TEXTURE_TRANSFORMS];\n\nvec4\ngetTexCoord (const in x3d_TextureCoordinateGeneratorParameters textureCoordinateGenerator, const in int textureTransformMapping, const in int textureCoordinateMapping)\n{\n   int mode = textureCoordinateGenerator .mode;\n\n   switch (mode)\n   {\n      case x3d_None:\n      {\n         return x3d_TextureMatrix [textureTransformMapping] * getTexCoord (textureCoordinateMapping);\n      }\n      case x3d_Sphere:\n      {\n         vec2 N = normalize (gl_FrontFacing ? normal : -normal) .xy;\n\n         return vec4 (N * 0.5 + 0.5, 0.0, 1.0);\n      }\n      case x3d_CameraSpaceNormal:\n      {\n         vec3 N = normalize (gl_FrontFacing ? normal : -normal);\n\n         return vec4 (N, 1.0);\n      }\n      case x3d_CameraSpacePosition:\n      {\n         return vec4 (vertex, 1.0);\n      }\n      case x3d_CameraSpaceReflectionVector:\n      {\n         vec3 N = normalize (gl_FrontFacing ? normal : -normal);\n\n         return vec4 (reflect (normalize (vertex), -N), 1.0);\n      }\n      case x3d_SphereLocal:\n      {\n         vec2 N = normalize (gl_FrontFacing ? localNormal : -localNormal) .xy;\n\n         return vec4 (N * 0.5 + 0.5, 0.0, 1.0);\n      }\n      case x3d_Coord:\n      {\n         return vec4 (localVertex, 1.0);\n      }\n      case x3d_CoordEye:\n      {\n         return vec4 (vertex, 1.0);\n      }\n      case x3d_Noise:\n      {\n         vec3 scale       = vec3 (textureCoordinateGenerator .parameter [0], textureCoordinateGenerator .parameter [1], textureCoordinateGenerator .parameter [2]);\n         vec3 translation = vec3 (textureCoordinateGenerator .parameter [3], textureCoordinateGenerator .parameter [4], textureCoordinateGenerator .parameter [5]);\n\n         return vec4 (perlin (localVertex * scale + translation), 1.0);\n      }\n      case x3d_NoiseEye:\n      {\n         vec3 scale       = vec3 (textureCoordinateGenerator .parameter [0], textureCoordinateGenerator .parameter [1], textureCoordinateGenerator .parameter [2]);\n         vec3 translation = vec3 (textureCoordinateGenerator .parameter [3], textureCoordinateGenerator .parameter [4], textureCoordinateGenerator .parameter [5]);\n\n         return vec4 (perlin (vertex * scale + translation), 1.0);\n      }\n      case x3d_SphereReflect:\n      {\n         vec3  N   = normalize (gl_FrontFacing ? normal : -normal);\n         float eta = textureCoordinateGenerator .parameter [0];\n\n         return vec4 (refract (normalize (vertex), -N, eta), 1.0);\n      }\n      case x3d_SphereReflectLocal:\n      {\n         vec3  N   = normalize (gl_FrontFacing ? localNormal : -localNormal);\n         float eta = textureCoordinateGenerator .parameter [0];\n         vec3  eye = vec3 (textureCoordinateGenerator .parameter [1], textureCoordinateGenerator .parameter [2], textureCoordinateGenerator .parameter [3]);\n\n         return vec4 (refract (normalize (localVertex - eye), -N, eta), 1.0);\n      }\n      default:\n      {\n         return x3d_TextureMatrix [textureTransformMapping] * getTexCoord (textureCoordinateMapping);\n      }\n   }\n}\n\nuniform x3d_TextureCoordinateGeneratorParameters x3d_TextureCoordinateGenerator [X3D_NUM_TEXTURE_COORDINATES];\n\nvec3\ngetTexCoord (const in int textureTransformMapping, const in int textureCoordinateMapping)\n{\n   vec4 texCoord = getTexCoord (x3d_TextureCoordinateGenerator [textureCoordinateMapping], textureTransformMapping, textureCoordinateMapping);\n\n   texCoord .stp /= texCoord .q;\n\n   #if defined (X3D_GEOMETRY_2D)\n      if (gl_FrontFacing == false)\n         texCoord .s = 1.0 - texCoord .s;\n   #endif\n\n   return texCoord .stp;\n}\n\n#endif // X3D_TEXTURE || X3D_MATERIAL_TEXTURES\n\n#if defined (X3D_TEXTURE)\n\nuniform int         x3d_TextureType [X3D_NUM_TEXTURES];\nuniform sampler2D   x3d_Texture2D [X3D_NUM_TEXTURES];\nuniform sampler3D   x3d_Texture3D [X3D_NUM_TEXTURES];\nuniform samplerCube x3d_TextureCube [X3D_NUM_TEXTURES];\n\n#if defined (X3D_MULTI_TEXTURING)\nvec4\ngetTexture (const in int i, const in vec3 texCoord)\n{\n   switch (i)\n   {\n      #if X3D_NUM_TEXTURES > 0\n      case 0:\n         #if defined (X3D_TEXTURE0_2D)\n            return texture (x3d_Texture2D [0], texCoord .st);\n         #elif defined (X3D_TEXTURE0_3D)\n            return texture (x3d_Texture3D [0], texCoord .stp);\n         #elif defined (X3D_TEXTURE0_CUBE)\n            return texture (x3d_TextureCube [0], texCoord .stp);\n         #endif\n      #endif\n      #if X3D_NUM_TEXTURES > 1\n      case 1:\n         #if defined (X3D_TEXTURE0_2D)\n            return texture (x3d_Texture2D [1], texCoord .st);\n         #elif defined (X3D_TEXTURE0_3D)\n            return texture (x3d_Texture3D [1], texCoord .stp);\n         #elif defined (X3D_TEXTURE0_CUBE)\n            return texture (x3d_TextureCube [1], texCoord .stp);\n         #endif\n      #endif\n   }\n\n   return vec4 (0.0);\n}\n#endif\n\n#if defined (X3D_MULTI_TEXTURING)\n   uniform vec4 x3d_MultiTextureColor;\n   uniform x3d_MultiTextureParameters x3d_MultiTexture [X3D_NUM_TEXTURES];\n#endif\n\nvec4\ngetTextureColor (const in vec4 diffuseColor, const in vec4 specularColor)\n{\n   #if defined (X3D_MULTI_TEXTURING)\n      vec4 currentColor = diffuseColor;\n\n      for (int i = 0; i < X3D_NUM_TEXTURES; ++ i)\n      {\n         // Get texture color.\n\n         vec3 texCoord     = getTexCoord (i, i);\n         vec4 textureColor = getTexture (i, texCoord);\n\n         // Multi texturing\n\n         x3d_MultiTextureParameters multiTexture = x3d_MultiTexture [i];\n\n         vec4 arg1 = textureColor;\n         vec4 arg2 = currentColor;\n\n         // Source\n\n         int source = multiTexture .source;\n\n         switch (source)\n         {\n            case x3d_Diffuse:\n            {\n               arg1 = diffuseColor;\n               break;\n            }\n            case x3d_Specular:\n            {\n               arg1 = specularColor;\n               break;\n            }\n            case x3d_Factor:\n            {\n               arg1 = x3d_MultiTextureColor;\n               break;\n            }\n         }\n\n         // Function\n\n         int function = multiTexture .function;\n\n         switch (function)\n         {\n            case x3d_Complement:\n            {\n               arg1 = 1.0 - arg1;\n               break;\n            }\n            case x3d_AlphaReplicate:\n            {\n               arg1 .a = arg2 .a;\n               break;\n            }\n         }\n\n         // Mode\n\n         int mode      = multiTexture .mode;\n         int alphaMode = multiTexture .alphaMode;\n\n         // RGB\n\n         switch (mode)\n         {\n            case x3d_Replace:\n            {\n               currentColor .rgb = arg1 .rgb;\n               break;\n            }\n            case x3d_Modulate:\n            {\n               currentColor .rgb = arg1 .rgb * arg2 .rgb;\n               break;\n            }\n            case x3d_Modulate2X:\n            {\n               currentColor .rgb = (arg1 .rgb * arg2 .rgb) * 2.0;\n               break;\n            }\n            case x3d_Modulate4X:\n            {\n               currentColor .rgb = (arg1 .rgb * arg2 .rgb) * 4.0;\n               break;\n            }\n            case x3d_Add:\n            {\n               currentColor .rgb = arg1 .rgb + arg2 .rgb;\n               break;\n            }\n            case x3d_AddSigned:\n            {\n               currentColor .rgb = arg1 .rgb + arg2 .rgb - 0.5;\n               break;\n            }\n            case x3d_AddSigned2X:\n            {\n               currentColor .rgb = (arg1 .rgb + arg2 .rgb - 0.5) * 2.0;\n               break;\n            }\n            case x3d_AddSmooth:\n            {\n               currentColor .rgb = arg1 .rgb + (1.0 - arg1 .rgb) * arg2 .rgb;\n               break;\n            }\n            case x3d_Subtract:\n            {\n               currentColor .rgb = arg1 .rgb - arg2 .rgb;\n               break;\n            }\n            case x3d_BlendDiffuseAlpha:\n            {\n               currentColor .rgb = arg1 .rgb * diffuseColor .a + arg2 .rgb * (1.0 - diffuseColor .a);\n               break;\n            }\n            case x3d_BlendTextureAlpha:\n            {\n               currentColor .rgb = arg1 .rgb * arg1 .a + arg2 .rgb * (1.0 - arg1 .a);\n               break;\n            }\n            case x3d_BlendFactorAlpha:\n            {\n               currentColor .rgb = arg1 .rgb * x3d_MultiTextureColor .a + arg2 .rgb * (1.0 - x3d_MultiTextureColor .a);\n               break;\n            }\n            case x3d_BlendCurrentAlpha:\n            {\n               currentColor .rgb = arg1 .rgb * arg2 .a + arg2 .rgb * (1.0 - arg2 .a);\n               break;\n            }\n            case x3d_ModulateAlphaAddColor:\n            {\n               currentColor .rgb = arg1 .rgb + arg1 .a * arg2 .rgb;\n               break;\n            }\n            case x3d_ModulateInvAlphaAddColor:\n            {\n               currentColor .rgb = (1.0 - arg1 .a) * arg2 .rgb + arg1 .rgb;\n               break;\n            }\n            case x3d_ModulateInvColorAddAlpha:\n            {\n               currentColor .rgb = (1.0 - arg1 .rgb) * arg2 .rgb + arg1 .a;\n               break;\n            }\n            case x3d_DotProduct3:\n            {\n               currentColor .rgb = vec3 (dot (arg1 .rgb * 2.0 - 1.0, arg2 .rgb * 2.0 - 1.0));\n               break;\n            }\n            case x3d_SelectArg1:\n            {\n               currentColor .rgb = arg1 .rgb;\n               break;\n            }\n            case x3d_SelectArg2:\n            {\n               currentColor .rgb = arg2 .rgb;\n               break;\n            }\n            case x3d_Off:\n            {\n               break;\n            }\n         }\n\n         // Alpha\n\n         switch (alphaMode)\n         {\n            case x3d_Replace:\n            {\n               currentColor .a = arg1 .a;\n               break;\n            }\n            case x3d_Modulate:\n            {\n               currentColor .a = arg1 .a * arg2 .a;\n               break;\n            }\n            case x3d_Modulate2X:\n            {\n               currentColor .a = (arg1 .a * arg2 .a) * 2.0;\n               break;\n            }\n            case x3d_Modulate4X:\n            {\n               currentColor .a = (arg1 .a * arg2 .a) * 4.0;\n               break;\n            }\n            case x3d_Add:\n            {\n               currentColor .a = arg1 .a + arg2 .a;\n               break;\n            }\n            case x3d_AddSigned:\n            {\n               currentColor .a = arg1 .a + arg2 .a - 0.5;\n               break;\n            }\n            case x3d_AddSigned2X:\n            {\n               currentColor .a = (arg1 .a + arg2 .a - 0.5) * 2.0;\n               break;\n            }\n            case x3d_AddSmooth:\n            {\n               currentColor .a = arg1 .a + (1.0 - arg1 .a) * arg2 .a;\n               break;\n            }\n            case x3d_Subtract:\n            {\n               currentColor .a = arg1 .a - arg2 .a;\n               break;\n            }\n            case x3d_BlendDiffuseAlpha:\n            {\n               currentColor .a = arg1 .a * diffuseColor .a + arg2 .a * (1.0 - diffuseColor .a);\n               break;\n            }\n            case x3d_BlendTextureAlpha:\n            {\n               currentColor .a = arg1 .a * arg1 .a + arg2 .a * (1.0 - arg1 .a);\n               break;\n            }\n            case x3d_BlendFactorAlpha:\n            {\n               currentColor .a = arg1 .a * x3d_MultiTextureColor .a + arg2 .a * (1.0 - x3d_MultiTextureColor .a);\n               break;\n            }\n            case x3d_BlendCurrentAlpha:\n            {\n               currentColor .a = arg1 .a * arg2 .a + arg2 .a * (1.0 - arg2 .a);\n               break;\n            }\n            case x3d_ModulateAlphaAddColor:\n            {\n               currentColor .a = arg1 .a + arg1 .a * arg2 .a;\n               break;\n            }\n            case x3d_ModulateInvAlphaAddColor:\n            {\n               currentColor .a = (1.0 - arg1 .a) * arg2 .a + arg1 .a;\n               break;\n            }\n            case x3d_ModulateInvColorAddAlpha:\n            {\n               currentColor .a = (1.0 - arg1 .a) * arg2 .a + arg1 .a;\n               break;\n            }\n            case x3d_DotProduct3:\n            {\n               currentColor .a = dot (arg1 .rgb * 2.0 - 1.0, arg2 .rgb * 2.0 - 1.0);\n               break;\n            }\n            case x3d_SelectArg1:\n            {\n               currentColor .a = arg1 .a;\n               break;\n            }\n            case x3d_SelectArg2:\n            {\n               currentColor .a = arg2 .a;\n               break;\n            }\n            case x3d_Off:\n            {\n               break;\n            }\n         }\n      }\n\n      return currentColor;\n   #else\n      // Get texture color.\n\n      vec3 texCoord = getTexCoord (0, 0);\n\n      #if defined (X3D_TEXTURE0_2D)\n         vec4 textureColor = texture (x3d_Texture2D [0], texCoord .st);\n      #elif defined (X3D_TEXTURE0_3D)\n         vec4 textureColor = texture (x3d_Texture3D [0], texCoord .stp);\n      #elif defined (X3D_TEXTURE0_CUBE)\n         vec4 textureColor = texture (x3d_TextureCube [0], texCoord .stp);\n      #endif\n\n      return diffuseColor * textureColor;\n   #endif\n}\n\n#endif // X3D_TEXTURE\n\n#if defined (X3D_PROJECTIVE_TEXTURE_MAPPING)\n\nuniform sampler2D x3d_ProjectiveTexture [X3D_NUM_TEXTURE_PROJECTORS];\nuniform mat4      x3d_ProjectiveTextureMatrix [X3D_NUM_TEXTURE_PROJECTORS];\nuniform vec3      x3d_ProjectiveTextureLocation [X3D_NUM_TEXTURE_PROJECTORS];\n\nvec4\ngetProjectiveTexture (const in int i, const in vec2 texCoord)\n{\n   switch (i)\n   {\n      #if X3D_NUM_TEXTURE_PROJECTORS > 0\n      case 0:\n         return texture (x3d_ProjectiveTexture [0], texCoord);\n      #endif\n      #if X3D_NUM_TEXTURE_PROJECTORS > 1\n      case 1:\n         return texture (x3d_ProjectiveTexture [1], texCoord);\n      #endif\n   }\n\n   return vec4 (0.0);\n}\n\nvec4\ngetProjectiveTextureColor (in vec4 currentColor)\n{\n   vec3 N = gl_FrontFacing ? normal : -normal;\n\n   for (int i = 0; i < X3D_NUM_TEXTURE_PROJECTORS; ++ i)\n   {\n      vec4 texCoord = x3d_ProjectiveTextureMatrix [i] * vec4 (vertex, 1.0);\n\n      texCoord .stp /= texCoord .q;\n\n      if (texCoord .s < 0.0 || texCoord .s > 1.0)\n         continue;\n\n      if (texCoord .t < 0.0 || texCoord .t > 1.0)\n         continue;\n\n      if (texCoord .p < 0.0 || texCoord .p > 1.0)\n         continue;\n\n      // We do not need to normalze p, as we only need the sign of the dot product.\n      vec3 p = x3d_ProjectiveTextureLocation [i] - vertex;\n\n      if (dot (N, p) < 0.0)\n         continue;\n\n      currentColor *= getProjectiveTexture (i, texCoord .st);\n   }\n\n   return currentColor;\n}\n\n#endif // X3D_PROJECTIVE_TEXTURE_MAPPING\n',Vertex:'\n// Uniforms\n\nuniform mat4 x3d_ProjectionMatrix;\nuniform mat4 x3d_ModelViewMatrix;\n\n// Attributes\n\n#if defined (X3D_GEOMETRY_1D) && defined (X3D_STYLE_PROPERTIES)\n   in vec3 x3d_LineStipple;\n#endif\n\n#if defined (X3D_FOG) && defined (X3D_FOG_COORDS)\n   in float x3d_FogDepth;\n#endif\n\n#if defined (X3D_COLOR_MATERIAL)\n   in vec4  x3d_Color;\n#endif\n\n#if ! defined (X3D_GEOMETRY_0D) && ! defined (X3D_GEOMETRY_1D)\n   #if defined (X3D_TEXTURE) || defined (X3D_MATERIAL_TEXTURES)\n      #if X3D_NUM_TEXTURE_COORDINATES > 0\n         in vec4 x3d_TexCoord0;\n      #endif\n\n      #if X3D_NUM_TEXTURE_COORDINATES > 1\n         in vec4 x3d_TexCoord1;\n      #endif\n   #endif\n#endif\n\nin vec4 x3d_Vertex;\n\n// Varyings\n\n#if defined (X3D_FOG) && defined (X3D_FOG_COORDS)\n   out float fogDepth;\n#endif\n\n#if defined (X3D_COLOR_MATERIAL)\n   out vec4 color;\n#endif\n\n#if ! defined (X3D_GEOMETRY_0D) && ! defined (X3D_GEOMETRY_1D)\n   #if defined (X3D_TEXTURE) || defined (X3D_MATERIAL_TEXTURES)\n      #if X3D_NUM_TEXTURE_COORDINATES > 0\n         out vec4 texCoord0;\n      #endif\n\n      #if X3D_NUM_TEXTURE_COORDINATES > 1\n         out vec4 texCoord1;\n      #endif\n   #endif\n#endif\n\n#if defined (X3D_NORMALS)\n   uniform mat3 x3d_NormalMatrix;\n   in  vec3 x3d_Normal;\n   out vec3 normal;\n\n   #if defined (X3D_TEXTURE) || defined (X3D_MATERIAL_TEXTURES)\n      out vec3 localNormal;\n   #endif\n#endif\n\n#if defined (X3D_GEOMETRY_1D) && defined (X3D_STYLE_PROPERTIES)\n   flat out float lengthSoFar;\n   flat out vec2  startPoint;\n   out vec2       midPoint;\n#endif\n\nout vec3 vertex;\n\n#if defined (X3D_TEXTURE) || defined (X3D_MATERIAL_TEXTURES)\n   out vec3 localVertex;\n#endif\n\n#if defined (X3D_LOGARITHMIC_DEPTH_BUFFER)\n   out float depth;\n#endif\n\n// Main\n\n#pragma X3D include "Particle.glsl"\n#pragma X3D include "PointSize.glsl"\n\nvoid\nvertex_main ()\n{\n   #if defined (X3D_GEOMETRY_0D)\n      #if defined (X3D_STYLE_PROPERTIES)\n         gl_PointSize = pointSize = getPointSize (vertex);\n      #else\n         gl_PointSize = 1.0;\n      #endif\n   #endif\n\n   #if defined (X3D_GEOMETRY_1D) && defined (X3D_STYLE_PROPERTIES)\n      lengthSoFar = x3d_LineStipple .z;\n      startPoint  = x3d_LineStipple .xy;\n      midPoint    = x3d_LineStipple .xy;\n   #endif\n\n   #if defined (X3D_FOG) && defined (X3D_FOG_COORDS)\n      fogDepth = x3d_FogDepth;\n   #endif\n\n   #if defined (X3D_COLOR_MATERIAL)\n      color = x3d_Color;\n   #endif\n\n   #if ! defined (X3D_GEOMETRY_0D) && ! defined (X3D_GEOMETRY_1D)\n      #if defined (X3D_TEXTURE) || defined (X3D_MATERIAL_TEXTURES)\n         #if X3D_NUM_TEXTURE_COORDINATES > 0\n            texCoord0 = getTexCoord (x3d_TexCoord0);\n         #endif\n\n         #if X3D_NUM_TEXTURE_COORDINATES > 1\n            texCoord1 = getTexCoord (x3d_TexCoord1);\n         #endif\n      #endif\n   #endif\n\n   #if defined (X3D_NORMALS)\n      normal = x3d_NormalMatrix * x3d_Normal;\n\n      #if defined (X3D_TEXTURE) || defined (X3D_MATERIAL_TEXTURES)\n         localNormal = x3d_Normal;\n      #endif\n   #endif\n\n   vec4 position = x3d_ModelViewMatrix * getVertex (x3d_Vertex);\n\n   vertex = position .xyz;\n\n   #if defined (X3D_TEXTURE) || defined (X3D_MATERIAL_TEXTURES)\n      localVertex = x3d_Vertex .xyz;\n   #endif\n\n   gl_Position = x3d_ProjectionMatrix * position;\n\n   #if defined (X3D_LOGARITHMIC_DEPTH_BUFFER)\n      depth = 1.0 + gl_Position .w;\n   #endif\n}\n'}},vertex:{1:{Default:'\nprecision highp float;\nprecision highp int;\nprecision highp sampler2D;\nprecision highp samplerCube;\n\n#pragma X3D include "include/Vertex.glsl"\n\nvoid\nmain ()\n{\n   vertex_main ();\n}\n',Depth:"\nprecision highp float;\nprecision highp int;\n\nuniform mat4 x3d_ProjectionMatrix;\nuniform mat4 x3d_ModelViewMatrix;\n\nattribute vec4 x3d_Vertex;\n\nvarying vec3 vertex;\n\nvoid\nmain ()\n{\n   vec4 position = x3d_ModelViewMatrix * x3d_Vertex;\n\n   vertex = position .xyz;\n\n   gl_Position = x3d_ProjectionMatrix * position;\n}\n",Gouraud:'\nprecision highp float;\nprecision highp int;\nprecision highp sampler2D;\nprecision highp samplerCube;\n\n#pragma X3D include "include/Vertex.glsl"\n#pragma X3D include "include/Material.glsl"\n\nvarying vec4 frontColor;\n\n#if ! defined (X3D_GEOMETRY_0D) && ! defined (X3D_GEOMETRY_1D)\n   varying vec4 backColor;\n#endif\n\nvec4\ngetMaterialColor (const in vec3 N,\n                  const in vec3 vertex,\n                  const in x3d_MaterialParameters material)\n{\n   // Get diffuse parameter.\n\n   float alpha = 1.0 - x3d_Material .transparency;\n\n   #if defined (X3D_COLOR_MATERIAL)\n      vec4 diffuseParameter = vec4 (color .rgb, color .a * alpha);\n   #else\n      vec4 diffuseParameter = vec4 (x3d_Material .diffuseColor, alpha);\n   #endif\n\n   // Get material color.\n\n   vec3 ambientColor = diffuseParameter .rgb * material .ambientIntensity;\n\n   #if defined (X3D_LIGHTING)\n      vec3 finalColor = getMaterialColor (vertex, N, ambientColor, diffuseParameter .rgb, material .specularColor, material .shininess);\n   #else\n      vec3 finalColor = vec3 (0.0);\n   #endif\n\n   finalColor += material .emissiveColor;\n\n   return vec4 (finalColor, diffuseParameter .a);\n}\n\nvoid\nmain ()\n{\n   vertex_main ();\n\n   normal     = normalize (normal);\n   frontColor = getMaterialColor (normal, vertex, x3d_Material);\n\n   #if ! defined (X3D_GEOMETRY_0D) && ! defined (X3D_GEOMETRY_1D)\n      backColor = getMaterialColor (-normal, vertex, x3d_Material);\n   #endif\n}\n'},2:{Default:'#version 300 es\n\nprecision highp float;\nprecision highp int;\nprecision highp sampler2D;\nprecision highp sampler3D;\nprecision highp samplerCube;\n\n#pragma X3D include "include/Vertex.glsl"\n\nvoid\nmain ()\n{\n   vertex_main ();\n}\n',Depth:'#version 300 es\n\nprecision highp float;\nprecision highp int;\nprecision highp sampler2D;\n\nuniform mat4 x3d_ProjectionMatrix;\nuniform mat4 x3d_ModelViewMatrix;\n\nin vec4 x3d_Vertex;\n\nout vec3 vertex;\n\n#pragma X3D include "include/Particle.glsl"\n\nvoid\nmain ()\n{\n   vec4 position = x3d_ModelViewMatrix * getVertex (x3d_Vertex);\n\n   vertex = position .xyz;\n\n   gl_Position = x3d_ProjectionMatrix * position;\n}\n',Gouraud:'#version 300 es\n\nprecision highp float;\nprecision highp int;\nprecision highp sampler2D;\nprecision highp sampler3D;\nprecision highp samplerCube;\n\n#pragma X3D include "include/Vertex.glsl"\n#pragma X3D include "include/Material.glsl"\n\nout vec4 frontColor;\n\n#if ! defined (X3D_GEOMETRY_0D) && ! defined (X3D_GEOMETRY_1D)\n   out vec4 backColor;\n#endif\n\nvec4\ngetMaterialColor (const in vec3 N,\n                  const in vec3 vertex,\n                  const in x3d_MaterialParameters material)\n{\n   // Get diffuse parameter.\n\n   float alpha = 1.0 - x3d_Material .transparency;\n\n   #if defined (X3D_COLOR_MATERIAL)\n      vec4 diffuseParameter = vec4 (color .rgb, color .a * alpha);\n   #else\n      vec4 diffuseParameter = vec4 (x3d_Material .diffuseColor, alpha);\n   #endif\n\n   // Get material color.\n\n   vec3 ambientColor = diffuseParameter .rgb * material .ambientIntensity;\n\n   #if defined (X3D_LIGHTING)\n      vec3 finalColor = getMaterialColor (vertex, N, ambientColor, diffuseParameter .rgb, material .specularColor, material .shininess);\n   #else\n      vec3 finalColor = vec3 (0.0);\n   #endif\n\n   finalColor += material .emissiveColor;\n\n   return vec4 (finalColor, diffuseParameter .a);\n}\n\nvoid\nmain ()\n{\n   vertex_main ();\n\n   normal     = normalize (normal);\n   frontColor = getMaterialColor (normal, vertex, x3d_Material);\n\n   #if ! defined (X3D_GEOMETRY_0D) && ! defined (X3D_GEOMETRY_1D)\n      backColor = getMaterialColor (-normal, vertex, x3d_Material);\n   #endif\n}\n',LineTransform:"#version 300 es\n\nprecision highp float;\n\nuniform vec4  viewport;\nuniform mat4  modelViewProjectionMatrix;\nuniform mat4  invModelViewProjectionMatrix;\nuniform float scale;\n\nin vec3 x3d_LineStipple0; in float x3d_FogDepth0; in vec4 x3d_Color0; in vec4 x3d_Vertex0;\nin vec3 x3d_LineStipple1; in float x3d_FogDepth1; in vec4 x3d_Color1; in vec4 x3d_Vertex1;\n\nout vec3 lineStipple0; out float fogDepth0; out vec4 color0; out vec4 vertex0;\nout vec3 lineStipple1; out float fogDepth1; out vec4 color1; out vec4 vertex1;\nout vec3 lineStipple2; out float fogDepth2; out vec4 color2; out vec4 vertex2;\n\nvec3\nprojectPoint (const in vec4 point, const in mat4 modelViewProjectionMatrix, const in vec4 viewport)\n{\n   vec4 vin = modelViewProjectionMatrix * point;\n\n   vin .xyz = vin .xyz / (2.0 * vin .w) + 0.5;\n\n   return vec3 (vin .xy * viewport .zw + viewport .xy, vin .z);\n}\n\nvec4\nunProjectPoint (const in vec3 win, const in mat4 invModelViewProjection, const in vec4 viewport)\n{\n   vec4 vin = vec4 ((win .xy - viewport .xy) / viewport .zw * 2.0 - 1.0, 2.0 * win .z - 1.0, 1.0);\n\n   vin = invModelViewProjection * vin;\n\n   return vec4 (vin .xyz / vin .w, 1.0);\n}\n\nvoid\nmain ()\n{\n   vec3 projected0 = projectPoint (x3d_Vertex0, modelViewProjectionMatrix, viewport);\n   vec3 projected1 = projectPoint (x3d_Vertex1, modelViewProjectionMatrix, viewport);\n   vec2 direction  = normalize (projected1 .xy - projected0 .xy);\n   vec2 offset     = vec2 (-direction .y, direction .x) * scale;\n\n   // 0 - 3\n   // | Â |\n   // 1 - 2\n\n   if (gl_InstanceID == 0)\n   {\n      vec2 pq0 = projected0 .xy + offset;\n      vec2 pq1 = projected0 .xy - offset;\n      vec2 pq2 = projected1 .xy - offset;\n\n      vec4 p0 = unProjectPoint (vec3 (pq0 .xy, projected0 .z), invModelViewProjectionMatrix, viewport);\n      vec4 p1 = unProjectPoint (vec3 (pq1 .xy, projected0 .z), invModelViewProjectionMatrix, viewport);\n      vec4 p2 = unProjectPoint (vec3 (pq2 .xy, projected1 .z), invModelViewProjectionMatrix, viewport);\n\n      lineStipple0 = x3d_LineStipple0; fogDepth0 = x3d_FogDepth0; color0 = x3d_Color0; vertex0 = p0;\n      lineStipple1 = x3d_LineStipple0; fogDepth1 = x3d_FogDepth0; color1 = x3d_Color0; vertex1 = p1;\n      lineStipple2 = x3d_LineStipple1; fogDepth2 = x3d_FogDepth1; color2 = x3d_Color1; vertex2 = p2;\n   }\n   else\n   {\n      vec2 pq0 = projected0 .xy + offset;\n      vec2 pq2 = projected1 .xy - offset;\n      vec2 pq3 = projected1 .xy + offset;\n\n      vec4 p0 = unProjectPoint (vec3 (pq0 .xy, projected0 .z), invModelViewProjectionMatrix, viewport);\n      vec4 p2 = unProjectPoint (vec3 (pq2 .xy, projected1 .z), invModelViewProjectionMatrix, viewport);\n      vec4 p3 = unProjectPoint (vec3 (pq3 .xy, projected1 .z), invModelViewProjectionMatrix, viewport);\n\n      lineStipple0 = x3d_LineStipple0; fogDepth0 = x3d_FogDepth0; color0 = x3d_Color0; vertex0 = p0;\n      lineStipple1 = x3d_LineStipple1; fogDepth1 = x3d_FogDepth1; color1 = x3d_Color1; vertex1 = p2;\n      lineStipple2 = x3d_LineStipple1; fogDepth2 = x3d_FogDepth1; color2 = x3d_Color1; vertex2 = p3;\n   }\n}\n"}},fragment:{1:{Depth:'\nprecision highp float;\nprecision highp int;\n\nvarying vec3 vertex;\n\n#pragma X3D include "include/ClipPlanes.glsl"\n#pragma X3D include "include/Pack.glsl"\n\nvoid\nmain ()\n{\n   #if defined (X3D_CLIP_PLANES)\n      clip ();\n   #endif\n\n   gl_FragColor = pack (gl_FragCoord .z);\n}\n',Gouraud:'\nprecision highp float;\nprecision highp int;\nprecision highp sampler2D;\nprecision highp samplerCube;\n\n#pragma X3D include "include/Fragment.glsl"\n\nvarying vec4 frontColor;\n\n#if ! defined (X3D_GEOMETRY_0D) && ! defined (X3D_GEOMETRY_1D)\n   varying vec4 backColor;\n#endif\n\nvec4\ngetMaterialColor ()\n{\n   #if defined (X3D_GEOMETRY_0D) || defined (X3D_GEOMETRY_1D)\n      vec4 finalColor = frontColor;\n   #else\n      vec4 finalColor = gl_FrontFacing ? frontColor : backColor;\n   #endif\n\n   #if defined (X3D_TEXTURE)\n      finalColor = getTextureColor (finalColor, vec4 (1.0));\n   #endif\n\n   #if defined (X3D_PROJECTIVE_TEXTURE_MAPPING)\n      finalColor = getProjectiveTextureColor (finalColor);\n   #endif\n\n   return finalColor;\n}\n\nvoid\nmain ()\n{\n   fragment_main ();\n}\n',PBR:'\n// https://github.com/cx20/gltf-test/blob/master/examples/khronos-gltf-loader/shaders/pbr-frag.glsl\n\n#extension GL_EXT_shader_texture_lod: enable\n#extension GL_OES_standard_derivatives : enable\n\nprecision highp float;\nprecision highp int;\nprecision highp sampler2D;\nprecision highp samplerCube;\n\n#pragma X3D include "include/Fragment.glsl"\n#pragma X3D include "include/Colors.glsl"\n#pragma X3D include "include/Normal.glsl"\n#pragma X3D include "include/SpotFactor.glsl"\n#pragma X3D include "include/Shadow.glsl"\n\n#if defined (X3D_LIGHTING)\n   uniform x3d_LightSourceParameters x3d_LightSource [X3D_NUM_LIGHTS];\n#endif\n\nuniform x3d_PhysicalMaterialParameters x3d_Material;\n\n#if defined (USE_IBL)\n   uniform samplerCube diffuseEnvironmentTexture;\n   uniform samplerCube specularEnvironmentTexture;\n   uniform sampler2D brdfLUT;\n#endif\n\n#if defined (X3D_BASE_TEXTURE)\nuniform x3d_BaseTextureParameters x3d_BaseTexture;\n#endif\n\nvec4\ngetBaseColor ()\n{\n   // Get base parameter.\n\n   float alpha = 1.0 - x3d_Material .transparency;\n\n   #if defined (X3D_COLOR_MATERIAL)\n      vec4 baseParameter = vec4 (color .rgb, color .a * alpha);\n   #else\n      vec4 baseParameter = vec4 (x3d_Material .baseColor, alpha);\n   #endif\n\n   // Get texture color.\n\n   #if defined (X3D_BASE_TEXTURE)\n      vec3 texCoord = getTexCoord (x3d_BaseTexture .textureTransformMapping, x3d_BaseTexture .textureCoordinateMapping);\n      #if defined (X3D_BASE_TEXTURE_2D)\n         return baseParameter * SRGBtoLINEAR (texture2D (x3d_BaseTexture .texture2D, texCoord .st));\n      #elif defined (X3D_BASE_TEXTURE_CUBE)\n         return baseParameter * SRGBtoLINEAR (textureCube (x3d_BaseTexture .textureCube, texCoord));\n      #endif\n   #elif defined (X3D_TEXTURE)\n      return getTextureColor (baseParameter, vec4 (vec3 (1.0), alpha));\n   #else\n      return baseParameter;\n   #endif\n}\n\n#if defined (X3D_EMISSIVE_TEXTURE)\nuniform x3d_EmissiveTextureParameters x3d_EmissiveTexture;\n#endif\n\nvec3\ngetEmissiveColor ()\n{\n   // Get emissive parameter.\n\n   vec3 emissiveParameter = x3d_Material .emissiveColor;\n\n   // Get texture color.\n\n   #if defined (X3D_EMISSIVE_TEXTURE)\n      vec3 texCoord = getTexCoord (x3d_EmissiveTexture .textureTransformMapping, x3d_EmissiveTexture .textureCoordinateMapping);\n\n      #if defined (X3D_EMISSIVE_TEXTURE_2D)\n         return emissiveParameter * SRGBtoLINEAR (texture2D (x3d_EmissiveTexture .texture2D, texCoord .st)) .rgb;\n      #elif defined (X3D_EMISSIVE_TEXTURE_CUBE)\n         return emissiveParameter * SRGBtoLINEAR (textureCube (x3d_EmissiveTexture .textureCube, texCoord)) .rgb;\n      #endif\n   #else\n      return emissiveParameter .rgb;\n   #endif\n}\n\n#if defined (X3D_METALLIC_ROUGHNESS_TEXTURE)\nuniform x3d_MetallicRoughnessTextureParameters x3d_MetallicRoughnessTexture;\n#endif\n\nvec2\ngetMetallicRoughness ()\n{\n   // Metallic and Roughness material properties are packed together\n   // In glTF, these factors can be specified by fixed scalar values\n   // or from a metallic-roughness map\n   float metallic            = x3d_Material .metallic;\n   float perceptualRoughness = x3d_Material .roughness;\n\n   // Get texture color.\n\n   #if defined (X3D_METALLIC_ROUGHNESS_TEXTURE)\n      vec3 texCoord = getTexCoord (x3d_MetallicRoughnessTexture .textureTransformMapping, x3d_MetallicRoughnessTexture .textureCoordinateMapping);\n      // Roughness is stored in the \'g\' channel, metallic is stored in the \'b\' channel.\n      // This layout intentionally reserves the \'r\' channel for (optional) occlusion map data\n      #if defined (X3D_METALLIC_ROUGHNESS_TEXTURE_2D)\n         vec4 mrSample = texture2D (x3d_MetallicRoughnessTexture .texture2D, texCoord .st);\n      #elif defined (X3D_METALLIC_ROUGHNESS_TEXTURE_CUBE)\n         vec4 mrSample = textureCube (x3d_MetallicRoughnessTexture .textureCube, texCoord);\n      #endif\n      metallic            *= mrSample .b;\n      perceptualRoughness *= mrSample .g;\n\n      return vec2 (metallic, perceptualRoughness);\n   #else\n      return vec2 (metallic, perceptualRoughness);\n   #endif\n}\n\n#if defined (X3D_OCCLUSION_TEXTURE)\nuniform x3d_OcclusionTextureParameters x3d_OcclusionTexture;\n#endif\n\nfloat\ngetOcclusionFactor ()\n{\n   // Get texture color.\n\n   #if defined (X3D_OCCLUSION_TEXTURE)\n      vec3 texCoord = getTexCoord (x3d_OcclusionTexture .textureTransformMapping, x3d_OcclusionTexture .textureCoordinateMapping);\n\n      #if defined (X3D_OCCLUSION_TEXTURE_2D)\n         return texture2D (x3d_OcclusionTexture .texture2D, texCoord .st) .r;\n      #elif defined (X3D_OCCLUSION_TEXTURE_CUBE)\n         return textureCube (x3d_OcclusionTexture .textureCube, texCoord) .r;\n      #endif\n   #else\n      return 1.0;\n   #endif\n}\n\n// Encapsulate the various inputs used by the various functions in the shading equation\n// We store values in this struct to simplify the integration of alternative implementations\n// of the shading terms, outlined in the Readme.MD Appendix.\nstruct PBRInfo\n{\n   float NdotL;                  // cos angle between normal and light direction\n   float NdotV;                  // cos angle between normal and view direction\n   float NdotH;                  // cos angle between normal and half vector\n   float LdotH;                  // cos angle between light direction and half vector\n   float VdotH;                  // cos angle between view direction and half vector\n   float perceptualRoughness;    // roughness value, as authored by the model creator (input to shader)\n   float metalness;              // metallic value at the surface\n   vec3 reflectance0;            // full reflectance color (normal incidence angle)\n   vec3 reflectance90;           // reflectance color at grazing angle\n   float alphaRoughness;         // roughness mapped to a more linear change in the roughness (proposed by [2])\n   vec3 diffuseColor;            // color contribution from diffuse lighting\n   vec3 specularColor;           // color contribution from specular lighting\n};\n\nconst float M_PI           = 3.141592653589793;\nconst float c_MinRoughness = 0.04;\n\n#if defined (USE_IBL)\n// Calculation of the lighting contribution from an optional Image Based Light source.\n// Precomputed Environment Maps are required uniform inputs and are computed as outlined in [1].\n// See our README.md on Environment Maps [3] for additional discussion.\nvec3\ngetIBLContribution (const in PBRInfo pbrInputs, vec3 n, const in vec3 reflection)\n{\n   float mipCount = 9.0; // resolution of 512x512\n   float lod      = pbrInputs .perceptualRoughness * mipCount;\n\n   // retrieve a scale and bias to F0. See [1], Figure 3\n   vec3 brdf         = SRGBtoLINEAR (texture2D (brdfLUT, vec2 (pbrInputs .NdotV, 1.0 - pbrInputs .perceptualRoughness))) .rgb;\n   vec3 diffuseLight = SRGBtoLINEAR (textureCube (diffuseEnvironmentTexture, n)) .rgb;\n\n   #if defined (USE_TEX_LOD)\n      vec3 specularLight = SRGBtoLINEAR (textureCubeLodEXT (specularEnvironmentTexture, reflection, lod)) .rgb;\n   #else\n      vec3 specularLight = SRGBtoLINEAR (textureCube (specularEnvironmentTexture, reflection)) .rgb;\n   #endif\n\n   vec3 diffuse  = diffuseLight * pbrInputs .diffuseColor;\n   vec3 specular = specularLight * (pbrInputs .specularColor * brdf .x + brdf .y);\n\n   return diffuse + specular;\n}\n#endif\n\n// Basic Lambertian diffuse\n// Implementation from Lambert\'s Photometria https://archive.org/details/lambertsphotome00lambgoog\n// See also [1], Equation 1\nvec3\ndiffuse (const in PBRInfo pbrInputs)\n{\n   return pbrInputs .diffuseColor / M_PI;\n}\n\n// The following equation models the Fresnel reflectance term of the spec equation (aka F())\n// Implementation of fresnel from [4], Equation 15\nvec3\nspecularReflection (const in PBRInfo pbrInputs)\n{\n   return pbrInputs .reflectance0 + (pbrInputs .reflectance90 - pbrInputs .reflectance0) * pow (clamp (1.0 - pbrInputs .VdotH, 0.0, 1.0), 5.0);\n}\n\n// This calculates the specular geometric attenuation (aka G()),\n// where rougher material will reflect less light back to the viewer.\n// This implementation is based on [1] Equation 4, and we adopt their modifications to\n// alphaRoughness as input as originally proposed in [2].\nfloat\ngeometricOcclusion (const in PBRInfo pbrInputs)\n{\n   float NdotL = pbrInputs .NdotL;\n   float NdotV = pbrInputs .NdotV;\n   float r     = pbrInputs .alphaRoughness;\n\n   float attenuationL = 2.0 * NdotL / (NdotL + sqrt (r * r + (1.0 - r * r) * (NdotL * NdotL)));\n   float attenuationV = 2.0 * NdotV / (NdotV + sqrt (r * r + (1.0 - r * r) * (NdotV * NdotV)));\n\n   return attenuationL * attenuationV;\n}\n\n// The following equation(s) model the distribution of microfacet normals across the area being drawn (aka D())\n// Implementation from "Average Irregularity Representation of a Roughened Surface for Ray Reflection" by T. S. Trowbridge, and K. P. Reitz\n// Follows the distribution function recommended in the SIGGRAPH 2013 course notes from EPIC Games [1], Equation 3.\nfloat\nmicrofacetDistribution (const in PBRInfo pbrInputs)\n{\n   float roughnessSq = pbrInputs .alphaRoughness * pbrInputs .alphaRoughness;\n   float f           = (pbrInputs .NdotH * roughnessSq - pbrInputs .NdotH) * pbrInputs .NdotH + 1.0;\n\n   return roughnessSq / (M_PI * f * f);\n}\n\nvec4\ngetMaterialColor ()\n{\n   // Metallic and Roughness material properties are packed together\n   // In glTF, these factors can be specified by fixed scalar values\n   // or from a metallic-roughness map.\n\n   vec2  metallicRoughness   = getMetallicRoughness ();\n   float perceptualRoughness = clamp (metallicRoughness [1], c_MinRoughness, 1.0);\n   float metallic            = clamp (metallicRoughness [0], 0.0, 1.0);\n\n   // Roughness is authored as perceptual roughness; as is convention,\n   // convert to material roughness by squaring the perceptual roughness [2].\n   float alphaRoughness = perceptualRoughness * perceptualRoughness;\n\n   // The albedo may be defined from a base texture or a flat color.\n   vec4  baseColor    = getBaseColor ();\n   float alpha        = baseColor .a;\n   vec3  f0           = vec3 (0.04);\n   vec3  diffuseColor = baseColor .rgb * (vec3 (1.0) - f0);\n   diffuseColor *= 1.0 - metallic;\n\n   vec3 specularColor = mix (f0, baseColor .rgb, metallic);\n\n   // Compute reflectance.\n   float reflectance = max (max (specularColor .r, specularColor .g), specularColor .b);\n\n   // For typical incident reflectance range (between 4% to 100%) set the grazing reflectance to 100% for typical fresnel effect.\n   // For very low reflectance range on highly diffuse objects (below 4%), incrementally reduce grazing reflecance to 0%.\n   float reflectance90          = clamp (reflectance * 25.0, 0.0, 1.0);\n   vec3  specularEnvironmentR0  = specularColor .rgb;\n   vec3  specularEnvironmentR90 = vec3 (1.0, 1.0, 1.0) * reflectance90;\n\n   // Apply light sources\n\n   vec3 n = getNormalVector (x3d_Material .normalScale);  // normal at surface point\n   vec3 v = normalize (-vertex); // Vector from surface point to camera\n\n   vec3 finalColor = vec3 (0.0);\n\n   #if defined (X3D_LIGHTING)\n   for (int i = 0; i < X3D_NUM_LIGHTS; i ++)\n   {\n      x3d_LightSourceParameters light = x3d_LightSource [i];\n\n      vec3  vL = light .location - vertex; // Light to fragment\n      float dL = length (light .matrix * vL);\n      bool  di = light .type == x3d_DirectionalLight;\n\n      if (di || dL <= light .radius)\n      {\n         vec3 d = light .direction;\n         vec3 c = light .attenuation;\n         vec3 L = di ? -d : normalize (vL); // Normalized vector from point on geometry to light source i position.\n\n         vec3 l = normalize (L);       // Vector from surface point to light\n         vec3 h = normalize (l + v);   // Half vector between both l and v\n\n         float NdotL = clamp (dot (n, l), 0.001, 1.0);\n         float NdotV = abs (dot (n, v)) + 0.001;\n         float NdotH = clamp (dot (n, h), 0.0, 1.0);\n         float LdotH = clamp (dot (l, h), 0.0, 1.0);\n         float VdotH = clamp (dot (v, h), 0.0, 1.0);\n\n         PBRInfo pbrInputs = PBRInfo (\n            NdotL,\n            NdotV,\n            NdotH,\n            LdotH,\n            VdotH,\n            perceptualRoughness,\n            metallic,\n            specularEnvironmentR0,\n            specularEnvironmentR90,\n            alphaRoughness,\n            diffuseColor,\n            specularColor\n         );\n\n         // Calculate the shading terms for the microfacet specular shading model.\n         vec3  F = specularReflection (pbrInputs);\n         float G = geometricOcclusion (pbrInputs);\n         float D = microfacetDistribution (pbrInputs);\n\n         float attenuationFactor     = di ? 1.0 : 1.0 / max (dot (c, vec3 (1.0, dL, dL * dL)), 1.0);\n         float spotFactor            = light .type == x3d_SpotLight ? getSpotFactor (light .cutOffAngle, light .beamWidth, L, d) : 1.0;\n         float attenuationSpotFactor = attenuationFactor * spotFactor;\n\n         // Calculation of analytical lighting contribution\n         vec3 diffuseContrib     = (1.0 - F) * diffuse (pbrInputs);\n         vec3 specContrib        = F * G * D / (4.0 * NdotL * NdotV);\n         vec3 diffuseSpecContrib = light .intensity * (diffuseContrib + specContrib);\n\n         #if defined (X3D_SHADOWS)\n            if (NdotL > 0.001)\n               diffuseSpecContrib = mix (diffuseSpecContrib, light .shadowColor, getShadowIntensity (i, light));\n         #endif\n\n         vec3 color = NdotL * attenuationSpotFactor * light .color * diffuseSpecContrib;\n\n         finalColor += color;\n      }\n   }\n   #endif\n\n   // Calculate lighting contribution from image based lighting source (IBL).\n   #if defined (USE_IBL)\n   vec3 reflection = -normalize (reflect (v, n));\n   finalColor += getIBLContribution (pbrInputs, n, reflection);\n   #endif\n\n   // Apply optional PBR terms for additional (optional) shading.\n   #if defined (X3D_OCCLUSION_TEXTURE)\n   finalColor = mix (finalColor, finalColor * getOcclusionFactor (), x3d_Material .occlusionStrength);\n   #endif\n\n   finalColor += getEmissiveColor ();\n\n   // Combine with alpha and do gamma correction.\n   return Gamma (vec4 (finalColor, alpha));\n}\n\nvoid\nmain ()\n{\n   fragment_main ();\n}\n',Phong:'\nprecision highp float;\nprecision highp int;\nprecision highp sampler2D;\nprecision highp samplerCube;\n\n#pragma X3D include "include/Fragment.glsl"\n#pragma X3D include "include/Material.glsl"\n#pragma X3D include "include/Normal.glsl"\n\n#if defined (X3D_AMBIENT_TEXTURE)\nuniform x3d_AmbientTextureParameters x3d_AmbientTexture;\n#endif\n\nvec3\ngetAmbientColor (const in vec3 diffuseColor)\n{\n   // Get ambient parameter.\n\n   vec3 ambientParameter = x3d_Material .ambientIntensity * diffuseColor;\n\n   // Get texture color.\n\n   #if defined (X3D_AMBIENT_TEXTURE)\n      vec3 texCoord = getTexCoord (x3d_AmbientTexture .textureTransformMapping, x3d_AmbientTexture .textureCoordinateMapping);\n\n      #if defined (X3D_AMBIENT_TEXTURE_2D)\n         return ambientParameter * texture2D (x3d_AmbientTexture .texture2D, texCoord .st) .rgb;\n      #elif defined (X3D_AMBIENT_TEXTURE_CUBE)\n         return ambientParameter * textureCube (x3d_AmbientTexture .textureCube, texCoord) .rgb;\n      #endif\n   #else\n      return ambientParameter;\n   #endif\n}\n\n#if defined (X3D_DIFFUSE_TEXTURE)\nuniform x3d_DiffuseTextureParameters x3d_DiffuseTexture;\n#endif\n\nvec4\ngetDiffuseColor ()\n{\n   // Get diffuse parameter.\n\n   float alpha = 1.0 - x3d_Material .transparency;\n\n   #if defined (X3D_COLOR_MATERIAL)\n      vec4 diffuseParameter = vec4 (color .rgb, color .a * alpha);\n   #else\n      vec4 diffuseParameter = vec4 (x3d_Material .diffuseColor, alpha);\n   #endif\n\n   // Get texture color.\n\n   #if defined (X3D_DIFFUSE_TEXTURE)\n      vec3 texCoord = getTexCoord (x3d_DiffuseTexture .textureTransformMapping, x3d_DiffuseTexture .textureCoordinateMapping);\n\n      #if defined (X3D_DIFFUSE_TEXTURE_2D)\n         return diffuseParameter * texture2D (x3d_DiffuseTexture .texture2D, texCoord .st);\n      #elif defined (X3D_DIFFUSE_TEXTURE_CUBE)\n         return diffuseParameter * textureCube (x3d_DiffuseTexture .textureCube, texCoord);\n      #endif\n   #elif defined (X3D_TEXTURE)\n      return getTextureColor (diffuseParameter, vec4 (x3d_Material .specularColor, alpha));\n   #else\n      return diffuseParameter;\n   #endif\n}\n\n#if defined (X3D_SPECULAR_TEXTURE)\nuniform x3d_SpecularTextureParameters x3d_SpecularTexture;\n#endif\n\nvec3\ngetSpecularColor ()\n{\n   // Get specular parameter.\n\n   vec3 specularParameter = x3d_Material .specularColor;\n\n   // Get texture color.\n\n   #if defined (X3D_SPECULAR_TEXTURE)\n      vec3 texCoord = getTexCoord (x3d_SpecularTexture .textureTransformMapping, x3d_SpecularTexture .textureCoordinateMapping);\n\n      #if defined (X3D_SPECULAR_TEXTURE_2D)\n         return specularParameter * texture2D (x3d_SpecularTexture .texture2D, texCoord .st) .rgb;\n      #elif defined (X3D_SPECULAR_TEXTURE_CUBE)\n         return specularParameter * textureCube (x3d_SpecularTexture .textureCube, texCoord) .rgb;\n      #endif\n   #else\n      return specularParameter;\n   #endif\n}\n\n#if defined (X3D_EMISSIVE_TEXTURE)\nuniform x3d_EmissiveTextureParameters x3d_EmissiveTexture;\n#endif\n\nvec3\ngetEmissiveColor ()\n{\n   // Get emissive parameter.\n\n   vec3 emissiveParameter = x3d_Material .emissiveColor;\n\n   // Get texture color.\n\n   #if defined (X3D_EMISSIVE_TEXTURE)\n      vec3 texCoord = getTexCoord (x3d_EmissiveTexture .textureTransformMapping, x3d_EmissiveTexture .textureCoordinateMapping);\n\n      #if defined (X3D_EMISSIVE_TEXTURE_2D)\n         return emissiveParameter * texture2D (x3d_EmissiveTexture .texture2D, texCoord .st) .rgb;\n      #elif defined (X3D_EMISSIVE_TEXTURE_CUBE)\n         return emissiveParameter * textureCube (x3d_EmissiveTexture .textureCube, texCoord) .rgb;\n      #endif\n   #else\n      return emissiveParameter;\n   #endif\n}\n\n#if defined (X3D_SHININESS_TEXTURE)\nuniform x3d_ShininessTextureParameters x3d_ShininessTexture;\n#endif\n\nfloat\ngetShininessFactor ()\n{\n   // Get shininess parameter.\n\n   float shininess = x3d_Material .shininess;\n\n   // Get texture color.\n\n   #if defined (X3D_SHININESS_TEXTURE)\n      vec3 texCoord = getTexCoord (x3d_ShininessTexture .textureTransformMapping, x3d_ShininessTexture .textureCoordinateMapping);\n\n      #if defined (X3D_SHININESS_TEXTURE_2D)\n         return shininess * texture2D (x3d_ShininessTexture .texture2D, texCoord .st) .a;\n      #elif defined (X3D_SHININESS_TEXTURE_CUBE)\n         return shininess * textureCube (x3d_ShininessTexture .textureCube, texCoord) .a;\n      #endif\n   #else\n      return shininess;\n   #endif\n}\n\n#if defined (X3D_OCCLUSION_TEXTURE)\nuniform x3d_OcclusionTextureParameters x3d_OcclusionTexture;\n#endif\n\nfloat\ngetOcclusionFactor ()\n{\n   // Get texture color.\n\n   #if defined (X3D_OCCLUSION_TEXTURE)\n      vec3 texCoord = getTexCoord (x3d_OcclusionTexture .textureTransformMapping, x3d_OcclusionTexture .textureCoordinateMapping);\n\n      #if defined (X3D_OCCLUSION_TEXTURE_2D)\n         return texture2D (x3d_OcclusionTexture .texture2D, texCoord .st) .r;\n      #elif defined (X3D_OCCLUSION_TEXTURE_CUBE)\n         return textureCube (x3d_OcclusionTexture .textureCube, texCoord) .r;\n      #endif\n   #else\n      return 1.0;\n   #endif\n}\n\nvec4\ngetMaterialColor ()\n{\n   // Calculate diffuseColor & alpha\n\n   vec4  diffuseColorAlpha = getDiffuseColor ();\n   float alpha             = diffuseColorAlpha .a;\n   vec3  diffuseColor      = diffuseColorAlpha .rgb;\n   vec3  ambientColor      = getAmbientColor (diffuseColor);\n   vec3  specularColor     = getSpecularColor ();\n   float shininess         = getShininessFactor ();\n   float normalScale       = x3d_Material .normalScale;\n\n   #if defined (X3D_PROJECTIVE_TEXTURE_MAPPING)\n      vec4 P = getProjectiveTextureColor (vec4 (1.0));\n\n      diffuseColor *= P .rgb;\n      alpha        *= P .a;\n   #endif\n\n   #if defined (X3D_LIGHTING)\n      vec3 finalColor = getMaterialColor (vertex, getNormalVector (normalScale), ambientColor, diffuseColor, specularColor, shininess);\n   #else\n      vec3 finalColor = vec3 (0.0);\n   #endif\n\n   #if defined (X3D_OCCLUSION_TEXTURE)\n   finalColor = mix (finalColor, finalColor * getOcclusionFactor (), x3d_Material .occlusionStrength);\n   #endif\n\n   finalColor += getEmissiveColor ();\n\n   return vec4 (finalColor, alpha);\n}\n\nvoid\nmain ()\n{\n   fragment_main ();\n}\n',Unlit:'\nprecision highp float;\nprecision highp int;\nprecision highp sampler2D;\nprecision highp samplerCube;\n\n#pragma X3D include "include/Fragment.glsl"\nuniform x3d_UnlitMaterialParameters x3d_Material;\n\n#if defined (X3D_EMISSIVE_TEXTURE)\nuniform x3d_EmissiveTextureParameters x3d_EmissiveTexture;\n#endif\n\nvec4\ngetEmissiveColor ()\n{\n   // Get emissive parameter.\n\n   float alpha = 1.0 - x3d_Material .transparency;\n\n   #if defined (X3D_COLOR_MATERIAL)\n      vec4 emissiveParameter = vec4 (color .rgb, color .a * alpha);\n   #else\n      vec4 emissiveParameter = vec4 (x3d_Material .emissiveColor, alpha);\n   #endif\n\n   // Get texture color.\n\n   #if defined (X3D_EMISSIVE_TEXTURE)\n      vec3 texCoord = getTexCoord (x3d_EmissiveTexture .textureTransformMapping, x3d_EmissiveTexture .textureCoordinateMapping);\n\n      #if defined (X3D_EMISSIVE_TEXTURE_2D)\n         return emissiveParameter * texture2D (x3d_EmissiveTexture .texture2D, texCoord .st);\n      #elif defined (X3D_EMISSIVE_TEXTURE_CUBE)\n         return emissiveParameter * textureCube (x3d_EmissiveTexture .textureCube, texCoord);\n      #endif\n   #elif defined (X3D_TEXTURE)\n      return getTextureColor (emissiveParameter, vec4 (vec3 (1.0), alpha));\n   #else\n      return emissiveParameter;\n   #endif\n}\n\nvec4\ngetMaterialColor ()\n{\n   return getEmissiveColor ();\n}\n\nvoid\nmain ()\n{\n   fragment_main ();\n}\n'},2:{Depth:'#version 300 es\n\nprecision highp float;\nprecision highp int;\n\nin vec3 vertex;\n\nout vec4 x3d_FragColor;\n\n#pragma X3D include "include/ClipPlanes.glsl"\n#pragma X3D include "include/Pack.glsl"\n\nvoid\nmain ()\n{\n   #if defined (X3D_CLIP_PLANES)\n      clip ();\n   #endif\n\n   x3d_FragColor = pack (gl_FragCoord .z);\n}\n',Gouraud:'#version 300 es\n\nprecision highp float;\nprecision highp int;\nprecision highp sampler2D;\nprecision highp sampler3D;\nprecision highp samplerCube;\n\n#pragma X3D include "include/Fragment.glsl"\n\nin vec4 frontColor;\n\n#if ! defined (X3D_GEOMETRY_0D) && ! defined (X3D_GEOMETRY_1D)\n   in vec4 backColor;\n#endif\n\nvec4\ngetMaterialColor ()\n{\n   #if defined (X3D_GEOMETRY_0D) || defined (X3D_GEOMETRY_1D)\n      vec4 finalColor = frontColor;\n   #else\n      vec4 finalColor = gl_FrontFacing ? frontColor : backColor;\n   #endif\n\n   #if defined (X3D_TEXTURE)\n      finalColor = getTextureColor (finalColor, vec4 (1.0));\n   #endif\n\n   #if defined (X3D_PROJECTIVE_TEXTURE_MAPPING)\n      finalColor = getProjectiveTextureColor (finalColor);\n   #endif\n\n   return finalColor;\n}\n\nvoid\nmain ()\n{\n   fragment_main ();\n}\n',LineTransform:"#version 300 es\n\nprecision highp float;\n\nvoid\nmain () { }\n",PBR:'#version 300 es\n\n// https://github.com/cx20/gltf-test/blob/master/examples/khronos-gltf-loader/shaders/pbr-frag.glsl\n\nprecision highp float;\nprecision highp int;\nprecision highp sampler2D;\nprecision highp sampler3D;\nprecision highp samplerCube;\n\n#pragma X3D include "include/Fragment.glsl"\n#pragma X3D include "include/Colors.glsl"\n#pragma X3D include "include/Normal.glsl"\n#pragma X3D include "include/SpotFactor.glsl"\n#pragma X3D include "include/Shadow.glsl"\n\n#if defined (X3D_LIGHTING)\n   uniform x3d_LightSourceParameters x3d_LightSource [X3D_NUM_LIGHTS];\n#endif\n\nuniform x3d_PhysicalMaterialParameters x3d_Material;\n\n#if defined (USE_IBL)\n   uniform samplerCube diffuseEnvironmentTexture;\n   uniform samplerCube specularEnvironmentTexture;\n   uniform sampler2D brdfLUT;\n#endif\n\n#if defined (X3D_BASE_TEXTURE)\nuniform x3d_BaseTextureParameters x3d_BaseTexture;\n#endif\n\nvec4\ngetBaseColor ()\n{\n   // Get base parameter.\n\n   float alpha = 1.0 - x3d_Material .transparency;\n\n   #if defined (X3D_COLOR_MATERIAL)\n      vec4 baseParameter = vec4 (color .rgb, color .a * alpha);\n   #else\n      vec4 baseParameter = vec4 (x3d_Material .baseColor, alpha);\n   #endif\n\n   // Get texture color.\n\n   #if defined (X3D_BASE_TEXTURE)\n      vec3 texCoord = getTexCoord (x3d_BaseTexture .textureTransformMapping, x3d_BaseTexture .textureCoordinateMapping);\n      #if defined (X3D_BASE_TEXTURE_2D)\n         return baseParameter * SRGBtoLINEAR (texture (x3d_BaseTexture .texture2D, texCoord .st));\n      #elif defined (X3D_BASE_TEXTURE_3D)\n         return baseParameter * SRGBtoLINEAR (texture (x3d_BaseTexture .texture3D, texCoord));\n      #elif defined (X3D_BASE_TEXTURE_CUBE)\n         return baseParameter * SRGBtoLINEAR (texture (x3d_BaseTexture .textureCube, texCoord));\n      #endif\n   #elif defined (X3D_TEXTURE)\n      return getTextureColor (baseParameter, vec4 (vec3 (1.0), alpha));\n   #else\n      return baseParameter;\n   #endif\n}\n\n#if defined (X3D_EMISSIVE_TEXTURE)\nuniform x3d_EmissiveTextureParameters x3d_EmissiveTexture;\n#endif\n\nvec3\ngetEmissiveColor ()\n{\n   // Get emissive parameter.\n\n   vec3 emissiveParameter = x3d_Material .emissiveColor;\n\n   // Get texture color.\n\n   #if defined (X3D_EMISSIVE_TEXTURE)\n      vec3 texCoord = getTexCoord (x3d_EmissiveTexture .textureTransformMapping, x3d_EmissiveTexture .textureCoordinateMapping);\n\n      #if defined (X3D_EMISSIVE_TEXTURE_2D)\n         return emissiveParameter * SRGBtoLINEAR (texture (x3d_EmissiveTexture .texture2D, texCoord .st)) .rgb;\n      #elif defined (X3D_EMISSIVE_TEXTURE_3D)\n         return emissiveParameter * SRGBtoLINEAR (texture (x3d_EmissiveTexture .texture3D, texCoord)) .rgb;\n      #elif defined (X3D_EMISSIVE_TEXTURE_CUBE)\n         return emissiveParameter * SRGBtoLINEAR (texture (x3d_EmissiveTexture .textureCube, texCoord)) .rgb;\n      #endif\n   #else\n      return emissiveParameter .rgb;\n   #endif\n}\n\n#if defined (X3D_METALLIC_ROUGHNESS_TEXTURE)\nuniform x3d_MetallicRoughnessTextureParameters x3d_MetallicRoughnessTexture;\n#endif\n\nvec2\ngetMetallicRoughness ()\n{\n   // Metallic and Roughness material properties are packed together\n   // In glTF, these factors can be specified by fixed scalar values\n   // or from a metallic-roughness map\n   float metallic            = x3d_Material .metallic;\n   float perceptualRoughness = x3d_Material .roughness;\n\n   // Get texture color.\n\n   #if defined (X3D_METALLIC_ROUGHNESS_TEXTURE)\n      vec3 texCoord = getTexCoord (x3d_MetallicRoughnessTexture .textureTransformMapping, x3d_MetallicRoughnessTexture .textureCoordinateMapping);\n      // Roughness is stored in the \'g\' channel, metallic is stored in the \'b\' channel.\n      // This layout intentionally reserves the \'r\' channel for (optional) occlusion map data\n      #if defined (X3D_METALLIC_ROUGHNESS_TEXTURE_2D)\n         vec4 mrSample = texture (x3d_MetallicRoughnessTexture .texture2D, texCoord .st);\n      #elif defined (X3D_METALLIC_ROUGHNESS_TEXTURE_3D)\n         vec4 mrSample = texture (x3d_MetallicRoughnessTexture .texture3D, texCoord);\n      #elif defined (X3D_METALLIC_ROUGHNESS_TEXTURE_CUBE)\n         vec4 mrSample = texture (x3d_MetallicRoughnessTexture .textureCube, texCoord);\n      #endif\n      metallic            *= mrSample .b;\n      perceptualRoughness *= mrSample .g;\n\n      return vec2 (metallic, perceptualRoughness);\n   #else\n      return vec2 (metallic, perceptualRoughness);\n   #endif\n}\n\n#if defined (X3D_OCCLUSION_TEXTURE)\nuniform x3d_OcclusionTextureParameters x3d_OcclusionTexture;\n#endif\n\nfloat\ngetOcclusionFactor ()\n{\n   // Get texture color.\n\n   #if defined (X3D_OCCLUSION_TEXTURE)\n      vec3 texCoord = getTexCoord (x3d_OcclusionTexture .textureTransformMapping, x3d_OcclusionTexture .textureCoordinateMapping);\n\n      #if defined (X3D_OCCLUSION_TEXTURE_2D)\n         return texture (x3d_OcclusionTexture .texture2D, texCoord .st) .r;\n      #elif defined (X3D_OCCLUSION_TEXTURE_3D)\n         return texture (x3d_OcclusionTexture .texture3D, texCoord) .r;\n      #elif defined (X3D_OCCLUSION_TEXTURE_CUBE)\n         return texture (x3d_OcclusionTexture .textureCube, texCoord) .r;\n      #endif\n   #else\n      return 1.0;\n   #endif\n}\n\n// Encapsulate the various inputs used by the various functions in the shading equation\n// We store values in this struct to simplify the integration of alternative implementations\n// of the shading terms, outlined in the Readme.MD Appendix.\nstruct PBRInfo\n{\n   float NdotL;                  // cos angle between normal and light direction\n   float NdotV;                  // cos angle between normal and view direction\n   float NdotH;                  // cos angle between normal and half vector\n   float LdotH;                  // cos angle between light direction and half vector\n   float VdotH;                  // cos angle between view direction and half vector\n   float perceptualRoughness;    // roughness value, as authored by the model creator (input to shader)\n   float metalness;              // metallic value at the surface\n   vec3 reflectance0;            // full reflectance color (normal incidence angle)\n   vec3 reflectance90;           // reflectance color at grazing angle\n   float alphaRoughness;         // roughness mapped to a more linear change in the roughness (proposed by [2])\n   vec3 diffuseColor;            // color contribution from diffuse lighting\n   vec3 specularColor;           // color contribution from specular lighting\n};\n\nconst float M_PI           = 3.141592653589793;\nconst float c_MinRoughness = 0.04;\n\n#if defined (USE_IBL)\n// Calculation of the lighting contribution from an optional Image Based Light source.\n// Precomputed Environment Maps are required uniform inputs and are computed as outlined in [1].\n// See our README.md on Environment Maps [3] for additional discussion.\nvec3\ngetIBLContribution (const in PBRInfo pbrInputs, vec3 n, const in vec3 reflection)\n{\n   float mipCount = 9.0; // resolution of 512x512\n   float lod      = pbrInputs .perceptualRoughness * mipCount;\n\n   // retrieve a scale and bias to F0. See [1], Figure 3\n   vec3 brdf         = SRGBtoLINEAR (texture (brdfLUT, vec2 (pbrInputs .NdotV, 1.0 - pbrInputs .perceptualRoughness))) .rgb;\n   vec3 diffuseLight = SRGBtoLINEAR (textureCube (diffuseEnvironmentTexture, n)) .rgb;\n\n   #if defined (USE_TEX_LOD)\n      vec3 specularLight = SRGBtoLINEAR (textureCubeLodEXT (specularEnvironmentTexture, reflection, lod)) .rgb;\n   #else\n      vec3 specularLight = SRGBtoLINEAR (textureCube (specularEnvironmentTexture, reflection)) .rgb;\n   #endif\n\n   vec3 diffuse  = diffuseLight * pbrInputs .diffuseColor;\n   vec3 specular = specularLight * (pbrInputs .specularColor * brdf .x + brdf .y);\n\n   return diffuse + specular;\n}\n#endif\n\n// Basic Lambertian diffuse\n// Implementation from Lambert\'s Photometria https://archive.org/details/lambertsphotome00lambgoog\n// See also [1], Equation 1\nvec3\ndiffuse (const in PBRInfo pbrInputs)\n{\n   return pbrInputs .diffuseColor / M_PI;\n}\n\n// The following equation models the Fresnel reflectance term of the spec equation (aka F())\n// Implementation of fresnel from [4], Equation 15\nvec3\nspecularReflection (const in PBRInfo pbrInputs)\n{\n   return pbrInputs .reflectance0 + (pbrInputs .reflectance90 - pbrInputs .reflectance0) * pow (clamp (1.0 - pbrInputs .VdotH, 0.0, 1.0), 5.0);\n}\n\n// This calculates the specular geometric attenuation (aka G()),\n// where rougher material will reflect less light back to the viewer.\n// This implementation is based on [1] Equation 4, and we adopt their modifications to\n// alphaRoughness as input as originally proposed in [2].\nfloat\ngeometricOcclusion (const in PBRInfo pbrInputs)\n{\n   float NdotL = pbrInputs .NdotL;\n   float NdotV = pbrInputs .NdotV;\n   float r     = pbrInputs .alphaRoughness;\n\n   float attenuationL = 2.0 * NdotL / (NdotL + sqrt (r * r + (1.0 - r * r) * (NdotL * NdotL)));\n   float attenuationV = 2.0 * NdotV / (NdotV + sqrt (r * r + (1.0 - r * r) * (NdotV * NdotV)));\n\n   return attenuationL * attenuationV;\n}\n\n// The following equation(s) model the distribution of microfacet normals across the area being drawn (aka D())\n// Implementation from "Average Irregularity Representation of a Roughened Surface for Ray Reflection" by T. S. Trowbridge, and K. P. Reitz\n// Follows the distribution function recommended in the SIGGRAPH 2013 course notes from EPIC Games [1], Equation 3.\nfloat\nmicrofacetDistribution (const in PBRInfo pbrInputs)\n{\n   float roughnessSq = pbrInputs .alphaRoughness * pbrInputs .alphaRoughness;\n   float f           = (pbrInputs .NdotH * roughnessSq - pbrInputs .NdotH) * pbrInputs .NdotH + 1.0;\n\n   return roughnessSq / (M_PI * f * f);\n}\n\nvec4\ngetMaterialColor ()\n{\n   // Metallic and Roughness material properties are packed together\n   // In glTF, these factors can be specified by fixed scalar values\n   // or from a metallic-roughness map.\n\n   vec2  metallicRoughness   = getMetallicRoughness ();\n   float perceptualRoughness = clamp (metallicRoughness [1], c_MinRoughness, 1.0);\n   float metallic            = clamp (metallicRoughness [0], 0.0, 1.0);\n\n   // Roughness is authored as perceptual roughness; as is convention,\n   // convert to material roughness by squaring the perceptual roughness [2].\n   float alphaRoughness = perceptualRoughness * perceptualRoughness;\n\n   // The albedo may be defined from a base texture or a flat color.\n   vec4  baseColor    = getBaseColor ();\n   float alpha        = baseColor .a;\n   vec3  f0           = vec3 (0.04);\n   vec3  diffuseColor = baseColor .rgb * (vec3 (1.0) - f0);\n   diffuseColor *= 1.0 - metallic;\n\n   vec3 specularColor = mix (f0, baseColor .rgb, metallic);\n\n   // Compute reflectance.\n   float reflectance = max (max (specularColor .r, specularColor .g), specularColor .b);\n\n   // For typical incident reflectance range (between 4% to 100%) set the grazing reflectance to 100% for typical fresnel effect.\n   // For very low reflectance range on highly diffuse objects (below 4%), incrementally reduce grazing reflecance to 0%.\n   float reflectance90          = clamp (reflectance * 25.0, 0.0, 1.0);\n   vec3  specularEnvironmentR0  = specularColor .rgb;\n   vec3  specularEnvironmentR90 = vec3 (1.0, 1.0, 1.0) * reflectance90;\n\n   // Apply light sources\n\n   vec3 n = getNormalVector (x3d_Material .normalScale);  // normal at surface point\n   vec3 v = normalize (-vertex); // Vector from surface point to camera\n\n   vec3 finalColor = vec3 (0.0);\n\n   #if defined (X3D_LIGHTING)\n   for (int i = 0; i < X3D_NUM_LIGHTS; i ++)\n   {\n      x3d_LightSourceParameters light = x3d_LightSource [i];\n\n      vec3  vL = light .location - vertex; // Light to fragment\n      float dL = length (light .matrix * vL);\n      bool  di = light .type == x3d_DirectionalLight;\n\n      if (di || dL <= light .radius)\n      {\n         vec3 d = light .direction;\n         vec3 c = light .attenuation;\n         vec3 L = di ? -d : normalize (vL); // Normalized vector from point on geometry to light source i position.\n\n         vec3 l = normalize (L);       // Vector from surface point to light\n         vec3 h = normalize (l + v);   // Half vector between both l and v\n\n         float NdotL = clamp (dot (n, l), 0.001, 1.0);\n         float NdotV = abs (dot (n, v)) + 0.001;\n         float NdotH = clamp (dot (n, h), 0.0, 1.0);\n         float LdotH = clamp (dot (l, h), 0.0, 1.0);\n         float VdotH = clamp (dot (v, h), 0.0, 1.0);\n\n         PBRInfo pbrInputs = PBRInfo (\n            NdotL,\n            NdotV,\n            NdotH,\n            LdotH,\n            VdotH,\n            perceptualRoughness,\n            metallic,\n            specularEnvironmentR0,\n            specularEnvironmentR90,\n            alphaRoughness,\n            diffuseColor,\n            specularColor\n         );\n\n         // Calculate the shading terms for the microfacet specular shading model.\n         vec3  F = specularReflection (pbrInputs);\n         float G = geometricOcclusion (pbrInputs);\n         float D = microfacetDistribution (pbrInputs);\n\n         float attenuationFactor     = di ? 1.0 : 1.0 / max (dot (c, vec3 (1.0, dL, dL * dL)), 1.0);\n         float spotFactor            = light .type == x3d_SpotLight ? getSpotFactor (light .cutOffAngle, light .beamWidth, L, d) : 1.0;\n         float attenuationSpotFactor = attenuationFactor * spotFactor;\n\n         // Calculation of analytical lighting contribution\n         vec3 diffuseContrib     = (1.0 - F) * diffuse (pbrInputs);\n         vec3 specContrib        = F * G * D / (4.0 * NdotL * NdotV);\n         vec3 diffuseSpecContrib = light .intensity * (diffuseContrib + specContrib);\n\n         #if defined (X3D_SHADOWS)\n            if (NdotL > 0.001)\n               diffuseSpecContrib = mix (diffuseSpecContrib, light .shadowColor, getShadowIntensity (i, light));\n         #endif\n\n         vec3 color = NdotL * attenuationSpotFactor * light .color * diffuseSpecContrib;\n\n         finalColor += color;\n      }\n   }\n   #endif\n\n   // Calculate lighting contribution from image based lighting source (IBL).\n   #if defined (USE_IBL)\n   vec3 reflection = -normalize (reflect (v, n));\n   finalColor += getIBLContribution (pbrInputs, n, reflection);\n   #endif\n\n   // Apply optional PBR terms for additional (optional) shading.\n   #if defined (X3D_OCCLUSION_TEXTURE)\n   finalColor = mix (finalColor, finalColor * getOcclusionFactor (), x3d_Material .occlusionStrength);\n   #endif\n\n   finalColor += getEmissiveColor ();\n\n   // Combine with alpha and do gamma correction.\n   return Gamma (vec4 (finalColor, alpha));\n}\n\nvoid\nmain ()\n{\n   fragment_main ();\n}\n',Phong:'#version 300 es\n\nprecision highp float;\nprecision highp int;\nprecision highp sampler2D;\nprecision highp sampler3D;\nprecision highp samplerCube;\n\n#pragma X3D include "include/Fragment.glsl"\n#pragma X3D include "include/Material.glsl"\n#pragma X3D include "include/Normal.glsl"\n\n#if defined (X3D_AMBIENT_TEXTURE)\nuniform x3d_AmbientTextureParameters x3d_AmbientTexture;\n#endif\n\nvec3\ngetAmbientColor (const in vec3 diffuseColor)\n{\n   // Get ambient parameter.\n\n   vec3 ambientParameter = x3d_Material .ambientIntensity * diffuseColor;\n\n   // Get texture color.\n\n   #if defined (X3D_AMBIENT_TEXTURE)\n      vec3 texCoord = getTexCoord (x3d_AmbientTexture .textureTransformMapping, x3d_AmbientTexture .textureCoordinateMapping);\n\n      #if defined (X3D_AMBIENT_TEXTURE_2D)\n         return ambientParameter * texture (x3d_AmbientTexture .texture2D, texCoord .st) .rgb;\n      #elif defined (X3D_AMBIENT_TEXTURE_3D)\n         return ambientParameter * texture (x3d_AmbientTexture .texture3D, texCoord) .rgb;\n      #elif defined (X3D_AMBIENT_TEXTURE_CUBE)\n         return ambientParameter * texture (x3d_AmbientTexture .textureCube, texCoord) .rgb;\n      #endif\n   #else\n      return ambientParameter;\n   #endif\n}\n\n#if defined (X3D_DIFFUSE_TEXTURE)\nuniform x3d_DiffuseTextureParameters x3d_DiffuseTexture;\n#endif\n\nvec4\ngetDiffuseColor ()\n{\n   // Get diffuse parameter.\n\n   float alpha = 1.0 - x3d_Material .transparency;\n\n   #if defined (X3D_COLOR_MATERIAL)\n      vec4 diffuseParameter = vec4 (color .rgb, color .a * alpha);\n   #else\n      vec4 diffuseParameter = vec4 (x3d_Material .diffuseColor, alpha);\n   #endif\n\n   // Get texture color.\n\n   #if defined (X3D_DIFFUSE_TEXTURE)\n      vec3 texCoord = getTexCoord (x3d_DiffuseTexture .textureTransformMapping, x3d_DiffuseTexture .textureCoordinateMapping);\n\n      #if defined (X3D_DIFFUSE_TEXTURE_2D)\n         return diffuseParameter * texture (x3d_DiffuseTexture .texture2D, texCoord .st);\n      #elif defined (X3D_DIFFUSE_TEXTURE_3D)\n         return diffuseParameter * texture (x3d_DiffuseTexture .texture3D, texCoord);\n      #elif defined (X3D_DIFFUSE_TEXTURE_CUBE)\n         return diffuseParameter * texture (x3d_DiffuseTexture .textureCube, texCoord);\n      #endif\n   #elif defined (X3D_TEXTURE)\n      return getTextureColor (diffuseParameter, vec4 (x3d_Material .specularColor, alpha));\n   #else\n      return diffuseParameter;\n   #endif\n}\n\n#if defined (X3D_SPECULAR_TEXTURE)\nuniform x3d_SpecularTextureParameters x3d_SpecularTexture;\n#endif\n\nvec3\ngetSpecularColor ()\n{\n   // Get specular parameter.\n\n   vec3 specularParameter = x3d_Material .specularColor;\n\n   // Get texture color.\n\n   #if defined (X3D_SPECULAR_TEXTURE)\n      vec3 texCoord = getTexCoord (x3d_SpecularTexture .textureTransformMapping, x3d_SpecularTexture .textureCoordinateMapping);\n\n      #if defined (X3D_SPECULAR_TEXTURE_2D)\n         return specularParameter * texture (x3d_SpecularTexture .texture2D, texCoord .st) .rgb;\n      #elif defined (X3D_SPECULAR_TEXTURE_3D)\n         return specularParameter * texture (x3d_SpecularTexture .texture3D, texCoord) .rgb;\n      #elif defined (X3D_SPECULAR_TEXTURE_CUBE)\n         return specularParameter * texture (x3d_SpecularTexture .textureCube, texCoord) .rgb;\n      #endif\n   #else\n      return specularParameter;\n   #endif\n}\n\n#if defined (X3D_EMISSIVE_TEXTURE)\nuniform x3d_EmissiveTextureParameters x3d_EmissiveTexture;\n#endif\n\nvec3\ngetEmissiveColor ()\n{\n   // Get emissive parameter.\n\n   vec3 emissiveParameter = x3d_Material .emissiveColor;\n\n   // Get texture color.\n\n   #if defined (X3D_EMISSIVE_TEXTURE)\n      vec3 texCoord = getTexCoord (x3d_EmissiveTexture .textureTransformMapping, x3d_EmissiveTexture .textureCoordinateMapping);\n\n      #if defined (X3D_EMISSIVE_TEXTURE_2D)\n         return emissiveParameter * texture (x3d_EmissiveTexture .texture2D, texCoord .st) .rgb;\n      #elif defined (X3D_EMISSIVE_TEXTURE_3D)\n         return emissiveParameter * texture (x3d_EmissiveTexture .texture3D, texCoord) .rgb;\n      #elif defined (X3D_EMISSIVE_TEXTURE_CUBE)\n         return emissiveParameter * texture (x3d_EmissiveTexture .textureCube, texCoord) .rgb;\n      #endif\n   #else\n      return emissiveParameter;\n   #endif\n}\n\n#if defined (X3D_SHININESS_TEXTURE)\nuniform x3d_ShininessTextureParameters x3d_ShininessTexture;\n#endif\n\nfloat\ngetShininessFactor ()\n{\n   // Get shininess parameter.\n\n   float shininess = x3d_Material .shininess;\n\n   // Get texture color.\n\n   #if defined (X3D_SHININESS_TEXTURE)\n      vec3 texCoord = getTexCoord (x3d_ShininessTexture .textureTransformMapping, x3d_ShininessTexture .textureCoordinateMapping);\n\n      #if defined (X3D_SHININESS_TEXTURE_2D)\n         return shininess * texture (x3d_ShininessTexture .texture2D, texCoord .st) .a;\n      #elif defined (X3D_SHININESS_TEXTURE_3D)\n         return shininess * texture (x3d_ShininessTexture .texture3D, texCoord) .a;\n      #elif defined (X3D_SHININESS_TEXTURE_CUBE)\n         return shininess * texture (x3d_ShininessTexture .textureCube, texCoord) .a;\n      #endif\n   #else\n      return shininess;\n   #endif\n}\n\n#if defined (X3D_OCCLUSION_TEXTURE)\nuniform x3d_OcclusionTextureParameters x3d_OcclusionTexture;\n#endif\n\nfloat\ngetOcclusionFactor ()\n{\n   // Get texture color.\n\n   #if defined (X3D_OCCLUSION_TEXTURE)\n      vec3 texCoord = getTexCoord (x3d_OcclusionTexture .textureTransformMapping, x3d_OcclusionTexture .textureCoordinateMapping);\n\n      #if defined (X3D_OCCLUSION_TEXTURE_2D)\n         return texture (x3d_OcclusionTexture .texture2D, texCoord .st) .r;\n      #elif defined (X3D_OCCLUSION_TEXTURE_3D)\n         return texture (x3d_OcclusionTexture .texture3D, texCoord) .r;\n      #elif defined (X3D_OCCLUSION_TEXTURE_CUBE)\n         return texture (x3d_OcclusionTexture .textureCube, texCoord) .r;\n      #endif\n   #else\n      return 1.0;\n   #endif\n}\n\nvec4\ngetMaterialColor ()\n{\n   // Calculate diffuseColor & alpha\n\n   vec4  diffuseColorAlpha = getDiffuseColor ();\n   float alpha             = diffuseColorAlpha .a;\n   vec3  diffuseColor      = diffuseColorAlpha .rgb;\n   vec3  ambientColor      = getAmbientColor (diffuseColor);\n   vec3  specularColor     = getSpecularColor ();\n   float shininess         = getShininessFactor ();\n   float normalScale       = x3d_Material .normalScale;\n\n   #if defined (X3D_PROJECTIVE_TEXTURE_MAPPING)\n      vec4 P = getProjectiveTextureColor (vec4 (1.0));\n\n      diffuseColor *= P .rgb;\n      alpha        *= P .a;\n   #endif\n\n   #if defined (X3D_LIGHTING)\n      vec3 finalColor = getMaterialColor (vertex, getNormalVector (normalScale), ambientColor, diffuseColor, specularColor, shininess);\n   #else\n      vec3 finalColor = vec3 (0.0);\n   #endif\n\n   #if defined (X3D_OCCLUSION_TEXTURE)\n   finalColor = mix (finalColor, finalColor * getOcclusionFactor (), x3d_Material .occlusionStrength);\n   #endif\n\n   finalColor += getEmissiveColor ();\n\n   return vec4 (finalColor, alpha);\n}\n\nvoid\nmain ()\n{\n   fragment_main ();\n}\n',Unlit:'#version 300 es\n\nprecision highp float;\nprecision highp int;\nprecision highp sampler2D;\nprecision highp sampler3D;\nprecision highp samplerCube;\n\n#pragma X3D include "include/Fragment.glsl"\n\nuniform x3d_UnlitMaterialParameters x3d_Material;\n\n#if defined (X3D_EMISSIVE_TEXTURE)\nuniform x3d_EmissiveTextureParameters x3d_EmissiveTexture;\n#endif\n\nvec4\ngetEmissiveColor ()\n{\n   // Get emissive parameter.\n\n   float alpha = 1.0 - x3d_Material .transparency;\n\n   #if defined (X3D_COLOR_MATERIAL)\n      vec4 emissiveParameter = vec4 (color .rgb, color .a * alpha);\n   #else\n      vec4 emissiveParameter = vec4 (x3d_Material .emissiveColor, alpha);\n   #endif\n\n   // Get texture color.\n\n   #if defined (X3D_EMISSIVE_TEXTURE)\n      vec3 texCoord = getTexCoord (x3d_EmissiveTexture .textureTransformMapping, x3d_EmissiveTexture .textureCoordinateMapping);\n\n      #if defined (X3D_EMISSIVE_TEXTURE_2D)\n         return emissiveParameter * texture (x3d_EmissiveTexture .texture2D, texCoord .st);\n      #elif defined (X3D_EMISSIVE_TEXTURE_3D)\n         return emissiveParameter * texture (x3d_EmissiveTexture .texture3D, texCoord);\n      #elif defined (X3D_EMISSIVE_TEXTURE_CUBE)\n         return emissiveParameter * texture (x3d_EmissiveTexture .textureCube, texCoord);\n      #endif\n   #elif defined (X3D_TEXTURE)\n      return getTextureColor (emissiveParameter, vec4 (vec3 (1.0), alpha));\n   #else\n      return emissiveParameter;\n   #endif\n}\n\nvec4\ngetMaterialColor ()\n{\n   return getEmissiveColor ();\n}\n\nvoid\nmain ()\n{\n   fragment_main ();\n}\n'}}};function Vh(e){os.call(this,e),this.addType(s.X3DShaderNode),this.valid=!1,this.selected=0}Vh.prototype=Object.assign(Object.create(os.prototype),{constructor:Vh,setValid:function(e){this._isValid=this.valid=e},isValid:function(){return this.valid},select:function(){++this.selected,this._isSelected.getValue()||(this._isSelected=!0)},deselect:function(){--this.selected,0===this.selected&&this._isSelected.getValue()&&(this._isSelected=!1)}});const Ph=Vh,Ah=Symbol.for("X3DField.uniformLocation");function Lh(e){this.addType(s.X3DProgrammableShaderObject),this.uniformNames=[],this.x3d_ClipPlane=[],this.x3d_LightType=[],this.x3d_LightOn=[],this.x3d_LightColor=[],this.x3d_LightIntensity=[],this.x3d_LightAmbientIntensity=[],this.x3d_LightAttenuation=[],this.x3d_LightLocation=[],this.x3d_LightDirection=[],this.x3d_LightBeamWidth=[],this.x3d_LightCutOffAngle=[],this.x3d_LightRadius=[],this.x3d_LightMatrix=[],this.x3d_ShadowIntensity=[],this.x3d_ShadowColor=[],this.x3d_ShadowBias=[],this.x3d_ShadowMatrix=[],this.x3d_ShadowMapSize=[],this.x3d_ShadowMap=[],this.x3d_Texture=[],this.x3d_MultiTextureMode=[],this.x3d_MultiTextureAlphaMode=[],this.x3d_MultiTextureSource=[],this.x3d_MultiTextureFunction=[],this.x3d_TextureCoordinateGeneratorMode=[],this.x3d_TextureCoordinateGeneratorParameter=[],this.x3d_ProjectiveTexture=[],this.x3d_ProjectiveTextureMatrix=[],this.x3d_ProjectiveTextureLocation=[],this.x3d_TexCoord=[],this.x3d_TextureMatrix=[],this.numClipPlanes=0,this.fogNode=null,this.numLights=0,this.numGlobalLights=0,this.lightNodes=[],this.numProjectiveTextures=0,this.numGlobalProjectiveTextures=0,this.projectiveTextureNodes=[],this.textures=new Set}function Uh(e){return e[0].toLowerCase()+e.slice(1)}Lh.prototype={constructor:Lh,initialize:function(){const e=this.getBrowser();e.getRenderingProperties()._LogarithmicDepthBuffer.addInterest("set_logarithmicDepthBuffer__",this),this.x3d_MaxTextures=e.getMaxTextures(),this.set_logarithmicDepthBuffer__()},set_logarithmicDepthBuffer__:function(){this.logarithmicDepthBuffer=this.getBrowser().getRenderingProperty("LogarithmicDepthBuffer")},canUserDefinedFields:function(){return!0},getUniformNames:function(){return this.uniformNames},setUniformNames:function(e){this.uniformNames=e},getDefaultUniformsAndAttributes:function(){const e=this.getProgram(),t=this.getBrowser(),n=t.getContext(),i=t.getMaxClipPlanes(),o=t.getMaxLights(),r=t.getMaxTextures();n.useProgram(e);for(const t of this.uniformNames)this[t]=n.getUniformLocation(e,t);this.x3d_LogarithmicFarFactor1_2=n.getUniformLocation(e,"x3d_LogarithmicFarFactor1_2");for(let t=0;t<i;++t)this.x3d_ClipPlane[t]=n.getUniformLocation(e,"x3d_ClipPlane["+t+"]");this.x3d_FogColor=this.getUniformLocation(n,e,"x3d_Fog.color","x3d_FogColor"),this.x3d_FogVisibilityRange=this.getUniformLocation(n,e,"x3d_Fog.visibilityRange","x3d_FogVisibilityRange"),this.x3d_FogMatrix=this.getUniformLocation(n,e,"x3d_Fog.matrix","x3d_FogMatrix"),this.x3d_AlphaCutoff=n.getUniformLocation(e,"x3d_AlphaCutoff"),this.x3d_PointPropertiesPointSizeScaleFactor=n.getUniformLocation(e,"x3d_PointProperties.pointSizeScaleFactor"),this.x3d_PointPropertiesPointSizeMinValue=n.getUniformLocation(e,"x3d_PointProperties.pointSizeMinValue"),this.x3d_PointPropertiesPointSizeMaxValue=n.getUniformLocation(e,"x3d_PointProperties.pointSizeMaxValue"),this.x3d_PointPropertiesPointSizeAttenuation=n.getUniformLocation(e,"x3d_PointProperties.pointSizeAttenuation"),this.x3d_LinePropertiesApplied=n.getUniformLocation(e,"x3d_LineProperties.applied"),this.x3d_LinePropertiesLinetype=n.getUniformLocation(e,"x3d_LineProperties.linetype"),this.x3d_LineStippleScale=n.getUniformLocation(e,"x3d_LineProperties.lineStippleScale"),this.x3d_LinePropertiesTexture=n.getUniformLocation(e,"x3d_LineProperties.texture"),this.x3d_FillPropertiesFilled=n.getUniformLocation(e,"x3d_FillProperties.filled"),this.x3d_FillPropertiesHatched=n.getUniformLocation(e,"x3d_FillProperties.hatched"),this.x3d_FillPropertiesHatchColor=n.getUniformLocation(e,"x3d_FillProperties.hatchColor"),this.x3d_FillPropertiesTexture=n.getUniformLocation(e,"x3d_FillProperties.texture");for(let t=0;t<o;++t)this.x3d_LightType[t]=this.getUniformLocation(n,e,"x3d_LightSource["+t+"].type","x3d_LightType["+t+"]"),this.x3d_LightColor[t]=this.getUniformLocation(n,e,"x3d_LightSource["+t+"].color","x3d_LightColor["+t+"]"),this.x3d_LightAmbientIntensity[t]=this.getUniformLocation(n,e,"x3d_LightSource["+t+"].ambientIntensity","x3d_LightAmbientIntensity["+t+"]"),this.x3d_LightIntensity[t]=this.getUniformLocation(n,e,"x3d_LightSource["+t+"].intensity","x3d_LightIntensity["+t+"]"),this.x3d_LightAttenuation[t]=this.getUniformLocation(n,e,"x3d_LightSource["+t+"].attenuation","x3d_LightAttenuation["+t+"]"),this.x3d_LightLocation[t]=this.getUniformLocation(n,e,"x3d_LightSource["+t+"].location","x3d_LightLocation["+t+"]"),this.x3d_LightDirection[t]=this.getUniformLocation(n,e,"x3d_LightSource["+t+"].direction","x3d_LightDirection["+t+"]"),this.x3d_LightBeamWidth[t]=this.getUniformLocation(n,e,"x3d_LightSource["+t+"].beamWidth","x3d_LightBeamWidth["+t+"]"),this.x3d_LightCutOffAngle[t]=this.getUniformLocation(n,e,"x3d_LightSource["+t+"].cutOffAngle","x3d_LightCutOffAngle["+t+"]"),this.x3d_LightRadius[t]=this.getUniformLocation(n,e,"x3d_LightSource["+t+"].radius","x3d_LightRadius["+t+"]"),this.x3d_LightMatrix[t]=this.getUniformLocation(n,e,"x3d_LightSource["+t+"].matrix","x3d_LightMatrix["+t+"]"),this.x3d_ShadowIntensity[t]=n.getUniformLocation(e,"x3d_LightSource["+t+"].shadowIntensity"),this.x3d_ShadowColor[t]=n.getUniformLocation(e,"x3d_LightSource["+t+"].shadowColor"),this.x3d_ShadowBias[t]=n.getUniformLocation(e,"x3d_LightSource["+t+"].shadowBias"),this.x3d_ShadowMatrix[t]=n.getUniformLocation(e,"x3d_LightSource["+t+"].shadowMatrix"),this.x3d_ShadowMapSize[t]=n.getUniformLocation(e,"x3d_LightSource["+t+"].shadowMapSize"),this.x3d_ShadowMap[t]=n.getUniformLocation(e,"x3d_ShadowMap["+t+"]");this.x3d_AmbientIntensity=this.getUniformLocation(n,e,"x3d_Material.ambientIntensity","x3d_FrontMaterial.ambientIntensity"),this.x3d_DiffuseColor=this.getUniformLocation(n,e,"x3d_Material.diffuseColor","x3d_FrontMaterial.diffuseColor"),this.x3d_SpecularColor=this.getUniformLocation(n,e,"x3d_Material.specularColor","x3d_FrontMaterial.specularColor"),this.x3d_EmissiveColor=this.getUniformLocation(n,e,"x3d_Material.emissiveColor","x3d_FrontMaterial.emissiveColor"),this.x3d_Shininess=this.getUniformLocation(n,e,"x3d_Material.shininess","x3d_FrontMaterial.shininess"),this.x3d_BaseColor=n.getUniformLocation(e,"x3d_Material.baseColor"),this.x3d_Metallic=n.getUniformLocation(e,"x3d_Material.metallic"),this.x3d_Roughness=n.getUniformLocation(e,"x3d_Material.roughness"),this.x3d_OcclusionStrength=n.getUniformLocation(e,"x3d_Material.occlusionStrength"),this.x3d_NormalScale=n.getUniformLocation(e,"x3d_Material.normalScale"),this.x3d_Transparency=this.getUniformLocation(n,e,"x3d_Material.transparency","x3d_FrontMaterial.transparency");const s=["x3d_AmbientTexture","x3d_DiffuseTexture","x3d_SpecularTexture","x3d_EmissiveTexture","x3d_ShininessTexture","x3d_BaseTexture","x3d_MetallicRoughnessTexture","x3d_OcclusionTexture","x3d_NormalTexture"];for(const t of s)this[t]={textureTransformMapping:n.getUniformLocation(e,t+".textureTransformMapping"),textureCoordinateMapping:n.getUniformLocation(e,t+".textureCoordinateMapping"),texture2D:n.getUniformLocation(e,t+".texture2D"),texture3D:n.getUniformLocation(e,t+".texture3D"),textureCube:n.getUniformLocation(e,t+".textureCube")};this.x3d_MultiTextureColor=n.getUniformLocation(e,"x3d_MultiTextureColor"),this.x3d_TexCoord.length=0;for(let t=0;t<r;++t){const i=this.getAttribLocation(n,e,"x3d_TexCoord"+t,t?"":"x3d_TexCoord");-1!==i&&this.x3d_TexCoord.push([t,i]),this.x3d_TextureMatrix[t]=n.getUniformLocation(e,"x3d_TextureMatrix["+t+"]"),this.x3d_TextureCoordinateGeneratorMode[t]=n.getUniformLocation(e,"x3d_TextureCoordinateGenerator["+t+"].mode"),this.x3d_TextureCoordinateGeneratorParameter[t]=n.getUniformLocation(e,"x3d_TextureCoordinateGenerator["+t+"].parameter"),this.x3d_Texture[t]={texture2D:n.getUniformLocation(e,"x3d_Texture2D["+t+"]"),texture3D:n.getUniformLocation(e,"x3d_Texture3D["+t+"]"),textureCube:this.getUniformLocation(n,e,"x3d_TextureCube["+t+"]","x3d_CubeMapTexture["+t+"]")},this.x3d_MultiTextureMode[t]=n.getUniformLocation(e,"x3d_MultiTexture["+t+"].mode"),this.x3d_MultiTextureAlphaMode[t]=n.getUniformLocation(e,"x3d_MultiTexture["+t+"].alphaMode"),this.x3d_MultiTextureSource[t]=n.getUniformLocation(e,"x3d_MultiTexture["+t+"].source"),this.x3d_MultiTextureFunction[t]=n.getUniformLocation(e,"x3d_MultiTexture["+t+"].function"),this.x3d_ProjectiveTexture[t]=n.getUniformLocation(e,"x3d_ProjectiveTexture["+t+"]"),this.x3d_ProjectiveTextureMatrix[t]=n.getUniformLocation(e,"x3d_ProjectiveTextureMatrix["+t+"]"),this.x3d_ProjectiveTextureLocation[t]=n.getUniformLocation(e,"x3d_ProjectiveTextureLocation["+t+"]")}this.x3d_TexCoordRamp=n.getUniformLocation(e,"x3d_TexCoordRamp"),this.x3d_Viewport=n.getUniformLocation(e,"x3d_Viewport"),this.x3d_ProjectionMatrix=n.getUniformLocation(e,"x3d_ProjectionMatrix"),this.x3d_ModelViewMatrix=n.getUniformLocation(e,"x3d_ModelViewMatrix"),this.x3d_NormalMatrix=n.getUniformLocation(e,"x3d_NormalMatrix"),this.x3d_CameraSpaceMatrix=n.getUniformLocation(e,"x3d_CameraSpaceMatrix");const a=["LineStipple","FogDepth","Color","Normal","Vertex","Particle","ParticleMatrix"];for(const t of a){const i=n.getAttribLocation(e,`x3d_${t}`);this[`x3d_${t}`]=i,i<0?(this[`enable${t}Attribute`]=Function.prototype,this[`${Uh(t)}AttributeDivisor`]=Function.prototype):(delete this[`enable${t}Attribute`],delete this[`${Uh(t)}AttributeDivisor`])}0===this.x3d_TexCoord.length?(this.enableTexCoordAttribute=Function.prototype,this.texCoordAttributeDivisor=Function.prototype):(delete this.enableTexCoordAttribute,delete this.texCoordAttributeDivisor),n.uniform1f(this.x3d_LineStippleScale,t.getLineStippleScale()),n.uniform1i(this.x3d_LinePropertiesTexture,t.getDefaultTexture2DUnit()),n.uniform1i(this.x3d_FillPropertiesTexture,t.getDefaultTexture2DUnit());for(const e of s)n.uniform1i(this[e].texture2D,t.getDefaultTexture2DUnit()),n.uniform1i(this[e].texture3D,t.getDefaultTexture3DUnit()),n.uniform1i(this[e].textureCube,t.getDefaultTextureCubeUnit());for(const e of this.x3d_Texture)n.uniform1i(e.texture2D,t.getDefaultTexture2DUnit()),n.getVersion()>=2&&n.uniform1i(e.texture3D,t.getDefaultTexture3DUnit()),n.uniform1i(e.textureCube,t.getDefaultTextureCubeUnit());for(const e of this.x3d_ShadowMap)n.uniform1i(e,t.getDefaultTexture2DUnit());for(const e of this.x3d_ProjectiveTexture)n.uniform1i(e,t.getDefaultTexture2DUnit());n.uniform1i(this.x3d_TexCoordRamp,t.getDefaultTexture2DUnit())},getUniformLocation:function(e,t,n,i){let o=e.getUniformLocation(t,n);return o||(i?(o=e.getUniformLocation(t,i),o&&console.warn(this.getTypeName(),this.getName(),"Using uniform location name '"+i+"' is depreciated, use '"+n+"'. See https://create3000.github.io/x_ite/Custom-Shaders.html."),o):0)},getAttribLocation:function(e,t,n,i){let o=e.getAttribLocation(t,n);return o>=0?o:i?(o=e.getAttribLocation(t,i),o>=0&&console.warn(this.getTypeName(),this.getName(),"Using attribute location name '"+i+"' is depreciated, use '"+n+"'. See https://create3000.github.io/x_ite/Custom-Shaders.html."),o):-1},addShaderFields:function(){const e=this.getProgram(),t=this.getBrowser().getContext();t.useProgram(e),this.textures.clear();for(const n of this.getUserDefinedFields()){const i=t.getUniformLocation(e,n.getName());if(i){switch(n.getType()){case s.SFImage:i.array=new Int32Array(3+n.array.length);break;case s.SFMatrix3d:case s.SFMatrix3f:case s.SFRotation:i.array=new Float32Array(9);break;case s.SFMatrix4d:case s.SFMatrix4f:i.array=new Float32Array(16);break;case s.SFNode:break;case s.MFBool:case s.MFInt32:i.array=new Int32Array(this.getLocationLength(t,e,n));break;case s.MFFloat:case s.MFDouble:case s.MFTime:i.array=new Float32Array(this.getLocationLength(t,e,n));break;case s.MFImage:i.array=new Int32Array(this.getImagesLength(n));break;case s.MFMatrix3d:case s.MFMatrix3f:case s.MFRotation:i.array=new Float32Array(9*this.getLocationLength(t,e,n));break;case s.MFMatrix4d:case s.MFMatrix4f:i.array=new Float32Array(16*this.getLocationLength(t,e,n));break;case s.MFNode:{const o=i.locations=[];for(let i=0;;++i){const r=t.getUniformLocation(e,n.getName()+"["+i+"]");if(!r)break;o.push(r)}break}case s.MFVec2d:case s.MFVec2f:i.array=new Float32Array(2*this.getLocationLength(t,e,n));break;case s.MFVec3d:case s.MFVec3f:case s.MFColor:i.array=new Float32Array(3*this.getLocationLength(t,e,n));break;case s.MFVec4d:case s.MFVec4f:case s.MFColorRGBA:i.array=new Float32Array(4*this.getLocationLength(t,e,n))}i.array?n[Ah]=i.array.length?i:null:n[Ah]=i,n.addInterest("set_field__",this),this.set_field__(n)}}},removeShaderFields:function(){for(const e of this.getUserDefinedFields())e.removeInterest("set_field__",this)},set_field__:function(){const e=new Float32Array(9);return function(t){const n=this.getProgram(),i=this.getBrowser().getContext(),o=t[Ah];if(i.useProgram(n),o)switch(t.getType()){case s.SFBool:case s.SFInt32:return void i.uniform1i(o,t.getValue());case s.SFColor:{const e=t.getValue();return void i.uniform3f(o,e.r,e.g,e.b)}case s.SFColorRGBA:{const e=t.getValue();return void i.uniform4f(o,e.r,e.g,e.b,e.a)}case s.SFDouble:case s.SFFloat:case s.SFTime:return void i.uniform1f(o,t.getValue());case s.SFImage:{let e=o.array;const n=t.array,r=3+n.length;r!==e.length&&(e=o.array=new Int32Array(r)),e[0]=t.width,e[1]=t.height,e[2]=t.comp;for(let t=3,i=0,o=n.length;i<o;++i,++t)e[t]=n[i];return void i.uniform1iv(o,e)}case s.SFMatrix3d:case s.SFMatrix3f:return o.array.set(t.getValue()),void i.uniformMatrix3fv(o,!1,o.array);case s.SFMatrix4d:case s.SFMatrix4f:return o.array.set(t.getValue()),void i.uniformMatrix4fv(o,!1,o.array);case s.SFNode:{const e=xr(s.X3DTextureNode,t);return void(e?(o.name=t.getName(),o.texture=e,this.textures.add(o)):this.textures.delete(o))}case s.SFRotation:return t.getValue().getMatrix(o.array),void i.uniformMatrix3fv(o,!1,o.array);case s.SFString:return;case s.SFVec2d:case s.SFVec2f:{const e=t.getValue();return void i.uniform2f(o,e.x,e.y)}case s.SFVec3d:case s.SFVec3f:{const e=t.getValue();return void i.uniform3f(o,e.x,e.y,e.z)}case s.SFVec4d:case s.SFVec4f:{const e=t.getValue();return void i.uniform4f(o,e.x,e.y,e.z,e.w)}case s.MFBool:case s.MFInt32:{const e=o.array;for(var r=0,a=t.length;r<a;++r)e[r]=t[r];for(let t=e.length;r<t;++r)e[r]=0;return void i.uniform1iv(o,e)}case s.MFColor:{const e=o.array;r=0;var u=0;for(a=t.length;r<a;++r){const n=t[r];e[u++]=n.r,e[u++]=n.g,e[u++]=n.b}for(let t=e.length;u<t;++u)e[u]=0;return void i.uniform3fv(o,e)}case s.MFColorRGBA:{const e=o.array;for(r=0,u=0,a=t.length;r<a;++r){const n=t[r];e[u++]=n.r,e[u++]=n.g,e[u++]=n.b,e[u++]=n.a}for(let t=e.length;u<t;++u)e[u]=0;return void i.uniform4fv(o,e)}case s.MFDouble:case s.MFFloat:case s.MFTime:{const e=o.array;for(r=0,a=t.length;r<a;++r)e[r]=t[r];for(let t=e.length;r<t;++r)e[r]=0;return void i.uniform1fv(o,e)}case s.MFImage:{const e=o.array;for(let n=0,i=0,o=t.length;n<o;++n){const o=t[n],r=o.array;e[i++]=o.width,e[i++]=o.height,e[i++]=o.comp;for(let t=0,n=r.length;t<n;++t)e[i++]=r[t]}return void i.uniform1iv(o,e)}case s.MFMatrix3d:case s.MFMatrix3f:{const e=o.array;for(r=0,u=0,a=t.length;r<a;++r){const n=t[r];for(let t=0;t<9;++t)e[u++]=n[t]}for(let t=e.length;u<t;++u)e[u]=0;return void i.uniformMatrix3fv(o,!1,e)}case s.MFMatrix4d:case s.MFMatrix4f:{const e=o.array;for(r=0,u=0,a=t.length;r<a;++r){const n=t[r];for(let t=0;t<16;++t)e[u++]=n[t]}for(let t=e.length;u<t;++u)e[u]=0;return void i.uniformMatrix4fv(o,!1,e)}case s.MFNode:{const e=o.locations;for(let n=0,i=t.length;n<i;++n){const i=xr(s.X3DTextureNode,t[n]);i?(e[n].name=t.getName(),e[n].texture=i,this.textures.add(e[n])):this.textures.delete(e[n])}return}case s.MFRotation:{const n=o.array;for(r=0,u=0,a=t.length;r<a;++r)t[r].getValue().getMatrix(e),n[u++]=e[0],n[u++]=e[1],n[u++]=e[2],n[u++]=e[3],n[u++]=e[4],n[u++]=e[5],n[u++]=e[6],n[u++]=e[7],n[u++]=e[8];for(let e=n.length;u<e;++u)n[u]=0;return void i.uniformMatrix3fv(o,!1,n)}case s.MFString:return;case s.MFVec2d:case s.MFVec2f:{const e=o.array;for(r=0,u=0,a=t.length;r<a;++r){const n=t[r];e[u++]=n.x,e[u++]=n.y}for(let t=e.length;u<t;++u)e[u]=0;return void i.uniform2fv(o,e)}case s.MFVec3d:case s.MFVec3f:{const e=o.array;for(r=0,u=0,a=t.length;r<a;++r){const n=t[r];e[u++]=n.x,e[u++]=n.y,e[u++]=n.z}for(let t=e.length;u<t;++u)e[u]=0;return void i.uniform3fv(o,e)}case s.MFVec4d:case s.MFVec4f:{const e=o.array;for(r=0,u=0,a=t.length;r<a;++r){const n=t[r];e[u++]=n.x,e[u++]=n.y,e[u++]=n.z,e[u++]=n.w}for(let t=e.length;u<t;++u)e[u]=0;return void i.uniform4fv(o,e)}}}}(),getImagesLength:function(e){const t=e.getValue();let n=3*t.length;for(const e of t)n+=e.array.length;return n},getLocationLength:function(e,t,n){const i=n.getName();for(let n=0;;++n){if(!e.getUniformLocation(t,i+"["+n+"]"))return n}},hasFog:function(e){return this.fogNode===e||(this.fogNode=e,!1)},hasLight:function(e,t){return this.lightNodes[e]===t||(this.lightNodes[e]=t,!1)},hasTextureProjector:function(e,t){return this.projectiveTextureNodes[e]===t||(this.projectiveTextureNodes[e]=t,!1)},setClipPlanes:function(e,t){this.numClipPlanes=0;for(const n of t)n.setShaderUniforms(e,this)},setUniforms:function(){const e=new Float32Array(9);return function(t,n,i,o=!0){const r=i.renderObject,s=i.fogNode,a=i.appearanceNode,u=a.getStyleProperties(n.geometryType),l=o?a.getMaterial():a.getBackMaterial(),c=i.textureNode||a.getTexture(),h=i.modelViewMatrix;if(this.renderTime!==r.getRenderTime()){this.renderTime=r.getRenderTime(),t.uniform4iv(this.x3d_Viewport,r.getViewportArray()),t.uniformMatrix4fv(this.x3d_ProjectionMatrix,!1,r.getProjectionMatrixArray()),t.uniformMatrix4fv(this.x3d_CameraSpaceMatrix,!1,r.getCameraSpaceMatrixArray()),this.fogNode=null,this.numLights=0,this.numProjectiveTextures=0,this.lightNodes.length=0,this.projectiveTextureNodes.length=0;const e=r.getGlobalObjects();for(const n of e)n.setShaderUniforms(t,this,r);this.numGlobalLights=this.numLights,this.numGlobalProjectiveTextures=this.numProjectiveTextures;const n=r.getViewpoint();if(this.logarithmicDepthBuffer||n.getLogarithmicDepthBuffer()){const e=r.getNavigationInfo();t.uniform1f(this.x3d_LogarithmicFarFactor1_2,1/Math.log2(e.getFarValue(n)+1))}}t.uniformMatrix4fv(this.x3d_ModelViewMatrix,!1,h),e[0]=h[0],e[3]=h[1],e[6]=h[2],e[1]=h[4],e[4]=h[5],e[7]=h[6],e[2]=h[8],e[5]=h[9],e[8]=h[10],et.prototype.inverse.call(e),t.uniformMatrix3fv(this.x3d_NormalMatrix,!1,e),s&&s.setShaderUniforms(t,this),this.numClipPlanes=0,this.numLights=this.numGlobalLights,this.numProjectiveTextures=this.numGlobalProjectiveTextures;for(const e of i.localObjects)e.setShaderUniforms(t,this,r);t.uniform1f(this.x3d_AlphaCutoff,a.getAlphaCutoff()),u&&u.setShaderUniforms(t,this),l.setShaderUniforms(t,this,r,a.getTextureTransformMapping(),n.getTextureCoordinateMapping(),o),c&&c.setShaderUniforms(t,this,r),a.getTextureTransform().setShaderUniforms(t,this),n.getTextureCoordinate().setShaderUniforms(t,this)}}(),enable:function(e){e.useProgram(this.getProgram());for(const t of this.textures){const n=t.texture,i=this.getBrowser().getTextureUnit(n.getTextureType());if(void 0===i)return void console.warn("Not enough combined texture units for uniform variable '"+t.name+"' available.");e.activeTexture(e.TEXTURE0+i),e.bindTexture(n.getTarget(),n.getTexture()),e.uniform1i(t,i)}},enableFloatAttrib:function(e,t,n,i,o,r){const s=e.getAttribLocation(this.getProgram(),t);-1!==s&&(e.bindBuffer(e.ARRAY_BUFFER,n),e.enableVertexAttribArray(s),e.vertexAttribPointer(s,i,e.FLOAT,!1,o,r))},enableMatrix3Attrib:function(e,t,n,i,o){const r=e.getAttribLocation(this.getProgram(),t);if(-1!==r){i=i||36,e.bindBuffer(e.ARRAY_BUFFER,n);for(let t=0;t<3;++t){const n=r+t;e.enableVertexAttribArray(n),e.vertexAttribPointer(n,3,e.FLOAT,!1,i,o+12*t)}}},enableMatrix4Attrib:function(e,t,n,i,o){const r=e.getAttribLocation(this.getProgram(),t);if(-1!==r){i=i||64,e.bindBuffer(e.ARRAY_BUFFER,n);for(let t=0;t<4;++t){const n=r+t;e.enableVertexAttribArray(n),e.vertexAttribPointer(n,4,e.FLOAT,!1,i,o+16*t)}}},enableLineStippleAttribute:function(e,t,n,i){const o=this.x3d_LineStipple;e.bindBuffer(e.ARRAY_BUFFER,t),e.enableVertexAttribArray(o),e.vertexAttribPointer(o,3,e.FLOAT,!1,n,i)},enableFogDepthAttribute:function(e,t,n,i){const o=this.x3d_FogDepth;e.bindBuffer(e.ARRAY_BUFFER,t),e.enableVertexAttribArray(o),e.vertexAttribPointer(o,1,e.FLOAT,!1,n,i)},enableColorAttribute:function(e,t,n,i){const o=this.x3d_Color;e.bindBuffer(e.ARRAY_BUFFER,t),e.enableVertexAttribArray(o),e.vertexAttribPointer(o,4,e.FLOAT,!1,n,i)},colorAttributeDivisor:function(e,t){e.vertexAttribDivisor(this.x3d_Color,t)},enableTexCoordAttribute:function(e,t,n,i){for(const[o,r]of this.x3d_TexCoord)e.bindBuffer(e.ARRAY_BUFFER,t[o]),e.enableVertexAttribArray(r),e.vertexAttribPointer(r,4,e.FLOAT,!1,n,i)},texCoordAttributeDivisor:function(e,t){for(const[n,i]of this.x3d_TexCoord)e.vertexAttribDivisor(i,t)},enableNormalAttribute:function(e,t,n,i){const o=this.x3d_Normal;e.bindBuffer(e.ARRAY_BUFFER,t),e.enableVertexAttribArray(o),e.vertexAttribPointer(o,3,e.FLOAT,!1,n,i)},normalAttributeDivisor:function(e,t){e.vertexAttribDivisor(this.x3d_Normal,t)},enableVertexAttribute:function(e,t,n,i){const o=this.x3d_Vertex;e.bindBuffer(e.ARRAY_BUFFER,t),e.enableVertexAttribArray(o),e.vertexAttribPointer(o,4,e.FLOAT,!1,n,i)},vertexAttributeDivisor:function(e,t){e.vertexAttribDivisor(this.x3d_Vertex,t)},enableParticleAttribute:function(e,t,n,i,o){const r=this.x3d_Particle;e.bindBuffer(e.ARRAY_BUFFER,t),e.enableVertexAttribArray(r),e.vertexAttribPointer(r,4,e.FLOAT,!1,n,i),e.vertexAttribDivisor(r,o)},enableParticleMatrixAttribute:function(e,t,n,i,o){const r=this.x3d_ParticleMatrix;n=n||64,e.bindBuffer(e.ARRAY_BUFFER,t);for(let t=0;t<4;++t){const s=r+t;e.enableVertexAttribArray(s),e.vertexAttribPointer(s,4,e.FLOAT,!1,n,i+16*t),e.vertexAttribDivisor(s,o)}},getProgramInfo:function(){function e(e,t){return e<t?-1:e>t?1:0}const t=this.getProgram(),n=this.getBrowser().getContext(),i={attributes:[],uniforms:[],attributeCount:0,uniformCount:0},o=n.getProgramParameter(t,n.ACTIVE_UNIFORMS),r=n.getProgramParameter(t,n.ACTIVE_ATTRIBUTES),s={35664:"vec2",35665:"vec3",35666:"vec4",35667:"ivec2",35668:"ivec3",35669:"ivec4",35670:"bool",35671:"bvec2",35672:"bvec3",35673:"bvec4",35674:"mat2",35675:"mat3",35676:"mat4",35678:"sampler2D",35680:"samplerCube",5120:"byte",5121:"ubyte",5122:"short",5123:"ushort",5124:"int",5125:"uint",5126:"float"};for(let e=0;e<o;++e){const o=n.getActiveUniform(t,e);o.typeName=s[o.type],i.uniforms.push(Object.assign({},o)),i.uniformCount+=o.size}for(let e=0;e<r;++e){const o=n.getActiveAttrib(t,e);o.typeName=s[o.type],i.attributes.push(Object.assign({},o)),i.attributeCount+=o.size}return i.uniforms.sort((function(t,n){return e(t.name,n.name)})),i.attributes.sort((function(t,n){return e(t.name,n.name)})),i},printProgramInfo:function(){const e=this.getProgramInfo();console.log(this.getName()),console.table(e.attributes),console.log(this.getName(),"attributeCount",e.attributeCount),console.log(this.getName()),console.table(e.uniforms),console.log(this.getName(),"uniformCount",e.uniformCount)},dispose:function(){}};const Bh=Lh;function Xh(e){vs.call(this,e),this.addType(s.X3DNetworkSensorNode)}Xh.prototype=Object.assign(Object.create(vs.prototype),{constructor:Xh});const kh=Xh;function zh(e){kh.call(this,e),this.addType(s.LoadSensor),this.urlObjects=[],this.aborted=!1,this.timeOutId=void 0}zh.prototype=Object.assign(Object.create(kh.prototype),{constructor:zh,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new P([new N(s.inputOutput,"metadata",new Bn.SFNode),new N(s.inputOutput,"enabled",new Bn.SFBool(!0)),new N(s.inputOutput,"timeOut",new Bn.SFTime),new N(s.outputOnly,"isActive",new Bn.SFBool),new N(s.outputOnly,"isLoaded",new Bn.SFBool),new N(s.outputOnly,"progress",new Bn.SFFloat),new N(s.outputOnly,"loadTime",new Bn.SFTime),new N(s.inputOutput,"watchList",new Bn.MFNode)]),getTypeName:function(){return"LoadSensor"},getComponentName:function(){return"Networking"},getContainerField:function(){return"children"},initialize:function(){kh.prototype.initialize.call(this),this._enabled.addInterest("set_enabled__",this),this._timeOut.addInterest("set_timeOut__",this),this._watchList.addInterest("set_watchList__",this),this.set_watchList__()},set_enabled__:function(){this._enabled.getValue()?this.reset():(this.abort(),this.remove())},set_timeOut__:function(){this._isActive.getValue()&&(this.clearTimeout(),this.aborted=!1,this._timeOut.getValue()>0&&(this.timeOutId=setTimeout(this.abort.bind(this),1e3*this._timeOut.getValue())))},set_watchList__:function(){this.reset()},set_loadState__:function(e){switch(e.checkLoadState()){case s.NOT_STARTED_STATE:break;case s.IN_PROGRESS_STATE:case s.COMPLETE_STATE:case s.FAILED_STATE:this.count()}},count:function(){const e=this.urlObjects;let t=0,n=0;for(const i of e)t+=i.checkLoadState()==s.COMPLETE_STATE,n+=i.checkLoadState()==s.FAILED_STATE;const i=t==e.length,o=t/e.length;this.aborted||n||i?(this.clearTimeout(),this._isActive=!1,this._isLoaded=i,this._progress=o,i&&(this._loadTime=this.getBrowser().getCurrentTime())):this._isActive.getValue()?this._progress=o:(this._isActive=!0,this._progress=o,this.set_timeOut__())},abort:function(){this.clearTimeout(),this.aborted=!0,this._enabled.getValue()&&this.count()},reset:function(){if(this.remove(),this._enabled.getValue()){const e=this.urlObjects;for(const t of this._watchList){const n=xr(s.X3DUrlObject,t);n&&(e.push(n),n._loadState.addInterest("set_loadState__",this,n))}this.count()}},remove:function(){this.clearTimeout();const e=this.urlObjects;for(const t of e)t._loadState.removeInterest("set_loadState__",this);e.length=0},clearTimeout:function(){clearTimeout(this.timeOutId),this.timeOutId=void 0}});const jh=zh;function Gh(e){Ph.call(this,e),Bh.call(this,e),this.addType(s.ComposedShader),this.loadSensor=new jh(e),this.transformFeedbackVaryings=[]}Gh.prototype=Object.assign(Object.create(Ph.prototype),Bh.prototype,{constructor:Gh,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new P([new N(s.inputOutput,"metadata",new Bn.SFNode),new N(s.inputOnly,"activate",new Bn.SFBool),new N(s.outputOnly,"isSelected",new Bn.SFBool),new N(s.outputOnly,"isValid",new Bn.SFBool),new N(s.initializeOnly,"language",new Bn.SFString),new N(s.inputOutput,"parts",new Bn.MFNode)]),wireframe:!1,getTypeName:function(){return"ComposedShader"},getComponentName:function(){return"Shaders"},getContainerField:function(){return"shaders"},initialize:function(){Ph.prototype.initialize.call(this),Bh.prototype.initialize.call(this),this.isLive().addInterest("set_live__",this),this._activate.addInterest("set_activate__",this),this._parts.addFieldInterest(this.loadSensor._watchList),this.loadSensor._isLoaded.addInterest("connectLoaded",this),this.loadSensor._watchList=this._parts,this.loadSensor.setPrivate(!0),this.loadSensor.setup(),this.loadSensor._isLoaded.getValue()?this.set_loaded__():this.connectLoaded()},connectLoaded:function(){this.loadSensor._isLoaded.removeInterest("connectLoaded",this),this.loadSensor._isLoaded.addInterest("set_loaded__",this)},addUserDefinedField:function(e,t,n){const i=this.isInitialized()&&this.isLive().getValue()&&this.isValid();i&&this.removeShaderFields(),Ph.prototype.addUserDefinedField.call(this,e,t,n),i&&this.addShaderFields()},removeUserDefinedField:function(e){const t=this.isInitialized()&&this.isLive().getValue()&&this.isValid();t&&this.removeShaderFields(),Ph.prototype.removeUserDefinedField.call(this,e),t&&this.addShaderFields()},setTransformFeedbackVaryings:function(e){this.transformFeedbackVaryings=e},getProgram:function(){return this.program},set_live__:function(){this.isLive().getValue()?this.isValid()&&this.addShaderFields():this.isValid()&&this.removeShaderFields()},set_activate__:function(){this._activate.getValue()&&this.set_loaded__()},set_loaded__:function(){if(this.loadSensor._isLoaded.getValue()&&"GLSL"===this._language.getValue()){const e=this.getBrowser().getContext(),t=e.createProgram();this.isValid()&&this.removeShaderFields(),e.deleteProgram(this.program),this.program=t;for(const n of this._parts){const i=xr(s.ShaderPart,n);i&&e.attachShader(t,i.getShader())}this.transformFeedbackVaryings.length&&e.transformFeedbackVaryings(t,this.transformFeedbackVaryings,e.INTERLEAVED_ATTRIBS),e.linkProgram(t),e.getProgramParameter(t,e.LINK_STATUS)?(this.setValid(!0),this.getDefaultUniformsAndAttributes(),this.addShaderFields()):(this.setValid(!1),this._parts.length&&console.warn("Couldn't initialize "+this.getTypeName()+" '"+this.getName()+"': "+e.getProgramInfoLog(t)))}else this.setValid(!1)},dispose:function(){this.getBrowser().getContext().deleteProgram(this.program),Bh.prototype.dispose.call(this),Ph.prototype.dispose.call(this)}});const Hh=Gh,qh="\n#if defined (X3D_FOG)\nstruct x3d_FogParameters {\n   mediump int   type;\n   mediump vec3  color;\n   mediump float visibilityRange;\n   mediump mat3  matrix;\n};\n#endif\n\n//uniform x3d_FogParameters x3d_Fog;\n\n#if defined (X3D_LIGHTING)\nstruct x3d_LightSourceParameters {\n   mediump int   type;\n   mediump vec3  color;\n   mediump float intensity;\n   mediump float ambientIntensity;\n   mediump vec3  attenuation;\n   mediump vec3  location;\n   mediump vec3  direction;\n   mediump float radius;\n   mediump float beamWidth;\n   mediump float cutOffAngle;\n   mediump mat3  matrix;\n   #if defined (X3D_SHADOWS)\n   mediump vec3  shadowColor;\n   mediump float shadowIntensity;\n   mediump float shadowBias;\n   mediump mat4  shadowMatrix;\n   mediump int   shadowMapSize;\n   #endif\n};\n#endif\n\n//uniform x3d_LightSourceParameters x3d_LightSource [x3d_MaxLights];\n\n#if defined (X3D_GEOMETRY_0D) && defined (X3D_STYLE_PROPERTIES)\nstruct x3d_PointPropertiesParameters\n{\n   mediump float pointSizeScaleFactor;\n   mediump float pointSizeMinValue;\n   mediump float pointSizeMaxValue;\n   mediump vec3  pointSizeAttenuation;\n};\n#endif\n\n//uniform x3d_PointPropertiesParameters x3d_PointProperties;\n\n#if defined (X3D_GEOMETRY_1D) && defined (X3D_STYLE_PROPERTIES)\nstruct x3d_LinePropertiesParameters\n{\n   bool          applied;\n   mediump int   linetype;\n   mediump float lineStippleScale;\n   sampler2D     texture;\n};\n#endif\n\n//uniform x3d_LinePropertiesParameters x3d_LineProperties;\n\n#if (defined (X3D_GEOMETRY_2D) || defined (X3D_GEOMETRY_3D)) && defined (X3D_STYLE_PROPERTIES)\nstruct x3d_FillPropertiesParameters\n{\n   bool         filled;\n   bool         hatched;\n   mediump vec3 hatchColor;\n   sampler2D    texture;\n};\n#endif\n\n//uniform x3d_FillPropertiesParameters x3d_FillProperties;\n\n#if defined (X3D_UNLIT_MATERIAL)\nstruct x3d_UnlitMaterialParameters\n{\n   mediump vec3  emissiveColor;\n   mediump float normalScale;\n   mediump float transparency;\n};\n#endif\n\n//uniform x3d_UnlitMaterialParameters x3d_Material;\n\n#if defined (X3D_MATERIAL)\nstruct x3d_MaterialParameters\n{\n   mediump float ambientIntensity;\n   mediump vec3  diffuseColor;\n   mediump vec3  specularColor;\n   mediump vec3  emissiveColor;\n   mediump float shininess;\n   mediump float occlusionStrength;\n   mediump float normalScale;\n   mediump float transparency;\n};\n#endif\n\n//uniform x3d_MaterialParameters x3d_Material;\n\n#if defined (X3D_PHYSICAL_MATERIAL)\nstruct x3d_PhysicalMaterialParameters\n{\n   mediump vec3  baseColor;\n   mediump vec3  emissiveColor;\n   mediump float metallic;\n   mediump float roughness;\n   mediump float occlusionStrength;\n   mediump float normalScale;\n   mediump float transparency;\n};\n#endif\n\n//uniform x3d_PhysicalMaterialParameters x3d_Material;\n\n#if defined (X3D_AMBIENT_TEXTURE)\nstruct x3d_AmbientTextureParameters\n{\n   mediump int         textureTransformMapping;\n   mediump int         textureCoordinateMapping;\n   #if defined (X3D_AMBIENT_TEXTURE_2D)\n   mediump sampler2D   texture2D;\n   #endif\n   #if defined (X3D_AMBIENT_TEXTURE_3D) && __VERSION__ != 100\n   mediump sampler3D   texture3D;\n   #endif\n   #if defined (X3D_AMBIENT_TEXTURE_CUBE)\n   mediump samplerCube textureCube;\n   #endif\n};\n#endif\n\n//uniform x3d_AmbientTextureParameters x3d_AmbientTexture;\n\n#if defined (X3D_DIFFUSE_TEXTURE)\nstruct x3d_DiffuseTextureParameters\n{\n   mediump int         textureTransformMapping;\n   mediump int         textureCoordinateMapping;\n   #if defined (X3D_DIFFUSE_TEXTURE_2D)\n   mediump sampler2D   texture2D;\n   #endif\n   #if defined (X3D_DIFFUSE_TEXTURE_3D) && __VERSION__ != 100\n   mediump sampler3D   texture3D;\n   #endif\n   #if defined (X3D_DIFFUSE_TEXTURE_CUBE)\n   mediump samplerCube textureCube;\n   #endif\n};\n#endif\n\n//uniform x3d_DiffuseTextureParameters x3d_DiffuseTexture;\n\n#if defined (X3D_SPECULAR_TEXTURE)\nstruct x3d_SpecularTextureParameters\n{\n   mediump int         textureTransformMapping;\n   mediump int         textureCoordinateMapping;\n   #if defined (X3D_SPECULAR_TEXTURE_2D)\n   mediump sampler2D   texture2D;\n   #endif\n   #if defined (X3D_SPECULAR_TEXTURE_3D) && __VERSION__ != 100\n   mediump sampler3D   texture3D;\n   #endif\n   #if defined (X3D_SPECULAR_TEXTURE_CUBE)\n   mediump samplerCube textureCube;\n   #endif\n};\n#endif\n\n//uniform x3d_SpecularTextureParameters x3d_SpecularTexture;\n\n#if defined (X3D_EMISSIVE_TEXTURE)\nstruct x3d_EmissiveTextureParameters\n{\n   mediump int         textureTransformMapping;\n   mediump int         textureCoordinateMapping;\n   #if defined (X3D_EMISSIVE_TEXTURE_2D)\n   mediump sampler2D   texture2D;\n   #endif\n   #if defined (X3D_EMISSIVE_TEXTURE_3D) && __VERSION__ != 100\n   mediump sampler3D   texture3D;\n   #endif\n   #if defined (X3D_EMISSIVE_TEXTURE_CUBE)\n   mediump samplerCube textureCube;\n   #endif\n};\n#endif\n\n//uniform x3d_EmissiveTextureParameters x3d_EmissiveTexture;\n\n#if defined (X3D_SHININESS_TEXTURE)\nstruct x3d_ShininessTextureParameters\n{\n   mediump int         textureTransformMapping;\n   mediump int         textureCoordinateMapping;\n   #if defined (X3D_SHININESS_TEXTURE_2D)\n   mediump sampler2D   texture2D;\n   #endif\n   #if defined (X3D_SHININESS_TEXTURE_3D) && __VERSION__ != 100\n   mediump sampler3D   texture3D;\n   #endif\n   #if defined (X3D_SHININESS_TEXTURE_CUBE)\n   mediump samplerCube textureCube;\n   #endif\n};\n#endif\n\n//uniform x3d_ShininessTextureParameters x3d_ShininessTexture;\n\n#if defined (X3D_BASE_TEXTURE)\nstruct x3d_BaseTextureParameters\n{\n   mediump int         textureTransformMapping;\n   mediump int         textureCoordinateMapping;\n   #if defined (X3D_BASE_TEXTURE_2D)\n   mediump sampler2D   texture2D;\n   #endif\n   #if defined (X3D_BASE_TEXTURE_3D) && __VERSION__ != 100\n   mediump sampler3D   texture3D;\n   #endif\n   #if defined (X3D_BASE_TEXTURE_CUBE)\n   mediump samplerCube textureCube;\n   #endif\n};\n#endif\n\n//uniform x3d_BaseTextureParameters x3d_BaseTexture;\n\n#if defined (X3D_METALLIC_ROUGHNESS_TEXTURE)\nstruct x3d_MetallicRoughnessTextureParameters\n{\n   mediump int         textureTransformMapping;\n   mediump int         textureCoordinateMapping;\n   #if defined (X3D_METALLIC_ROUGHNESS_TEXTURE_2D)\n   mediump sampler2D   texture2D;\n   #endif\n   #if defined (X3D_METALLIC_ROUGHNESS_TEXTURE_3D) && __VERSION__ != 100\n   mediump sampler3D   texture3D;\n   #endif\n   #if defined (X3D_METALLIC_ROUGHNESS_TEXTURE_CUBE)\n   mediump samplerCube textureCube;\n   #endif\n};\n#endif\n\n//uniform x3d_MetallicRoughnessTextureParameters x3d_MetallicRoughnessTexture;\n\n#if defined (X3D_OCCLUSION_TEXTURE)\nstruct x3d_OcclusionTextureParameters\n{\n   mediump int         textureTransformMapping;\n   mediump int         textureCoordinateMapping;\n   #if defined (X3D_OCCLUSION_TEXTURE_2D)\n   mediump sampler2D   texture2D;\n   #endif\n   #if defined (X3D_OCCLUSION_TEXTURE_3D) && __VERSION__ != 100\n   mediump sampler3D   texture3D;\n   #endif\n   #if defined (X3D_OCCLUSION_TEXTURE_CUBE)\n   mediump samplerCube textureCube;\n   #endif\n};\n#endif\n\n//uniform x3d_OcclusionTextureParameters x3d_OcclusionTexture;\n\n#if defined (X3D_NORMAL_TEXTURE)\nstruct x3d_NormalTextureParameters\n{\n   mediump int         textureTransformMapping;\n   mediump int         textureCoordinateMapping;\n   #if defined (X3D_NORMAL_TEXTURE_2D)\n   mediump sampler2D   texture2D;\n   #endif\n   #if defined (X3D_NORMAL_TEXTURE_3D) && __VERSION__ != 100\n   mediump sampler3D   texture3D;\n   #endif\n   #if defined (X3D_NORMAL_TEXTURE_CUBE)\n   mediump samplerCube textureCube;\n   #endif\n};\n#endif\n\n//uniform x3d_NormalTextureParameters x3d_NormalTexture;\n\n#if defined (X3D_MULTI_TEXTURING)\nstruct x3d_MultiTextureParameters\n{\n   mediump int mode;\n   mediump int alphaMode;\n   mediump int source;\n   mediump int function;\n};\n#endif\n\n//uniform x3d_MultiTextureParameters x3d_MultiTexture [x3d_MaxTextures];\n\n#if defined (X3D_TEXTURE) || defined (X3D_MATERIAL_TEXTURES)\nstruct x3d_TextureCoordinateGeneratorParameters\n{\n   mediump int   mode;\n   mediump float parameter [6];\n};\n#endif\n\n//uniform x3d_TextureCoordinateGeneratorParameters x3d_TextureCoordinateGenerator [x3d_MaxTextures];\n";let Wh=0;const Yh={REPLACE:Wh++,MODULATE:Wh++,MODULATE2X:Wh++,MODULATE4X:Wh++,ADD:Wh++,ADDSIGNED:Wh++,ADDSIGNED2X:Wh++,ADDSMOOTH:Wh++,SUBTRACT:Wh++,BLENDDIFFUSEALPHA:Wh++,BLENDTEXTUREALPHA:Wh++,BLENDFACTORALPHA:Wh++,BLENDCURRENTALPHA:Wh++,MODULATEALPHA_ADDCOLOR:Wh++,MODULATEINVALPHA_ADDCOLOR:Wh++,MODULATEINVCOLOR_ADDALPHA:Wh++,DOTPRODUCT3:Wh++,SELECTARG1:Wh++,SELECTARG2:Wh++,OFF:Wh++};let Kh=0;const Zh={DEFAULT:Kh++,DIFFUSE:Kh++,SPECULAR:Kh++,FACTOR:Kh++};let Qh=0;const $h={DEFAULT:Qh++,COMPLEMENT:Qh++,ALPHAREPLICATE:Qh++};let Jh=0;const ed={NONE:Jh++,SPHERE:Jh++,CAMERASPACENORMAL:Jh++,CAMERASPACEPOSITION:Jh++,CAMERASPACEREFLECTIONVECTOR:Jh++,SPHERE_LOCAL:Jh++,COORD:Jh++,COORD_EYE:Jh++,NOISE:Jh++,NOISE_EYE:Jh++,SPHERE_REFLECT:Jh++,SPHERE_REFLECT_LOCAL:Jh++},td={getSource:function(e,t,n,i){const o="\\s+|/\\*[\\s\\S]*?\\*/|//.*?\\n",r="#line\\s+.*?\\n|#if\\s+.*?\\n|#elif\\s+.*?\\n|#ifdef\\s+.*?\\n|#ifndef\\s+.*?\\n|#else.*?\\n|#endif.*?\\n|#define\\s+(?:[^\\n\\\\]|\\\\[^\\r\\n]|\\\\\\r?\\n)*\\n|#undef\\s+.*?\\n|#pragma\\s+.*?\\n",s=new RegExp("^((?:"+o+"|"+r+")*(?:#version\\s+.*?\\n)?(?:"+o+"|"+r+"|#extension\\s+.*?\\n)*)([\\s\\S]*)$"),a=n.match(s);if(!a)return n;let u="";u+="#define X_ITE\n",e.HAS_FEATURE_DEPTH_TEXTURE&&(u+="#define X3D_DEPTH_TEXTURE\n");for(const e of i)u+="#define "+e+"\n";let l="";l+="#define x3d_None 0\n",l+="#define x3d_Points      0\n",l+="#define x3d_Lines       1\n",l+="#define x3d_Geometry2D  2\n",l+="#define x3d_Geometry3D  3\n",l+="#define x3d_MaxClipPlanes  "+t.getMaxClipPlanes()+"\n",l+="#define x3d_LinearFog        1\n",l+="#define x3d_ExponentialFog   2\n",l+="#define x3d_Exponential2Fog  3\n",l+="#define x3d_MaxLights         "+t.getMaxLights()+"\n",l+="#define x3d_DirectionalLight  1\n",l+="#define x3d_PointLight        2\n",l+="#define x3d_SpotLight         3\n",l+="#define x3d_MaxTextures      "+t.getMaxTextures()+"\n",l+="#define x3d_TextureType2D    2\n",l+="#define x3d_TextureType3D    3\n",l+="#define x3d_TextureTypeCube  4\n",l+="#define x3d_Replace                   "+Yh.REPLACE+"\n",l+="#define x3d_Modulate                  "+Yh.MODULATE+"\n",l+="#define x3d_Modulate2X                "+Yh.MODULATE2X+"\n",l+="#define x3d_Modulate4X                "+Yh.MODULATE4X+"\n",l+="#define x3d_Add                       "+Yh.ADD+"\n",l+="#define x3d_AddSigned                 "+Yh.ADDSIGNED+"\n",l+="#define x3d_AddSigned2X               "+Yh.ADDSIGNED2X+"\n",l+="#define x3d_AddSmooth                 "+Yh.ADDSMOOTH+"\n",l+="#define x3d_Subtract                  "+Yh.SUBTRACT+"\n",l+="#define x3d_BlendDiffuseAlpha         "+Yh.BLENDDIFFUSEALPHA+"\n",l+="#define x3d_BlendTextureAlpha         "+Yh.BLENDTEXTUREALPHA+"\n",l+="#define x3d_BlendFactorAlpha          "+Yh.BLENDFACTORALPHA+"\n",l+="#define x3d_BlendCurrentAlpha         "+Yh.BLENDCURRENTALPHA+"\n",l+="#define x3d_ModulateAlphaAddColor     "+Yh.MODULATEALPHA_ADDCOLOR+"\n",l+="#define x3d_ModulateInvAlphaAddColor  "+Yh.MODULATEINVALPHA_ADDCOLOR+"\n",l+="#define x3d_ModulateInvColorAddAlpha  "+Yh.MODULATEINVCOLOR_ADDALPHA+"\n",l+="#define x3d_DotProduct3               "+Yh.DOTPRODUCT3+"\n",l+="#define x3d_SelectArg1                "+Yh.SELECTARG1+"\n",l+="#define x3d_SelectArg2                "+Yh.SELECTARG2+"\n",l+="#define x3d_Off                       "+Yh.OFF+"\n",l+="#define x3d_Diffuse  "+Zh.DIFFUSE+"\n",l+="#define x3d_Specular "+Zh.SPECULAR+"\n",l+="#define x3d_Factor   "+Zh.FACTOR+"\n",l+="#define x3d_Complement     "+$h.COMPLEMENT+"\n",l+="#define x3d_AlphaReplicate "+$h.ALPHAREPLICATE+"\n",l+="#define x3d_Sphere                      "+ed.SPHERE+"\n",l+="#define x3d_CameraSpaceNormal           "+ed.CAMERASPACENORMAL+"\n",l+="#define x3d_CameraSpacePosition         "+ed.CAMERASPACEPOSITION+"\n",l+="#define x3d_CameraSpaceReflectionVector "+ed.CAMERASPACEREFLECTIONVECTOR+"\n",l+="#define x3d_SphereLocal                 "+ed.SPHERE_LOCAL+"\n",l+="#define x3d_Coord                       "+ed.COORD+"\n",l+="#define x3d_CoordEye                    "+ed.COORD_EYE+"\n",l+="#define x3d_Noise                       "+ed.NOISE+"\n",l+="#define x3d_NoiseEye                    "+ed.NOISE_EYE+"\n",l+="#define x3d_SphereReflect               "+ed.SPHERE_REFLECT+"\n",l+="#define x3d_SphereReflectLocal          "+ed.SPHERE_REFLECT_LOCAL+"\n",l+="#define x3d_GeometryPoints  0\n",l+="#define x3d_GeometryLines   1\n",l+="#define x3d_NoneClipPlane   vec4 (88.0, 51.0, 68.0, 33.0)\n",l+="#define x3d_NoneFog         0\n",l+="#define x3d_NoneLight       0\n",l+="#define x3d_NoneTexture     0\n";const c=n.match(/\s*precision\s+(lowp|mediump|highp)\s+float\s*;/),h=n.match(/\s*precision\s+(lowp|mediump|highp)\s+int\s*;/),d=c?c[1]:"mediump",p=h?h[1]:"mediump",f=qh.replace(/mediump\s+(float|vec2|vec3|mat3|mat4)/g,d+" $1").replace(/mediump\s+(int)/g,p+" $1"),g=(a[1].match(/\n/g)||[]).length+1;return a[1]+u+l+f+"#line "+(g+1)+" -1\n"+a[2]}};const nd=td,id=/^\s*#pragma\s+X3D\s+include\s+".*?([^\/]+)\.glsl"\s*$/;function od(e){this.includes=Rh.includes[e.getVersion()],this.sourceFileNumbers={};for(const[e,t]of Object.getOwnPropertyNames(this.includes).entries())this.sourceFileNumbers[t]=e+1}od.prototype={getSourceFileName:function(e){return Object.getOwnPropertyNames(this.includes)[e-1]},process:function(e,t=0){const n=e.split("\n");e="";for(let i=0,o=n.length;i<o;++i){const o=n[i],r=o.match(id);r?(e+="#line 1 "+this.sourceFileNumbers[r[1]]+"\n",e+=this.process(this.includes[r[1]],this.sourceFileNumbers[r[1]]),e+="\n",e+="#line "+(i+2)+" "+t+"\n"):(e+=o,e+="\n")}return e}};const rd=od,sd=["X3D_GEOMETRY_0D","X3D_GEOMETRY_1D","X3D_GEOMETRY_2D","X3D_GEOMETRY_3D","X3D_FOG","X3D_STYLE_PROPERTIES","X3D_UNLIT_MATERIAL","X3D_MATERIAL","X3D_LIGHTING","X3D_TEXTURE","X3D_MULTI_TEXTURING"];function ad(e){ji.call(this,e),xo.call(this,e),this.addType(s.ShaderPart),this.options=[]}ad.prototype=Object.assign(Object.create(ji.prototype),xo.prototype,{constructor:ad,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new P([new N(s.inputOutput,"metadata",new Bn.SFNode),new N(s.initializeOnly,"type",new Bn.SFString("VERTEX")),new N(s.inputOutput,"load",new Bn.SFBool(!0)),new N(s.inputOutput,"url",new Bn.MFString),new N(s.inputOutput,"autoRefresh",new Bn.SFTime),new N(s.inputOutput,"autoRefreshTimeLimit",new Bn.SFTime(3600))]),getTypeName:function(){return"ShaderPart"},getComponentName:function(){return"Shaders"},getContainerField:function(){return"parts"},initialize:function(){ji.prototype.initialize.call(this),xo.prototype.initialize.call(this),this.isPrivate()||(this.options=sd.slice()),this._type.addInterest("set_type__",this),this.requestImmediateLoad()},set_type__:function(){this.setLoadState(s.NOT_STARTED_STATE),this.requestImmediateLoad()},getSourceText:function(){return this._url},getOptions:function(){return this.options},setOptions:function(e){this.options=e},getShader:function(){return this.shader},getShaderType:function(){const e=new Map([["VERTEX","VERTEX_SHADER"],["TESS_CONTROL","TESS_CONTROL_SHADER"],["TESS_EVALUATION","TESS_EVALUATION_SHADER"],["GEOMETRY","GEOMETRY_SHADER"],["FRAGMENT","FRAGMENT_SHADER"],["COMPUTE","COMPUTE_SHADER"]]);return function(){return e.get(this._type.getValue())||"VERTEX_SHADER"}}(),unLoadNow:function(){this.valid=!1},loadNow:function(){new oa(this).loadDocument(this._url,function(e,t){if(null===e)this.setLoadState(s.FAILED_STATE);else{const n=this.getBrowser(),i=n.getContext(),o=this.getShaderType(),r=["X3D_"+o].concat(this.options),a=new rd(i),u=nd.getSource(i,n,a.process(e),r),l=i.createShader(i[o]);if(i.deleteShader(this.shader),this.shader=l,i.shaderSource(l,u),i.compileShader(l),!i.getShaderParameter(l,i.COMPILE_STATUS)){const e=this.getTypeName(),n=this.getName(),o=i.getShaderInfoLog(l),r=o.match(/(\d+):(\d+)/);if(r){const i=a.getSourceFileName(r[1])||t||this.getExecutionContext().getWorldURL();throw new Error("Error in "+e+" '"+n+"' in URL '"+i+"', line "+r[2]+", "+o)}{const i=t||this.getExecutionContext().getWorldURL();throw new Error("Error in "+e+" '"+n+"' in URL '"+i+"', "+o)}}this.setLoadState(s.COMPLETE_STATE)}}.bind(this))},dispose:function(){this.getBrowser().getContext().deleteShader(this.shader),xo.prototype.dispose.call(this),ji.prototype.dispose.call(this)}});const ud=ad,ld=Symbol(),cd=Symbol(),hd=(Symbol(),Symbol());function dd(){this[ld]=!1,this[cd]=new Map,this[hd]=new Map}dd.prototype={initialize:function(){this.setShading(this.getBrowserOptions().getShading())},getShadingLanguageVersion:function(){const e=this.getContext();return e.getParameter(e.SHADING_LANGUAGE_VERSION)},getMaxVertexUniformVectors:function(){const e=this.getContext();return e.getParameter(e.MAX_VERTEX_UNIFORM_VECTORS)},getMaxFragmentUniformVectors:function(){const e=this.getContext();return e.getParameter(e.MAX_FRAGMENT_UNIFORM_VECTORS)},getMaxVertexAttribs:function(){const e=this.getContext();return e.getParameter(e.MAX_VERTEX_ATTRIBS)},getMaxVaryingVectors:function(){const e=this.getContext();return e.getParameter(e.MAX_VARYING_VECTORS)},getWireframe:function(){return this[ld]},getPrimitiveMode:function(e){return this[cd].get(e)},getShaders:function(){return this[hd]},setShading:function(e){const t=this.getContext();switch(e){case gi.POINT:this[ld]=!1,this[cd].set(t.POINTS,t.POINTS),this[cd].set(t.LINES,t.POINTS),this[cd].set(t.TRIANGLES,t.POINTS);break;case gi.WIREFRAME:this[ld]=!0,this[cd].set(t.POINTS,t.POINTS),this[cd].set(t.LINES,t.LINES),this[cd].set(t.TRIANGLES,t.LINE_LOOP);break;default:this[ld]=!1,this[cd].set(t.POINTS,t.POINTS),this[cd].set(t.LINES,t.LINES),this[cd].set(t.TRIANGLES,t.TRIANGLES)}},createShader:function(e,t,n=t,i=[],o=[],r=[]){this.getDebug()&&console.info("Initializing "+e);const s=this.getContext().getVersion(),a=new ud(this.getPrivateScene());a._url.push(t.startsWith("data:")?t:"data:x-shader/x-vertex,"+Rh.vertex[s][t]),a.setPrivate(!0),a.setName(e+"Vertex"),a.setOptions(i),a.setup();const u=new ud(this.getPrivateScene());u._type="FRAGMENT",u._url.push(n.startsWith("data:")?n:"data:x-shader/x-fragment,"+Rh.fragment[s][n]),u.setPrivate(!0),u.setName(e+"Fragment"),u.setOptions(i),u.setup();const l=new Hh(this.getPrivateScene());return l._language="GLSL",l._parts.push(a),l._parts.push(u),l.setPrivate(!0),l.setName(e),l.setUniformNames(o),l.setTransformFeedbackVaryings(r),l.setup(),l}};const pd=dd;function fd(e){ji.call(this,e),this.addType(s.X3DAppearanceNode),this.addChildObjects("transparent",new Bn.SFBool),this._transparent.setAccessType(s.outputOnly)}fd.prototype=Object.assign(Object.create(ji.prototype),{constructor:fd,setTransparent:function(e){e!==this._transparent.getValue()&&(this._transparent=e)},getTransparent:function(){return this._transparent.getValue()}});const gd=fd;function md(e){gd.call(this,e),this.addType(s.Appearance),this.stylePropertiesNode=[],this.textureTransformMapping=new Map,this.textureBits=new Jr,this.shaderNodes=[]}md.prototype=Object.assign(Object.create(gd.prototype),{constructor:md,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new P([new N(s.inputOutput,"metadata",new Bn.SFNode),new N(s.inputOutput,"alphaMode",new Bn.SFString("AUTO")),new N(s.inputOutput,"alphaCutoff",new Bn.SFFloat(.5)),new N(s.inputOutput,"acousticProperties",new Bn.SFNode),new N(s.inputOutput,"pointProperties",new Bn.SFNode),new N(s.inputOutput,"lineProperties",new Bn.SFNode),new N(s.inputOutput,"fillProperties",new Bn.SFNode),new N(s.inputOutput,"material",new Bn.SFNode),new N(s.inputOutput,"backMaterial",new Bn.SFNode),new N(s.inputOutput,"texture",new Bn.SFNode),new N(s.inputOutput,"textureTransform",new Bn.SFNode),new N(s.inputOutput,"shaders",new Bn.MFNode),new N(s.inputOutput,"blendMode",new Bn.SFNode)]),getTypeName:function(){return"Appearance"},getComponentName:function(){return"Shape"},getContainerField:function(){return"appearance"},initialize:function(){gd.prototype.initialize.call(this),this._alphaMode.addInterest("set_alphaMode__",this),this._alphaCutoff.addInterest("set_alphaCutoff__",this),this._pointProperties.addInterest("set_pointProperties__",this),this._lineProperties.addInterest("set_lineProperties__",this),this._fillProperties.addInterest("set_fillProperties__",this),this._material.addInterest("set_material__",this),this._backMaterial.addInterest("set_backMaterial__",this),this._texture.addInterest("set_texture__",this),this._textureTransform.addInterest("set_textureTransform__",this),this._shaders.addInterest("set_shaders__",this),this._blendMode.addInterest("set_blendMode__",this),this._alphaMode.addInterest("set_transparent__",this),this._fillProperties.addInterest("set_transparent__",this),this._material.addInterest("set_transparent__",this),this._texture.addInterest("set_transparent__",this),this._blendMode.addInterest("set_transparent__",this),this.set_alphaMode__(),this.set_pointProperties__(),this.set_lineProperties__(),this.set_fillProperties__(),this.set_material__(),this.set_backMaterial__(),this.set_texture__(),this.set_textureTransform__(),this.set_shaders__(),this.set_blendMode__(),this.set_transparent__()},getAlphaMode:function(){return this.alphaMode},getAlphaCutoff:function(){return this.alphaCutoff},getStyleProperties:function(e){return this.stylePropertiesNode[e]},getPointProperties:function(){return this.stylePropertiesNode[0]},getLineProperties:function(){return this.stylePropertiesNode[1]},getFillProperties:function(){return this.stylePropertiesNode[2]},getMaterial:function(){return this.materialNode},getBackMaterial:function(){return this.backMaterialNode},getTexture:function(){return this.textureNode},getTextureBits:function(){return this.textureBits},updateTextureBits:function(){this.textureBits.clear(),this.textureNode.updateTextureBits(this.textureBits)},getTextureTransform:function(){return this.textureTransformNode},getTextureTransformMapping:function(){return this.textureTransformMapping},getShader:function(e,t){return this.materialNode.getShader(e,t)},getBackShader:function(e,t){return this.backMaterialNode.getShader(e,t)},getBlendMode:function(){return this.blendModeNode},set_alphaMode__:function(){this.alphaMode=this.getEnum(ll,this._alphaMode.getValue(),ll.AUTO),this.set_alphaCutoff__()},set_alphaCutoff__:function(){this.alphaCutoff=this.alphaMode===ll.MASK?this._alphaCutoff.getValue():0},set_pointProperties__:function(){this.stylePropertiesNode[0]=xr(s.PointProperties,this._pointProperties)},set_lineProperties__:function(){this.linePropertiesNode&&this.linePropertiesNode._applied.removeInterest("set_applied__",this),this.linePropertiesNode=xr(s.LineProperties,this._lineProperties),this.linePropertiesNode&&this.linePropertiesNode._applied.addInterest("set_applied__",this),this.set_applied__()},set_applied__:function(){this.linePropertiesNode&&this.linePropertiesNode._applied.getValue()?this.stylePropertiesNode[1]=this.linePropertiesNode:this.stylePropertiesNode[1]=null},set_fillProperties__:function(){this.stylePropertiesNode[2]&&this.stylePropertiesNode[2]._transparent.removeInterest("set_transparent__",this),this.stylePropertiesNode[2]=xr(s.FillProperties,this._fillProperties),this.stylePropertiesNode[2]&&this.stylePropertiesNode[2]._transparent.addInterest("set_transparent__",this),this.stylePropertiesNode[3]=this.stylePropertiesNode[2]},set_material__:function(){this.materialNode&&this.materialNode._transparent.removeInterest("set_transparent__",this),this.materialNode=xr(s.X3DMaterialNode,this._material),this.materialNode||(this.materialNode=this.getBrowser().getDefaultMaterial()),this.materialNode&&this.materialNode._transparent.addInterest("set_transparent__",this),"TwoSidedMaterial"===this.materialNode.getTypeName()&&this.set_backMaterial__()},set_backMaterial__:function(){this.backMaterialNode&&this.backMaterialNode._transparent.removeInterest("set_transparent__",this),this.backMaterialNode=xr(s.X3DOneSidedMaterialNode,this._backMaterial),this.backMaterialNode&&this.backMaterialNode._transparent.addInterest("set_transparent__",this),this.backMaterialNode||"TwoSidedMaterial"!==this.materialNode.getTypeName()||(this.backMaterialNode=this.materialNode)},set_texture__:function(){this.textureNode&&(this.textureNode.removeInterest("updateTextureBits",this),this.textureNode._transparent.removeInterest("set_transparent__",this)),this.textureNode=xr(s.X3DTextureNode,this._texture),this.textureNode?(this.textureNode.addInterest("updateTextureBits",this),this.textureNode._transparent.addInterest("set_transparent__",this),this.updateTextureBits()):this.textureBits.clear()},set_textureTransform__:function(){this.textureTransformNode&&this.textureTransformNode.removeInterest("updateTextureTransformMapping",this),this.textureTransformNode=xr(s.X3DTextureTransformNode,this._textureTransform),this.textureTransformNode||(this.textureTransformNode=this.getBrowser().getDefaultTextureTransform()),this.textureTransformNode.addInterest("updateTextureTransformMapping",this),this.updateTextureTransformMapping()},updateTextureTransformMapping:function(){this.textureTransformMapping.clear(),this.textureTransformNode.getTextureTransformMapping(this.textureTransformMapping)},set_shaders__:function(){const e=this.shaderNodes;for(const t of e)t._isValid.removeInterest("set_shader__",this);e.length=0;for(const t of this._shaders){const n=xr(s.X3DShaderNode,t);n&&e.push(n)}for(const t of e)t._isValid.addInterest("set_shader__",this);this.set_shader__()},set_shader__:function(){function e(){return this.shaderNode}return function(){const t=this.shaderNodes;this.shaderNode&&this.shaderNode.deselect(),this.shaderNode=null;for(const e of t)if(e._isValid.getValue()){this.shaderNode=e;break}this.shaderNode?(this.shaderNode.select(),this.getShader=e,this.getBackShader=e):(delete this.getShader,delete this.getBackShader)}}(),set_blendMode__:function(){this.blendModeNode=xr(s.BlendMode,this._blendMode)},set_transparent__:function(){switch(this.alphaMode){case ll.AUTO:this.setTransparent(Boolean(this.stylePropertiesNode[3]&&this.stylePropertiesNode[3].getTransparent()||this.materialNode&&this.materialNode.getTransparent()||this.backMaterialNode&&this.backMaterialNode.getTransparent()||this.textureNode&&this.textureNode.getTransparent()||this.blendModeNode));break;case ll.OPAQUE:case ll.MASK:this.setTransparent(!1);break;case ll.BLEND:this.setTransparent(!0)}},traverse:function(e,t){this.textureNode&&this.textureNode.traverse(e,t)}});const _d=md;function yd(e){os.call(this,e),this.addType(s.X3DMaterialNode),this.addChildObjects("transparent",new Bn.SFBool),this._transparent.setAccessType(s.outputOnly),this.textureBits=new Jr,this.shaderNodes=this.getBrowser().getShaders()}yd.prototype=Object.assign(Object.create(os.prototype),{constructor:yd,initialize:function(){os.prototype.initialize.call(this),this.getBrowser().getRenderingProperties()._LogarithmicDepthBuffer.addInterest("set_logarithmicDepthBuffer__",this),this.set_logarithmicDepthBuffer__()},set_logarithmicDepthBuffer__:function(){this.logarithmicDepthBuffer=this.getBrowser().getRenderingProperty("LogarithmicDepthBuffer")},setTransparent:function(e){e!==this._transparent.getValue()&&(this._transparent=e)},getTransparent:function(){return this._transparent.getValue()},setTexture:function(e,t){const n=t?t.getTextureType()-1:0;this.textureBits.set(2*e+0,1&n),this.textureBits.set(2*e+1,2&n)},getTextureBits:function(){return this.textureBits},getShader:function(e,t){let n="";if(n+=this.textureBits.toString(4),n+=".",n+=e.geometryKey,t){const{renderObject:i,shadows:o,fogNode:r,shapeNode:s,appearanceNode:a,textureNode:u,objectsCount:l}=t;n+=this.logarithmicDepthBuffer||i.getViewpoint().getLogarithmicDepthBuffer()?"1":"0",n+=o?"1":"0",n+=r?r.getFogKey():"0",n+=s.getShapeKey(),n+=a.getStyleProperties(e.geometryType)?"1":"0",n+=".",n+=l[0],n+=".",n+=l[1],n+=".",n+=l[2],n+=".",n+=u?"1":a.getTextureBits().toString(4),n+=".",n+=a.getTextureTransformMapping().size||"1",n+=e.textureCoordinateMapping.size||"1",n+=this.getMaterialKey(o)}else{const{textureNode:t,objectsCount:i}=e;n+=this.logarithmicDepthBuffer?"1":"0",n+="0000.",n+=i[0],n+=".",n+=i[1],n+=".",n+=i[2],n+=".",n+=t?"1":"0",n+=".11",n+=this.getMaterialKey(!1)}return this.shaderNodes.get(n)||this.createShader(n,e,t)},getShaderOptions:function(){const e=["X3D_GEOMETRY_0D","X3D_GEOMETRY_1D","X3D_GEOMETRY_2D","X3D_GEOMETRY_3D"];return function(t,n){const i=this.getBrowser(),o=[];if(o.push(e[t.geometryType]),t.hasFogCoords&&o.push("X3D_FOG_COORDS"),t.colorMaterial&&o.push("X3D_COLOR_MATERIAL"),t.hasNormals&&o.push("X3D_NORMALS"),n){const{renderObject:e,appearanceNode:r,objectsCount:a}=n;if((this.logarithmicDepthBuffer||e.getViewpoint().getLogarithmicDepthBuffer())&&o.push("X3D_LOGARITHMIC_DEPTH_BUFFER"),n.shadows&&o.push("X3D_SHADOWS","X3D_PCF_FILTERING"),n.fogNode)switch(o.push("X3D_FOG"),n.fogNode.getFogKey()){case"1":o.push("X3D_FOG_LINEAR");break;case"2":o.push("X3D_FOG_EXPONENTIAL")}if(a[0]&&(o.push("X3D_CLIP_PLANES"),o.push("X3D_NUM_CLIP_PLANES "+Math.min(a[0],i.getMaxClipPlanes()))),a[1]&&(o.push("X3D_LIGHTING"),o.push("X3D_NUM_LIGHTS "+Math.min(a[1],i.getMaxLights()))),a[2]&&(o.push("X3D_PROJECTIVE_TEXTURE_MAPPING"),o.push("X3D_NUM_TEXTURE_PROJECTORS "+Math.min(a[2],i.getMaxTextures()))),r.getStyleProperties(t.geometryType)&&o.push("X3D_STYLE_PROPERTIES"),+this.textureBits)o.push("X3D_MATERIAL_TEXTURES"),o.push("X3D_NUM_TEXTURE_TRANSFORMS "+(r.getTextureTransformMapping().size||"1")),o.push("X3D_NUM_TEXTURE_COORDINATES "+(t.getTextureCoordinateMapping().size||"1"));else if(n.textureNode)o.push("X3D_TEXTURE","X3D_NUM_TEXTURES 1","X3D_NUM_TEXTURE_TRANSFORMS 1","X3D_NUM_TEXTURE_COORDINATES 1","X3D_TEXTURE0_2D");else if(+r.getTextureBits()){const e=r.getTexture();o.push("X3D_TEXTURE"),o.push("X3D_NUM_TEXTURES "+e.getCount()),o.push("X3D_NUM_TEXTURE_TRANSFORMS "+e.getCount()),o.push("X3D_NUM_TEXTURE_COORDINATES "+e.getCount()),e.getShaderOptions(o),e.getType().includes(s.MultiTexture)&&o.push("X3D_MULTI_TEXTURING")}switch(n.shapeNode.getShapeKey()){case"1":o.push("X3D_PARTICLE_SYSTEM");break;case"2":o.push("X3D_PARTICLE_SYSTEM","X3D_TEX_COORD_RAMP")}}else{const{textureNode:e,objectsCount:n}=t;this.logarithmicDepthBuffer&&o.push("X3D_LOGARITHMIC_DEPTH_BUFFER"),n[0]&&(o.push("X3D_CLIP_PLANES"),o.push("X3D_NUM_CLIP_PLANES "+Math.min(n[0],i.getMaxClipPlanes()))),n[1]&&(o.push("X3D_LIGHTING"),o.push("X3D_NUM_LIGHTS "+Math.min(n[1],i.getMaxLights()))),n[2]&&(o.push("X3D_PROJECTIVE_TEXTURE_MAPPING"),o.push("X3D_NUM_TEXTURE_PROJECTORS "+Math.min(n[2],i.getMaxTextures()))),e&&o.push("X3D_TEXTURE","X3D_NUM_TEXTURES 1","X3D_NUM_TEXTURE_TRANSFORMS 1","X3D_NUM_TEXTURE_COORDINATES 1","X3D_TEXTURE0_2D")}return o}}()});const xd=yd;function wd(e){xd.call(this,e),this.addType(s.X3DOneSidedMaterialNode),this.addChildObjects("textures",new Bn.SFTime),this.emissiveColor=new Float32Array(3)}wd.prototype=Object.assign(Object.create(xd.prototype),{constructor:wd,initialize:function(){xd.prototype.initialize.call(this),this._emissiveColor.addInterest("set_emissiveColor__",this),this._emissiveTexture.addInterest("set_emissiveTexture__",this),this._normalTexture.addInterest("set_normalTexture__",this),this._transparency.addInterest("set_transparency__",this),this._transparency.addInterest("set_transparent__",this),this.set_emissiveColor__(),this.set_emissiveTexture__(),this.set_normalTexture__(),this.set_transparency__()},set_emissiveColor__:function(){const e=this.emissiveColor,t=this._emissiveColor.getValue();e[0]=t.r,e[1]=t.g,e[2]=t.b},set_emissiveTexture__:function(){this.emissiveTextureNode=xr(s.X3DSingleTextureNode,this._emissiveTexture),this.setTexture(this.getTextureIndices().EMISSIVE_TEXTURE,this.emissiveTextureNode)},set_normalTexture__:function(){this.normalTextureNode=xr(s.X3DSingleTextureNode,this._normalTexture),this.setTexture(this.getTextureIndices().NORMAL_TEXTURE,this.normalTextureNode)},set_transparency__:function(){this.transparency=ee.clamp(this._transparency.getValue(),0,1)},set_transparent__:function(){this.setTransparent(Boolean(this.transparency))},getEmissiveTexture:function(){return this.emissiveTextureNode},getNormalTexture:function(){return this.normalTextureNode},getTransparency:function(){return this.transparency},getTextureIndices:function(){let e=0;const t={EMISSIVE_TEXTURE:e++,NORMAL_TEXTURE:e++};return function(){return t}}(),getShaderOptions:function(e,t){const n=xd.prototype.getShaderOptions.call(this,e,t);return+this.getTextureBits()&&(this.getEmissiveTexture()&&n.push("X3D_EMISSIVE_TEXTURE","X3D_EMISSIVE_TEXTURE","X3D_EMISSIVE_TEXTURE_"+this.getEmissiveTexture().getTextureTypeString()),this.getNormalTexture()&&n.push("X3D_NORMAL_TEXTURE","X3D_NORMAL_TEXTURE_"+this.getNormalTexture().getTextureTypeString())),n},setShaderUniforms:function(e,t,n,i,o){if(e.uniform3fv(t.x3d_EmissiveColor,this.emissiveColor),e.uniform1f(t.x3d_Transparency,this.transparency),+this.getTextureBits()){if(this.emissiveTextureNode){const r=t.x3d_EmissiveTexture;this.emissiveTextureNode.setShaderUniforms(e,t,n,r),e.uniform1i(r.textureTransformMapping,i.get(this._emissiveTextureMapping.getValue())||0),e.uniform1i(r.textureCoordinateMapping,o.get(this._emissiveTextureMapping.getValue())||0)}if(this.normalTextureNode){const r=t.x3d_NormalTexture;this.normalTextureNode.setShaderUniforms(e,t,n,r),e.uniform1i(r.textureTransformMapping,i.get(this._normalTextureMapping.getValue())||0),e.uniform1i(r.textureCoordinateMapping,o.get(this._normalTextureMapping.getValue())||0),e.uniform1f(t.x3d_NormalScale,this._normalScale.getValue())}}}});const vd=wd;function bd(e){vd.call(this,e),this.addType(s.UnlitMaterial)}bd.prototype=Object.assign(Object.create(vd.prototype),{constructor:bd,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new P([new N(s.inputOutput,"metadata",new Bn.SFNode),new N(s.inputOutput,"emissiveColor",new Bn.SFColor(1,1,1)),new N(s.inputOutput,"emissiveTexture",new Bn.SFNode),new N(s.inputOutput,"emissiveTextureMapping",new Bn.SFString),new N(s.inputOutput,"normalScale",new Bn.SFFloat(1)),new N(s.inputOutput,"normalTexture",new Bn.SFNode),new N(s.inputOutput,"normalTextureMapping",new Bn.SFString),new N(s.inputOutput,"transparency",new Bn.SFFloat)]),getTypeName:function(){return"UnlitMaterial"},getComponentName:function(){return"Shape"},getContainerField:function(){return"material"},initialize:function(){vd.prototype.initialize.call(this),this.set_transparent__()},set_emissiveTexture__:function(){this.getEmissiveTexture()&&this.getEmissiveTexture()._transparent.removeInterest("set_transparent__",this),vd.prototype.set_emissiveTexture__.call(this),this.getEmissiveTexture()&&this.getEmissiveTexture()._transparent.addInterest("set_transparent__",this)},set_transparent__:function(){this.setTransparent(Boolean(this.getTransparency()||this.getEmissiveTexture()&&this.getEmissiveTexture().getTransparent()))},getMaterialKey:function(){return"0"},createShader:function(e,t,n){const i=this.getBrowser(),o=this.getShaderOptions(t,n);o.push("X3D_UNLIT_MATERIAL");const r=i.createShader("UnlitShader","Default","Unlit",o);return i.getShaders().set(e,r),r}});const Sd=bd,Td=Symbol(),Ed=Symbol(),Cd=Symbol(),Od=Symbol(),Nd=Symbol(),Fd=Symbol(),Md=Symbol(),Dd=Symbol();function Id(){this[Cd]=[],this[Td]=1/(32*this.getPixelPerPoint())}Id.prototype={initialize:function(){},getDefaultAppearance:function(){return this[Od]=new _d(this.getPrivateScene()),this[Od].setPrivate(!0),this[Od].setup(),this.getDefaultAppearance=function(){return this[Od]},Object.defineProperty(this,"getDefaultAppearance",{enumerable:!1}),this[Od]},getLineStippleScale:function(){return this[Td]},getDefaultMaterial:function(){return this[Nd]=new Sd(this.getPrivateScene()),this[Nd].setPrivate(!0),this[Nd].setup(),this.getDefaultMaterial=function(){return this[Nd]},Object.defineProperty(this,"getDefaultMaterial",{enumerable:!1}),this[Nd]},getLinetypeTexture:function(){return this[Ed]=new fs(this.getPrivateScene()),this[Ed]._url[0]=kc.getLinetypeUrl(),this[Ed]._textureProperties=this.getLineFillTextureProperties(),this[Ed].setPrivate(!0),this[Ed].setup(),this.getLinetypeTexture=function(){return this[Ed]},Object.defineProperty(this,"getLinetypeTexture",{enumerable:!1}),this[Ed]},getHatchStyleTexture:function(e){let t=this[Cd][e];return t||(t=this[Cd][e]=new fs(this.getPrivateScene()),t._url[0]=kc.getHatchingUrl(e),t._textureProperties=this.getLineFillTextureProperties(),t.setPrivate(!0),t.setup(),t)},getLineFillTextureProperties:function(){return this[Fd]=new Du(this.getPrivateScene()),this[Fd]._minificationFilter="NEAREST_PIXEL",this[Fd]._magnificationFilter="NEAREST_PIXEL",this[Fd].setPrivate(!0),this[Fd].setup(),this.getLineFillTextureProperties=function(){return this[Fd]},Object.defineProperty(this,"getLineFillTextureProperties",{enumerable:!1}),this[Fd]},getLineTransformShader:function(){return this[Md]=this.createShader("LineTransformShader","LineTransform","LineTransform",[],["viewport","modelViewProjectionMatrix","invModelViewProjectionMatrix","scale"],["lineStipple0","fogDepth0","color0","vertex0","lineStipple1","fogDepth1","color1","vertex1","lineStipple2","fogDepth2","color2","vertex2"]),this.getLineTransformShader=function(){return this[Md]},Object.defineProperty(this,"getLineTransformShader",{enumerable:!1}),this[Md]},getLineTransformFeedback:function(){const e=this.getContext();return this[Dd]=e.createTransformFeedback(),this.getLineTransformFeedback=function(){return this[Dd]},Object.defineProperty(this,"getLineTransformFeedback",{enumerable:!1}),this[Dd]}};const Rd=Id;function Vd(){this.addChildObjects("volume",new Bn.SFFloat(1),"mute",new Bn.SFBool)}Vd.prototype={initialize:function(){}};const Pd=Vd;let Ad=0;const Ld={BEGIN:++Ad,FIRST:++Ad,MIDDLE:++Ad,END:++Ad},Ud={SERIF:{PLAIN:kc.getFontsUrl("DroidSerif-Regular.ttf"),ITALIC:kc.getFontsUrl("DroidSerif-Italic.ttf"),BOLD:kc.getFontsUrl("DroidSerif-Bold.ttf"),BOLDITALIC:kc.getFontsUrl("DroidSerif-BoldItalic.ttf")},SANS:{PLAIN:kc.getFontsUrl("Ubuntu-R.ttf"),ITALIC:kc.getFontsUrl("Ubuntu-RI.ttf"),BOLD:kc.getFontsUrl("Ubuntu-B.ttf"),BOLDITALIC:kc.getFontsUrl("Ubuntu-BI.ttf")},TYPEWRITER:{PLAIN:kc.getFontsUrl("UbuntuMono-R.ttf"),ITALIC:kc.getFontsUrl("UbuntuMono-RI.ttf"),BOLD:kc.getFontsUrl("UbuntuMono-B.ttf"),BOLDITALIC:kc.getFontsUrl("UbuntuMono-BI.ttf")}};function Bd(e){ji.call(this,e),xo.call(this,e),this.addType(s.X3DFontStyleNode),this.addChildObjects("load",new Bn.SFBool(!0),"autoRefresh",new Bn.SFTime,"autoRefreshTimeLimit",new Bn.SFTime(3600)),this.addAlias("url",this._family),this.familyStack=[],this.alignments=[],this.loader=new oa(this)}Bd.prototype=Object.assign(Object.create(ji.prototype),xo.prototype,{constructor:Bd,initialize:function(){ji.prototype.initialize.call(this),xo.prototype.initialize.call(this),this._style.addInterest("set_style__",this),this._justify.addInterest("set_justify__",this),this.font=null,this.familyIndex=0,this.set_justify__(),this.set_style__(),this.requestImmediateLoad()},set_style__:function(){this._load.getValue()&&(this.setLoadState(s.NOT_STARTED_STATE),this.requestImmediateLoad())},set_justify__:function(){const e=this._horizontal.getValue()?this._leftToRight.getValue():this._topToBottom.getValue();this.alignments[0]=this._justify.length>0?this.getAlignment(0,e):e?Ld.BEGIN:Ld.END;const t=this._horizontal.getValue()?this._topToBottom.getValue():this._leftToRight.getValue();this.alignments[1]=this._justify.length>1?this.getAlignment(1,t):t?Ld.FIRST:Ld.END},getMajorAlignment:function(){return this.alignments[0]},getMinorAlignment:function(){return this.alignments[1]},getAlignment:function(e,t){if(t)switch(this._justify[e]){case"FIRST":return Ld.FIRST;case"BEGIN":return Ld.BEGIN;case"MIDDLE":return Ld.MIDDLE;case"END":return Ld.END}else switch(this._justify[e]){case"FIRST":case"BEGIN":return Ld.END;case"MIDDLE":return Ld.MIDDLE;case"END":return Ld.BEGIN}return e?Ld.FIRST:Ld.BEGIN},getDefaultFont:function(e){const t=Ud[e];if(t)return t[this._style.getValue()]||t.PLAIN},loadNow:function(){const e=this._url.copy();e.push("SERIF"),this.familyStack.length=0;for(const t of e)this.familyStack.push(this.getDefaultFont(t)||t);this.loadNext()},loadNext:function(){try{if(0===this.familyStack.length)return this.setLoadState(s.FAILED_STATE),void(this.font=null);this.family=this.familyStack.shift(),this.URL=new URL(this.family,this.loader.getReferer()),"data:"!==this.URL.protocol&&(this.getBrowser().getBrowserOptions().getCache()&&this.getCache()||this.URL.searchParams.set("_",Date.now())),this.getBrowser().getFont(this.URL).done(this.setFont.bind(this)).fail(this.setError.bind(this))}catch(e){this.setError(e.message)}},setError:function(e){"data:"!==this.URL.protocol&&console.warn("Error loading font '"+decodeURI(this.URL.href)+"':",e),this.loadNext()},setFont:function(e){this.font=e,this.setLoadState(s.COMPLETE_STATE),this.addNodeEvent()},getFont:function(){return this.font},dispose:function(){xo.prototype.dispose.call(this),ji.prototype.dispose.call(this)}});const Xd=Bd;function kd(e,t){switch(arguments.length){case 0:return void(this.matrix=new et(0,0,0,0,0,0,0,0,0));case 2:return void(this.matrix=new et(e.x/2,0,0,0,e.y/2,0,t.x,t.y,1));case 3:{const e=arguments[0],t=arguments[1],n=(t.x-e.x)/2,i=(t.y-e.y)/2,o=(t.x+e.x)/2,r=(t.y+e.y)/2;return void(this.matrix=new et(n,0,0,0,i,0,o,r,1))}}}kd.prototype={constructor:kd,copy:function(){const e=Object.create(kd.prototype);return e.matrix=this.matrix.copy(),e},assign:function(e){return this.matrix.assign(e.matrix),this},equals:function(e){return this.matrix.equals(e.matrix)},set:function(e,t){const n=this.matrix;switch(arguments.length){case 0:return n[0]=.5,n[1]=0,n[2]=0,n[3]=0,n[4]=.5,n[5]=0,n[6]=0,n[7]=0,n[8]=0,this;case 2:return n[0]=e.x/2,n[1]=0,n[2]=0,n[3]=0,n[4]=e.y/2,n[5]=0,n[6]=t.x,n[7]=t.y,n[8]=1,this;case 3:{const e=arguments[0],t=arguments[1],n=(t.x-e.x)/2,i=(t.y-e.y)/2,o=(t.x+e.x)/2,r=(t.y+e.y)/2;return this.matrix.set(n,0,0,0,i,0,o,r,1),this}}},setExtents:function(e,t){const n=this.matrix,i=(t.x-e.x)/2,o=(t.y-e.y)/2,r=(t.x+e.x)/2,s=(t.y+e.y)/2;return n[0]=i,n[1]=0,n[2]=0,n[3]=0,n[4]=o,n[5]=0,n[6]=r,n[7]=s,n[8]=1,this},isEmpty:function(){return 0===this.matrix[8]},add:function(){const e=new ke(0,0),t=new ke(0,0),n=new ke(0,0),i=new ke(0,0);return function(o){return this.isEmpty()?this.assign(o):o.isEmpty()?this:(this.getExtents(e,t),o.getExtents(n,i),this.set(e.min(n),t.max(i),!0))}}(),multLeft:function(e){return this.matrix.multLeft(e),this},multRight:function(e){return this.matrix.multRight(e),this},getExtents:function(e,t){this.getAbsoluteExtents(e,t),e.add(this.center),t.add(this.center)},getAbsoluteExtents:function(){const e=new ke(0,0);return function(t,n){const i=this.matrix,o=i.xAxis,r=i.yAxis;e.assign(o).add(r);const s=r.subtract(o);t.assign(e).min(s),n.assign(e).max(s),e.negate(),s.negate(),t.min(e,s),n.max(e,s)}}(),containsPoint:function(){const e=new ke(0,0),t=new ke(0,0);return function(n){return this.getExtents(e,t),e.x<=n.x&&t.x>=n.x&&e.y<=n.y&&t.y>=n.y}}(),toString:function(){return this.size+", "+this.center}},Object.defineProperty(kd.prototype,"size",{get:function(){const e=new ke(0,0),t=new ke(0,0);return function(){return this.getAbsoluteExtents(e,t),t.subtract(e)}}(),enumerable:!0,configurable:!1}),Object.defineProperty(kd.prototype,"center",{get:function(){return this.matrix.origin},enumerable:!0,configurable:!1});const zd=kd;var jd=new zd,Gd=new zd,Hd=new ke(0,0),qd=new ke(0,0),Wd=new ke(0,0),Yd=new ke(0,0),Kd=new He(0,0,0),Zd=new He(0,0,0),Qd=new ke(0,0),$d=new ke(0,0),Jd=new ke(0,0),ep=new ke(0,0),tp=new ke(0,0),np=new He(0,0,0),ip=new ke(0,0),op=new zd,rp=new ke(0,0),sp=new He(0,0,0);function ap(e,t){this.browser=e.getBrowser(),this.text=e,this.fontStyle=t,this.glyphs=[],this.minorAlignment=new ke(0,0),this.translations=[],this.charSpacings=[],this.bearing=new ke(0,0),this.yPad=[],this.bbox=new hr}ap.prototype={constructor:ap,getBrowser:function(){return this.browser},getText:function(){return this.text},getFontStyle:function(){return this.fontStyle},getGlyphs:function(){return this.glyphs},getMinorAlignment:function(){return this.minorAlignment},getTranslations:function(){return this.translations},getCharSpacings:function(){return this.charSpacings},getBearing:function(){return this.bearing},getBBox:function(){return this.bbox},update:function(){var e=this.text,t=this.fontStyle,n=e._string.length;if(e._lineBounds.length=n,this.glyphs.length=0,0===n||!t.getFont())return e._origin.setValue(sp),e._textBounds.setValue(rp),void this.bbox.set();if(t._horizontal.getValue())this.resizeArray(this.translations,n),this.resizeArray(this.charSpacings,n),this.horizontal(e,t);else{for(var i=e._string,o=0,r=0,s=i.length;r<s;++r)o+=i[r].length;this.resizeArray(this.translations,o),this.resizeArray(this.charSpacings,o),this.vertical(e,t)}},resizeArray:function(e,t){for(var n=e.length;n<t;++n)e.push(new ke(0,0));e.length=t},horizontal:function(e,t){var n=t.getFont(),i=e._string,o=i.length,r=Math.max(0,e._maxExtent.getValue()),s=t._topToBottom.getValue(),a=t.getScale(),u=t._spacing.getValue();jd.set();for(var l=s?o:-1,c=s?1:-1,h=s?0:o-1,d=0;h!==l;h+=c,++d){var p=i[h],f=this.getHorizontalLineExtents(t,p,Hd,qd,d);Qd.assign(qd).subtract(Hd);var g=0,m=e.getLength(h);switch(tp.set(Qd.x*a,0==d?qd.y-n.descender/n.unitsPerEm*a:u),r&&(m=m?Math.min(r,m):Math.min(r,Qd.x*a)),m&&(g=(m-tp.x)/(f.length-1),tp.x=m,Qd.x=m/a),this.charSpacings[d]=g,e._lineBounds[h]=tp,t.getMajorAlignment()){case Ld.BEGIN:case Ld.FIRST:this.translations[d].set(0,-d*u);break;case Ld.MIDDLE:this.translations[d].set(-Hd.x-Qd.x/2,-d*u);break;case Ld.END:this.translations[d].set(-Hd.x-Qd.x,-d*u)}this.translations[d].multiply(a),$d.assign(Hd).add(Jd.assign(Qd).divide(2)),jd.add(op.set(Qd.multiply(a),$d.multiply(a).add(this.translations[d])))}switch(jd.getExtents(Hd,qd),Qd.assign(qd).subtract(Hd),e._textBounds=Qd,this.bearing.set(0,-qd.y),t.getMinorAlignment()){case Ld.BEGIN:this.minorAlignment.assign(this.bearing);break;case Ld.FIRST:this.minorAlignment.set(0,0);break;case Ld.MIDDLE:this.minorAlignment.set(0,Qd.y/2-qd.y);break;case Ld.END:this.minorAlignment.set(0,(o-1)*u*a)}Hd.add(this.minorAlignment),qd.add(this.minorAlignment),e._origin.setValue(np.set(Hd.x,qd.y,0)),this.bbox.setExtents(Kd.set(Hd.x,Hd.y,0),Zd.set(qd.x,qd.y,0))},vertical:function(e,t){var n=t.getFont(),i=e._string,o=i.length,r=Math.max(0,e._maxExtent.getValue()),s=t._leftToRight.getValue(),a=t._topToBottom.getValue(),u=t.getScale(),l=t._spacing.getValue(),c=this.yPad,h=this.getBrowser().getBrowserOptions().getPrimitiveQuality();jd.set();for(var d=s?o:-1,p=s?1:-1,f=0,g=s?0:o-1;g!==d;g+=p){var m=this.stringToGlyphs(n,i[g],!0,g),_=f,y=m.length;Gd.set();for(var x=a?y:-1,w=a?1:-1,v=a?0:y-1;v!==x;v+=w,++f){var b=m[v];this.getGlyphExtents(n,b,h,Hd,qd),Qd.assign(qd).subtract(Hd);var S=a?v:y-v-1;this.translations[f].set((l-Qd.x-Hd.x)/2,-S),$d.assign(Hd).add(Jd.assign(Qd).divide(2)).add(this.translations[f]),Gd.add(op.set(Qd,$d))}Gd.getExtents(Hd,qd),Qd.assign(qd).subtract(Hd);var T=s?g:o-g-1,E=(l-Qd.x)/2,C=0,O=e.getLength(g);switch(tp.set(0===g?l-E:l,y?Qd.y:0).multiply(u),r&&(O=O?Math.min(r,O):Math.min(r,Qd.y*u)),O&&(C=(O-tp.y)/(m.length-1)/u,tp.y=O,Qd.y=O/u,Hd.y=qd.y-Qd.y),e._lineBounds[g]=tp,t.getMajorAlignment()){case Ld.BEGIN:case Ld.FIRST:ep.set(T*l,-1);break;case Ld.MIDDLE:ep.set(T*l,Qd.y/2-qd.y);break;case Ld.END:y&&this.getGlyphExtents(n,m[a?y-1:0],h,Wd.assign(ke.Zero),ip),ep.set(T*l,Qd.y-qd.y+Wd.y)}for(var N=0,F=_;F<f;++F)this.translations[F].add(ep),this.translations[F].y-=N,this.translations[F].multiply(u),N+=C;switch(t.getMajorAlignment()){case Ld.BEGIN:case Ld.FIRST:c[g]=qd.y+ep.y;break;case Ld.MIDDLE:c[g]=0;break;case Ld.END:c[g]=Hd.y+ep.y}$d.assign(Hd).add(Jd.assign(Qd).divide(2)),jd.add(op.set(Qd.multiply(u),$d.add(ep).multiply(u)))}switch(jd.getExtents(Hd,qd),Qd.assign(qd).subtract(Hd),t.getMajorAlignment()){case Ld.BEGIN:case Ld.FIRST:var M=0;for(O=(D=e._lineBounds).length;M<O;++M)D[M].y+=qd.y-c[M]*u;break;case Ld.MIDDLE:break;case Ld.END:var D;for(M=0,O=(D=e._lineBounds).length;M<O;++M)D[M].y+=c[M]*u-Hd.y}switch(e._textBounds=Qd,t.getMajorAlignment()){case Ld.BEGIN:case Ld.FIRST:this.bearing.set(-Hd.x,qd.y);break;case Ld.MIDDLE:this.bearing.set(-Hd.x,0);break;case Ld.END:this.bearing.set(-Hd.x,Hd.y)}switch(t.getMinorAlignment()){case Ld.BEGIN:case Ld.FIRST:this.minorAlignment.set(-Hd.x,0);break;case Ld.MIDDLE:this.minorAlignment.set(-Hd.x-Qd.x/2,0);break;case Ld.END:this.minorAlignment.set(-Hd.x-Qd.x,0)}Hd.add(this.minorAlignment),qd.add(this.minorAlignment),e._origin.setValue(np.set(Hd.x,qd.y,0)),this.bbox.set(Kd.set(Hd.x,Hd.y,0),Zd.set(qd.x,qd.y,0),!0)},stringToGlyphs:function(e,t,n,i){var o=this.glyphs[i];o||(o=this.glyphs[i]=[]),o.length=t.length;for(var r=n?0:t.length-1,s=n?t.length:-1,a=n?1:-1,u=r,l=0;u!==s;u+=a,++l)o[l]=e.charToGlyph(t[u]);return o},getHorizontalLineExtents:function(e,t,n,i,o){for(var r=e.getFont(),s=e._horizontal.getValue()?e._leftToRight.getValue():e._topToBottom.getValue(),a=this.stringToGlyphs(r,t,s,o),u=this.getBrowser().getBrowserOptions().getPrimitiveQuality(),l=0,c=0,h=Number.POSITIVE_INFINITY,d=Number.NEGATIVE_INFINITY,p=0,f=a.length;p<f;++p){var g=a[p],m=p+1<f?r.getKerningValue(g,a[p+1]):0;this.getGlyphExtents(r,g,u,Wd,Yd),c+=g.advanceWidth+m,h=Math.min(h,Wd.y),d=Math.max(d,Yd.y)}switch(a.length?(this.getGlyphExtents(r,a[0],u,Wd,Yd),l=Wd.x):(h=0,d=0),n.set(l,h),i.set(c/r.unitsPerEm,d),e.getMajorAlignment()){case Ld.BEGIN:case Ld.FIRST:n.x=0}return a},traverse:function(e,t){}};const up=ap,lp=ee.lerp;function cp(e,t,n,i,o,r,s,a){this.x0=e,this.y0=t,this.x1=n,this.y1=i,this.x2=o,this.y2=r,this.x3=s,this.y3=a,this.order=arguments.length/2-1}function hp(e,t,n,i,o,r,s){const a=lp(e,n,s),u=lp(t,i,s),l=lp(n,o,s),c=lp(i,r,s);return{x:lp(a,l,s),y:lp(u,c,s)}}function dp(e,t,n,i,o,r,s,a,u){const l=lp(e,n,u),c=lp(t,i,u),h=lp(n,o,u),d=lp(i,r,u),p=lp(o,s,u),f=lp(r,a,u),g=lp(l,h,u),m=lp(c,d,u),_=lp(h,p,u),y=lp(d,f,u);return{x:lp(g,_,u),y:lp(m,y,u)}}cp.prototype={getLUT:function(e){const t=this.x0,n=this.y0,i=this.x1,o=this.y1,r=this.x2,s=this.y2,a=this.x3,u=this.y3,l=[];switch(this.order){case 2:for(let a=0,u=e-1;a<e;++a)l.push(hp(t,n,i,o,r,s,a/u));break;case 3:for(let c=0,h=e-1;c<e;++c)l.push(dp(t,n,i,o,r,s,a,u,c/h))}return l}};const pp=cp;function fp(e,t){up.call(this,e,t),e._transparent=!1,this.texCoordArray=Wr.createArray()}fp.prototype=Object.assign(Object.create(up.prototype),{constructor:fp,getTransparent:function(){return!1},getMatrix:function(){return Nt.Identity},build:function(){var e=new He(0,0,0),t=new He(0,0,0);return function(){var n=this.getFontStyle(),i=n.getFont();if(i){var o=this.getText(),r=this.getGlyphs(),s=this.getMinorAlignment(),a=this.getTranslations(),u=this.getCharSpacings(),l=n.getScale(),c=n._spacing.getValue(),h=o._origin.getValue(),d=l/i.unitsPerEm,p=this.getBrowser().getBrowserOptions().getPrimitiveQuality(),f=this.texCoordArray,g=o.getNormals(),m=o.getVertices();if(o.getMultiTexCoords().push(f),this.getBBox().getExtents(e,t),o.getMin().assign(e),o.getMax().assign(t),n._horizontal.getValue())for(var _=0,y=r.length;_<y;++_)for(var x=r[_],w=u[_],v=a[_],b=0,S=0,T=x.length;S<T;++S){for(var E=x[S],C=this.getGlyphGeometry(i,E,p),O=s.x+v.x+b+S*w,N=s.y+v.y,F=0,M=C.length;F<M;++F){var D=C[F].x*l+O,I=C[F].y*l+N;f.push((D-h.x)/c,(I-h.y)/c,0,1),g.push(0,0,1),m.push(D,I,0,1)}var R=0;S+1<x.length&&(R=i.getKerningValue(E,x[S+1])),b+=(E.advanceWidth+R)*d}else for(var V=n._leftToRight.getValue(),P=n._topToBottom.getValue(),A=V?0:o._string.length-1,L=V?o._string.length:-1,U=V?1:-1,B=(_=A,0);_!==L;_+=U){var X=(x=r[_]).length,k=P?X:-1,z=P?1:-1;for(S=P?0:X-1;S!==k;S+=z,++B)for(v=a[B],F=0,M=(C=this.getGlyphGeometry(i,x[S],p)).length;F<M;++F){D=C[F].x*l+s.x+v.x,I=C[F].y*l+s.y+v.y;f.push((D-h.x)/c,(I-h.y)/c,0,1),g.push(0,0,1),m.push(D,I,0,1)}}}}}(),getGlyphExtents:function(e,t,n,i,o){var r=this.getBrowser().getGlyph(e,n,t.index);if(s=r.extents)return i.assign(s.min),void o.assign(s.max);var s,a=this.getGlyphGeometry(e,t,n);if(a.length){var u=a[0];i.assign(u),o.assign(u);for(var l=1,c=a.length;l<c;++l){u=a[l];i.min(u),o.max(u)}}else i.set(0,0,0),o.set(0,0,0);(s=r.extents={}).min=i.copy(),s.max=o.copy()},getGlyphGeometry:function(e,t,n){var i=this.getBrowser().getGlyph(e,n,t.index),o=i.geometry;return o||(o=i.geometry=[],this.createGlyphGeometry(t,o,n),o)},createGlyphGeometry:function(){var e=[],t=[],n=new He(0,0,0);return function(i,o,r){var s=this.getBezierDimension(r),a=i.getPath(0,0,1).commands,u=0,l=0;e.length=0,t.length=0;for(var c=0,h=a.length;c<h;++c){var d=a[c];switch(d.type){case"M":case"Z":e.length>2&&(e[0].x===e.at(-1).x&&e[0].y===e.at(-1).y&&e.pop(),t.push(e)),e=[],"M"===d.type&&e.push(new He(d.x,-d.y,0));break;case"L":e.push(new He(d.x,-d.y,0));break;case"Q":for(var p=1,f=(g=new pp(u,-l,d.x1,-d.y1,d.x,-d.y).getLUT(s)).length;p<f;++p)e.push(new He(g[p].x,g[p].y,0));break;case"C":var g;for(p=1,f=(g=new pp(u,-l,d.x1,-d.y1,d.x2,-d.y2,d.x,-d.y).getLUT(s)).length;p<f;++p)e.push(new He(g[p].x,g[p].y,0));break;default:continue}u=d.x,l=d.y}t=t.map((function(e){return Yo.getPolygonNormal(e,n),n.dot(He.zAxis)>0?e:e.reverse()})),t.push(o),Yo.triangulatePolygon.apply(Yo,t)}}(),getBezierDimension:function(e){switch(e){case pi.LOW:return 3;case pi.HIGH:return 7;default:return 5}},display:function(e,t){},transformLine:function(e){},transformMatrix:function(e){}});const gp=fp;function mp(e){Xd.call(this,e),this.addType(s.FontStyle),this._size.setUnit("length")}mp.prototype=Object.assign(Object.create(Xd.prototype),{constructor:mp,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new P([new N(s.inputOutput,"metadata",new Bn.SFNode),new N(s.inputOutput,"language",new Bn.SFString),new N(s.inputOutput,"family",new Bn.MFString("SERIF")),new N(s.inputOutput,"style",new Bn.SFString("PLAIN")),new N(s.inputOutput,"size",new Bn.SFFloat(1)),new N(s.inputOutput,"spacing",new Bn.SFFloat(1)),new N(s.inputOutput,"horizontal",new Bn.SFBool(!0)),new N(s.inputOutput,"leftToRight",new Bn.SFBool(!0)),new N(s.inputOutput,"topToBottom",new Bn.SFBool(!0)),new N(s.inputOutput,"justify",new Bn.MFString("BEGIN"))]),getTypeName:function(){return"FontStyle"},getComponentName:function(){return"Text"},getContainerField:function(){return"fontStyle"},getTextGeometry:function(e){return new gp(e,this)},getScale:function(){return this._size.getValue()}});const _p=mp;var yp=i(755),xp=i(440);const wp=Symbol(),vp=Symbol(),bp=Symbol();function Sp(){this[vp]=new Map,this[bp]=new Map}Sp.prototype={initialize:function(){},getDefaultFontStyle:function(){return this[wp]=new _p(this.getPrivateScene()),this[wp].setPrivate(!0),this[wp].setup(),this.getDefaultFontStyle=function(){return this[wp]},Object.defineProperty(this,"getDefaultFontStyle",{enumerable:!1}),this[wp]},getFont:function(e){e=e.toString();let t=this[vp].get(e);return void 0===t&&(this[vp].set(e,t=yp.Deferred()),xp.load(e,this.setFont.bind(this,t))),t},setFont:function(e,t,n){t?e.reject(t):e.resolve(n)},getGlyph:function(e,t,n){let i=this[bp].get(e);i||this[bp].set(e,i=[]);let o=i[t];o||(o=i[t]=[]);let r=o[n];return r||(r=o[n]={}),r}};const Tp=Sp;function Ep(e){os.call(this,e),this.addType(s.X3DTextureTransformNode)}Ep.prototype=Object.assign(Object.create(os.prototype),{constructor:Ep});const Cp=Ep;function Op(e){Cp.call(this,e),this.addType(s.X3DSingleTextureTransformNode),this.matrixArray=new Float32Array(Nt.Identity)}Op.prototype=Object.assign(Object.create(Cp.prototype),{constructor:Op,getCount:function(){return 1},setMatrix:function(e){this.matrixArray.set(e)},getTextureTransformMapping:function(e,t=0){this._mapping.getValue()&&e.set(this._mapping.getValue(),t)},setShaderUniforms:function(e,t){for(let n=0,i=t.x3d_MaxTextures;n<i;++n)this.setShaderUniformsToChannel(e,t,n)},setShaderUniformsToChannel:function(e,t,n=0){e.uniformMatrix4fv(t.x3d_TextureMatrix[n],!1,this.matrixArray)}});const Np=Op;function Fp(e){Np.call(this,e),this.addType(s.TextureTransform),this._rotation.setUnit("angle"),this.matrix=new Nt}Fp.prototype=Object.assign(Object.create(Np.prototype),{constructor:Fp,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new P([new N(s.inputOutput,"metadata",new Bn.SFNode),new N(s.inputOutput,"mapping",new Bn.SFString),new N(s.inputOutput,"translation",new Bn.SFVec2f),new N(s.inputOutput,"rotation",new Bn.SFFloat),new N(s.inputOutput,"scale",new Bn.SFVec2f(1,1)),new N(s.inputOutput,"center",new Bn.SFVec2f)]),getTypeName:function(){return"TextureTransform"},getComponentName:function(){return"Texturing"},getContainerField:function(){return"textureTransform"},initialize:function(){Np.prototype.initialize.call(this),this.addInterest("eventsProcessed",this),this.eventsProcessed()},getMatrix:function(){return this.matrix},eventsProcessed:function(){const e=new ke(0,0),t=new et;return function(){const n=this._translation.getValue(),i=this._rotation.getValue(),o=this._scale.getValue(),r=this._center.getValue(),s=this.matrix;t.identity(),r.equals(ke.Zero)||t.translate(e.assign(r).negate()),o.equals(ke.One)||t.scale(o),0!==i&&t.rotate(i),r.equals(ke.Zero)||t.translate(r),n.equals(ke.Zero)||t.translate(n),s[0]=t[0],s[1]=t[1],s[4]=t[3],s[5]=t[4],s[12]=t[6],s[13]=t[7],this.setMatrix(s)}}()});const Mp=Fp,Dp=Symbol(),Ip=Symbol(),Rp=Symbol(),Vp=Symbol(),Pp=Symbol(),Ap=Symbol(),Lp=Symbol(),Up=Symbol(),Bp=Symbol(),Xp=Symbol(),kp=Symbol(),zp=Symbol(),jp=Symbol(),Gp=Symbol(),Hp=Symbol(),qp=Symbol(),Wp=Symbol();function Yp(){const e=this.getContext(),t=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS);this[Dp]=t>8?2:1}Yp.prototype={initialize:function(){const e=this.getContext();e.pixelStorei(e.UNPACK_ALIGNMENT,1),this[Ip]=e.getParameter(e.MAX_TEXTURE_SIZE),this[Rp]=e.getParameter(e.MAX_COMBINED_TEXTURE_IMAGE_UNITS),this[Vp]=NaN,this[Pp]=[...Array(this[Rp]).keys()],this[Ap]=[this[Pp].pop()],this[Lp]=[this[Pp].pop()],this[Up]=[this[Pp].pop()];const t=new Uint8Array([255,255,255,255]);this[zp]=e.createTexture(),e.activeTexture(e.TEXTURE0+this[Ap][0]),e.bindTexture(e.TEXTURE_2D,this[zp]),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,1,1,0,e.RGBA,e.UNSIGNED_BYTE,t),e.getVersion()>=2&&(this[jp]=e.createTexture(),e.activeTexture(e.TEXTURE0+this[Lp][0]),e.bindTexture(e.TEXTURE_3D,this[jp]),e.texImage3D(e.TEXTURE_3D,0,e.RGBA,1,1,1,0,e.RGBA,e.UNSIGNED_BYTE,t)),this[Gp]=e.createTexture(),e.activeTexture(e.TEXTURE0+this[Up][0]),e.bindTexture(e.TEXTURE_CUBE_MAP,this[Gp]),e.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_Z,0,e.RGBA,1,1,0,e.RGBA,e.UNSIGNED_BYTE,t),e.texImage2D(e.TEXTURE_CUBE_MAP_NEGATIVE_Z,0,e.RGBA,1,1,0,e.RGBA,e.UNSIGNED_BYTE,t),e.texImage2D(e.TEXTURE_CUBE_MAP_NEGATIVE_X,0,e.RGBA,1,1,0,e.RGBA,e.UNSIGNED_BYTE,t),e.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X,0,e.RGBA,1,1,0,e.RGBA,e.UNSIGNED_BYTE,t),e.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_Y,0,e.RGBA,1,1,0,e.RGBA,e.UNSIGNED_BYTE,t),e.texImage2D(e.TEXTURE_CUBE_MAP_NEGATIVE_Y,0,e.RGBA,1,1,0,e.RGBA,e.UNSIGNED_BYTE,t),this.resetTextureUnits(),this.setTextureQuality(this.getBrowserOptions().getTextureQuality())},getMaxTextures:function(){return this[Dp]},getMinTextureSize:function(){return 16},getMaxTextureSize:function(){return this[Ip]},getMaxCombinedTextureUnits:function(){return this[Rp]},popTexture2DUnit:function(){return this[Bp]>0?(--this[Bp],this[Ap].pop()):this[Pp].pop()},pushTexture2DUnit:function(e){void 0!==e&&(++this[Bp],this[Ap].push(e))},getTexture2DUnit:function(){if(this[Bp]>0)return this[Ap][--this[Bp]];const e=this[Pp].pop();return void 0!==e&&this[Ap].push(e),e},getTexture3DUnit:function(){if(this[Xp]>0)return this[Lp][--this[Xp]];const e=this[Pp].pop();return void 0!==e&&this[Lp].push(e),e},getTextureCubeUnit:function(){if(this[kp]>0)return this[Up][--this[kp]];const e=this[Pp].pop();return void 0!==e&&this[Up].push(e),e},getTextureUnit:function(e){switch(e){case 2:return this.getTexture2DUnit();case 3:return this.getTexture3DUnit();case 4:return this.getTextureCubeUnit()}},resetTextureUnits:function(){this[Bp]=this[Ap].length,this[Xp]=this[Lp].length,this[kp]=this[Up].length},getDefaultTexture2DUnit:function(){return this[Ap][0]},getDefaultTexture3DUnit:function(){return this[Lp][0]},getDefaultTextureCubeUnit:function(){return this[Up][0]},getTextureMemory:function(){return this[Vp]},getDefaultTextureProperties:function(){return this[Hp]=new Du(this.getPrivateScene()),this[Hp]._magnificationFilter="NICEST",this[Hp]._minificationFilter="NEAREST_PIXEL_AVG_MIPMAP",this[Hp]._textureCompression="NICEST",this[Hp]._generateMipMaps=!0,this[Hp].setup(),this.getDefaultTextureProperties=function(){return this[Hp]},Object.defineProperty(this,"getDefaultTextureProperties",{enumerable:!1}),this[Hp]},getDefaultTextureTransform:function(){return this[qp]=new Mp(this.getPrivateScene()),this[qp].setPrivate(!0),this[qp].setup(),this.getDefaultTextureTransform=function(){return this[qp]},Object.defineProperty(this,"getDefaultTextureTransform",{enumerable:!1}),this[qp]},getDefaultTextureCoordinate:function(){return this[Wp]=new Zu(this.getPrivateScene()),this[Wp].setPrivate(!0),this[Wp].setup(),this.getDefaultTextureCoordinate=function(){return this[Wp]},Object.defineProperty(this,"getDefaultTextureCoordinate",{enumerable:!1}),this[Wp]},setTextureQuality:function(e){const t=this.getDefaultTextureProperties();switch(e){case _i.LOW:t._magnificationFilter="AVG_PIXEL",t._minificationFilter="AVG_PIXEL",t._textureCompression="FASTEST",t._generateMipMaps=!0;break;case _i.MEDIUM:t._magnificationFilter="NICEST",t._minificationFilter="NEAREST_PIXEL_AVG_MIPMAP",t._textureCompression="NICEST",t._generateMipMaps=!0;break;case _i.HIGH:t._magnificationFilter="NICEST",t._minificationFilter="NICEST",t._textureCompression="NICEST",t._generateMipMaps=!0}}};const Kp=Yp,Zp=Symbol(),Qp=Symbol(),$p=Symbol(),Jp=Symbol();function ef(){this[Zp]=0,this[Qp]=60,this[$p]=new He(0,0,0),this[Jp]=0}ef.prototype={initialize:function(){this.advanceTime()},getCurrentTime:function(){return this[Zp]},getCurrentFrameRate:function(){return this[Qp]},getCurrentSpeed:function(){return this[Jp]},advanceTime:function(){const e=new He(0,0,0);return function(){const t=Date.now()/1e3,n=t-this[Zp];if(this[Zp]=t,this[Qp]=n?1/n:60,this.getWorld()&&this.getActiveLayer()){const t=this.getActiveLayer().getViewpoint().getCameraSpaceMatrix();e.assign(this[$p]),this[$p].set(t[12],t[13],t[14]),this[Jp]=e.subtract(this[$p]).magnitude()*this[Qp]}else this[Jp]=0}}()};const tf=ef,nf=Symbol(),of=Symbol(),rf=Symbol(),sf=Symbol();function af(){this[nf]=[],this[of]=[],this[rf]=[],this[sf]=[]}af.prototype={constructor:af,initialize:function(){},addTaintedField:function(e,t){this[nf].push(e,t)},addTaintedNode:function(e){this[rf].push(e)},[Symbol.for("X_ITE.X3DRoutingContext.processEvents")]:function(){do{do{const e=this[nf];this[nf]=this[of],this[nf].length=0;for(let t=0,n=e.length;t<n;t+=2)e[t].processEvent(e[t+1]);this[of]=e}while(this[nf].length);do{const e=this[rf];this[rf]=this[sf],this[rf].length=0;for(const t of e)t.processEvents();this[sf]=e}while(!this[nf].length&&this[rf].length)}while(this[nf].length)}};const uf=af;var lf=i(755);const cf=Symbol(),hf=Symbol(),df=Symbol(),pf=Symbol(),ff=Symbol(),gf=Symbol(),mf=Symbol(),_f=Symbol(),yf=Symbol(),xf=Symbol(),wf=Symbol(),vf=Symbol(),bf=Symbol.for("X_ITE.X3DRoutingContext.processEvents"),Sf=[];function Tf(e){Jn.call(this,this),uf.call(this),Fu.call(this,e),Ih.call(this),Yc.call(this),Kp.call(this),pd.call(this),Fh.call(this),Rd.call(this),Ml.call(this),al.call(this),vh.call(this),Bc.call(this),Al.call(this),Vu.call(this),Xl.call(this),th.call(this),Pd.call(this),Tp.call(this),tf.call(this);for(const e of Sf)e.call(this);this.addChildObjects("initialized",new $t,"shutdown",new $t,"prepareEvents",new $t,"timeEvents",new $t,"sensorEvents",new $t,"finished",new $t),this[hf]=0,this[gf]=0,this[ff]=this[pf].bind(this),this[mf]=0,this[_f]=0,this[yf]=0,this[xf]=0,this[wf]=0,this[vf]=0}Tf.prototype=Object.assign(Object.create(Jn.prototype),Fu.prototype,Vu.prototype,al.prototype,Ml.prototype,Al.prototype,Xl.prototype,Bc.prototype,Yc.prototype,th.prototype,vh.prototype,Fh.prototype,uf.prototype,Ih.prototype,pd.prototype,Rd.prototype,Pd.prototype,Tp.prototype,Kp.prototype,tf.prototype,{constructor:Tf,initialize:function(){Jn.prototype.initialize.call(this),uf.prototype.initialize.call(this),Fu.prototype.initialize.call(this),Ih.prototype.initialize.call(this),Yc.prototype.initialize.call(this),Kp.prototype.initialize.call(this),pd.prototype.initialize.call(this),Fh.prototype.initialize.call(this),Rd.prototype.initialize.call(this),Ml.prototype.initialize.call(this),al.prototype.initialize.call(this),vh.prototype.initialize.call(this),Bc.prototype.initialize.call(this),Al.prototype.initialize.call(this),Vu.prototype.initialize.call(this),Xl.prototype.initialize.call(this),th.prototype.initialize.call(this),Pd.prototype.initialize.call(this),Tp.prototype.initialize.call(this),tf.prototype.initialize.call(this);for(const e of Sf)"function"==typeof e.prototype.initialize&&e.prototype.initialize.call(this);this[bf]()},initialized:function(){return this._initialized},shutdown:function(){return this._shutdown},prepareEvents:function(){return this._prepareEvents},timeEvents:function(){return this._timeEvents},sensorEvents:function(){return this._sensorEvents},finished:function(){return this._finished},getBrowser:function(){return this},getWorld:function(){return this[cf]},setExecutionContext:function(e){this[cf]=new Ws(e),this[cf].setup()},getExecutionContext:function(){return this[cf].getExecutionContext()},addBrowserEvent:function(){this[hf]!==this.getCurrentTime()&&(this[hf]=this.getCurrentTime(),requestAnimationFrame(this[ff]))},[df]:function(e){return e===this[gf]?(requestAnimationFrame(this[ff]),!0):(this[gf]=e,!1)},[pf]:function(e){if(this[df](e))return;const t=this.getContext(),n=Date.now();this[mf]=n-this[_f],this.advanceTime(),this._prepareEvents.processInterests(),this[bf](),this._timeEvents.processInterests(),this[bf]();const i=Date.now();this[cf].traverse(sr.CAMERA,null),this[xf]=Date.now()-i;const o=Date.now();this.getCollisionCount()&&this[cf].traverse(sr.COLLISION,null),this[wf]=Date.now()-o,this._sensorEvents.processInterests(),this[bf]();const r=Date.now();t.clearColor(0,0,0,0),t.clear(t.COLOR_BUFFER_BIT),this[cf].traverse(sr.DISPLAY,null),this[vf]=Date.now()-r,this[yf]=Date.now()-n,this[_f]=Date.now(),this._finished.processInterests()},getSystemTime:function(){return this[mf]},getBrowserTime:function(){return this[yf]},getCameraTime:function(){return this[xf]},getCollisionTime:function(){return this[wf]},getDisplayTime:function(){return this[vf]}});for(const e of Reflect.ownKeys(Tf.prototype))Object.defineProperty(Tf.prototype,e,{enumerable:!1});Object.assign(Tf,{addBrowserContext:function(e){Sf.push(e);for(const t of Object.keys(e.prototype).concat(Object.getOwnPropertySymbols(e.prototype)))["initialize","dispose"].includes(t)||Object.defineProperty(Tf.prototype,t,{value:e.prototype[t],enumerable:!1,writable:!0});lf("x3d-canvas, X3DCanvas").each((function(t,n){const i=window[Symbol.for("X_ITE.X3D-8.0.0a")].getBrowser(n);e.call(i),"function"==typeof e.prototype.initialize&&e.prototype.initialize.call(i),i[bf]()}))}});const Ef=Tf;function Cf(e){this.addType(s.X3DMetadataObject)}Cf.prototype={constructor:Cf,initialize:function(){},dispose:function(){}};const Of=Cf;function Nf(e){ji.call(this,e),Of.call(this,e),this.addType(s.MetadataBoolean)}Nf.prototype=Object.assign(Object.create(ji.prototype),Of.prototype,{constructor:Nf,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new P([new N(s.inputOutput,"metadata",new Bn.SFNode),new N(s.inputOutput,"name",new Bn.SFString),new N(s.inputOutput,"reference",new Bn.SFString),new N(s.inputOutput,"value",new Bn.MFBool)]),getTypeName:function(){return"MetadataBoolean"},getComponentName:function(){return"Core"},getContainerField:function(){return"metadata"},initialize:function(){ji.prototype.initialize.call(),Of.prototype.initialize.call()},dispose:function(){Of.prototype.dispose.call(),ji.prototype.dispose.call()}});const Ff=Nf;function Mf(e){ji.call(this,e),Of.call(this,e),this.addType(s.MetadataDouble)}Mf.prototype=Object.assign(Object.create(ji.prototype),Of.prototype,{constructor:Mf,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new P([new N(s.inputOutput,"metadata",new Bn.SFNode),new N(s.inputOutput,"name",new Bn.SFString),new N(s.inputOutput,"reference",new Bn.SFString),new N(s.inputOutput,"value",new Bn.MFDouble)]),getTypeName:function(){return"MetadataDouble"},getComponentName:function(){return"Core"},getContainerField:function(){return"metadata"},initialize:function(){ji.prototype.initialize.call(),Of.prototype.initialize.call()},dispose:function(){Of.prototype.dispose.call(),ji.prototype.dispose.call()}});const Df=Mf;function If(e){ji.call(this,e),Of.call(this,e),this.addType(s.MetadataFloat)}If.prototype=Object.assign(Object.create(ji.prototype),Of.prototype,{constructor:If,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new P([new N(s.inputOutput,"metadata",new Bn.SFNode),new N(s.inputOutput,"name",new Bn.SFString),new N(s.inputOutput,"reference",new Bn.SFString),new N(s.inputOutput,"value",new Bn.MFFloat)]),getTypeName:function(){return"MetadataFloat"},getComponentName:function(){return"Core"},getContainerField:function(){return"metadata"},initialize:function(){ji.prototype.initialize.call(),Of.prototype.initialize.call()},dispose:function(){Of.prototype.dispose.call(),ji.prototype.dispose.call()}});const Rf=If;function Vf(e){ji.call(this,e),Of.call(this,e),this.addType(s.MetadataInteger)}Vf.prototype=Object.assign(Object.create(ji.prototype),Of.prototype,{constructor:Vf,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new P([new N(s.inputOutput,"metadata",new Bn.SFNode),new N(s.inputOutput,"name",new Bn.SFString),new N(s.inputOutput,"reference",new Bn.SFString),new N(s.inputOutput,"value",new Bn.MFInt32)]),getTypeName:function(){return"MetadataInteger"},getComponentName:function(){return"Core"},getContainerField:function(){return"metadata"},initialize:function(){ji.prototype.initialize.call(),Of.prototype.initialize.call()},dispose:function(){Of.prototype.dispose.call(),ji.prototype.dispose.call()}});const Pf=Vf;function Af(e){ji.call(this,e),Of.call(this,e),this.addType(s.MetadataSet)}Af.prototype=Object.assign(Object.create(ji.prototype),Of.prototype,{constructor:Af,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new P([new N(s.inputOutput,"metadata",new Bn.SFNode),new N(s.inputOutput,"name",new Bn.SFString),new N(s.inputOutput,"reference",new Bn.SFString),new N(s.inputOutput,"value",new Bn.MFNode)]),getTypeName:function(){return"MetadataSet"},getComponentName:function(){return"Core"},getContainerField:function(){return"metadata"},initialize:function(){ji.prototype.initialize.call(),Of.prototype.initialize.call()},dispose:function(){Of.prototype.dispose.call(),ji.prototype.dispose.call()}});const Lf=Af;function Uf(e){ji.call(this,e),Of.call(this,e),this.addType(s.MetadataString)}Uf.prototype=Object.assign(Object.create(ji.prototype),Of.prototype,{constructor:Uf,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new P([new N(s.inputOutput,"metadata",new Bn.SFNode),new N(s.inputOutput,"name",new Bn.SFString),new N(s.inputOutput,"reference",new Bn.SFString),new N(s.inputOutput,"value",new Bn.MFString)]),getTypeName:function(){return"MetadataString"},getComponentName:function(){return"Core"},getContainerField:function(){return"metadata"},initialize:function(){ji.prototype.initialize.call(),Of.prototype.initialize.call()},dispose:function(){Of.prototype.dispose.call(),ji.prototype.dispose.call()}});const Bf=Uf;function Xf(e){yr.call(this,e),this.addType(s.X3DInfoNode)}Xf.prototype=Object.assign(Object.create(yr.prototype),{constructor:Xf});const kf=Xf;function zf(e){kf.call(this,e),this.addType(s.WorldInfo)}zf.prototype=Object.assign(Object.create(kf.prototype),{constructor:zf,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new P([new N(s.inputOutput,"metadata",new Bn.SFNode),new N(s.inputOutput,"title",new Bn.SFString),new N(s.inputOutput,"info",new Bn.MFString)]),getTypeName:function(){return"WorldInfo"},getComponentName:function(){return"Core"},getContainerField:function(){return"children"},initialize:function(){kf.prototype.initialize.call(this),this.getExecutionContext().addWorldInfo(this)},dispose:function(){this.getExecutionContext().removeWorldInfo(this),kf.prototype.dispose.call(this)}});const jf=zf,Gf={MetadataBoolean:Ff,MetadataDouble:Df,MetadataFloat:Rf,MetadataInteger:Pf,MetadataSet:Lf,MetadataString:Bf,WorldInfo:jf},Hf={X3DBindableNode:Ir,X3DChildNode:yr,X3DInfoNode:kf,X3DMetadataObject:Of,X3DNode:ji,X3DPrototypeInstance:ao,X3DSensorNode:vs};for(const e in Gf)Bi.addType(e,Gf[e]);for(const e in Hf)Bi.addAbstractType(e,Hf[e]);function qf(e){Xu.call(this,e),this.addType(s.FogCoordinate),this._depth.setUnit("length")}qf.prototype=Object.assign(Object.create(Xu.prototype),{constructor:qf,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new P([new N(s.inputOutput,"metadata",new Bn.SFNode),new N(s.inputOutput,"depth",new Bn.MFFloat)]),getTypeName:function(){return"FogCoordinate"},getComponentName:function(){return"EnvironmentalEffects"},getContainerField:function(){return"fogCoord"},initialize:function(){Xu.prototype.initialize.call(this),this._depth.addInterest("set_depth__",this),this.set_depth__()},set_depth__:function(){this.depth=this._depth.getValue(),this.length=this._depth.length},isEmpty:function(){return 0===this.length},getSize:function(){return this.length},addDepth:function(e,t){e<this.length?t.push(this.depth[e]):this.length?t.push(this.depth[this.length-1]):t.push(0)},addDepths:function(e,t){const n=this.length;if(n){const i=this.depth;for(let t=0;t<n;++t)e.push(i[t]);const o=i[n-1];for(let i=n;i<t;++i)e.push(o)}else for(let n=0;n<t;++n)e.push(0)}});const Wf=qf;function Yf(e){yr.call(this,e),Xr.call(this,e),this.addType(s.LocalFog)}Yf.prototype=Object.assign(Object.create(yr.prototype),Xr.prototype,{constructor:Yf,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new P([new N(s.inputOutput,"metadata",new Bn.SFNode),new N(s.inputOutput,"enabled",new Bn.SFBool(!0)),new N(s.inputOutput,"fogType",new Bn.SFString("LINEAR")),new N(s.inputOutput,"color",new Bn.SFColor(1,1,1)),new N(s.inputOutput,"visibilityRange",new Bn.SFFloat)]),getTypeName:function(){return"LocalFog"},getComponentName:function(){return"EnvironmentalEffects"},getContainerField:function(){return"children"},initialize:function(){yr.prototype.initialize.call(this),Xr.prototype.initialize.call(this)},push:function(e){if(this._enabled.getValue()&&this.getFogType()){const t=this.getFogs().pop();t.set(this,e.getModelViewMatrix().get()),e.getLocalFogs().push(t)}},pop:function(e){this._enabled.getValue()&&this.getFogType()&&this.getBrowser().getLocalObjects().push(e.getLocalFogs().pop())},dispose:function(){Xr.prototype.dispose.call(this),yr.prototype.dispose.call(this)}});const Kf=Yf;function Zf(e){ns.call(this,e),this.addType(s.TextureBackground)}Zf.prototype=Object.assign(Object.create(ns.prototype),{constructor:Zf,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new P([new N(s.inputOutput,"metadata",new Bn.SFNode),new N(s.inputOnly,"set_bind",new Bn.SFBool),new N(s.inputOutput,"skyAngle",new Bn.MFFloat),new N(s.inputOutput,"skyColor",new Bn.MFColor(new Bn.SFColor)),new N(s.inputOutput,"groundAngle",new Bn.MFFloat),new N(s.inputOutput,"groundColor",new Bn.MFColor),new N(s.inputOutput,"transparency",new Bn.SFFloat),new N(s.outputOnly,"isBound",new Bn.SFBool),new N(s.outputOnly,"bindTime",new Bn.SFTime),new N(s.inputOutput,"frontTexture",new Bn.SFNode),new N(s.inputOutput,"backTexture",new Bn.SFNode),new N(s.inputOutput,"leftTexture",new Bn.SFNode),new N(s.inputOutput,"rightTexture",new Bn.SFNode),new N(s.inputOutput,"topTexture",new Bn.SFNode),new N(s.inputOutput,"bottomTexture",new Bn.SFNode)]),getTypeName:function(){return"TextureBackground"},getComponentName:function(){return"EnvironmentalEffects"},getContainerField:function(){return"children"},initialize:function(){ns.prototype.initialize.call(this),this._frontTexture.addInterest("set_frontTexture__",this),this._backTexture.addInterest("set_backTexture__",this),this._leftTexture.addInterest("set_leftTexture__",this),this._rightTexture.addInterest("set_rightTexture__",this),this._topTexture.addInterest("set_topTexture__",this),this._bottomTexture.addInterest("set_bottomTexture__",this),this.set_frontTexture__(this._frontTexture),this.set_backTexture__(this._backTexture),this.set_leftTexture__(this._leftTexture),this.set_rightTexture__(this._rightTexture),this.set_topTexture__(this._topTexture),this.set_bottomTexture__(this._bottomTexture)},set_frontTexture__:function(){ns.prototype.set_frontTexture__.call(this,xr(s.X3DTextureNode,this._frontTexture))},set_backTexture__:function(){ns.prototype.set_backTexture__.call(this,xr(s.X3DTextureNode,this._backTexture))},set_leftTexture__:function(){ns.prototype.set_leftTexture__.call(this,xr(s.X3DTextureNode,this._leftTexture))},set_rightTexture__:function(){ns.prototype.set_rightTexture__.call(this,xr(s.X3DTextureNode,this._rightTexture))},set_topTexture__:function(){ns.prototype.set_topTexture__.call(this,xr(s.X3DTextureNode,this._topTexture))},set_bottomTexture__:function(){ns.prototype.set_bottomTexture__.call(this,xr(s.X3DTextureNode,this._bottomTexture))}});const Qf=Zf,$f={Background:ms,Fog:zr,FogCoordinate:Wf,LocalFog:Kf,TextureBackground:Qf},Jf={X3DBackgroundNode:ns,X3DFogObject:Xr};for(const e in $f)Bi.addType(e,$f[e]);for(const e in Jf)Bi.addAbstractType(e,Jf[e]);function eg(e){vs.call(this,e),this.addType(s.X3DEnvironmentalSensorNode),this.addChildObjects("traversed",new Bn.SFBool(!0)),this._size.setUnit("length"),this._center.setUnit("length"),this.zeroTest=!1,this.currentTraversed=!0}eg.prototype=Object.assign(Object.create(vs.prototype),{constructor:eg,initialize:function(){vs.prototype.initialize.call(this),this.isLive().addInterest("set_live__",this),this._enabled.addInterest("set_live__",this),this._size.addInterest("set_live__",this),this._traversed.addInterest("set_live__",this),this.set_live__()},set_live__:function(){!(this._traversed.getValue()&&this.isLive().getValue()&&this._enabled.getValue())||this.zeroTest&&this._size.getValue().equals(He.Zero)?(this.getBrowser().sensorEvents().removeInterest("update",this),this._isActive.getValue()&&(this._isActive=!1,this._exitTime=this.getBrowser().getCurrentTime())):this.getBrowser().sensorEvents().addInterest("update",this)},setZeroTest:function(e){this.zeroTest=e},getZeroTest:function(){return this.zeroTest},setTraversed:function(e){e?!1===this._traversed.getValue()&&(this._traversed=!0):this.currentTraversed!==this._traversed.getValue()&&(this._traversed=this.currentTraversed),this.currentTraversed=e},getTraversed:function(){return this.currentTraversed},update:function(){}});const tg=eg;function ng(e){tg.call(this,e),this.addType(s.ProximitySensor),this.setCameraObject(!0),this._centerOfRotation_changed.setUnit("length"),this._position_changed.setUnit("length"),this.setZeroTest(!0),this.min=new He(0,0,0),this.max=new He(0,0,0),this.viewpointNode=null,this.modelMatrix=new Nt,this.inside=!1}ng.prototype=Object.assign(Object.create(tg.prototype),{constructor:ng,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new P([new N(s.inputOutput,"metadata",new Bn.SFNode),new N(s.inputOutput,"enabled",new Bn.SFBool(!0)),new N(s.inputOutput,"size",new Bn.SFVec3f),new N(s.inputOutput,"center",new Bn.SFVec3f),new N(s.outputOnly,"enterTime",new Bn.SFTime),new N(s.outputOnly,"exitTime",new Bn.SFTime),new N(s.outputOnly,"isActive",new Bn.SFBool),new N(s.outputOnly,"position_changed",new Bn.SFVec3f),new N(s.outputOnly,"orientation_changed",new Bn.SFRotation),new N(s.outputOnly,"centerOfRotation_changed",new Bn.SFVec3f)]),getTypeName:function(){return"ProximitySensor"},getComponentName:function(){return"EnvironmentalSensor"},getContainerField:function(){return"children"},initialize:function(){tg.prototype.initialize.call(this),this._enabled.addInterest("set_enabled__",this),this._size.addInterest("set_extents__",this),this._center.addInterest("set_extents__",this),this._traversed.addFieldInterest(this._isCameraObject),this.set_enabled__(),this.set_extents__()},set_enabled__:function(){this.setCameraObject(this._enabled.getValue()),this._enabled.getValue()?delete this.traverse:this.traverse=Function.prototype},set_extents__:function(){const e=this._size.getValue(),t=this._center.getValue(),n=e.x/2,i=e.y/2,o=e.z/2,r=t.x,s=t.y,a=t.z;this.min.set(r-n,s-i,a-o),this.max.set(r+n,s+i,a+o)},update:function(){const e=new Nt,t=new Nt,n=new He(0,0,0),i=new Et(0,0,1,0),o=new He(0,0,0);return function(){if(this.inside&&this.getTraversed()){if(this.viewpointNode){const r=this.modelMatrix;t.assign(this.viewpointNode.getModelMatrix()),t.translate(this.viewpointNode.getUserCenterOfRotation()),t.multRight(e.assign(r).inverse()),r.multRight(this.viewpointNode.getViewMatrix()),r.get(null,i),r.inverse(),n.set(r[12],r[13],r[14]),i.inverse(),o.set(t[12],t[13],t[14]),this._isActive.getValue()?(this._position_changed.getValue().equals(n)||(this._position_changed=n),this._orientation_changed.getValue().equals(i)||(this._orientation_changed=i),this._centerOfRotation_changed.getValue().equals(o)||(this._centerOfRotation_changed=o)):(this._isActive=!0,this._enterTime=this.getBrowser().getCurrentTime(),this._position_changed=n,this._orientation_changed=i,this._centerOfRotation_changed=o)}}else this._isActive.getValue()&&(this._isActive=!1,this._exitTime=this.getBrowser().getCurrentTime());this.inside=!1,this.viewpointNode=null,this.setTraversed(!1)}}(),traverse:function(){const e=new Nt,t=new He(-1,-1,-1);return function(n,i){switch(n){case sr.CAMERA:return this.viewpointNode=i.getViewpoint(),void this.modelMatrix.assign(i.getModelViewMatrix().get());case sr.DISPLAY:if(this.setTraversed(!0),this.inside)return;return void(this._size.getValue().equals(t)?this.inside=!0:(e.assign(i.getModelViewMatrix().get()).inverse(),this.inside=this.containsPoint(e.origin)))}}}(),containsPoint:function(e){const t=this.min,n=this.max;return t.x<=e.x&&n.x>=e.x&&t.y<=e.y&&n.y>=e.y&&t.z<=e.z&&n.z>=e.z}});const ig=ng,og=Ar(Nt),rg=Ar(Nt);function sg(e){tg.call(this,e),this.addType(s.TransformSensor),this._position_changed.setUnit("length"),this.setZeroTest(!0),this.min=new He,this.max=new He,this.targetObjectNode=null,this.modelMatrices=[],this.targetMatrices=[]}sg.prototype=Object.assign(Object.create(tg.prototype),{constructor:sg,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new P([new N(s.inputOutput,"metadata",new Bn.SFNode),new N(s.inputOutput,"enabled",new Bn.SFBool(!0)),new N(s.inputOutput,"size",new Bn.SFVec3f),new N(s.inputOutput,"center",new Bn.SFVec3f),new N(s.outputOnly,"enterTime",new Bn.SFTime),new N(s.outputOnly,"exitTime",new Bn.SFTime),new N(s.outputOnly,"isActive",new Bn.SFBool),new N(s.outputOnly,"position_changed",new Bn.SFVec3f),new N(s.outputOnly,"orientation_changed",new Bn.SFRotation),new N(s.inputOutput,"targetObject",new Bn.SFNode)]),getTypeName:function(){return"TransformSensor"},getComponentName:function(){return"EnvironmentalSensor"},getContainerField:function(){return"children"},initialize:function(){tg.prototype.initialize.call(this),this.isLive().addInterest("set_enabled__",this),this._enabled.addInterest("set_enabled__",this),this._size.addInterest("set_enabled__",this),this._size.addInterest("set_extents__",this),this._center.addInterest("set_extents__",this),this._targetObject.addInterest("set_targetObject__",this),this.set_extents__(),this.set_targetObject__()},set_live__:function(){},set_enabled__:function(){this.isLive().getValue()&&this.targetObjectNode&&this._enabled.getValue()&&!this._size.getValue().equals(He.Zero)?(this.setPickableObject(!0),this.getBrowser().addTransformSensor(this),this.targetObjectNode.addTransformSensor(this)):(this.setPickableObject(!1),this.getBrowser().removeTransformSensor(this),this.targetObjectNode&&this.targetObjectNode.removeTransformSensor(this),this._isActive.getValue()&&(this._isActive=!1,this._exitTime=this.getBrowser().getCurrentTime()))},set_extents__:function(){const e=this._size.getValue(),t=this._center.getValue(),n=e.x/2,i=e.y/2,o=e.z/2,r=t.x,s=t.y,a=t.z;this.min.set(r-n,s-i,a-o),this.max.set(r+n,s+i,a+o)},set_targetObject__:function(){this.targetObjectNode=null;try{const e=this._targetObject.getValue().getInnerNode(),t=e.getType();for(let n=t.length-1;n>=0;--n){switch(t[n]){case s.X3DGroupingNode:case s.X3DShapeNode:this.targetObjectNode=e;break;default:continue}break}}catch(e){}this.set_enabled__()},traverse:function(e,t){e===sr.PICKING&&this.getPickableObject()&&this.modelMatrices.push(og.pop().assign(t.getModelViewMatrix().get()))},collect:function(e){this.targetMatrices.push(rg.pop().assign(e))},process:function(){const e=new He(0,0,0),t=new Et(0,0,1,0);return function(){const n=this.modelMatrices,i=this.targetMatrices,o=this.intersects();o?(o.get(e,t),this._isActive.getValue()?(this._position_changed.getValue().equals(e)||(this._position_changed=e),this._orientation_changed.getValue().equals(t)||(this._orientation_changed=t)):(this._isActive=!0,this._enterTime=this.getBrowser().getCurrentTime(),this._position_changed=e,this._orientation_changed=t)):this._isActive.getValue()&&(this._isActive=!1,this._exitTime=this.getBrowser().getCurrentTime());for(const e of n)og.push(e);for(const e of i)rg.push(e);n.length=0,i.length=0}}(),intersects:function(){const e=new He(-1,-1,-1);return function(){const t=this.modelMatrices,n=this.targetMatrices,i=this._size.getValue().equals(e);for(const e of t){const t=e.inverse();for(const e of n){const n=e.multRight(t);if(i||this.containsPoint(n.origin))return n}}return null}}(),containsPoint:function(e){const t=this.min,n=this.max;return t.x<=e.x&&n.x>=e.x&&t.y<=e.y&&n.y>=e.y&&t.z<=e.z&&n.z>=e.z}});const ag=sg;function ug(e){tg.call(this,e),this.addType(s.VisibilitySensor),this.setZeroTest(!1),this.visible=!1}ug.prototype=Object.assign(Object.create(tg.prototype),{constructor:ug,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new P([new N(s.inputOutput,"metadata",new Bn.SFNode),new N(s.inputOutput,"enabled",new Bn.SFBool(!0)),new N(s.inputOutput,"size",new Bn.SFVec3f),new N(s.inputOutput,"center",new Bn.SFVec3f),new N(s.outputOnly,"enterTime",new Bn.SFTime),new N(s.outputOnly,"exitTime",new Bn.SFTime),new N(s.outputOnly,"isActive",new Bn.SFBool)]),getTypeName:function(){return"VisibilitySensor"},getComponentName:function(){return"EnvironmentalSensor"},getContainerField:function(){return"children"},initialize:function(){tg.prototype.initialize.call(this),this._enabled.addInterest("set_enabled__",this),this.set_enabled__()},set_enabled__:function(){this._enabled.getValue()?delete this.traverse:this.traverse=Function.prototype},update:function(){this.visible&&this.getTraversed()?(this._isActive.getValue()||(this._isActive=!0,this._enterTime=this.getBrowser().getCurrentTime()),this.visible=!1):this._isActive.getValue()&&(this._isActive=!1,this._exitTime=this.getBrowser().getCurrentTime()),this.setTraversed(!1)},traverse:function(){const e=new hr,t=new He(-1,-1,-1);return function(n,i){n===sr.DISPLAY&&(this.setTraversed(!0),this.visible||(this._size.getValue().equals(t)?this.visible=!0:(e.set(this._size.getValue(),this._center.getValue()).multRight(i.getModelViewMatrix().get()),this.visible=i.getViewVolume().intersectsBox(e))))}}()});const lg=ug,cg={ProximitySensor:ig,TransformSensor:ag,VisibilitySensor:lg},hg={X3DEnvironmentalSensorNode:tg};for(const e in cg)Bi.addType(e,cg[e]);for(const e in hg)Bi.addAbstractType(e,hg[e]);var dg=new He(0,0,0),pg=new He(0,0,0),fg=new He(0,0,0),gg=new He(0,0,0);function mg(e){Yl.call(this,e),this.addType(s.ColorChaser)}mg.prototype=Object.assign(Object.create(Yl.prototype),{constructor:mg,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new P([new N(s.inputOutput,"metadata",new Bn.SFNode),new N(s.inputOnly,"set_value",new Bn.SFColor),new N(s.inputOnly,"set_destination",new Bn.SFColor),new N(s.initializeOnly,"initialValue",new Bn.SFColor(.8,.8,.8)),new N(s.initializeOnly,"initialDestination",new Bn.SFColor(.8,.8,.8)),new N(s.initializeOnly,"duration",new Bn.SFTime(1)),new N(s.outputOnly,"isActive",new Bn.SFBool),new N(s.outputOnly,"value_changed",new Bn.SFColor)]),getTypeName:function(){return"ColorChaser"},getComponentName:function(){return"Followers"},getContainerField:function(){return"children"},getVector:function(){return new He(0,0,0)},getValue:function(){return this._set_value.getValue().getHSV(gg)},getDestination:function(){return this._set_destination.getValue().getHSV(gg)},getInitialValue:function(){return this._initialValue.getValue().getHSV(dg)},getInitialDestination:function(){return this._initialDestination.getValue().getHSV(pg)},setValue:function(e){this._value_changed.setHSV(e.x,e.y,e.z)},interpolate:function(e,t,n){return le.lerp(e,t,n,gg)},step:function(e,t,n){fg.assign(this.output).add(e).subtract(t),le.lerp(this.output,fg,n,this.output)}});const _g=mg;function yg(e){ql.call(this,e),this.addType(s.X3DDamperNode)}yg.prototype=Object.assign(Object.create(ql.prototype),{constructor:yg,initialize:function(){ql.prototype.initialize.call(this),this._order.addInterest("set_order__",this),this._set_value.addInterest("set_value__",this),this._set_destination.addInterest("set_destination__",this);var e=this.getBuffer(),t=this.getInitialValue(),n=this.getInitialDestination();e[0]=this.duplicate(n);for(var i=1,o=this.getOrder()+1;i<o;++i)e[i]=this.duplicate(t);this.equals(n,t,this.getTolerance())?this.setValue(n):this.set_active(!0)},getOrder:function(){return ee.clamp(this._order.getValue(),0,5)},getTolerance:function(){return this._tolerance.getValue()<0?1e-4:this._tolerance.getValue()},prepareEvents:function(){var e=this.getBuffer(),t=e.length-1;if(this._tau.getValue()){for(var n=1/this.getBrowser().currentFrameRate,i=Math.exp(-n/this._tau.getValue()),o=0;o<t;++o)this.assign(e,o+1,this.interpolate(e[o],e[o+1],i));if(this.setValue(e[t]),!this.equals(e[t],e[0],this.getTolerance()))return}else this.setValue(e[0]),t=0;o=1;for(var r=e.length;o<r;++o)this.assign(e,o,e[t]);this.set_active(!1)},set_value__:function(){for(var e=this.getBuffer(),t=this.getValue(),n=1,i=e.length;n<i;++n)this.assign(e,n,t);this.setValue(t),this.set_active(!0)},set_destination__:function(){this.assign(this.getBuffer(),0,this.getDestination()),this.set_active(!0)},set_order__:function(){for(var e=this.getBuffer(),t=e[e.length-1],n=e.length,i=this.getOrder()+1;n<i;++n)e[n]=this.duplicate(t);e.length=i}});const xg=yg;var wg=new He(0,0,0),vg=new He(0,0,0),bg=new He(0,0,0),Sg=new He(0,0,0);function Tg(e){xg.call(this,e),this.addType(s.ColorDamper)}Tg.prototype=Object.assign(Object.create(xg.prototype),{constructor:Tg,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new P([new N(s.inputOutput,"metadata",new Bn.SFNode),new N(s.inputOnly,"set_value",new Bn.SFColor),new N(s.inputOnly,"set_destination",new Bn.SFColor),new N(s.initializeOnly,"initialValue",new Bn.SFColor(.8,.8,.8)),new N(s.initializeOnly,"initialDestination",new Bn.SFColor(.8,.8,.8)),new N(s.initializeOnly,"order",new Bn.SFInt32(3)),new N(s.inputOutput,"tau",new Bn.SFTime(.3)),new N(s.inputOutput,"tolerance",new Bn.SFFloat(-1)),new N(s.outputOnly,"isActive",new Bn.SFBool),new N(s.outputOnly,"value_changed",new Bn.SFColor)]),getTypeName:function(){return"ColorDamper"},getComponentName:function(){return"Followers"},getContainerField:function(){return"children"},getVector:function(){return new He(0,0,0)},getValue:function(){return this._set_value.getValue().getHSV(Sg)},getDestination:function(){return this._set_destination.getValue().getHSV(Sg)},getInitialValue:function(){return this._initialValue.getValue().getHSV(vg)},getInitialDestination:function(){return this._initialDestination.getValue().getHSV(bg)},setValue:function(e){this._value_changed.setHSV(e.x,e.y,e.z)},equals:function(e,t,n){return wg.assign(e).subtract(t).magnitude()<n},interpolate:function(e,t,n){return le.lerp(e,t,n,Sg)}});const Eg=Tg;function Cg(e){function t(){this.array=this.getArray(),this.zero=this.getVector()}return t.prototype={getArray:function(){const e=[];return e.assign=function(e){if(Array.isArray(e)){for(var t=0,n=Math.min(this.length,e.length);t<n;++t)this[t].assign(e[t]);for(t=n,n=e.length;t<n;++t)this[t]=e[t].copy();this.length=n}else{for(t=0,n=Math.min(this.length,e.length);t<n;++t)this[t].assign(e[t].getValue());for(t=n,n=e.length;t<n;++t)this[t]=e[t].getValue().copy();this.length=n}},e},getValue:function(){return this._set_value},getDestination:function(){return this._set_destination},getInitialValue:function(){return this._initialValue},getInitialDestination:function(){return this._initialDestination},setValue:function(e){if(Array.isArray(e)){const i=this._value_changed;for(var t=0,n=e.length;t<n;++t)i[t]=e[t];i.length=n}else this._value_changed=e},duplicate:function(e){const t=this.getArray();return t.assign(e),t},equals:function(e,t,n){if(e.length!==t.length)return!1;const i=this.a;let o=0;for(let n=0,r=e.length;n<r;++n)o=Math.max(i.assign(e[n]).subtract(t[n]).magnitude());return o<n},interpolate:function(e,t,n){const i=this.array;i.assign(e);for(let e=0,o=i.length;e<o;++e)i[e].lerp(t[e]||this.zero,n);return i},set_destination__:function(){const t=this.getBuffer(),n=this._set_destination.length;for(let e=0,i=t.length;e<i;++e){const i=t[e];for(let e=i.length;e<n;++e)i[e]=this.getVector();i.length=n}e.prototype.set_destination__.call(this)}},t}function Og(e){const t=Cg(e);function n(){t.call(this),this.array=this.getArray()}return Object.assign(n.prototype,t.prototype,{step:function(e,t,n){const i=this.output,o=this.deltaOut;for(let r=0,s=i.length;r<s;++r)i[r].add(o.assign(e[r]||this.zero).subtract(t[r]||this.zero).multiply(n))}}),n}var Ng=Og(Yl);function Fg(e){Yl.call(this,e),Ng.call(this,e),this.addType(s.CoordinateChaser)}Fg.prototype=Object.assign(Object.create(Yl.prototype),Ng.prototype,{constructor:Fg,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new P([new N(s.inputOutput,"metadata",new Bn.SFNode),new N(s.inputOnly,"set_value",new Bn.MFVec3f),new N(s.inputOnly,"set_destination",new Bn.MFVec3f),new N(s.initializeOnly,"initialValue",new Bn.MFVec3f(new He(0,0,0))),new N(s.initializeOnly,"initialDestination",new Bn.MFVec3f(new He(0,0,0))),new N(s.initializeOnly,"duration",new Bn.SFTime(1)),new N(s.outputOnly,"isActive",new Bn.SFBool),new N(s.outputOnly,"value_changed",new Bn.MFVec3f)]),getTypeName:function(){return"CoordinateChaser"},getComponentName:function(){return"Followers"},getContainerField:function(){return"children"},getVector:function(){return new He(0,0,0)}});const Mg=Fg;var Dg=Cg(xg);function Ig(e){xg.call(this,e),Dg.call(this,e),this.addType(s.CoordinateDamper)}Ig.prototype=Object.assign(Object.create(xg.prototype),Dg.prototype,{constructor:Ig,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new P([new N(s.inputOutput,"metadata",new Bn.SFNode),new N(s.inputOnly,"set_value",new Bn.MFVec3f),new N(s.inputOnly,"set_destination",new Bn.MFVec3f),new N(s.initializeOnly,"initialValue",new Bn.MFVec3f(new He(0,0,0))),new N(s.initializeOnly,"initialDestination",new Bn.MFVec3f(new He(0,0,0))),new N(s.initializeOnly,"order",new Bn.SFInt32(3)),new N(s.inputOutput,"tau",new Bn.SFTime(.3)),new N(s.inputOutput,"tolerance",new Bn.SFFloat(-1)),new N(s.outputOnly,"isActive",new Bn.SFBool),new N(s.outputOnly,"value_changed",new Bn.MFVec3f)]),getTypeName:function(){return"CoordinateDamper"},getComponentName:function(){return"Followers"},getContainerField:function(){return"children"},getVector:function(){return new He(0,0,0)}});const Rg=Ig;var Vg=new Et(0,0,1,0),Pg=new Et(0,0,1,0);function Ag(e){xg.call(this,e),this.addType(s.OrientationDamper),this._set_value.setUnit("angle"),this._set_destination.setUnit("angle"),this._initialValue.setUnit("angle"),this._initialDestination.setUnit("angle"),this._value_changed.setUnit("angle")}Ag.prototype=Object.assign(Object.create(xg.prototype),{constructor:Ag,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new P([new N(s.inputOutput,"metadata",new Bn.SFNode),new N(s.inputOnly,"set_value",new Bn.SFRotation),new N(s.inputOnly,"set_destination",new Bn.SFRotation),new N(s.initializeOnly,"initialValue",new Bn.SFRotation),new N(s.initializeOnly,"initialDestination",new Bn.SFRotation),new N(s.initializeOnly,"order",new Bn.SFInt32(3)),new N(s.inputOutput,"tau",new Bn.SFTime(.3)),new N(s.inputOutput,"tolerance",new Bn.SFFloat(-1)),new N(s.outputOnly,"isActive",new Bn.SFBool),new N(s.outputOnly,"value_changed",new Bn.SFRotation)]),getTypeName:function(){return"OrientationDamper"},getComponentName:function(){return"Followers"},getContainerField:function(){return"children"},getVector:function(){return new Et(0,0,1,0)},equals:function(e,t,n){return Vg.assign(e).inverse().multRight(t),Math.abs(Vg.angle)<n},interpolate:function(e,t,n){return Pg.assign(e).slerp(t,n)}});const Lg=Ag;function Ug(e){Yl.call(this,e),this.addType(s.PositionChaser2D)}Ug.prototype=Object.assign(Object.create(Yl.prototype),{constructor:Ug,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new P([new N(s.inputOutput,"metadata",new Bn.SFNode),new N(s.inputOnly,"set_value",new Bn.SFVec2f),new N(s.inputOnly,"set_destination",new Bn.SFVec2f),new N(s.initializeOnly,"initialValue",new Bn.SFVec2f),new N(s.initializeOnly,"initialDestination",new Bn.SFVec2f),new N(s.initializeOnly,"duration",new Bn.SFTime(1)),new N(s.outputOnly,"isActive",new Bn.SFBool),new N(s.outputOnly,"value_changed",new Bn.SFVec2f)]),getTypeName:function(){return"PositionChaser2D"},getComponentName:function(){return"Followers"},getContainerField:function(){return"children"},getVector:function(){return new ke(0,0)}});const Bg=Ug;function Xg(e){xg.call(this,e),this.addType(s.PositionDamper)}Xg.prototype=Object.assign(Object.create(xg.prototype),{constructor:Xg,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new P([new N(s.inputOutput,"metadata",new Bn.SFNode),new N(s.inputOnly,"set_value",new Bn.SFVec3f),new N(s.inputOnly,"set_destination",new Bn.SFVec3f),new N(s.initializeOnly,"initialValue",new Bn.SFVec3f),new N(s.initializeOnly,"initialDestination",new Bn.SFVec3f),new N(s.initializeOnly,"order",new Bn.SFInt32(3)),new N(s.inputOutput,"tolerance",new Bn.SFFloat(-1)),new N(s.inputOutput,"tau",new Bn.SFTime(.3)),new N(s.outputOnly,"value_changed",new Bn.SFVec3f),new N(s.outputOnly,"isActive",new Bn.SFBool)]),getTypeName:function(){return"PositionDamper"},getComponentName:function(){return"Followers"},getContainerField:function(){return"children"},getVector:function(){return new He(0,0,0)}});const kg=Xg;function zg(e){xg.call(this,e),this.addType(s.PositionDamper2D)}zg.prototype=Object.assign(Object.create(xg.prototype),{constructor:zg,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new P([new N(s.inputOutput,"metadata",new Bn.SFNode),new N(s.inputOnly,"set_value",new Bn.SFVec2f),new N(s.inputOnly,"set_destination",new Bn.SFVec2f),new N(s.initializeOnly,"initialValue",new Bn.SFVec2f),new N(s.initializeOnly,"initialDestination",new Bn.SFVec2f),new N(s.initializeOnly,"order",new Bn.SFInt32(3)),new N(s.inputOutput,"tau",new Bn.SFTime(.3)),new N(s.inputOutput,"tolerance",new Bn.SFFloat(-1)),new N(s.outputOnly,"isActive",new Bn.SFBool),new N(s.outputOnly,"value_changed",new Bn.SFVec2f)]),getTypeName:function(){return"PositionDamper2D"},getComponentName:function(){return"Followers"},getContainerField:function(){return"children"},getVector:function(){return new ke(0,0)}});const jg=zg;function Gg(e){Yl.call(this,e),this.addType(s.ScalarChaser)}Gg.prototype=Object.assign(Object.create(Yl.prototype),{constructor:Gg,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new P([new N(s.inputOutput,"metadata",new Bn.SFNode),new N(s.inputOnly,"set_value",new Bn.SFFloat),new N(s.inputOnly,"set_destination",new Bn.SFFloat),new N(s.initializeOnly,"initialValue",new Bn.SFFloat),new N(s.initializeOnly,"initialDestination",new Bn.SFFloat),new N(s.initializeOnly,"duration",new Bn.SFTime(1)),new N(s.outputOnly,"isActive",new Bn.SFBool),new N(s.outputOnly,"value_changed",new Bn.SFFloat)]),getTypeName:function(){return"ScalarChaser"},getComponentName:function(){return"Followers"},getContainerField:function(){return"children"},getVector:function(){return 0},setPreviousValue:function(e){this.previousValue=e},setDestination:function(e){this.destination=e},duplicate:function(e){return e},assign:function(e,t,n){e[t]=n},equals:function(e,t,n){return Math.abs(e-t)<n},interpolate:function(e,t,n){return ee.lerp(e,t,n)},step:function(e,t,n){this.output+=(e-t)*n}});const Hg=Gg;function qg(e){xg.call(this,e),this.addType(s.ScalarDamper)}qg.prototype=Object.assign(Object.create(xg.prototype),{constructor:qg,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new P([new N(s.inputOutput,"metadata",new Bn.SFNode),new N(s.inputOnly,"set_value",new Bn.SFFloat),new N(s.inputOnly,"set_destination",new Bn.SFFloat),new N(s.initializeOnly,"initialValue",new Bn.SFFloat),new N(s.initializeOnly,"initialDestination",new Bn.SFFloat),new N(s.initializeOnly,"order",new Bn.SFInt32(3)),new N(s.inputOutput,"tau",new Bn.SFTime(.3)),new N(s.inputOutput,"tolerance",new Bn.SFFloat(-1)),new N(s.outputOnly,"isActive",new Bn.SFBool),new N(s.outputOnly,"value_changed",new Bn.SFFloat)]),getTypeName:function(){return"ScalarDamper"},getComponentName:function(){return"Followers"},getContainerField:function(){return"children"},getVector:function(){return 0},duplicate:function(e){return e},assign:function(e,t,n){e[t]=n},equals:function(e,t,n){return Math.abs(e-t)<n},interpolate:function(e,t,n){return ee.lerp(e,t,n)}});const Wg=qg;var Yg=Og(Yl);function Kg(e){Yl.call(this,e),Yg.call(this,e),this.addType(s.TexCoordChaser2D)}Kg.prototype=Object.assign(Object.create(Yl.prototype),Yg.prototype,{constructor:Kg,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new P([new N(s.inputOutput,"metadata",new Bn.SFNode),new N(s.inputOnly,"set_value",new Bn.MFVec2f),new N(s.inputOnly,"set_destination",new Bn.MFVec2f),new N(s.initializeOnly,"initialValue",new Bn.MFVec2f),new N(s.initializeOnly,"initialDestination",new Bn.MFVec2f),new N(s.initializeOnly,"duration",new Bn.SFTime(1)),new N(s.outputOnly,"isActive",new Bn.SFBool),new N(s.outputOnly,"value_changed",new Bn.MFVec2f)]),getTypeName:function(){return"TexCoordChaser2D"},getComponentName:function(){return"Followers"},getContainerField:function(){return"children"},getVector:function(){return new ke(0,0)}});const Zg=Kg;var Qg=Cg(xg);function $g(e){xg.call(this,e),Qg.call(this,e),this.addType(s.TexCoordDamper2D)}$g.prototype=Object.assign(Object.create(xg.prototype),Qg.prototype,{constructor:$g,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new P([new N(s.inputOutput,"metadata",new Bn.SFNode),new N(s.inputOnly,"set_value",new Bn.MFVec2f),new N(s.inputOnly,"set_destination",new Bn.MFVec2f),new N(s.initializeOnly,"initialValue",new Bn.MFVec2f),new N(s.initializeOnly,"initialDestination",new Bn.MFVec2f),new N(s.initializeOnly,"order",new Bn.SFInt32(3)),new N(s.inputOutput,"tau",new Bn.SFTime(.3)),new N(s.inputOutput,"tolerance",new Bn.SFFloat(-1)),new N(s.outputOnly,"isActive",new Bn.SFBool),new N(s.outputOnly,"value_changed",new Bn.MFVec2f)]),getTypeName:function(){return"TexCoordDamper2D"},getComponentName:function(){return"Followers"},getContainerField:function(){return"children"},getVector:function(){return new ke(0,0,0)}});const Jg=$g,em={ColorChaser:_g,ColorDamper:Eg,CoordinateChaser:Mg,CoordinateDamper:Rg,OrientationChaser:ec,OrientationDamper:Lg,PositionChaser:Zl,PositionChaser2D:Bg,PositionDamper:kg,PositionDamper2D:jg,ScalarChaser:Hg,ScalarDamper:Wg,TexCoordChaser2D:Zg,TexCoordDamper2D:Jg},tm={X3DChaserNode:Yl,X3DDamperNode:xg,X3DFollowerNode:ql};for(const e in em)Bi.addType(e,em[e]);for(const e in tm)Bi.addAbstractType(e,tm[e]);function nm(e){Wr.call(this,e),this.addType(s.Box),this._size.setUnit("length")}nm.prototype=Object.assign(Object.create(Wr.prototype),{constructor:nm,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new P([new N(s.inputOutput,"metadata",new Bn.SFNode),new N(s.initializeOnly,"size",new Bn.SFVec3f(2,2,2)),new N(s.initializeOnly,"solid",new Bn.SFBool(!0))]),getTypeName:function(){return"Box"},getComponentName:function(){return"Geometry3D"},getContainerField:function(){return"geometry"},build:function(){const e=new He(2,2,2);return function(){const t=this.getBrowser().getBoxOptions().getGeometry(),n=this._size.getValue();if(this.setMultiTexCoords(t.getMultiTexCoords()),this.setNormals(t.getNormals()),n.equals(e))this.setVertices(t.getVertices()),this.getMin().assign(t.getMin()),this.getMax().assign(t.getMax());else{const e=He.divide(n,2),i=t.getVertices().getValue(),o=this.getVertices();let r=e.x,s=e.y,a=e.z;for(let e=0,t=i.length;e<t;e+=4)o.push(r*i[e],s*i[e+1],a*i[e+2],1);r=Math.abs(r),s=Math.abs(s),a=Math.abs(a),this.getMin().set(-r,-s,-a),this.getMax().set(r,s,a)}this.setSolid(this._solid.getValue())}}()});const im=nm;function om(e){Wr.call(this,e),this.addType(s.Cone),this._height.setUnit("length"),this._bottomRadius.setUnit("length")}om.prototype=Object.assign(Object.create(Wr.prototype),{constructor:om,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new P([new N(s.inputOutput,"metadata",new Bn.SFNode),new N(s.initializeOnly,"side",new Bn.SFBool(!0)),new N(s.initializeOnly,"bottom",new Bn.SFBool(!0)),new N(s.initializeOnly,"height",new Bn.SFFloat(2)),new N(s.initializeOnly,"bottomRadius",new Bn.SFFloat(1)),new N(s.initializeOnly,"solid",new Bn.SFBool(!0))]),getTypeName:function(){return"Cone"},getComponentName:function(){return"Geometry3D"},getContainerField:function(){return"geometry"},set_live__:function(){Wr.prototype.set_live__.call(this),this.isLive().getValue()?this.getBrowser().getConeOptions().addInterest("requestRebuild",this):this.getBrowser().getConeOptions().removeInterest("requestRebuild",this)},build:function(){const e=this.getBrowser().getConeOptions()._xDimension.getValue(),t=this._height.getValue(),n=this._bottomRadius.getValue(),i=this.getTexCoords(),o=this.getNormals(),r=this.getVertices();this.getMultiTexCoords().push(i);const s=t/2,a=-s,u=Qr.Polar(1,-Math.PI/2+Math.atan(n/t));if(this._side.getValue())for(let t=0;t<e;++t){const l=(t+.5)/e,c=2*Math.PI*l,h=Qr.Polar(u.imag,c),d=t/e,p=2*Math.PI*d,f=Qr.Polar(-n,p),g=Qr.Polar(u.imag,p),m=(t+1)/e,_=2*Math.PI*m,y=Qr.Polar(-n,_),x=Qr.Polar(u.imag,_);i.push(l,1,0,1),o.push(h.imag,u.real,h.real),r.push(0,s,0,1),i.push(d,0,0,1),o.push(g.imag,u.real,g.real),r.push(f.imag,a,f.real,1),i.push(m,0,0,1),o.push(x.imag,u.real,x.real),r.push(y.imag,a,y.real,1)}if(this._bottom.getValue()){const t=[],s=[];for(let i=e-1;i>-1;--i){const o=i/e,r=2*Math.PI*o,u=Qr.Polar(-1,r),l=Qr.multiply(u,n);t.push(new ke((u.imag+1)/2,(u.real+1)/2)),s.push(new He(l.imag,a,l.real))}const u=t[0],l=s[0];for(let e=1,n=s.length-1;e<n;++e){const n=t[e],a=t[e+1],c=s[e],h=s[e+1];i.push(u.x,u.y,0,1),o.push(0,-1,0),r.push(l.x,l.y,l.z,1),i.push(n.x,n.y,0,1),o.push(0,-1,0),r.push(c.x,c.y,c.z,1),i.push(a.x,a.y,0,1),o.push(0,-1,0),r.push(h.x,h.y,h.z,1)}}this.setSolid(this._solid.getValue()),this.setExtents()},setExtents:function(){const e=this._bottomRadius.getValue(),t=this._height.getValue()/2,n=-t;this._side.getValue()||this._bottom.getValue()?this._side.getValue()?(this.getMin().set(-e,n,-e),this.getMax().set(e,t,e)):(this.getMin().set(-e,n,-e),this.getMax().set(e,n,e)):(this.getMin().set(0,0,0),this.getMax().set(0,0,0))}});const rm=om;function sm(e){Wr.call(this,e),this.addType(s.Cylinder),this._height.setUnit("length"),this._radius.setUnit("length")}sm.prototype=Object.assign(Object.create(Wr.prototype),{constructor:sm,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new P([new N(s.inputOutput,"metadata",new Bn.SFNode),new N(s.initializeOnly,"top",new Bn.SFBool(!0)),new N(s.initializeOnly,"side",new Bn.SFBool(!0)),new N(s.initializeOnly,"bottom",new Bn.SFBool(!0)),new N(s.initializeOnly,"height",new Bn.SFFloat(2)),new N(s.initializeOnly,"radius",new Bn.SFFloat(1)),new N(s.initializeOnly,"solid",new Bn.SFBool(!0))]),getTypeName:function(){return"Cylinder"},getComponentName:function(){return"Geometry3D"},getContainerField:function(){return"geometry"},set_live__:function(){Wr.prototype.set_live__.call(this),this.isLive().getValue()?this.getBrowser().getCylinderOptions().addInterest("requestRebuild",this):this.getBrowser().getCylinderOptions().removeInterest("requestRebuild",this)},build:function(){const e=this.getBrowser().getCylinderOptions()._xDimension.getValue(),t=this.getTexCoords(),n=this.getNormals(),i=this.getVertices();this.getMultiTexCoords().push(t);const o=this._radius.getValue(),r=this._height.getValue()/2,s=-r;if(this._side.getValue())for(let a=0;a<e;++a){const u=a/e,l=2*Math.PI*u,c=Qr.Polar(-1,l),h=Qr.multiply(c,o),d=(a+1)/e,p=2*Math.PI*d,f=Qr.Polar(-1,p),g=Qr.multiply(f,o);t.push(u,1,0,1),n.push(c.imag,0,c.real),i.push(h.imag,r,h.real,1),t.push(u,0,0,1),n.push(c.imag,0,c.real),i.push(h.imag,s,h.real,1),t.push(d,0,0,1),n.push(f.imag,0,f.real),i.push(g.imag,s,g.real,1),t.push(u,1,0,1),n.push(c.imag,0,c.real),i.push(h.imag,r,h.real,1),t.push(d,0,0,1),n.push(f.imag,0,f.real),i.push(g.imag,s,g.real,1),t.push(d,1,0,1),n.push(f.imag,0,f.real),i.push(g.imag,r,g.real,1)}if(this._top.getValue()){const s=[],a=[];for(let t=0;t<e;++t){const n=t/e,i=2*Math.PI*n,u=Qr.Polar(-1,i);s.push(new ke((u.imag+1)/2,-(u.real-1)/2)),a.push(new He(u.imag*o,r,u.real*o))}const u=s[0],l=a[0];for(let e=1,o=a.length-1;e<o;++e){const o=s[e],r=s[e+1],c=a[e],h=a[e+1];t.push(u.x,u.y,0,1),n.push(0,1,0),i.push(l.x,l.y,l.z,1),t.push(o.x,o.y,0,1),n.push(0,1,0),i.push(c.x,c.y,c.z,1),t.push(r.x,r.y,0,1),n.push(0,1,0),i.push(h.x,h.y,h.z,1)}}if(this._bottom.getValue()){const r=[],a=[];for(let t=e-1;t>-1;--t){const n=t/e,i=2*Math.PI*n,u=Qr.Polar(-1,i);r.push(new ke((u.imag+1)/2,(u.real+1)/2)),a.push(new He(u.imag*o,s,u.real*o))}const u=r[0],l=a[0];for(let e=1,o=a.length-1;e<o;++e){const o=r[e],s=r[e+1],c=a[e],h=a[e+1];t.push(u.x,u.y,0,1),n.push(0,-1,0),i.push(l.x,l.y,l.z,1),t.push(o.x,o.y,0,1),n.push(0,-1,0),i.push(c.x,c.y,c.z,1),t.push(s.x,s.y,0,1),n.push(0,-1,0),i.push(h.x,h.y,h.z,1)}}this.setSolid(this._solid.getValue()),this.setExtents()},setExtents:function(){const e=this._radius.getValue(),t=this._height.getValue()/2,n=-t;this._top.getValue()||this._side.getValue()||this._bottom.getValue()?this._top.getValue()||this._side.getValue()?this._bottom.getValue()||this._side.getValue()?(this.getMin().set(-e,n,-e),this.getMax().set(e,t,e)):(this.getMin().set(-e,t,-e),this.getMax().set(e,t,e)):(this.getMin().set(-e,n,-e),this.getMax().set(e,n,e)):(this.getMin().set(0,0,0),this.getMax().set(0,0,0))}});const am=sm;function um(e){Wr.call(this,e),this.addType(s.ElevationGrid),this._xSpacing.setUnit("length"),this._zSpacing.setUnit("length"),this._creaseAngle.setUnit("angle"),this._height.setUnit("length"),this.fogCoordNode=null,this.colorNode=null,this.texCoordNode=null,this.normalNode=null,this.coordNode=null}um.prototype=Object.assign(Object.create(Wr.prototype),{constructor:um,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new P([new N(s.inputOutput,"metadata",new Bn.SFNode),new N(s.inputOnly,"set_height",new Bn.MFFloat),new N(s.initializeOnly,"xDimension",new Bn.SFInt32),new N(s.initializeOnly,"zDimension",new Bn.SFInt32),new N(s.initializeOnly,"xSpacing",new Bn.SFFloat(1)),new N(s.initializeOnly,"zSpacing",new Bn.SFFloat(1)),new N(s.initializeOnly,"solid",new Bn.SFBool(!0)),new N(s.initializeOnly,"ccw",new Bn.SFBool(!0)),new N(s.initializeOnly,"creaseAngle",new Bn.SFFloat),new N(s.initializeOnly,"colorPerVertex",new Bn.SFBool(!0)),new N(s.initializeOnly,"normalPerVertex",new Bn.SFBool(!0)),new N(s.inputOutput,"attrib",new Bn.MFNode),new N(s.inputOutput,"fogCoord",new Bn.SFNode),new N(s.inputOutput,"color",new Bn.SFNode),new N(s.inputOutput,"texCoord",new Bn.SFNode),new N(s.inputOutput,"normal",new Bn.SFNode),new N(s.initializeOnly,"height",new Bn.MFFloat)]),getTypeName:function(){return"ElevationGrid"},getComponentName:function(){return"Geometry3D"},getContainerField:function(){return"geometry"},initialize:function(){Wr.prototype.initialize.call(this),this._set_height.addFieldInterest(this._height),this._attrib.addInterest("set_attrib__",this),this._fogCoord.addInterest("set_fogCoord__",this),this._color.addInterest("set_color__",this),this._texCoord.addInterest("set_texCoord__",this),this._normal.addInterest("set_normal__",this),this.set_attrib__(),this.set_fogCoord__(),this.set_color__(),this.set_texCoord__(),this.set_normal__()},set_attrib__:function(){const e=this.getAttrib();for(const t of e)t.removeInterest("requestRebuild",this),t._attribute_changed.removeInterest("updateVertexArrays",this);e.length=0;for(const t of this._attrib){const n=xr(s.X3DVertexAttributeNode,t);n&&e.push(n)}for(const t of e)t.addInterest("requestRebuild",this),t._attribute_changed.addInterest("updateVertexArrays",this);this.updateVertexArrays()},set_fogCoord__:function(){this.fogCoordNode&&this.fogCoordNode.removeInterest("requestRebuild",this),this.fogCoordNode=xr(s.FogCoordinate,this._fogCoord),this.fogCoordNode&&this.fogCoordNode.addInterest("requestRebuild",this)},set_color__:function(){this.colorNode&&(this.colorNode.removeInterest("requestRebuild",this),this.colorNode._transparent.removeInterest("set_transparent__",this)),this.colorNode=xr(s.X3DColorNode,this._color),this.colorNode?(this.colorNode.addInterest("requestRebuild",this),this.colorNode._transparent.addInterest("set_transparent__",this),this.set_transparent__()):this.setTransparent(!1)},set_transparent__:function(){this.setTransparent(this.colorNode.getTransparent())},set_texCoord__:function(){this.texCoordNode&&this.texCoordNode.removeInterest("requestRebuild",this),this.texCoordNode=xr(s.X3DTextureCoordinateNode,this._texCoord),this.texCoordNode&&this.texCoordNode.addInterest("requestRebuild",this),this.setTextureCoordinate(this.texCoordNode)},set_normal__:function(){this.normalNode&&this.normalNode.removeInterest("requestRebuild",this),this.normalNode=xr(s.X3DNormalNode,this._normal),this.normalNode&&this.normalNode.addInterest("requestRebuild",this)},getColor:function(){return this.colorNode},getTexCoord:function(){return this.texCoordNode},getNormal:function(){return this.normalNode},getHeight:function(e){return e<this._height.length?this._height[e]:0},createTexCoords:function(){const e=[],t=this._xDimension.getValue(),n=this._zDimension.getValue(),i=t-1,o=n-1;for(let r=0;r<n;++r)for(let n=0;n<t;++n)e.push(new ke(n/i,r/o));return e},createNormals:function(e,t,n){const i=!this._ccw.getValue(),o=[],r=[];for(let t=0,n=e.length;t<n;++t)o[t]=[];for(let n=0,s=t.length;n<s;n+=3){const s=t[n],a=t[n+1],u=t[n+2];o[s].push(r.length),o[a].push(r.length+1),o[u].push(r.length+2);const l=Yo.normal(e[s],e[a],e[u],new He(0,0,0));i&&l.negate(),r.push(l),r.push(l),r.push(l)}return this.refineNormals(o,r,this._creaseAngle.getValue())},createCoordIndex:function(){const e=[],t=this._xDimension.getValue(),n=t-1,i=this._zDimension.getValue()-1;for(let o=0;o<i;++o)for(let i=0;i<n;++i){const n=o*t+i,r=(o+1)*t+i,s=(o+1)*t+(i+1),a=o*t+(i+1);e.push(n),e.push(r),e.push(s),e.push(n),e.push(s),e.push(a)}return e},createPoints:function(){const e=[],t=this._xDimension.getValue(),n=this._zDimension.getValue(),i=this._xSpacing.getValue(),o=this._zSpacing.getValue();for(let r=0;r<n;++r)for(let n=0;n<t;++n)e.push(new He(i*n,this.getHeight(n+r*t),o*r));return e},build:function(){if(this._xDimension.getValue()<2||this._zDimension.getValue()<2)return;const e=this._colorPerVertex.getValue(),t=this._normalPerVertex.getValue(),n=this.createCoordIndex(),i=this.getAttrib(),o=i.length,r=this.getAttribs(),s=this.fogCoordNode,a=this.getColor(),u=this.getTexCoord(),l=this.getNormal(),c=this.createPoints(),h=this.getFogDepths(),d=this.getColors(),p=this.getMultiTexCoords(),f=this.getNormals(),g=this.getVertices();let m=0;if(u)u.init(p);else{var _=this.createTexCoords(),y=this.getTexCoords();p.push(y)}for(let x=0,w=n.length;x<w;++m)for(let w=0;w<6;++w,++x){const w=n[x],v=c[w];for(let e=0;e<o;++e)i[e].addValue(w,r[e]);if(s&&s.addDepth(w,h),a&&(e?a.addColor(w,d):a.addColor(m,d)),u)u.addTexCoord(w,p);else{const e=_[w];y.push(e.x,e.y,0,1)}l&&(t?l.addVector(w,f):l.addVector(m,f)),g.push(v.x,v.y,v.z,1)}if(!l){const e=this.createNormals(c,n);for(const t of e)f.push(t.x,t.y,t.z)}this.setSolid(this._solid.getValue()),this.setCCW(this._ccw.getValue())}});const lm=um;function cm(e){Wr.call(this,e),this.addType(s.Extrusion),this._creaseAngle.setUnit("angle"),this._crossSection.setUnit("length"),this._spine.setUnit("length")}cm.prototype=Object.assign(Object.create(Wr.prototype),{constructor:cm,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new P([new N(s.inputOutput,"metadata",new Bn.SFNode),new N(s.inputOnly,"set_crossSection",new Bn.MFVec2f),new N(s.inputOnly,"set_orientation",new Bn.MFRotation),new N(s.inputOnly,"set_scale",new Bn.MFVec2f),new N(s.inputOnly,"set_spine",new Bn.MFVec3f),new N(s.initializeOnly,"beginCap",new Bn.SFBool(!0)),new N(s.initializeOnly,"endCap",new Bn.SFBool(!0)),new N(s.initializeOnly,"solid",new Bn.SFBool(!0)),new N(s.initializeOnly,"ccw",new Bn.SFBool(!0)),new N(s.initializeOnly,"convex",new Bn.SFBool(!0)),new N(s.initializeOnly,"creaseAngle",new Bn.SFFloat),new N(s.initializeOnly,"crossSection",new Bn.MFVec2f(new ke(1,1),new ke(1,-1),new ke(-1,-1),new ke(-1,1),new ke(1,1))),new N(s.initializeOnly,"orientation",new Bn.MFRotation(new Et)),new N(s.initializeOnly,"scale",new Bn.MFVec2f(new ke(1,1))),new N(s.initializeOnly,"spine",new Bn.MFVec3f(new He(0,0,0),new He(0,1,0)))]),getTypeName:function(){return"Extrusion"},getComponentName:function(){return"Geometry3D"},getContainerField:function(){return"geometry"},initialize:function(){Wr.prototype.initialize.call(this),this._set_crossSection.addFieldInterest(this._crossSection),this._set_orientation.addFieldInterest(this._orientation),this._set_scale.addFieldInterest(this._scale),this._set_spine.addFieldInterest(this._spine)},getClosedOrientation:function(){const e=this._orientation;if(e.length){const t=e[0].getValue(),n=e[e.length-1].getValue();return t.equals(n)}return!0},createPoints:function(){const e=new He(1,1,1);return function(){const t=this._crossSection,n=this._orientation,i=this._scale,o=this._spine,r=[],s=this.createRotations();for(let a=0,u=o.length;a<u;++a){const o=s[a];if(n.length&&o.rotate(n[Math.min(a,n.length-1)].getValue()),i.length){const t=i[Math.min(a,i.length-1)].getValue();o.scale(e.set(t.x,1,t.y))}for(let e=0,n=t.length;e<n;++e){const n=t[e].getValue();r.push(o.multVecMatrix(new He(n.x,0,n.y)))}}return r}}(),createRotations:function(){const e=[],t=new He(0,0,0),n=new He(0,0,0),i=new He(0,0,0),o=new He(0,0,0),r=new He(0,0,0),s=new He(0,0,0),a=new Et(0,0,1,0);return function(){const u=this._spine,l=u.length,c=u[0].getValue(),h=u[u.length-1].getValue(),d=c.equals(h)&&this.getClosedOrientation();for(let t=e.length;t<l;++t)e[t]=new Nt;if(e.length=l,t.set(0,0,0),n.set(0,0,0),i.set(0,0,0),d){const e=c;for(let t=1,i=l-2;t<i&&(n.assign(u[t].getValue()).subtract(e).normalize().subtract(s.assign(u[i].getValue()).subtract(e).normalize()).normalize(),n.equals(He.Zero));++t);for(let e=0,t=l-2;e<t&&(i.assign(u[e+1].getValue()).subtract(u[e].getValue()).cross(s.assign(u[t].getValue()).subtract(u[e].getValue())).normalize(),i.equals(He.Zero));++e);}else{for(let e=0,t=l-1;e<t&&(n.assign(u[e+1].getValue()).subtract(u[e].getValue()).normalize(),n.equals(He.Zero));++e);for(let e=1,t=l-1;e<t&&(i.assign(u[e+1].getValue()).subtract(u[e].getValue()).cross(s.assign(u[e-1].getValue()).subtract(u[e].getValue())).normalize(),i.equals(He.Zero));++e);}n.equals(He.Zero)&&n.set(0,1,0),i.equals(He.Zero)&&a.setFromToVec(He.yAxis,n).multVecRot(i.assign(He.zAxis)),t.assign(n).cross(i);const p=c;e[0].set(t.x,t.y,t.z,0,n.x,n.y,n.z,0,i.x,i.y,i.z,0,p.x,p.y,p.z,1),o.assign(n),r.assign(i);for(let a=1,c=l-1;a<c;++a){const l=u[a].getValue();n.assign(u[a+1].getValue()).subtract(l).normalize().subtract(s.assign(u[a-1].getValue()).subtract(l).normalize()).normalize(),i.assign(u[a+1].getValue()).subtract(l).cross(s.assign(u[a-1].getValue()).subtract(l)).normalize(),r.dot(i)<0&&i.negate(),n.equals(He.Zero)?n.assign(o):o.assign(n),i.equals(He.Zero)?i.assign(r):r.assign(i),t.assign(n).cross(i),e[a].set(t.x,t.y,t.z,0,n.x,n.y,n.z,0,i.x,i.y,i.z,0,l.x,l.y,l.z,1)}if(d)e[l-1].assign(e[0]);else{const a=h;n.assign(a).subtract(u[l-2].getValue()).normalize(),l>2&&i.assign(a).subtract(u[l-2].getValue()).cross(s.assign(u[l-3].getValue()).subtract(u[l-2].getValue())).normalize(),r.dot(i)<0&&i.negate(),n.equals(He.Zero)&&n.assign(o),i.equals(He.Zero)&&i.assign(r),t.assign(n).cross(i),e[l-1].set(t.x,t.y,t.z,0,n.x,n.y,n.z,0,i.x,i.y,i.z,0,a.x,a.y,a.z,1)}return e}}(),build:function(){const e=new ke(0,0,0),t=new ke(0,0,0),n=new ke(0,0,0);return function(){const i=!this._ccw.getValue(),o=this._crossSection,r=this._spine,s=r.length,a=this.getTexCoords();if(s<2||o.length<2)return;this.getMultiTexCoords().push(a);const u=o.length;function l(e,t){return e*u+t}const c=r[0].getValue(),h=r[s-1].getValue(),d=c.equals(h)&&this.getClosedOrientation(),p=o[0].getValue(),f=o[o.length-1].getValue(),g=p.equals(f);e.assign(o[0].getValue()),t.assign(o[0].getValue());for(let n=1,i=o.length;n<i;++n)e.min(o[n].getValue()),t.max(o[n].getValue());const m=n.assign(t).subtract(e),_=Math.max(m.x,m.y),y=g?o.length-1:o.length,x=[],w=[],v=this.createPoints();for(let e=0,t=v.length;e<t;++e)x[e]=[];const b=this.getNormals(),S=this.getVertices(),T=o.length-1,E=s-1;let C=l(0,0),O=l(0,g?0:T);for(let e=0;e<E;++e)for(let t=0;t<T;++t){const n=d&&e===s-2?0:e+1,r=g&&t===o.length-2?0:t+1;let u=l(e,t),c=l(e,r),h=l(n,r),p=l(n,t),f=v[u],m=v[c],_=v[h],y=v[p],b=m.distance(_)>=1e-7,M=y.distance(f)>=1e-7;if(i)var N=Yo.normal(_,m,f,new He(0,0,0)),F=Yo.normal(y,_,f,new He(0,0,0));else N=Yo.normal(f,m,_,new He(0,0,0)),F=Yo.normal(f,_,y,new He(0,0,0));if(0==t&&(M?C=u:(u=C,f=v[u])),t==o.length-2&&(b?O=c:(h=O,_=v[h])),b){if(M)a.push(t/T,e/E,0,1);else{const n=(e/E+(e+1)/E)/2;a.push(t/T,n,0,1)}x[u].push(w.length),w.push(N),S.push(f.x,f.y,f.z,1),a.push((t+1)/T,e/E,0,1),x[c].push(w.length),w.push(N),S.push(m.x,m.y,m.z,1),a.push((t+1)/T,(e+1)/E,0,1),x[h].push(w.length),w.push(N),S.push(_.x,_.y,_.z,1)}if(M){if(a.push(t/T,e/E,0,1),x[u].push(w.length),w.push(F),S.push(f.x,f.y,f.z,1),b)a.push((t+1)/T,(e+1)/E,0,1);else{const n=((e+1)/E+e/E)/2;a.push((t+1)/T,n,0,1)}x[h].push(w.length),w.push(F),S.push(_.x,_.y,_.z,1),a.push(t/T,(e+1)/E,0,1),x[p].push(w.length),w.push(F),S.push(y.x,y.y,y.z,1)}}const M=this.refineNormals(x,w,this._creaseAngle.getValue());for(const e of M)b.push(e.x,e.y,e.z);if(_&&y>2){if(this._beginCap.getValue()){const t=0,n=[],r=[];for(let i=0;i<y;++i){const r=l(t,y-1-i),s=v[r].copy();s.index=r,s.texCoord=ke.subtract(o[y-1-i].getValue(),e).divide(_),n.push(s)}if(this._convex.getValue()?Yo.triangulateConvexPolygon(n,r):Yo.triangulatePolygon(n,r),r.length>=3){const e=Yo.normal(v[r[0].index],v[r[1].index],v[r[2].index],new He(0,0,0));i&&e.negate(),this.addCap(a,e,v,r)}}if(this._endCap.getValue()){const t=s-1,n=[],r=[];for(let i=0;i<y;++i){const r=l(t,i),s=v[r].copy();s.index=r,s.texCoord=ke.subtract(o[i].getValue(),e).divide(_),n.push(s)}if(this._convex.getValue()?Yo.triangulateConvexPolygon(n,r):Yo.triangulatePolygon(n,r),r.length>=3){const e=Yo.normal(v[r[0].index],v[r[1].index],v[r[2].index],new He(0,0,0));i&&e.negate(),this.addCap(a,e,v,r)}}}this.setSolid(this._solid.getValue()),this.setCCW(this._ccw.getValue())}}(),addCap:function(e,t,n,i){const o=this.getNormals(),r=this.getVertices();for(let s=0,a=i.length;s<a;s+=3){const a=n[i[s].index],u=n[i[s+1].index],l=n[i[s+2].index],c=i[s].texCoord,h=i[s+1].texCoord,d=i[s+2].texCoord;e.push(c.x,c.y,0,1),e.push(h.x,h.y,0,1),e.push(d.x,d.y,0,1),o.push(t.x,t.y,t.z,t.x,t.y,t.z,t.x,t.y,t.z),r.push(a.x,a.y,a.z,1,u.x,u.y,u.z,1,l.x,l.y,l.z,1)}}});const hm=cm;function dm(e){Wr.call(this,e),this.addType(s.Sphere),this._radius.setUnit("length")}dm.prototype=Object.assign(Object.create(Wr.prototype),{constructor:dm,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new P([new N(s.inputOutput,"metadata",new Bn.SFNode),new N(s.initializeOnly,"radius",new Bn.SFFloat(1)),new N(s.initializeOnly,"solid",new Bn.SFBool(!0))]),getTypeName:function(){return"Sphere"},getComponentName:function(){return"Geometry3D"},getContainerField:function(){return"geometry"},set_live__:function(){Wr.prototype.set_live__.call(this),this.isLive().getValue()?this.getBrowser().getSphereOptions().addInterest("requestRebuild",this):this.getBrowser().getSphereOptions().removeInterest("requestRebuild",this)},build:function(){const e=this.getBrowser().getSphereOptions().getGeometry(),t=Math.abs(this._radius.getValue());if(this.setMultiTexCoords(e.getMultiTexCoords()),this.setNormals(e.getNormals()),1===t)this.setVertices(e.getVertices()),this.getMin().assign(e.getMin()),this.getMax().assign(e.getMax());else{const n=e.getVertices().getValue(),i=this.getVertices();for(let e=0,o=n.length;e<o;e+=4)i.push(t*n[e],t*n[e+1],t*n[e+2],1);this.getMin().set(-t,-t,-t),this.getMax().set(t,t,t)}this.setSolid(this._solid.getValue())}});const pm=dm,fm={Box:im,Cone:rm,Cylinder:am,ElevationGrid:lm,Extrusion:hm,IndexedFaceSet:Uu,Sphere:pm},gm={};for(const e in fm)Bi.addType(e,fm[e]);for(const e in gm)Bi.addAbstractType(e,gm[e]);function mm(e){yr.call(this,e),vr.call(this,e),this.addType(s.StaticGroup),this.group=new ks(this.getExecutionContext()),this.collisionShapes=null,this.shadowShapes=null,this.opaqueShapes=null,this.transparentShapes=null,this.bbox=new hr,this.shadowBBox=new hr}mm.prototype=Object.assign(Object.create(yr.prototype),vr.prototype,{constructor:mm,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new P([new N(s.inputOutput,"metadata",new Bn.SFNode),new N(s.inputOutput,"visible",new Bn.SFBool(!0)),new N(s.inputOutput,"bboxDisplay",new Bn.SFBool),new N(s.initializeOnly,"bboxSize",new Bn.SFVec3f(-1,-1,-1)),new N(s.initializeOnly,"bboxCenter",new Bn.SFVec3f),new N(s.initializeOnly,"children",new Bn.MFNode)]),getTypeName:function(){return"StaticGroup"},getComponentName:function(){return"Grouping"},getContainerField:function(){return"children"},initialize:function(){yr.prototype.initialize.call(this),vr.prototype.initialize.call(this),this._bboxSize.addFieldInterest(this.group._bboxSize),this._bboxCenter.addFieldInterest(this.group._bboxCenter),this._children.addFieldInterest(this.group._children),this.group._bboxSize=this._bboxSize,this.group._bboxCenter=this._bboxCenter,this.group._children=this._children,this.group.setPrivate(!0),this.group.setup(),this.group._isCameraObject.addFieldInterest(this._isCameraObject),this.group._isPickableObject.addFieldInterest(this._isPickableObject),this.group._children.addInterest("set_children__",this),this.setCameraObject(this.group.getCameraObject()),this.setPickableObject(this.group.getPickableObject()),this.set_children__()},getBBox:function(e,t){return e.assign(t?this.shadowBBox:this.bbox)},set_children__:function(){this.group.getBBox(this.bbox),this.group.getBBox(this.shadowBBox,!0),this.collisionShapes=null,this.shadowShapes=null,this.opaqueShapes=null,this.transparentShapes=null},traverse:function(){const e=new nr;return e.intersectsSphere=function(){return!0},function(t,n){switch(t){case sr.CAMERA:return;case sr.POINTER:case sr.COLLISION:{if(!this.collisionShapes){const i=n.getViewVolumes(),o=n.getViewport(),r=n.getProjectionMatrix(),s=n.getModelViewMatrix(),a=n.getNumCollisionShapes();i.push(e.set(r,o,o)),s.push(),s.identity(),this.group.traverse(t,n),s.pop(),i.pop();const u=n.getNumCollisionShapes();this.collisionShapes=n.getCollisionShapes().splice(a,u-a),n.setNumCollisionShapes(a)}const i=n.getModelViewMatrix();for(const e of this.collisionShapes)i.push(),i.multLeft(e.modelViewMatrix),e.shapeNode.traverse(t,n),i.pop();return}case sr.SHADOW:{if(!this.shadowShapes){const i=n.getViewVolumes(),o=n.getViewport(),r=n.getProjectionMatrix(),s=n.getModelViewMatrix(),a=n.getNumShadowShapes();i.push(e.set(r,o,o)),s.push(),s.identity(),this.group.traverse(t,n),s.pop(),i.pop();const u=n.getNumShadowShapes();this.shadowShapes=n.getShadowShapes().splice(a,u-a),n.setNumShadowShapes(a)}const i=n.getModelViewMatrix();for(const e of this.shadowShapes)i.push(),i.multLeft(e.modelViewMatrix),e.shapeNode.traverse(t,n),i.pop();return}case sr.DISPLAY:{if(!this.opaqueShapes){const i=n.getViewVolumes(),o=n.getViewport(),r=n.getProjectionMatrix(),s=n.getModelViewMatrix(),a=n.getNumOpaqueShapes(),u=n.getNumTransparentShapes();i.push(e.set(r,o,o)),s.push(),s.identity(),this.group.traverse(t,n),s.pop(),i.pop();const l=n.getNumOpaqueShapes(),c=n.getNumTransparentShapes();this.opaqueShapes=n.getOpaqueShapes().splice(a,l-a),this.transparentShapes=n.getTransparentShapes().splice(u,c-u),n.setNumOpaqueShapes(a),n.setNumTransparentShapes(u)}const i=n.getModelViewMatrix();for(const e of this.opaqueShapes)i.push(),i.multLeft(e.modelViewMatrix),e.shapeNode.traverse(t,n),i.pop();for(const e of this.transparentShapes)i.push(),i.multLeft(e.modelViewMatrix),e.shapeNode.traverse(t,n),i.pop();return}}}}(),dispose:function(){vr.prototype.dispose.call(this),yr.prototype.dispose.call(this)}});const _m=mm;function ym(e){Tr.call(this,e),this.addType(s.Switch),"2.0"===e.getSpecificationVersion()&&this.addAlias("choice",this._children),this.childNode=null,this.visibleNode=null,this.boundedObject=null}ym.prototype=Object.assign(Object.create(Tr.prototype),{constructor:ym,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new P([new N(s.inputOutput,"metadata",new Bn.SFNode),new N(s.inputOutput,"whichChoice",new Bn.SFInt32(-1)),new N(s.inputOutput,"visible",new Bn.SFBool(!0)),new N(s.inputOutput,"bboxDisplay",new Bn.SFBool),new N(s.initializeOnly,"bboxSize",new Bn.SFVec3f(-1,-1,-1)),new N(s.initializeOnly,"bboxCenter",new Bn.SFVec3f),new N(s.inputOnly,"addChildren",new Bn.MFNode),new N(s.inputOnly,"removeChildren",new Bn.MFNode),new N(s.inputOutput,"children",new Bn.MFNode)]),getTypeName:function(){return"Switch"},getComponentName:function(){return"Grouping"},getContainerField:function(){return"children"},initialize:function(){Tr.prototype.initialize.call(this),this._whichChoice.addInterest("set_child__",this),this._children.addInterest("set_child__",this),this.set_child__()},getSubBBox:function(e,t){if(this._bboxSize.getValue().equals(this.getDefaultBBoxSize())){const n=xr(s.X3DBoundedObject,this.visibleNode);return n?n.getBBox(e,t):e.set()}return e.set(this._bboxSize.getValue(),this._bboxCenter.getValue())},clear:function(){},add:function(){},remove:function(){},set_child__:function(){this.childNode&&(this.childNode._isCameraObject.removeInterest("set_cameraObject__",this),this.childNode._isPickableObject.removeInterest("set_transformSensors__",this)),xr(s.X3DBoundedObject,this.childNode)&&(this.childNode._visible.removeInterest("set_visible__",this),this.childNode._bboxDisplay.removeInterest("set_bboxDisplay__",this));const e=this._whichChoice.getValue();e>=0&&e<this._children.length?(this.childNode=xr(s.X3DChildNode,this._children[e]),this.childNode&&(this.childNode._isCameraObject.addInterest("set_cameraObject__",this),this.childNode._isPickableObject.addInterest("set_transformSensors__",this),xr(s.X3DBoundedObject,this.childNode)&&(this.childNode._visible.addInterest("set_visible__",this),this.childNode._bboxDisplay.addInterest("set_bboxDisplay__",this)),delete this.traverse)):(this.childNode=null,this.traverse=Function.prototype),this.set_transformSensors__(),this.set_visible__(),this.set_bboxDisplay__()},set_cameraObject__:function(){this.childNode&&this.childNode.getCameraObject()?xr(s.X3DBoundedObject,this.childNode)?this.setCameraObject(this.childNode._visible.getValue()):this.setCameraObject(!0):this.setCameraObject(!1)},set_transformSensors__:function(){this.setPickableObject(Boolean(this.getTransformSensors().size||this.childNode&&this.childNode.getPickableObject()))},set_visible__:function(){xr(s.X3DBoundedObject,this.childNode)?this.visibleNode=this.childNode._visible.getValue()?this.childNode:null:this.visibleNode=this.childNode,this.set_cameraObject__()},set_bboxDisplay__:function(){xr(s.X3DBoundedObject,this.childNode)?this.boundedObject=this.childNode._bboxDisplay.getValue()?this.childNode:null:this.boundedObject=null},traverse:function(e,t){switch(e){case sr.POINTER:case sr.CAMERA:case sr.SHADOW:{const n=this.visibleNode;return void(n&&n.traverse(e,t))}case sr.PICKING:{if(this.getTransformSensors().size){const e=t.getModelViewMatrix().get();for(const t of this.getTransformSensors())t.collect(e)}const n=this.childNode;if(n){const i=this.getBrowser().getPickingHierarchy();i.push(this),n.traverse(e,t),i.pop()}return}case sr.COLLISION:{const n=this.childNode;return void(n&&n.traverse(e,t))}case sr.DISPLAY:{const n=this.visibleNode;n&&n.traverse(e,t);const i=this.boundedObject;return void(i&&i.displayBBox(e,t))}}}});const xm=ym;function wm(e){Tr.call(this,e),this.addType(s.X3DTransformMatrix3DNode),this.matrix=new Nt,this.getBBox=this.getGetGroupBBox(),this.traverse=this.getGroupTraverse()}wm.prototype=Object.assign(Object.create(Tr.prototype),{constructor:wm,setMatrix:function(e){e.equals(Nt.Identity)?(this.matrix.identity(),this.getBBox=this.getGetGroupBBox(),this.traverse=this.getGroupTraverse()):(this.matrix.assign(e),this.getBBox=this.getGetBBox(),this.traverse=this.getTraverse())},getMatrix:function(){return this.matrix},setTransform:function(e,t,n,i,o){e.equals(He.Zero)&&t.equals(Et.Identity)&&n.equals(He.One)?(this.matrix.identity(),this.getBBox=this.getGetGroupBBox(),this.traverse=this.getGroupTraverse()):(this.matrix.set(e,t,n,i,o),this.getBBox=this.getGetBBox(),this.traverse=this.getTraverse())},getGetBBox:function(){function e(e,t){return this.getSubBBox(e,t).multRight(this.matrix)}return function(){return e}}(),getGetGroupBBox:function(){return Tr.prototype.getBBox},getTraverse:function(){function e(e,t){const n=t.getModelViewMatrix();n.push(),n.multLeft(this.matrix),Tr.prototype.traverse.call(this,e,t),n.pop()}return function(){return e}}(),getGroupTraverse:function(){return Tr.prototype.traverse}});const vm=wm;function bm(e){vm.call(this,e),this.addType(s.X3DTransformNode),this._translation.setUnit("length"),this._center.setUnit("length")}bm.prototype=Object.assign(Object.create(vm.prototype),{constructor:bm,initialize:function(){vm.prototype.initialize.call(this),this.addInterest("eventsProcessed",this),this.eventsProcessed()},eventsProcessed:function(){this.setTransform(this._translation.getValue(),this._rotation.getValue(),this._scale.getValue(),this._scaleOrientation.getValue(),this._center.getValue())}});const Sm=bm;function Tm(e){Sm.call(this,e),this.addType(s.Transform)}Tm.prototype=Object.assign(Object.create(Sm.prototype),{constructor:Tm,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new P([new N(s.inputOutput,"metadata",new Bn.SFNode),new N(s.inputOutput,"translation",new Bn.SFVec3f),new N(s.inputOutput,"rotation",new Bn.SFRotation),new N(s.inputOutput,"scale",new Bn.SFVec3f(1,1,1)),new N(s.inputOutput,"scaleOrientation",new Bn.SFRotation),new N(s.inputOutput,"center",new Bn.SFVec3f),new N(s.inputOutput,"visible",new Bn.SFBool(!0)),new N(s.inputOutput,"bboxDisplay",new Bn.SFBool),new N(s.initializeOnly,"bboxSize",new Bn.SFVec3f(-1,-1,-1)),new N(s.initializeOnly,"bboxCenter",new Bn.SFVec3f),new N(s.inputOnly,"addChildren",new Bn.MFNode),new N(s.inputOnly,"removeChildren",new Bn.MFNode),new N(s.inputOutput,"children",new Bn.MFNode)]),getTypeName:function(){return"Transform"},getComponentName:function(){return"Grouping"},getContainerField:function(){return"children"}});const Em=Tm,Cm={Group:ks,StaticGroup:_m,Switch:xm,Transform:Em},Om={X3DBoundedObject:vr,X3DGroupingNode:Tr,X3DTransformMatrix3DNode:vm,X3DTransformNode:Sm};for(const e in Cm)Bi.addType(e,Cm[e]);for(const e in Om)Bi.addAbstractType(e,Om[e]);function Nm(e){Os.call(this,e),this.addType(s.ColorInterpolator),this.hsv=[]}Nm.prototype=Object.assign(Object.create(Os.prototype),{constructor:Nm,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new P([new N(s.inputOutput,"metadata",new Bn.SFNode),new N(s.inputOnly,"set_fraction",new Bn.SFFloat),new N(s.inputOutput,"key",new Bn.MFFloat),new N(s.inputOutput,"keyValue",new Bn.MFColor),new N(s.outputOnly,"value_changed",new Bn.SFColor)]),getTypeName:function(){return"ColorInterpolator"},getComponentName:function(){return"Interpolation"},getContainerField:function(){return"children"},initialize:function(){Os.prototype.initialize.call(this),this._keyValue.addInterest("set_keyValue__",this)},set_keyValue__:function(){const e=this._keyValue;e.length<this._key.length&&this._keyValue.resize(this._key.length,e.length?e[this._keyValue.length-1]:new Bn.SFColor),this.hsv.length=0;for(const t of e)this.hsv.push(t.getHSV([]))},interpolate:function(){const e=[];return function(t,n,i){le.lerp(this.hsv[t],this.hsv[n],i,e),this._value_changed.setHSV(e[0],e[1],e[2])}}()});const Fm=Nm;function Mm(e){Os.call(this,e),this.addType(s.CoordinateInterpolator)}Mm.prototype=Object.assign(Object.create(Os.prototype),{constructor:Mm,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new P([new N(s.inputOutput,"metadata",new Bn.SFNode),new N(s.inputOnly,"set_fraction",new Bn.SFFloat),new N(s.inputOutput,"key",new Bn.MFFloat),new N(s.inputOutput,"keyValue",new Bn.MFVec3f),new N(s.outputOnly,"value_changed",new Bn.MFVec3f)]),getTypeName:function(){return"CoordinateInterpolator"},getComponentName:function(){return"Interpolation"},getContainerField:function(){return"children"},set_keyValue__:function(){},interpolate:function(e,t,n){const i=this._keyValue.getValue();let o=this._key.length?Math.floor(this._keyValue.length/this._key.length):0;this._value_changed.length=o;const r=this._value_changed.getValue();t=(e*=o)+(this._key.length>1?o:0),e*=3,t*=3,o*=3;for(let s=0;s<o;s+=3){const o=s+1,a=s+2;r[s]=ee.lerp(i[e+s],i[t+s],n),r[o]=ee.lerp(i[e+o],i[t+o],n),r[a]=ee.lerp(i[e+a],i[t+a],n)}this._value_changed.addEvent()}});const Dm=Mm;function Im(e){Os.call(this,e),this.addType(s.CoordinateInterpolator2D)}Im.prototype=Object.assign(Object.create(Os.prototype),{constructor:Im,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new P([new N(s.inputOutput,"metadata",new Bn.SFNode),new N(s.inputOnly,"set_fraction",new Bn.SFFloat),new N(s.inputOutput,"key",new Bn.MFFloat),new N(s.inputOutput,"keyValue",new Bn.MFVec2f),new N(s.outputOnly,"value_changed",new Bn.MFVec2f)]),getTypeName:function(){return"CoordinateInterpolator2D"},getComponentName:function(){return"Interpolation"},getContainerField:function(){return"children"},set_keyValue__:function(){},interpolate:function(e,t,n){const i=this._keyValue.getValue();let o=this._key.length?Math.floor(this._keyValue.length/this._key.length):0;this._value_changed.length=o;const r=this._value_changed.getValue();t=(e*=o)+(this._key.length>1?o:0),e*=2,t*=2,o*=2;for(let s=0;s<o;s+=2){const o=s+1;r[s]=ee.lerp(i[e+s],i[t+s],n),r[o]=ee.lerp(i[e+o],i[t+o],n)}this._value_changed.addEvent()}});const Rm=Im;function Vm(e){Os.call(this,e),this.addType(s.NormalInterpolator)}Vm.prototype=Object.assign(Object.create(Os.prototype),{constructor:Vm,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new P([new N(s.inputOutput,"metadata",new Bn.SFNode),new N(s.inputOnly,"set_fraction",new Bn.SFFloat),new N(s.inputOutput,"key",new Bn.MFFloat),new N(s.inputOutput,"keyValue",new Bn.MFVec3f),new N(s.outputOnly,"value_changed",new Bn.MFVec3f)]),getTypeName:function(){return"NormalInterpolator"},getComponentName:function(){return"Interpolation"},getContainerField:function(){return"children"},initialize:function(){Os.prototype.initialize.call(this),this._keyValue.addInterest("set_keyValue__",this)},set_keyValue__:function(){},interpolate:function(){const e=new He(0,0,0),t=new He(0,0,0);return function(n,i,o){const r=this._keyValue.getValue();let s=this._key.length>1?Math.floor(this._keyValue.length/this._key.length):0;this._value_changed.length=s;const a=this._value_changed.getValue();i=(n*=s)+s,n*=3,i*=3,s*=3;for(let u=0;u<s;u+=3)try{const s=u+1,l=u+2;e.set(r[n+u],r[n+s],r[n+l]),t.set(r[i+u],r[i+s],r[i+l]);const c=ee.simpleSlerp(e,t,o);a[u]=c[0],a[s]=c[1],a[l]=c[2]}catch(e){}this._value_changed.addEvent()}}()});const Pm=Vm;function Am(e){Os.call(this,e),this.addType(s.PositionInterpolator2D)}Am.prototype=Object.assign(Object.create(Os.prototype),{constructor:Am,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new P([new N(s.inputOutput,"metadata",new Bn.SFNode),new N(s.inputOnly,"set_fraction",new Bn.SFFloat),new N(s.inputOutput,"key",new Bn.MFFloat),new N(s.inputOutput,"keyValue",new Bn.MFVec2f),new N(s.outputOnly,"value_changed",new Bn.SFVec2f)]),getTypeName:function(){return"PositionInterpolator2D"},getComponentName:function(){return"Interpolation"},getContainerField:function(){return"children"},initialize:function(){Os.prototype.initialize.call(this),this._keyValue.addInterest("set_keyValue__",this)},set_keyValue__:function(){const e=this._key,t=this._keyValue;t.length<e.length&&t.resize(e.length,t.length?t[t.length-1]:new Bn.SFVec2f)},interpolate:function(){const e=new ke(0,0);return function(t,n,i){this._value_changed=e.assign(this._keyValue[t].getValue()).lerp(this._keyValue[n].getValue(),i)}}()});const Lm=Am,Um=[],Bm=[],Xm=[],km=new st(0,0,0,0),zm=new Nt(2,-2,1,1,-3,3,-2,-1,0,0,1,0,1,0,0,0);function jm(){this.T0=[],this.T1=[]}jm.prototype={constructor:jm,generate:function(e,t,n,i,o){const r=this.T0,s=this.T1;if(r.length=0,s.length=0,Um.length=0,Bm.length=0,Xm.length=0,t.length>1){if(0===i.length){e?Um.push(this.divide(this.subtract(n[1],n[n.length-2]),2)):Um.push(this.create());for(let e=1,t=n.length-1;e<t;++e)Um.push(this.divide(this.subtract(n[e+1],n[e-1]),2));Um.push(this.copy(Um[0]))}else{for(let e=0,t=i.length;e<t;++e)Um.push(this.copy(i[e]));if(o){let e=0;for(let t=0,i=n.length-1;t<i;++t)e+=this.abs(this.subtract(n[t],n[t+1]));for(let t=0,n=Um.length-1;t<n;++t){const n=this.abs(Um[t]);n&&(Um[t]=this.multiply(Um[t],e/n))}}}if(e){const e=t.length-1,n=t.length-2,i=t[1]-t[0]+t[e]-t[n];Xm.push(2*(t[1]-t[0])/i),Bm.push(2*(t[e]-t[n])/i)}else Xm.push(1),Bm.push(1);for(let e=1,n=t.length-1;e<n;++e){const n=t[e+1]-t[e-1];Xm.push(2*(t[e+1]-t[e])/n),Bm.push(2*(t[e]-t[e-1])/n)}Xm.push(Xm[0]),Bm.push(Bm[0]);for(let e=0,t=Um.length;e<t;++e)r.push(this.multiply(Um[e],Bm[e])),s.push(this.multiply(Um[e],Xm[e]))}else r.push(this.create()),s.push(this.create())},interpolate:function(e,t,n,i){return km.set(Math.pow(n,3),Math.pow(n,2),n,1),this.dot(zm.multVecMatrix(km),i[e],i[t],this.T0[e],this.T1[t])}};const Gm=jm;function Hm(e){const t=new e(0,0,0,0),n=new e(0,0,0,0),i=new e(0,0,0,0),o=new e(0,0,0,0);function r(){this.T0=[],this.T1=[]}return r.prototype=Object.assign(Object.create(Gm.prototype),{constructor:r,create:function(){return new e(0,0,0,0)},copy:function(e){return e.copy()},subtract:function(t,n){return e.subtract(t,n)},multiply:function(t,n){return e.multiply(t,n)},divide:function(t,n){return e.divide(t,n)},abs:function(e){return e.magnitude()},dot:function(e,r,s,a,u){return t.assign(r).multiply(e[0]),n.assign(s).multiply(e[1]),i.assign(a).multiply(e[2]),o.assign(u).multiply(e[3]),t.add(n).add(i).add(o)}}),r}const qm=Hm(He);function Wm(e){Os.call(this,e),this.addType(s.SplinePositionInterpolator),this.spline=new qm}Wm.prototype=Object.assign(Object.create(Os.prototype),{constructor:Wm,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new P([new N(s.inputOutput,"metadata",new Bn.SFNode),new N(s.inputOnly,"set_fraction",new Bn.SFFloat),new N(s.inputOutput,"closed",new Bn.SFBool),new N(s.inputOutput,"key",new Bn.MFFloat),new N(s.inputOutput,"keyValue",new Bn.MFVec3f),new N(s.inputOutput,"keyVelocity",new Bn.MFVec3f),new N(s.inputOutput,"normalizeVelocity",new Bn.SFBool),new N(s.outputOnly,"value_changed",new Bn.SFVec3f)]),getTypeName:function(){return"SplinePositionInterpolator"},getComponentName:function(){return"Interpolation"},getContainerField:function(){return"children"},initialize:function(){Os.prototype.initialize.call(this),this._keyValue.addInterest("set_keyValue__",this),this._keyVelocity.addInterest("set_keyVelocity__",this),this._normalizeVelocity.addInterest("set_normalizeVelocity__",this)},set_keyValue__:function(){const e=this._key,t=this._keyValue;t.length<e.length&&t.resize(e.length,t.length?t[t.length-1]:new Bn.SFVec3f),this.set_keyVelocity__()},set_keyVelocity__:function(){this._keyVelocity.length&&this._keyVelocity.length<this._key.length&&this._keyVelocity.resize(this._key.length,new Bn.SFVec3f),this.set_normalizeVelocity__()},set_normalizeVelocity__:function(){this.spline.generate(this._closed.getValue(),this._key,this._keyValue,this._keyVelocity,this._normalizeVelocity.getValue())},interpolate:function(e,t,n){this._value_changed=this.spline.interpolate(e,t,n,this._keyValue)}});const Ym=Wm,Km=Hm(ke);function Zm(e){Os.call(this,e),this.addType(s.SplinePositionInterpolator2D),this.spline=new Km}Zm.prototype=Object.assign(Object.create(Os.prototype),{constructor:Zm,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new P([new N(s.inputOutput,"metadata",new Bn.SFNode),new N(s.inputOnly,"set_fraction",new Bn.SFFloat),new N(s.inputOutput,"closed",new Bn.SFBool),new N(s.inputOutput,"key",new Bn.MFFloat),new N(s.inputOutput,"keyValue",new Bn.MFVec2f),new N(s.inputOutput,"keyVelocity",new Bn.MFVec2f),new N(s.inputOutput,"normalizeVelocity",new Bn.SFBool),new N(s.outputOnly,"value_changed",new Bn.SFVec2f)]),getTypeName:function(){return"SplinePositionInterpolator2D"},getComponentName:function(){return"Interpolation"},getContainerField:function(){return"children"},initialize:function(){Os.prototype.initialize.call(this),this._keyValue.addInterest("set_keyValue__",this),this._keyVelocity.addInterest("set_keyVelocity__",this),this._normalizeVelocity.addInterest("set_normalizeVelocity__",this)},set_keyValue__:function(){const e=this._key,t=this._keyValue;t.length<e.length&&t.resize(e.length,t.length?t[t.length-1]:new Bn.SFVec2f),this.set_keyVelocity__()},set_keyVelocity__:function(){this._keyVelocity.length&&this._keyVelocity.length<this._key.length&&this._keyVelocity.resize(this._key.length,new Bn.SFVec2f),this.set_normalizeVelocity__()},set_normalizeVelocity__:function(){this.spline.generate(this._closed.getValue(),this._key,this._keyValue,this._keyVelocity,this._normalizeVelocity.getValue())},interpolate:function(e,t,n){this._value_changed=this.spline.interpolate(e,t,n,this._keyValue)}});const Qm=Zm;function $m(){this.T0=[],this.T1=[]}$m.prototype=Object.assign(Object.create(Gm.prototype),{constructor:$m,create:function(){return 0},copy:function(e){return e},subtract:function(e,t){return e-t},multiply:function(e,t){return e*t},divide:function(e,t){return e/t},abs:function(e){return Math.abs(e)},dot:function(e,t,n,i,o){return t*e[0]+n*e[1]+i*e[2]+o*e[3]}});const Jm=$m;function e_(e){Os.call(this,e),this.addType(s.SplineScalarInterpolator),this.spline=new Jm}e_.prototype=Object.assign(Object.create(Os.prototype),{constructor:e_,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new P([new N(s.inputOutput,"metadata",new Bn.SFNode),new N(s.inputOnly,"set_fraction",new Bn.SFFloat),new N(s.inputOutput,"closed",new Bn.SFBool),new N(s.inputOutput,"key",new Bn.MFFloat),new N(s.inputOutput,"keyValue",new Bn.MFFloat),new N(s.inputOutput,"keyVelocity",new Bn.MFFloat),new N(s.inputOutput,"normalizeVelocity",new Bn.SFBool),new N(s.outputOnly,"value_changed",new Bn.SFFloat)]),getTypeName:function(){return"SplineScalarInterpolator"},getComponentName:function(){return"Interpolation"},getContainerField:function(){return"children"},initialize:function(){Os.prototype.initialize.call(this),this._keyValue.addInterest("set_keyValue__",this),this._keyVelocity.addInterest("set_keyVelocity__",this),this._normalizeVelocity.addInterest("set_normalizeVelocity__",this)},set_keyValue__:function(){const e=this._key,t=this._keyValue;t.length<e.length&&t.resize(e.length,t.length?t[t.length-1]:new Bn.SFFloat),this.set_keyVelocity__()},set_keyVelocity__:function(){this._keyVelocity.length&&this._keyVelocity.length<this._key.length&&this._keyVelocity.resize(this._key.length,new Bn.SFFloat),this.set_normalizeVelocity__()},set_normalizeVelocity__:function(){this.spline.generate(this._closed.getValue(),this._key,this._keyValue,this._keyVelocity,this._normalizeVelocity.getValue())},interpolate:function(e,t,n){this._value_changed=this.spline.interpolate(e,t,n,this._keyValue)}});const t_=e_,n_=new Et(0,0,1,0);function i_(){this.s=[]}i_.prototype={constructor:i_,generate:function(e,t,n){const i=this.s;if(i.length=0,t.length>1){e?i.push(Et.spline(n[t.length-2].getValue(),n[0].getValue(),n[1].getValue())):i.push(n[0].getValue());for(let e=1,o=t.length-1;e<o;++e)i.push(Et.spline(n[e-1].getValue(),n[e].getValue(),n[e+1].getValue()));e?i.push(Et.spline(n[t.length-2].getValue(),n[t.length-1].getValue(),n[1].getValue())):i.push(n[t.length-1].getValue())}else t.length>0&&i.push(n[0].getValue().copy())},interpolate:function(e,t,n,i){return n_.assign(i[e].getValue()).squad(this.s[e],this.s[t],i[t].getValue(),n)}};const o_=i_;function r_(e){Os.call(this,e),this.addType(s.SquadOrientationInterpolator),this._keyValue.setUnit("angle"),this._value_changed.setUnit("angle"),this.squad=new o_}r_.prototype=Object.assign(Object.create(Os.prototype),{constructor:r_,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new P([new N(s.inputOutput,"metadata",new Bn.SFNode),new N(s.inputOnly,"set_fraction",new Bn.SFFloat),new N(s.inputOutput,"closed",new Bn.SFBool),new N(s.inputOutput,"key",new Bn.MFFloat),new N(s.inputOutput,"keyValue",new Bn.MFRotation),new N(s.outputOnly,"value_changed",new Bn.SFRotation)]),getTypeName:function(){return"SquadOrientationInterpolator"},getComponentName:function(){return"Interpolation"},getContainerField:function(){return"children"},initialize:function(){Os.prototype.initialize.call(this),this._keyValue.addInterest("set_keyValue__",this)},set_keyValue__:function(){const e=this._key,t=this._keyValue;t.length<e.length&&t.resize(e.length,t.length?t[t.length-1]:new Bn.SFRotation),this.squad.generate(this._closed.getValue(),this._key,this._keyValue)},interpolate:function(e,t,n){try{this._value_changed=this.squad.interpolate(e,t,n,this._keyValue)}catch(e){console.error(e)}}});const s_=r_,a_={ColorInterpolator:Fm,CoordinateInterpolator:Dm,CoordinateInterpolator2D:Rm,EaseInEaseOut:Fs,NormalInterpolator:Pm,OrientationInterpolator:Rs,PositionInterpolator:Ds,PositionInterpolator2D:Lm,ScalarInterpolator:Ls,SplinePositionInterpolator:Ym,SplinePositionInterpolator2D:Qm,SplineScalarInterpolator:t_,SquadOrientationInterpolator:s_},u_={X3DInterpolatorNode:Os};for(const e in a_)Bi.addType(e,a_[e]);for(const e in u_)Bi.addAbstractType(e,u_[e]);const l_={Layer:js,LayerSet:Hs,Viewport:Rl},c_={X3DLayerNode:xs,X3DViewportNode:Cr};for(const e in l_)Bi.addType(e,l_[e]);for(const e in c_)Bi.addAbstractType(e,c_[e]);const h_=[(new Nt).setRotation(new Et(new He(1,0,0),He.zAxis)),(new Nt).setRotation(new Et(new He(-1,0,0),He.zAxis)),(new Nt).setRotation(new Et(new He(0,0,-1),He.zAxis)),(new Nt).setRotation(new Et(new He(0,0,1),He.zAxis)),(new Nt).setRotation(new Et(new He(0,1,0),He.zAxis)),(new Nt).setRotation(new Et(new He(0,-1,0),He.zAxis))],d_=[new st(0,.5,.25,.5),new st(.5,.5,.25,.5),new st(.75,.5,.25,.5),new st(.25,.5,.25,.5),new st(0,0,.5,.5),new st(.5,0,.5,.5)],p_=Ar(f_);function f_(){this.location=new He(0,0,0),this.matrixArray=new Float32Array(9),this.shadowBuffer=null,this.viewVolume=new nr,this.viewport=new st(0,0,0,0),this.projectionMatrix=new Nt,this.modelViewMatrix=new dr(Nt),this.modelMatrix=new Nt,this.invLightSpaceMatrix=new Nt,this.invLightSpaceProjectionMatrix=new Nt,this.shadowMatrix=new Nt,this.shadowMatrixArray=new Float32Array(16),this.rotation=new Et,this.rotationMatrix=new Nt,this.textureUnit=void 0}function g_(e){Mc.call(this,e),this.addType(s.PointLight),this._location.setUnit("length"),this._radius.setUnit("length")}f_.prototype={constructor:f_,getModelViewMatrix:function(){return this.modelViewMatrix},set:function(e,t,n){const i=e.getShadowMapSize();this.browser=e.getBrowser(),this.lightNode=e,this.groupNode=t,this.matrixArray.set(n.submatrix.inverse()),this.modelViewMatrix.pushMatrix(n),e.getShadowIntensity()>0&&i>0&&(this.shadowBuffer=this.browser.popShadowBuffer(i),this.shadowBuffer||console.warn("Couldn't create shadow buffer."))},renderShadowMap:function(e){if(!this.shadowBuffer)return;const t=this.lightNode,n=e.getCameraSpaceMatrix().get(),i=this.modelMatrix.assign(this.modelViewMatrix.get()).multRight(n),o=this.invLightSpaceMatrix.assign(t.getGlobal()?i:Nt.Identity);o.translate(t.getLocation()),o.inverse();const r=t.getShadowMapSize();this.shadowBuffer.bind();for(let t=0;t<6;++t){const n=d_[t],i=this.viewport.set(n[0]*r,n[1]*r,n[2]*r,n[3]*r),s=lr.perspective2(ee.radians(90),.125,1e4,i[2],i[3],this.projectionMatrix);e.getViewVolumes().push(this.viewVolume.set(s,i,i)),e.getProjectionMatrix().pushMatrix(this.projectionMatrix),e.getModelViewMatrix().pushMatrix(h_[t]),e.getModelViewMatrix().multLeft(o),e.render(sr.SHADOW,Tr.prototype.traverse,this.groupNode),e.getModelViewMatrix().pop(),e.getProjectionMatrix().pop(),e.getViewVolumes().pop()}this.shadowBuffer.unbind(),t.getGlobal()||o.multLeft(i.inverse()),this.invLightSpaceProjectionMatrix.assign(o)},setGlobalVariables:function(e){this.modelViewMatrix.get().multVecMatrix(this.location.assign(this.lightNode._location.getValue())),this.shadowBuffer&&(this.shadowMatrix.assign(e.getCameraSpaceMatrix().get()).multRight(this.invLightSpaceProjectionMatrix),this.shadowMatrixArray.set(this.shadowMatrix))},setShaderUniforms:function(e,t){const n=t.numLights++;if(this.shadowBuffer){const i=this.lightNode.getGlobal()?this.textureUnit=void 0!==this.textureUnit?this.textureUnit:this.browser.popTexture2DUnit():this.browser.getTexture2DUnit();void 0!==i?(e.activeTexture(e.TEXTURE0+i),e.HAS_FEATURE_DEPTH_TEXTURE?e.bindTexture(e.TEXTURE_2D,this.shadowBuffer.getDepthTexture()):e.bindTexture(e.TEXTURE_2D,this.shadowBuffer.getColorTexture()),e.uniform1i(t.x3d_ShadowMap[n],i)):console.warn("Not enough combined texture units for shadow map available.")}if(t.hasLight(n,this))return;const i=this.lightNode,o=i.getColor(),r=i.getAttenuation(),s=this.location;if(e.uniform1i(t.x3d_LightType[n],2),e.uniform3f(t.x3d_LightColor[n],o.r,o.g,o.b),e.uniform1f(t.x3d_LightIntensity[n],i.getIntensity()),e.uniform1f(t.x3d_LightAmbientIntensity[n],i.getAmbientIntensity()),e.uniform3f(t.x3d_LightAttenuation[n],Math.max(0,r.x),Math.max(0,r.y),Math.max(0,r.z)),e.uniform3f(t.x3d_LightLocation[n],s.x,s.y,s.z),e.uniform1f(t.x3d_LightRadius[n],i.getRadius()),e.uniformMatrix3fv(t.x3d_LightMatrix[n],!1,this.matrixArray),this.shadowBuffer){const o=i.getShadowColor();e.uniform3f(t.x3d_ShadowColor[n],o.r,o.g,o.b),e.uniform1f(t.x3d_ShadowIntensity[n],i.getShadowIntensity()),e.uniform1f(t.x3d_ShadowBias[n],i.getShadowBias()),e.uniformMatrix4fv(t.x3d_ShadowMatrix[n],!1,this.shadowMatrixArray),e.uniform1i(t.x3d_ShadowMapSize[n],i.getShadowMapSize())}},dispose:function(){this.browser.pushShadowBuffer(this.shadowBuffer),this.browser.pushTexture2DUnit(this.textureUnit),this.modelViewMatrix.clear(),this.shadowBuffer=null,this.textureUnit=void 0,p_.push(this)}},g_.prototype=Object.assign(Object.create(Mc.prototype),{constructor:g_,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new P([new N(s.inputOutput,"metadata",new Bn.SFNode),new N(s.inputOutput,"global",new Bn.SFBool(!0)),new N(s.inputOutput,"on",new Bn.SFBool(!0)),new N(s.inputOutput,"color",new Bn.SFColor(1,1,1)),new N(s.inputOutput,"intensity",new Bn.SFFloat(1)),new N(s.inputOutput,"ambientIntensity",new Bn.SFFloat),new N(s.inputOutput,"attenuation",new Bn.SFVec3f(1,0,0)),new N(s.inputOutput,"location",new Bn.SFVec3f),new N(s.inputOutput,"radius",new Bn.SFFloat(100)),new N(s.inputOutput,"shadows",new Bn.SFBool),new N(s.inputOutput,"shadowColor",new Bn.SFColor),new N(s.inputOutput,"shadowIntensity",new Bn.SFFloat(1)),new N(s.inputOutput,"shadowBias",new Bn.SFFloat(.005)),new N(s.initializeOnly,"shadowMapSize",new Bn.SFInt32(1024))]),getTypeName:function(){return"PointLight"},getComponentName:function(){return"Lighting"},getContainerField:function(){return"children"},getAttenuation:function(){return this._attenuation.getValue()},getLocation:function(){return this._location.getValue()},getRadius:function(){return Math.max(0,this._radius.getValue())},getLights:function(){return p_}});const m_=g_,__=Ar(y_);function y_(){this.location=new He(0,0,0),this.direction=new He(0,0,0),this.matrixArray=new Float32Array(9),this.renderShadow=!0,this.shadowBuffer=null,this.bbox=new hr,this.viewVolume=new nr,this.viewport=new st(0,0,0,0),this.projectionMatrix=new Nt,this.modelViewMatrix=new dr(Nt),this.modelMatrix=new Nt,this.invLightSpaceMatrix=new Nt,this.invLightSpaceProjectionMatrix=new Nt,this.shadowMatrix=new Nt,this.shadowMatrixArray=new Float32Array(16),this.rotation=new Et,this.lightBBoxMin=new He(0,0,0),this.lightBBoxMax=new He(0,0,0),this.textureUnit=void 0}function x_(e){switch(Mc.call(this,e),this.addType(s.SpotLight),e.getSpecificationVersion()){case"2.0":case"3.0":case"3.1":case"3.2":this._beamWidth=1.5708,this._cutOffAngle=.785398}this._location.setUnit("length"),this._radius.setUnit("length"),this._beamWidth.setUnit("angle"),this._cutOffAngle.setUnit("angle")}y_.prototype={constructor:y_,getModelViewMatrix:function(){return this.modelViewMatrix},set:function(e,t,n){const i=e.getShadowMapSize();this.browser=e.getBrowser(),this.lightNode=e,this.groupNode=t,this.matrixArray.set(n.submatrix.inverse()),this.modelViewMatrix.pushMatrix(n),e.getShadowIntensity()>0&&i>0&&(this.shadowBuffer=this.browser.popShadowBuffer(i),this.shadowBuffer||console.warn("Couldn't create shadow buffer."))},renderShadowMap:function(e){if(!this.shadowBuffer)return;const t=this.lightNode,n=e.getCameraSpaceMatrix().get(),i=this.modelMatrix.assign(this.modelViewMatrix.get()).multRight(n),o=this.invLightSpaceMatrix.assign(t.getGlobal()?i:Nt.Identity);o.translate(t.getLocation()),o.rotate(this.rotation.setFromToVec(He.zAxis,this.direction.assign(t.getDirection()).negate())),o.inverse();this.groupNode.getSubBBox(this.bbox,!0).multRight(o).getExtents(this.lightBBoxMin,this.lightBBoxMax);const r=t.getShadowMapSize(),s=Math.min(t.getRadius(),-this.lightBBoxMin.z),a=this.viewport.set(0,0,r,r),u=lr.perspective(2*t.getCutOffAngle(),.125,Math.max(1e4,s),r,r,this.projectionMatrix);this.renderShadow=s>0,this.shadowBuffer.bind(),e.getViewVolumes().push(this.viewVolume.set(u,a,a)),e.getProjectionMatrix().pushMatrix(u),e.getModelViewMatrix().pushMatrix(o),e.render(sr.SHADOW,Tr.prototype.traverse,this.groupNode),e.getModelViewMatrix().pop(),e.getProjectionMatrix().pop(),e.getViewVolumes().pop(),this.shadowBuffer.unbind(),t.getGlobal()||o.multLeft(i.inverse()),this.invLightSpaceProjectionMatrix.assign(o).multRight(u).multRight(t.getBiasMatrix())},setGlobalVariables:function(e){const t=this.lightNode,n=this.modelViewMatrix.get();n.multVecMatrix(this.location.assign(t._location.getValue())),n.multDirMatrix(this.direction.assign(t._direction.getValue())).normalize(),this.shadowBuffer&&(this.shadowMatrix.assign(e.getCameraSpaceMatrix().get()).multRight(this.invLightSpaceProjectionMatrix),this.shadowMatrixArray.set(this.shadowMatrix))},setShaderUniforms:function(e,t){const n=t.numLights++;if(this.shadowBuffer){const i=this.lightNode.getGlobal()?this.textureUnit=void 0!==this.textureUnit?this.textureUnit:this.browser.popTexture2DUnit():this.browser.getTexture2DUnit();void 0!==i?(e.activeTexture(e.TEXTURE0+i),e.HAS_FEATURE_DEPTH_TEXTURE?e.bindTexture(e.TEXTURE_2D,this.shadowBuffer.getDepthTexture()):e.bindTexture(e.TEXTURE_2D,this.shadowBuffer.getColorTexture()),e.uniform1i(t.x3d_ShadowMap[n],i)):console.warn("Not enough combined texture units for shadow map available.")}if(t.hasLight(n,this))return;const i=this.lightNode,o=i.getColor(),r=i.getAttenuation(),s=this.location,a=this.direction;if(e.uniform1i(t.x3d_LightType[n],3),e.uniform3f(t.x3d_LightColor[n],o.r,o.g,o.b),e.uniform1f(t.x3d_LightIntensity[n],i.getIntensity()),e.uniform1f(t.x3d_LightAmbientIntensity[n],i.getAmbientIntensity()),e.uniform3f(t.x3d_LightAttenuation[n],Math.max(0,r.x),Math.max(0,r.y),Math.max(0,r.z)),e.uniform3f(t.x3d_LightLocation[n],s.x,s.y,s.z),e.uniform3f(t.x3d_LightDirection[n],a.x,a.y,a.z),e.uniform1f(t.x3d_LightRadius[n],i.getRadius()),e.uniform1f(t.x3d_LightBeamWidth[n],i.getBeamWidth()),e.uniform1f(t.x3d_LightCutOffAngle[n],i.getCutOffAngle()),e.uniformMatrix3fv(t.x3d_LightMatrix[n],!1,this.matrixArray),this.renderShadow&&this.shadowBuffer){const o=i.getShadowColor();e.uniform3f(t.x3d_ShadowColor[n],o.r,o.g,o.b),e.uniform1f(t.x3d_ShadowIntensity[n],i.getShadowIntensity()),e.uniform1f(t.x3d_ShadowBias[n],i.getShadowBias()),e.uniformMatrix4fv(t.x3d_ShadowMatrix[n],!1,this.shadowMatrixArray),e.uniform1i(t.x3d_ShadowMapSize[n],i.getShadowMapSize())}},dispose:function(){this.browser.pushShadowBuffer(this.shadowBuffer),this.browser.pushTexture2DUnit(this.textureUnit),this.modelViewMatrix.clear(),this.shadowBuffer=null,this.textureUnit=void 0,__.push(this)}},x_.prototype=Object.assign(Object.create(Mc.prototype),{constructor:x_,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new P([new N(s.inputOutput,"metadata",new Bn.SFNode),new N(s.inputOutput,"global",new Bn.SFBool(!0)),new N(s.inputOutput,"on",new Bn.SFBool(!0)),new N(s.inputOutput,"color",new Bn.SFColor(1,1,1)),new N(s.inputOutput,"intensity",new Bn.SFFloat(1)),new N(s.inputOutput,"ambientIntensity",new Bn.SFFloat),new N(s.inputOutput,"attenuation",new Bn.SFVec3f(1,0,0)),new N(s.inputOutput,"location",new Bn.SFVec3f),new N(s.inputOutput,"direction",new Bn.SFVec3f(0,0,-1)),new N(s.inputOutput,"radius",new Bn.SFFloat(100)),new N(s.inputOutput,"beamWidth",new Bn.SFFloat(.785398)),new N(s.inputOutput,"cutOffAngle",new Bn.SFFloat(1.5708)),new N(s.inputOutput,"shadows",new Bn.SFBool),new N(s.inputOutput,"shadowColor",new Bn.SFColor),new N(s.inputOutput,"shadowIntensity",new Bn.SFFloat(1)),new N(s.inputOutput,"shadowBias",new Bn.SFFloat(.005)),new N(s.initializeOnly,"shadowMapSize",new Bn.SFInt32(1024))]),getTypeName:function(){return"SpotLight"},getComponentName:function(){return"Lighting"},getContainerField:function(){return"children"},getAttenuation:function(){return this._attenuation.getValue()},getLocation:function(){return this._location.getValue()},getRadius:function(){return Math.max(0,this._radius.getValue())},getBeamWidth:function(){const e=this._beamWidth.getValue(),t=this.getCutOffAngle();return e>t?t:ee.clamp(e,0,Math.PI/2)},getCutOffAngle:function(){return ee.clamp(this._cutOffAngle.getValue(),0,Math.PI/2)},getLights:function(){return __}});const w_=x_,v_={DirectionalLight:Vc,PointLight:m_,SpotLight:w_},b_={X3DLightNode:Mc};for(const e in v_)Bi.addType(e,v_[e]);for(const e in b_)Bi.addAbstractType(e,b_[e]);function S_(e){Tr.call(this,e),this.addType(s.Billboard),this.matrix=new Nt}S_.prototype=Object.assign(Object.create(Tr.prototype),{constructor:S_,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new P([new N(s.inputOutput,"metadata",new Bn.SFNode),new N(s.inputOutput,"axisOfRotation",new Bn.SFVec3f(0,1,0)),new N(s.inputOutput,"visible",new Bn.SFBool(!0)),new N(s.inputOutput,"bboxDisplay",new Bn.SFBool),new N(s.initializeOnly,"bboxSize",new Bn.SFVec3f(-1,-1,-1)),new N(s.initializeOnly,"bboxCenter",new Bn.SFVec3f),new N(s.inputOnly,"addChildren",new Bn.MFNode),new N(s.inputOnly,"removeChildren",new Bn.MFNode),new N(s.inputOutput,"children",new Bn.MFNode)]),getTypeName:function(){return"Billboard"},getComponentName:function(){return"Navigation"},getContainerField:function(){return"children"},getBBox:function(e,t){return Tr.prototype.getBBox.call(this,e,t).multRight(this.matrix)},getMatrix:function(){return this.matrix},rotate:function(){const e=new Nt,t=new He(0,0,0),n=new He(0,0,0),i=new He(0,0,0),o=new He(0,0,0),r=new Et(0,0,1,0);return function(s){e.assign(s).inverse();const a=e.origin.normalize();if(this._axisOfRotation.getValue().equals(He.Zero)){e.multDirMatrix(t.assign(He.yAxis)).normalize();const i=t.cross(a);n.assign(a).cross(i);const o=a;i.normalize(),n.normalize(),this.matrix.set(i.x,i.y,i.z,0,n.x,n.y,n.z,0,o.x,o.y,o.z,0,0,0,0,1)}else i.assign(this._axisOfRotation.getValue()).cross(a),o.assign(this._axisOfRotation.getValue()).cross(He.zAxis),this.matrix.setRotation(r.setFromToVec(o,i));return this.matrix}}(),traverse:function(e,t){const n=t.getModelViewMatrix();switch(n.push(),e){case sr.CAMERA:case sr.PICKING:case sr.SHADOW:n.multLeft(this.matrix);break;default:n.multLeft(this.rotate(n.get()))}Tr.prototype.traverse.call(this,e,t),n.pop()}});const T_=S_;function E_(e){Tr.call(this,e),vs.call(this,e),this.addType(s.Collision),"2.0"===e.getSpecificationVersion()&&this.addAlias("collide",this._enabled)}E_.prototype=Object.assign(Object.create(Tr.prototype),vs.prototype,{constructor:E_,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new P([new N(s.inputOutput,"metadata",new Bn.SFNode),new N(s.inputOutput,"enabled",new Bn.SFBool(!0)),new N(s.outputOnly,"isActive",new Bn.SFBool),new N(s.outputOnly,"collideTime",new Bn.SFTime),new N(s.inputOutput,"visible",new Bn.SFBool(!0)),new N(s.inputOutput,"bboxDisplay",new Bn.SFBool),new N(s.initializeOnly,"bboxSize",new Bn.SFVec3f(-1,-1,-1)),new N(s.initializeOnly,"bboxCenter",new Bn.SFVec3f),new N(s.initializeOnly,"proxy",new Bn.SFNode),new N(s.inputOnly,"addChildren",new Bn.MFNode),new N(s.inputOnly,"removeChildren",new Bn.MFNode),new N(s.inputOutput,"children",new Bn.MFNode)]),getTypeName:function(){return"Collision"},getComponentName:function(){return"Navigation"},getContainerField:function(){return"children"},initialize:function(){Tr.prototype.initialize.call(this),this.isLive().addInterest("set_live__",this),this._enabled.addInterest("set_live__",this),this._proxy.addInterest("set_proxy__",this),this.set_live__(),this.set_proxy__()},set_live__:function(){this.isLive().getValue()&&this._enabled.getValue()?this.getBrowser().addCollision(this):this.getBrowser().removeCollision(this)},set_active:function(e){this._isActive.getValue()!==e&&(this._isActive=e,e&&(this._collideTime=this.getBrowser().getCurrentTime()))},set_proxy__:function(){this.proxyNode=xr(s.X3DChildNode,this._proxy)},traverse:function(e,t){if(e!==sr.COLLISION)Tr.prototype.traverse.call(this,e,t);else if(this._enabled.getValue()){const n=t.getCollisions();n.push(this),this.proxyNode?this.proxyNode.traverse(e,t):Tr.prototype.traverse.call(this,e,t),n.pop()}},dispose:function(){Tr.prototype.dispose.call(this)}});const C_=E_;function O_(e){Tr.call(this,e),this.addType(s.LOD),"2.0"===e.getSpecificationVersion()&&this.addAlias("level",this._children),this._center.setUnit("length"),this._range.setUnit("length"),this.frameRate=60,this.keepCurrentLevel=!1,this.childNode=null,this.visibleNode=null,this.boundedObject=null}O_.prototype=Object.assign(Object.create(Tr.prototype),{constructor:O_,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new P([new N(s.inputOutput,"metadata",new Bn.SFNode),new N(s.initializeOnly,"forceTransitions",new Bn.SFBool),new N(s.initializeOnly,"center",new Bn.SFVec3f),new N(s.initializeOnly,"range",new Bn.MFFloat),new N(s.outputOnly,"level_changed",new Bn.SFInt32(-1)),new N(s.inputOutput,"visible",new Bn.SFBool(!0)),new N(s.inputOutput,"bboxDisplay",new Bn.SFBool),new N(s.initializeOnly,"bboxSize",new Bn.SFVec3f(-1,-1,-1)),new N(s.initializeOnly,"bboxCenter",new Bn.SFVec3f),new N(s.inputOnly,"addChildren",new Bn.MFNode),new N(s.inputOnly,"removeChildren",new Bn.MFNode),new N(s.inputOutput,"children",new Bn.MFNode)]),getTypeName:function(){return"LOD"},getComponentName:function(){return"Navigation"},getContainerField:function(){return"children"},initialize:function(){Tr.prototype.initialize.call(this),this._children.addInterest("set_child__",this)},getSubBBox:function(e,t){if(this._bboxSize.getValue().equals(this.getDefaultBBoxSize())){const n=xr(s.X3DBoundedObject,this.visibleNode);return n?n.getBBox(e,t):e.set()}return e.set(this._bboxSize.getValue(),this._bboxCenter.getValue())},clear:function(){},add:function(){},remove:function(){},set_child__:function(){this.set_level__(Math.min(this._level_changed.getValue(),this._children.length-1))},set_level__:function(e){this.childNode&&(this.childNode._isCameraObject.removeInterest("set_cameraObject__",this),this.childNode._isPickableObject.removeInterest("set_transformSensors__",this)),xr(s.X3DBoundedObject,this.childNode)&&(this.childNode._visible.removeInterest("set_visible__",this),this.childNode._bboxDisplay.removeInterest("set_bboxDisplay__",this)),e>=0&&e<this._children.length?(this.childNode=xr(s.X3DChildNode,this._children[e]),this.childNode&&(this.childNode._isCameraObject.addInterest("set_cameraObject__",this),this.childNode._isPickableObject.addInterest("set_transformSensors__",this),xr(s.X3DBoundedObject,this.childNode)&&(this.childNode._visible.addInterest("set_visible__",this),this.childNode._bboxDisplay.addInterest("set_bboxDisplay__",this)))):this.childNode=null,this.set_transformSensors__(),this.set_visible__(),this.set_bboxDisplay__()},set_cameraObject__:function(){this.childNode&&this.childNode.getCameraObject()?xr(s.X3DBoundedObject,this.childNode)?this.setCameraObject(this.childNode._visible.getValue()):this.setCameraObject(!0):this.setCameraObject(!1)},set_transformSensors__:function(){this.setPickableObject(Boolean(this.getTransformSensors().size||this.childNode&&this.childNode.getPickableObject()))},set_visible__:function(){xr(s.X3DBoundedObject,this.childNode)?this.visibleNode=this.childNode._visible.getValue()?this.childNode:null:this.visibleNode=this.childNode,this.set_cameraObject__()},set_bboxDisplay__:function(){xr(s.X3DBoundedObject,this.childNode)?this.boundedObject=this.childNode._bboxDisplay.getValue()?this.childNode:null:this.boundedObject=null},getLevel:function(e,t){if(0===this._range.length){this.frameRate=(179*this.frameRate+e.currentFrameRate)/180;const t=this._children.length;switch(t){case 0:return-1;case 1:return 0;case 2:return+(this.frameRate>55);default:{const e=1-ee.clamp((this.frameRate-20)/35,0,1);return Math.min(Math.floor(e*t),t-1)}}}const n=t.translate(this._center.getValue()).origin.magnitude();return ee.upperBound(this._range,0,this._range.length,n)},traverse:function(){const e=new Nt;return function(t,n){switch(t){case sr.POINTER:case sr.CAMERA:case sr.SHADOW:{const e=this.visibleNode;return void(e&&e.traverse(t,n))}case sr.PICKING:{if(this.getTransformSensors().size){const e=n.getModelViewMatrix().get();for(const t of this.getTransformSensors())t.collect(e)}const e=this.childNode;if(e){const i=this.getBrowser().getPickingHierarchy();i.push(this),e.traverse(t,n),i.pop()}return}case sr.COLLISION:{const e=this.childNode;return void(e&&e.traverse(t,n))}case sr.DISPLAY:{if(!this.keepCurrentLevel){let t=this.getLevel(this.getBrowser(),e.assign(n.getModelViewMatrix().get())),i=this._level_changed.getValue();this._forceTransitions.getValue()&&(t>i?t=i+1:t<i&&(t=i-1)),t!==i&&(this._level_changed=t,this.set_level__(Math.min(t,this._children.length-1)))}const i=this.visibleNode;i&&i.traverse(t,n);const o=this.boundedObject;return void(o&&o.displayBBox(t,n))}}}}()});const N_=O_;function F_(e){yr.call(this,e),this.addType(s.ViewpointGroup),this._size.setUnit("length"),this._center.setUnit("length"),this.proximitySensor=new ig(e),this.cameraObjects=[],this.viewpointGroups=[]}function M_(e,t){switch(e){case sr.CAMERA:if(this.proximitySensor.traverse(e,t),this.proximitySensor._isActive.getValue())for(var n=0,i=this.cameraObjects.length;n<i;++n)this.cameraObjects[n].traverse(e,t);return;case sr.DISPLAY:if(this.proximitySensor.traverse(e,t),this.proximitySensor._isActive.getValue())for(n=0,i=this.viewpointGroups.length;n<i;++n)this.viewpointGroups[n].traverse(e,t);return}}function D_(e,t){switch(e){case sr.CAMERA:for(var n=0,i=this.cameraObjects.length;n<i;++n)this.cameraObjects[n].traverse(e,t);return;case sr.DISPLAY:for(n=0,i=this.viewpointGroups.length;n<i;++n)this.viewpointGroups[n].traverse(e,t);return}}F_.prototype=Object.assign(Object.create(yr.prototype),{constructor:F_,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new P([new N(s.inputOutput,"metadata",new Bn.SFNode),new N(s.inputOutput,"description",new Bn.SFString),new N(s.inputOutput,"displayed",new Bn.SFBool(!0)),new N(s.inputOutput,"retainUserOffsets",new Bn.SFBool),new N(s.inputOutput,"size",new Bn.SFVec3f),new N(s.inputOutput,"center",new Bn.SFVec3f),new N(s.inputOutput,"children",new Bn.MFNode)]),getTypeName:function(){return"ViewpointGroup"},getComponentName:function(){return"Navigation"},getContainerField:function(){return"children"},initialize:function(){yr.prototype.initialize.call(this),this.proximitySensor.setup(),this._size.addFieldInterest(this.proximitySensor._size),this._center.addFieldInterest(this.proximitySensor._center),this.proximitySensor._size=this._size,this.proximitySensor._center=this._center,this._displayed.addInterest("set_displayed__",this),this._size.addInterest("set_displayed__",this),this._children.addInterest("set_children__",this),this.set_displayed__(),this.set_children__()},isActive:function(){return this.proximitySensor._isActive.getValue()},set_displayed__:function(){var e=!this._size.getValue().equals(He.Zero),t=this._displayed.getValue();this.proximitySensor._enabled=t&&e,t&&e?(this.proximitySensor._isCameraObject.addFieldInterest(this._isCameraObject),this.proximitySensor._isPickableObject.addFieldInterest(this._isPickableObject),this.setCameraObject(this.proximitySensor.getCameraObject()),this.setPickableObject(this.proximitySensor.getPickableObject()),this.traverse=M_):(this.proximitySensor._isCameraObject.removeFieldInterest(this._isCameraObject),this.proximitySensor._isPickableObject.removeFieldInterest(this._isPickableObject),this.setCameraObject(t),this.setPickableObject(!1),t?this.traverse=D_:delete this.traverse)},set_children__:function(){this.cameraObjects.length=0,this.viewpointGroups.length=0;for(var e=this._children,t=0,n=e.length;t<n;++t)try{for(var i=e[t].getValue().getInnerNode(),o=i.getType(),r=o.length-1;r>=0;--r)switch(o[r]){case s.X3DViewpointNode:this.cameraObjects.push(i);break;case s.ViewpointGroup:this.cameraObjects.push(i),this.viewpointGroups.push(i)}}catch(e){}},traverse:function(){}});const I_=F_,R_={Billboard:T_,Collision:C_,LOD:N_,NavigationInfo:Pr,OrthoViewpoint:zl,Viewpoint:Bs,ViewpointGroup:I_},V_={X3DViewpointNode:Ps};for(const e in R_)Bi.addType(e,R_[e]);for(const e in V_)Bi.addAbstractType(e,V_[e]);function P_(e,t,n,i){this.node=null,this.modelViewMatrix=new Nt,this.projectionMatrix=new Nt,this.viewport=new st(0,0,0,0),this.set(e,t,n,i)}P_.prototype={set:function(e,t,n,i){this.node=e,this.modelViewMatrix.assign(t),this.projectionMatrix.assign(n),this.viewport.assign(i)},set_over__:function(e,t){this.node.set_over__(e,t,this.modelViewMatrix,this.projectionMatrix,this.viewport)},set_active__:function(e,t){this.node.set_active__(e,t,this.modelViewMatrix,this.projectionMatrix,this.viewport)},set_motion__:function(e){this.node.set_motion__(e,this.modelViewMatrix,this.projectionMatrix,this.viewport)}};const A_=P_;function L_(e){vs.call(this,e),this.addType(s.X3DPointingDeviceSensorNode)}L_.prototype=Object.assign(Object.create(vs.prototype),{constructor:L_,initialize:function(){vs.prototype.initialize.call(this),this._enabled.addInterest("set_enabled__",this)},getMatrices:function(){return this.matrices},set_enabled__:function(){this._enabled.getValue()||(this._isActive.getValue()&&(this._isActive=!1),this._isOver.getValue()&&(this._isOver=!1))},set_over__:function(e,t){e!==this._isOver.getValue()&&(this._isOver=e,e&&(this.getBrowser().getNotification()._string=this._description))},set_active__:function(e,t){e!==this._isActive.getValue()&&(this._isActive=e)},set_motion__:function(e){},push:function(e,t){this._enabled.getValue()&&t.set(this,new A_(this,e.getModelViewMatrix().get(),e.getProjectionMatrix().get(),e.getViewVolume().getViewport()))}});const U_=L_;function B_(e){U_.call(this,e),this.addType(s.X3DTouchSensorNode)}B_.prototype=Object.assign(Object.create(U_.prototype),{constructor:B_,set_active__:function(e,t){U_.prototype.set_active__.call(this,e,t),this._enabled.getValue()&&this._isOver.getValue()&&!e&&(this._touchTime=this.getBrowser().getCurrentTime())}});const X_=B_;var k_=new Nt;function z_(e){X_.call(this,e),this.addType(s.TouchSensor),this._hitPoint_changed.setUnit("length")}z_.prototype=Object.assign(Object.create(X_.prototype),{constructor:z_,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new P([new N(s.inputOutput,"metadata",new Bn.SFNode),new N(s.inputOutput,"description",new Bn.SFString),new N(s.inputOutput,"enabled",new Bn.SFBool(!0)),new N(s.outputOnly,"hitTexCoord_changed",new Bn.SFVec2f),new N(s.outputOnly,"hitNormal_changed",new Bn.SFVec3f),new N(s.outputOnly,"hitPoint_changed",new Bn.SFVec3f),new N(s.outputOnly,"isOver",new Bn.SFBool),new N(s.outputOnly,"isActive",new Bn.SFBool),new N(s.outputOnly,"touchTime",new Bn.SFTime)]),getTypeName:function(){return"TouchSensor"},getComponentName:function(){return"PointingDeviceSensor"},getContainerField:function(){return"children"},set_over__:function(e,t,n,i,o){if(X_.prototype.set_over__.call(this,e,t,n,i,o),this._isOver.getValue()){var r=t.intersection;k_.assign(n).inverse(),this._hitTexCoord_changed=r.texCoord,this._hitNormal_changed=n.multMatrixDir(r.normal.copy()).normalize(),this._hitPoint_changed=k_.multVecMatrix(r.point.copy())}}});const j_=z_;function G_(e){Tr.call(this,e),xo.call(this,e),this.addType(s.Anchor),this.touchSensorNode=new j_(e),this.anchorSensors=new Map}G_.prototype=Object.assign(Object.create(Tr.prototype),xo.prototype,{constructor:G_,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new P([new N(s.inputOutput,"metadata",new Bn.SFNode),new N(s.inputOutput,"description",new Bn.SFString),new N(s.inputOutput,"load",new Bn.SFBool(!0)),new N(s.inputOutput,"url",new Bn.MFString),new N(s.inputOutput,"parameter",new Bn.MFString),new N(s.inputOutput,"autoRefresh",new Bn.SFTime),new N(s.inputOutput,"autoRefreshTimeLimit",new Bn.SFTime(3600)),new N(s.inputOutput,"visible",new Bn.SFBool(!0)),new N(s.inputOutput,"bboxDisplay",new Bn.SFBool),new N(s.initializeOnly,"bboxSize",new Bn.SFVec3f(-1,-1,-1)),new N(s.initializeOnly,"bboxCenter",new Bn.SFVec3f),new N(s.inputOnly,"addChildren",new Bn.MFNode),new N(s.inputOnly,"removeChildren",new Bn.MFNode),new N(s.inputOutput,"children",new Bn.MFNode)]),getTypeName:function(){return"Anchor"},getComponentName:function(){return"Networking"},getContainerField:function(){return"children"},initialize:function(){Tr.prototype.initialize.call(this),xo.prototype.initialize.call(this),this._description.addFieldInterest(this.touchSensorNode._description),this._load.addFieldInterest(this.touchSensorNode._enabled),this.touchSensorNode._description=this._description,this.touchSensorNode._enabled=this._load,this.touchSensorNode.setup();const e=this,t=this.touchSensorNode.set_active__;this.touchSensorNode.set_active__=function(n,i){t.call(this,n,i),this._isOver.getValue()&&!n&&e.requestImmediateLoad()}},set_load__:function(){},set_url__:function(){},requestImmediateLoad:function(e=!0){this.setCache(e),this.setLoadState(s.IN_PROGRESS_STATE,!1),new oa(this).createX3DFromURL(this._url,this._parameter,function(e){e?(this.getBrowser().replaceWorld(e),this.setLoadState(s.COMPLETE_STATE,!1)):this.setLoadState(s.FAILED_STATE,!1)}.bind(this),function(e){this.getBrowser().changeViewpoint(e),this.setLoadState(s.COMPLETE_STATE,!1)}.bind(this),function(e,t){t?window.open(e,t):location=e,this.setLoadState(s.COMPLETE_STATE,!1)}.bind(this))},requestUnload(){},traverse:function(e,t){if(e===sr.POINTER){const n=this.getBrowser().getSensors(),i=this.anchorSensors;i.clear(),this.touchSensorNode.push(t,i),i.size?(n.push(i),Tr.prototype.traverse.call(this,e,t),n.pop()):Tr.prototype.traverse.call(this,e,t)}else Tr.prototype.traverse.call(this,e,t)},dispose:function(){xo.prototype.dispose.call(this),Tr.prototype.dispose.call(this)}});const H_=G_;function q_(e){yr.call(this,e),xo.call(this,e),vr.call(this,e),this.addType(s.Inline),this.scene=this.getBrowser().getDefaultScene(),this.group=new ks(e),this.group.addParent(this)}q_.prototype=Object.assign(Object.create(yr.prototype),xo.prototype,vr.prototype,{constructor:q_,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new P([new N(s.inputOutput,"metadata",new Bn.SFNode),new N(s.inputOutput,"load",new Bn.SFBool(!0)),new N(s.inputOutput,"url",new Bn.MFString),new N(s.inputOutput,"autoRefresh",new Bn.SFTime),new N(s.inputOutput,"autoRefreshTimeLimit",new Bn.SFTime(3600)),new N(s.inputOutput,"visible",new Bn.SFBool(!0)),new N(s.inputOutput,"bboxDisplay",new Bn.SFBool),new N(s.initializeOnly,"bboxSize",new Bn.SFVec3f(-1,-1,-1)),new N(s.initializeOnly,"bboxCenter",new Bn.SFVec3f)]),getTypeName:function(){return"Inline"},getComponentName:function(){return"Networking"},getContainerField:function(){return"children"},initialize:function(){yr.prototype.initialize.call(this),xo.prototype.initialize.call(this),vr.prototype.initialize.call(this),this.group.setPrivate(!0),this.group.setup(),this.group._isCameraObject.addFieldInterest(this._isCameraObject),this.group._isPickableObject.addFieldInterest(this._isPickableObject),this.requestImmediateLoad()},getBBox:function(e,t){return this._bboxSize.getValue().equals(this.getDefaultBBoxSize())?this.group.getBBox(e,t):e.set(this._bboxSize.getValue(),this._bboxCenter.getValue())},set_live__:function(){xo.prototype.set_live__.call(this),this.isPrivate()||this.scene.setLive(this.isLive().getValue())},unLoadNow:function(){this.setInternalScene(this.getBrowser().getDefaultScene())},loadNow:function(){new oa(this).createX3DFromURL(this._url,null,this.setInternalSceneAsync.bind(this))},setInternalSceneAsync:function(e){e?(this.setLoadState(s.COMPLETE_STATE),this.setInternalScene(e)):(this.setLoadState(s.FAILED_STATE),this.setInternalScene(this.getBrowser().getDefaultScene()))},setInternalScene:function(e){this.scene.setLive(!1),this.scene.rootNodes.removeFieldInterest(this.group._children),this.scene=e,this.scene.setExecutionContext(this.getExecutionContext()),this.scene.setPrivate(this.getExecutionContext().isPrivate()),this.scene.rootNodes.addFieldInterest(this.group._children),this.group._children=this.scene.rootNodes,this.set_live__(),this.getBrowser().addBrowserEvent()},getInternalScene:function(){return this.scene},traverse:function(e,t){if(e===sr.PICKING){const n=this.getBrowser().getPickingHierarchy();return n.push(this),this.group.traverse(e,t),void n.pop()}this.group.traverse(e,t)},dispose:function(){vr.prototype.dispose.call(this),xo.prototype.dispose.call(this),yr.prototype.dispose.call(this)}});const W_=q_,Y_={Anchor:H_,Inline:W_,LoadSensor:jh},K_={X3DNetworkSensorNode:kh,X3DUrlObject:xo};for(const e in Y_)Bi.addType(e,Y_[e]);for(const e in K_)Bi.addAbstractType(e,K_[e]);function Z_(e){U_.call(this,e),this.addType(s.X3DDragSensorNode),this._trackPoint_changed.setUnit("length")}Z_.prototype=Object.assign(Object.create(U_.prototype),{constructor:Z_});const Q_=Z_;function $_(e,t){this.axis=e.copy(),this.radius=t}$_.prototype={constructor:$_,intersectsLine:function(e,t,n){const i=new Et(this.axis.direction,new He(0,1,0)),o=Nt.Rotation(i),r=1/this.radius,s=new Nt;s.scale(new He(r,r,r)),s.multLeft(o);const a=He.subtract(e.point,this.axis.point),u=new pl(a,e.direction).multLineMatrix(s),l=this.unitCylinderIntersectsLine(u,t,n);if(l){const e=s.inverse();e.multVecMatrix(t),t.add(this.axis.point),e.multVecMatrix(n),n.add(this.axis.point)}return l},unitCylinderIntersectsLine:function(e,t,n){let i,o;const r=e.point,s=e.direction,a=s[0]*s[0]+s[2]*s[2],u=2*(r[0]*s[0]+r[2]*s[2]),l=r[0]*r[0]+r[2]*r[2]-1,c=u*u-4*a*l;if(c<0)return!1;const h=Math.sqrt(c);return u>0?(i=-2*l/(h+u),o=-(h+u)/(2*a)):(i=2*l/(h-u),o=(h-u)/(2*a)),t.assign(s).multiply(i).add(r),n.assign(s).multiply(o).add(r),!0},toString:function(){return this.axis.toString()+" "+this.radius}};const J_=$_;function ey(e){Q_.call(this,e),this.addType(s.CylinderSensor),this._diskAngle.setUnit("angle"),this._minAngle.setUnit("angle"),this._maxAngle.setUnit("angle"),this._offset.setUnit("angle")}ey.prototype=Object.assign(Object.create(Q_.prototype),{constructor:ey,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new P([new N(s.inputOutput,"metadata",new Bn.SFNode),new N(s.inputOutput,"description",new Bn.SFString),new N(s.inputOutput,"enabled",new Bn.SFBool(!0)),new N(s.inputOutput,"axisRotation",new Bn.SFRotation),new N(s.inputOutput,"diskAngle",new Bn.SFFloat(.261792)),new N(s.inputOutput,"minAngle",new Bn.SFFloat),new N(s.inputOutput,"maxAngle",new Bn.SFFloat(-1)),new N(s.inputOutput,"offset",new Bn.SFFloat),new N(s.inputOutput,"autoOffset",new Bn.SFBool(!0)),new N(s.outputOnly,"trackPoint_changed",new Bn.SFVec3f),new N(s.outputOnly,"rotation_changed",new Bn.SFRotation),new N(s.outputOnly,"isOver",new Bn.SFBool),new N(s.outputOnly,"isActive",new Bn.SFBool)]),getTypeName:function(){return"CylinderSensor"},getComponentName:function(){return"PointingDeviceSensor"},getContainerField:function(){return"children"},initialize:function(){Q_.prototype.initialize.call(this),this.modelViewMatrix=new Nt,this.invModelViewMatrix=new Nt,this.cylinder=new J_(new pl(new He(0,0,0),new He(0,0,0)),0),this.disk=!1,this.yPlane=null,this.zPlane=null,this.sxPlane=null,this.szNormal=null,this.behind=!1,this.fromVector=new He(0,0,0),this.startOffset=new Et(0,0,1,0)},isBehind:function(e,t){const n=new He(0,0,0),i=new He(0,0,0);return this.cylinder.intersectsLine(e,n,i),He.subtract(t,n).magnitude()>He.subtract(t,i).magnitude()},getTrackPoint:function(e,t){const n=new He(0,0,0);this.zPlane.intersectsLine(e,n);const i=He.add(n,this.cylinder.axis.getPerpendicularVectorToPoint(n,new He(0,0,0))),o=this.sxPlane.getDistanceToPoint(n)/this.cylinder.radius,r=Math.floor((o+1)/2),s=ee.interval(o,-1,1),a=(0===r?Math.asin(s):s*Math.PI/2)+r*Math.PI;new Et(this.cylinder.axis.direction,a).multVecRot(t.assign(this.szNormal).multiply(this.cylinder.radius)),t.add(i)},getAngle:function(e){return He.dot(e.getAxis(),this.cylinder.axis.direction)>0?e.angle:-e.angle},set_active__:function(e,t,n,i,o){if(Q_.prototype.set_active__.call(this,e,t,n,i,o),this._isActive.getValue()){this.modelViewMatrix.assign(n),this.invModelViewMatrix.assign(n).inverse();const e=t.hitRay.copy().multLineMatrix(this.invModelViewMatrix),i=this.invModelViewMatrix.multVecMatrix(t.intersection.point.copy()),o=this._axisRotation.getValue().multVecRot(new He(0,1,0)),r=this.invModelViewMatrix.multDirMatrix(new He(0,0,1)).normalize(),s=new pl(new He(0,0,0),o),a=s.getPerpendicularVectorToPoint(i,new He(0,0,0)).magnitude();this.cylinder=new J_(s,a),this.disk=Math.abs(He.dot(r,o))>Math.cos(this._diskAngle.getValue()),this.behind=this.isBehind(e,i),this.yPlane=new qo(i,o),this.zPlane=new qo(i,r);const u=this.invModelViewMatrix.origin,l=He.cross(o,u).normalize();this.sxPlane=new qo(new He(0,0,0),l),this.szNormal=He.cross(l,o).normalize();const c=new He(0,0,0);this.disk?this.yPlane.intersectsLine(e,c):this.getTrackPoint(e,c),this.fromVector=this.cylinder.axis.getPerpendicularVectorToPoint(c,new He(0,0,0)).negate(),this.startOffset=new Et(o,this._offset.getValue()),this._trackPoint_changed=c,this._rotation_changed=this.startOffset,this.angle=this._offset.getValue(),this.startVector=this._rotation_changed.getValue().multVecRot(this._axisRotation.getValue().multVecRot(new He(0,0,1)))}else this._autoOffset.getValue()&&(this._offset=this.getAngle(this._rotation_changed.getValue()))},set_motion__:function(e){const t=e.hitRay.copy().multLineMatrix(this.invModelViewMatrix),n=new He(0,0,0);this.disk?this.yPlane.intersectsLine(t,n):this.getTrackPoint(t,n),this._trackPoint_changed=n;const i=this.cylinder.axis.getPerpendicularVectorToPoint(n,new He(0,0,0)).negate(),o=new Et(this.fromVector,i);if(this.disk){this.modelViewMatrix.multVecMatrix(n.copy()).z>0&&o.multRight(new Et(this.yPlane.normal,Math.PI))}else this.behind&&o.inverse();if(o.multLeft(this.startOffset),this._minAngle.getValue()>this._maxAngle.getValue())this._rotation_changed=o;else{const e=o.multVecRot(this._axisRotation.getValue().multVecRot(new He(0,0,1))),t=new Et(this.startVector,e),n=this._axisRotation.getValue().multVecRot(new He(0,1,0)).dot(t.getAxis())>0?1:-1,i=this._minAngle.getValue(),r=this._maxAngle.getValue();this.angle+=n*t.angle,this.startVector.assign(e),this.angle<i?o.setAxisAngle(this.cylinder.axis.direction,i):this.angle>r?o.setAxisAngle(this.cylinder.axis.direction,r):o.setAxisAngle(this.cylinder.axis.direction,this.angle),this._rotation_changed.getValue().equals(o)||(this._rotation_changed=o)}}});const ty=ey,ny=new xl(ke.Zero,ke.Zero),iy=new ke(0,0,0),oy=new pl(He.Zero,He.Zero);function ry(e){Q_.call(this,e),this.addType(s.PlaneSensor),this._offset.setUnit("length"),this._minPosition.setUnit("length"),this._maxPosition.setUnit("length"),this._translation_changed.setUnit("length")}ry.prototype=Object.assign(Object.create(Q_.prototype),{constructor:ry,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new P([new N(s.inputOutput,"metadata",new Bn.SFNode),new N(s.inputOutput,"description",new Bn.SFString),new N(s.inputOutput,"enabled",new Bn.SFBool(!0)),new N(s.inputOutput,"axisRotation",new Bn.SFRotation),new N(s.inputOutput,"autoOffset",new Bn.SFBool(!0)),new N(s.inputOutput,"offset",new Bn.SFVec3f),new N(s.inputOutput,"minPosition",new Bn.SFVec2f),new N(s.inputOutput,"maxPosition",new Bn.SFVec2f(-1,-1)),new N(s.outputOnly,"trackPoint_changed",new Bn.SFVec3f),new N(s.outputOnly,"translation_changed",new Bn.SFVec3f),new N(s.outputOnly,"isOver",new Bn.SFBool),new N(s.outputOnly,"isActive",new Bn.SFBool)]),getTypeName:function(){return"PlaneSensor"},getComponentName:function(){return"PointingDeviceSensor"},getContainerField:function(){return"children"},initialize:function(){Q_.prototype.initialize.call(this),this.modelViewMatrix=new Nt,this.invModelViewMatrix=new Nt,this.projectionMatrix=new Nt,this.viewport=new st,this.planeSensor=!0,this.plane=null,this.line=null,this.startOffset=new He(0,0,0),this.startPoint=new He(0,0,0)},getLineTrackPoint:function(e,t,n){return nr.projectLine(t,this.modelViewMatrix,this.projectionMatrix,this.viewport,ny),ny.getClosestPointToPoint(e.pointer,iy),nr.unProjectRay(iy.x,iy.y,this.modelViewMatrix,this.projectionMatrix,this.viewport,oy),t.getClosestPointToLine(oy,n)},set_active__:function(e,t,n,i,o){if(Q_.prototype.set_active__.call(this,e,t,n,i,o),this._isActive.getValue()){this.modelViewMatrix.assign(n),this.projectionMatrix.assign(i),this.viewport.assign(o),this.invModelViewMatrix.assign(n).inverse();var r=t.hitRay.copy().multLineMatrix(this.invModelViewMatrix),s=this.invModelViewMatrix.multVecMatrix(t.intersection.point.copy()),a=this._axisRotation.getValue();if(this._minPosition.x===this._maxPosition.x){this.planeSensor=!1;var u=a.multVecRot(new He(0,Math.abs(this._maxPosition.y-this._minPosition.y),0));this.line=new pl(s,u.normalize())}else if(this._minPosition.y===this._maxPosition.y){this.planeSensor=!1;u=a.multVecRot(new He(Math.abs(this._maxPosition.x-this._minPosition.x),0,0));this.line=new pl(s,u.normalize())}else this.planeSensor=!0,this.plane=new qo(s,a.multVecRot(new He(0,0,1)));if(this.planeSensor)this.plane.intersectsLine(r,this.startPoint)&&this.trackStart(this.startPoint);else if(this.getLineTrackPoint(t,this.line,this.startPoint)){var l=new He(0,0,0);try{this.getLineTrackPoint(t,new pl(this.line.direction,this.line.direction),l)}catch(e){l=this.startPoint}this.trackStart(l)}}else this._autoOffset.getValue()&&(this._offset=this._translation_changed)},trackStart:function(e){this.startOffset.assign(this._offset.getValue()),this._trackPoint_changed=e,this._translation_changed=this._offset.getValue()},set_motion__:function(e){try{if(this.planeSensor){var t=e.hitRay.copy().multLineMatrix(this.invModelViewMatrix),n=new He(0,0,0);if(!this.plane.intersectsLine(t,n))throw new Error("Plane and line are parallel.");this.track(n,n.copy())}else{n=new He(0,0,0);var i=new He(0,0,0);if(!this.getLineTrackPoint(e,this.line,n))throw new Error("Lines are parallel.");try{this.getLineTrackPoint(e,new pl(He.Zero,this.line.direction),i)}catch(e){i.assign(n)}this.track(n,i)}}catch(e){this._trackPoint_changed.addEvent(),this._translation_changed.addEvent()}},track:function(e,t){var n=this._axisRotation.getValue(),i=Et.inverse(n).multVecRot(e.add(this.startOffset).subtract(this.startPoint));this._minPosition.x>this._maxPosition.x||(i.x=ee.clamp(i.x,this._minPosition.x,this._maxPosition.x)),this._minPosition.y>this._maxPosition.y||(i.y=ee.clamp(i.y,this._minPosition.y,this._maxPosition.y)),n.multVecRot(i),this._trackPoint_changed.getValue().equals(t)||(this._trackPoint_changed=t),this._translation_changed.getValue().equals(i)||(this._translation_changed=i)}});const sy=ry;function ay(e,t){this.radius=e,this.center=t.copy()}ay.prototype={constructor:ay,set:function(e,t){this.radius=e,this.center.assign(t)},intersectsLine:function(e,t,n){const i=e.point,o=e.direction,r=this.center,s=this.radius,a=2*(i.dot(o)-r.dot(o)),u=a*a-4*(i.x*i.x+i.y*i.y+i.z*i.z+(r.x*r.x+r.y*r.y+r.z*r.z)-2*i.dot(r)-s*s);if(u>=0){let e=(-a+Math.sqrt(u))/2,r=(-a-Math.sqrt(u))/2;if(e>r){const t=e;e=r,r=t}return t.assign(o).multiply(e).add(i),n.assign(o).multiply(r).add(i),!0}return!1},intersectsTriangle:function(){const e=new He(0,0,0),t=new He(0,0,0),n=new He(0,0,0),i=new He(0,0,0),o=new He(0,0,0),r=new He(0,0,0),s=new He(0,0,0);return function(a,u,l){const c=this.center,h=this.radius;a.subtract(c),u.subtract(c),l.subtract(c),e.assign(u).subtract(a),t.assign(l).subtract(a);const d=h*h,p=e.cross(t),f=He.dot(a,p);if(f*f>d*He.dot(p,p))return!1;const g=He.dot(a,a),m=He.dot(a,u),_=He.dot(a,l),y=He.dot(u,u),x=He.dot(u,l),w=He.dot(l,l);if(g>d&&m>g&&_>g||y>d&&m>y&&x>y||w>d&&_>w&&x>w)return!1;e.assign(u).subtract(a),n.assign(l).subtract(u),i.assign(a).subtract(l);const v=m-g,b=x-y,S=_-w,T=He.dot(e,e),E=He.dot(n,n),C=He.dot(i,i);o.assign(a).multiply(T).subtract(e.multiply(v)),r.assign(u).multiply(E).subtract(n.multiply(b)),s.assign(l).multiply(C).subtract(i.multiply(S));const O=l.multiply(T).subtract(o),N=a.multiply(E).subtract(r),F=u.multiply(C).subtract(s),M=He.dot(o,o)>d*T*T&&He.dot(o,O)>0,D=He.dot(r,r)>d*E*E&&He.dot(r,N)>0,I=He.dot(s,s)>d*C*C&&He.dot(s,F)>0;return!(M||D||I)}}(),toString:function(){return this.radius+" "+this.center.toString()}};const uy=ay;function ly(e){Q_.call(this,e),this.addType(s.SphereSensor)}ly.prototype=Object.assign(Object.create(Q_.prototype),{constructor:ly,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new P([new N(s.inputOutput,"metadata",new Bn.SFNode),new N(s.inputOutput,"description",new Bn.SFString),new N(s.inputOutput,"enabled",new Bn.SFBool(!0)),new N(s.inputOutput,"autoOffset",new Bn.SFBool(!0)),new N(s.inputOutput,"offset",new Bn.SFRotation),new N(s.outputOnly,"trackPoint_changed",new Bn.SFVec3f),new N(s.outputOnly,"rotation_changed",new Bn.SFRotation),new N(s.outputOnly,"isOver",new Bn.SFBool),new N(s.outputOnly,"isActive",new Bn.SFBool)]),getTypeName:function(){return"SphereSensor"},getComponentName:function(){return"PointingDeviceSensor"},getContainerField:function(){return"children"},initialize:function(){Q_.prototype.initialize.call(this),this.modelViewMatrix=new Nt,this.invModelViewMatrix=new Nt,this.sphere=null,this.zPlane=null,this.behind=!1,this.fromVector=new He(0,0,0),this.startPoint=new He(0,0,0),this.startOffset=new Et(0,0,1,0)},getTrackPoint:function(e,t,n){var i=new He(0,0,0);return!!this.sphere.intersectsLine(e,t,i)&&((He.subtract(e.point,i).magnitude()<He.subtract(e.point,t).magnitude())-n&&t.assign(i),!0)},set_active__:function(e,t,n,i,o){if(Q_.prototype.set_active__.call(this,e,t,n,i,o),this._isActive.getValue()){this.modelViewMatrix.assign(n),this.invModelViewMatrix.assign(n).inverse();var r=this.invModelViewMatrix.multVecMatrix(t.intersection.point.copy()),s=new He(0,0,0);this.zPlane=new qo(s,this.invModelViewMatrix.multDirMatrix(new He(0,0,1)).normalize()),this.sphere=new uy(r.magnitude(),s),this.behind=this.zPlane.getDistanceToPoint(r)<0,this.fromVector.assign(r),this.startPoint.assign(r),this.startOffset.assign(this._offset.getValue()),this._trackPoint_changed=r,this._rotation_changed=this._offset.getValue()}else this._autoOffset.getValue()&&(this._offset=this._rotation_changed)},set_motion__:function(e){var t=e.hitRay.copy().multLineMatrix(this.invModelViewMatrix),n=new He(0,0,0);if(this.getTrackPoint(t,n,this.behind)){var i=this.invModelViewMatrix.multDirMatrix(new He(0,0,1)).normalize();this.zPlane=new qo(n,i)}else{var o=new He(0,0,0);this.zPlane.intersectsLine(t,o),t=new pl(o,He.subtract(this.sphere.center,o).normalize()),this.getTrackPoint(t,n,!1);var r=Yo.normal(this.sphere.center,n,this.startPoint,new He(0,0,0)),s=He.subtract(n,this.sphere.center).normalize(),a=He.cross(r,s).normalize(),u=He.subtract(n,a.multiply(He.subtract(o,n).magnitude()));t=new pl(u,He.subtract(this.sphere.center,u).normalize()),this.getTrackPoint(t,n,!1)}this._trackPoint_changed=n;var l=He.subtract(n,this.sphere.center),c=new Et(this.fromVector,l);this.behind&&c.inverse(),this._rotation_changed=Et.multRight(this.startOffset,c)}});const cy=ly,hy={CylinderSensor:ty,PlaneSensor:sy,SphereSensor:cy,TouchSensor:j_},dy={X3DDragSensorNode:Q_,X3DPointingDeviceSensorNode:U_,X3DTouchSensorNode:X_};for(const e in hy)Bi.addType(e,hy[e]);for(const e in dy)Bi.addAbstractType(e,dy[e]);const py=Ar(fy);function fy(){this.plane=new qo(He.Zero,He.Zero)}function gy(e){yr.call(this,e),this.addType(s.ClipPlane),this.enabled=!1,this.plane=new st(0,0,0,0)}fy.prototype={constructor:fy,isClipped:function(e){return this.plane.getDistanceToPoint(e)<0},set:function(e,t){const n=this.plane,i=e.plane;n.normal.assign(i),n.distanceFromOrigin=-i.w,n.multRight(t)},setShaderUniforms:function(e,t){const n=this.plane,i=n.normal;e.uniform4f(t.x3d_ClipPlane[t.numClipPlanes++],i.x,i.y,i.z,n.distanceFromOrigin)},dispose:function(){py.push(this)}},gy.prototype=Object.assign(Object.create(yr.prototype),{constructor:gy,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new P([new N(s.inputOutput,"metadata",new Bn.SFNode),new N(s.inputOutput,"enabled",new Bn.SFBool(!0)),new N(s.inputOutput,"plane",new Bn.SFVec4f(0,1,0,0))]),getTypeName:function(){return"ClipPlane"},getComponentName:function(){return"Rendering"},getContainerField:function(){return"children"},initialize:function(){yr.prototype.initialize.call(this),this._enabled.addInterest("set_enabled__",this),this._plane.addInterest("set_enabled__",this),this.set_enabled__()},set_enabled__:function(){this.plane.assign(this._plane.getValue()),this.enabled=this._enabled.getValue()&&!this.plane.equals(st.Zero)},push:function(e){if(this.enabled){const t=py.pop();t.set(this,e.getModelViewMatrix().get()),e.getLocalObjects().push(t),++e.getLocalObjectsCount()[0]}},pop:function(e){this.enabled&&(this.getBrowser().getLocalObjects().push(e.getLocalObjects().pop()),--e.getLocalObjectsCount()[0])}});const my=gy;function _y(e){El.call(this,e),this.addType(s.ColorRGBA),this.setTransparent(!0)}_y.prototype=Object.assign(Object.create(El.prototype),{constructor:_y,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new P([new N(s.inputOutput,"metadata",new Bn.SFNode),new N(s.inputOutput,"color",new Bn.MFColorRGBA)]),getTypeName:function(){return"ColorRGBA"},getComponentName:function(){return"Rendering"},getContainerField:function(){return"color"},initialize:function(){El.prototype.initialize.call(this),this._color.addInterest("set_color__",this),this.set_color__()},set_color__:function(){this.color=this._color.getValue(),this.length=this._color.length},addColor:function(e,t){if(e>=0&&e<this.length){const n=this.color;e*=4,t.push(n[e],n[e+1],n[e+2],n[e+3])}else if(this.length){const n=this.color;e=4*(this.length-1),t.push(n[e],n[e+1],n[e+2],n[e+3])}else t.push(1,1,1,1)},addColors:function(e,t){if(this.length){const o=this.color;for(var n=0,i=4*Math.min(t,this.length);n<i;n+=4)e.push(o[n],o[n+1],o[n+2],o[n+3]);if(this.length<t){const r=o[n=4*(this.length-1)],s=o[n+1],a=o[n+2],u=o[n+2];for(n=i,i=4*t;n<i;n+=4)e.push(r,s,a,u)}}else for(let n=0;n<t;++n)e.push(1,1,1,1);return e}});const yy=_y;function xy(e){Au.call(this,e),this.addType(s.IndexedTriangleFanSet),this.triangleIndex=[]}xy.prototype=Object.assign(Object.create(Au.prototype),{constructor:xy,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new P([new N(s.inputOutput,"metadata",new Bn.SFNode),new N(s.inputOnly,"set_index",new Bn.MFInt32),new N(s.initializeOnly,"solid",new Bn.SFBool(!0)),new N(s.initializeOnly,"ccw",new Bn.SFBool(!0)),new N(s.initializeOnly,"colorPerVertex",new Bn.SFBool(!0)),new N(s.initializeOnly,"normalPerVertex",new Bn.SFBool(!0)),new N(s.initializeOnly,"index",new Bn.MFInt32),new N(s.inputOutput,"attrib",new Bn.MFNode),new N(s.inputOutput,"fogCoord",new Bn.SFNode),new N(s.inputOutput,"color",new Bn.SFNode),new N(s.inputOutput,"texCoord",new Bn.SFNode),new N(s.inputOutput,"normal",new Bn.SFNode),new N(s.inputOutput,"coord",new Bn.SFNode)]),getTypeName:function(){return"IndexedTriangleFanSet"},getComponentName:function(){return"Rendering"},getContainerField:function(){return"geometry"},initialize:function(){Au.prototype.initialize.call(this),this._set_index.addFieldInterest(this._index),this._index.addInterest("set_index__",this),this.set_index__()},set_index__:function(){const e=this._index,t=this.triangleIndex;t.length=0;for(let n=0,i=e.length;n<i;++n){const o=e[n];if(!(o<0)&&++n<i){let r=e[n];if(r<0)continue;for(++n;n<i;++n){const i=e[n];if(i<0)break;t.push(o,r,i),r=i}}}},getPolygonIndex:function(e){return this.triangleIndex[e]},build:function(){Au.prototype.build.call(this,3,this.triangleIndex.length,3,this.triangleIndex.length)}});const wy=xy;function vy(e){Au.call(this,e),this.addType(s.IndexedTriangleSet)}vy.prototype=Object.assign(Object.create(Au.prototype),{constructor:vy,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new P([new N(s.inputOutput,"metadata",new Bn.SFNode),new N(s.inputOnly,"set_index",new Bn.MFInt32),new N(s.initializeOnly,"solid",new Bn.SFBool(!0)),new N(s.initializeOnly,"ccw",new Bn.SFBool(!0)),new N(s.initializeOnly,"colorPerVertex",new Bn.SFBool(!0)),new N(s.initializeOnly,"normalPerVertex",new Bn.SFBool(!0)),new N(s.initializeOnly,"index",new Bn.MFInt32),new N(s.inputOutput,"attrib",new Bn.MFNode),new N(s.inputOutput,"fogCoord",new Bn.SFNode),new N(s.inputOutput,"color",new Bn.SFNode),new N(s.inputOutput,"texCoord",new Bn.SFNode),new N(s.inputOutput,"normal",new Bn.SFNode),new N(s.inputOutput,"coord",new Bn.SFNode)]),getTypeName:function(){return"IndexedTriangleSet"},getComponentName:function(){return"Rendering"},getContainerField:function(){return"geometry"},getPolygonIndex:function(e){return this._index[e]},initialize:function(){Au.prototype.initialize.call(this),this._set_index.addFieldInterest(this._index)},build:function(){Au.prototype.build.call(this,3,this._index.length,3,this._index.length)}});const by=vy;function Sy(e){Au.call(this,e),this.addType(s.IndexedTriangleStripSet),this.triangleIndex=[]}Sy.prototype=Object.assign(Object.create(Au.prototype),{constructor:Sy,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new P([new N(s.inputOutput,"metadata",new Bn.SFNode),new N(s.inputOnly,"set_index",new Bn.MFInt32),new N(s.initializeOnly,"solid",new Bn.SFBool(!0)),new N(s.initializeOnly,"ccw",new Bn.SFBool(!0)),new N(s.initializeOnly,"colorPerVertex",new Bn.SFBool(!0)),new N(s.initializeOnly,"normalPerVertex",new Bn.SFBool(!0)),new N(s.initializeOnly,"index",new Bn.MFInt32),new N(s.inputOutput,"attrib",new Bn.MFNode),new N(s.inputOutput,"fogCoord",new Bn.SFNode),new N(s.inputOutput,"color",new Bn.SFNode),new N(s.inputOutput,"texCoord",new Bn.SFNode),new N(s.inputOutput,"normal",new Bn.SFNode),new N(s.inputOutput,"coord",new Bn.SFNode)]),getTypeName:function(){return"IndexedTriangleStripSet"},getComponentName:function(){return"Rendering"},getContainerField:function(){return"geometry"},initialize:function(){Au.prototype.initialize.call(this),this._set_index.addFieldInterest(this._index),this._index.addInterest("set_index__",this),this.set_index__()},set_index__:function(){const e=this._index,t=this.triangleIndex;t.length=0;for(let n=0,i=e.length;n<i;++n){let o=e[n];if(!(o<0)&&++n<i){let r=e[n];if(r<0)continue;++n;for(let s=0;n<i;++n,++s){const i=e[n];if(i<0)break;t.push(o,r,i),1&s?r=i:o=i}}}},getPolygonIndex:function(e){return this.triangleIndex[e]},build:function(){Au.prototype.build.call(this,3,this.triangleIndex.length,3,this.triangleIndex.length)}});const Ty=Sy;function Ey(e){vl.call(this,e),this.addType(s.LineSet),this.fogCoordNode=null,this.colorNode=null,this.normalNode=null,this.coordNode=null}Ey.prototype=Object.assign(Object.create(vl.prototype),{constructor:Ey,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new P([new N(s.inputOutput,"metadata",new Bn.SFNode),new N(s.inputOutput,"vertexCount",new Bn.MFInt32),new N(s.inputOutput,"attrib",new Bn.MFNode),new N(s.inputOutput,"fogCoord",new Bn.SFNode),new N(s.inputOutput,"color",new Bn.SFNode),new N(s.inputOutput,"normal",new Bn.SFNode),new N(s.inputOutput,"coord",new Bn.SFNode)]),getTypeName:function(){return"LineSet"},getComponentName:function(){return"Rendering"},getContainerField:function(){return"geometry"},initialize:function(){vl.prototype.initialize.call(this),this._attrib.addInterest("set_attrib__",this),this._fogCoord.addInterest("set_fogCoord__",this),this._color.addInterest("set_color__",this),this._normal.addInterest("set_normal__",this),this._coord.addInterest("set_coord__",this),this.set_attrib__(),this.set_fogCoord__(),this.set_color__(),this.set_normal__(),this.set_coord__()},set_attrib__:function(){const e=this.getAttrib();for(const t of e)t.removeInterest("requestRebuild",this),t._attribute_changed.removeInterest("updateVertexArrays",this);e.length=0;for(const t of this._attrib){const n=xr(s.X3DVertexAttributeNode,t);n&&e.push(n)}for(const t of e)t.addInterest("requestRebuild",this),t._attribute_changed.addInterest("updateVertexArrays",this);this.updateVertexArrays()},set_fogCoord__:function(){this.fogCoordNode&&this.fogCoordNode.removeInterest("requestRebuild",this),this.fogCoordNode=xr(s.FogCoordinate,this._fogCoord),this.fogCoordNode&&this.fogCoordNode.addInterest("requestRebuild",this)},set_color__:function(){this.colorNode&&(this.colorNode.removeInterest("requestRebuild",this),this.colorNode._transparent.removeInterest("set_transparent__",this)),this.colorNode=xr(s.X3DColorNode,this._color),this.colorNode?(this.colorNode.addInterest("requestRebuild",this),this.colorNode._transparent.addInterest("set_transparent__",this),this.set_transparent__()):this.setTransparent(!1)},set_transparent__:function(){this.setTransparent(this.colorNode.getTransparent())},set_normal__:function(){this.normalNode&&this.normalNode.removeInterest("requestRebuild",this),this.normalNode=xr(s.X3DNormalNode,this._normal),this.normalNode&&this.normalNode.addInterest("requestRebuild",this)},set_coord__:function(){this.coordNode&&this.coordNode.removeInterest("requestRebuild",this),this.coordNode=xr(s.X3DCoordinateNode,this._coord),this.coordNode&&this.coordNode.addInterest("requestRebuild",this)},build:function(){if(!this.coordNode||this.coordNode.isEmpty())return;const e=this._vertexCount,t=this.getAttrib(),n=t.length,i=this.getAttribs(),o=this.fogCoordNode,r=this.colorNode,s=this.coordNode,a=this.getFogDepths(),u=this.getColors(),l=this.getVertices(),c=s.getSize();let h=0;for(let d of e){if(h+d>c)break;if(d>1){d=2*d-2;for(let e=0;e<d;++e,h+=1&e){for(let e=0;e<n;++e)t[e].addValue(h,i[e]);o&&o.addDepth(h,a),r&&r.addColor(h,u),s.addPoint(h,l)}++h}else h+=d}}});const Cy=Ey;function Oy(e){Xu.call(this,e),this.addType(s.X3DNormalNode)}Oy.prototype=Object.assign(Object.create(Xu.prototype),{constructor:Oy});const Ny=Oy;function Fy(e){Ny.call(this,e),this.addType(s.Normal)}Fy.prototype=Object.assign(Object.create(Ny.prototype),{constructor:Fy,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new P([new N(s.inputOutput,"metadata",new Bn.SFNode),new N(s.inputOutput,"vector",new Bn.MFVec3f)]),getTypeName:function(){return"Normal"},getComponentName:function(){return"Rendering"},getContainerField:function(){return"normal"},initialize:function(){Ny.prototype.initialize.call(this),this._vector.addInterest("set_vector__",this),this.set_vector__()},set_vector__:function(){this.vector=this._vector.getValue(),this.length=this._vector.length},set1Vector:function(e,t){this._vector[e]=t},get1Vector:function(e,t){if(e>=0&&e<this.length){const n=this.vector;return e*=3,t.set(n[e],n[e+1],n[e+2])}if(e>=0&&this.length){const n=this.vector;return e%=this.length,e*=3,t.set(n[e],n[e+1],n[e+2])}return t.set(0,0,0)},addVector:function(e,t){if(e>=0&&e<this.length){const n=this.vector;e*=3,t.push(n[e],n[e+1],n[e+2])}else{if(!(e>=0&&this.length))return t.push(0,0,0);{const n=this.vector;e%=this.length,e*=3,t.push(n[e],n[e+1],n[e+2])}}}});const My=Fy;function Dy(e){Wr.call(this,e);const t=this.getBrowser();this.setGeometryType(0),this.setPrimitiveMode(t.getContext().POINTS),this.setSolid(!1),this.setTransparent(!0)}Dy.prototype=Object.assign(Object.create(Wr.prototype),{constructor:Dy,intersectsLine:function(){const e=new hr,t=new He(0,0,0),n=new He(0,0,0),i=new He(0,0,0),o=new He(0,0,0),r=new He(0,0,0),s=new He(0,0,0),a=new Nt,u=new ke(0,0),l=new He(0,0,0);return function(c,h,d,p,f){const g=h.getModelViewMatrix().get(),m=h.getViewVolume().getViewport(),_=(e.assign(this.getBBox()).multRight(g).getExtents(t,n),p.getPointProperties()),y=Math.max(1.5,_?_.getPointSize(t)/2:1),x=h.getViewpoint().getScreenScale(t,m,i),w=d.multDirMatrix(x.multiply(y)),v=Math.max(1.5,_?_.getPointSize(n)/2:1),b=h.getViewpoint().getScreenScale(n,m,o),S=d.multDirMatrix(b.multiply(v));if(this.intersectsBBox(c,w.abs().max(S.abs()))){const e=this.getBrowser().getPointer(),t=h.getProjectionMatrix().get(),n=h.getLocalObjects(),i=this.getVertices(),o=i.length;a.assign(g).multRight(t);for(let t=0;t<o;t+=4){r.set(i[t+0],i[t+1],i[t+2]),nr.projectPointMatrix(r,a,m,u);const o=Math.max(1.5,_?_.getPointSize(g.multVecMatrix(s.assign(r)))/2:1);if(u.distance(e)<=o){if(n.length&&this.isClipped(g.multVecMatrix(l.assign(r)),n))continue;const t=e.copy().subtract(u).divide(o).add(ke.One).divide(2),i=g.submatrix.transpose().z.copy().normalize();f.push({texCoord:t,normal:i,point:r.copy()})}}}return f.length}}(),intersectsLineWithGeometry:function(){return!1},intersectsBox:function(e,t,n){return!1},buildTexCoords:function(){},display:function(e,t){const n=t.appearanceNode,i=n.getShader(this,t),o=n.getBlendMode(),r=this.getAttrib(),s=this.getAttribBuffers();if(o&&o.enable(e),i.enable(e),i.setUniforms(e,this,t),this.vertexArrayObject.enable(e,i)){for(let t=0,n=r.length;t<n;++t)r[t].enable(e,i,s[t]);this.hasFogCoords&&i.enableFogDepthAttribute(e,this.fogDepthBuffer,0,0),this.colorMaterial&&i.enableColorAttribute(e,this.colorBuffer,0,0),i.enableVertexAttribute(e,this.vertexBuffer,0,0)}e.drawArrays(this.primitiveMode,0,this.vertexCount),o&&o.disable(e)},displayParticles:function(e,t,n){const i=t.appearanceNode,o=i.getShader(this,t),r=i.getBlendMode(),s=this.getAttrib(),a=this.getAttribBuffers();r&&r.enable(e),o.enable(e),o.setUniforms(e,this,t);const u=n.outputParticles;if(u.vertexArrayObject.update(this.updateParticles).enable(e,o)){const t=n.particleStride;o.enableParticleAttribute(e,u,t,n.particleOffset,1),o.enableParticleMatrixAttribute(e,u,t,n.matrixOffset,1);for(let t=0,n=s.length;t<n;++t)s[t].enable(e,o,a[t]);this.hasFogCoords&&o.enableFogDepthAttribute(e,this.fogDepthBuffer,0,0),this.colorMaterial&&o.enableColorAttribute(e,this.colorBuffer,0,0),o.enableVertexAttribute(e,this.vertexBuffer,0,0),this.updateParticles=!1}e.drawArraysInstanced(this.primitiveMode,0,this.vertexCount,n.numParticles),r&&r.disable(e)}});const Iy=Dy;function Ry(e){Iy.call(this,e),this.addType(s.PointSet),this.fogCoordNode=null,this.colorNode=null,this.normalNode=null,this.coordNode=null}Ry.prototype=Object.assign(Object.create(Iy.prototype),{constructor:Ry,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new P([new N(s.inputOutput,"metadata",new Bn.SFNode),new N(s.inputOutput,"attrib",new Bn.MFNode),new N(s.inputOutput,"fogCoord",new Bn.SFNode),new N(s.inputOutput,"color",new Bn.SFNode),new N(s.inputOutput,"normal",new Bn.SFNode),new N(s.inputOutput,"coord",new Bn.SFNode)]),getTypeName:function(){return"PointSet"},getComponentName:function(){return"Rendering"},getContainerField:function(){return"geometry"},initialize:function(){Iy.prototype.initialize.call(this),this._attrib.addInterest("set_attrib__",this),this._fogCoord.addInterest("set_fogCoord__",this),this._color.addInterest("set_color__",this),this._normal.addInterest("set_normal__",this),this._coord.addInterest("set_coord__",this),this.set_attrib__(),this.set_fogCoord__(),this.set_color__(),this.set_normal__(),this.set_coord__()},getCoord:function(){return this.coordNode},set_attrib__:function(){const e=this.getAttrib();for(const t of e)t.removeInterest("requestRebuild",this),t._attribute_changed.removeInterest("updateVertexArrays",this);e.length=0;for(const t of this._attrib){const n=xr(s.X3DVertexAttributeNode,t);n&&e.push(n)}for(const t of e)t.addInterest("requestRebuild",this),t._attribute_changed.addInterest("updateVertexArrays",this);this.updateVertexArrays()},set_fogCoord__:function(){this.fogCoordNode&&this.fogCoordNode.removeInterest("requestRebuild",this),this.fogCoordNode=xr(s.FogCoordinate,this._fogCoord),this.fogCoordNode&&this.fogCoordNode.addInterest("requestRebuild",this)},set_color__:function(){this.colorNode&&this.colorNode.removeInterest("requestRebuild",this),this.colorNode=xr(s.X3DColorNode,this._color),this.colorNode&&this.colorNode.addInterest("requestRebuild",this)},set_normal__:function(){this.normalNode&&this.normalNode.removeInterest("requestRebuild",this),this.normalNode=xr(s.X3DNormalNode,this._normal),this.normalNode&&this.normalNode.addInterest("requestRebuild",this)},set_coord__:function(){this.coordNode&&this.coordNode.removeInterest("requestRebuild",this),this.coordNode=xr(s.X3DCoordinateNode,this._coord),this.coordNode&&this.coordNode.addInterest("requestRebuild",this)},build:function(){if(!this.coordNode||this.coordNode.isEmpty())return;const e=this.getAttrib(),t=e.length,n=this.getAttribs(),i=this.fogCoordNode,o=this.getFogDepths(),r=this.colorNode,s=this.getColors(),a=this.coordNode,u=this.getVertices(),l=a._point.length;for(let i=0;i<t;++i)for(let t=0;t<l;++t)e[i].addValue(t,n[i]);i&&i.addDepths(o,l),r&&r.addColors(s,l),a.addPoints(u,l)}});const Vy=Ry;function Py(e){Au.call(this,e),this.addType(s.TriangleFanSet),this.triangleIndex=[]}Py.prototype=Object.assign(Object.create(Au.prototype),{constructor:Py,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new P([new N(s.inputOutput,"metadata",new Bn.SFNode),new N(s.initializeOnly,"solid",new Bn.SFBool(!0)),new N(s.initializeOnly,"ccw",new Bn.SFBool(!0)),new N(s.initializeOnly,"colorPerVertex",new Bn.SFBool(!0)),new N(s.initializeOnly,"normalPerVertex",new Bn.SFBool(!0)),new N(s.inputOutput,"fanCount",new Bn.MFInt32),new N(s.inputOutput,"attrib",new Bn.MFNode),new N(s.inputOutput,"fogCoord",new Bn.SFNode),new N(s.inputOutput,"color",new Bn.SFNode),new N(s.inputOutput,"texCoord",new Bn.SFNode),new N(s.inputOutput,"normal",new Bn.SFNode),new N(s.inputOutput,"coord",new Bn.SFNode)]),getTypeName:function(){return"TriangleFanSet"},getComponentName:function(){return"Rendering"},getContainerField:function(){return"geometry"},initialize:function(){Au.prototype.initialize.call(this),this._fanCount.addInterest("set_fanCount__",this),this.set_fanCount__()},set_fanCount__:function(){const e=this._fanCount,t=this.triangleIndex;t.length=0;let n=0;for(const i of e){for(let e=1,o=i-1;e<o;++e)t.push(n,n+e,n+e+1);n+=i}},getPolygonIndex:function(e){return this.triangleIndex[e]},build:function(){Au.prototype.build.call(this,3,this.triangleIndex.length,3,this.triangleIndex.length)}});const Ay=Py;function Ly(e){Au.call(this,e),this.addType(s.TriangleSet)}Ly.prototype=Object.assign(Object.create(Au.prototype),{constructor:Ly,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new P([new N(s.inputOutput,"metadata",new Bn.SFNode),new N(s.initializeOnly,"solid",new Bn.SFBool(!0)),new N(s.initializeOnly,"ccw",new Bn.SFBool(!0)),new N(s.initializeOnly,"colorPerVertex",new Bn.SFBool(!0)),new N(s.initializeOnly,"normalPerVertex",new Bn.SFBool(!0)),new N(s.inputOutput,"attrib",new Bn.MFNode),new N(s.inputOutput,"fogCoord",new Bn.SFNode),new N(s.inputOutput,"color",new Bn.SFNode),new N(s.inputOutput,"texCoord",new Bn.SFNode),new N(s.inputOutput,"normal",new Bn.SFNode),new N(s.inputOutput,"coord",new Bn.SFNode)]),getTypeName:function(){return"TriangleSet"},getComponentName:function(){return"Rendering"},getContainerField:function(){return"geometry"},build:function(){this.getCoord()&&Au.prototype.build.call(this,3,this.getCoord().getSize(),3,this.getCoord().getSize())},createNormals:function(e,t){return this.createFaceNormals(e,t)}});const Uy=Ly;function By(e){Au.call(this,e),this.addType(s.TriangleStripSet),this.triangleIndex=[]}By.prototype=Object.assign(Object.create(Au.prototype),{constructor:By,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new P([new N(s.inputOutput,"metadata",new Bn.SFNode),new N(s.initializeOnly,"solid",new Bn.SFBool(!0)),new N(s.initializeOnly,"ccw",new Bn.SFBool(!0)),new N(s.initializeOnly,"colorPerVertex",new Bn.SFBool(!0)),new N(s.initializeOnly,"normalPerVertex",new Bn.SFBool(!0)),new N(s.inputOutput,"stripCount",new Bn.MFInt32),new N(s.inputOutput,"attrib",new Bn.MFNode),new N(s.inputOutput,"fogCoord",new Bn.SFNode),new N(s.inputOutput,"color",new Bn.SFNode),new N(s.inputOutput,"texCoord",new Bn.SFNode),new N(s.inputOutput,"normal",new Bn.SFNode),new N(s.inputOutput,"coord",new Bn.SFNode)]),getTypeName:function(){return"TriangleStripSet"},getComponentName:function(){return"Rendering"},getContainerField:function(){return"geometry"},initialize:function(){Au.prototype.initialize.call(this),this._stripCount.addInterest("set_stripCount__",this),this.set_stripCount__()},set_stripCount__:function(){const e=this._stripCount,t=this.triangleIndex;t.length=0;let n=0;for(const i of e){for(let e=0,o=i-2;e<o;++e){const i=1&e;t.push(n+(i?e+1:e),n+(i?e:e+1),n+(e+2))}n+=i}},getPolygonIndex:function(e){return this.triangleIndex[e]},build:function(){Au.prototype.build.call(this,3,this.triangleIndex.length,3,this.triangleIndex.length)}});const Xy=By,ky={ClipPlane:my,Color:Ol,ColorRGBA:yy,Coordinate:Gu,IndexedLineSet:Sl,IndexedTriangleFanSet:wy,IndexedTriangleSet:by,IndexedTriangleStripSet:Ty,LineSet:Cy,Normal:My,PointSet:Vy,TriangleFanSet:Ay,TriangleSet:Uy,TriangleStripSet:Xy},zy={X3DColorNode:El,X3DComposedGeometryNode:Au,X3DCoordinateNode:zu,X3DGeometricPropertyNode:Xu,X3DGeometryNode:Wr,X3DLineGeometryNode:vl,X3DNormalNode:Ny};for(const e in ky)Bi.addType(e,ky[e]);for(const e in zy)Bi.addAbstractType(e,zy[e]);function jy(e){Xu.call(this,e),this.addType(s.X3DVertexAttributeNode),this.addChildObjects("attribute_changed",new Bn.SFTime)}jy.prototype=Object.assign(Object.create(Xu.prototype),{constructor:jy,initialize:function(){Xu.prototype.initialize.call(this),this._name.addInterest("set_attribute__",this)},set_attribute__:function(){this._attribute_changed=this.getBrowser().getCurrentTime()}});const Gy=jy;function Hy(e){Gy.call(this,e),this.addType(s.FloatVertexAttribute)}Hy.prototype=Object.assign(Object.create(Gy.prototype),{constructor:Hy,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new P([new N(s.inputOutput,"metadata",new Bn.SFNode),new N(s.initializeOnly,"name",new Bn.SFString),new N(s.initializeOnly,"numComponents",new Bn.SFInt32(4)),new N(s.inputOutput,"value",new Bn.MFFloat)]),getTypeName:function(){return"FloatVertexAttribute"},getComponentName:function(){return"Shaders"},getContainerField:function(){return"attrib"},initialize:function(){Gy.prototype.initialize.call(this),this._numComponents.addInterest("set_numComponents__",this),this._numComponents.addInterest("set_attribute__",this),this._value.addInterest("set_value__",this),this.set_numComponents__(),this.set_value__()},set_numComponents__:function(){this.numComponents=ee.clamp(this._numComponents.getValue(),1,4)},set_value__:function(){this.value=this._value.getValue(),this.length=this._value.length},addValue:function(e,t){const n=this.value;let i=e*this.numComponents,o=i+this.numComponents;if(o<=this.length)for(;i<o;++i)t.push(n[i]);else if(this.numComponents<=this.length)for(o=n.length,i=o-this.numComponents;i<o;++i)t.push(n[i]);else for(;i<o;++i)t.push(0)},enable:function(e,t,n){t.enableFloatAttrib(e,this._name.getValue(),n,this.numComponents,0,0)}});const qy=Hy;function Wy(e){Gy.call(this,e),this.addType(s.Matrix3VertexAttribute)}Wy.prototype=Object.assign(Object.create(Gy.prototype),{constructor:Wy,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new P([new N(s.inputOutput,"metadata",new Bn.SFNode),new N(s.initializeOnly,"name",new Bn.SFString),new N(s.inputOutput,"value",new Bn.MFMatrix3f)]),getTypeName:function(){return"Matrix3VertexAttribute"},getComponentName:function(){return"Shaders"},getContainerField:function(){return"attrib"},initialize:function(){Gy.prototype.initialize.call(this),this._value.addInterest("set_value__",this),this.set_value__()},set_value__:function(){this.value=this._value.getValue(),this.length=this._value.length},addValue:function(e,t){if(e<this.length){const n=this.value;for(let i=9*e,o=i+9;i<o;++i)t.push(n[i])}else if(this.length){const n=this.value;for(let i=9*(e=this.length-1),o=i+9;i<o;++i)t.push(n[i])}else{const e=et.Identity;for(let n=0;n<9;++n)t.push(e[n])}},enable:function(e,t,n){t.enableMatrix3Attrib(e,this._name.getValue(),n,0,0)}});const Yy=Wy;function Ky(e){Gy.call(this,e),this.addType(s.Matrix4VertexAttribute)}Ky.prototype=Object.assign(Object.create(Gy.prototype),{constructor:Ky,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new P([new N(s.inputOutput,"metadata",new Bn.SFNode),new N(s.initializeOnly,"name",new Bn.SFString),new N(s.inputOutput,"value",new Bn.MFMatrix4f)]),getTypeName:function(){return"Matrix4VertexAttribute"},getComponentName:function(){return"Shaders"},getContainerField:function(){return"attrib"},initialize:function(){Gy.prototype.initialize.call(this),this._value.addInterest("set_value__",this),this.set_value__()},set_value__:function(){this.value=this._value.getValue(),this.length=this._value.length},addValue:function(e,t){if(e<this.length){const n=this.value;for(let i=16*e,o=i+16;i<o;++i)t.push(n[i])}else if(this.length){const n=this.value;for(let i=16*(e=this.length-1),o=i+16;i<o;++i)t.push(n[i])}else{const e=Matrix4.Identity;for(let n=0;n<16;++n)t.push(e[n])}},enable:function(e,t,n){t.enableMatrix4Attrib(e,this._name.getValue(),n,0,0)}});const Zy=Ky;function Qy(e){Ph.call(this,e),xo.call(this,e),Bh.call(this,e),this.addType(s.PackagedShader)}Qy.prototype=Object.assign(Object.create(Ph.prototype),xo.prototype,Bh.prototype,{constructor:Qy,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new P([new N(s.inputOutput,"metadata",new Bn.SFNode),new N(s.inputOnly,"activate",new Bn.SFBool),new N(s.outputOnly,"isSelected",new Bn.SFBool),new N(s.outputOnly,"isValid",new Bn.SFBool),new N(s.initializeOnly,"language",new Bn.SFString),new N(s.inputOutput,"load",new Bn.SFBool(!0)),new N(s.inputOutput,"url",new Bn.MFString),new N(s.inputOutput,"autoRefresh",new Bn.SFTime),new N(s.inputOutput,"autoRefreshTimeLimit",new Bn.SFTime(3600))]),getTypeName:function(){return"PackagedShader"},getComponentName:function(){return"Shaders"},getContainerField:function(){return"shaders"},getSourceText:function(){return this._url},requestImmediateLoad:function(e=!0){},requestUnload:function(){},initialize:function(){Ph.prototype.initialize.call(this),xo.prototype.initialize.call(this),Bh.prototype.initialize.call(this)},dispose:function(){Bh.prototype.dispose.call(this),xo.prototype.dispose.call(this),Ph.prototype.dispose.call(this)}});const $y=Qy;function Jy(e){Ph.call(this,e),this.addType(s.ProgramShader)}Jy.prototype=Object.assign(Object.create(Ph.prototype),{constructor:Jy,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new P([new N(s.inputOutput,"metadata",new Bn.SFNode),new N(s.inputOnly,"activate",new Bn.SFBool),new N(s.outputOnly,"isSelected",new Bn.SFBool),new N(s.outputOnly,"isValid",new Bn.SFBool),new N(s.initializeOnly,"language",new Bn.SFString),new N(s.inputOutput,"programs",new Bn.MFNode)]),getTypeName:function(){return"ProgramShader"},getComponentName:function(){return"Shaders"},getContainerField:function(){return"shaders"}});const ex=Jy;function tx(e){ji.call(this,e),xo.call(this,e),Bh.call(this,e),this.addType(s.ShaderProgram)}tx.prototype=Object.assign(Object.create(ji.prototype),xo.prototype,Bh.prototype,{constructor:tx,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new P([new N(s.inputOutput,"metadata",new Bn.SFNode),new N(s.initializeOnly,"type",new Bn.SFString("VERTEX")),new N(s.inputOutput,"load",new Bn.SFBool(!0)),new N(s.inputOutput,"url",new Bn.MFString),new N(s.inputOutput,"autoRefresh",new Bn.SFTime),new N(s.inputOutput,"autoRefreshTimeLimit",new Bn.SFTime(3600))]),getTypeName:function(){return"ShaderProgram"},getComponentName:function(){return"Shaders"},getContainerField:function(){return"programs"},getSourceText:function(){return this._url},requestImmediateLoad:function(e=!0){},requestUnload:function(){},initialize:function(){ji.prototype.initialize.call(this),xo.prototype.initialize.call(this),Bh.prototype.initialize.call(this)},dispose:function(){Bh.prototype.dispose.call(this),xo.prototype.dispose.call(this),ji.prototype.dispose.call(this)}});const nx=tx,ix={ComposedShader:Hh,FloatVertexAttribute:qy,Matrix3VertexAttribute:Yy,Matrix4VertexAttribute:Zy,PackagedShader:$y,ProgramShader:ex,ShaderPart:ud,ShaderProgram:nx},ox={X3DProgrammableShaderObject:Bh,X3DShaderNode:Ph,X3DVertexAttributeNode:Gy};for(const e in ix)Bi.addType(e,ix[e]);for(const e in ox)Bi.addAbstractType(e,ox[e]);function rx(e){os.call(this,e),this.addType(s.AcousticProperties)}rx.prototype=Object.assign(Object.create(os.prototype),{constructor:rx,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new P([new N(s.inputOutput,"metadata",new Bn.SFNode),new N(s.inputOutput,"description",new Bn.SFString),new N(s.inputOutput,"enabled",new Bn.SFBool(!0)),new N(s.inputOutput,"absorption",new Bn.SFFloat),new N(s.inputOutput,"refraction",new Bn.SFFloat),new N(s.inputOutput,"diffuse",new Bn.SFFloat),new N(s.inputOutput,"specular",new Bn.SFFloat)]),getTypeName:function(){return"AcousticProperties"},getComponentName:function(){return"Shape"},getContainerField:function(){return"AcousticProperties"}});const sx=rx;function ax(e){os.call(this,e),this.addType(s.FillProperties),this.addChildObjects("transparent",new Bn.SFBool),this._transparent.setAccessType(s.outputOnly),this.hatchColor=new Float32Array(3)}ax.prototype=Object.assign(Object.create(os.prototype),{constructor:ax,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new P([new N(s.inputOutput,"metadata",new Bn.SFNode),new N(s.inputOutput,"filled",new Bn.SFBool(!0)),new N(s.inputOutput,"hatched",new Bn.SFBool(!0)),new N(s.inputOutput,"hatchColor",new Bn.SFColor(1,1,1)),new N(s.inputOutput,"hatchStyle",new Bn.SFInt32(1))]),getTypeName:function(){return"FillProperties"},getComponentName:function(){return"Shape"},getContainerField:function(){return"fillProperties"},initialize:function(){os.prototype.initialize.call(this),this._filled.addInterest("set_filled__",this),this._hatched.addInterest("set_hatched__",this),this._hatchColor.addInterest("set_hatchColor__",this),this._hatchStyle.addInterest("set_hatchStyle__",this),this.set_filled__(),this.set_hatched__(),this.set_hatchColor__(),this.set_hatchStyle__()},set_filled__:function(){this.filled=this._filled.getValue(),this.setTransparent(!this.filled)},set_hatched__:function(){this.hatched=this._hatched.getValue()},set_hatchColor__:function(){this.hatchColor[0]=this._hatchColor[0],this.hatchColor[1]=this._hatchColor[1],this.hatchColor[2]=this._hatchColor[2]},set_hatchStyle__:function(){let e=this._hatchStyle.getValue();(e<1||e>19)&&(e=1),this.hatchStyle=e},setTransparent:function(e){e!==this._transparent.getValue()&&(this._transparent=e)},getTransparent:function(){return this._transparent.getValue()},setShaderUniforms:function(e,t){const n=this.hatched;if(e.uniform1i(t.x3d_FillPropertiesFilled,this.filled),e.uniform1i(t.x3d_FillPropertiesHatched,n),n){const n=this.getBrowser(),i=n.getHatchStyleTexture(this.hatchStyle),o=n.getTexture2DUnit();e.uniform3fv(t.x3d_FillPropertiesHatchColor,this.hatchColor),e.activeTexture(e.TEXTURE0+o),e.bindTexture(e.TEXTURE_2D,i.getTexture()),e.uniform1i(t.x3d_FillPropertiesTexture,o)}}});const ux=ax;function lx(e){os.call(this,e),this.addType(s.LineProperties)}lx.prototype=Object.assign(Object.create(os.prototype),{constructor:lx,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new P([new N(s.inputOutput,"metadata",new Bn.SFNode),new N(s.inputOutput,"applied",new Bn.SFBool(!0)),new N(s.inputOutput,"linetype",new Bn.SFInt32(1)),new N(s.inputOutput,"linewidthScaleFactor",new Bn.SFFloat)]),getTypeName:function(){return"LineProperties"},getComponentName:function(){return"Shape"},getContainerField:function(){return"lineProperties"},initialize:function(){os.prototype.initialize.call(this),this._applied.addInterest("set_applied__",this),this._linetype.addInterest("set_linetype__",this),this._linewidthScaleFactor.addInterest("set_linewidthScaleFactor__",this),this.set_applied__(),this.set_linetype__(),this.set_linewidthScaleFactor__()},getApplied:function(){return this.applied},getLinetype:function(){return this.linetype},getLinewidthScaleFactor:function(){return this.linewidthScaleFactor},getTransformLines:function(){return this.transformLines},set_applied__:function(){this.applied=this._applied.getValue()},set_linetype__:function(){let e=this._linetype.getValue();(e<1||e>16)&&(e=1),this.linetype=e},set_linewidthScaleFactor__:function(){const e=this.getBrowser().getContext();this.linewidthScaleFactor=Math.max(1,this._linewidthScaleFactor.getValue()),this.transformLines=e.HAS_FEATURE_TRANSFORMED_LINES&&this.linewidthScaleFactor>1},setShaderUniforms:function(e,t){if(this.applied){const n=this.getBrowser(),i=n.getTexture2DUnit();e.lineWidth(this.linewidthScaleFactor),e.uniform1i(t.x3d_LinePropertiesApplied,!0),e.uniform1i(t.x3d_LinePropertiesLinetype,this.linetype),e.activeTexture(e.TEXTURE0+i),e.bindTexture(e.TEXTURE_2D,n.getLinetypeTexture().getTexture()),e.uniform1i(t.x3d_LinePropertiesTexture,i)}else e.lineWidth(1),e.uniform1i(t.x3d_LinePropertiesApplied,!1)}});const cx=lx;function hx(e){vd.call(this,e),this.addType(s.Material),this.diffuseColor=new Float32Array(3),this.specularColor=new Float32Array(3)}hx.prototype=Object.assign(Object.create(vd.prototype),{constructor:hx,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new P([new N(s.inputOutput,"metadata",new Bn.SFNode),new N(s.inputOutput,"ambientIntensity",new Bn.SFFloat(.2)),new N(s.inputOutput,"ambientTexture",new Bn.SFNode),new N(s.inputOutput,"ambientTextureMapping",new Bn.SFString),new N(s.inputOutput,"diffuseColor",new Bn.SFColor(.8,.8,.8)),new N(s.inputOutput,"diffuseTexture",new Bn.SFNode),new N(s.inputOutput,"diffuseTextureMapping",new Bn.SFString),new N(s.inputOutput,"specularColor",new Bn.SFColor),new N(s.inputOutput,"specularTexture",new Bn.SFNode),new N(s.inputOutput,"specularTextureMapping",new Bn.SFString),new N(s.inputOutput,"emissiveColor",new Bn.SFColor),new N(s.inputOutput,"emissiveTexture",new Bn.SFNode),new N(s.inputOutput,"emissiveTextureMapping",new Bn.SFString),new N(s.inputOutput,"shininess",new Bn.SFFloat(.2)),new N(s.inputOutput,"shininessTexture",new Bn.SFNode),new N(s.inputOutput,"shininessTextureMapping",new Bn.SFString),new N(s.inputOutput,"occlusionStrength",new Bn.SFFloat(1)),new N(s.inputOutput,"occlusionTexture",new Bn.SFNode),new N(s.inputOutput,"occlusionTextureMapping",new Bn.SFString),new N(s.inputOutput,"normalScale",new Bn.SFFloat(1)),new N(s.inputOutput,"normalTexture",new Bn.SFNode),new N(s.inputOutput,"normalTextureMapping",new Bn.SFString),new N(s.inputOutput,"transparency",new Bn.SFFloat)]),getTypeName:function(){return"Material"},getComponentName:function(){return"Shape"},getContainerField:function(){return"material"},initialize:function(){vd.prototype.initialize.call(this),this._ambientIntensity.addInterest("set_ambientIntensity__",this),this._ambientTexture.addInterest("set_ambientTexture__",this),this._diffuseColor.addInterest("set_diffuseColor__",this),this._diffuseTexture.addInterest("set_diffuseTexture__",this),this._specularColor.addInterest("set_specularColor__",this),this._specularTexture.addInterest("set_specularTexture__",this),this._shininess.addInterest("set_shininess__",this),this._shininessTexture.addInterest("set_shininessTexture__",this),this._occlusionStrength.addInterest("set_occlusionStrength__",this),this._occlusionTexture.addInterest("set_occlusionTexture__",this),this.set_ambientIntensity__(),this.set_ambientTexture__(),this.set_diffuseColor__(),this.set_diffuseTexture__(),this.set_specularColor__(),this.set_specularTexture__(),this.set_shininess__(),this.set_shininessTexture__(),this.set_occlusionStrength__(),this.set_occlusionTexture__(),this.set_transparent__()},set_ambientIntensity__:function(){this.ambientIntensity=ee.clamp(this._ambientIntensity.getValue(),0,1)},set_ambientTexture__:function(){this.ambientTextureNode=xr(s.X3DSingleTextureNode,this._ambientTexture),this.setTexture(this.getTextureIndices().AMBIENT_TEXTURE,this.ambientTextureNode)},set_diffuseColor__:function(){const e=this.diffuseColor,t=this._diffuseColor.getValue();e[0]=t.r,e[1]=t.g,e[2]=t.b},set_diffuseTexture__:function(){this.diffuseTextureNode&&this.diffuseTextureNode._transparent.removeInterest("set_transparent__",this),this.diffuseTextureNode=xr(s.X3DSingleTextureNode,this._diffuseTexture),this.diffuseTextureNode&&this.diffuseTextureNode._transparent.addInterest("set_transparent__",this),this.setTexture(this.getTextureIndices().DIFFUSE_TEXTURE,this.diffuseTextureNode)},set_specularColor__:function(){const e=this.specularColor,t=this._specularColor.getValue();e[0]=t.r,e[1]=t.g,e[2]=t.b},set_specularTexture__:function(){this.specularTextureNode=xr(s.X3DSingleTextureNode,this._specularTexture),this.setTexture(this.getTextureIndices().SPECULAR_TEXTURE,this.specularTextureNode)},set_shininess__:function(){this.shininess=ee.clamp(this._shininess.getValue(),0,1)},set_shininessTexture__:function(){this.shininessTextureNode=xr(s.X3DSingleTextureNode,this._shininessTexture),this.setTexture(this.getTextureIndices().SHININESS_TEXTURE,this.shininessTextureNode)},set_occlusionStrength__:function(){this.occlusionStrength=ee.clamp(this._occlusionStrength.getValue(),0,1)},set_occlusionTexture__:function(){this.occlusionTextureNode=xr(s.X3DSingleTextureNode,this._occlusionTexture),this.setTexture(this.getTextureIndices().OCCLUSION_TEXTURE,this.occlusionTextureNode)},set_transparent__:function(){this.setTransparent(Boolean(this.getTransparency()||this.diffuseTextureNode&&this.diffuseTextureNode.getTransparent()))},getTextureIndices:function(){let e=0;const t={EMISSIVE_TEXTURE:e++,NORMAL_TEXTURE:e++,AMBIENT_TEXTURE:e++,DIFFUSE_TEXTURE:e++,SPECULAR_TEXTURE:e++,SHININESS_TEXTURE:e++,OCCLUSION_TEXTURE:e++};return function(){return t}}(),getMaterialKey:function(e){return e||+this.getTextureBits()||this.getBrowser().getBrowserOptions().getShading()===gi.PHONG?"2":"1"},createShader:function(e,t,n){const i=this.getBrowser(),o=this.getShaderOptions(t,n);if(t.hasNormals)switch(o.push("X3D_MATERIAL"),+this.getTextureBits()&&(this.ambientTextureNode&&o.push("X3D_AMBIENT_TEXTURE","X3D_AMBIENT_TEXTURE_"+this.ambientTextureNode.getTextureTypeString()),this.diffuseTextureNode&&o.push("X3D_DIFFUSE_TEXTURE","X3D_DIFFUSE_TEXTURE_"+this.diffuseTextureNode.getTextureTypeString()),this.specularTextureNode&&o.push("X3D_SPECULAR_TEXTURE","X3D_SPECULAR_TEXTURE_"+this.specularTextureNode.getTextureTypeString()),this.shininessTextureNode&&o.push("X3D_SHININESS_TEXTURE","X3D_SHININESS_TEXTURE_"+this.shininessTextureNode.getTextureTypeString()),this.occlusionTextureNode&&o.push("X3D_OCCLUSION_TEXTURE","X3D_OCCLUSION_TEXTURE_"+this.occlusionTextureNode.getTextureTypeString())),this.getMaterialKey(n&&n.shadows)){case"1":var r=i.createShader("GouraudShader","Gouraud","Gouraud",o);break;case"2":r=i.createShader("PhongShader","Default","Phong",o)}else{o.push("X3D_UNLIT_MATERIAL");r=i.createShader("UnlitShader","Default","Unlit",o);i.getShaders().set(e.replace(/^(\d{1,2})\d*/,"$1").replace(/\d$/,"0"),r)}return i.getShaders().set(e,r),r},setShaderUniforms:function(e,t,n,i,o){if(vd.prototype.setShaderUniforms.call(this,e,t,n,i,o),e.uniform1f(t.x3d_AmbientIntensity,this.ambientIntensity),e.uniform3fv(t.x3d_DiffuseColor,this.diffuseColor),e.uniform3fv(t.x3d_SpecularColor,this.specularColor),e.uniform1f(t.x3d_Shininess,this.shininess),+this.getTextureBits()){if(this.ambientTextureNode){const r=t.x3d_AmbientTexture;this.ambientTextureNode.setShaderUniforms(e,t,n,r),e.uniform1i(r.textureTransformMapping,i.get(this._ambientTextureMapping.getValue())||0),e.uniform1i(r.textureCoordinateMapping,o.get(this._ambientTextureMapping.getValue())||0)}if(this.diffuseTextureNode){const r=t.x3d_DiffuseTexture;this.diffuseTextureNode.setShaderUniforms(e,t,n,r),e.uniform1i(r.textureTransformMapping,i.get(this._diffuseTextureMapping.getValue())||0),e.uniform1i(r.textureCoordinateMapping,o.get(this._diffuseTextureMapping.getValue())||0)}if(this.specularTextureNode){const r=t.x3d_SpecularTexture;this.specularTextureNode.setShaderUniforms(e,t,n,r),e.uniform1i(r.textureTransformMapping,i.get(this._specularTextureMapping.getValue())||0),e.uniform1i(r.textureCoordinateMapping,o.get(this._specularTextureMapping.getValue())||0)}if(this.shininessTextureNode){const r=t.x3d_ShininessTexture;this.shininessTextureNode.setShaderUniforms(e,t,n,r),e.uniform1i(r.textureTransformMapping,i.get(this._shininessTextureMapping.getValue())||0),e.uniform1i(r.textureCoordinateMapping,o.get(this._shininessTextureMapping.getValue())||0)}if(this.occlusionTextureNode){const r=t.x3d_OcclusionTexture;e.uniform1f(t.x3d_OcclusionStrength,this.occlusionStrength),this.occlusionTextureNode.setShaderUniforms(e,t,n,r),e.uniform1i(r.textureTransformMapping,i.get(this._occlusionTextureMapping.getValue())||0),e.uniform1i(r.textureCoordinateMapping,o.get(this._occlusionTextureMapping.getValue())||0)}}}});const dx=hx;function px(e){vd.call(this,e),this.addType(s.PhysicalMaterial),this.baseColor=new Float32Array(3)}px.prototype=Object.assign(Object.create(vd.prototype),{constructor:px,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new P([new N(s.inputOutput,"metadata",new Bn.SFNode),new N(s.inputOutput,"baseColor",new Bn.SFColor(1,1,1)),new N(s.inputOutput,"baseTexture",new Bn.SFNode),new N(s.inputOutput,"baseTextureMapping",new Bn.SFString),new N(s.inputOutput,"emissiveColor",new Bn.SFColor(0,0,0)),new N(s.inputOutput,"emissiveTexture",new Bn.SFNode),new N(s.inputOutput,"emissiveTextureMapping",new Bn.SFString),new N(s.inputOutput,"metallic",new Bn.SFFloat(1)),new N(s.inputOutput,"roughness",new Bn.SFFloat(1)),new N(s.inputOutput,"metallicRoughnessTexture",new Bn.SFNode),new N(s.inputOutput,"metallicRoughnessTextureMapping",new Bn.SFString),new N(s.inputOutput,"occlusionStrength",new Bn.SFFloat(1)),new N(s.inputOutput,"occlusionTexture",new Bn.SFNode),new N(s.inputOutput,"occlusionTextureMapping",new Bn.SFString),new N(s.inputOutput,"normalScale",new Bn.SFFloat(1)),new N(s.inputOutput,"normalTexture",new Bn.SFNode),new N(s.inputOutput,"normalTextureMapping",new Bn.SFString),new N(s.inputOutput,"transparency",new Bn.SFFloat)]),getTypeName:function(){return"PhysicalMaterial"},getComponentName:function(){return"Shape"},getContainerField:function(){return"material"},initialize:function(){vd.prototype.initialize.call(this),this._baseColor.addInterest("set_baseColor__",this),this._baseTexture.addInterest("set_baseTexture__",this),this._metallic.addInterest("set_metallic__",this),this._roughness.addInterest("set_roughness__",this),this._metallicRoughnessTexture.addInterest("set_metallicRoughnessTexture__",this),this._occlusionStrength.addInterest("set_occlusionStrength__",this),this._occlusionTexture.addInterest("set_occlusionTexture__",this),this.set_baseColor__(),this.set_baseTexture__(),this.set_metallic__(),this.set_roughness__(),this.set_metallicRoughnessTexture__(),this.set_occlusionStrength__(),this.set_occlusionTexture__(),this.set_transparent__()},set_baseColor__:function(){const e=this.baseColor,t=this._baseColor.getValue();e[0]=t.r,e[1]=t.g,e[2]=t.b},set_baseTexture__:function(){this.baseTextureNode&&this.baseTextureNode._transparent.removeInterest("set_transparent__",this),this.baseTextureNode=xr(s.X3DSingleTextureNode,this._baseTexture),this.setTexture(this.getTextureIndices().BASE_TEXTURE,this.baseTextureNode),this.baseTextureNode&&this.baseTextureNode._transparent.addInterest("set_transparent__",this)},set_metallic__:function(){this.metallic=ee.clamp(this._metallic.getValue(),0,1)},set_roughness__:function(){this.roughness=ee.clamp(this._roughness.getValue(),0,1)},set_metallicRoughnessTexture__:function(){this.metallicRoughnessTextureNode=xr(s.X3DSingleTextureNode,this._metallicRoughnessTexture),this.setTexture(this.getTextureIndices().METALLIC_ROUGHNESS_TEXTURE,this.metallicRoughnessTextureNode)},set_occlusionStrength__:function(){this.occlusionStrength=ee.clamp(this._occlusionStrength.getValue(),0,1)},set_occlusionTexture__:function(){this.occlusionTextureNode=xr(s.X3DSingleTextureNode,this._occlusionTexture),this.setTexture(this.getTextureIndices().OCCLUSION_TEXTURE,this.occlusionTextureNode)},set_transparent__:function(){this.setTransparent(Boolean(this.getTransparency()||this.baseTextureNode&&this.baseTextureNode.getTransparent()))},getTextureIndices:function(){let e=0;const t={EMISSIVE_TEXTURE:e++,NORMAL_TEXTURE:e++,BASE_TEXTURE:e++,METALLIC_ROUGHNESS_TEXTURE:e++,OCCLUSION_TEXTURE:e++};return function(){return t}}(),getMaterialKey:function(){return"3"},createShader:function(e,t,n){const i=this.getBrowser(),o=this.getShaderOptions(t,n);if(t.hasNormals){o.push("X3D_PHYSICAL_MATERIAL"),+this.getTextureBits()&&(this.baseTextureNode&&o.push("X3D_BASE_TEXTURE","X3D_BASE_TEXTURE_"+this.baseTextureNode.getTextureTypeString()),this.metallicRoughnessTextureNode&&o.push("X3D_METALLIC_ROUGHNESS_TEXTURE","X3D_METALLIC_ROUGHNESS_TEXTURE_"+this.metallicRoughnessTextureNode.getTextureTypeString()),this.occlusionTextureNode&&o.push("X3D_OCCLUSION_TEXTURE","X3D_OCCLUSION_TEXTURE_"+this.occlusionTextureNode.getTextureTypeString()));var r=i.createShader("PhysicalMaterialShader","Default","PBR",o)}else{o.push("X3D_UNLIT_MATERIAL");r=i.createShader("UnlitShader","Default","Unlit",o);i.getShaders().set(e.replace(/^(\d{1,2})\d*/,"$1").replace(/\d$/,"0"),r)}return i.getShaders().set(e,r),r},setShaderUniforms:function(e,t,n,i,o){if(vd.prototype.setShaderUniforms.call(this,e,t,n,i,o),e.uniform3fv(t.x3d_BaseColor,this.baseColor),e.uniform1f(t.x3d_Metallic,this.metallic),e.uniform1f(t.x3d_Roughness,this.roughness),+this.getTextureBits()){if(this.baseTextureNode){const r=t.x3d_BaseTexture;this.baseTextureNode.setShaderUniforms(e,t,n,r),e.uniform1i(r.textureTransformMapping,i.get(this._baseTextureMapping.getValue())||0),e.uniform1i(r.textureCoordinateMapping,o.get(this._baseTextureMapping.getValue())||0)}if(this.metallicRoughnessTextureNode){const r=t.x3d_MetallicRoughnessTexture;this.metallicRoughnessTextureNode.setShaderUniforms(e,t,n,r),e.uniform1i(r.textureTransformMapping,i.get(this._metallicRoughnessTextureMapping.getValue())||0),e.uniform1i(r.textureCoordinateMapping,o.get(this._metallicRoughnessTextureMapping.getValue())||0)}if(this.occlusionTextureNode){const r=t.x3d_OcclusionTexture;e.uniform1f(t.x3d_OcclusionStrength,this.occlusionStrength),this.occlusionTextureNode.setShaderUniforms(e,t,n,r),e.uniform1i(r.textureTransformMapping,i.get(this._occlusionTextureMapping.getValue())||0),e.uniform1i(r.textureCoordinateMapping,o.get(this._occlusionTextureMapping.getValue())||0)}}}});const fx=px;function gx(e){os.call(this,e),this.addType(s.PointProperties),this.pointSizeAttenuation=new Float32Array(3)}gx.prototype=Object.assign(Object.create(os.prototype),{constructor:gx,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new P([new N(s.inputOutput,"metadata",new Bn.SFNode),new N(s.inputOutput,"pointSizeScaleFactor",new Bn.SFFloat(1)),new N(s.inputOutput,"pointSizeMinValue",new Bn.SFFloat(1)),new N(s.inputOutput,"pointSizeMaxValue",new Bn.SFFloat(1)),new N(s.inputOutput,"pointSizeAttenuation",new Bn.MFFloat(1,0,0)),new N(s.inputOutput,"markerType",new Bn.SFInt32(1))]),getTypeName:function(){return"PointProperties"},getComponentName:function(){return"Shape"},getContainerField:function(){return"pointProperties"},initialize:function(){os.prototype.initialize.call(this);const e=this.getBrowser().getContext();this.pointSizeRange=e.getParameter(e.ALIASED_POINT_SIZE_RANGE),this._pointSizeScaleFactor.addInterest("set_pointSizeScaleFactor__",this),this._pointSizeMinValue.addInterest("set_pointSizeMinValue__",this),this._pointSizeMaxValue.addInterest("set_pointSizeMaxValue__",this),this._pointSizeAttenuation.addInterest("set_pointSizeAttenuation__",this),this._markerType.addInterest("set_markerType__",this),this.set_pointSizeScaleFactor__(),this.set_pointSizeMinValue__(),this.set_pointSizeMaxValue__(),this.set_pointSizeAttenuation__(),this.set_markerType__()},getPointSize:function(e){const t=this.pointSizeAttenuation,n=e.magnitude();let i=this.pointSizeScaleFactor;return i/=t[0]+t[1]*n+t[2]*(n*n),i=ee.clamp(i,this.pointSizeMinValue,this.pointSizeMaxValue),i},set_pointSizeScaleFactor__:function(){this.pointSizeScaleFactor=Math.max(this._pointSizeScaleFactor.getValue(),0)},set_pointSizeMinValue__:function(){this.pointSizeMinValue=ee.clamp(this._pointSizeMinValue.getValue(),0,this.pointSizeRange[1])},set_pointSizeMaxValue__:function(){this.pointSizeMaxValue=ee.clamp(this._pointSizeMaxValue.getValue(),0,this.pointSizeRange[1])},set_pointSizeAttenuation__:function(){const e=this._pointSizeAttenuation.length;this.pointSizeAttenuation[0]=e>0?Math.max(0,this._pointSizeAttenuation[0]):1,this.pointSizeAttenuation[1]=e>1?Math.max(0,this._pointSizeAttenuation[1]):0,this.pointSizeAttenuation[2]=e>2?Math.max(0,this._pointSizeAttenuation[2]):0},set_markerType__:function(){},setShaderUniforms:function(e,t){e.uniform1f(t.x3d_PointPropertiesPointSizeScaleFactor,this.pointSizeScaleFactor),e.uniform1f(t.x3d_PointPropertiesPointSizeMinValue,this.pointSizeMinValue),e.uniform1f(t.x3d_PointPropertiesPointSizeMaxValue,this.pointSizeMaxValue),e.uniform3fv(t.x3d_PointPropertiesPointSizeAttenuation,this.pointSizeAttenuation)}});const mx=gx;function _x(e){console.warn("TwoSidedMaterial is depreciated, please use Appearance backMaterial field."),xd.call(this,e),this.addType(s.TwoSidedMaterial),this.diffuseColor=new Float32Array(3),this.specularColor=new Float32Array(3),this.emissiveColor=new Float32Array(3),this.backDiffuseColor=new Float32Array(3),this.backSpecularColor=new Float32Array(3),this.backEmissiveColor=new Float32Array(3)}_x.prototype=Object.assign(Object.create(xd.prototype),{constructor:_x,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new P([new N(s.inputOutput,"metadata",new Bn.SFNode),new N(s.inputOutput,"separateBackColor",new Bn.SFBool),new N(s.inputOutput,"ambientIntensity",new Bn.SFFloat(.2)),new N(s.inputOutput,"diffuseColor",new Bn.SFColor(.8,.8,.8)),new N(s.inputOutput,"specularColor",new Bn.SFColor),new N(s.inputOutput,"emissiveColor",new Bn.SFColor),new N(s.inputOutput,"shininess",new Bn.SFFloat(.2)),new N(s.inputOutput,"transparency",new Bn.SFFloat),new N(s.inputOutput,"backAmbientIntensity",new Bn.SFFloat(.2)),new N(s.inputOutput,"backDiffuseColor",new Bn.SFColor(.8,.8,.8)),new N(s.inputOutput,"backSpecularColor",new Bn.SFColor),new N(s.inputOutput,"backEmissiveColor",new Bn.SFColor),new N(s.inputOutput,"backShininess",new Bn.SFFloat(.2)),new N(s.inputOutput,"backTransparency",new Bn.SFFloat)]),getTypeName:function(){return"TwoSidedMaterial"},getComponentName:function(){return"Shape"},getContainerField:function(){return"material"},initialize:function(){xd.prototype.initialize.call(this),this._ambientIntensity.addInterest("set_ambientIntensity__",this),this._diffuseColor.addInterest("set_diffuseColor__",this),this._specularColor.addInterest("set_specularColor__",this),this._emissiveColor.addInterest("set_emissiveColor__",this),this._shininess.addInterest("set_shininess__",this),this._transparency.addInterest("set_transparency__",this),this._backAmbientIntensity.addInterest("set_backAmbientIntensity__",this),this._backDiffuseColor.addInterest("set_backDiffuseColor__",this),this._backSpecularColor.addInterest("set_backSpecularColor__",this),this._backEmissiveColor.addInterest("set_backEmissiveColor__",this),this._backShininess.addInterest("set_backShininess__",this),this._backTransparency.addInterest("set_backTransparency__",this),this._separateBackColor.addInterest("set_transparent__",this),this._transparency.addInterest("set_transparent__",this),this._backTransparency.addInterest("set_transparent__",this),this.set_ambientIntensity__(),this.set_diffuseColor__(),this.set_specularColor__(),this.set_emissiveColor__(),this.set_shininess__(),this.set_transparency__(),this.set_backAmbientIntensity__(),this.set_backDiffuseColor__(),this.set_backSpecularColor__(),this.set_backEmissiveColor__(),this.set_backShininess__(),this.set_backTransparency__(),this.set_transparent__()},set_ambientIntensity__:function(){this.ambientIntensity=Math.max(this._ambientIntensity.getValue(),0)},set_diffuseColor__:function(){const e=this.diffuseColor,t=this._diffuseColor.getValue();e[0]=t.r,e[1]=t.g,e[2]=t.b},set_specularColor__:function(){const e=this.specularColor,t=this._specularColor.getValue();e[0]=t.r,e[1]=t.g,e[2]=t.b},set_emissiveColor__:function(){const e=this.emissiveColor,t=this._emissiveColor.getValue();e[0]=t.r,e[1]=t.g,e[2]=t.b},set_shininess__:function(){this.shininess=ee.clamp(this._shininess.getValue(),0,1)},set_transparency__:function(){this.transparency=ee.clamp(this._transparency.getValue(),0,1)},set_backAmbientIntensity__:function(){this.backAmbientIntensity=Math.max(this._backAmbientIntensity.getValue(),0)},set_backDiffuseColor__:function(){const e=this.backDiffuseColor,t=this._backDiffuseColor.getValue();e[0]=t.r,e[1]=t.g,e[2]=t.b},set_backSpecularColor__:function(){const e=this.backSpecularColor,t=this._backSpecularColor.getValue();e[0]=t.r,e[1]=t.g,e[2]=t.b},set_backEmissiveColor__:function(){const e=this.backEmissiveColor,t=this._backEmissiveColor.getValue();e[0]=t.r,e[1]=t.g,e[2]=t.b},set_backShininess__:function(){this.backShininess=ee.clamp(this._backShininess.getValue(),0,1)},set_backTransparency__:function(){this.backTransparency=ee.clamp(this._backTransparency.getValue(),0,1)},set_transparent__:function(){this.setTransparent(Boolean(this._transparency.getValue()||this._separateBackColor.getValue()&&this._backTransparency.getValue()))},getMaterialKey:dx.prototype.getMaterialKey,createShader:dx.prototype.createShader,setShaderUniforms:function(e,t,n,i,o,r){!r&&this._separateBackColor.getValue()?(e.uniform1f(t.x3d_AmbientIntensity,this.backAmbientIntensity),e.uniform3fv(t.x3d_DiffuseColor,this.backDiffuseColor),e.uniform3fv(t.x3d_SpecularColor,this.backSpecularColor),e.uniform3fv(t.x3d_EmissiveColor,this.backEmissiveColor),e.uniform1f(t.x3d_Shininess,this.backShininess),e.uniform1f(t.x3d_Transparency,this.backTransparency)):(e.uniform1f(t.x3d_AmbientIntensity,this.ambientIntensity),e.uniform3fv(t.x3d_DiffuseColor,this.diffuseColor),e.uniform3fv(t.x3d_SpecularColor,this.specularColor),e.uniform3fv(t.x3d_EmissiveColor,this.emissiveColor),e.uniform1f(t.x3d_Shininess,this.shininess),e.uniform1f(t.x3d_Transparency,this.transparency))}});const yx=_x,xx={AcousticProperties:sx,Appearance:_d,FillProperties:ux,LineProperties:cx,Material:dx,PhysicalMaterial:fx,PointProperties:mx,Shape:_l,TwoSidedMaterial:yx,UnlitMaterial:Sd},wx={X3DAppearanceChildNode:os,X3DAppearanceNode:gd,X3DMaterialNode:xd,X3DOneSidedMaterialNode:vd,X3DShapeNode:hl};for(const e in xx)Bi.addType(e,xx[e]);for(const e in wx)Bi.addAbstractType(e,wx[e]);function vx(e){yr.call(this,e),Ss.call(this,e),this.addType(s.X3DSoundSourceNode),this.volume=0,this.media=null}vx.prototype=Object.assign(Object.create(yr.prototype),Ss.prototype,{constructor:vx,initialize:function(){yr.prototype.initialize.call(this),Ss.prototype.initialize.call(this)},set_live__:function(){Ss.prototype.set_live__.call(this),this.getDisabled()?(this.getBrowser()._volume.removeInterest("set_volume__",this),this.getBrowser()._mute.removeInterest("set_volume__",this)):(this.getBrowser()._volume.addInterest("set_volume__",this),this.getBrowser()._mute.addInterest("set_volume__",this),this.set_volume__())},setMedia:function(e){if(this.media){const e=this.media[0];e.muted=!0,e.pause()}if(this.media=e,e){const t=e[0];t.muted=!1,t.volume=0,t.loop=this._loop.getValue(),this.setVolume(0),this._duration_changed=t.duration,this.resetElapsedTime(),this._isActive.getValue()?this._isPaused.getValue()?this.set_pause():this.getLiveState()?this.set_start():this.set_pause():this.set_stop()}},getMedia:function(){return this.media},setVolume:function(e){this.volume=ee.clamp(e,0,1),this.set_volume__()},set_loop:function(){this.media&&(this.media[0].loop=this._loop.getValue())},set_volume__:function(){if(!this.media)return;const e=!this.getBrowser()._mute.getValue()*ee.clamp(this.getBrowser()._volume.getValue(),0,1)*this.volume;this.media[0].volume=e},set_speed:function(){},set_pitch:function(){},set_start:function(){this.media&&this._speed.getValue()&&(this.media[0].currentTime=0,this.media[0].play().catch(Function.prototype))},set_pause:function(){this.media&&this.media[0].pause()},set_resume:function(){this.media&&this._speed.getValue()&&this.media[0].play().catch(Function.prototype)},set_stop:function(){this.media&&this.media[0].pause()},set_ended:function(){if(this.media){const e=this.media[0];if(e.currentTime<e.duration)return;this._loop.getValue()||this.stop()}},set_time:function(){this.media&&(this._elapsedTime=this.getElapsedTime()),this.set_ended()},dispose:function(){Ss.prototype.dispose.call(this),yr.prototype.dispose.call(this)}});const bx=vx;var Sx=i(755);function Tx(e){bx.call(this,e),xo.call(this,e),this.addType(s.AudioClip),this.addChildObjects("speed",new Bn.SFFloat(1)),this.audio=Sx("<audio></audio>"),this.urlStack=new Bn.MFString}Tx.prototype=Object.assign(Object.create(bx.prototype),xo.prototype,{constructor:Tx,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new P([new N(s.inputOutput,"metadata",new Bn.SFNode),new N(s.inputOutput,"description",new Bn.SFString),new N(s.inputOutput,"enabled",new Bn.SFBool(!0)),new N(s.inputOutput,"load",new Bn.SFBool(!0)),new N(s.inputOutput,"url",new Bn.MFString),new N(s.inputOutput,"autoRefresh",new Bn.SFTime),new N(s.inputOutput,"autoRefreshTimeLimit",new Bn.SFTime(3600)),new N(s.inputOutput,"gain",new Bn.SFFloat(1)),new N(s.inputOutput,"pitch",new Bn.SFFloat(1)),new N(s.inputOutput,"loop",new Bn.SFBool),new N(s.inputOutput,"startTime",new Bn.SFTime),new N(s.inputOutput,"resumeTime",new Bn.SFTime),new N(s.inputOutput,"pauseTime",new Bn.SFTime),new N(s.inputOutput,"stopTime",new Bn.SFTime),new N(s.outputOnly,"isPaused",new Bn.SFBool),new N(s.outputOnly,"isActive",new Bn.SFBool),new N(s.outputOnly,"elapsedTime",new Bn.SFTime),new N(s.outputOnly,"duration_changed",new Bn.SFTime(-1))]),getTypeName:function(){return"AudioClip"},getComponentName:function(){return"Sound"},getContainerField:function(){return"source"},initialize:function(){bx.prototype.initialize.call(this),xo.prototype.initialize.call(this),this.audio.on("abort error",this.setError.bind(this)),this.audio.on("suspend stalled",this.setTimeout.bind(this)),this.audio[0].crossOrigin="Anonymous",this.audio[0].preload="auto",this.audio[0].muted=!0,this.requestImmediateLoad()},getElement:function(){return this.audio[0]},set_live__:function(){bx.prototype.set_live__.call(this),xo.prototype.set_live__.call(this)},unLoadNow:function(){this.setMedia(null)},loadNow:function(){this.setMedia(null),this.urlStack.setValue(this._url),this.audio.on("canplaythrough",this.setAudio.bind(this)),this.loadNext()},loadNext:function(){if(0===this.urlStack.length)return this.audio.off("canplaythrough"),this._duration_changed=-1,void this.setLoadState(s.FAILED_STATE);this.URL=new URL(this.urlStack.shift(),this.getExecutionContext().getWorldURL()),"data:"!==this.URL.protocol&&(this.getBrowser().getBrowserOptions().getCache()&&this.getCache()||this.URL.searchParams.set("_",Date.now())),this.audio.attr("src",this.URL.href),this.audio.get(0).load()},setTimeout:function(e){setTimeout(function(){this.checkLoadState()===s.IN_PROGRESS_STATE&&this.setError(e)}.bind(this),3e3)},setError:function(e){"data:"!==this.URL.protocol&&console.warn("Error loading audio:",decodeURI(this.URL.href),e.type),this.loadNext()},setAudio:function(){"data:"!==this.URL.protocol&&console.info("Done loading audio:",decodeURI(this.URL.href)),this.audio.unbind("canplaythrough"),this.setMedia(this.audio),this.setLoadState(s.COMPLETE_STATE)},dispose:function(){xo.prototype.dispose.call(this),bx.prototype.dispose.call(this)}});const Ex=Tx;function Cx(e){yr.call(this,e),this.addType(s.X3DSoundNode)}Cx.prototype=Object.assign(Object.create(yr.prototype),{constructor:Cx});const Ox=Cx;function Nx(e){Ox.call(this,e),this.addType(s.Sound),this.addChildObjects("traversed",new Bn.SFBool(!0)),this._location.setUnit("length"),this._minBack.setUnit("length"),this._minFront.setUnit("length"),this._maxBack.setUnit("length"),this._maxFront.setUnit("length"),this.currentTraversed=!0}Nx.prototype=Object.assign(Object.create(Ox.prototype),{constructor:Nx,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new P([new N(s.inputOutput,"metadata",new Bn.SFNode),new N(s.inputOutput,"intensity",new Bn.SFFloat(1)),new N(s.initializeOnly,"spatialize",new Bn.SFBool(!0)),new N(s.inputOutput,"location",new Bn.SFVec3f),new N(s.inputOutput,"direction",new Bn.SFVec3f(0,0,1)),new N(s.inputOutput,"minBack",new Bn.SFFloat(1)),new N(s.inputOutput,"minFront",new Bn.SFFloat(1)),new N(s.inputOutput,"maxBack",new Bn.SFFloat(10)),new N(s.inputOutput,"maxFront",new Bn.SFFloat(10)),new N(s.inputOutput,"priority",new Bn.SFFloat),new N(s.inputOutput,"source",new Bn.SFNode)]),getTypeName:function(){return"Sound"},getComponentName:function(){return"Sound"},getContainerField:function(){return"children"},initialize:function(){Ox.prototype.initialize.call(this),this.isLive().addInterest("set_live__",this),this._traversed.addInterest("set_live__",this),this._source.addInterest("set_source__",this),this.set_live__(),this.set_source__()},setTraversed:function(e){e?!1===this._traversed.getValue()&&(this._traversed=!0):this.currentTraversed!==this._traversed.getValue()&&(this._traversed=this.currentTraversed),this.currentTraversed=e},getTraversed:function(){return this.currentTraversed},set_live__:function(){this.isLive().getValue()&&this._traversed.getValue()?this.getBrowser().sensorEvents().addInterest("update",this):this.getBrowser().sensorEvents().removeInterest("update",this)},set_source__:function(){this.sourceNode&&this.sourceNode.setVolume(0),this.sourceNode=xr(s.X3DSoundSourceNode,this._source)},update:function(){this.getTraversed()||this.sourceNode&&this.sourceNode.setVolume(0),this.setTraversed(!1)},traverse:function(){const e={distance:0,intersection:new He(0,0,0)},t={distance:0,intersection:new He(0,0,0)};return function(n,i){if(n!==sr.DISPLAY)return;if(!this.sourceNode)return;if(!this.sourceNode._isActive.getValue()||this.sourceNode._isPaused.getValue())return;this.setTraversed(!0);const o=i.getModelViewMatrix().get();if(this.getEllipsoidParameter(o,Math.max(this._maxBack.getValue(),0),Math.max(this._maxFront.getValue(),0),t),t.distance<1)if(this.getEllipsoidParameter(o,Math.max(this._minBack.getValue(),0),Math.max(this._minFront.getValue(),0),e),e.distance<1)this.sourceNode.setVolume(this._intensity.getValue());else{const n=t.intersection.magnitude(),i=t.intersection.distance(e.intersection),o=Math.min(n/i,1),r=ee.clamp(this._intensity.getValue(),0,1)*o;this.sourceNode.setVolume(r)}else this.sourceNode.setVolume(0)}}(),getEllipsoidParameter:function(){const e=new He(0,0,0),t=new Nt,n=new Nt,i=new Et,o=new He(1,1,1),r=new uy(1,He.Zero),s=new He(0,0,0),a=new pl(He.Zero,He.zAxis),u=new He(0,0,0),l=new He(0,0,0);return function(c,h,d,p){if(0==h||0==d)return t.multVecMatrix(p.intersection.assign(this._location.getValue())),void(p.distance=1);const f=(h+d)/2,g=f-h,m=Math.sqrt(f*f-g*g);e.set(0,0,g),o.set(m,m,f),i.setFromToVec(He.zAxis,this._direction.getValue()),t.assign(c).translate(this._location.getValue()).rotate(i).translate(e).scale(o),n.assign(t).inverse();const _=n.origin;e.negate().divVec(o),s.assign(e).subtract(_).normalize(),a.set(_,s),r.intersectsLine(a,u,l),p.intersection.assign(t.multVecMatrix(u)),p.distance=_.magnitude()}}()});const Fx=Nx,Mx={AudioClip:Ex,Sound:Fx},Dx={X3DSoundNode:Ox,X3DSoundSourceNode:bx};for(const e in Mx)Bi.addType(e,Mx[e]);for(const e in Dx)Bi.addAbstractType(e,Dx[e]);function Ix(e){Wr.call(this,e),this.addType(s.Text),this._length.setUnit("length"),this._maxExtent.setUnit("length"),this._origin.setUnit("length"),this._textBounds.setUnit("length"),this._lineBounds.setUnit("length")}Ix.prototype=Object.assign(Object.create(Wr.prototype),{constructor:Ix,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new P([new N(s.inputOutput,"metadata",new Bn.SFNode),new N(s.inputOutput,"string",new Bn.MFString),new N(s.inputOutput,"length",new Bn.MFFloat),new N(s.inputOutput,"maxExtent",new Bn.SFFloat),new N(s.initializeOnly,"solid",new Bn.SFBool),new N(s.outputOnly,"origin",new Bn.SFVec3f),new N(s.outputOnly,"textBounds",new Bn.SFVec2f),new N(s.outputOnly,"lineBounds",new Bn.MFVec2f),new N(s.inputOutput,"fontStyle",new Bn.SFNode)]),getTypeName:function(){return"Text"},getComponentName:function(){return"Text"},getContainerField:function(){return"geometry"},initialize:function(){Wr.prototype.initialize.call(this),this._fontStyle.addInterest("set_fontStyle__",this),this.set_fontStyle__()},getMatrix:function(){return this.textGeometry.getMatrix()},getLength:function(e){return e<this._length.length?Math.max(0,this._length[e]):0},set_live__:function(){Wr.prototype.set_live__.call(this),this.isLive().getValue()?this.getBrowser().getBrowserOptions()._PrimitiveQuality.addInterest("requestRebuild",this):this.getBrowser().getBrowserOptions()._PrimitiveQuality.removeInterest("requestRebuild",this)},set_fontStyle__:function(){this.fontStyleNode&&this.fontStyleNode.removeInterest("requestRebuild",this),this.fontStyleNode=xr(s.X3DFontStyleNode,this._fontStyle),this.fontStyleNode||(this.fontStyleNode=this.getBrowser().getDefaultFontStyle()),this.fontStyleNode.addInterest("requestRebuild",this),this.textGeometry=this.fontStyleNode.getTextGeometry(this),this.setTransparent(this.textGeometry.getTransparent())},build:function(){this.textGeometry.update(),this.textGeometry.build(),this.setSolid(this._solid.getValue())},traverse:function(e,t){this.textGeometry.traverse(e,t),Wr.prototype.traverse.call(this,e,t)},display:function(e,t){this.textGeometry.display(e,t),Wr.prototype.display.call(this,e,t),t.textureNode=null},transformLine:function(e){return this.textGeometry.transformLine(e)},transformMatrix:function(e){return this.textGeometry.transformMatrix(e)}});const Rx=Ix,Vx={FontStyle:_p,Text:Rx},Px={X3DFontStyleNode:Xd};for(const e in Vx)Bi.addType(e,Vx[e]);for(const e in Px)Bi.addAbstractType(e,Px[e]);var Ax=i(755);function Lx(e){hs.call(this,e),bx.call(this,e),xo.call(this,e),this.addType(s.MovieTexture),this.canvas=Ax("<canvas></canvas>"),this.video=Ax("<video></video>"),this.urlStack=new Bn.MFString}Lx.prototype=Object.assign(Object.create(hs.prototype),bx.prototype,xo.prototype,{constructor:Lx,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new P([new N(s.inputOutput,"metadata",new Bn.SFNode),new N(s.inputOutput,"description",new Bn.SFString),new N(s.inputOutput,"enabled",new Bn.SFBool(!0)),new N(s.inputOutput,"load",new Bn.SFBool(!0)),new N(s.inputOutput,"url",new Bn.MFString),new N(s.inputOutput,"autoRefresh",new Bn.SFTime),new N(s.inputOutput,"autoRefreshTimeLimit",new Bn.SFTime(3600)),new N(s.inputOutput,"gain",new Bn.SFFloat(1)),new N(s.inputOutput,"speed",new Bn.SFFloat(1)),new N(s.inputOutput,"pitch",new Bn.SFFloat(1)),new N(s.inputOutput,"loop",new Bn.SFBool),new N(s.inputOutput,"startTime",new Bn.SFTime),new N(s.inputOutput,"resumeTime",new Bn.SFTime),new N(s.inputOutput,"pauseTime",new Bn.SFTime),new N(s.inputOutput,"stopTime",new Bn.SFTime),new N(s.outputOnly,"isPaused",new Bn.SFBool),new N(s.outputOnly,"isActive",new Bn.SFBool),new N(s.outputOnly,"elapsedTime",new Bn.SFTime),new N(s.outputOnly,"duration_changed",new Bn.SFTime(-1)),new N(s.initializeOnly,"repeatS",new Bn.SFBool(!0)),new N(s.initializeOnly,"repeatT",new Bn.SFBool(!0)),new N(s.initializeOnly,"textureProperties",new Bn.SFNode)]),getTypeName:function(){return"MovieTexture"},getComponentName:function(){return"Texturing"},getContainerField:function(){return"texture"},initialize:function(){hs.prototype.initialize.call(this),bx.prototype.initialize.call(this),xo.prototype.initialize.call(this),this.video.on("abort error",this.setError.bind(this)),this.video.on("suspend stalled",this.setTimeout.bind(this)),this.video[0].crossOrigin="Anonymous",this.video[0].preload="auto",this.video[0].muted=!0,this.requestImmediateLoad()},getElement:function(){return this.video[0]},set_live__:function(){bx.prototype.set_live__.call(this),xo.prototype.set_live__.call(this)},unLoadNow:function(){this.clearTexture()},loadNow:function(){this.setMedia(null),this.urlStack.setValue(this._url),this.video.on("canplaythrough",this.setVideo.bind(this)),this.loadNext()},loadNext:function(){if(0===this.urlStack.length)return this.video.off("canplaythrough"),this._duration_changed=-1,this.clearTexture(),void this.setLoadState(s.FAILED_STATE);this.URL=new URL(this.urlStack.shift(),this.getExecutionContext().getWorldURL()),"data:"!==this.URL.protocol&&(this.getBrowser().getBrowserOptions().getCache()&&this.getCache()||this.URL.searchParams.set("_",Date.now())),this.video.attr("src",this.URL.href),this.video.get(0).load()},setTimeout:function(e){setTimeout(function(){this.checkLoadState()===s.IN_PROGRESS_STATE&&this.setError(e)}.bind(this),3e3)},setError:function(e){"data:"!==this.URL.protocol&&console.warn("Error loading movie:",decodeURI(this.URL.href),e.type),this.loadNext()},setVideo:function(){"data:"!==this.URL.protocol&&console.info("Done loading movie:",decodeURI(this.URL.href));try{this.video.unbind("canplaythrough");const e=this.video[0],t=e.videoWidth,n=e.videoHeight,i=this.canvas[0],o=i.getContext("2d",{willReadFrequently:!0});if(!ee.isPowerOfTwo(t)||!ee.isPowerOfTwo(n))throw new Error("The movie texture is a non power-of-two texture.");i.width=t,i.height=n,o.drawImage(e,0,0);const r=o.getImageData(0,0,t,n).data;this.setMedia(this.video),this.setTexture(t,n,!1,new Uint8Array(r.buffer),!0),this.setLoadState(s.COMPLETE_STATE)}catch(e){console.log(e.message),this.setError()}},set_time:function(){bx.prototype.set_time.call(this),this.checkLoadState()===s.COMPLETE_STATE&&this.updateTexture(this.getMedia()[0],!0)},traverse:hs.prototype.traverse,dispose:function(){xo.prototype.dispose.call(this),bx.prototype.dispose.call(this),hs.prototype.dispose.call(this)}});const Ux=Lx;function Bx(e){ss.call(this,e),this.addType(s.MultiTexture),this.addChildObjects("loadState",new Bn.SFInt32(s.NOT_STARTED_STATE)),this.color=new Float32Array(4),this.modes=[],this.alphaModes=[],this.sources=[],this.functions=[],this.textureNodes=[]}Bx.prototype=Object.assign(Object.create(ss.prototype),{constructor:Bx,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new P([new N(s.inputOutput,"metadata",new Bn.SFNode),new N(s.inputOutput,"description",new Bn.SFString),new N(s.inputOutput,"color",new Bn.SFColor(1,1,1)),new N(s.inputOutput,"alpha",new Bn.SFFloat(1)),new N(s.inputOutput,"mode",new Bn.MFString),new N(s.inputOutput,"source",new Bn.MFString),new N(s.inputOutput,"function",new Bn.MFString),new N(s.inputOutput,"texture",new Bn.MFNode)]),getTypeName:function(){return"MultiTexture"},getComponentName:function(){return"Texturing"},getContainerField:function(){return"texture"},initialize:function(){ss.prototype.initialize.call(this),this._color.addInterest("set_color__",this),this._alpha.addInterest("set_alpha__",this),this._mode.addInterest("set_mode__",this),this._source.addInterest("set_source__",this),this._function.addInterest("set_function__",this),this._texture.addInterest("set_texture__",this),this.set_color__(),this.set_alpha__(),this.set_mode__(),this.set_source__(),this.set_function__(),this.set_texture__(),this._loadState=s.COMPLETE_STATE},getCount:function(){return Math.min(this.getBrowser().getMaxTextures(),this.textureNodes.length)},getMode:function(e){return e<this.modes.length?this.modes[e]:Yh.MODULATE},getAlphaMode:function(e){return e<this.alphaModes.length?this.alphaModes[e]:Yh.MODULATE},getSource:function(e){return e<this.sources.length?this.sources[e]:Zh.DEFAULT},getFunction:function(e){return e<this.functions.length?this.functions[e]:$h.DEFAULT},set_color__:function(){this.color[0]=this._color.r,this.color[1]=this._color.g,this.color[2]=this._color.b},set_alpha__:function(){this.color[3]=this._alpha},set_mode__:function(){const e=new Map([["REPLACE",Yh.REPLACE],["MODULATE",Yh.MODULATE],["MODULATE2X",Yh.MODULATE2X],["MODULATE4X",Yh.MODULATE4X],["ADD",Yh.ADD],["ADDSIGNED",Yh.ADDSIGNED],["ADDSIGNED2X",Yh.ADDSIGNED2X],["ADDSMOOTH",Yh.ADDSMOOTH],["SUBTRACT",Yh.SUBTRACT],["BLENDDIFFUSEALPHA",Yh.BLENDDIFFUSEALPHA],["BLENDTEXTUREALPHA",Yh.BLENDTEXTUREALPHA],["BLENDFACTORALPHA",Yh.BLENDFACTORALPHA],["BLENDCURRENTALPHA",Yh.BLENDCURRENTALPHA],["MODULATEALPHA_ADDCOLOR",Yh.MODULATEALPHA_ADDCOLOR],["MODULATEINVALPHA_ADDCOLOR",Yh.MODULATEINVALPHA_ADDCOLOR],["MODULATEINVCOLOR_ADDALPHA",Yh.MODULATEINVCOLOR_ADDALPHA],["DOTPRODUCT3",Yh.DOTPRODUCT3],["SELECTARG1",Yh.SELECTARG1],["SELECTARG2",Yh.SELECTARG2],["OFF",Yh.OFF]]);return function(){this.modes.length=0,this.alphaModes.length=0;for(const t of this._mode){const n=t.split(",");for(let e=0,t=n.length;e<t;++e)n[e]=n[e].trim();0===n.length&&n.push("MODULATE"),n.length<2&&n.push(n[0]);const i=e.get(n[0]);void 0!==i?this.modes.push(i):this.modes.push(Yh.MODULATE);const o=e.get(n[1]);void 0!==o?this.alphaModes.push(o):this.alphaModes.push(Yh.MODULATE)}}}(),set_source__:function(){const e=new Map([["DIFFUSE",Zh.DIFFUSE],["SPECULAR",Zh.SPECULAR],["FACTOR",Zh.FACTOR]]);return function(){this.sources.length=0;for(const t of this._source){const n=e.get(t);void 0!==n?this.sources.push(n):this.sources.push(Zh.DEFAULT)}}}(),set_function__:function(){const e=new Map([["COMPLEMENT",$h.COMPLEMENT],["ALPHAREPLICATE",$h.ALPHAREPLICATE]]);return function(){this.functions.length=0;for(const t of this._function){const n=e.get(t);void 0!==n?this.functions.push(n):this.functions.push($h.DEFAULT)}}}(),set_texture__:function(){this.textureNodes.length=0;for(const e of this._texture){const t=xr(s.X3DSingleTextureNode,e);t&&this.textureNodes.push(t)}},updateTextureBits:function(e){const t=this.getBrowser().getMaxTextures(),n=this.textureNodes,i=Math.min(t,n.length);for(let t=0;t<i;++t)n[t].updateTextureBits(e,t);e.set(2*t,1)},getShaderOptions:function(e){const t=this.textureNodes,n=Math.min(this.getBrowser().getMaxTextures(),t.length);for(let i=0;i<n;++i)t[i].getShaderOptions(e,i)},traverse:function(e,t){for(const n of this.textureNodes)n.traverse(e,t)},setShaderUniforms:function(e,t,n){const i=this.textureNodes,o=Math.min(this.getBrowser().getMaxTextures(),i.length);e.uniform4fv(t.x3d_MultiTextureColor,this.color);for(let r=0;r<o;++r)i[r].setShaderUniforms(e,t,n,t.x3d_Texture[r]),e.uniform1i(t.x3d_MultiTextureMode[r],this.getMode(r)),e.uniform1i(t.x3d_MultiTextureAlphaMode[r],this.getAlphaMode(r)),e.uniform1i(t.x3d_MultiTextureSource[r],this.getSource(r)),e.uniform1i(t.x3d_MultiTextureFunction[r],this.getFunction(r))}});const Xx=Bx;function kx(e){qu.call(this,e),this.addType(s.MultiTextureCoordinate),this.textureCoordinateNodes=[]}kx.prototype=Object.assign(Object.create(qu.prototype),{constructor:kx,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new P([new N(s.inputOutput,"metadata",new Bn.SFNode),new N(s.inputOutput,"texCoord",new Bn.MFNode)]),getTypeName:function(){return"MultiTextureCoordinate"},getComponentName:function(){return"Texturing"},getContainerField:function(){return"texCoord"},initialize:function(){qu.prototype.initialize.call(this),this._texCoord.addInterest("set_texCoord__",this),this.set_texCoord__()},set_texCoord__:function(){const e=this.textureCoordinateNodes;for(const t of e)t.removeInterest("addNodeEvent",this);e.length=0;for(const t of this._texCoord){const n=xr(s.X3DSingleTextureCoordinateNode,t);n&&e.push(n)}for(const t of e)t.addInterest("addNodeEvent",this)},getCount:function(){return Math.min(this.getBrowser().getMaxTextures(),this.textureCoordinateNodes.length)},isEmpty:function(){return!0},getSize:function(){return 0},get1Point:function(e,t){for(const n of this.textureCoordinateNodes)return n.get1Point(e,t);return t.set(0,0,0,1)},init:function(e){for(const t of this.textureCoordinateNodes)t.init(e)},addTexCoord:function(e,t){const n=this.textureCoordinateNodes;for(let i=0,o=n.length;i<o;++i)n[i].addTexCoordToChannel(e,t[i])},addTexCoordToChannel:function(e,t){},getTexCoord:function(e){for(const t of this.textureCoordinateNodes)return t.getTexCoord(e);return e},getTextureCoordinateMapping:function(e){const t=this.textureCoordinateNodes,n=Math.min(this.getBrowser().getMaxTextures(),t.length);for(let i=0;i<n;++i)t[i].getTextureCoordinateMapping(e,i)},setShaderUniforms:function(e,t){const n=this.textureCoordinateNodes,i=Math.min(t.x3d_MaxTextures,n.length);for(let o=0;o<i;++o)n[o].setShaderUniformsToChannel(e,t,o);if(i){const o=n.at(-1);for(let n=i,r=t.x3d_MaxTextures;n<r;++n)o.setShaderUniformsToChannel(e,t,n)}else for(let n=i,o=t.x3d_MaxTextures;n<o;++n)e.uniform1i(t.x3d_TextureCoordinateGeneratorMode[n],0)}});const zx=kx;function jx(e){Cp.call(this,e),this.addType(s.MultiTextureTransform),this.textureTransformNodes=[]}jx.prototype=Object.assign(Object.create(Cp.prototype),{constructor:jx,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new P([new N(s.inputOutput,"metadata",new Bn.SFNode),new N(s.inputOutput,"textureTransform",new Bn.MFNode)]),getTypeName:function(){return"MultiTextureTransform"},getComponentName:function(){return"Texturing"},getContainerField:function(){return"textureTransform"},initialize:function(){Cp.prototype.initialize.call(this),this._textureTransform.addInterest("set_textureTransform__",this),this.set_textureTransform__()},set_textureTransform__:function(){const e=this.textureTransformNodes;e.length=0;for(const t of this._textureTransform){const n=xr(s.X3DSingleTextureTransformNode,t);n&&e.push(n)}},getCount:function(){return Math.min(this.getBrowser().getMaxTextures(),this.textureTransformNodes.length)},getTextureTransformMapping:function(e){const t=this.textureTransformNodes,n=Math.min(this.getBrowser().getMaxTextures(),t.length);for(let i=0;i<n;++i)t[i].getTextureTransformMapping(e,i)},setShaderUniforms:function(){const e=new Float32Array(Nt.Identity);return function(t,n){const i=this.textureTransformNodes,o=Math.min(n.x3d_MaxTextures,i.length);for(let e=0;e<o;++e)i[e].setShaderUniformsToChannel(t,n,e);if(o){const e=i.at(-1);for(let i=o,r=n.x3d_MaxTextures;i<r;++i)e.setShaderUniformsToChannel(t,n,i)}else for(let i=o,r=n.x3d_MaxTextures;i<r;++i)t.uniformMatrix4fv(n.x3d_TextureMatrix[i],!1,e)}}()});const Gx=jx;var Hx=i(755);function qx(e){hs.call(this,e),this.addType(s.PixelTexture),this.addChildObjects("loadState",new Bn.SFInt32(s.NOT_STARTED_STATE))}qx.prototype=Object.assign(Object.create(hs.prototype),{constructor:qx,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new P([new N(s.inputOutput,"metadata",new Bn.SFNode),new N(s.inputOutput,"description",new Bn.SFString),new N(s.inputOutput,"image",new Bn.SFImage(0,0,0,new Bn.MFInt32)),new N(s.initializeOnly,"repeatS",new Bn.SFBool(!0)),new N(s.initializeOnly,"repeatT",new Bn.SFBool(!0)),new N(s.initializeOnly,"textureProperties",new Bn.SFNode)]),getTypeName:function(){return"PixelTexture"},getComponentName:function(){return"Texturing"},getContainerField:function(){return"texture"},initialize:function(){hs.prototype.initialize.call(this),this._image.addInterest("set_image__",this),this.canvas1=Hx("<canvas></canvas>"),this.canvas2=Hx("<canvas></canvas>"),this.set_image__()},checkLoadState:function(){return this._loadState.getValue()},convert:function(e,t,n,i){switch(t){case 1:for(let t=0,o=0;t<i;++t,o+=4){const i=n[t];e[o]=e[o+1]=e[o+2]=255&i,e[o+3]=255}break;case 2:for(let t=0,o=0;t<i;++t,o+=4){const i=n[t];e[o]=e[o+1]=e[o+2]=i>>>8&255,e[o+3]=255&i}break;case 3:for(let t=0,o=0;t<i;++t,o+=4){const i=n[t];e[o]=i>>>16&255,e[o+1]=i>>>8&255,e[o+2]=255&i,e[o+3]=255}break;case 4:for(let t=0,o=0;t<i;++t,o+=4){const i=n[t];e[o]=i>>>24,e[o+1]=i>>>16&255,e[o+2]=i>>>8&255,e[o+3]=255&i}}},resize:function(e,t,n,i,o){const r=new Uint8Array(i*o*4),s=i/t,a=o/n;for(let n=0;n<o;++n){const o=Math.floor(n/a)*t,u=n*i;for(let t=0;t<i;++t){const n=4*(o+Math.floor(t/s)),i=4*(u+t);r[i]=e[n],r[i+1]=e[n+1],r[i+2]=e[n+2],r[i+3]=e[n+3]}}return r},set_image__:function(){const e=this.getBrowser().getContext(),t=this._image.comp,n=this._image.array,i=!(t%2);let o=this._image.width,r=this._image.height,a=null;if(o>0&&r>0&&t>0&&t<5){if(e.getVersion()>=2||ee.isPowerOfTwo(o)&&ee.isPowerOfTwo(r))a=new Uint8Array(o*r*4),this.convert(a,t,n.getValue(),n.length);else if(Math.max(o,r)<this.getBrowser().getMinTextureSize()&&!this._textureProperties.getValue()){a=new Uint8Array(o*r*4),this.convert(a,t,n.getValue(),n.length);const e=o,i=r;o=4*ee.nextPowerOfTwo(e),r=4*ee.nextPowerOfTwo(i),a=this.resize(a,e,i,o,r)}else{const e=this.canvas1[0],i=this.canvas2[0],s=e.getContext("2d",{willReadFrequently:!0}),u=i.getContext("2d",{willReadFrequently:!0}),l=s.createImageData(o,r);e.width=o,e.height=r,this.convert(l.data,t,n,n.length),s.putImageData(l,0,0),o=ee.nextPowerOfTwo(o),r=ee.nextPowerOfTwo(r),i.width=o,i.height=r,u.clearRect(0,0,o,r),u.drawImage(e,0,0,e.width,e.height,0,0,o,r),a=u.getImageData(0,0,o,r).data}this.setTexture(o,r,i,new Uint8Array(a.buffer),!1),this._loadState=s.COMPLETE_STATE}else this.clearTexture(),this._loadState=s.FAILED_STATE}});const Wx=qx;function Yx(e){Yu.call(this,e),this.addType(s.TextureCoordinateGenerator),this.mode=ed.SPHERE,this.parameter=new Float32Array(6)}Yx.prototype=Object.assign(Object.create(Yu.prototype),{constructor:Yx,[Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions")]:new P([new N(s.inputOutput,"metadata",new Bn.SFNode),new N(s.inputOutput,"mapping",new Bn.SFString),new N(s.inputOutput,"mode",new Bn.SFString("SPHERE")),new N(s.inputOutput,"parameter",new Bn.MFFloat)]),getTypeName:function(){return"TextureCoordinateGenerator"},getComponentName:function(){return"Texturing"},getContainerField:function(){return"texCoord"},initialize:function(){Yu.prototype.initialize.call(this),this._mode.addInterest("set_mode__",this),this._parameter.addInterest("set_parameter__",this),this.set_mode__(),this.set_parameter__()},set_mode__:function(){const e=new Map([["SPHERE",ed.SPHERE],["CAMERASPACENORMAL",ed.CAMERASPACENORMAL],["CAMERASPACEPOSITION",ed.CAMERASPACEPOSITION],["CAMERASPACEREFLECTIONVECTOR",ed.CAMERASPACEREFLECTIONVECTOR],["SPHERE-LOCAL",ed.SPHERE_LOCAL],["COORD",ed.COORD],["COORD-EYE",ed.COORD_EYE],["NOISE",ed.NOISE],["NOISE-EYE",ed.NOISE_EYE],["SPHERE-REFLECT",ed.SPHERE_REFLECT],["SPHERE-REFLECT-LOCAL",ed.SPHERE_REFLECT_LOCAL]]);return function(){this.mode=e.get(this._mode.getValue()),void 0===this.mode&&(this.mode=ed.SPHERE)}}(),set_parameter__:function(){const e=Math.min(this.parameter.length,this._parameter.length);for(let t=0;t<e;++t)this.parameter[t]=this._parameter[t];this.parameter.fill(0,e)},get1Point:function(e,t){return t},addTexCoordToChannel:function(e,t){t.push(0,0,0,1)},getTexCoord:function(e){return e},setShaderUniformsToChannel:function(e,t,n=0){e.uniform1i(t.x3d_TextureCoordinateGeneratorMode[n],this.mode),e.uniform1fv(t.x3d_TextureCoordinateGeneratorParameter[n],this.parameter)}});const Kx=Yx,Zx={ImageTexture:fs,MovieTexture:Ux,MultiTexture:Xx,MultiTextureCoordinate:zx,MultiTextureTransform:Gx,PixelTexture:Wx,TextureCoordinate:Zu,TextureCoordinateGenerator:Kx,TextureProperties:Du,TextureTransform:Mp},Qx={X3DSingleTextureCoordinateNode:Yu,X3DSingleTextureNode:us,X3DSingleTextureTransformNode:Np,X3DTexture2DNode:hs,X3DTextureCoordinateNode:qu,X3DTextureNode:ss,X3DTextureTransformNode:Cp};for(const e in Zx)Bi.addType(e,Zx[e]);for(const e in Qx)Bi.addAbstractType(e,Qx[e]);const $x={TimeSensor:Es},Jx={X3DTimeDependentNode:Ss};for(const e in $x)Bi.addType(e,$x[e]);for(const e in Jx)Bi.addAbstractType(e,Jx[e]);function ew(){}ew.prototype={addComponent:function({name:e,types:t,abstractTypes:n,browserContext:i,exports:o}){const r=window[Symbol.for("X_ITE.X3D-8.0.0a")].require("x_ite/Namespace");if(t)for(const[n,i]of Object.entries(t))Bi.addType(n,i),r.set(`x_ite/Components/${e}/${n}`,i);if(n)for(const[t,i]of Object.entries(n))Bi.addAbstractType(t,i),r.set(`x_ite/Components/${e}/${t}`,i);if(i&&(Ef.addBrowserContext(i),r.set(`x_ite/Browser/${e}/X3D${e}Context`,i)),o)for(const[e,t]of Object.entries(o))r.set(e,t);console.info(`Done loading external component '${e}'.`)}};const tw=new ew,nw=Symbol.for("X_ITE.dom");const iw=class{constructor(e){this.browser=e,this.rootElements=new WeakSet,this.canvasObserver=new MutationObserver((()=>{this.observeRoot(this.browser.getElement().children("X3D")[0])})),this.canvasObserver.observe(this.browser.getElement()[0],{childList:!0}),this.observeRoot(this.browser.getElement().children("X3D")[0])}isPrivate(){return!1}async observeRoot(e){try{if(!e)return;if(this.rootElements.has(e))return;this.rootElements.add(e),this.browser.setBrowserLoading(!0),this.browser.addLoadCount(this),location.pathname.toLowerCase().endsWith(".xhtml")||this.preprocessScriptElements(e);const t=await this.browser.importDocument(e,!0);this.browser.replaceWorld(t),this.parser=new Lo(t),this.loadSensor=t.createNode("LoadSensor").getValue(),this.observer=new MutationObserver((e=>{for(const t of e)this.processMutation(t)})),this.observer.observe(e,{attributes:!0,childList:!0,characterData:!1,subtree:!0,attributeOldValue:!0}),this.addEventDispatchersAll(e),this.processInlineElements(e),this.browser.removeLoadCount(this)}catch(e){console.error("Error importing document:",e)}}preprocessScriptElements(e){const t=e.querySelectorAll("Script");for(const e of t)this.appendScriptElementChildren(e)}appendScriptElementChildren(e){const t=(new DOMParser).parseFromString(e.outerHTML,"application/xml").children[0].childNodes;e.textContent="// content moved into childNodes";for(const n of t)e.appendChild(n)}processMutation(e){switch(e.type){case"attributes":this.processAttribute(e,e.target);break;case"childList":for(const t of e.addedNodes)this.processAddedNode(t);for(const t of e.removedNodes)this.processRemovedNode(t)}}processAttribute(e,t){if(t.x3d){const n=e.attributeName,i=t.attributes.getNamedItem(n);this.parser.nodeAttribute(i,t.x3d)}else{const e=t.parentNode.x3d;this.parser.pushExecutionContext(e.getExecutionContext()),this.parser.pushParent(e),this.parser.childElement(t),this.parser.popParent(),this.parser.popExecutionContext()}}processAddedNode(e){if(e.nodeType!==Node.ELEMENT_NODE)return;if(this.processInlineElements(e),e.x3d)return void("Inline"!==e.nodeName&&"INLINE"!==e.nodeName||this.processInlineElement(e));if("Scene"===e.nodeName||"SCENE"===e.nodeName)return;const t=e.parentNode;let n=this.browser.currentScene;if("Inline"===t.parentNode.nodeName||"INLINE"===t.parentNode.nodeName?n=t.parentNode.x3d.getInternalScene():t.x3d&&(n=t.x3d.getExecutionContext()),this.parser.pushExecutionContext(n),t.x3d){const n=t.x3d;this.parser.pushParent(n),this.parser.childElement(e),this.parser.popParent()}else this.parser.childElement(e);this.parser.popExecutionContext(),this.processInlineElements(e),this.addEventDispatchers(e),this.addEventDispatchersAll(e)}processRemovedNode(e){e.x3d&&(e.x3d.dispose(),"ROUTE"===e.nodeName&&delete e.x3d)}processInlineElements(e){"Inline"!==e.nodeName&&"INLINE"!==e.nodeName||this.processInlineElement(e);for(const t of e.querySelectorAll("Inline"))this.processInlineElement(t)}processInlineElement(e){if(void 0===e.x3d)return;const t=this.loadSensor.getField("watchList"),n=this.appendInlineElement.bind(this,e);this.loadSensor.getField("isLoaded").addFieldCallback("loaded"+e.x3d.getId(),n),t.push(e.x3d)}appendInlineElement(e,t){const n=e.x3d,i=this.loadSensor.getField("watchList"),o=this.loadSensor.getField("isLoaded");n[nw]&&e.appendChild(n[nw].querySelector("Scene")),o.removeFieldCallback("loaded"+n.getId());const r=i.getValue().filter((e=>e.getValue()!==n));if(i.setValue(r),null===e.querySelector("Inline")){const e=new Event("x3dload");e.element=this.browser.getElement(),document.dispatchEvent(e)}this.addEventDispatchersAll(e)}addEventDispatchersAll(e){const t=e.querySelectorAll("*");for(const e of t)this.addEventDispatchers(e)}addEventDispatchers(e){if(void 0!==e.x3d&&"ROUTE"!==e.nodeName)for(const t of e.x3d.getFields())this.bindFieldCallback(t,e)}bindFieldCallback(e,t){e.isOutput()&&(e.addFieldCallback("DomIntegration."+e.getId(),this.fieldCallback.bind(null,e,t)),this.trace&&e.addFieldCallback("DomIntegrationTracer."+e.getId(),this.fieldTraceCallback.bind(null,e,t.x3d)))}fieldCallback(e,t,n){const i=t.x3d,o="x3d."+e.getName(),r=new CustomEvent(o,{detail:{value:n,fields:i.getFields(),name:i.getName(),x3d:i}});t.dispatchEvent(r)}fieldTraceCallback(e,t,n){const i=Date.now(),o=t.getBrowser().getCurrentTime(),r=i-1e3*o;console.log("%f: at %f dt of %s ms %s '%s' %s: %s",i,o,r.toFixed(3),t.getTypeName(),t.getName(),e.getName(),n)}};function ow(e,t,n,i){this.name=e,this.title=t,this.providerUrl=n,this.components=i}ow.prototype=Object.assign(Object.create(g.prototype),{constructor:ow,getTypeName:function(){return"ProfileInfo"},toVRMLStream:function(e){e.string+="PROFILE",e.string+=" ",e.string+=this.name},toXMLStream:function(e){e.string+=this.name}});for(const e of Reflect.ownKeys(ow.prototype))Object.defineProperty(ow.prototype,e,{enumerable:!1});const rw=ow;function sw(e){return R.call(this,e)}sw.prototype=Object.assign(Object.create(R.prototype),{constructor:sw,getTypeName:function(){return"ProfileInfoArray"},addProfile:function(e){this.add(e.name,new rw(e.name,e.title,e.providerUrl,new Ma(e.components)))}});for(const e of Reflect.ownKeys(sw.prototype))Object.defineProperty(sw.prototype,e,{enumerable:!1});const aw=sw,uw=new Ma([]);uw.addComponent({title:"Annotation",name:"Annotation",level:2,providerUrl:kc.getProviderUrl("Annotation")}),uw.addComponent({title:"Computer-Aided Design (CAD) model geometry",name:"CADGeometry",level:2,providerUrl:kc.getProviderUrl("CADGeometry")}),uw.addComponent({title:"Core",name:"Core",level:2,providerUrl:kc.getProviderUrl()}),uw.addComponent({title:"Cube map environmental texturing",name:"CubeMapTexturing",level:3,providerUrl:kc.getProviderUrl("CubeMapTexturing")}),uw.addComponent({title:"Distributed interactive simulation (DIS)",name:"DIS",level:2,providerUrl:kc.getProviderUrl("DIS")}),uw.addComponent({title:"Environmental effects",name:"EnvironmentalEffects",level:4,providerUrl:kc.getProviderUrl()}),uw.addComponent({title:"Environmental sensor",name:"EnvironmentalSensor",level:4,providerUrl:kc.getProviderUrl()}),uw.addComponent({title:"Event utilities",name:"EventUtilities",level:4,providerUrl:kc.getProviderUrl("EventUtilities")}),uw.addComponent({title:"Followers",name:"Followers",level:4,providerUrl:kc.getProviderUrl()}),uw.addComponent({title:"Geometry2D",name:"Geometry2D",level:2,providerUrl:kc.getProviderUrl("Geometry2D")}),uw.addComponent({title:"Geometry3D",name:"Geometry3D",level:4,providerUrl:kc.getProviderUrl()}),uw.addComponent({title:"Geospatial",name:"Geospatial",level:2,providerUrl:kc.getProviderUrl("Geospatial")}),uw.addComponent({title:"Grouping",name:"Grouping",level:3,providerUrl:kc.getProviderUrl()}),uw.addComponent({title:"Humanoid animation (HAnim)",name:"HAnim",level:3,providerUrl:kc.getProviderUrl("HAnim")}),uw.addAlias("H-Anim","HAnim"),uw.addComponent({title:"Interpolation",name:"Interpolation",level:5,providerUrl:kc.getProviderUrl()}),uw.addComponent({title:"Key device sensor",name:"KeyDeviceSensor",level:2,providerUrl:kc.getProviderUrl("KeyDeviceSensor")}),uw.addComponent({title:"Layering",name:"Layering",level:1,providerUrl:kc.getProviderUrl()}),uw.addComponent({title:"Layout",name:"Layout",level:2,providerUrl:kc.getProviderUrl("Layout")}),uw.addComponent({title:"Lighting",name:"Lighting",level:3,providerUrl:kc.getProviderUrl()}),uw.addComponent({title:"Navigation",name:"Navigation",level:3,providerUrl:kc.getProviderUrl()}),uw.addComponent({title:"Networking",name:"Networking",level:4,providerUrl:kc.getProviderUrl()}),uw.addComponent({title:"Non-uniform Rational B-Spline (NURBS)",name:"NURBS",level:4,providerUrl:kc.getProviderUrl("NURBS")}),uw.addComponent({title:"Particle systems",name:"ParticleSystems",level:3,providerUrl:kc.getProviderUrl("ParticleSystems")}),uw.addComponent({title:"Picking sensor",name:"Picking",level:3,providerUrl:kc.getProviderUrl("Picking"),dependencies:["RigidBodyPhysics"]}),uw.addComponent({title:"Pointing device sensor",name:"PointingDeviceSensor",level:1,providerUrl:kc.getProviderUrl()}),uw.addComponent({title:"Projective Texture Mapping",name:"ProjectiveTextureMapping",level:2,providerUrl:kc.getProviderUrl("ProjectiveTextureMapping")}),uw.addComponent({title:"Programmable shaders",name:"Shaders",level:1,providerUrl:kc.getProviderUrl()}),uw.addComponent({title:"Rendering",name:"Rendering",level:5,providerUrl:kc.getProviderUrl()}),uw.addComponent({title:"Rigid body physics",name:"RigidBodyPhysics",level:5,providerUrl:kc.getProviderUrl("RigidBodyPhysics")}),uw.addComponent({title:"Scripting",name:"Scripting",level:1,providerUrl:kc.getProviderUrl("Scripting")}),uw.addComponent({title:"Shape",name:"Shape",level:5,providerUrl:kc.getProviderUrl()}),uw.addComponent({title:"Sound",name:"Sound",level:1,providerUrl:kc.getProviderUrl()}),uw.addComponent({title:"Text",name:"Text",level:1,providerUrl:kc.getProviderUrl()}),uw.addComponent({title:"Texturing",name:"Texturing",level:3,providerUrl:kc.getProviderUrl()}),uw.addComponent({title:"Texturing3D",name:"Texturing3D",level:3,providerUrl:kc.getProviderUrl("Texturing3D")}),uw.addComponent({title:"Time",name:"Time",level:2,providerUrl:kc.getProviderUrl()}),uw.addComponent({title:"Volume rendering",name:"VolumeRendering",level:2,providerUrl:kc.getProviderUrl("VolumeRendering"),dependencies:["CADGeometry","Texturing3D"]}),uw.addComponent({title:"X_ITE",name:"X_ITE",level:1,providerUrl:kc.getProviderUrl("X_ITE")});const lw=uw,cw=new aw;cw.addProfile({title:"Computer-Aided Design (CAD) interchange",name:"CADInterchange",providerUrl:kc.getProviderUrl(),components:[lw.get("CADGeometry"),lw.get("Core"),lw.get("Grouping"),lw.get("Lighting"),lw.get("Navigation"),lw.get("Networking"),lw.get("Rendering"),lw.get("Shaders"),lw.get("Shape"),lw.get("Texturing")]}),cw.addProfile({title:"Core",name:"Core",providerUrl:kc.getProviderUrl(),components:[lw.get("Core")]}),cw.addProfile({title:"Full",name:"Full",providerUrl:kc.getProviderUrl(),components:[lw.get("CADGeometry"),lw.get("Core"),lw.get("CubeMapTexturing"),lw.get("DIS"),lw.get("EnvironmentalEffects"),lw.get("EnvironmentalSensor"),lw.get("EventUtilities"),lw.get("Followers"),lw.get("Geometry2D"),lw.get("Geometry3D"),lw.get("Geospatial"),lw.get("Grouping"),lw.get("HAnim"),lw.get("Interpolation"),lw.get("KeyDeviceSensor"),lw.get("Layering"),lw.get("Layout"),lw.get("Lighting"),lw.get("Navigation"),lw.get("Networking"),lw.get("NURBS"),lw.get("ParticleSystems"),lw.get("Picking"),lw.get("PointingDeviceSensor"),lw.get("ProjectiveTextureMapping"),lw.get("Rendering"),lw.get("RigidBodyPhysics"),lw.get("Scripting"),lw.get("Shaders"),lw.get("Shape"),lw.get("Sound"),lw.get("Text"),lw.get("Texturing"),lw.get("Texturing3D"),lw.get("Time"),lw.get("VolumeRendering")]}),cw.addProfile({title:"Immersive",name:"Immersive",providerUrl:kc.getProviderUrl(),components:[lw.get("Core"),lw.get("EnvironmentalEffects"),lw.get("EnvironmentalSensor"),lw.get("EventUtilities"),lw.get("Geometry2D"),lw.get("Geometry3D"),lw.get("Grouping"),lw.get("Interpolation"),lw.get("KeyDeviceSensor"),lw.get("Lighting"),lw.get("Navigation"),lw.get("Networking"),lw.get("PointingDeviceSensor"),lw.get("Rendering"),lw.get("Scripting"),lw.get("Shape"),lw.get("Sound"),lw.get("Text"),lw.get("Texturing"),lw.get("Time")]}),cw.addProfile({title:"Interactive",name:"Interactive",providerUrl:kc.getProviderUrl(),components:[lw.get("Core"),lw.get("EnvironmentalEffects"),lw.get("EnvironmentalSensor"),lw.get("EventUtilities"),lw.get("Geometry3D"),lw.get("Grouping"),lw.get("Interpolation"),lw.get("KeyDeviceSensor"),lw.get("Lighting"),lw.get("Navigation"),lw.get("Networking"),lw.get("PointingDeviceSensor"),lw.get("Rendering"),lw.get("Shape"),lw.get("Texturing"),lw.get("Time")]}),cw.addProfile({title:"Interchange",name:"Interchange",providerUrl:kc.getProviderUrl(),components:[lw.get("Core"),lw.get("EnvironmentalEffects"),lw.get("Geometry3D"),lw.get("Grouping"),lw.get("Interpolation"),lw.get("Lighting"),lw.get("Navigation"),lw.get("Networking"),lw.get("Rendering"),lw.get("Shape"),lw.get("Texturing"),lw.get("Time")]}),cw.addProfile({title:"Medical interchange",name:"MedicalInterchange",providerUrl:kc.getProviderUrl(),components:[lw.get("Core"),lw.get("EnvironmentalEffects"),lw.get("EventUtilities"),lw.get("Geometry2D"),lw.get("Geometry3D"),lw.get("Grouping"),lw.get("Interpolation"),lw.get("Lighting"),lw.get("Navigation"),lw.get("Networking"),lw.get("Rendering"),lw.get("Shape"),lw.get("Text"),lw.get("Texturing"),lw.get("Texturing3D"),lw.get("Time"),lw.get("VolumeRendering")]}),cw.addProfile({title:"MPEG-4 interactive",name:"MPEG-4",providerUrl:kc.getProviderUrl(),components:[lw.get("Core"),lw.get("EnvironmentalEffects"),lw.get("EnvironmentalSensor"),lw.get("Geometry3D"),lw.get("Grouping"),lw.get("Interpolation"),lw.get("Lighting"),lw.get("Navigation"),lw.get("Networking"),lw.get("PointingDeviceSensor"),lw.get("Rendering"),lw.get("Shape"),lw.get("Texturing"),lw.get("Time")]});const hw=cw;var dw=i(755);const pw=Symbol(),fw=Symbol(),gw=Symbol();function mw(e){Ef.call(this,e),this[gw]=new Map,this.setExecutionContext(this.createScene())}mw.prototype=Object.assign(Object.create(Ef.prototype),{constructor:mw,getTypeName:function(){return"X3DBrowser"},getComponentName:function(){return"X_ITE"},getContainerField:function(){return"browser"},initialize:function(){Ef.prototype.initialize.call(this),this.replaceWorld(this.getExecutionContext()),this[pw]=new iw(this),this.getInstanceId()>1||this.print("Welcome to "+this.name+" X3D Browser "+this.version+":\n   Current Graphics Renderer\n      Name: "+this.getVendor()+" "+this.getRenderer()+"\n      WebGL version: "+this.getWebGLVersion()+"\n      Shading language: "+this.getShadingLanguageVersion()+"\n   Rendering Properties\n      Antialiased: "+this.getAntialiased()+"\n      Depth size: "+this.getDepthSize()+" bits\n      Color depth: "+this.getColorDepth()+" bits\n      Max clip planes per shape: "+this.getMaxClipPlanes()+"\n      Max lights per shape: "+this.getMaxLights()+"\n      Max multi textures per shape: "+this.getMaxTextures()+"\n      Texture units: "+this.getMaxCombinedTextureUnits()+"\n      Max texture size: "+this.getMaxTextureSize()+" Ã "+this.getMaxTextureSize()+" pixels\n      Texture memory: "+this.getTextureMemory()+"\n      Max vertex uniform vectors: "+this.getMaxVertexUniformVectors()+"\n      Max fragment uniform vectors: "+this.getMaxFragmentUniformVectors()+"\n      Max vertex attribs: "+this.getMaxVertexAttribs()+"\n      Max varying vectors: "+this.getMaxVaryingVectors()+"\n")},getName:function(){return"X_ITE"},getVersion:function(){return ei},getDescription:function(){return this.getNotification()._string.getValue()},setDescription:function(e){this.getNotification()._string=e},getWorldURL:function(){return this.currentScene.worldURL},getProfile:function(e){e=String(e);const t=hw.get(e);if(t)return t;throw Error("Profile '"+e+"' is not supported.")},getSupportedProfiles:function(){return hw},getComponent:function(e,t){e=String(e),t=~~t;const n=lw.get(e);if(n)return n.level,new Na(e,t,n.title,n.providerUrl,n.dependencies);throw Error("Component '"+e+"' at level '"+t+"' is not supported.")},getSupportedComponents:function(){return lw},loadComponents:function(){const e=/\.js$/;function t(n,o,r){return Promise.all(o.map((o=>async function(n,o,r){if(r.has(o))return;r.add(o);const s=n.getSupportedComponents().get(o),a=s.providerUrl;if(await t(n,s.dependencies,r),!a.match(e))return;"object"==typeof i.g&&"function"==typeof i.g.require?i.g.require(i.g.require("url").fileURLToPath(a)):await import(a)}(n,o,r))))}return function(e){return e instanceof rw?this.loadComponents(e.components):e instanceof Ma?this.loadComponents(e.map((({name:e})=>e))):e instanceof Na?this.loadComponents([e.name]):t(this,[...e],new Set)}}(),getSupportedNode:function(e){return Bi.getType(String(e))},getSupportedNodes:function(){return Bi.getTypes()},createScene:function(e,t){const n=new eu(this);if(arguments.length){if(!(e instanceof rw))throw new Error("Couldn't create scene: profile must be of type ProfileInfo.");n.setProfile(e);for(let e=1,t=arguments.length;e<t;++e){const t=arguments[e];if(!(t instanceof Na))throw new Error("Couldn't create scene: component must be of type ComponentInfo.");n.addComponent(t)}}return n.setup(),n},replaceWorld:function(e){if(this[fw]&&this[fw].abort(),this.initialized().getValue()&&(this.getExecutionContext().setLive(!1),this.shutdown().processInterests(),this.callBrowserCallbacks(s.SHUTDOWN_EVENT),this.callBrowserEventHandler("shutdown")),e instanceof Bn.MFNode){const t=e;e=this.createScene();for(const n of t)e.isLive().addInterest(n.getValue().getExecutionContext().isLive());e.setRootNodes(t)}e instanceof Za||(e=this.createScene()),e.getExecutionContext().isLive().removeInterest("setLive",e),e.setExecutionContext(e),this.setDescription(""),this.getBrowserOptions().configure(),this.setBrowserLoading(!0),this._loadCount.addInterest("checkLoadCount",this);for(const t of e.getLoadingObjects())this.addLoadCount(t);this.setExecutionContext(e),this.getWorld().bindBindables(),this.getWorld().traverse(sr.DISPLAY,null),e.setLive(this.isLive().getValue())},checkLoadCount:function(e){e.getValue()||(this._loadCount.removeInterest("checkLoadCount",this),this.initialized().setValue(this.getCurrentTime()),this.callBrowserCallbacks(s.INITIALIZED_EVENT),this.callBrowserEventHandler("initialized load"),this.setBrowserLoading(!1))},createVrmlFromString:function(e){return this.createX3DFromString(e).rootNodes},createX3DFromString:function(e){e=String(e);const t=this.currentScene,n=this.isExternal(),i=new oa(this.getWorld()).createX3DFromString(t.getWorldURL(),e);return n||(t.isLive().addInterest("setLive",i),i.setExecutionContext(t),i.setLive(t.getLive())),i},createVrmlFromURL:function(e,t,n){if(t=xr(s.X3DNode,t,!1),n=String(n),!(e instanceof Bn.MFString))throw new Error("Browser.createVrmlFromURL: url must be of type MFString.");if(!t)throw new Error("Browser.createVrmlFromURL: node must be of type X3DNode.");const i=t.getField(n);if(!i.isInput())throw new Error("Browser.createVrmlFromURL: event named '"+n+"' must be a input field.");if(i.getType()!==s.MFNode)throw new Error("Browser.createVrmlFromURL: event named '"+n+"' must be of type MFNode.");const o=this.currentScene,r=this.isExternal(),a=new oa(this.getWorld());this.addLoadCount(a),a.createX3DFromURL(e,null,function(e){this.removeLoadCount(a),e&&(r||(o.isLive().addInterest("setLive",e),e.setExecutionContext(o),e.setLive(o.getLive())),i.setValue(e.rootNodes))}.bind(this))},createX3DFromURL:function(e,t,n){if(3===arguments.length)return this.createVrmlFromURL(e,t,n);if(!(e instanceof Bn.MFString))throw new Error("Browser.createX3DFromURL: url must be of type MFString.");const i=this.currentScene,o=this.isExternal(),r=new oa(this.getWorld()),s=r.createX3DFromURL(e,null);return o||(i.isLive().addInterest("setLive",s),s.setExecutionContext(i),s.setLive(i.getLive())),s},loadURL:function(e,t=new Bn.MFString){return new Promise(function(n,i){if(!(e instanceof Bn.MFString))throw new Error("Browser.loadURL: url must be of type MFString.");if(!(t instanceof Bn.MFString))throw new Error("Browser.loadURL: parameter must be of type MFString.");this._loadCount.removeInterest("checkLoadCount",this),this.prepareEvents().removeInterest("updateInitialized",this),this[fw]&&this[fw].abort(),this.setBrowserLoading(!0),this.addLoadCount(this);const o=this[fw]=new oa(this.getWorld());o.createX3DFromURL(e,t,function(e){o===this[fw]?(this.getBrowserOptions().getSplashScreen()||this.getCanvas().show(),e?(this.replaceWorld(e),this.removeLoadCount(this),n()):(this.callBrowserCallbacks(s.CONNECTION_ERROR),this.callBrowserEventHandler("error"),setTimeout(function(){this.getSplashScreen().find(".x_ite-private-spinner-text").text(ai("Failed loading world."))}.bind(this),31),i("Couldn't load X3D file."))):i("Loading of X3D file aborted.")}.bind(this),function(e){o===this[fw]?(this.changeViewpoint(e),this.removeLoadCount(this),this.setBrowserLoading(!1),n()):i("Change viewpoint aborted.")}.bind(this),function(e,t){o===this[fw]?(t?window.open(e,t):location=e,this.removeLoadCount(this),this.setBrowserLoading(!1),n()):i("Loading of file aborted.")}.bind(this))}.bind(this))},addBrowserListener:function(e,t){},removeBrowserListener:function(e){},addBrowserCallback:function(e,t){this[gw].set(e,t)},removeBrowserCallback:function(e){this[gw].delete(e)},getBrowserCallbacks:function(){return this[gw]},callBrowserCallbacks:function(){const e=[];return function(t){if(this[gw].size)for(const n of c.values(e,this[gw]))n(t)}}(),importDocument:function(e,t=!1){const n=this.currentScene,i=this.createScene();this.isExternal()||(n.isLive().addInterest("setLive",i),i.setExecutionContext(n),i.setLive(n.getLive()));const o=new Lo(i);return o.setInput(e),t?new Promise(o.parseIntoScene.bind(o)):(o.parseIntoScene(),i)},importJS:function(e,t=!1){const n=this.currentScene,i=this.createScene();this.isExternal()||(n.isLive().addInterest("setLive",i),i.setExecutionContext(n),i.setLive(n.getLive()));const o=new Bo(i);return o.setInput(e),t?new Promise(o.parseIntoScene.bind(o)):(o.parseIntoScene(),i)},getBrowserProperty:function(e){return this.getBrowserProperties().getField(e).getValue()},setBrowserOption:function(e,t){this.getBrowserOptions().getField(e).setValue(t)},getBrowserOption:function(e){return this.getBrowserOptions().getField(e).getValue()},getRenderingProperty:function(e){return this.getRenderingProperties().getField(e).getValue()},firstViewpoint:function(e){(e=xr(s.X3DLayerNode,e,!1))||(e=this.getActiveLayer());const t=e.getUserViewpoints();t.length&&this.bindViewpoint(e,t[0])},previousViewpoint:function(e){(e=xr(s.X3DLayerNode,e,!1))||(e=this.getActiveLayer());const t=e.getUserViewpoints();if(0!==t.length){for(var n=0,i=t.length;n<i&&!t[n]._isBound.getValue();++n);n<t.length?0===n?this.bindViewpoint(e,t.at(-1)):this.bindViewpoint(e,t[n-1]):this.bindViewpoint(e,t.at(-1))}},nextViewpoint:function(e){(e=xr(s.X3DLayerNode,e,!1))||(e=this.getActiveLayer());const t=e.getUserViewpoints();if(0!==t.length){for(var n=0,i=t.length;n<i&&!t[n]._isBound.getValue();++n);n<t.length?n===t.length-1?this.bindViewpoint(e,t[0]):this.bindViewpoint(e,t[n+1]):this.bindViewpoint(e,t[0])}},lastViewpoint:function(e){(e=xr(s.X3DLayerNode,e,!1))||(e=this.getActiveLayer());const t=e.getUserViewpoints();t.length&&this.bindViewpoint(e,t.at(-1))},changeViewpoint:function(e,t){if(1===arguments.length&&(t=String(e),e=this.getActiveLayer()),(e=xr(s.X3DLayerNode,e,!1))||(e=this.getActiveLayer()),e instanceof xs)for(const n of e.getViewpoints().get())if(n.getName()===t){this.bindViewpoint(e,n);break}},bindViewpoint:function(e,t){if(e=xr(s.X3DLayerNode,e,!1),t=xr(s.X3DViewpointNode,t,!1),!e)throw new Error("Browser.bindViewpoint: layerNode must be of type X3DLayerNode.");if(!t)throw new Error("Browser.bindViewpoint: viewpointNode must be of type X3DViewpointNode.");t.setVRMLTransition(!0),t._isBound.getValue()?t.transitionStart(e,t,t):t._set_bind=!0},addRoute:function(e,t,n,i){this.currentScene.addRoute(e,t,n,i)},deleteRoute:function(e,t,n,i){try{const o=this.currentScene.getRoute(e,t,n,i);o&&this.currentScene.deleteRoute(o)}catch(e){console.error(e)}},beginUpdate:function(){this.setLive(!0),this.getExecutionContext().setLive(!0),this.advanceTime(),this.addBrowserEvent()},endUpdate:function(){this.setLive(!1),this.getExecutionContext().setLive(!1)},print:function(){const e=Array.prototype.join.call(arguments,"");console.log(e);const t=dw(".x_ite-console");t.length&&t.append(document.createTextNode(e))},println:function(){const e=Array.prototype.join.call(arguments,"");console.log(e);const t=dw(".x_ite-console");t.length&&t.append(document.createTextNode(e+"\n"))},toVRMLStream:function(e){this.currentScene.toVRMLStream(e)},toXMLStream:function(e){this.currentScene.toXMLStream(e)},toJSONStream:function(e){this.currentScene.toJSONStream(e)}});for(const e of Reflect.ownKeys(mw.prototype))Object.defineProperty(mw.prototype,e,{enumerable:!1});Object.defineProperty(mw.prototype,"name",{get:function(){return this.getName()},enumerable:!0,configurable:!1}),Object.defineProperty(mw.prototype,"version",{get:function(){return this.getVersion()},enumerable:!0,configurable:!1}),Object.defineProperty(mw.prototype,"currentFrameRate",{get:function(){return this.getCurrentFrameRate()},enumerable:!0,configurable:!1}),Object.defineProperty(mw.prototype,"currentSpeed",{get:function(){return this.getCurrentSpeed()},enumerable:!0,configurable:!1}),Object.defineProperty(mw.prototype,"description",{get:function(){return this.getDescription()},set:function(e){this.setDescription(e)},enumerable:!0,configurable:!1}),Object.defineProperty(mw.prototype,"currentScene",{get:function(){return this.getScriptStack().at(-1).getExecutionContext()},enumerable:!0,configurable:!1}),Object.defineProperty(mw.prototype,"supportedProfiles",{get:function(){return hw},enumerable:!0,configurable:!1}),Object.defineProperty(mw.prototype,"supportedComponents",{get:function(){return lw},enumerable:!0,configurable:!1});const _w=mw;const yw=i(755);!function(){function e(e){if((e=Math.trunc(e)||0)<0&&(e+=this.length),!(e<0||e>=this.length))return this[e]}const t=Reflect.getPrototypeOf(Int8Array);for(const n of[Array,String,t])void 0===n.prototype.at&&Object.defineProperty(n.prototype,"at",{value:e,writable:!0,enumerable:!1,configurable:!0})}();function xw(e){let t=0,n=0;return function(){const i=e.call(this);return i>n?(t=0,n=i,i):n=i+ ++t/1e3}}for(const e of[performance,Date])Object.defineProperty(e,"now",{value:xw(e.now),configurable:!0,writable:!0});var ww=i(755);const vw={error:function(e,t){ww(function(){const n=ww("x3d-canvas, X3DCanvas");this.show(n,e);for(const i of t)"function"==typeof i&&i(n,e)}.bind(this))},show:function(e,t){console.error(t);const n=ww(".x_ite-console");n.length&&n.append(document.createTextNode(t)),e.children(".x_ite-private-browser").hide(),e.children(":not(.x_ite-private-browser)").show(),e.each((function(e,t){t.shadowRoot&&t.shadowRoot.appendChild(document.createElement("slot"))}))}},bw=vw;function Sw(e){Jn.call(this,e),mr.call(this,e),this.renderObject=null}Sw.prototype=Object.assign(Object.create(Jn.prototype),mr.prototype,{constructor:Sw,initialize:function(){Jn.prototype.initialize.call(this),mr.prototype.initialize.call(this)},isIndependent:function(){return!1},setRenderer:function(e){this.renderObject=e},getLayer:function(){return this.renderObject.getLayer()},getBackground:function(){return this.renderObject.getBackground()},getFog:function(){return this.renderObject.getFog()},getNavigationInfo:function(){return this.renderObject.getNavigationInfo()},getViewpoint:function(){return this.renderObject.getViewpoint()},getLightContainer:function(){return this.renderObject.getLights()[this.lightIndex++]},render:function(e,t,n){switch(e){case sr.COLLISION:case sr.SHADOW:mr.prototype.render.call(this,e,t,n);break;case sr.DISPLAY:this.lightIndex=0,mr.prototype.render.call(this,e,t,n);for(const e of this.renderObject.getLights())e.getModelViewMatrix().pop()}}});for(const e of Reflect.ownKeys(Sw.prototype))Object.defineProperty(Sw.prototype,e,{enumerable:!1});const Tw=new Map([["lib/jquery",yw],["locale/gettext",ai],["shim",undefined],["standard/Math/Algorithm",ee],["standard/Math/Algorithms/Bezier",pp],["standard/Math/Algorithms/MergeSort",ur],["standard/Math/Algorithms/QuickSort",gl],["standard/Math/Algorithms/SAT",er],["standard/Math/Algorithms/eigen_decomposition",Qe],["standard/Math/Geometry/Box2",zd],["standard/Math/Geometry/Box3",hr],["standard/Math/Geometry/Camera",lr],["standard/Math/Geometry/Cylinder3",J_],["standard/Math/Geometry/Line2",xl],["standard/Math/Geometry/Line3",pl],["standard/Math/Geometry/Plane3",qo],["standard/Math/Geometry/Sphere3",uy],["standard/Math/Geometry/Triangle3",Yo],["standard/Math/Geometry/ViewVolume",nr],["standard/Math/Numbers/Color3",le],["standard/Math/Numbers/Color4",Ee],["standard/Math/Numbers/Complex",Qr],["standard/Math/Numbers/Matrix2",We],["standard/Math/Numbers/Matrix3",et],["standard/Math/Numbers/Matrix4",Nt],["standard/Math/Numbers/Quaternion",gt],["standard/Math/Numbers/Rotation4",Et],["standard/Math/Numbers/Vector2",ke],["standard/Math/Numbers/Vector3",He],["standard/Math/Numbers/Vector4",st],["standard/Math/Utility/MatrixStack",dr],["standard/Networking/BinaryTransport",Ys],["standard/Time/MicroTime",undefined],["standard/Utility/BitSet",Jr],["standard/Utility/DataStorage",su],["standard/Utility/MapUtilities",c],["standard/Utility/ObjectCache",Ar],["x_ite/Base/Events",S],["x_ite/Base/FieldArray",L],["x_ite/Base/FieldDefinitionArray",P],["x_ite/Base/X3DArrayField",nn],["x_ite/Base/X3DBaseNode",Jn],["x_ite/Base/X3DCast",xr],["x_ite/Base/X3DChildObject",w],["x_ite/Base/X3DConstants",s],["x_ite/Base/X3DEventObject",C],["x_ite/Base/X3DField",Z],["x_ite/Base/X3DFieldDefinition",N],["x_ite/Base/X3DInfoArray",R],["x_ite/Base/X3DObject",g],["x_ite/Base/X3DObjectArrayField",un],["x_ite/Base/X3DTypedArrayField",mn],["x_ite/Browser/Core/BrowserOptions",wi],["x_ite/Browser/Core/BrowserProperties",bi],["x_ite/Browser/Core/BrowserTimings",hi],["x_ite/Browser/Core/Context",ii],["x_ite/Browser/Core/ContextMenu",Di],["x_ite/Browser/Core/Notification",Oi],["x_ite/Browser/Core/PrimitiveQuality",pi],["x_ite/Browser/Core/RenderingProperties",Ti],["x_ite/Browser/Core/Shading",gi],["x_ite/Browser/Core/TextureQuality",_i],["x_ite/Browser/Core/X3DCoreContext",Fu],["x_ite/Browser/DOMIntegration",iw],["x_ite/Browser/EnvironmentalEffects/X3DEnvironmentalEffectsContext",Vu],["x_ite/Browser/Followers/X3DArrayChaserTemplate",Og],["x_ite/Browser/Followers/X3DArrayFollowerTemplate",Cg],["x_ite/Browser/Geometry3D/BoxOptions",$u],["x_ite/Browser/Geometry3D/ConeOptions",el],["x_ite/Browser/Geometry3D/CylinderOptions",nl],["x_ite/Browser/Geometry3D/QuadSphereOptions",ol],["x_ite/Browser/Geometry3D/X3DGeometry3DContext",al],["x_ite/Browser/Grouping/X3DGroupingContext",Ml],["x_ite/Browser/Interpolation/CatmullRomSplineInterpolator",Gm],["x_ite/Browser/Interpolation/CatmullRomSplineInterpolator1",Jm],["x_ite/Browser/Interpolation/CatmullRomSplineInterpolator2",Km],["x_ite/Browser/Interpolation/CatmullRomSplineInterpolator3",qm],["x_ite/Browser/Interpolation/CatmullRomSplineInterpolatorTemplate",Hm],["x_ite/Browser/Interpolation/SquatInterpolator",o_],["x_ite/Browser/Layering/X3DLayeringContext",Al],["x_ite/Browser/Lighting/X3DLightingContext",Xl],["x_ite/Browser/Navigation/ExamineViewer",rc],["x_ite/Browser/Navigation/FlyViewer",gc],["x_ite/Browser/Navigation/LookAtViewer",Nc],["x_ite/Browser/Navigation/NoneViewer",Tc],["x_ite/Browser/Navigation/PlaneViewer",bc],["x_ite/Browser/Navigation/WalkViewer",pc],["x_ite/Browser/Navigation/X3DFlyViewer",hc],["x_ite/Browser/Navigation/X3DNavigationContext",Bc],["x_ite/Browser/Navigation/X3DViewer",Gl],["x_ite/Browser/Networking/URLs",kc],["x_ite/Browser/Networking/X3DNetworkingContext",Yc],["x_ite/Browser/Picking/X3DPickingContext",th],["x_ite/Browser/PointingDeviceSensor/PointingDevice",oh],["x_ite/Browser/PointingDeviceSensor/PointingDeviceSensorContainer",A_],["x_ite/Browser/PointingDeviceSensor/X3DPointingDeviceSensorContext",vh],["x_ite/Browser/Rendering/GeometryContext",Kr],["x_ite/Browser/Rendering/X3DRenderingContext",Fh],["x_ite/Browser/Scripting/X3DScriptingContext",Ih],["x_ite/Browser/Shaders/ShaderCompiler",rd],["x_ite/Browser/Shaders/ShaderSource",nd],["x_ite/Browser/Shaders/Shaders",Rh],["x_ite/Browser/Shaders/X3DShadersContext",pd],["x_ite/Browser/Shape/AlphaMode",ll],["x_ite/Browser/Shape/X3DShapeContext",Rd],["x_ite/Browser/Sound/X3DSoundContext",Pd],["x_ite/Browser/Text/PolygonText",gp],["x_ite/Browser/Text/TextAlignment",Ld],["x_ite/Browser/Text/X3DTextContext",Tp],["x_ite/Browser/Text/X3DTextGeometry",up],["x_ite/Browser/Texturing/FunctionType",$h],["x_ite/Browser/Texturing/ModeType",Yh],["x_ite/Browser/Texturing/SourceType",Zh],["x_ite/Browser/Texturing/TextureCoordinateGeneratorModeType",ed],["x_ite/Browser/Texturing/X3DTexturingContext",Kp],["x_ite/Browser/Time/X3DTimeContext",tf],["x_ite/Browser/VERSION",ei],["x_ite/Browser/X3DBrowser",_w],["x_ite/Browser/X3DBrowserContext",Ef],["x_ite/Components",tw],["x_ite/Components/Core",undefined],["x_ite/Components/Core/MetadataBoolean",Ff],["x_ite/Components/Core/MetadataDouble",Df],["x_ite/Components/Core/MetadataFloat",Rf],["x_ite/Components/Core/MetadataInteger",Pf],["x_ite/Components/Core/MetadataSet",Lf],["x_ite/Components/Core/MetadataString",Bf],["x_ite/Components/Core/WorldInfo",jf],["x_ite/Components/Core/X3DBindableNode",Ir],["x_ite/Components/Core/X3DChildNode",yr],["x_ite/Components/Core/X3DInfoNode",kf],["x_ite/Components/Core/X3DMetadataObject",Of],["x_ite/Components/Core/X3DNode",ji],["x_ite/Components/Core/X3DPrototypeInstance",ao],["x_ite/Components/Core/X3DSensorNode",vs],["x_ite/Components/EnvironmentalEffects",undefined],["x_ite/Components/EnvironmentalEffects/Background",ms],["x_ite/Components/EnvironmentalEffects/Fog",zr],["x_ite/Components/EnvironmentalEffects/FogCoordinate",Wf],["x_ite/Components/EnvironmentalEffects/LocalFog",Kf],["x_ite/Components/EnvironmentalEffects/TextureBackground",Qf],["x_ite/Components/EnvironmentalEffects/X3DBackgroundNode",ns],["x_ite/Components/EnvironmentalEffects/X3DFogObject",Xr],["x_ite/Components/EnvironmentalSensor",undefined],["x_ite/Components/EnvironmentalSensor/ProximitySensor",ig],["x_ite/Components/EnvironmentalSensor/TransformSensor",ag],["x_ite/Components/EnvironmentalSensor/VisibilitySensor",lg],["x_ite/Components/EnvironmentalSensor/X3DEnvironmentalSensorNode",tg],["x_ite/Components/Followers",undefined],["x_ite/Components/Followers/ColorChaser",_g],["x_ite/Components/Followers/ColorDamper",Eg],["x_ite/Components/Followers/CoordinateChaser",Mg],["x_ite/Components/Followers/CoordinateDamper",Rg],["x_ite/Components/Followers/OrientationChaser",ec],["x_ite/Components/Followers/OrientationDamper",Lg],["x_ite/Components/Followers/PositionChaser",Zl],["x_ite/Components/Followers/PositionChaser2D",Bg],["x_ite/Components/Followers/PositionDamper",kg],["x_ite/Components/Followers/PositionDamper2D",jg],["x_ite/Components/Followers/ScalarChaser",Hg],["x_ite/Components/Followers/ScalarDamper",Wg],["x_ite/Components/Followers/TexCoordChaser2D",Zg],["x_ite/Components/Followers/TexCoordDamper2D",Jg],["x_ite/Components/Followers/X3DChaserNode",Yl],["x_ite/Components/Followers/X3DDamperNode",xg],["x_ite/Components/Followers/X3DFollowerNode",ql],["x_ite/Components/Geometry3D",undefined],["x_ite/Components/Geometry3D/Box",im],["x_ite/Components/Geometry3D/Cone",rm],["x_ite/Components/Geometry3D/Cylinder",am],["x_ite/Components/Geometry3D/ElevationGrid",lm],["x_ite/Components/Geometry3D/Extrusion",hm],["x_ite/Components/Geometry3D/IndexedFaceSet",Uu],["x_ite/Components/Geometry3D/Sphere",pm],["x_ite/Components/Grouping",undefined],["x_ite/Components/Grouping/Group",ks],["x_ite/Components/Grouping/StaticGroup",_m],["x_ite/Components/Grouping/Switch",xm],["x_ite/Components/Grouping/Transform",Em],["x_ite/Components/Grouping/X3DBoundedObject",vr],["x_ite/Components/Grouping/X3DGroupingNode",Tr],["x_ite/Components/Grouping/X3DTransformMatrix3DNode",vm],["x_ite/Components/Grouping/X3DTransformNode",Sm],["x_ite/Components/Interpolation",undefined],["x_ite/Components/Interpolation/ColorInterpolator",Fm],["x_ite/Components/Interpolation/CoordinateInterpolator",Dm],["x_ite/Components/Interpolation/CoordinateInterpolator2D",Rm],["x_ite/Components/Interpolation/EaseInEaseOut",Fs],["x_ite/Components/Interpolation/NormalInterpolator",Pm],["x_ite/Components/Interpolation/OrientationInterpolator",Rs],["x_ite/Components/Interpolation/PositionInterpolator",Ds],["x_ite/Components/Interpolation/PositionInterpolator2D",Lm],["x_ite/Components/Interpolation/ScalarInterpolator",Ls],["x_ite/Components/Interpolation/SplinePositionInterpolator",Ym],["x_ite/Components/Interpolation/SplinePositionInterpolator2D",Qm],["x_ite/Components/Interpolation/SplineScalarInterpolator",t_],["x_ite/Components/Interpolation/SquadOrientationInterpolator",s_],["x_ite/Components/Interpolation/X3DInterpolatorNode",Os],["x_ite/Components/Layering",undefined],["x_ite/Components/Layering/Layer",js],["x_ite/Components/Layering/LayerSet",Hs],["x_ite/Components/Layering/Viewport",Rl],["x_ite/Components/Layering/X3DLayerNode",xs],["x_ite/Components/Layering/X3DViewportNode",Cr],["x_ite/Components/Lighting",undefined],["x_ite/Components/Lighting/DirectionalLight",Vc],["x_ite/Components/Lighting/PointLight",m_],["x_ite/Components/Lighting/SpotLight",w_],["x_ite/Components/Lighting/X3DLightNode",Mc],["x_ite/Components/Navigation",undefined],["x_ite/Components/Navigation/Billboard",T_],["x_ite/Components/Navigation/Collision",C_],["x_ite/Components/Navigation/LOD",N_],["x_ite/Components/Navigation/NavigationInfo",Pr],["x_ite/Components/Navigation/OrthoViewpoint",zl],["x_ite/Components/Navigation/Viewpoint",Bs],["x_ite/Components/Navigation/ViewpointGroup",I_],["x_ite/Components/Navigation/X3DViewpointNode",Ps],["x_ite/Components/Networking",undefined],["x_ite/Components/Networking/Anchor",H_],["x_ite/Components/Networking/Inline",W_],["x_ite/Components/Networking/LoadSensor",jh],["x_ite/Components/Networking/X3DNetworkSensorNode",kh],["x_ite/Components/Networking/X3DUrlObject",xo],["x_ite/Components/PointingDeviceSensor",undefined],["x_ite/Components/PointingDeviceSensor/CylinderSensor",ty],["x_ite/Components/PointingDeviceSensor/PlaneSensor",sy],["x_ite/Components/PointingDeviceSensor/SphereSensor",cy],["x_ite/Components/PointingDeviceSensor/TouchSensor",j_],["x_ite/Components/PointingDeviceSensor/X3DDragSensorNode",Q_],["x_ite/Components/PointingDeviceSensor/X3DPointingDeviceSensorNode",U_],["x_ite/Components/PointingDeviceSensor/X3DTouchSensorNode",X_],["x_ite/Components/Rendering",undefined],["x_ite/Components/Rendering/ClipPlane",my],["x_ite/Components/Rendering/Color",Ol],["x_ite/Components/Rendering/ColorRGBA",yy],["x_ite/Components/Rendering/Coordinate",Gu],["x_ite/Components/Rendering/IndexedLineSet",Sl],["x_ite/Components/Rendering/IndexedTriangleFanSet",wy],["x_ite/Components/Rendering/IndexedTriangleSet",by],["x_ite/Components/Rendering/IndexedTriangleStripSet",Ty],["x_ite/Components/Rendering/LineSet",Cy],["x_ite/Components/Rendering/Normal",My],["x_ite/Components/Rendering/PointSet",Vy],["x_ite/Components/Rendering/TriangleFanSet",Ay],["x_ite/Components/Rendering/TriangleSet",Uy],["x_ite/Components/Rendering/TriangleStripSet",Xy],["x_ite/Components/Rendering/X3DColorNode",El],["x_ite/Components/Rendering/X3DComposedGeometryNode",Au],["x_ite/Components/Rendering/X3DCoordinateNode",zu],["x_ite/Components/Rendering/X3DGeometricPropertyNode",Xu],["x_ite/Components/Rendering/X3DGeometryNode",Wr],["x_ite/Components/Rendering/X3DLineGeometryNode",vl],["x_ite/Components/Rendering/X3DNormalNode",Ny],["x_ite/Components/Rendering/X3DPointGeometryNode",Iy],["x_ite/Components/Shaders",undefined],["x_ite/Components/Shaders/ComposedShader",Hh],["x_ite/Components/Shaders/FloatVertexAttribute",qy],["x_ite/Components/Shaders/Matrix3VertexAttribute",Yy],["x_ite/Components/Shaders/Matrix4VertexAttribute",Zy],["x_ite/Components/Shaders/PackagedShader",$y],["x_ite/Components/Shaders/ProgramShader",ex],["x_ite/Components/Shaders/ShaderPart",ud],["x_ite/Components/Shaders/ShaderProgram",nx],["x_ite/Components/Shaders/X3DProgrammableShaderObject",Bh],["x_ite/Components/Shaders/X3DShaderNode",Ph],["x_ite/Components/Shaders/X3DVertexAttributeNode",Gy],["x_ite/Components/Shape",undefined],["x_ite/Components/Shape/AcousticProperties",sx],["x_ite/Components/Shape/Appearance",_d],["x_ite/Components/Shape/FillProperties",ux],["x_ite/Components/Shape/LineProperties",cx],["x_ite/Components/Shape/Material",dx],["x_ite/Components/Shape/PhysicalMaterial",fx],["x_ite/Components/Shape/PointProperties",mx],["x_ite/Components/Shape/Shape",_l],["x_ite/Components/Shape/TwoSidedMaterial",yx],["x_ite/Components/Shape/UnlitMaterial",Sd],["x_ite/Components/Shape/X3DAppearanceChildNode",os],["x_ite/Components/Shape/X3DAppearanceNode",gd],["x_ite/Components/Shape/X3DMaterialNode",xd],["x_ite/Components/Shape/X3DOneSidedMaterialNode",vd],["x_ite/Components/Shape/X3DShapeNode",hl],["x_ite/Components/Sound",undefined],["x_ite/Components/Sound/AudioClip",Ex],["x_ite/Components/Sound/Sound",Fx],["x_ite/Components/Sound/X3DSoundNode",Ox],["x_ite/Components/Sound/X3DSoundSourceNode",bx],["x_ite/Components/Text",undefined],["x_ite/Components/Text/FontStyle",_p],["x_ite/Components/Text/Text",Rx],["x_ite/Components/Text/X3DFontStyleNode",Xd],["x_ite/Components/Texturing",undefined],["x_ite/Components/Texturing/ImageTexture",fs],["x_ite/Components/Texturing/MovieTexture",Ux],["x_ite/Components/Texturing/MultiTexture",Xx],["x_ite/Components/Texturing/MultiTextureCoordinate",zx],["x_ite/Components/Texturing/MultiTextureTransform",Gx],["x_ite/Components/Texturing/PixelTexture",Wx],["x_ite/Components/Texturing/TextureCoordinate",Zu],["x_ite/Components/Texturing/TextureCoordinateGenerator",Kx],["x_ite/Components/Texturing/TextureProperties",Du],["x_ite/Components/Texturing/TextureTransform",Mp],["x_ite/Components/Texturing/X3DSingleTextureCoordinateNode",Yu],["x_ite/Components/Texturing/X3DSingleTextureNode",us],["x_ite/Components/Texturing/X3DSingleTextureTransformNode",Np],["x_ite/Components/Texturing/X3DTexture2DNode",hs],["x_ite/Components/Texturing/X3DTextureCoordinateNode",qu],["x_ite/Components/Texturing/X3DTextureNode",ss],["x_ite/Components/Texturing/X3DTextureTransformNode",Cp],["x_ite/Components/Time",undefined],["x_ite/Components/Time/TimeSensor",Es],["x_ite/Components/Time/X3DTimeDependentNode",Ss],["x_ite/Configuration/ComponentInfo",Na],["x_ite/Configuration/ComponentInfoArray",Ma],["x_ite/Configuration/ProfileInfo",rw],["x_ite/Configuration/ProfileInfoArray",aw],["x_ite/Configuration/SupportedComponents",lw],["x_ite/Configuration/SupportedNodes",Bi],["x_ite/Configuration/SupportedProfiles",hw],["x_ite/Configuration/UnitInfo",Ia],["x_ite/Configuration/UnitInfoArray",Va],["x_ite/DEBUG",ti],["x_ite/Execution/BindableList",Mr],["x_ite/Execution/BindableStack",Nr],["x_ite/Execution/ExportedNodesArray",Xa],["x_ite/Execution/ImportedNodesArray",Qi],["x_ite/Execution/NamedNodesArray",ki],["x_ite/Execution/Scene",eu],["x_ite/Execution/X3DExecutionContext",Ca],["x_ite/Execution/X3DExportedNode",Ua],["x_ite/Execution/X3DImportedNode",Ki],["x_ite/Execution/X3DScene",Za],["x_ite/Execution/X3DWorld",Ws],["x_ite/Fallback",bw],["x_ite/Fields",Bn],["x_ite/Fields/ArrayFields",Rn],["x_ite/Fields/SFBool",$],["x_ite/Fields/SFColor",fe],["x_ite/Fields/SFColorRGBA",De],["x_ite/Fields/SFDouble",Re],["x_ite/Fields/SFFloat",Pe],["x_ite/Fields/SFImage",Un],["x_ite/Fields/SFInt32",Le],["x_ite/Fields/SFMatrix3",nt],["x_ite/Fields/SFMatrix4",Mt],["x_ite/Fields/SFMatrixPrototypeTemplate",Ue],["x_ite/Fields/SFNode",Bt],["x_ite/Fields/SFNodeCache",Rt],["x_ite/Fields/SFRotation",qt],["x_ite/Fields/SFString",Zt],["x_ite/Fields/SFTime",$t],["x_ite/Fields/SFVec2",je],["x_ite/Fields/SFVec3",ot],["x_ite/Fields/SFVec4",en],["x_ite/Fields/SFVecPrototypeTemplate",Be],["x_ite/InputOutput/FileLoader",oa],["x_ite/InputOutput/Generator",u],["x_ite/Parser/GoldenGate",ko],["x_ite/Parser/HTMLSupport",Vi],["x_ite/Parser/JSONParser",Bo],["x_ite/Parser/VRMLParser",Co],["x_ite/Parser/X3DParser",vo],["x_ite/Parser/XMLParser",Lo],["x_ite/Prototype/ExternProtoDeclarationArray",Ji],["x_ite/Prototype/ProtoDeclarationArray",to],["x_ite/Prototype/X3DExternProtoDeclaration",ua],["x_ite/Prototype/X3DProtoDeclaration",po],["x_ite/Prototype/X3DProtoDeclarationNode",lo],["x_ite/Rendering/DependentRenderer",Sw],["x_ite/Rendering/TextureBuffer",or],["x_ite/Rendering/TraverseType",sr],["x_ite/Rendering/VertexArray",Gr],["x_ite/Rendering/X3DRenderObject",mr],["x_ite/Routing/RouteArray",ca],["x_ite/Routing/X3DRoute",_a],["x_ite/Routing/X3DRoutingContext",uf]]);Tw.set("x_ite/Namespace",Tw);const Ew=Tw;var Cw=i(755);const Ow=Cw.Deferred(),Nw=Cw.Deferred();let Fw=!1;function Mw(e,t){return new Promise((function(n,i){"function"==typeof e&&Ow.done(e),"function"==typeof t&&Nw.done(t),Ow.done(n),Nw.done(i),Fw||(Fw=!0,Cw((function(){const e=Cw("X3DCanvas");e.length&&(console.warn("Use of <X3DCanvas> element is depreciated, please use <x3d-canvas> element instead. See https://create3000.github.io/x_ite/#embedding-x_ite-within-a-web-page."),Cw.map(e,Mw.createBrowserFromElement)),Ow.resolve()})))}))}Object.assign(Mw,{require:function(e){if(!Ew.has(e))throw new Error("Unknown module '"+e+"'.");return Ew.get(e)},noConflict:function(){const e=window.hasOwnProperty("X3D"),t=window.X3D;return function(){return window.X3D===Mw&&(e?window.X3D=t:delete window.X3D),Mw}}(),getBrowser:function(e){return Cw(e||"x3d-canvas, X3DCanvas").data("browser")},createBrowser:function(e,t){const n=Cw("<x3d-canvas></x3d-canvas>");return e instanceof Bn.MFString&&n.attr("url",e.toString()),n.get(0)},createBrowserFromElement:function(e){try{if((e=Cw(e)).find(".x_ite-private-browser").length)return;const t=new _w(e);e.data("browser",t),t.setup()}catch(e){bw.show(Cw("x3d-canvas, X3DCanvas"),e),Nw.resolve(e)}}}),Object.assign(Mw,{X3DConstants:s,X3DBrowser:_w,X3DExecutionContext:Ca,X3DScene:Za,ComponentInfo:Na,ComponentInfoArray:Ma,ProfileInfo:rw,ProfileInfoArray:aw,UnitInfo:Ia,UnitInfoArray:Va,ExternProtoDeclarationArray:Ji,ProtoDeclarationArray:to,X3DExternProtoDeclaration:ua,X3DProtoDeclaration:po,RouteArray:ca,X3DRoute:_a,X3DBaseNode:Jn,X3DExportedNode:Ua,X3DImportedNode:Ki,X3DProtoDeclarationNode:lo,X3DFieldDefinition:N,FieldDefinitionArray:P,X3DField:Z,X3DArrayField:nn,SFColor:Bn.SFColor,SFColorRGBA:Bn.SFColorRGBA,SFImage:Bn.SFImage,SFMatrix3d:Bn.SFMatrix3d,SFMatrix3f:Bn.SFMatrix3f,SFMatrix4d:Bn.SFMatrix4d,SFMatrix4f:Bn.SFMatrix4f,SFNode:Bn.SFNode,SFRotation:Bn.SFRotation,SFVec2d:Bn.SFVec2d,SFVec2f:Bn.SFVec2f,SFVec3d:Bn.SFVec3d,SFVec3f:Bn.SFVec3f,SFVec4d:Bn.SFVec4d,SFVec4f:Bn.SFVec4f,VrmlMatrix:Bn.VrmlMatrix,MFBool:Bn.MFBool,MFColor:Bn.MFColor,MFColorRGBA:Bn.MFColorRGBA,MFDouble:Bn.MFDouble,MFFloat:Bn.MFFloat,MFImage:Bn.MFImage,MFInt32:Bn.MFInt32,MFMatrix3d:Bn.MFMatrix3d,MFMatrix3f:Bn.MFMatrix3f,MFMatrix4d:Bn.MFMatrix4d,MFMatrix4f:Bn.MFMatrix4f,MFNode:Bn.MFNode,MFRotation:Bn.MFRotation,MFString:Bn.MFString,MFTime:Bn.MFTime,MFVec2d:Bn.MFVec2d,MFVec2f:Bn.MFVec2f,MFVec3d:Bn.MFVec3d,MFVec3f:Bn.MFVec3f,MFVec4d:Bn.MFVec4d,MFVec4f:Bn.MFVec4f}),Ew.set("x_ite/X3D",Mw);const Dw=Mw;class Iw extends HTMLElement{static define(){customElements.define("x3d-canvas",Iw)}constructor(){super();const e=this.attachShadow({mode:"open",delegatesFocus:!0}),t=document.createElement("link");e.loaded=new Promise((function(e,n){t.onload=e,t.onerror=n})),t.setAttribute("rel","stylesheet"),t.setAttribute("type","text/css"),t.setAttribute("href",new URL("x_ite.css",kc.getScriptUrl()).href),e.appendChild(t),Dw.createBrowserFromElement(this)}connectedCallback(){Dw.getBrowser(this).connectedCallback()}static get observedAttributes(){return["splashscreen","src","url"]}attributeChangedCallback(e,t,n){Dw.getBrowser(this).attributeChangedCallback(e,t,n)}}document.createElement("X3DCanvas"),Ew.set("x_ite/X3DCanvas",Iw);const Rw=Iw;window[Symbol.for("X_ITE.X3D-8.0.0a")]=Dw,Rw.define(),Dw();const Vw=Dw})(),o=o.default})()));